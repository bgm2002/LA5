sible(),t.extent=this.getExtent(),t.zIndex=void 0!==n||t.managed?n:1/0,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return vt()}getLayerStatesArray(e){return vt()}getExtent(){return this.get(gr)}getMaxResolution(){return this.get(yr)}getMinResolution(){return this.get(br)}getMinZoom(){return this.get(xr)}getMaxZoom(){return this.get(Sr)}getOpacity(){return this.get(hr)}getSourceState(){return vt()}getVisible(){return this.get(mr)}getZIndex(){return this.get(vr)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(gr,e)}setMaxResolution(e){this.set(yr,e)}setMinResolution(e){this.set(br,e)}setMaxZoom(e){this.set(Sr,e)}setMinZoom(e){this.set(xr,e)}setOpacity(e){(0,tn.h)(\"number\"==typeof e,64),this.set(hr,e)}setVisible(e){this.set(mr,e)}setZIndex(e){this.set(vr,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}},Tr=\"precompose\",Ar=\"rendercomplete\";function Er(e,t){if(!e.visible)return!1;const n=t.resolution;if(n<e.minResolution||n>=e.maxResolution)return!1;const r=t.zoom;return r>e.minZoom&&r<=e.maxZoom}const Or=class extends Cr{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(wr,this.handleSourcePropertyChange_);const n=e.source?e.source:null;this.setSource(n)}getLayersArray(e){return(e=e||[]).push(this),e}getLayerStatesArray(e){return(e=e||[]).push(this.getLayerState()),e}getSource(){return this.get(wr)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():\"undefined\"}handleSourceChange_(){this.changed(),this.sourceReady_||\"ready\"!==this.getSource().getState()||(this.sourceReady_=!0,this.dispatchEvent(\"sourceready\"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(Vt(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=Ft(e,Xe,this.handleSourceChange_,this),\"ready\"===e.getState()&&(this.sourceReady_=!0,setTimeout((()=>{this.dispatchEvent(\"sourceready\")}),0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return this.renderer_&&this.rendered?this.renderer_.getData(e):null}render(e,t){const n=this.getRenderer();if(n.prepareFrame(e))return this.rendered=!0,n.renderFrame(e,t)}unrender(){this.rendered=!1}setMapInternal(e){e||this.unrender(),this.set(\"map\",e)}getMapInternal(){return this.get(\"map\")}setMap(e){this.mapPrecomposeKey_&&(Vt(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(Vt(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=Ft(e,Tr,(function(e){const t=e.frameState.layerStatesArray,n=this.getLayerState(!1);(0,tn.h)(!t.some((function(e){return e.layer===n.layer})),67),t.push(n)}),this),this.mapRenderKey_=Ft(this,Xe,e.render,e),this.changed())}setSource(e){this.set(wr,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}};var Mr=r(37892);function Pr(e,t){fr.expire()}const Dr=class extends it{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){vt()}calculateMatrices2D(e){const t=e.viewState,n=e.coordinateToPixelTransform,r=e.pixelToCoordinateTransform;tr(n,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),nr(r,n)}forEachFeatureAtCoordinate(e,t,n,r,i,o,a,s){let l;const c=t.viewState;function u(e,t,n,r){return i.call(o,t,e?n:null,r)}const d=c.projection,p=(0,Mr.Cf)(e.slice(),d),f=[[0,0]];if(d.canWrapX()&&r){const e=d.getExtent(),t=(0,Gt.dz)(e);f.push([-t,0],[t,0])}const h=t.layerStatesArray,m=h.length,g=[],v=[];for(let r=0;r<f.length;r++)for(let i=m-1;i>=0;--i){const o=h[i],d=o.layer;if(d.hasRenderer()&&Er(o,c)&&a.call(s,d)){const i=d.getRenderer(),a=d.getSource();if(i&&a){const s=a.getWrapX()?p:e,c=u.bind(null,o.managed);v[0]=s[0]+f[r][0],v[1]=s[1]+f[r][1],l=i.forEachFeatureAtCoordinate(v,t,n,c,g)}if(l)return l}}if(0===g.length)return;const y=1/g.length;return g.forEach(((e,t)=>e.distanceSq+=t*y)),g.sort(((e,t)=>e.distanceSq-t.distanceSq)),g.some((e=>l=e.callback(e.feature,e.layer,e.geometry))),l}hasFeatureAtCoordinate(e,t,n,r,i,o){return void 0!==this.forEachFeatureAtCoordinate(e,t,n,r,dt,this,i,o)}getMap(){return this.map_}renderFrame(e){vt()}scheduleExpireIconCache(e){fr.canExpireCache()&&e.postRenderFunctions.push(Pr)}},Ir=class extends ot{constructor(e,t,n,r){super(e),this.inversePixelTransform=t,this.frameState=n,this.context=r}},Nr=\"ol-hidden\",_r=\"ol-unselectable\",jr=\"ol-control\",kr=\"ol-collapsed\",Lr=new RegExp([\"^\\\\s*(?=(?:(?:[-a-z]+\\\\s*){0,2}(italic|oblique))?)\",\"(?=(?:(?:[-a-z]+\\\\s*){0,2}(small-caps))?)\",\"(?=(?:(?:[-a-z]+\\\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)\",\"(?:(?:normal|\\\\1|\\\\2|\\\\3)\\\\s*){0,3}((?:xx?-)?\",\"(?:small|large)|medium|smaller|larger|[\\\\.\\\\d]+(?:\\\\%|in|[cem]m|ex|p[ctx]))\",\"(?:\\\\s*\\\\/\\\\s*(normal|[\\\\.\\\\d]+(?:\\\\%|in|[cem]m|ex|p[ctx])?))\",\"?\\\\s*([-,\\\\\\\"\\\\'\\\\sa-z]+?)\\\\s*$\"].join(\"\"),\"i\"),Rr=[\"style\",\"variant\",\"weight\",\"size\",\"lineHeight\",\"family\"],Zr=function(e){const t=e.match(Lr);if(!t)return null;const n={lineHeight:\"normal\",size:\"1.2em\",style:\"normal\",weight:\"normal\",variant:\"normal\"};for(let e=0,r=Rr.length;e<r;++e){const r=t[e+1];void 0!==r&&(n[Rr[e]]=r)}return n.families=n.family.split(/,\\s?/),n},Br=\"10px sans-serif\",Fr=\"#000\",zr=\"round\",Vr=[],Hr=\"round\",Ur=\"#000\",Gr=\"center\",Yr=\"middle\",Wr=[0,0,0,0],Kr=new fn;let qr,Qr=null;const Xr={},Jr=function(){const e=\"32px \",t=[\"monospace\",\"serif\"],n=t.length,r=\"wmytzilWMYTZIL@#/&?$%10\";let i,o;function a(i,a,s){let l=!0;for(let c=0;c<n;++c){const n=t[c];if(o=ti(i+\" \"+a+\" \"+e+n,r),s!=n){const t=ti(i+\" \"+a+\" \"+e+s+\",\"+n,r);l=l&&t!=o}}return!!l}function s(){let e=!0;const t=Kr.getKeys();for(let n=0,r=t.length;n<r;++n){const r=t[n];Kr.get(r)<100&&(a.apply(this,r.split(\"\\n\"))?(ht(Xr),Qr=null,qr=void 0,Kr.set(r,100)):(Kr.set(r,Kr.get(r)+1,!0),e=!1))}e&&(clearInterval(i),i=void 0)}return function(e){const t=Zr(e);if(!t)return;const n=t.families;for(let e=0,r=n.length;e<r;++e){const r=n[e],o=t.style+\"\\n\"+t.weight+\"\\n\"+r;void 0===Kr.get(o)&&(Kr.set(o,100,!0),a(t.style,t.weight,r)||(Kr.set(o,0,!0),void 0===i&&(i=setInterval(s,32))))}}}(),$r=function(){let e;return function(t){let n=Xr[t];if(null==n){if(Dt){const e=Zr(t),r=ei(t,\"Žg\");n=(isNaN(Number(e.lineHeight))?1.2:Number(e.lineHeight))*(r.actualBoundingBoxAscent+r.actualBoundingBoxDescent)}else e||(e=document.createElement(\"div\"),e.innerHTML=\"M\",e.style.minHeight=\"0\",e.style.maxHeight=\"none\",e.style.height=\"auto\",e.style.padding=\"0\",e.style.border=\"none\",e.style.position=\"absolute\",e.style.display=\"block\",e.style.left=\"-99999px\"),e.style.font=t,document.body.appendChild(e),n=e.offsetHeight,document.body.removeChild(e);Xr[t]=n}return n}}();function ei(e,t){return Qr||(Qr=_t(1,1)),e!=qr&&(Qr.font=e,qr=Qr.font),Qr.measureText(t)}function ti(e,t){return ei(e,t).width}function ni(e,t,n){if(t in n)return n[t];const r=t.split(\"\\n\").reduce(((t,n)=>Math.max(t,ti(e,n))),0);return n[t]=r,r}const ri=class extends Dr{constructor(e){super(e),this.fontChangeListenerKey_=Ft(Kr,cn,e.redrawText.bind(e)),this.element_=document.createElement(\"div\");const t=this.element_.style;t.position=\"absolute\",t.width=\"100%\",t.height=\"100%\",t.zIndex=\"0\",this.element_.className=_r+\" ol-layers\";const n=e.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){const n=this.getMap();if(n.hasListener(e)){const r=new Ir(e,void 0,t);n.dispatchEvent(r)}}disposeInternal(){Vt(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(e){if(!e)return void(this.renderedVisible_&&(this.element_.style.display=\"none\",this.renderedVisible_=!1));this.calculateMatrices2D(e),this.dispatchRenderEvent(Tr,e);const t=e.layerStatesArray.sort((function(e,t){return e.zIndex-t.zIndex})),n=e.viewState;this.children_.length=0;const r=[];let i=null;for(let o=0,a=t.length;o<a;++o){const a=t[o];e.layerIndex=o;const s=a.layer,l=s.getSourceState();if(!Er(a,n)||\"ready\"!=l&&\"undefined\"!=l){s.unrender();continue}const c=s.render(e,i);c&&(c!==i&&(this.children_.push(c),i=c),\"getDeclutter\"in s&&r.push(s))}for(let t=r.length-1;t>=0;--t)r[t].renderDeclutter(e);!function(e,t){const n=e.childNodes;for(let r=0;;++r){const i=n[r],o=t[r];if(!i&&!o)break;i!==o&&(i?o?e.insertBefore(o,i):(e.removeChild(i),--r):e.appendChild(o))}}(this.element_,this.children_),this.dispatchRenderEvent(\"postcompose\",e),this.renderedVisible_||(this.element_.style.display=\"\",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}};class ii extends ot{constructor(e,t){super(e),this.layer=t}}const oi=\"layers\";class ai extends Cr{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let n=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(oi,this.handleLayersChanged_),n?Array.isArray(n)?n=new $n(n.slice(),{unique:!0}):(0,tn.h)(\"function\"==typeof n.getArray,43):n=new $n(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(Vt),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(Ft(e,qn,this.handleLayersAdd_,this),Ft(e,Qn,this.handleLayersRemove_,this));for(const e in this.listenerKeys_)this.listenerKeys_[e].forEach(Vt);ht(this.listenerKeys_);const t=e.getArray();for(let e=0,n=t.length;e<n;e++){const n=t[e];this.registerLayerListeners_(n),this.dispatchEvent(new ii(\"addlayer\",n))}this.changed()}registerLayerListeners_(e){const t=[Ft(e,cn,this.handleLayerChange_,this),Ft(e,Xe,this.handleLayerChange_,this)];e instanceof ai&&t.push(Ft(e,\"addlayer\",this.handleLayerGroupAdd_,this),Ft(e,\"removelayer\",this.handleLayerGroupRemove_,this)),this.listenerKeys_[bt(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new ii(\"addlayer\",e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new ii(\"removelayer\",e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new ii(\"addlayer\",t)),this.changed()}handleLayersRemove_(e){const t=e.element,n=bt(t);this.listenerKeys_[n].forEach(Vt),delete this.listenerKeys_[n],this.dispatchEvent(new ii(\"removelayer\",t)),this.changed()}getLayers(){return this.get(oi)}setLayers(e){const t=this.getLayers();if(t){const e=t.getArray();for(let t=0,n=e.length;t<n;++t)this.dispatchEvent(new ii(\"removelayer\",e[t]))}this.set(oi,e)}getLayersArray(e){return e=void 0!==e?e:[],this.getLayers().forEach((function(t){t.getLayersArray(e)})),e}getLayerStatesArray(e){const t=void 0!==e?e:[],n=t.length;this.getLayers().forEach((function(e){e.getLayerStatesArray(t)}));const r=this.getLayerState();let i=r.zIndex;e||void 0!==r.zIndex||(i=0);for(let e=n,o=t.length;e<o;e++){const n=t[e];n.opacity*=r.opacity,n.visible=n.visible&&r.visible,n.maxResolution=Math.min(n.maxResolution,r.maxResolution),n.minResolution=Math.max(n.minResolution,r.minResolution),n.minZoom=Math.max(n.minZoom,r.minZoom),n.maxZoom=Math.min(n.maxZoom,r.maxZoom),void 0!==r.extent&&(void 0!==n.extent?n.extent=(0,Gt.Ed)(n.extent,r.extent):n.extent=r.extent),void 0===n.zIndex&&(n.zIndex=i)}return t}getSourceState(){return\"ready\"}}const si=ai,li=class extends ot{constructor(e,t,n){super(e),this.map=t,this.frameState=void 0!==n?n:null}},ci=class extends li{constructor(e,t,n,r,i,o){super(e,t,i),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=void 0!==r&&r,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),\"preventDefault\"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),\"stopPropagation\"in this.originalEvent&&this.originalEvent.stopPropagation()}},ui={SINGLECLICK:\"singleclick\",CLICK:$e,DBLCLICK:\"dblclick\",POINTERDRAG:\"pointerdrag\",POINTERMOVE:\"pointermove\",POINTERDOWN:\"pointerdown\",POINTERUP:\"pointerup\",POINTEROVER:\"pointerover\",POINTEROUT:\"pointerout\",POINTERENTER:\"pointerenter\",POINTERLEAVE:\"pointerleave\",POINTERCANCEL:\"pointercancel\"},di=\"pointerdown\",pi=class extends gt{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=void 0===t?1:t,this.down_=null;const n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=Ft(n,di,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=Ft(n,\"pointermove\",this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(nt,this.boundHandleTouchMove_,!!Nt&&{passive:!1})}emulateClick_(e){let t=new ci(ui.CLICK,this.map_,e);this.dispatchEvent(t),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new ci(ui.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout((()=>{this.clickTimeoutId_=void 0;const t=new ci(ui.SINGLECLICK,this.map_,e);this.dispatchEvent(t)}),250)}updateActivePointers_(e){const t=e,n=t.pointerId;if(t.type==ui.POINTERUP||t.type==ui.POINTERCANCEL){delete this.trackedTouches_[n];for(const e in this.trackedTouches_)if(this.trackedTouches_[e].target!==t.target){delete this.trackedTouches_[e];break}}else t.type!=ui.POINTERDOWN&&t.type!=ui.POINTERMOVE||(this.trackedTouches_[n]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new ci(ui.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),0===this.activePointers_.length&&(this.dragListenerKeys_.forEach(Vt),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return 0===e.button}handlePointerDown_(e){this.emulateClicks_=0===this.activePointers_.length,this.updateActivePointers_(e);const t=new ci(ui.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.down_={};for(const t in e){const n=e[t];this.down_[t]=\"function\"==typeof n?ft:n}if(0===this.dragListenerKeys_.length){const e=this.map_.getOwnerDocument();this.dragListenerKeys_.push(Ft(e,ui.POINTERMOVE,this.handlePointerMove_,this),Ft(e,ui.POINTERUP,this.handlePointerUp_,this),Ft(this.element_,ui.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==e&&this.dragListenerKeys_.push(Ft(this.element_.getRootNode(),ui.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new ci(ui.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!(!this.down_||!this.isMoving_(e));this.dispatchEvent(new ci(ui.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;t&&!t.defaultPrevented||\"boolean\"==typeof e.cancelable&&!0!==e.cancelable||e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(Vt(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(nt,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(Vt(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(Vt),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}},fi=\"postrender\",hi=\"loadstart\",mi=\"loadend\",gi=\"layergroup\",vi=\"size\",yi=\"target\",bi=\"view\",Si=1/0,xi=class{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,ht(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,n=e[0];1==e.length?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const r=this.keyFunction_(n);return delete this.queuedElements_[r],n}enqueue(e){(0,tn.h)(!(this.keyFunction_(e)in this.queuedElements_),31);const t=this.priorityFunction_(e);return t!=Si&&(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0)}getCount(){return this.elements_.length}getLeftChildIndex_(e){return 2*e+1}getRightChildIndex_(e){return 2*e+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return 0===this.elements_.length}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,n=this.priorities_,r=t.length,i=t[e],o=n[e],a=e;for(;e<r>>1;){const i=this.getLeftChildIndex_(e),o=this.getRightChildIndex_(e),a=o<r&&n[o]<n[i]?o:i;t[e]=t[a],n[e]=n[a],e=a}t[e]=i,n[e]=o,this.siftDown_(a,e)}siftDown_(e,t){const n=this.elements_,r=this.priorities_,i=n[t],o=r[t];for(;t>e;){const e=this.getParentIndex_(t);if(!(r[e]>o))break;n[t]=n[e],r[t]=r[e],t=e}n[t]=i,r[t]=o}reprioritize(){const e=this.priorityFunction_,t=this.elements_,n=this.priorities_;let r=0;const i=t.length;let o,a,s;for(a=0;a<i;++a)o=t[a],s=e(o),s==Si?delete this.queuedElements_[this.keyFunction_(o)]:(n[r]=s,t[r++]=o);t.length=r,n.length=r,this.heapify_()}},wi=class extends xi{constructor(e,t){super((function(t){return e.apply(null,t)}),(function(e){return e[0].getKey()})),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(Xe,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,n=t.getState();if(2===n||3===n||4===n){3!==n&&t.removeEventListener(Xe,this.boundHandleTileChange_);const e=t.getKey();e in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[e],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let n,r,i,o=0;for(;this.tilesLoading_<e&&o<t&&this.getCount()>0;)r=this.dequeue()[0],i=r.getKey(),n=r.getState(),0!==n||i in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[i]=!0,++this.tilesLoading_,++o,r.load())}},Ci={CENTER:\"center\",RESOLUTION:\"resolution\",ROTATION:\"rotation\"};function Ti(e,t,n){return function(r,i,o,a,s){if(!r)return;if(!i&&!t)return r;const l=t?0:o[0]*i,c=t?0:o[1]*i,u=s?s[0]:0,d=s?s[1]:0;let p=e[0]+l/2+u,f=e[2]-l/2+u,h=e[1]+c/2+d,m=e[3]-c/2+d;p>f&&(p=(f+p)/2,f=p),h>m&&(h=(m+h)/2,m=h);let g=(0,Wt.uZ)(r[0],p,f),v=(0,Wt.uZ)(r[1],h,m);if(a&&n&&i){const e=30*i;g+=-e*Math.log(1+Math.max(0,p-r[0])/e)+e*Math.log(1+Math.max(0,r[0]-f)/e),v+=-e*Math.log(1+Math.max(0,h-r[1])/e)+e*Math.log(1+Math.max(0,r[1]-m)/e)}return[g,v]}}function Ai(e){return e}function Ei(e,t,n,r){const i=(0,Gt.dz)(t)/n[0],o=(0,Gt.Cr)(t)/n[1];return r?Math.min(e,Math.max(i,o)):Math.min(e,Math.min(i,o))}function Oi(e,t,n){let r=Math.min(e,t);return r*=Math.log(1+50*Math.max(0,e/t-1))/50+1,n&&(r=Math.max(r,n),r/=Math.log(1+50*Math.max(0,n/e-1))/50+1),(0,Wt.uZ)(r,n/2,2*t)}function Mi(e,t,n,r,i){return n=void 0===n||n,function(o,a,s,l){if(void 0!==o){const a=r?Ei(e,r,s,i):e;return n&&l?Oi(o,a,t):(0,Wt.uZ)(o,t,a)}}}function Pi(e){if(void 0!==e)return 0}function Di(e){if(void 0!==e)return e}function Ii(e,t,n,r,i,o){o=o||[];let a=0;for(let s=t;s<n;s+=r){const t=e[s],n=e[s+1];o[a++]=i[0]*t+i[2]*n+i[4],o[a++]=i[1]*t+i[3]*n+i[5]}return o&&o.length!=a&&(o.length=a),o}function Ni(e,t,n,r,i,o,a){a=a||[];const s=Math.cos(i),l=Math.sin(i),c=o[0],u=o[1];let d=0;for(let i=t;i<n;i+=r){const t=e[i]-c,n=e[i+1]-u;a[d++]=c+t*s-n*l,a[d++]=u+t*l+n*s;for(let t=i+2;t<i+r;++t)a[d++]=e[t]}return a&&a.length!=d&&(a.length=d),a}function _i(e,t,n,r,i,o,a){a=a||[];let s=0;for(let l=t;l<n;l+=r){a[s++]=e[l]+i,a[s++]=e[l+1]+o;for(let t=l+2;t<l+r;++t)a[s++]=e[t]}return a&&a.length!=s&&(a.length=s),a}const ji=[1,0,0,1,0,0],ki=class extends fn{constructor(){super(),this.extent_=(0,Gt.lJ)(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=function(e){let t,n,r,i=!1;return function(){const o=Array.prototype.slice.call(arguments);return i&&this===r&&ut(o,n)||(i=!0,r=this,n=o,t=e.apply(this,arguments)),t}}((function(e,t,n){if(!n)return this.getSimplifiedGeometry(t);const r=this.clone();return r.applyTransform(n),r.getSimplifiedGeometry(t)}))}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return vt()}closestPointXY(e,t,n,r){return vt()}containsXY(e,t){const n=this.getClosestPoint([e,t]);return n[0]===e&&n[1]===t}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return vt()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&(0,Gt.YN)(e),this.extentRevision_=this.getRevision()}return(0,Gt.EO)(this.extent_,e)}rotate(e,t){vt()}scale(e,t,n){vt()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return vt()}getType(){return vt()}applyTransform(e){vt()}intersectsExtent(e){return vt()}translate(e,t){vt()}transform(e,t){const n=(0,Yt.U2)(e),r=\"tile-pixels\"==n.getUnits()?function(e,r,i){const o=n.getExtent(),a=n.getWorldExtent(),s=(0,Gt.Cr)(a)/(0,Gt.Cr)(o);return tr(ji,a[0],a[3],s,-s,0,0,0),Ii(e,0,e.length,i,ji,r),(0,Yt.Ck)(n,t)(e,r,i)}:(0,Yt.Ck)(n,t);return this.applyTransform(r),this}};function Li(e){let t;return\"XY\"==e?t=2:\"XYZ\"==e||\"XYM\"==e?t=3:\"XYZM\"==e&&(t=4),t}const Ri=class extends ki{constructor(){super(),this.layout=\"XY\",this.stride=2,this.flatCoordinates=null}computeExtent(e){return(0,Gt.GN)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return vt()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=Li(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){vt()}setLayout(e,t,n){let r;if(e)r=Li(e);else{for(let e=0;e<n;++e){if(0===t.length)return this.layout=\"XY\",void(this.stride=2);t=t[0]}r=t.length,e=function(e){let t;return 2==e?t=\"XY\":3==e?t=\"XYZ\":4==e&&(t=\"XYZM\"),t}(r)}this.layout=e,this.stride=r}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(e,t){const n=this.getFlatCoordinates();if(n){const r=this.getStride();Ni(n,0,n.length,r,e,t,n),this.changed()}}scale(e,t,n){void 0===t&&(t=e),n||(n=(0,Gt.qg)(this.getExtent()));const r=this.getFlatCoordinates();if(r){const i=this.getStride();!function(e,t,n,r,i,o,a,s){s=s||[];const l=a[0],c=a[1];let u=0;for(let t=0;t<n;t+=r){const n=e[t]-l,a=e[t+1]-c;s[u++]=l+i*n,s[u++]=c+o*a;for(let n=t+2;n<t+r;++n)s[u++]=e[n]}s&&s.length!=u&&(s.length=u)}(r,0,r.length,i,e,t,n,r),this.changed()}}translate(e,t){const n=this.getFlatCoordinates();if(n){const r=this.getStride();_i(n,0,n.length,r,e,t,n),this.changed()}}};function Zi(e,t,n,r,i,o,a){const s=e[t],l=e[t+1],c=e[n]-s,u=e[n+1]-l;let d;if(0===c&&0===u)d=t;else{const p=((i-s)*c+(o-l)*u)/(c*c+u*u);if(p>1)d=n;else{if(p>0){for(let i=0;i<r;++i)a[i]=(0,Wt.t7)(e[t+i],e[n+i],p);return void(a.length=r)}d=t}}for(let t=0;t<r;++t)a[t]=e[d+t];a.length=r}function Bi(e,t,n,r,i){let o=e[t],a=e[t+1];for(t+=r;t<n;t+=r){const n=e[t],r=e[t+1],s=(0,Wt.bI)(o,a,n,r);s>i&&(i=s),o=n,a=r}return i}function Fi(e,t,n,r,i){for(let o=0,a=n.length;o<a;++o){const a=n[o];i=Bi(e,t,a,r,i),t=a}return i}function zi(e,t,n,r,i,o,a,s,l,c,u){if(t==n)return c;let d,p;if(0===i){if(p=(0,Wt.bI)(a,s,e[t],e[t+1]),p<c){for(d=0;d<r;++d)l[d]=e[t+d];return l.length=r,p}return c}u=u||[NaN,NaN];let f=t+r;for(;f<n;)if(Zi(e,f-r,f,r,a,s,u),p=(0,Wt.bI)(a,s,u[0],u[1]),p<c){for(c=p,d=0;d<r;++d)l[d]=u[d];l.length=r,f+=r}else f+=r*Math.max((Math.sqrt(p)-Math.sqrt(c))/i|0,1);if(o&&(Zi(e,n-r,t,r,a,s,u),p=(0,Wt.bI)(a,s,u[0],u[1]),p<c)){for(c=p,d=0;d<r;++d)l[d]=u[d];l.length=r}return c}function Vi(e,t,n,r,i,o,a,s,l,c,u){u=u||[NaN,NaN];for(let d=0,p=n.length;d<p;++d){const p=n[d];c=zi(e,t,p,r,i,o,a,s,l,c,u),t=p}return c}function Hi(e,t,n,r){for(let r=0,i=n.length;r<i;++r)e[t++]=n[r];return t}function Ui(e,t,n,r){for(let i=0,o=n.length;i<o;++i){const o=n[i];for(let n=0;n<r;++n)e[t++]=o[n]}return t}function Gi(e,t,n,r,i){i=i||[];let o=0;for(let a=0,s=n.length;a<s;++a){const s=Ui(e,t,n[a],r);i[o++]=s,t=s}return i.length=o,i}function Yi(e,t,n,r,i,o,a){const s=(n-t)/r;if(s<3){for(;t<n;t+=r)o[a++]=e[t],o[a++]=e[t+1];return a}const l=new Array(s);l[0]=1,l[s-1]=1;const c=[t,n-r];let u=0;for(;c.length>0;){const n=c.pop(),o=c.pop();let a=0;const s=e[o],d=e[o+1],p=e[n],f=e[n+1];for(let t=o+r;t<n;t+=r){const n=e[t],r=e[t+1],i=(0,Wt.rU)(n,r,s,d,p,f);i>a&&(u=t,a=i)}a>i&&(l[(u-t)/r]=1,o+r<u&&c.push(o,u),u+r<n&&c.push(u,n))}for(let n=0;n<s;++n)l[n]&&(o[a++]=e[t+n*r],o[a++]=e[t+n*r+1]);return a}function Wi(e,t){return t*Math.round(e/t)}function Ki(e,t,n,r,i,o,a){if(t==n)return a;let s,l,c=Wi(e[t],i),u=Wi(e[t+1],i);t+=r,o[a++]=c,o[a++]=u;do{if(s=Wi(e[t],i),l=Wi(e[t+1],i),(t+=r)==n)return o[a++]=s,o[a++]=l,a}while(s==c&&l==u);for(;t<n;){const n=Wi(e[t],i),d=Wi(e[t+1],i);if(t+=r,n==s&&d==l)continue;const p=s-c,f=l-u,h=n-c,m=d-u;p*m==f*h&&(p<0&&h<p||p==h||p>0&&h>p)&&(f<0&&m<f||f==m||f>0&&m>f)?(s=n,l=d):(o[a++]=s,o[a++]=l,c=s,u=l,s=n,l=d)}return o[a++]=s,o[a++]=l,a}function qi(e,t,n,r,i,o,a,s){for(let l=0,c=n.length;l<c;++l){const c=n[l];a=Ki(e,t,c,r,i,o,a),s.push(a),t=c}return a}function Qi(e,t,n,r,i){i=void 0!==i?i:[];let o=0;for(let a=t;a<n;a+=r)i[o++]=e.slice(a,a+r);return i.length=o,i}function Xi(e,t,n,r,i){i=void 0!==i?i:[];let o=0;for(let a=0,s=n.length;a<s;++a){const s=n[a];i[o++]=Qi(e,t,s,r,i[o]),t=s}return i.length=o,i}function Ji(e,t,n,r,i){i=void 0!==i?i:[];let o=0;for(let a=0,s=n.length;a<s;++a){const s=n[a];i[o++]=1===s.length&&s[0]===t?[]:Xi(e,t,s,r,i[o]),t=s[s.length-1]}return i.length=o,i}function $i(e,t,n,r){let i=0,o=e[n-r],a=e[n-r+1];for(;t<n;t+=r){const n=e[t],r=e[t+1];i+=a*n-o*r,o=n,a=r}return i/2}function eo(e,t,n,r){let i=0;for(let o=0,a=n.length;o<a;++o){const a=n[o];i+=$i(e,t,a,r),t=a}return i}class to extends Ri{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===t||Array.isArray(e[0])?this.setCoordinates(e,t):this.setFlatCoordinates(t,e)}clone(){return new to(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,n,r){return r<(0,Gt.qf)(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Bi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),zi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,n,r))}getArea(){return $i(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Qi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=Yi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new to(t,\"XY\")}getType(){return\"LinearRing\"}intersectsExtent(e){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ui(this.flatCoordinates,0,e,this.stride),this.changed()}}const no=to;class ro extends Ri{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new ro(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,r){const i=this.flatCoordinates,o=(0,Wt.bI)(e,t,i[0],i[1]);if(o<r){const e=this.stride;for(let t=0;t<e;++t)n[t]=i[t];return n.length=e,o}return r}getCoordinates(){return this.flatCoordinates?this.flatCoordinates.slice():[]}computeExtent(e){return(0,Gt.HK)(this.flatCoordinates,e)}getType(){return\"Point\"}intersectsExtent(e){return(0,Gt.jE)(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Hi(this.flatCoordinates,0,e,this.stride),this.changed()}}const io=ro;function oo(e,t,n,r,i,o,a){let s,l,c,u,d,p,f;const h=i[o+1],m=[];for(let i=0,o=n.length;i<o;++i){const o=n[i];for(u=e[o-r],p=e[o-r+1],s=t;s<o;s+=r)d=e[s],f=e[s+1],(h<=p&&f<=h||p<=h&&h<=f)&&(c=(h-p)/(f-p)*(d-u)+u,m.push(c)),u=d,p=f}let g=NaN,v=-1/0;for(m.sort(at),u=m[0],s=1,l=m.length;s<l;++s){d=m[s];const i=Math.abs(d-u);i>v&&(c=(u+d)/2,wn(e,t,n,r,c,h)&&(g=c,v=i)),u=d}return isNaN(g)&&(g=i[o]),a?(a.push(g,h,v),a):[g,h,v]}function ao(e,t,n,r){for(;t<n-r;){for(let i=0;i<r;++i){const o=e[t+i];e[t+i]=e[n-r+i],e[n-r+i]=o}t+=r,n-=r}}function so(e,t,n,r){let i=0,o=e[n-r],a=e[n-r+1];for(;t<n;t+=r){const n=e[t],r=e[t+1];i+=(n-o)*(r+a),o=n,a=r}return 0===i?void 0:i>0}function lo(e,t,n,r,i){i=void 0!==i&&i;for(let o=0,a=n.length;o<a;++o){const a=n[o],s=so(e,t,a,r);if(0===o){if(i&&s||!i&&!s)return!1}else if(i&&!s||!i&&s)return!1;t=a}return!0}function co(e,t,n,r,i){i=void 0!==i&&i;for(let o=0,a=n.length;o<a;++o){const a=n[o],s=so(e,t,a,r);(0===o?i&&s||!i&&!s:i&&!s||!i&&s)&&ao(e,t,a,r),t=a}return t}function uo(e,t,n,r,i){for(let o=0,a=n.length;o<a;++o)t=co(e,t,n[o],r,i);return t}class po extends Ri{constructor(e,t,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,void 0!==t&&n?(this.setFlatCoordinates(t,e),this.ends_=n):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?ct(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new po(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,n,r){return r<(0,Gt.qf)(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Fi(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Vi(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,n,r))}containsXY(e,t){return wn(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return eo(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return void 0!==e?(t=this.getOrientedFlatCoordinates().slice(),co(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,Xi(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=(0,Gt.qg)(this.getExtent());this.flatInteriorPoint_=oo(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new io(this.getFlatInteriorPoint(),\"XYM\")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new no(this.flatCoordinates.slice(0===e?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,t=this.flatCoordinates,n=this.ends_,r=[];let i=0;for(let o=0,a=n.length;o<a;++o){const a=n[o],s=new no(t.slice(i,a),e);r.push(s),i=a}return r}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;lo(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=co(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],n=[];return t.length=qi(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,n),new po(t,\"XY\",n)}getType(){return\"Polygon\"}intersectsExtent(e){return An(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=Gi(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=0===n.length?0:n[n.length-1],this.changed()}}const fo=po;function ho(e){const t=e[0],n=e[1],r=e[2],i=e[3],o=[t,n,t,i,r,i,r,n,t,n];return new po(o,\"XY\",[o.length])}function mo(e,t,n){t=t||32;const r=e.getStride(),i=e.getLayout(),o=e.getCenter(),a=r*(t+1),s=new Array(a);for(let e=0;e<a;e+=r){s[e]=0,s[e+1]=0;for(let t=2;t<r;t++)s[e+t]=o[t]}const l=[s.length],c=new po(s,i,l);return function(e,t,n,r){const i=e.getFlatCoordinates(),o=e.getStride(),a=i.length/o-1,s=r||0;for(let e=0;e<=a;++e){const r=e*o,l=s+2*(0,Wt.$W)(e,a)*Math.PI/a;i[r]=t[0]+n*Math.cos(l),i[r+1]=t[1]+n*Math.sin(l)}e.changed()}(c,o,e.getRadius(),n),c}function go(e,t){setTimeout((function(){e(t)}),0)}function vo(e){return!(e.sourceCenter&&e.targetCenter&&!(0,Mr.fS)(e.sourceCenter,e.targetCenter))&&e.sourceResolution===e.targetResolution&&e.sourceRotation===e.targetRotation}function yo(e,t,n,r,i){const o=Math.cos(-i);let a=Math.sin(-i),s=e[0]*o-e[1]*a,l=e[1]*o+e[0]*a;return s+=(t[0]/2-n[0])*r,l+=(n[1]-t[1]/2)*r,a=-a,[s*o-l*a,l*o+s*a]}const bo=class extends fn{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=(0,Yt.UQ)(e.projection,\"EPSG:3857\"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&(0,Yt.h_)(),e.center&&(e.center=(0,Yt.Vs)(e.center,this.projection_)),e.extent&&(e.extent=(0,Yt.dY)(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const e in Ci)delete t[e];this.setProperties(t,!0);const n=function(e){let t,n,r;let i=void 0!==e.minZoom?e.minZoom:0,o=void 0!==e.maxZoom?e.maxZoom:28;const a=void 0!==e.zoomFactor?e.zoomFactor:2,s=void 0!==e.multiWorld&&e.multiWorld,l=void 0===e.smoothResolutionConstraint||e.smoothResolutionConstraint,c=void 0!==e.showFullExtent&&e.showFullExtent,u=(0,Yt.UQ)(e.projection,\"EPSG:3857\"),d=u.getExtent();let p=e.constrainOnlyCenter,f=e.extent;if(s||f||!u.isGlobal()||(p=!1,f=d),void 0!==e.resolutions){const a=e.resolutions;n=a[i],r=void 0!==a[o]?a[o]:a[a.length-1],t=e.constrainResolution?function(e,t,n,r){return t=void 0===t||t,function(i,o,a,s){if(void 0!==i){const l=e[0],c=e[e.length-1],u=n?Ei(l,n,a,r):l;if(s)return t?Oi(i,u,c):(0,Wt.uZ)(i,c,u);const d=Math.min(u,i),p=Math.floor(st(e,d,o));return e[p]>u&&p<e.length-1?e[p+1]:e[p]}}}(a,l,!p&&f,c):Mi(n,r,l,!p&&f,c)}else{const s=(d?Math.max((0,Gt.dz)(d),(0,Gt.Cr)(d)):360*Yt.Wm.degrees/u.getMetersPerUnit())/256/Math.pow(2,0),h=s/Math.pow(2,28);n=e.maxResolution,void 0!==n?i=0:n=s/Math.pow(a,i),r=e.minResolution,void 0===r&&(r=void 0!==e.maxZoom?void 0!==e.maxResolution?n/Math.pow(a,o):s/Math.pow(a,o):h),o=i+Math.floor(Math.log(n/r)/Math.log(a)),r=n/Math.pow(a,o-i),t=e.constrainResolution?function(e,t,n,r,i,o){return r=void 0===r||r,n=void 0!==n?n:0,function(a,s,l,c){if(void 0!==a){const u=i?Ei(t,i,l,o):t;if(c)return r?Oi(a,u,n):(0,Wt.uZ)(a,n,u);const d=1e-9,p=Math.ceil(Math.log(t/u)/Math.log(e)-d),f=-s*(.5-d)+.5,h=Math.min(u,a),m=Math.floor(Math.log(t/h)/Math.log(e)+f),g=Math.max(p,m),v=t/Math.pow(e,g);return(0,Wt.uZ)(v,n,u)}}}(a,n,r,l,!p&&f,c):Mi(n,r,l,!p&&f,c)}return{constraint:t,maxResolution:n,minResolution:r,minZoom:i,zoomFactor:a}}(e);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=n.minZoom;const r=function(e){if(void 0!==e.extent){const t=void 0===e.smoothExtentConstraint||e.smoothExtentConstraint;return Ti(e.extent,e.constrainOnlyCenter,t)}const t=(0,Yt.UQ)(e.projection,\"EPSG:3857\");if(!0!==e.multiWorld&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,Ti(e,!1,!1)}return Ai}(e),i=n.constraint,o=function(e){if(void 0===e.enableRotation||e.enableRotation){const n=e.constrainRotation;return void 0===n||!0===n?(t=t||(0,Wt.Yr)(5),function(e,n){return n?e:void 0!==e?Math.abs(e)<=t?0:e:void 0}):!1===n?Di:\"number\"==typeof n?function(e){const t=2*Math.PI/e;return function(e,n){return n?e:void 0!==e?e=Math.floor(e/t+.5)*t:void 0}}(n):Di}var t;return Pi}(e);this.constraints_={center:r,resolution:i,rotation:o},this.setRotation(void 0!==e.rotation?e.rotation:0),this.setCenterInternal(void 0!==e.center?e.center:null),void 0!==e.resolution?this.setResolution(e.resolution):void 0!==e.zoom&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const n=this.getCenter();if(n){const r=e||[0,0,0,0];t=t||[0,0,0,0];const i=this.getResolution(),o=i/2*(r[3]-t[3]+t[1]-r[1]),a=i/2*(r[0]-t[0]+t[2]-r[2]);this.setCenterInternal([n[0]+o,n[1]-a])}}getUpdatedOptions_(e){const t=this.getProperties();return void 0!==t.resolution?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let e=0;e<t.length;++e){let n=arguments[e];n.center&&(n=Object.assign({},n),n.center=(0,Yt.Vs)(n.center,this.getProjection())),n.anchor&&(n=Object.assign({},n),n.anchor=(0,Yt.Vs)(n.anchor,this.getProjection())),t[e]=n}this.animateInternal.apply(this,t)}animateInternal(e){let t,n=arguments.length;n>1&&\"function\"==typeof arguments[n-1]&&(t=arguments[n-1],--n);let r=0;for(;r<n&&!this.isDef();++r){const e=arguments[r];e.center&&this.setCenterInternal(e.center),void 0!==e.zoom?this.setZoom(e.zoom):e.resolution&&this.setResolution(e.resolution),void 0!==e.rotation&&this.setRotation(e.rotation)}if(r===n)return void(t&&go(t,!0));let i=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,s=this.targetRotation_;const l=[];for(;r<n;++r){const e=arguments[r],n={start:i,complete:!1,anchor:e.anchor,duration:void 0!==e.duration?e.duration:1e3,easing:e.easing||wt,callback:t};if(e.center&&(n.sourceCenter=o,n.targetCenter=e.center.slice(),o=n.targetCenter),void 0!==e.zoom?(n.sourceResolution=a,n.targetResolution=this.getResolutionForZoom(e.zoom),a=n.targetResolution):e.resolution&&(n.sourceResolution=a,n.targetResolution=e.resolution,a=n.targetResolution),void 0!==e.rotation){n.sourceRotation=s;const t=(0,Wt.$W)(e.rotation-s+Math.PI,2*Math.PI)-Math.PI;n.targetRotation=s+t,s=n.targetRotation}vo(n)?n.complete=!0:i+=n.duration,l.push(n)}this.animations_.push(l),this.setHint(0,1),this.updateAnimations_()}getAnimating(){return this.hints_[0]>0}getInteracting(){return this.hints_[1]>0}cancelAnimations(){let e;this.setHint(0,-this.hints_[0]);for(let t=0,n=this.animations_.length;t<n;++t){const n=this.animations_[t];if(n[0].callback&&go(n[0].callback,!1),!e)for(let t=0,r=n.length;t<r;++t){const r=n[t];if(!r.complete){e=r.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let n=this.animations_.length-1;n>=0;--n){const r=this.animations_[n];let i=!0;for(let n=0,o=r.length;n<o;++n){const o=r[n];if(o.complete)continue;const a=e-o.start;let s=o.duration>0?a/o.duration:1;s>=1?(o.complete=!0,s=1):i=!1;const l=o.easing(s);if(o.sourceCenter){const e=o.sourceCenter[0],t=o.sourceCenter[1],n=o.targetCenter[0],r=o.targetCenter[1];this.nextCenter_=o.targetCenter;const i=e+l*(n-e),a=t+l*(r-t);this.targetCenter_=[i,a]}if(o.sourceResolution&&o.targetResolution){const e=1===l?o.targetResolution:o.sourceResolution+l*(o.targetResolution-o.sourceResolution);if(o.anchor){const t=this.getViewportSize_(this.getRotation()),n=this.constraints_.resolution(e,0,t,!0);this.targetCenter_=this.calculateCenterZoom(n,o.anchor)}this.nextResolution_=o.targetResolution,this.targetResolution_=e,this.applyTargetState_(!0)}if(void 0!==o.sourceRotation&&void 0!==o.targetRotation){const e=1===l?(0,Wt.$W)(o.targetRotation+Math.PI,2*Math.PI)-Math.PI:o.sourceRotation+l*(o.targetRotation-o.sourceRotation);if(o.anchor){const t=this.constraints_.rotation(e,!0);this.targetCenter_=this.calculateCenterRotate(t,o.anchor)}this.nextRotation_=o.targetRotation,this.targetRotation_=e}if(this.applyTargetState_(!0),t=!0,!o.complete)break}if(i){this.animations_[n]=null,this.setHint(0,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const e=r[0].callback;e&&go(e,!0)}}this.animations_=this.animations_.filter(Boolean),t&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let n;const r=this.getCenterInternal();return void 0!==r&&(n=[r[0]-t[0],r[1]-t[1]],(0,Mr.U1)(n,e-this.getRotation()),(0,Mr.IH)(n,t)),n}calculateCenterZoom(e,t){let n;const r=this.getCenterInternal(),i=this.getResolution();return void 0!==r&&void 0!==i&&(n=[t[0]-e*(t[0]-r[0])/i,t[1]-e*(t[1]-r[1])/i]),n}getViewportSize_(e){const t=this.viewportSize_;if(e){const n=t[0],r=t[1];return[Math.abs(n*Math.cos(e))+Math.abs(r*Math.sin(e)),Math.abs(n*Math.sin(e))+Math.abs(r*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e?(0,Yt.lO)(e,this.getProjection()):e}getCenterInternal(){return this.get(Ci.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get(\"constrainResolution\")}getHints(e){return void 0!==e?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return(0,Yt.Fj)(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();(0,tn.h)(t,1);const n=this.getResolution();(0,tn.h)(void 0!==n,2);const r=this.getRotation();return(0,tn.h)(void 0!==r,3),(0,Gt.p8)(t,n,r,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(Ci.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal((0,Yt.dY)(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const n=(0,Gt.dz)(e)/t[0],r=(0,Gt.Cr)(e)/t[1];return Math.max(n,r)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,r=Math.log(t/n)/Math.log(e);return function(n){return t/Math.pow(e,n*r)}}getRotation(){return this.get(Ci.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),n=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,i=Math.log(n/r)/t;return function(e){return Math.log(n/e)/t/i}}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const n=this.padding_;return n&&(t=[t[0]-n[1]-n[3],t[1]-n[0]-n[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),n=this.getRotation();let r=this.getCenterInternal();const i=this.padding_;if(i){const e=this.getViewportSizeMinusPadding_();r=yo(r,this.getViewportSize_(),[e[0]/2+i[3],e[1]/2+i[0]],t,n)}return{center:r.slice(0),projection:void 0!==e?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getZoom(){let e;const t=this.getResolution();return void 0!==t&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t,n,r=this.minZoom_||0;if(this.resolutions_){const i=st(this.resolutions_,e,1);r=i,t=this.resolutions_[i],n=i==this.resolutions_.length-1?2:t/this.resolutions_[i+1]}else t=this.maxResolution_,n=this.zoomFactor_;return r+Math.log(t/e)/Math.log(n)}getResolutionForZoom(e){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const t=(0,Wt.uZ)(Math.floor(e),0,this.resolutions_.length-2),n=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(n,(0,Wt.uZ)(e-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let n;if((0,tn.h)(Array.isArray(e)||\"function\"==typeof e.getSimplifiedGeometry,24),Array.isArray(e))(0,tn.h)(!(0,Gt.xb)(e),25),n=ho((0,Yt.dY)(e,this.getProjection()));else if(\"Circle\"===e.getType()){const t=(0,Yt.dY)(e.getExtent(),this.getProjection());n=ho(t),n.rotate(this.getRotation(),(0,Gt.qg)(t))}else{const t=(0,Yt.Cs)();n=t?e.clone().transform(t,this.getProjection()):e}this.fitInternal(n,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),n=Math.cos(t),r=Math.sin(-t),i=e.getFlatCoordinates(),o=e.getStride();let a=1/0,s=1/0,l=-1/0,c=-1/0;for(let e=0,t=i.length;e<t;e+=o){const t=i[e]*n-i[e+1]*r,o=i[e]*r+i[e+1]*n;a=Math.min(a,t),s=Math.min(s,o),l=Math.max(l,t),c=Math.max(c,o)}return[a,s,l,c]}fitInternal(e,t){let n=(t=t||{}).size;n||(n=this.getViewportSizeMinusPadding_());const r=void 0!==t.padding?t.padding:[0,0,0,0],i=void 0!==t.nearest&&t.nearest;let o;o=void 0!==t.minResolution?t.minResolution:void 0!==t.maxZoom?this.getResolutionForZoom(t.maxZoom):0;const a=this.rotatedExtentForGeometry(e);let s=this.getResolutionForExtentInternal(a,[n[0]-r[1]-r[3],n[1]-r[0]-r[2]]);s=isNaN(s)?o:Math.max(s,o),s=this.getConstrainedResolution(s,i?0:1);const l=this.getRotation(),c=Math.sin(l),u=Math.cos(l),d=(0,Gt.qg)(a);d[0]+=(r[1]-r[3])/2*s,d[1]+=(r[0]-r[2])/2*s;const p=d[0]*u-d[1]*c,f=d[1]*u+d[0]*c,h=this.getConstrainedCenter([p,f],s),m=t.callback?t.callback:ft;void 0!==t.duration?this.animateInternal({resolution:s,center:h,duration:t.duration,easing:t.easing},m):(this.targetResolution_=s,this.targetCenter_=h,this.applyTargetState_(!1,!0),go(m,!0))}centerOn(e,t,n){this.centerOnInternal((0,Yt.Vs)(e,this.getProjection()),t,n)}centerOnInternal(e,t,n){this.setCenterInternal(yo(e,t,n,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,n,r){let i;const o=this.padding_;if(o&&e){const a=this.getViewportSizeMinusPadding_(-n),s=yo(e,r,[a[0]/2+o[3],a[1]/2+o[0]],t,n);i=[e[0]-s[0],e[1]-s[1]]}return i}isDef(){return!!this.getCenterInternal()&&void 0!==this.getResolution()}adjustCenter(e){const t=(0,Yt.lO)(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&(0,Yt.Vs)(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const n=this.getAnimating()||this.getInteracting(),r=this.getViewportSize_(this.getRotation()),i=this.constraints_.resolution(this.targetResolution_*e,0,r,n);t&&(this.targetCenter_=this.calculateCenterZoom(i,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=(0,Yt.Vs)(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const n=this.getAnimating()||this.getInteracting(),r=this.constraints_.rotation(this.targetRotation_+e,n);t&&(this.targetCenter_=this.calculateCenterRotate(r,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e?(0,Yt.Vs)(e,this.getProjection()):e)}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const n=this.getAnimating()||this.getInteracting()||t,r=this.constraints_.rotation(this.targetRotation_,n),i=this.getViewportSize_(r),o=this.constraints_.resolution(this.targetResolution_,0,i,n),a=this.constraints_.center(this.targetCenter_,o,i,n,this.calculateCenterShift(this.targetCenter_,o,r,i));this.get(Ci.ROTATION)!==r&&this.set(Ci.ROTATION,r),this.get(Ci.RESOLUTION)!==o&&(this.set(Ci.RESOLUTION,o),this.set(\"zoom\",this.getZoom(),!0)),a&&this.get(Ci.CENTER)&&(0,Mr.fS)(this.get(Ci.CENTER),a)||this.set(Ci.CENTER,a),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,n){e=void 0!==e?e:200;const r=t||0,i=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(i),a=this.constraints_.resolution(this.targetResolution_,r,o),s=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,i,o));if(0===e&&!this.cancelAnchor_)return this.targetResolution_=a,this.targetRotation_=i,this.targetCenter_=s,void this.applyTargetState_();n=n||(0===e?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,this.getResolution()===a&&this.getRotation()===i&&this.getCenterInternal()&&(0,Mr.fS)(this.getCenterInternal(),s)||(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:i,center:s,resolution:a,duration:e,easing:xt,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(1,1)}endInteraction(e,t,n){n=n&&(0,Yt.Vs)(n,this.getProjection()),this.endInteractionInternal(e,t,n)}endInteractionInternal(e,t,n){this.setHint(1,-1),this.resolveConstraints(e,t,n)}getConstrainedCenter(e,t){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),n)}getConstrainedZoom(e,t){const n=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(n,t))}getConstrainedResolution(e,t){t=t||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,n)}},So=class extends fn{constructor(e){super();const t=e.element;!t||e.target||t.style.pointerEvents||(t.style.pointerEvents=\"auto\"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){Zt(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&Zt(this.element);for(let e=0,t=this.listenerKeys.length;e<t;++e)Vt(this.listenerKeys[e]);this.listenerKeys.length=0,this.map_=e,e&&((this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==ft&&this.listenerKeys.push(Ft(e,fi,this.render,this)),e.render())}render(e){}setTarget(e){this.target_=\"string\"==typeof e?document.getElementById(e):e}},xo=class extends So{constructor(e){e=e||{},super({element:document.createElement(\"div\"),render:e.render,target:e.target}),this.ulElement_=document.createElement(\"ul\"),this.collapsed_=void 0===e.collapsed||e.collapsed,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=void 0!==e.collapsible,this.collapsible_=void 0===e.collapsible||e.collapsible,this.collapsible_||(this.collapsed_=!1);const t=void 0!==e.className?e.className:\"ol-attribution\",n=void 0!==e.tipLabel?e.tipLabel:\"Attributions\",r=void 0!==e.expandClassName?e.expandClassName:t+\"-expand\",i=void 0!==e.collapseLabel?e.collapseLabel:\"›\",o=void 0!==e.collapseClassName?e.collapseClassName:t+\"-collapse\";\"string\"==typeof i?(this.collapseLabel_=document.createElement(\"span\"),this.collapseLabel_.textContent=i,this.collapseLabel_.className=o):this.collapseLabel_=i;const a=void 0!==e.label?e.label:\"i\";\"string\"==typeof a?(this.label_=document.createElement(\"span\"),this.label_.textContent=a,this.label_.className=r):this.label_=a;const s=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement(\"button\"),this.toggleButton_.setAttribute(\"type\",\"button\"),this.toggleButton_.setAttribute(\"aria-expanded\",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(s),this.toggleButton_.addEventListener($e,this.handleClick_.bind(this),!1);const l=t+\" \"+_r+\" \"+jr+(this.collapsed_&&this.collapsible_?\" \"+kr:\"\")+(this.collapsible_?\"\":\" ol-uncollapsible\"),c=this.element;c.className=l,c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t={},n=[];let r=!0;const i=e.layerStatesArray;for(let o=0,a=i.length;o<a;++o){const a=i[o];if(!Er(a,e.viewState))continue;const s=a.layer.getSource();if(!s)continue;const l=s.getAttributions();if(!l)continue;const c=l(e);if(c)if(r=r&&!1!==s.getAttributionsCollapsible(),Array.isArray(c))for(let e=0,r=c.length;e<r;++e)c[e]in t||(n.push(c[e]),t[c[e]]=!0);else c in t||(n.push(c),t[c]=!0)}return this.overrideCollapsible_||this.setCollapsible(r),n}updateElement_(e){if(!e)return void(this.renderedVisible_&&(this.element.style.display=\"none\",this.renderedVisible_=!1));const t=this.collectSourceAttributions_(e),n=t.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?\"\":\"none\",this.renderedVisible_=n),!ut(t,this.renderedAttributions_)){Bt(this.ulElement_);for(let e=0,n=t.length;e<n;++e){const n=document.createElement(\"li\");n.innerHTML=t[e],this.ulElement_.appendChild(n)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(kr),this.collapsed_?Rt(this.collapseLabel_,this.label_):Rt(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute(\"aria-expanded\",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle(\"ol-uncollapsible\"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}},wo=class extends So{constructor(e){e=e||{},super({element:document.createElement(\"div\"),render:e.render,target:e.target});const t=void 0!==e.className?e.className:\"ol-rotate\",n=void 0!==e.label?e.label:\"⇧\",r=void 0!==e.compassClassName?e.compassClassName:\"ol-compass\";this.label_=null,\"string\"==typeof n?(this.label_=document.createElement(\"span\"),this.label_.className=r,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(r));const i=e.tipLabel?e.tipLabel:\"Reset rotation\",o=document.createElement(\"button\");o.className=t+\"-reset\",o.setAttribute(\"type\",\"button\"),o.title=i,o.appendChild(this.label_),o.addEventListener($e,this.handleClick_.bind(this),!1);const a=t+\" \"+_r+\" \"+jr,s=this.element;s.className=a,s.appendChild(o),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=void 0!==e.duration?e.duration:250,this.autoHide_=void 0===e.autoHide||e.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Nr)}handleClick_(e){e.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const t=e.getRotation();void 0!==t&&(this.duration_>0&&t%(2*Math.PI)!=0?e.animate({rotation:0,duration:this.duration_,easing:xt}):e.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const n=t.viewState.rotation;if(n!=this.rotation_){const e=\"rotate(\"+n+\"rad)\";if(this.autoHide_){const e=this.element.classList.contains(Nr);e||0!==n?e&&0!==n&&this.element.classList.remove(Nr):this.element.classList.add(Nr)}this.label_.style.transform=e}this.rotation_=n}},Co=class extends So{constructor(e){e=e||{},super({element:document.createElement(\"div\"),target:e.target});const t=void 0!==e.className?e.className:\"ol-zoom\",n=void 0!==e.delta?e.delta:1,r=void 0!==e.zoomInClassName?e.zoomInClassName:t+\"-in\",i=void 0!==e.zoomOutClassName?e.zoomOutClassName:t+\"-out\",o=void 0!==e.zoomInLabel?e.zoomInLabel:\"+\",a=void 0!==e.zoomOutLabel?e.zoomOutLabel:\"–\",s=void 0!==e.zoomInTipLabel?e.zoomInTipLabel:\"Zoom in\",l=void 0!==e.zoomOutTipLabel?e.zoomOutTipLabel:\"Zoom out\",c=document.createElement(\"button\");c.className=r,c.setAttribute(\"type\",\"button\"),c.title=s,c.appendChild(\"string\"==typeof o?document.createTextNode(o):o),c.addEventListener($e,this.handleClick_.bind(this,n),!1);const u=document.createElement(\"button\");u.className=i,u.setAttribute(\"type\",\"button\"),u.title=l,u.appendChild(\"string\"==typeof a?document.createTextNode(a):a),u.addEventListener($e,this.handleClick_.bind(this,-n),!1);const d=t+\" \"+_r+\" \"+jr,p=this.element;p.className=d,p.appendChild(c),p.appendChild(u),this.duration_=void 0!==e.duration?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const t=this.getMap().getView();if(!t)return;const n=t.getZoom();if(void 0!==n){const r=t.getConstrainedZoom(n+e);this.duration_>0?(t.getAnimating()&&t.cancelAnimations(),t.animate({zoom:r,duration:this.duration_,easing:xt})):t.setZoom(r)}}};function To(e){e=e||{};const t=new $n;return(void 0===e.zoom||e.zoom)&&t.push(new Co(e.zoomOptions)),(void 0===e.rotate||e.rotate)&&t.push(new wo(e.rotateOptions)),(void 0===e.attribution||e.attribution)&&t.push(new xo(e.attributionOptions)),t}const Ao=\"active\";function Eo(e,t,n,r){const i=e.getZoom();if(void 0===i)return;const o=e.getConstrainedZoom(i+t),a=e.getResolutionForZoom(o);e.getAnimating()&&e.cancelAnimations(),e.animate({resolution:a,anchor:n,duration:void 0!==r?r:250,easing:xt})}const Oo=class extends fn{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Ao)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(Ao,e)}setMap(e){this.map_=e}},Mo=class extends Oo{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=void 0!==e.duration?e.duration:250}handleEvent(e){let t=!1;if(e.type==ui.DBLCLICK){const n=e.originalEvent,r=e.map,i=e.coordinate,o=n.shiftKey?-this.delta_:this.delta_;Eo(r.getView(),o,i,this.duration_),n.preventDefault(),t=!0}return!t}};function Po(e){const t=e.length;let n=0,r=0;for(let i=0;i<t;i++)n+=e[i].clientX,r+=e[i].clientY;return{clientX:n/t,clientY:r/t}}const Do=class extends Oo{constructor(e){super(e=e||{}),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==ui.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==ui.POINTERUP){const t=this.handleUpEvent(e);this.handlingDownUpSequence=t&&this.targetPointers.length>0}}else if(e.type==ui.POINTERDOWN){const n=this.handleDownEvent(e);this.handlingDownUpSequence=n,t=this.stopDown(n)}else e.type==ui.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}};function Io(e){const t=arguments;return function(e){let n=!0;for(let r=0,i=t.length;r<i&&(n=n&&t[r](e),n);++r);return n}}const No=function(e){const t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},_o=function(e){return!e.map.getTargetElement().hasAttribute(\"tabindex\")||function(e){const t=e.map.getTargetElement(),n=e.map.getOwnerDocument().activeElement;return t.contains(n)}(e)},jo=dt,ko=function(e){const t=e.originalEvent;return 0==t.button&&!(Ot&&Mt&&t.ctrlKey)},Lo=function(e){const t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},Ro=function(e){const t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},Zo=function(e){const t=e.originalEvent,n=t.target.tagName;return\"INPUT\"!==n&&\"SELECT\"!==n&&\"TEXTAREA\"!==n&&!t.target.isContentEditable},Bo=function(e){const t=e.originalEvent;return(0,tn.h)(void 0!==t,56),\"mouse\"==t.pointerType},Fo=function(e){const t=e.originalEvent;return(0,tn.h)(void 0!==t,56),t.isPrimary&&0===t.button},zo=class extends Do{constructor(e){super({stopDown:pt}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:Io(Lo,Fo);this.condition_=e.onFocusOnly?Io(_o,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const n=this.targetPointers,r=t.getEventPixel(Po(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){const t=[this.lastCentroid[0]-r[0],r[1]-this.lastCentroid[1]],n=e.map.getView();(0,Mr.bA)(t,n.getResolution()),(0,Mr.U1)(t,n.getRotation()),n.adjustCenterInternal(t)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=n.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,n=t.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const e=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),i=n.getCenterInternal(),o=t.getPixelFromCoordinateInternal(i),a=t.getCoordinateFromPixelInternal([o[0]-e*Math.cos(r),o[1]-e*Math.sin(r)]);n.animateInternal({center:n.getConstrainedCenter(a),duration:500,easing:xt})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const t=e.map.getView();return this.lastCentroid=null,t.getAnimating()&&t.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}},Vo=class extends Do{constructor(e){e=e||{},super({stopDown:pt}),this.condition_=e.condition?e.condition:No,this.lastAngle_=void 0,this.duration_=void 0!==e.duration?e.duration:250}handleDragEvent(e){if(!Bo(e))return;const t=e.map,n=t.getView();if(n.getConstraints().rotation===Pi)return;const r=t.getSize(),i=e.pixel,o=Math.atan2(r[1]/2-i[1],i[0]-r[0]/2);if(void 0!==this.lastAngle_){const e=o-this.lastAngle_;n.adjustRotationInternal(-e)}this.lastAngle_=o}handleUpEvent(e){return!Bo(e)||(e.map.getView().endInteraction(this.duration_),!1)}handleDownEvent(e){return!!Bo(e)&&(!(!ko(e)||!this.condition_(e))&&(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0))}},Ho=class extends it{constructor(e){super(),this.geometry_=null,this.element_=document.createElement(\"div\"),this.element_.style.position=\"absolute\",this.element_.style.pointerEvents=\"auto\",this.element_.className=\"ol-box \"+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,n=\"px\",r=this.element_.style;r.left=Math.min(e[0],t[0])+n,r.top=Math.min(e[1],t[1])+n,r.width=Math.abs(t[0]-e[0])+n,r.height=Math.abs(t[1]-e[1])+n}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left=\"inherit\",e.top=\"inherit\",e.width=\"inherit\",e.height=\"inherit\"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const e=this.startPixel_,t=this.endPixel_,n=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);n[4]=n[0].slice(),this.geometry_?this.geometry_.setCoordinates([n]):this.geometry_=new fo([n])}getGeometry(){return this.geometry_}};class Uo extends ot{constructor(e,t,n){super(e),this.coordinate=t,this.mapBrowserEvent=n}}const Go=class extends Do{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.box_=new Ho(e.className||\"ol-dragbox\"),this.minArea_=void 0!==e.minArea?e.minArea:64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition?e.condition:ko,this.boxEndCondition_=e.boxEndCondition?e.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,n){const r=n[0]-t[0],i=n[1]-t[1];return r*r+i*i>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new Uo(\"boxdrag\",e.coordinate,e))}handleUpEvent(e){this.box_.setMap(null);const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new Uo(t?\"boxend\":\"boxcancel\",e.coordinate,e)),!1}handleDownEvent(e){return!!this.condition_(e)&&(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Uo(\"boxstart\",e.coordinate,e)),!0)}onBoxEnd(e){}},Yo=class extends Go{constructor(e){super({condition:(e=e||{}).condition?e.condition:Ro,className:e.className||\"ol-dragzoom\",minArea:e.minArea}),this.duration_=void 0!==e.duration?e.duration:200,this.out_=void 0!==e.out&&e.out}onBoxEnd(e){const t=this.getMap().getView();let n=this.getGeometry();if(this.out_){const e=t.rotatedExtentForGeometry(n),r=t.getResolutionForExtentInternal(e),i=t.getResolution()/r;n=n.clone(),n.scale(i*i)}t.fitInternal(n,{duration:this.duration_,easing:xt})}},Wo=class extends Oo{constructor(e){super(),e=e||{},this.defaultCondition_=function(e){return Lo(e)&&Zo(e)},this.condition_=void 0!==e.condition?e.condition:this.defaultCondition_,this.duration_=void 0!==e.duration?e.duration:100,this.pixelDelta_=void 0!==e.pixelDelta?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==et){const n=e.originalEvent,r=n.keyCode;if(this.condition_(e)&&(40==r||37==r||39==r||38==r)){const i=e.map.getView(),o=i.getResolution()*this.pixelDelta_;let a=0,s=0;40==r?s=-o:37==r?a=-o:39==r?a=o:s=o;const l=[a,s];(0,Mr.U1)(l,i.getRotation()),function(e,t,n){const r=e.getCenterInternal();if(r){const i=[r[0]+t[0],r[1]+t[1]];e.animateInternal({duration:void 0!==n?n:250,easing:Ct,center:e.getConstrainedCenter(i)})}}(i,l,this.duration_),n.preventDefault(),t=!0}}return!t}},Ko=class extends Oo{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:Zo,this.delta_=e.delta?e.delta:1,this.duration_=void 0!==e.duration?e.duration:100}handleEvent(e){let t=!1;if(e.type==et||e.type==tt){const n=e.originalEvent,r=n.charCode;if(this.condition_(e)&&(r==\"+\".charCodeAt(0)||r==\"-\".charCodeAt(0))){const i=e.map,o=r==\"+\".charCodeAt(0)?this.delta_:-this.delta_;Eo(i.getView(),o,void 0,this.duration_),n.preventDefault(),t=!0}}return!t}},qo=class{constructor(e,t,n){this.decay_=e,this.minVelocity_=t,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let n=t-3;for(;n>0&&this.points_[n+2]>e;)n-=3;const r=this.points_[t+2]-this.points_[n+2];if(r<1e3/60)return!1;const i=this.points_[t]-this.points_[n],o=this.points_[t+1]-this.points_[n+1];return this.angle_=Math.atan2(o,i),this.initialVelocity_=Math.sqrt(i*i+o*o)/r,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}},Qo=class extends Oo{constructor(e){super(e=e||{}),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=void 0!==e.maxDelta?e.maxDelta:1,this.duration_=void 0!==e.duration?e.duration:250,this.timeout_=void 0!==e.timeout?e.timeout:80,this.useAnchor_=void 0===e.useAnchor||e.useAnchor,this.constrainResolution_=void 0!==e.constrainResolution&&e.constrainResolution;const t=e.condition?e.condition:jo;this.condition_=e.onFocusOnly?Io(_o,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();e&&e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(e){if(!this.condition_(e))return!0;if(e.type!==rt)return!0;const t=e.map,n=e.originalEvent;let r;if(n.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.coordinate),e.type==rt&&(r=n.deltaY,Et&&n.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(r/=Pt),n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(r*=40)),0===r)return!1;this.lastDelta_=r;const i=Date.now();void 0===this.startTime_&&(this.startTime_=i),(!this.mode_||i-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?\"trackpad\":\"wheel\");const o=t.getView();if(\"trackpad\"===this.mode_&&!o.getConstrainResolution()&&!this.constrainResolution_)return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(o.getAnimating()&&o.cancelAnimations(),o.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),o.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=i,!1;this.totalDelta_+=r;const a=Math.max(this.timeout_-(i-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,t),a),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let n=-(0,Wt.uZ)(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),Eo(t,n,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}},Xo=class extends Do{constructor(e){const t=e=e||{};t.stopDown||(t.stopDown=pt),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=void 0!==e.threshold?e.threshold:.3,this.duration_=void 0!==e.duration?e.duration:250}handleDragEvent(e){let t=0;const n=this.targetPointers[0],r=this.targetPointers[1],i=Math.atan2(r.clientY-n.clientY,r.clientX-n.clientX);if(void 0!==this.lastAngle_){const e=i-this.lastAngle_;this.rotationDelta_+=e,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=e}this.lastAngle_=i;const o=e.map,a=o.getView();a.getConstraints().rotation!==Pi&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(Po(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return!(this.targetPointers.length<2)||(e.map.getView().endInteraction(this.duration_),!1)}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}},Jo=class extends Do{constructor(e){const t=e=e||{};t.stopDown||(t.stopDown=pt),super(t),this.anchor_=null,this.duration_=void 0!==e.duration?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const n=this.targetPointers[0],r=this.targetPointers[1],i=n.clientX-r.clientX,o=n.clientY-r.clientY,a=Math.sqrt(i*i+o*o);void 0!==this.lastDistance_&&(t=this.lastDistance_/a),this.lastDistance_=a;const s=e.map,l=s.getView();1!=t&&(this.lastScaleDelta_=t),this.anchor_=s.getCoordinateFromPixelInternal(s.getEventPixel(Po(this.targetPointers))),s.render(),l.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const t=e.map.getView(),n=this.lastScaleDelta_>1?1:-1;return t.endInteraction(this.duration_,n),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}};var $o=r(6225);function ea(e){e instanceof Or?e.setMapInternal(null):e instanceof si&&e.getLayers().forEach(ea)}function ta(e,t){if(e instanceof Or)e.setMapInternal(t);else if(e instanceof si){const n=e.getLayers().getArray();for(let e=0,r=n.length;e<r;++e)ta(n[e],t)}}const na=class extends fn{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=function(e){let t=null;void 0!==e.keyboardEventTarget&&(t=\"string\"==typeof e.keyboardEventTarget?document.getElementById(e.keyboardEventTarget):e.keyboardEventTarget);const n={},r=e.layers&&\"function\"==typeof e.layers.getLayers?e.layers:new si({layers:e.layers});let i,o,a;return n[gi]=r,n[yi]=e.target,n[bi]=e.view instanceof bo?e.view:new bo,void 0!==e.controls&&(Array.isArray(e.controls)?i=new $n(e.controls.slice()):((0,tn.h)(\"function\"==typeof e.controls.getArray,47),i=e.controls)),void 0!==e.interactions&&(Array.isArray(e.interactions)?o=new $n(e.interactions.slice()):((0,tn.h)(\"function\"==typeof e.interactions.getArray,48),o=e.interactions)),void 0!==e.overlays?Array.isArray(e.overlays)?a=new $n(e.overlays.slice()):((0,tn.h)(\"function\"==typeof e.overlays.getArray,49),a=e.overlays):a=new $n,{controls:i,interactions:o,keyboardEventTarget:t,overlays:a,values:n}}(e);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=void 0!==e.maxTilesLoading?e.maxTilesLoading:16,this.pixelRatio_=void 0!==e.pixelRatio?e.pixelRatio:Pt,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=[1,0,0,1,0,0],this.pixelToCoordinateTransform_=[1,0,0,1,0,0],this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement(\"div\"),this.viewport_.className=\"ol-viewport\"+(\"ontouchstart\"in window?\" ol-touch\":\"\"),this.viewport_.style.position=\"relative\",this.viewport_.style.overflow=\"hidden\",this.viewport_.style.width=\"100%\",this.viewport_.style.height=\"100%\",this.overlayContainer_=document.createElement(\"div\"),this.overlayContainer_.style.position=\"absolute\",this.overlayContainer_.style.zIndex=\"0\",this.overlayContainer_.style.width=\"100%\",this.overlayContainer_.style.height=\"100%\",this.overlayContainer_.style.pointerEvents=\"none\",this.overlayContainer_.className=\"ol-overlaycontainer\",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement(\"div\"),this.overlayContainerStopEvent_.style.position=\"absolute\",this.overlayContainerStopEvent_.style.zIndex=\"0\",this.overlayContainerStopEvent_.style.width=\"100%\",this.overlayContainerStopEvent_.style.height=\"100%\",this.overlayContainerStopEvent_.style.pointerEvents=\"none\",this.overlayContainerStopEvent_.className=\"ol-overlaycontainer-stopevent\",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver((()=>this.updateSize())),this.controls=t.controls||To(),this.interactions=t.interactions||function(e){e=e||{};const t=new $n,n=new qo(-.005,.05,100);return(void 0===e.altShiftDragRotate||e.altShiftDragRotate)&&t.push(new Vo),(void 0===e.doubleClickZoom||e.doubleClickZoom)&&t.push(new Mo({delta:e.zoomDelta,duration:e.zoomDuration})),(void 0===e.dragPan||e.dragPan)&&t.push(new zo({onFocusOnly:e.onFocusOnly,kinetic:n})),(void 0===e.pinchRotate||e.pinchRotate)&&t.push(new Xo),(void 0===e.pinchZoom||e.pinchZoom)&&t.push(new Jo({duration:e.zoomDuration})),(void 0===e.keyboard||e.keyboard)&&(t.push(new Wo),t.push(new Ko({delta:e.zoomDelta,duration:e.zoomDuration}))),(void 0===e.mouseWheelZoom||e.mouseWheelZoom)&&t.push(new Qo({onFocusOnly:e.onFocusOnly,duration:e.zoomDuration})),(void 0===e.shiftDragZoom||e.shiftDragZoom)&&t.push(new Yo({duration:e.zoomDuration})),t}({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new wi(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(gi,this.handleLayerGroupChanged_),this.addChangeListener(bi,this.handleViewChanged_),this.addChangeListener(vi,this.handleSizeChanged_),this.addChangeListener(yi,this.handleTargetChanged_),this.setProperties(t.values);const n=this;!e.view||e.view instanceof bo||e.view.then((function(e){n.setView(new bo(e))})),this.controls.addEventListener(qn,(e=>{e.element.setMap(this)})),this.controls.addEventListener(Qn,(e=>{e.element.setMap(null)})),this.interactions.addEventListener(qn,(e=>{e.element.setMap(this)})),this.interactions.addEventListener(Qn,(e=>{e.element.setMap(null)})),this.overlays_.addEventListener(qn,(e=>{this.addOverlayInternal_(e.element)})),this.overlays_.addEventListener(Qn,(e=>{const t=e.element.getId();void 0!==t&&delete this.overlayIdIndex_[t.toString()],e.element.setMap(null)})),this.controls.forEach((e=>{e.setMap(this)})),this.interactions.forEach((e=>{e.setMap(this)})),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){ta(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();void 0!==t&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,n){if(!this.frameState_||!this.renderer_)return;const r=this.getCoordinateFromPixelInternal(e),i=void 0!==(n=void 0!==n?n:{}).hitTolerance?n.hitTolerance:0,o=void 0!==n.layerFilter?n.layerFilter:dt,a=!1!==n.checkWrapped;return this.renderer_.forEachFeatureAtCoordinate(r,this.frameState_,i,a,t,null,o,null)}getFeaturesAtPixel(e,t){const n=[];return this.forEachFeatureAtPixel(e,(function(e){n.push(e)}),t),n}getAllLayers(){const e=[];return function t(n){n.forEach((function(n){n instanceof si?t(n.getLayers()):e.push(n)}))}(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const n=this.getCoordinateFromPixelInternal(e),r=void 0!==(t=void 0!==t?t:{}).layerFilter?t.layerFilter:dt,i=void 0!==t.hitTolerance?t.hitTolerance:0,o=!1!==t.checkWrapped;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,i,o,r,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const t=this.viewport_.getBoundingClientRect(),n=this.getSize(),r=t.width/n[0],i=t.height/n[1],o=\"changedTouches\"in e?e.changedTouches[0]:e;return[(o.clientX-t.left)/r,(o.clientY-t.top)/i]}getTarget(){return this.get(yi)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return(0,Yt.lO)(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?er(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return void 0!==t?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(gi)}setLayers(e){const t=this.getLayerGroup();if(e instanceof $n)return void t.setLayers(e);const n=t.getLayers();n.clear(),n.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,n=e.length;t<n;++t){const n=e[t];if(!n.visible)continue;const r=n.layer.getRenderer();if(r&&!r.ready)return!0;const i=n.layer.getSource();if(i&&i.loading)return!0}return!1}getPixelFromCoordinate(e){const t=(0,Yt.Vs)(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?er(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(vi)}getView(){return this.get(bi)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,n,r){return function(e,t,n,r,i){if(!e||!(n in e.wantedTiles))return Si;if(!e.wantedTiles[n][t.getKey()])return Si;const o=e.viewState.center,a=r[0]-o[0],s=r[1]-o[1];return 65536*Math.log(i)+Math.sqrt(a*a+s*s)/i}(this.frameState_,e,t,n,r)}handleBrowserEvent(e,t){t=t||e.type;const n=new ci(t,this,e);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,n=t.type;if(n===di||n===rt||n===et){const e=this.getOwnerDocument(),n=this.viewport_.getRootNode?this.viewport_.getRootNode():e,r=t.target;if(this.overlayContainerStopEvent_.contains(r)||!(n===e?e.documentElement:n).contains(r))return}if(e.frameState=this.frameState_,!1!==this.dispatchEvent(e)){const t=this.getInteractions().getArray().slice();for(let n=t.length-1;n>=0;n--){const r=t[n];if(r.getMap()===this&&r.getActive()&&this.getTargetElement()&&(!r.handleEvent(e)||e.propagationStopped))break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let n=this.maxTilesLoading_,r=n;if(e){const t=e.viewHints;if(t[0]||t[1]){const t=Date.now()-e.time>8;n=t?0:8,r=t?0:2}}t.getTilesLoading()<n&&(t.reprioritize(),t.loadMoreTiles(n,r))}e&&this.renderer_&&!e.animate&&(!0===this.renderComplete_?(this.hasListener(Ar)&&this.renderer_.dispatchRenderEvent(Ar,e),!1===this.loaded_&&(this.loaded_=!0,this.dispatchEvent(new li(mi,this,e)))):!0===this.loaded_&&(this.loaded_=!1,this.dispatchEvent(new li(hi,this,e))));const n=this.postRenderFunctions_;for(let t=0,r=n.length;t<r;++t)n[t](this,e);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let e=0,t=this.targetChangeHandlerKeys_.length;e<t;++e)Vt(this.targetChangeHandlerKeys_[e]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(Je,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(rt,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,Zt(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const e=this.targetElement_.getRootNode();e instanceof ShadowRoot&&this.resizeObserver_.unobserve(e.host)}const e=this.getTarget(),t=\"string\"==typeof e?document.getElementById(e):e;if(this.targetElement_=t,t){t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new ri(this)),this.mapBrowserEventHandler_=new pi(this,this.moveTolerance_);for(const e in ui)this.mapBrowserEventHandler_.addEventListener(ui[e],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(Je,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(rt,this.boundHandleBrowserEvent_,!!Nt&&{passive:!1});const e=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.targetChangeHandlerKeys_=[Ft(e,et,this.handleBrowserEvent,this),Ft(e,tt,this.handleBrowserEvent,this)];const n=t.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.observe(n.host),this.resizeObserver_.observe(t)}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(Vt(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(Vt(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=Ft(e,cn,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=Ft(e,Xe,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(Vt),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new ii(\"addlayer\",e)),this.layerGroupPropertyListenerKeys_=[Ft(e,cn,this.render,this),Ft(e,Xe,this.render,this),Ft(e,\"addlayer\",this.handleLayerAdd_,this),Ft(e,\"removelayer\",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,n=e.length;t<n;++t){const n=e[t].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}}render(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){ea(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),n=this.getView(),r=this.frameState_;let i=null;if(void 0!==t&&On(t)&&n&&n.isDef()){const r=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),o=n.getState();if(i={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:(0,Gt.p8)(o.center,o.resolution,o.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:o,viewHints:r,wantedTiles:{},mapId:bt(this),renderTargets:{}},o.nextCenter&&o.nextResolution){const e=isNaN(o.nextRotation)?o.rotation:o.nextRotation;i.nextExtent=(0,Gt.p8)(o.nextCenter,o.nextResolution,e,t)}}this.frameState_=i,this.renderer_.renderFrame(i),i&&(i.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,i.postRenderFunctions),r&&(!this.previousExtent_||!(0,Gt.xb)(this.previousExtent_)&&!(0,Gt.fS)(i.extent,this.previousExtent_))&&(this.dispatchEvent(new li(\"movestart\",this,r)),this.previousExtent_=(0,Gt.YN)(this.previousExtent_)),this.previousExtent_&&!i.viewHints[0]&&!i.viewHints[1]&&!(0,Gt.fS)(i.extent,this.previousExtent_)&&(this.dispatchEvent(new li(\"moveend\",this,i)),(0,Gt.d9)(i.extent,this.previousExtent_))),this.dispatchEvent(new li(fi,this,i)),this.renderComplete_=this.hasListener(hi)||this.hasListener(mi)||this.hasListener(Ar)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout((()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()}),0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new ii(\"removelayer\",t)),this.set(gi,e)}setSize(e){this.set(vi,e)}setTarget(e){this.set(yi,e)}setView(e){if(!e||e instanceof bo)return void this.set(bi,e);this.set(bi,new bo);const t=this;e.then((function(e){t.setView(new bo(e))}))}updateSize(){const e=this.getTargetElement();let t;if(e){const n=getComputedStyle(e),r=e.offsetWidth-parseFloat(n.borderLeftWidth)-parseFloat(n.paddingLeft)-parseFloat(n.paddingRight)-parseFloat(n.borderRightWidth),i=e.offsetHeight-parseFloat(n.borderTopWidth)-parseFloat(n.paddingTop)-parseFloat(n.paddingBottom)-parseFloat(n.borderBottomWidth);isNaN(r)||isNaN(i)||(t=[r,i],!On(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&(0,$o.ZK)(\"No map visible because the map container's width or height are 0.\"))}const n=this.getSize();!t||n&&ut(t,n)||(this.setSize(t),this.updateViewportSize_())}updateViewportSize_(){const e=this.getView();if(e){let t;const n=getComputedStyle(this.viewport_);n.width&&n.height&&(t=[parseInt(n.width,10),parseInt(n.height,10)]),e.setViewportSize(t)}}},ra=\"units\",ia=[1,2,5],oa=25.4/.28,aa=class extends So{constructor(e){e=e||{};const t=document.createElement(\"div\");t.style.pointerEvents=\"none\",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const n=void 0!==e.className?e.className:e.bar?\"ol-scale-bar\":\"ol-scale-line\";this.innerElement_=document.createElement(\"div\"),this.innerElement_.className=n+\"-inner\",this.element.className=n+\" \"+_r,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=void 0!==e.minWidth?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_=\"\",this.addChangeListener(ra,this.handleUnitsChanged_),this.setUnits(e.units||\"metric\"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(ra)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(ra,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e)return void(this.renderedVisible_&&(this.element.style.display=\"none\",this.renderedVisible_=!1));const t=e.center,n=e.projection,r=this.getUnits(),i=\"degrees\"==r?\"degrees\":\"m\";let o=(0,Yt._Q)(n,e.resolution,t,i);const a=this.minWidth_*(this.dpi_||oa)/oa,s=void 0!==this.maxWidth_?this.maxWidth_*(this.dpi_||oa)/oa:void 0;let l=a*o,c=\"\";if(\"degrees\"==r){const e=Yt.Wm.degrees;l*=e,l<e/60?(c=\"″\",o*=3600):l<e?(c=\"′\",o*=60):c=\"°\"}else\"imperial\"==r?l<.9144?(c=\"in\",o/=.0254):l<1609.344?(c=\"ft\",o/=.3048):(c=\"mi\",o/=1609.344):\"nautical\"==r?(o/=1852,c=\"NM\"):\"metric\"==r?l<.001?(c=\"μm\",o*=1e6):l<1?(c=\"mm\",o*=1e3):l<1e3?c=\"m\":(c=\"km\",o/=1e3):\"us\"==r?l<.9144?(c=\"in\",o*=39.37):l<1609.344?(c=\"ft\",o/=.30480061):(c=\"mi\",o/=1609.3472):(0,tn.h)(!1,33);let u,d,p,f,h,m,g=3*Math.floor(Math.log(a*o)/Math.log(10));for(;;){p=Math.floor(g/3);const e=Math.pow(10,p);if(u=ia[(g%3+3)%3]*e,d=Math.round(u/o),isNaN(d))return this.element.style.display=\"none\",void(this.renderedVisible_=!1);if(void 0!==s&&d>=s){u=f,d=h,p=m;break}if(d>=a)break;f=u,h=d,m=p,++g}const v=this.scaleBar_?this.createScaleBar(d,u,c):u.toFixed(p<0?-p:0)+\" \"+c;this.renderedHTML_!=v&&(this.innerElement_.innerHTML=v,this.renderedHTML_=v),this.renderedWidth_!=d&&(this.innerElement_.style.width=d+\"px\",this.renderedWidth_=d),this.renderedVisible_||(this.element.style.display=\"\",this.renderedVisible_=!0)}createScaleBar(e,t,n){const r=this.getScaleForResolution(),i=r<1?Math.round(1/r).toLocaleString()+\" : 1\":\"1 : \"+Math.round(r).toLocaleString(),o=this.scaleBarSteps_,a=e/o,s=[this.createMarker(\"absolute\")];for(let r=0;r<o;++r){const i=r%2==0?\"ol-scale-singlebar-odd\":\"ol-scale-singlebar-even\";s.push(`<div><div class=\"ol-scale-singlebar ${i}\" style=\"width: ${a}px;\"></div>`+this.createMarker(\"relative\")+(r%2==0||2===o?this.createStepText(r,e,!1,t,n):\"\")+\"</div>\")}return s.push(this.createStepText(o,e,!0,t,n)),(this.scaleBarText_?`<div class=\"ol-scale-text\" style=\"width: ${e}px;\">`+i+\"</div>\":\"\")+s.join(\"\")}createMarker(e){return`<div class=\"ol-scale-step-marker\" style=\"position: ${e}; top: ${\"absolute\"===e?3:-10}px;\"></div>`}createStepText(e,t,n,r,i){const o=(0===e?0:Math.round(r/this.scaleBarSteps_*e*100)/100)+(0===e?\"\":\" \"+i);return`<div class=\"ol-scale-step-text\" style=\"margin-left: ${0===e?-3:t/this.scaleBarSteps_*-1}px;text-align: ${0===e?\"left\":\"center\"};min-width: ${0===e?0:t/this.scaleBarSteps_*2}px;left: ${n?t+\"px\":\"unset\"};\">`+o+\"</div>\"}getScaleForResolution(){return(0,Yt._Q)(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,\"m\")*(1e3/25.4)*(this.dpi_||oa)}render(e){const t=e.frameState;this.viewState_=t?t.viewState:null,this.updateElement_()}},sa=\"preload\",la=\"useInterimTilesOnError\",ca=class extends Or{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.setPreload(void 0!==e.preload?e.preload:0),this.setUseInterimTilesOnError(void 0===e.useInterimTilesOnError||e.useInterimTilesOnError)}getPreload(){return this.get(sa)}setPreload(e){this.set(sa,e)}getUseInterimTilesOnError(){return this.get(la)}setUseInterimTilesOnError(e){this.set(la,e)}getData(e){return super.getData(e)}},ua=class extends dn{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.declutterExecutorGroup=null}getFeatures(e){return vt()}getData(e){return null}prepareFrame(e){return vt()}renderFrame(e,t){return vt()}loadedTileCallback(e,t,n){e[t]||(e[t]={}),e[t][n.tileCoord.toString()]=n}createLoadedTileFinder(e,t,n){return(r,i)=>{const o=this.loadedTileCallback.bind(this,n,r);return e.forEachLoadedTile(t,r,i,o)}}forEachFeatureAtCoordinate(e,t,n,r,i){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){2===e.target.getState()&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return 2!=t&&3!=t&&e.addEventListener(Xe,this.boundHandleImageChange_),0==t&&(e.load(),t=e.getState()),2==t}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&\"ready\"===e.getSourceState()&&e.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}},da=[];let pa=null;const fa=class extends ua{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=[1,0,0,1,0,0],this.pixelTransform=[1,0,0,1,0,0],this.inversePixelTransform=[1,0,0,1,0,0],this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(e,t,n){let r;pa||(pa=_t(1,1,void 0,{willReadFrequently:!0})),pa.clearRect(0,0,1,1);try{pa.drawImage(e,t,n,1,1,0,0,1,1),r=pa.getImageData(0,0,1,1).data}catch(e){return pa=null,null}return r}getBackground(e){let t=this.getLayer().getBackground();return\"function\"==typeof t&&(t=t(e.viewState.resolution)),t||void 0}useContainer(e,t,n){const r=this.getLayer().getClassName();let i,o;if(e&&e.className===r&&(!n||e&&e.style.backgroundColor&&ut(cr(e.style.backgroundColor),cr(n)))){const t=e.firstElementChild;t instanceof HTMLCanvasElement&&(o=t.getContext(\"2d\"))}if(o&&o.canvas.style.transform===t?(this.container=e,this.context=o,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){i=document.createElement(\"div\"),i.className=r;let e=i.style;e.position=\"absolute\",e.width=\"100%\",e.height=\"100%\",o=_t();const t=o.canvas;i.appendChild(t),e=t.style,e.position=\"absolute\",e.left=\"0\",e.transformOrigin=\"top left\",this.container=i,this.context=o}this.containerReused||!n||this.container.style.backgroundColor||(this.container.style.backgroundColor=n)}clipUnrotated(e,t,n){const r=(0,Gt.rL)(n),i=(0,Gt.Xv)(n),o=(0,Gt.w$)(n),a=(0,Gt.hC)(n);er(t.coordinateToPixelTransform,r),er(t.coordinateToPixelTransform,i),er(t.coordinateToPixelTransform,o),er(t.coordinateToPixelTransform,a);const s=this.inversePixelTransform;er(s,r),er(s,i),er(s,o),er(s,a),e.save(),e.beginPath(),e.moveTo(Math.round(r[0]),Math.round(r[1])),e.lineTo(Math.round(i[0]),Math.round(i[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}dispatchRenderEvent_(e,t,n){const r=this.getLayer();if(r.hasListener(e)){const i=new Ir(e,this.inversePixelTransform,n,t);r.dispatchEvent(i)}}preRender(e,t){this.frameState=t,this.dispatchRenderEvent_(\"prerender\",e,t)}postRender(e,t){this.dispatchRenderEvent_(\"postrender\",e,t)}getRenderTransform(e,t,n,r,i,o,a){const s=i/2,l=o/2,c=r/t,u=-c,d=-e[0]+a,p=-e[1];return tr(this.tempTransform,s,l,c,u,-n,d,p)}disposeInternal(){delete this.frameState,super.disposeInternal()}},ha=class extends fa{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=(0,Gt.lJ)(),this.tmpTileRange_=new yn(0,0,0,0)}isDrawableTile(e){const t=this.getLayer(),n=e.getState(),r=t.getUseInterimTilesOnError();return 2==n||4==n||3==n&&!r}getTile(e,t,n,r){const i=r.pixelRatio,o=r.viewState.projection,a=this.getLayer();let s=a.getSource().getTile(e,t,n,i,o);return 3==s.getState()&&a.getUseInterimTilesOnError()&&a.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(s)||(s=s.getInterimTile()),s}getData(e){const t=this.frameState;if(!t)return null;const n=this.getLayer(),r=er(t.pixelToCoordinateTransform,e.slice()),i=n.getExtent();if(i&&!(0,Gt.b8)(i,r))return null;const o=t.pixelRatio,a=t.viewState.projection,s=t.viewState,l=n.getRenderSource(),c=l.getTileGridForProjection(s.projection),u=l.getTilePixelRatio(t.pixelRatio);for(let e=c.getZForResolution(s.resolution);e>=c.getMinZoom();--e){const t=c.getTileCoordForCoordAndZ(r,e),n=l.getTile(e,t[1],t[2],o,a);if(!(n instanceof Ut||n instanceof en)||n instanceof en&&4===n.getState())return null;if(2!==n.getState())continue;const i=c.getOrigin(e),d=Pn(c.getTileSize(e)),p=c.getResolution(e),f=Math.floor(u*((r[0]-i[0])/p-t[1]*d[0])),h=Math.floor(u*((i[1]-r[1])/p-t[2]*d[1])),m=Math.round(u*l.getGutterForProjection(s.projection));return this.getImageData(n.getImage(),f+m,h+m)}return null}loadedTileCallback(e,t,n){return!!this.isDrawableTile(n)&&super.loadedTileCallback(e,t,n)}prepareFrame(e){return!!this.getLayer().getSource()}renderFrame(e,t){const n=e.layerStatesArray[e.layerIndex],r=e.viewState,i=r.projection,o=r.resolution,a=r.center,s=r.rotation,l=e.pixelRatio,c=this.getLayer(),u=c.getSource(),d=u.getRevision(),p=u.getTileGridForProjection(i),f=p.getZForResolution(o,u.zDirection),h=p.getResolution(f);let m=e.extent;const g=e.viewState.resolution,v=u.getTilePixelRatio(l),y=Math.round((0,Gt.dz)(m)/g*l),b=Math.round((0,Gt.Cr)(m)/g*l),S=n.extent&&(0,Yt.dY)(n.extent,i);S&&(m=(0,Gt.Ed)(m,(0,Yt.dY)(n.extent,i)));const x=h*y/2/v,w=h*b/2/v,C=[a[0]-x,a[1]-w,a[0]+x,a[1]+w],T=p.getTileRangeForExtentAndZ(m,f),A={};A[f]={};const E=this.createLoadedTileFinder(u,i,A),O=this.tmpExtent,M=this.tmpTileRange_;this.newTiles_=!1;const P=s?(0,Gt.dY)(r.center,g,s,e.size):void 0;for(let t=T.minX;t<=T.maxX;++t)for(let r=T.minY;r<=T.maxY;++r){if(s&&!p.tileCoordIntersectsViewport([f,t,r],P))continue;const i=this.getTile(f,t,r,e);if(this.isDrawableTile(i)){const t=bt(this);if(2==i.getState()){A[f][i.tileCoord.toString()]=i;let e=i.inTransition(t);e&&1!==n.opacity&&(i.endTransition(t),e=!1),this.newTiles_||!e&&this.renderedTiles.includes(i)||(this.newTiles_=!0)}if(1===i.getAlpha(t,e.time))continue}const o=p.getTileCoordChildTileRange(i.tileCoord,M,O);let a=!1;o&&(a=E(f+1,o)),a||p.forEachTileCoordParentTileRange(i.tileCoord,E,M,O)}const D=h/o*l/v;tr(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/l,1/l,s,-y/2,-b/2);const I=ir(this.pixelTransform);this.useContainer(t,I,this.getBackground(e));const N=this.context,_=N.canvas;nr(this.inversePixelTransform,this.pixelTransform),tr(this.tempTransform,y/2,b/2,D,D,0,-y/2,-b/2),_.width!=y||_.height!=b?(_.width=y,_.height=b):this.containerReused||N.clearRect(0,0,y,b),S&&this.clipUnrotated(N,e,S),u.getInterpolate()||(N.imageSmoothingEnabled=!1),this.preRender(N,e),this.renderedTiles.length=0;let j,k,L,R=Object.keys(A).map(Number);R.sort(at),1!==n.opacity||this.containerReused&&!u.getOpaque(e.viewState.projection)?(j=[],k=[]):R=R.reverse();for(let t=R.length-1;t>=0;--t){const n=R[t],r=u.getTilePixelSize(n,l,i),o=p.getResolution(n)/h,a=r[0]*o*D,s=r[1]*o*D,c=p.getTileCoordForCoordAndZ((0,Gt.rL)(C),n),d=p.getTileCoordExtent(c),m=er(this.tempTransform,[v*(d[0]-C[0])/h,v*(C[3]-d[3])/h]),g=v*u.getGutterForProjection(i),y=A[n];for(const t in y){const r=y[t],i=r.tileCoord,o=c[1]-i[1],l=Math.round(m[0]-(o-1)*a),d=c[2]-i[2],p=Math.round(m[1]-(d-1)*s),h=Math.round(m[0]-o*a),v=Math.round(m[1]-d*s),b=l-h,S=p-v,x=f===n,w=x&&1!==r.getAlpha(bt(this),e.time);let C=!1;if(!w)if(j){L=[h,v,h+b,v,h+b,v+S,h,v+S];for(let e=0,t=j.length;e<t;++e)if(f!==n&&n<k[e]){const t=j[e];(0,Gt.kK)([h,v,h+b,v+S],[t[0],t[3],t[4],t[7]])&&(C||(N.save(),C=!0),N.beginPath(),N.moveTo(L[0],L[1]),N.lineTo(L[2],L[3]),N.lineTo(L[4],L[5]),N.lineTo(L[6],L[7]),N.moveTo(t[6],t[7]),N.lineTo(t[4],t[5]),N.lineTo(t[2],t[3]),N.lineTo(t[0],t[1]),N.clip())}j.push(L),k.push(n)}else N.clearRect(h,v,b,S);this.drawTileImage(r,e,h,v,b,S,g,x),j&&!w?(C&&N.restore(),this.renderedTiles.unshift(r)):this.renderedTiles.push(r),this.updateUsedTiles(e.usedTiles,u,r)}}return this.renderedRevision=d,this.renderedResolution=h,this.extentChanged=!this.renderedExtent_||!(0,Gt.fS)(this.renderedExtent_,C),this.renderedExtent_=C,this.renderedPixelRatio=l,this.renderedProjection=i,this.manageTilePyramid(e,u,p,l,i,m,f,c.getPreload()),this.scheduleExpireCache(e,u),this.postRender(N,e),n.extent&&N.restore(),N.imageSmoothingEnabled=!0,I!==_.style.transform&&(_.style.transform=I),this.container}drawTileImage(e,t,n,r,i,o,a,s){const l=this.getTileImage(e);if(!l)return;const c=bt(this),u=t.layerStatesArray[t.layerIndex],d=u.opacity*(s?e.getAlpha(c,t.time):1),p=d!==this.context.globalAlpha;p&&(this.context.save(),this.context.globalAlpha=d),this.context.drawImage(l,a,a,l.width-2*a,l.height-2*a,n,r,i,o),p&&this.context.restore(),d!==u.opacity?t.animate=!0:s&&e.endTransition(c)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,t){if(t.canExpireCache()){const n=function(e,t,n){const r=bt(e);r in n.usedTiles&&e.expireCache(n.viewState.projection,n.usedTiles[r])}.bind(null,t);e.postRenderFunctions.push(n)}}updateUsedTiles(e,t,n){const r=bt(t);r in e||(e[r]={}),e[r][n.getKey()]=!0}manageTilePyramid(e,t,n,r,i,o,a,s,l){const c=bt(t);c in e.wantedTiles||(e.wantedTiles[c]={});const u=e.wantedTiles[c],d=e.tileQueue,p=n.getMinZoom(),f=e.viewState.rotation,h=f?(0,Gt.dY)(e.viewState.center,e.viewState.resolution,f,e.size):void 0;let m,g,v,y,b,S,x=0;for(S=p;S<=a;++S)for(g=n.getTileRangeForExtentAndZ(o,S,g),v=n.getResolution(S),y=g.minX;y<=g.maxX;++y)for(b=g.minY;b<=g.maxY;++b)f&&!n.tileCoordIntersectsViewport([S,y,b],h)||(a-S<=s?(++x,m=t.getTile(S,y,b,r,i),0==m.getState()&&(u[m.getKey()]=!0,d.isKeyQueued(m.getKey())||d.enqueue([m,c,n.getTileCoordCenter(m.tileCoord),v])),void 0!==l&&l(m)):t.useTile(S,y,b,i));t.updateCacheSize(x,i)}},ma=class extends ca{constructor(e){super(e)}createRenderer(){return new ha(this)}};var ga=r(63935),va=function(e,t,n){switch(e){case N.BLANK:return new Un({url:t,params:{LAYERS:\"topp:states\",TILED:!0},serverType:\"geoserver\"});case N.OPENSTREET:return new Yn({url:t});case N.MAPBOX:return new Gn({url:\"\".concat(t).concat(n)});case N.OFFLINE:return new Un({url:t,projection:\"EPSG:4326\",params:{LAYERS:\"default\",VERSION:\"1.1.1\",FORMAT:\"image/jpeg\"},serverType:\"mapserver\"});default:return new Yn}},ya=r(98e3),ba=r.n(ya);function Sa(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(null!=n){var r,i,o,a,s=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||function(e,t){if(e){if(\"string\"==typeof e)return xa(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return\"Object\"===n&&e.constructor&&(n=e.constructor.name),\"Map\"===n||\"Set\"===n?Array.from(e):\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xa(e,t):void 0}}(e,t)||function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}()}function xa(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}const wa=function(e,t){var n=function(e){var t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER;e.forEach((function(e){var o=e.longitude,a=e.latitude;t=Math.min(t,o),n=Math.max(n,o),r=Math.min(r,a),i=Math.max(i,a)}));var o=Sa((0,Yt.mi)([t,r]),2),a=o[0],s=o[1],l=Sa((0,Yt.mi)([n,i]),2);return[a,s,l[0],l[1]]}(t);!function(e,t,n){var r=Sa(e.getSize(),2),i=r[0],o=r[1],a=e.getView(),s=a.getResolutionForExtent(t,[.6*i,.6*o]),l=Math.min(a.getZoomForResolution(s),n),c=Sa(t,4),u=c[0],d=c[1],p=c[2],f=c[3];a.animate({zoom:l,duration:500,center:[(u+p)/2,(d+f)/2]})}(e,n,t.length>1?20:15)};class Ca extends fn{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_=\"geometry\",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(\"function\"==typeof e.getSimplifiedGeometry){const t=e;this.setGeometry(t)}else{const t=e;this.setProperties(t)}}clone(){const e=new Ca(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const n=this.getStyle();return n&&e.setStyle(n),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(Vt(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=Ft(e,Xe,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?function(e){if(\"function\"==typeof e)return e;let t;return Array.isArray(e)?t=e:((0,tn.h)(\"function\"==typeof e.getZIndex,41),t=[e]),function(){return t}}(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}const Ta=Ca;var Aa=r(6353);const Ea=class{constructor(e){this.rbush_=new Aa(e),this.items_={}}insert(e,t){const n={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(n),this.items_[bt(t)]=n}load(e,t){const n=new Array(t.length);for(let r=0,i=t.length;r<i;r++){const i=e[r],o=t[r],a={minX:i[0],minY:i[1],maxX:i[2],maxY:i[3],value:o};n[r]=a,this.items_[bt(o)]=a}this.rbush_.load(n)}remove(e){const t=bt(e),n=this.items_[t];return delete this.items_[t],null!==this.rbush_.remove(n)}update(e,t){const n=this.items_[bt(t)],r=[n.minX,n.minY,n.maxX,n.maxY];(0,Gt.fS)(r,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map((function(e){return e.value}))}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map((function(e){return e.value}))}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let n;for(let r=0,i=e.length;r<i;r++)if(n=t(e[r]),n)return n;return n}isEmpty(){return mt(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return(0,Gt.T9)(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}},Oa=\"addfeature\",Ma=\"removefeature\";function Pa(e,t){return[[-1/0,-1/0,1/0,1/0]]}function Da(e,t){return function(n,r,i,o,a){const s=this;!function(e,t,n,r,i,o,a){const s=new XMLHttpRequest;s.open(\"GET\",\"function\"==typeof e?e(n,r,i):e,!0),\"arraybuffer\"==t.getType()&&(s.responseType=\"arraybuffer\"),s.withCredentials=false,s.onload=function(e){if(!s.status||s.status>=200&&s.status<300){const e=t.getType();let r;\"json\"==e||\"text\"==e?r=s.responseText:\"xml\"==e?(r=s.responseXML,r||(r=(new DOMParser).parseFromString(s.responseText,\"application/xml\"))):\"arraybuffer\"==e&&(r=s.response),r?o(t.readFeatures(r,{extent:n,featureProjection:i}),t.readProjection(r)):a()}else a()},s.onerror=a,s.send()}(e,t,n,r,i,(function(e,t){s.addFeatures(e),void 0!==o&&o(e)}),a||ft)}}class Ia extends ot{constructor(e,t,n){super(e),this.feature=t,this.features=n}}const Na=class extends mn{constructor(e){super({attributions:(e=e||{}).attributions,interpolate:!0,projection:void 0,state:\"ready\",wrapX:void 0===e.wrapX||e.wrapX}),this.on,this.once,this.un,this.loader_=ft,this.format_=e.format,this.overlaps_=void 0===e.overlaps||e.overlaps,this.url_=e.url,void 0!==e.loader?this.loader_=e.loader:void 0!==this.url_&&((0,tn.h)(this.format_,7),this.loader_=Da(this.url_,this.format_)),this.strategy_=void 0!==e.strategy?e.strategy:Pa;const t=void 0===e.useSpatialIndex||e.useSpatialIndex;let n,r;this.featuresRtree_=t?new Ea:null,this.loadedExtentsRtree_=new Ea,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null,Array.isArray(e.features)?r=e.features:e.features&&(n=e.features,r=n.getArray()),t||void 0!==n||(n=new $n(r)),void 0!==r&&this.addFeaturesInternal(r),void 0!==n&&this.bindFeaturesCollection_(n)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=bt(e);if(!this.addToIndex_(t,e))return void(this.featuresCollection_&&this.featuresCollection_.remove(e));this.setupChangeEvents_(t,e);const n=e.getGeometry();if(n){const t=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(t,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new Ia(Oa,e))}setupChangeEvents_(e,t){this.featureChangeKeys_[e]=[Ft(t,Xe,this.handleFeatureChange_,this),Ft(t,cn,this.handleFeatureChange_,this)]}addToIndex_(e,t){let n=!0;const r=t.getId();return void 0!==r&&(r.toString()in this.idIndex_?n=!1:this.idIndex_[r.toString()]=t),n&&((0,tn.h)(!(e in this.uidIndex_),30),this.uidIndex_[e]=t),n}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],n=[],r=[];for(let t=0,r=e.length;t<r;t++){const r=e[t],i=bt(r);this.addToIndex_(i,r)&&n.push(r)}for(let e=0,i=n.length;e<i;e++){const i=n[e],o=bt(i);this.setupChangeEvents_(o,i);const a=i.getGeometry();if(a){const e=a.getExtent();t.push(e),r.push(i)}else this.nullGeometryFeatures_[o]=i}if(this.featuresRtree_&&this.featuresRtree_.load(t,r),this.hasListener(Oa))for(let e=0,t=n.length;e<t;e++)this.dispatchEvent(new Ia(Oa,n[e]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(Oa,(function(n){t||(t=!0,e.push(n.feature),t=!1)})),this.addEventListener(Ma,(function(n){t||(t=!0,e.remove(n.feature),t=!1)})),e.addEventListener(qn,(e=>{t||(t=!0,this.addFeature(e.element),t=!1)})),e.addEventListener(Qn,(e=>{t||(t=!0,this.removeFeature(e.element),t=!1)})),this.featuresCollection_=e}clear(e){if(e){for(const e in this.featureChangeKeys_)this.featureChangeKeys_[e].forEach(Vt);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const e=e=>{this.removeFeatureInternal(e)};this.featuresRtree_.forEach(e);for(const e in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[e])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new Ia(\"clear\");this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const n=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(n,(function(n){if(n.getGeometry().intersectsCoordinate(e))return t(n)}))}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,(function(n){if(n.getGeometry().intersectsExtent(e)){const e=t(n);if(e)return e}}))}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),mt(this.nullGeometryFeatures_)||ct(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,(function(e){t.push(e)})),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const n=(0,Gt.MV)(e,t);return[].concat(...n.map((e=>this.featuresRtree_.getInExtent(e))))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,t){const n=e[0],r=e[1];let i=null;const o=[NaN,NaN];let a=1/0;const s=[-1/0,-1/0,1/0,1/0];return t=t||dt,this.featuresRtree_.forEachInExtent(s,(function(e){if(t(e)){const t=e.getGeometry(),l=a;if(a=t.closestPointXY(n,r,o,a),a<l){i=e;const t=Math.sqrt(a);s[0]=n-t,s[1]=r-t,s[2]=n+t,s[3]=r+t}}})),i}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const t=this.idIndex_[e.toString()];return void 0!==t?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return void 0!==t?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,n=bt(t),r=t.getGeometry();if(r){const e=r.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(e,t)):this.featuresRtree_&&this.featuresRtree_.update(e,t)}else n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[n]=t);const i=t.getId();if(void 0!==i){const e=i.toString();this.idIndex_[e]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[e]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[n]=t;this.changed(),this.dispatchEvent(new Ia(\"changefeature\",t))}hasFeature(e){const t=e.getId();return void 0!==t?t in this.idIndex_:bt(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&mt(this.nullGeometryFeatures_):!this.featuresCollection_||0===this.featuresCollection_.getLength()}loadFeatures(e,t,n){const r=this.loadedExtentsRtree_,i=this.strategy_(e,t,n);for(let e=0,o=i.length;e<o;++e){const o=i[e];r.forEachInExtent(o,(function(e){return(0,Gt.r4)(e.extent,o)}))||(++this.loadingExtentsCount_,this.dispatchEvent(new Ia(\"featuresloadstart\")),this.loader_.call(this,o,t,n,(e=>{--this.loadingExtentsCount_,this.dispatchEvent(new Ia(\"featuresloadend\",void 0,e))}),(()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Ia(\"featuresloaderror\"))})),r.insert(o,{extent:o.slice()}))}this.loading=!(this.loader_.length<4)&&this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_;let n;t.forEachInExtent(e,(function(t){if((0,Gt.fS)(t.extent,e))return n=t,!0})),n&&t.remove(n)}removeFeature(e){if(!e)return;const t=bt(e);t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=bt(e),n=this.featureChangeKeys_[t];if(!n)return;n.forEach(Vt),delete this.featureChangeKeys_[t];const r=e.getId();return void 0!==r&&delete this.idIndex_[r.toString()],delete this.uidIndex_[t],this.dispatchEvent(new Ia(Ma,e)),e}removeFromIdIndex_(e){let t=!1;for(const n in this.idIndex_)if(this.idIndex_[n]===e){delete this.idIndex_[n],t=!0;break}return t}setLoader(e){this.loader_=e}setUrl(e){(0,tn.h)(this.format_,7),this.url_=e,this.setLoader(Da(e,this.format_))}},_a=class extends Na{constructor(e){super({attributions:e.attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=void 0!==e.distance?e.distance:20,this.minDistance=e.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=e.geometryFunction||function(e){const t=e.getGeometry();return(0,tn.h)(\"Point\"==t.getType(),10),t},this.createCustomCluster_=e.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(e.source||null)}clear(e){this.features.length=0,super.clear(e)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(e,t,n){this.source.loadFeatures(e,t,n),t!==this.resolution&&(this.resolution=t,this.refresh())}setDistance(e){this.updateDistance(e,this.minDistance)}setMinDistance(e){this.updateDistance(this.distance,e)}getMinDistance(){return this.minDistance}setSource(e){this.source&&this.source.removeEventListener(Xe,this.boundRefresh_),this.source=e,e&&e.addEventListener(Xe,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(e,t){const n=0===e?0:Math.min(t,e)/e,r=e!==this.distance||this.interpolationRatio!==n;this.distance=e,this.minDistance=t,this.interpolationRatio=n,r&&this.refresh()}cluster(){if(void 0===this.resolution||!this.source)return;const e=(0,Gt.lJ)(),t=this.distance*this.resolution,n=this.source.getFeatures(),r={};for(let i=0,o=n.length;i<o;i++){const o=n[i];if(!(bt(o)in r)){const n=this.geometryFunction(o);if(n){const i=n.getCoordinates();(0,Gt.HK)(i,e),(0,Gt.f3)(e,t,e);const o=this.source.getFeaturesInExtent(e).filter((function(e){const t=bt(e);return!(t in r)&&(r[t]=!0,!0)}));this.features.push(this.createCluster(o,e))}}}}createCluster(e,t){const n=[0,0];for(let t=e.length-1;t>=0;--t){const r=this.geometryFunction(e[t]);r?(0,Mr.IH)(n,r.getCoordinates()):e.splice(t,1)}(0,Mr.bA)(n,1/e.length);const r=(0,Gt.qg)(t),i=this.interpolationRatio,o=new io([n[0]*(1-i)+r[0]*i,n[1]*(1-i)+r[1]*i]);return this.createCustomCluster_?this.createCustomCluster_(o,e):new Ta({geometry:o,features:e})}};class ja{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=Pn(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new ja({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return vt()}getImage(e){return vt()}getHitDetectionImage(){return vt()}getPixelRatio(e){return 1}getImageState(){return vt()}getImageSize(){return vt()}getOrigin(){return vt()}getSize(){return vt()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=Pn(e)}listenImageChange(e){vt()}load(){vt()}unlistenImageChange(e){vt()}}const ka=ja;function La(e){return Array.isArray(e)?dr(e):e}class Ra extends ka{constructor(e){super({opacity:1,rotateWithView:void 0!==e.rotateWithView&&e.rotateWithView,rotation:void 0!==e.rotation?e.rotation:0,scale:void 0!==e.scale?e.scale:1,displacement:void 0!==e.displacement?e.displacement:[0,0],declutterMode:e.declutterMode}),this.canvas_=void 0,this.hitDetectionCanvas_=null,this.fill_=void 0!==e.fill?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius_=void 0!==e.radius?e.radius:e.radius1,this.radius2_=e.radius2,this.angle_=void 0!==e.angle?e.angle:0,this.stroke_=void 0!==e.stroke?e.stroke:null,this.size_=null,this.renderOptions_=null,this.render()}clone(){const e=this.getScale(),t=new Ra({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}getAnchor(){const e=this.size_;if(!e)return null;const t=this.getDisplacement(),n=this.getScaleArray();return[e[0]/2-t[0]/n[0],e[1]/2+t[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_}getImage(e){let t=this.canvas_[e];if(!t){const n=this.renderOptions_,r=_t(n.size*e,n.size*e);this.draw_(n,r,e),t=r.canvas,this.canvas_[e]=t}return t}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return 2}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(e){}load(){}unlistenImageChange(e){}calculateLineJoinSize_(e,t,n){if(0===t||this.points_===1/0||\"bevel\"!==e&&\"miter\"!==e)return t;let r=this.radius_,i=void 0===this.radius2_?r:this.radius2_;if(r<i){const e=r;r=i,i=e}const o=void 0===this.radius2_?this.points_:2*this.points_,a=2*Math.PI/o,s=i*Math.sin(a),l=r-Math.sqrt(i*i-s*s),c=Math.sqrt(s*s+l*l),u=c/s;if(\"miter\"===e&&u<=n)return u*t;const d=t/2/u,p=t/2*(l/c),f=Math.sqrt((r+d)*(r+d)+p*p)-r;if(void 0===this.radius2_||\"bevel\"===e)return 2*f;const h=r*Math.sin(a),m=i-Math.sqrt(r*r-h*h),g=Math.sqrt(h*h+m*m)/h;if(g<=n){const e=g*t/2-i-r;return 2*Math.max(f,e)}return 2*f}createRenderOptions(){let e,t=Hr,n=0,r=null,i=0,o=0;this.stroke_&&(e=this.stroke_.getColor(),null===e&&(e=Ur),e=La(e),o=this.stroke_.getWidth(),void 0===o&&(o=1),r=this.stroke_.getLineDash(),i=this.stroke_.getLineDashOffset(),t=this.stroke_.getLineJoin(),void 0===t&&(t=Hr),n=this.stroke_.getMiterLimit(),void 0===n&&(n=10));const a=this.calculateLineJoinSize_(t,o,n),s=Math.max(this.radius_,this.radius2_||0);return{strokeStyle:e,strokeWidth:o,size:Math.ceil(2*s+a),lineDash:r,lineDashOffset:i,lineJoin:t,miterLimit:n}}render(){this.renderOptions_=this.createRenderOptions();const e=this.renderOptions_.size;this.canvas_={},this.size_=[e,e]}draw_(e,t,n){if(t.scale(n,n),t.translate(e.size/2,e.size/2),this.createPath_(t),this.fill_){let e=this.fill_.getColor();null===e&&(e=Fr),t.fillStyle=La(e),t.fill()}this.stroke_&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}createHitDetectionCanvas_(e){if(this.fill_){let t=this.fill_.getColor(),n=0;if(\"string\"==typeof t&&(t=cr(t)),null===t?n=1:Array.isArray(t)&&(n=4===t.length?t[3]:1),0===n){const t=_t(e.size,e.size);this.hitDetectionCanvas_=t.canvas,this.drawHitDetectionCanvas_(e,t)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))}createPath_(e){let t=this.points_;const n=this.radius_;if(t===1/0)e.arc(0,0,n,0,2*Math.PI);else{const r=void 0===this.radius2_?n:this.radius2_;void 0!==this.radius2_&&(t*=2);const i=this.angle_-Math.PI/2,o=2*Math.PI/t;for(let a=0;a<t;a++){const t=i+a*o,s=a%2==0?n:r;e.lineTo(s*Math.cos(t),s*Math.sin(t))}e.closePath()}}drawHitDetectionCanvas_(e,t){t.translate(e.size/2,e.size/2),this.createPath_(t),t.fillStyle=Fr,t.fill(),this.stroke_&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}}const Za=Ra;class Ba extends Za{constructor(e){super({points:1/0,fill:(e=e||{radius:5}).fill,radius:e.radius,stroke:e.stroke,scale:void 0!==e.scale?e.scale:1,rotation:void 0!==e.rotation?e.rotation:0,rotateWithView:void 0!==e.rotateWithView&&e.rotateWithView,displacement:void 0!==e.displacement?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){const e=this.getScale(),t=new Ba({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}setRadius(e){this.radius_=e,this.render()}}const Fa=Ba;class za{constructor(e){e=e||{},this.color_=void 0!==e.color?e.color:null}clone(){const e=this.getColor();return new za({color:Array.isArray(e)?e.slice():e||void 0})}getColor(){return this.color_}setColor(e){this.color_=e}}const Va=za;class Ha{constructor(e){e=e||{},this.color_=void 0!==e.color?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=void 0!==e.lineDash?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}clone(){const e=this.getColor();return new Ha({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setWidth(e){this.width_=e}}const Ua=Ha;class Ga{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=Ka,void 0!==e.geometry&&this.setGeometry(e.geometry),this.fill_=void 0!==e.fill?e.fill:null,this.image_=void 0!==e.image?e.image:null,this.renderer_=void 0!==e.renderer?e.renderer:null,this.hitDetectionRenderer_=void 0!==e.hitDetectionRenderer?e.hitDetectionRenderer:null,this.stroke_=void 0!==e.stroke?e.stroke:null,this.text_=void 0!==e.text?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&\"object\"==typeof e&&(e=e.clone()),new Ga({geometry:e,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){\"function\"==typeof e?this.geometryFunction_=e:\"string\"==typeof e?this.geometryFunction_=function(t){return t.get(e)}:e?void 0!==e&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=Ka,this.geometry_=e}setZIndex(e){this.zIndex_=e}}let Ya=null;function Wa(e,t){if(!Ya){const e=new Va({color:\"rgba(255,255,255,0.4)\"}),t=new Ua({color:\"#3399CC\",width:1.25});Ya=[new Ga({image:new Fa({fill:e,stroke:t,radius:5}),fill:e,stroke:t})]}return Ya}function Ka(e){return e.getGeometry()}const qa=Ga;let Qa=null;class Xa extends gt{constructor(e,t,n,r,i,o){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=r,this.canvas_={},this.color_=o,this.unlisten_=null,this.imageState_=i,this.size_=n,this.src_=t,this.tainted_}initializeImage_(){this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(void 0===this.tainted_&&2===this.imageState_){Qa||(Qa=_t(1,1,void 0,{willReadFrequently:!0})),Qa.drawImage(this.image_,0,0);try{Qa.getImageData(0,0,1,1),this.tainted_=!1}catch(e){Qa=null,this.tainted_=!0}}return!0===this.tainted_}dispatchChangeEvent_(){this.dispatchEvent(Xe)}handleImageError_(){this.imageState_=3,this.unlistenImage_(),this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=2,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],t=this.size_[1],n=_t(e,t);n.fillRect(0,0,e,t),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(0===this.imageState_){this.image_||this.initializeImage_(),this.imageState_=1;try{this.image_.src=this.src_}catch(e){this.handleImageError_()}this.unlisten_=Ht(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||2!==this.imageState_)return;const t=this.image_,n=document.createElement(\"canvas\");n.width=Math.ceil(t.width*e),n.height=Math.ceil(t.height*e);const r=n.getContext(\"2d\");r.scale(e,e),r.drawImage(t,0,0),r.globalCompositeOperation=\"multiply\",r.fillStyle=sr(this.color_),r.fillRect(0,0,n.width/e,n.height/e),r.globalCompositeOperation=\"destination-in\",r.drawImage(t,0,0),this.canvas_[e]=n}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}class Ja extends ka{constructor(e){const t=void 0!==(e=e||{}).opacity?e.opacity:1,n=void 0!==e.rotation?e.rotation:0,r=void 0!==e.scale?e.scale:1,i=void 0!==e.rotateWithView&&e.rotateWithView;super({opacity:t,rotation:n,scale:r,displacement:void 0!==e.displacement?e.displacement:[0,0],rotateWithView:i,declutterMode:e.declutterMode}),this.anchor_=void 0!==e.anchor?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=void 0!==e.anchorOrigin?e.anchorOrigin:\"top-left\",this.anchorXUnits_=void 0!==e.anchorXUnits?e.anchorXUnits:\"fraction\",this.anchorYUnits_=void 0!==e.anchorYUnits?e.anchorYUnits:\"fraction\",this.crossOrigin_=void 0!==e.crossOrigin?e.crossOrigin:null;const o=void 0!==e.img?e.img:null;this.imgSize_=e.imgSize;let a=e.src;(0,tn.h)(!(void 0!==a&&o),4),(0,tn.h)(!o||o&&this.imgSize_,5),void 0!==a&&0!==a.length||!o||(a=o.src||bt(o)),(0,tn.h)(void 0!==a&&a.length>0,6),(0,tn.h)(!((void 0!==e.width||void 0!==e.height)&&void 0!==e.scale),69);const s=void 0!==e.src?0:2;if(this.color_=void 0!==e.color?cr(e.color):null,this.iconImage_=function(e,t,n,r,i,o){let a=fr.get(t,r,o);return a||(a=new Xa(e,t,n,r,i,o),fr.set(t,r,o,a)),a}(o,a,void 0!==this.imgSize_?this.imgSize_:null,this.crossOrigin_,s,this.color_),this.offset_=void 0!==e.offset?e.offset:[0,0],this.offsetOrigin_=void 0!==e.offsetOrigin?e.offsetOrigin:\"top-left\",this.origin_=null,this.size_=void 0!==e.size?e.size:null,this.width_=e.width,this.height_=e.height,void 0!==this.width_||void 0!==this.height_){const e=this.getImage(1),t=()=>{this.updateScaleFromWidthAndHeight(this.width_,this.height_)};e.width>0?this.updateScaleFromWidthAndHeight(this.width_,this.height_):e.addEventListener(\"load\",t)}}clone(){const e=this.getScale();return new Ja({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:Array.isArray(e)?e.slice():e,size:null!==this.size_?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode(),width:this.width_,height:this.height_})}updateScaleFromWidthAndHeight(e,t){const n=this.getImage(1);void 0!==e&&void 0!==t?super.setScale([e/n.width,t/n.height]):void 0!==e?super.setScale([e/n.width,e/n.width]):void 0!==t?super.setScale([t/n.height,t/n.height]):super.setScale([1,1])}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const t=this.getSize();if(\"fraction\"==this.anchorXUnits_||\"fraction\"==this.anchorYUnits_){if(!t)return null;e=this.anchor_.slice(),\"fraction\"==this.anchorXUnits_&&(e[0]*=t[0]),\"fraction\"==this.anchorYUnits_&&(e[1]*=t[1])}if(\"top-left\"!=this.anchorOrigin_){if(!t)return null;e===this.anchor_&&(e=this.anchor_.slice()),\"top-right\"!=this.anchorOrigin_&&\"bottom-right\"!=this.anchorOrigin_||(e[0]=-e[0]+t[0]),\"bottom-left\"!=this.anchorOrigin_&&\"bottom-right\"!=this.anchorOrigin_||(e[1]=-e[1]+t[1])}this.normalizedAnchor_=e}const t=this.getDisplacement(),n=this.getScaleArray();return[e[0]-t[0]/n[0],e[1]+t[1]/n[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(\"top-left\"!=this.offsetOrigin_){const t=this.getSize(),n=this.iconImage_.getSize();if(!t||!n)return null;e=e.slice(),\"top-right\"!=this.offsetOrigin_&&\"bottom-right\"!=this.offsetOrigin_||(e[0]=n[0]-t[0]-e[0]),\"bottom-left\"!=this.offsetOrigin_&&\"bottom-right\"!=this.offsetOrigin_||(e[1]=n[1]-t[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){return this.width_}getHeight(){return this.height_}setWidth(e){this.width_=e,this.updateScaleFromWidthAndHeight(e,this.height_)}setHeight(e){this.height_=e,this.updateScaleFromWidthAndHeight(this.width_,e)}setScale(e){super.setScale(e);const t=this.getImage(1);if(t){const n=Array.isArray(e)?e[0]:e;void 0!==n&&(this.width_=n*t.width);const r=Array.isArray(e)?e[1]:e;void 0!==r&&(this.height_=r*t.height)}}listenImageChange(e){this.iconImage_.addEventListener(Xe,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(Xe,e)}}const $a=Ja;class es{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.scale_=e.scale,this.scaleArray_=Pn(void 0!==e.scale?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.textBaseline_=e.textBaseline,this.fill_=void 0!==e.fill?e.fill:new Va({color:\"#333\"}),this.maxAngle_=void 0!==e.maxAngle?e.maxAngle:Math.PI/4,this.placement_=void 0!==e.placement?e.placement:\"point\",this.overflow_=!!e.overflow,this.stroke_=void 0!==e.stroke?e.stroke:null,this.offsetX_=void 0!==e.offsetX?e.offsetX:0,this.offsetY_=void 0!==e.offsetY?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=void 0===e.padding?null:e.padding}clone(){const e=this.getScale();return new es({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRotateWithView(e){this.rotateWithView_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=Pn(void 0!==e?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}}const ts=es;function ns(e){return new qa({fill:rs(e,\"\"),stroke:is(e,\"\"),text:os(e),image:as(e)})}function rs(e,t){const n=e[t+\"fill-color\"];if(n)return new Va({color:n})}function is(e,t){const n=e[t+\"stroke-width\"],r=e[t+\"stroke-color\"];if(n||r)return new Ua({width:n,color:r,lineCap:e[t+\"stroke-line-cap\"],lineJoin:e[t+\"stroke-line-join\"],lineDash:e[t+\"stroke-line-dash\"],lineDashOffset:e[t+\"stroke-line-dash-offset\"],miterLimit:e[t+\"stroke-miter-limit\"]})}function os(e){const t=e[\"text-value\"];if(t)return new ts({text:t,font:e[\"text-font\"],maxAngle:e[\"text-max-angle\"],offsetX:e[\"text-offset-x\"],offsetY:e[\"text-offset-y\"],overflow:e[\"text-overflow\"],placement:e[\"text-placement\"],scale:e[\"text-scale\"],rotateWithView:e[\"text-rotate-with-view\"],rotation:e[\"text-rotation\"],textAlign:e[\"text-align\"],justify:e[\"text-justify\"],textBaseline:e[\"text-baseline\"],padding:e[\"text-padding\"],fill:rs(e,\"text-\"),backgroundFill:rs(e,\"text-background-\"),stroke:is(e,\"text-\"),backgroundStroke:is(e,\"text-background-\")})}function as(e){const t=e[\"icon-src\"],n=e[\"icon-img\"];if(t||n)return new $a({src:t,img:n,imgSize:e[\"icon-img-size\"],anchor:e[\"icon-anchor\"],anchorOrigin:e[\"icon-anchor-origin\"],anchorXUnits:e[\"icon-anchor-x-units\"],anchorYUnits:e[\"icon-anchor-y-units\"],color:e[\"icon-color\"],crossOrigin:e[\"icon-cross-origin\"],offset:e[\"icon-offset\"],displacement:e[\"icon-displacement\"],opacity:e[\"icon-opacity\"],scale:e[\"icon-scale\"],rotation:e[\"icon-rotation\"],rotateWithView:e[\"icon-rotate-with-view\"],size:e[\"icon-size\"],declutterMode:e[\"icon-declutter-mode\"]});const r=e[\"shape-points\"];if(r){const t=\"shape-\";return new Za({points:r,fill:rs(e,t),stroke:is(e,t),radius:e[\"shape-radius\"],radius1:e[\"shape-radius1\"],radius2:e[\"shape-radius2\"],angle:e[\"shape-angle\"],displacement:e[\"shape-displacement\"],rotation:e[\"shape-rotation\"],rotateWithView:e[\"shape-rotate-with-view\"],scale:e[\"shape-scale\"],declutterMode:e[\"shape-declutter-mode\"]})}const i=e[\"circle-radius\"];if(i){const t=\"circle-\";return new Fa({radius:i,fill:rs(e,t),stroke:is(e,t),displacement:e[\"circle-displacement\"],scale:e[\"circle-scale\"],rotation:e[\"circle-rotation\"],rotateWithView:e[\"circle-rotate-with-view\"],declutterMode:e[\"circle-declutter-mode\"]})}}const ss=\"renderOrder\",ls=class extends Or{constructor(e){e=e||{};const t=Object.assign({},e);delete t.style,delete t.renderBuffer,delete t.updateWhileAnimating,delete t.updateWhileInteracting,super(t),this.declutter_=void 0!==e.declutter&&e.declutter,this.renderBuffer_=void 0!==e.renderBuffer?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=void 0!==e.updateWhileAnimating&&e.updateWhileAnimating,this.updateWhileInteracting_=void 0!==e.updateWhileInteracting&&e.updateWhileInteracting}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(ss)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e){e.declutterTree||(e.declutterTree=new Aa(9)),this.getRenderer().renderDeclutter(e)}setRenderOrder(e){this.set(ss,e)}setStyle(e){let t;if(void 0===e)t=Wa;else if(null===e)t=null;else if(\"function\"==typeof e)t=e;else if(e instanceof qa)t=e;else if(Array.isArray(e)){const n=e.length,r=new Array(n);for(let t=0;t<n;++t){const n=e[t];r[t]=n instanceof qa?n:ns(n)}t=r}else t=ns(e);this.style_=t,this.styleFunction_=null===e?void 0:function(e){let t;if(\"function\"==typeof e)t=e;else{let n;Array.isArray(e)?n=e:((0,tn.h)(\"function\"==typeof e.getZIndex,41),n=[e]),t=function(){return n}}return t}(this.style_),this.changed()}},cs={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},us=[cs.FILL],ds=[cs.STROKE],ps=[cs.BEGIN_PATH],fs=[cs.CLOSE_PATH],hs=cs;var ms=r(17172);const gs=class{drawCustom(e,t,n,r){}drawGeometry(e){}setStyle(e){}drawCircle(e,t){}drawFeature(e,t){}drawGeometryCollection(e,t){}drawLineString(e,t){}drawMultiLineString(e,t){}drawMultiPoint(e,t){}drawMultiPolygon(e,t){}drawPoint(e,t){}drawPolygon(e,t){}drawText(e,t){}setFillStrokeStyle(e,t){}setImageStyle(e,t){}setTextStyle(e,t){}},vs=class extends gs{constructor(e,t,n,r){super(),this.tolerance=e,this.maxExtent=t,this.pixelRatio=r,this.maxLineWidth=0,this.resolution=n,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){const t=this.pixelRatio;return 1==t?e:e.map((function(e){return e*t}))}appendFlatPointCoordinates(e,t){const n=this.getBufferedMaxExtent(),r=this.tmpCoordinate_,i=this.coordinates;let o=i.length;for(let a=0,s=e.length;a<s;a+=t)r[0]=e[a],r[1]=e[a+1],(0,Gt.b8)(n,r)&&(i[o++]=r[0],i[o++]=r[1]);return o}appendFlatLineCoordinates(e,t,n,r,i,o){const a=this.coordinates;let s=a.length;const l=this.getBufferedMaxExtent();o&&(t+=r);let c=e[t],u=e[t+1];const d=this.tmpCoordinate_;let p,f,h,m=!0;for(p=t+r;p<n;p+=r)d[0]=e[p],d[1]=e[p+1],h=(0,Gt.pX)(l,d),h!==f?(m&&(a[s++]=c,a[s++]=u,m=!1),a[s++]=d[0],a[s++]=d[1]):h===ms.Z.INTERSECTING?(a[s++]=d[0],a[s++]=d[1],m=!1):m=!0,c=d[0],u=d[1],f=h;return(i&&m||p===t+r)&&(a[s++]=c,a[s++]=u),s}drawCustomCoordinates_(e,t,n,r,i){for(let o=0,a=n.length;o<a;++o){const a=n[o],s=this.appendFlatLineCoordinates(e,t,a,r,!1,!1);i.push(s),t=a}return t}drawCustom(e,t,n,r){this.beginGeometry(e,t);const i=e.getType(),o=e.getStride(),a=this.coordinates.length;let s,l,c,u,d;switch(i){case\"MultiPolygon\":s=e.getOrientedFlatCoordinates(),u=[];const t=e.getEndss();d=0;for(let e=0,n=t.length;e<n;++e){const n=[];d=this.drawCustomCoordinates_(s,d,t[e],o,n),u.push(n)}this.instructions.push([hs.CUSTOM,a,u,e,n,Ji]),this.hitDetectionInstructions.push([hs.CUSTOM,a,u,e,r||n,Ji]);break;case\"Polygon\":case\"MultiLineString\":c=[],s=\"Polygon\"==i?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),d=this.drawCustomCoordinates_(s,0,e.getEnds(),o,c),this.instructions.push([hs.CUSTOM,a,c,e,n,Xi]),this.hitDetectionInstructions.push([hs.CUSTOM,a,c,e,r||n,Xi]);break;case\"LineString\":case\"Circle\":s=e.getFlatCoordinates(),l=this.appendFlatLineCoordinates(s,0,s.length,o,!1,!1),this.instructions.push([hs.CUSTOM,a,l,e,n,Qi]),this.hitDetectionInstructions.push([hs.CUSTOM,a,l,e,r||n,Qi]);break;case\"MultiPoint\":s=e.getFlatCoordinates(),l=this.appendFlatPointCoordinates(s,o),l>a&&(this.instructions.push([hs.CUSTOM,a,l,e,n,Qi]),this.hitDetectionInstructions.push([hs.CUSTOM,a,l,e,r||n,Qi]));break;case\"Point\":s=e.getFlatCoordinates(),this.coordinates.push(s[0],s[1]),l=this.coordinates.length,this.instructions.push([hs.CUSTOM,a,l,e,n]),this.hitDetectionInstructions.push([hs.CUSTOM,a,l,e,r||n])}this.endGeometry(t)}beginGeometry(e,t){this.beginGeometryInstruction1_=[hs.BEGIN_GEOMETRY,t,0,e],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[hs.BEGIN_GEOMETRY,t,0,e],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const e=this.hitDetectionInstructions;let t;e.reverse();const n=e.length;let r,i,o=-1;for(t=0;t<n;++t)r=e[t],i=r[0],i==hs.END_GEOMETRY?o=t:i==hs.BEGIN_GEOMETRY&&(r[2]=t,lt(this.hitDetectionInstructions,o,t),o=-1)}setFillStrokeStyle(e,t){const n=this.state;if(e){const t=e.getColor();n.fillStyle=La(t||Fr)}else n.fillStyle=void 0;if(t){const e=t.getColor();n.strokeStyle=La(e||Ur);const r=t.getLineCap();n.lineCap=void 0!==r?r:zr;const i=t.getLineDash();n.lineDash=i?i.slice():Vr;const o=t.getLineDashOffset();n.lineDashOffset=o||0;const a=t.getLineJoin();n.lineJoin=void 0!==a?a:Hr;const s=t.getWidth();n.lineWidth=void 0!==s?s:1;const l=t.getMiterLimit();n.miterLimit=void 0!==l?l:10,n.lineWidth>this.maxLineWidth&&(this.maxLineWidth=n.lineWidth,this.bufferedMaxExtent_=null)}else n.strokeStyle=void 0,n.lineCap=void 0,n.lineDash=null,n.lineDashOffset=void 0,n.lineJoin=void 0,n.lineWidth=void 0,n.miterLimit=void 0}createFill(e){const t=e.fillStyle,n=[hs.SET_FILL_STYLE,t];return\"string\"!=typeof t&&n.push(!0),n}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[hs.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,this.applyPixelRatio(e.lineDash),e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,t){const n=e.fillStyle;\"string\"==typeof n&&e.currentFillStyle==n||(void 0!==n&&this.instructions.push(t.call(this,e)),e.currentFillStyle=n)}updateStrokeStyle(e,t){const n=e.strokeStyle,r=e.lineCap,i=e.lineDash,o=e.lineDashOffset,a=e.lineJoin,s=e.lineWidth,l=e.miterLimit;(e.currentStrokeStyle!=n||e.currentLineCap!=r||i!=e.currentLineDash&&!ut(e.currentLineDash,i)||e.currentLineDashOffset!=o||e.currentLineJoin!=a||e.currentLineWidth!=s||e.currentMiterLimit!=l)&&(void 0!==n&&t.call(this,e),e.currentStrokeStyle=n,e.currentLineCap=r,e.currentLineDash=i,e.currentLineDashOffset=o,e.currentLineJoin=a,e.currentLineWidth=s,e.currentMiterLimit=l)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const t=[hs.END_GEOMETRY,e];this.instructions.push(t),this.hitDetectionInstructions.push(t)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=(0,Gt.d9)(this.maxExtent),this.maxLineWidth>0)){const e=this.resolution*(this.maxLineWidth+1)/2;(0,Gt.f3)(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}},ys=class extends vs{constructor(e,t,n,r){super(e,t,n,r)}drawFlatCoordinatess_(e,t,n,r){const i=this.state,o=void 0!==i.fillStyle,a=void 0!==i.strokeStyle,s=n.length;this.instructions.push(ps),this.hitDetectionInstructions.push(ps);for(let i=0;i<s;++i){const o=n[i],s=this.coordinates.length,l=this.appendFlatLineCoordinates(e,t,o,r,!0,!a),c=[hs.MOVE_TO_LINE_TO,s,l];this.instructions.push(c),this.hitDetectionInstructions.push(c),a&&(this.instructions.push(fs),this.hitDetectionInstructions.push(fs)),t=o}return o&&(this.instructions.push(us),this.hitDetectionInstructions.push(us)),a&&(this.instructions.push(ds),this.hitDetectionInstructions.push(ds)),t}drawCircle(e,t){const n=this.state,r=n.fillStyle,i=n.strokeStyle;if(void 0===r&&void 0===i)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t),void 0!==n.fillStyle&&this.hitDetectionInstructions.push([hs.SET_FILL_STYLE,Fr]),void 0!==n.strokeStyle&&this.hitDetectionInstructions.push([hs.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);const o=e.getFlatCoordinates(),a=e.getStride(),s=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,a,!1,!1);const l=[hs.CIRCLE,s];this.instructions.push(ps,l),this.hitDetectionInstructions.push(ps,l),void 0!==n.fillStyle&&(this.instructions.push(us),this.hitDetectionInstructions.push(us)),void 0!==n.strokeStyle&&(this.instructions.push(ds),this.hitDetectionInstructions.push(ds)),this.endGeometry(t)}drawPolygon(e,t){const n=this.state,r=n.fillStyle,i=n.strokeStyle;if(void 0===r&&void 0===i)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t),void 0!==n.fillStyle&&this.hitDetectionInstructions.push([hs.SET_FILL_STYLE,Fr]),void 0!==n.strokeStyle&&this.hitDetectionInstructions.push([hs.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);const o=e.getEnds(),a=e.getOrientedFlatCoordinates(),s=e.getStride();this.drawFlatCoordinatess_(a,0,o,s),this.endGeometry(t)}drawMultiPolygon(e,t){const n=this.state,r=n.fillStyle,i=n.strokeStyle;if(void 0===r&&void 0===i)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t),void 0!==n.fillStyle&&this.hitDetectionInstructions.push([hs.SET_FILL_STYLE,Fr]),void 0!==n.strokeStyle&&this.hitDetectionInstructions.push([hs.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);const o=e.getEndss(),a=e.getOrientedFlatCoordinates(),s=e.getStride();let l=0;for(let e=0,t=o.length;e<t;++e)l=this.drawFlatCoordinatess_(a,l,o[e],s);this.endGeometry(t)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(0!==e){const t=this.coordinates;for(let n=0,r=t.length;n<r;++n)t[n]=Wi(t[n],e)}return super.finish()}setFillStrokeStyles_(){const e=this.state;void 0!==e.fillStyle&&this.updateFillStyle(e,this.createFill),void 0!==e.strokeStyle&&this.updateStrokeStyle(e,this.applyStroke)}};function bs(e,t,n,r,i){let o,a,s,l,c,u,d,p,f,h,m=n,g=n,v=0,y=0,b=n;for(a=n;a<r;a+=i){const n=t[a],r=t[a+1];void 0!==c&&(f=n-c,h=r-u,l=Math.sqrt(f*f+h*h),void 0!==d&&(y+=s,o=Math.acos((d*f+p*h)/(s*l)),o>e&&(y>v&&(v=y,m=b,g=a),y=0,b=a-i)),s=l,d=f,p=h),c=n,u=r}return y+=l,y>v?[b,a]:[m,g]}const Ss={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},xs={Circle:ys,Default:vs,Image:class extends vs{constructor(e,t,n,r){super(e,t,n,r),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,t){if(!this.image_)return;this.beginGeometry(e,t);const n=e.getFlatCoordinates(),r=e.getStride(),i=this.coordinates.length,o=this.appendFlatPointCoordinates(n,r);this.instructions.push([hs.DRAW_IMAGE,i,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([hs.DRAW_IMAGE,i,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}drawMultiPoint(e,t){if(!this.image_)return;this.beginGeometry(e,t);const n=e.getFlatCoordinates(),r=e.getStride(),i=this.coordinates.length,o=this.appendFlatPointCoordinates(n,r);this.instructions.push([hs.DRAW_IMAGE,i,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([hs.DRAW_IMAGE,i,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,t){const n=e.getAnchor(),r=e.getSize(),i=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=r[1],this.opacity_=e.getOpacity(),this.originX_=i[0],this.originY_=i[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=r[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}},LineString:class extends vs{constructor(e,t,n,r){super(e,t,n,r)}drawFlatCoordinates_(e,t,n,r){const i=this.coordinates.length,o=this.appendFlatLineCoordinates(e,t,n,r,!1,!1),a=[hs.MOVE_TO_LINE_TO,i,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),n}drawLineString(e,t){const n=this.state,r=n.strokeStyle,i=n.lineWidth;if(void 0===r||void 0===i)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(e,t),this.hitDetectionInstructions.push([hs.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Vr,0],ps);const o=e.getFlatCoordinates(),a=e.getStride();this.drawFlatCoordinates_(o,0,o.length,a),this.hitDetectionInstructions.push(ds),this.endGeometry(t)}drawMultiLineString(e,t){const n=this.state,r=n.strokeStyle,i=n.lineWidth;if(void 0===r||void 0===i)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(e,t),this.hitDetectionInstructions.push([hs.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset],ps);const o=e.getEnds(),a=e.getFlatCoordinates(),s=e.getStride();let l=0;for(let e=0,t=o.length;e<t;++e)l=this.drawFlatCoordinates_(a,l,o[e],s);this.hitDetectionInstructions.push(ds),this.endGeometry(t)}finish(){const e=this.state;return null!=e.lastStroke&&e.lastStroke!=this.coordinates.length&&this.instructions.push(ds),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){null!=e.lastStroke&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(ds),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(ps)}},Polygon:ys,Text:class extends vs{constructor(e,t,n,r){super(e,t,n,r),this.labels_=null,this.text_=\"\",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_=\"\",this.fillKey_=\"\",this.strokeKey_=\"\",this.declutterImageWithText_=void 0}finish(){const e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,t){const n=this.textFillState_,r=this.textStrokeState_,i=this.textState_;if(\"\"===this.text_||!i||!n&&!r)return;const o=this.coordinates;let a=o.length;const s=e.getType();let l=null,c=e.getStride();if(\"line\"!==i.placement||\"LineString\"!=s&&\"MultiLineString\"!=s&&\"Polygon\"!=s&&\"MultiPolygon\"!=s){let n=i.overflow?null:[];switch(s){case\"Point\":case\"MultiPoint\":l=e.getFlatCoordinates();break;case\"LineString\":l=e.getFlatMidpoint();break;case\"Circle\":l=e.getCenter();break;case\"MultiLineString\":l=e.getFlatMidpoints(),c=2;break;case\"Polygon\":l=e.getFlatInteriorPoint(),i.overflow||n.push(l[2]/this.resolution),c=3;break;case\"MultiPolygon\":const t=e.getFlatInteriorPoints();l=[];for(let e=0,r=t.length;e<r;e+=3)i.overflow||n.push(t[e+2]/this.resolution),l.push(t[e],t[e+1]);if(0===l.length)return;c=2}const r=this.appendFlatPointCoordinates(l,c);if(r===a)return;if(n&&(r-a)/2!=l.length/c){let e=a/2;n=n.filter(((t,n)=>{const r=o[2*(e+n)]===l[n*c]&&o[2*(e+n)+1]===l[n*c+1];return r||--e,r}))}this.saveTextStates_(),(i.backgroundFill||i.backgroundStroke)&&(this.setFillStrokeStyle(i.backgroundFill,i.backgroundStroke),i.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),i.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(e,t);let u=i.padding;if(u!=Wr&&(i.scale[0]<0||i.scale[1]<0)){let e=i.padding[0],t=i.padding[1],n=i.padding[2],r=i.padding[3];i.scale[0]<0&&(t=-t,r=-r),i.scale[1]<0&&(e=-e,n=-n),u=[e,t,n,r]}const d=this.pixelRatio;this.instructions.push([hs.DRAW_IMAGE,a,r,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,u==Wr?Wr:u.map((function(e){return e*d})),!!i.backgroundFill,!!i.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,n]);const p=1/d;this.hitDetectionInstructions.push([hs.DRAW_IMAGE,a,r,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[p,p],NaN,void 0,this.declutterImageWithText_,u,!!i.backgroundFill,!!i.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,n]),this.endGeometry(t)}else{if(!(0,Gt.kK)(this.getBufferedMaxExtent(),e.getExtent()))return;let n;if(l=e.getFlatCoordinates(),\"LineString\"==s)n=[l.length];else if(\"MultiLineString\"==s)n=e.getEnds();else if(\"Polygon\"==s)n=e.getEnds().slice(0,1);else if(\"MultiPolygon\"==s){const t=e.getEndss();n=[];for(let e=0,r=t.length;e<r;++e)n.push(t[e][0])}this.beginGeometry(e,t);const r=i.textAlign;let u,d=0;for(let e=0,t=n.length;e<t;++e){if(null==r){const t=bs(i.maxAngle,l,d,n[e],c);d=t[0],u=t[1]}else u=n[e];for(let e=d;e<u;e+=c)o.push(l[e],l[e+1]);const t=o.length;d=n[e],this.drawChars_(a,t),a=t}this.endGeometry(t)}}saveTextStates_(){const e=this.textStrokeState_,t=this.textState_,n=this.textFillState_,r=this.strokeKey_;e&&(r in this.strokeStates||(this.strokeStates[r]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));const i=this.textKey_;i in this.textStates||(this.textStates[i]={font:t.font,textAlign:t.textAlign||Gr,justify:t.justify,textBaseline:t.textBaseline||Yr,scale:t.scale});const o=this.fillKey_;n&&(o in this.fillStates||(this.fillStates[o]={fillStyle:n.fillStyle}))}drawChars_(e,t){const n=this.textStrokeState_,r=this.textState_,i=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const s=this.pixelRatio,l=Ss[r.textBaseline],c=this.textOffsetY_*s,u=this.text_,d=n?n.lineWidth*Math.abs(r.scale[0])/2:0;this.instructions.push([hs.DRAW_CHARS,e,t,l,r.overflow,a,r.maxAngle,s,c,i,d*s,u,o,1]),this.hitDetectionInstructions.push([hs.DRAW_CHARS,e,t,l,r.overflow,a,r.maxAngle,1,c,i,d,u,o,1/s])}setTextStyle(e,t){let n,r,i;if(e){const t=e.getFill();t?(r=this.textFillState_,r||(r={},this.textFillState_=r),r.fillStyle=La(t.getColor()||Fr)):(r=null,this.textFillState_=r);const o=e.getStroke();if(o){i=this.textStrokeState_,i||(i={},this.textStrokeState_=i);const e=o.getLineDash(),t=o.getLineDashOffset(),n=o.getWidth(),r=o.getMiterLimit();i.lineCap=o.getLineCap()||zr,i.lineDash=e?e.slice():Vr,i.lineDashOffset=void 0===t?0:t,i.lineJoin=o.getLineJoin()||Hr,i.lineWidth=void 0===n?1:n,i.miterLimit=void 0===r?10:r,i.strokeStyle=La(o.getColor()||Ur)}else i=null,this.textStrokeState_=i;n=this.textState_;const a=e.getFont()||Br;Jr(a);const s=e.getScaleArray();n.overflow=e.getOverflow(),n.font=a,n.maxAngle=e.getMaxAngle(),n.placement=e.getPlacement(),n.textAlign=e.getTextAlign(),n.justify=e.getJustify(),n.textBaseline=e.getTextBaseline()||Yr,n.backgroundFill=e.getBackgroundFill(),n.backgroundStroke=e.getBackgroundStroke(),n.padding=e.getPadding()||Wr,n.scale=void 0===s?[1,1]:s;const l=e.getOffsetX(),c=e.getOffsetY(),u=e.getRotateWithView(),d=e.getRotation();this.text_=e.getText()||\"\",this.textOffsetX_=void 0===l?0:l,this.textOffsetY_=void 0===c?0:c,this.textRotateWithView_=void 0!==u&&u,this.textRotation_=void 0===d?0:d,this.strokeKey_=i?(\"string\"==typeof i.strokeStyle?i.strokeStyle:bt(i.strokeStyle))+i.lineCap+i.lineDashOffset+\"|\"+i.lineWidth+i.lineJoin+i.miterLimit+\"[\"+i.lineDash.join()+\"]\":\"\",this.textKey_=n.font+n.scale+(n.textAlign||\"?\")+(n.justify||\"?\")+(n.textBaseline||\"?\"),this.fillKey_=r?\"string\"==typeof r.fillStyle?r.fillStyle:\"|\"+bt(r.fillStyle):\"\"}else this.text_=\"\";this.declutterImageWithText_=t}}},ws=class{constructor(e,t,n,r){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=r,this.resolution_=n,this.buildersByZIndex_={}}finish(){const e={};for(const t in this.buildersByZIndex_){e[t]=e[t]||{};const n=this.buildersByZIndex_[t];for(const r in n){const i=n[r].finish();e[t][r]=i}}return e}getBuilder(e,t){const n=void 0!==e?e.toString():\"0\";let r=this.buildersByZIndex_[n];void 0===r&&(r={},this.buildersByZIndex_[n]=r);let i=r[t];return void 0===i&&(i=new(0,xs[t])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),r[t]=i),i}};function Cs(e,t,n,r,i,o,a,s,l,c,u,d){let p=e[t],f=e[t+1],h=0,m=0,g=0,v=0;function y(){h=p,m=f,p=e[t+=r],f=e[t+1],v+=g,g=Math.sqrt((p-h)*(p-h)+(f-m)*(f-m))}do{y()}while(t<n-r&&v+g<o);let b=0===g?0:(o-v)/g;const S=(0,Wt.t7)(h,p,b),x=(0,Wt.t7)(m,f,b),w=t-r,C=v,T=o+s*l(c,i,u);for(;t<n-r&&v+g<T;)y();b=0===g?0:(T-v)/g;const A=(0,Wt.t7)(h,p,b),E=(0,Wt.t7)(m,f,b);let O;if(d){const e=[S,x,A,E];Ni(e,0,4,2,d,e,e),O=e[0]>e[2]}else O=S>A;const M=Math.PI,P=[],D=w+r===t;let I;if(g=0,v=C,p=e[t=w],f=e[t+1],D){y(),I=Math.atan2(f-m,p-h),O&&(I+=I>0?-M:M);const e=(A+S)/2,t=(E+x)/2;return P[0]=[e,t,(T-o)/2,I,i],P}for(let e=0,d=(i=i.replace(/\\n/g,\" \")).length;e<d;){y();let S=Math.atan2(f-m,p-h);if(O&&(S+=S>0?-M:M),void 0!==I){let e=S-I;if(e+=e>M?-2*M:e<-M?2*M:0,Math.abs(e)>a)return null}I=S;const x=e;let w=0;for(;e<d;++e){const a=s*l(c,i[O?d-e-1:e],u);if(t+r<n&&v+g<o+w+a/2)break;w+=a}if(e===x)continue;const C=O?i.substring(d-x,d-e):i.substring(x,e);b=0===g?0:(o+w/2-v)/g;const T=(0,Wt.t7)(h,p,b),A=(0,Wt.t7)(m,f,b);P.push([T,A,w/2,S,C]),o+=w}return P}function Ts(e,t,n,r){let i=e[t],o=e[t+1],a=0;for(let s=t+r;s<n;s+=r){const t=e[s],n=e[s+1];a+=Math.sqrt((t-i)*(t-i)+(n-o)*(n-o)),i=t,o=n}return a}const As=(0,Gt.lJ)(),Es=[],Os=[],Ms=[],Ps=[];function Ds(e){return e[3].declutterBox}const Is=new RegExp(\"[\"+String.fromCharCode(1425)+\"-\"+String.fromCharCode(2303)+String.fromCharCode(64285)+\"-\"+String.fromCharCode(65023)+String.fromCharCode(65136)+\"-\"+String.fromCharCode(65276)+String.fromCharCode(67584)+\"-\"+String.fromCharCode(69631)+String.fromCharCode(124928)+\"-\"+String.fromCharCode(126975)+\"]\");function Ns(e,t){return\"start\"!==t&&\"end\"!==t||Is.test(e)||(t=\"start\"===t?\"left\":\"right\"),Ss[t]}function _s(e,t,n){return n>0&&e.push(\"\\n\",\"\"),e.push(t,\"\"),e}const js=class{constructor(e,t,n,r){this.overlaps=n,this.pixelRatio=t,this.resolution=e,this.alignFill_,this.instructions=r.instructions,this.coordinates=r.coordinates,this.coordinateCache_={},this.renderedTransform_=[1,0,0,1,0,0],this.hitDetectionInstructions=r.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=r.fillStates||{},this.strokeStates=r.strokeStates||{},this.textStates=r.textStates||{},this.widths_={},this.labels_={}}createLabel(e,t,n,r){const i=e+t+n+r;if(this.labels_[i])return this.labels_[i];const o=r?this.strokeStates[r]:null,a=n?this.fillStates[n]:null,s=this.textStates[t],l=this.pixelRatio,c=[s.scale[0]*l,s.scale[1]*l],u=Array.isArray(e),d=s.justify?Ss[s.justify]:Ns(Array.isArray(e)?e[0]:e,s.textAlign||Gr),p=r&&o.lineWidth?o.lineWidth:0,f=u?e:e.split(\"\\n\").reduce(_s,[]),{width:h,height:m,widths:g,heights:v,lineWidths:y}=function(e,t){const n=[],r=[],i=[];let o=0,a=0,s=0,l=0;for(let c=0,u=t.length;c<=u;c+=2){const d=t[c];if(\"\\n\"===d||c===u){o=Math.max(o,a),i.push(a),a=0,s+=l;continue}const p=t[c+1]||e.font,f=ti(p,d);n.push(f),a+=f;const h=$r(p);r.push(h),l=Math.max(l,h)}return{width:o,height:s,widths:n,heights:r,lineWidths:i}}(s,f),b=h+p,S=[],x=(b+2)*c[0],w=(m+p)*c[1],C={width:x<0?Math.floor(x):Math.ceil(x),height:w<0?Math.floor(w):Math.ceil(w),contextInstructions:S};1==c[0]&&1==c[1]||S.push(\"scale\",c),r&&(S.push(\"strokeStyle\",o.strokeStyle),S.push(\"lineWidth\",p),S.push(\"lineCap\",o.lineCap),S.push(\"lineJoin\",o.lineJoin),S.push(\"miterLimit\",o.miterLimit),S.push(\"setLineDash\",[o.lineDash]),S.push(\"lineDashOffset\",o.lineDashOffset)),n&&S.push(\"fillStyle\",a.fillStyle),S.push(\"textBaseline\",\"middle\"),S.push(\"textAlign\",\"center\");const T=.5-d;let A=d*b+T*p;const E=[],O=[];let M,P=0,D=0,I=0,N=0;for(let e=0,t=f.length;e<t;e+=2){const t=f[e];if(\"\\n\"===t){D+=P,P=0,A=d*b+T*p,++N;continue}const i=f[e+1]||s.font;i!==M&&(r&&E.push(\"font\",i),n&&O.push(\"font\",i),M=i),P=Math.max(P,v[I]);const o=[t,A+T*g[I]+d*(g[I]-y[N]),.5*(p+P)+D];A+=g[I],r&&E.push(\"strokeText\",o),n&&O.push(\"fillText\",o),++I}return Array.prototype.push.apply(S,E),Array.prototype.push.apply(S,O),this.labels_[i]=C,C}replayTextBackground_(e,t,n,r,i,o,a){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,n),e.lineTo.apply(e,r),e.lineTo.apply(e,i),e.lineTo.apply(e,t),o&&(this.alignFill_=o[2],this.fill_(e)),a&&(this.setStrokeStyle_(e,a),e.stroke())}calculateImageOrLabelDimensions_(e,t,n,r,i,o,a,s,l,c,u,d,p,f,h,m){let g=n-(a*=d[0]),v=r-(s*=d[1]);const y=i+l>e?e-l:i,b=o+c>t?t-c:o,S=f[3]+y*d[0]+f[1],x=f[0]+b*d[1]+f[2],w=g-f[3],C=v-f[0];let T;return(h||0!==u)&&(Es[0]=w,Ps[0]=w,Es[1]=C,Os[1]=C,Os[0]=w+S,Ms[0]=Os[0],Ms[1]=C+x,Ps[1]=Ms[1]),0!==u?(T=tr([1,0,0,1,0,0],n,r,1,1,u,-n,-r),er(T,Es),er(T,Os),er(T,Ms),er(T,Ps),(0,Gt.T9)(Math.min(Es[0],Os[0],Ms[0],Ps[0]),Math.min(Es[1],Os[1],Ms[1],Ps[1]),Math.max(Es[0],Os[0],Ms[0],Ps[0]),Math.max(Es[1],Os[1],Ms[1],Ps[1]),As)):(0,Gt.T9)(Math.min(w,w+S),Math.min(C,C+x),Math.max(w,w+S),Math.max(C,C+x),As),p&&(g=Math.round(g),v=Math.round(v)),{drawImageX:g,drawImageY:v,drawImageW:y,drawImageH:b,originX:l,originY:c,declutterBox:{minX:As[0],minY:As[1],maxX:As[2],maxY:As[3],value:m},canvasTransform:T,scale:d}}replayImageOrLabel_(e,t,n,r,i,o,a){const s=!(!o&&!a),l=r.declutterBox,c=e.canvas,u=a?a[2]*r.scale[0]/2:0;return l.minX-u<=c.width/t&&l.maxX+u>=0&&l.minY-u<=c.height/t&&l.maxY+u>=0&&(s&&this.replayTextBackground_(e,Es,Os,Ms,Ps,o,a),function(e,t,n,r,i,o,a,s,l,c,u){e.save(),1!==n&&(e.globalAlpha*=n),t&&e.setTransform.apply(e,t),r.contextInstructions?(e.translate(l,c),e.scale(u[0],u[1]),function(e,t){const n=e.contextInstructions;for(let e=0,r=n.length;e<r;e+=2)Array.isArray(n[e+1])?t[n[e]].apply(t,n[e+1]):t[n[e]]=n[e+1]}(r,e)):u[0]<0||u[1]<0?(e.translate(l,c),e.scale(u[0],u[1]),e.drawImage(r,i,o,a,s,0,0,a,s)):e.drawImage(r,i,o,a,s,l,c,a*u[0],s*u[1]),e.restore()}(e,r.canvasTransform,i,n,r.originX,r.originY,r.drawImageW,r.drawImageH,r.drawImageX,r.drawImageY,r.scale)),!0}fill_(e){if(this.alignFill_){const t=er(this.renderedTransform_,[0,0]),n=512*this.pixelRatio;e.save(),e.translate(t[0]%n,t[1]%n),e.rotate(this.viewRotation_)}e.fill(),this.alignFill_&&e.restore()}setStrokeStyle_(e,t){e.strokeStyle=t[1],e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.lineDashOffset=t[7],e.setLineDash(t[6])}drawLabelWithPointPlacement_(e,t,n,r){const i=this.textStates[t],o=this.createLabel(e,t,r,n),a=this.strokeStates[n],s=this.pixelRatio,l=Ns(Array.isArray(e)?e[0]:e,i.textAlign||Gr),c=Ss[i.textBaseline||Yr],u=a&&a.lineWidth?a.lineWidth:0;return{label:o,anchorX:l*(o.width/s-2*i.scale[0])+2*(.5-l)*u,anchorY:c*o.height/s+2*(.5-c)*u}}execute_(e,t,n,r,i,o,a,s){let l;var c,u;this.pixelCoordinates_&&ut(n,this.renderedTransform_)?l=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),l=Ii(this.coordinates,0,this.coordinates.length,2,n,this.pixelCoordinates_),u=n,(c=this.renderedTransform_)[0]=u[0],c[1]=u[1],c[2]=u[2],c[3]=u[3],c[4]=u[4],c[5]=u[5]);let d=0;const p=r.length;let f,h,m,g,v,y,b,S,x,w,C,T,A=0,E=0,O=0,M=null,P=null;const D=this.coordinateCache_,I=this.viewRotation_,N=Math.round(1e12*Math.atan2(-n[1],n[0]))/1e12,_={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:I},j=this.instructions!=r||this.overlaps?0:200;let k,L,R,Z;for(;d<p;){const n=r[d];switch(n[0]){case hs.BEGIN_GEOMETRY:k=n[1],Z=n[3],k.getGeometry()?void 0===a||(0,Gt.kK)(a,Z.getExtent())?++d:d=n[2]+1:d=n[2];break;case hs.BEGIN_PATH:E>j&&(this.fill_(e),E=0),O>j&&(e.stroke(),O=0),E||O||(e.beginPath(),g=NaN,v=NaN),++d;break;case hs.CIRCLE:A=n[1];const r=l[A],c=l[A+1],u=l[A+2]-r,p=l[A+3]-c,B=Math.sqrt(u*u+p*p);e.moveTo(r+B,c),e.arc(r,c,B,0,2*Math.PI,!0),++d;break;case hs.CLOSE_PATH:e.closePath(),++d;break;case hs.CUSTOM:A=n[1],f=n[2];const F=n[3],z=n[4],V=6==n.length?n[5]:void 0;_.geometry=F,_.feature=k,d in D||(D[d]=[]);const H=D[d];V?V(l,A,f,2,H):(H[0]=l[A],H[1]=l[A+1],H.length=2),z(H,_),++d;break;case hs.DRAW_IMAGE:A=n[1],f=n[2],S=n[3],h=n[4],m=n[5];let U=n[6];const G=n[7],Y=n[8],W=n[9],K=n[10];let q=n[11];const Q=n[12];let X=n[13];const J=n[14],$=n[15];if(!S&&n.length>=20){x=n[19],w=n[20],C=n[21],T=n[22];const e=this.drawLabelWithPointPlacement_(x,w,C,T);S=e.label,n[3]=S;const t=n[23];h=(e.anchorX-t)*this.pixelRatio,n[4]=h;const r=n[24];m=(e.anchorY-r)*this.pixelRatio,n[5]=m,U=S.height,n[6]=U,X=S.width,n[13]=X}let ee,te,ne,re;n.length>25&&(ee=n[25]),n.length>17?(te=n[16],ne=n[17],re=n[18]):(te=Wr,ne=!1,re=!1),K&&N?q+=I:K||N||(q-=I);let ie=0;for(;A<f;A+=2){if(ee&&ee[ie++]<X/this.pixelRatio)continue;const n=this.calculateImageOrLabelDimensions_(S.width,S.height,l[A],l[A+1],X,U,h,m,Y,W,q,Q,i,te,ne||re,k),r=[e,t,S,n,G,ne?M:null,re?P:null];if(s){if(\"none\"===J)continue;if(\"obstacle\"===J){s.insert(n.declutterBox);continue}{let e,t;if($){const n=f-A;if(!$[n]){$[n]=r;continue}if(e=$[n],delete $[n],t=Ds(e),s.collides(t))continue}if(s.collides(n.declutterBox))continue;e&&(s.insert(t),this.replayImageOrLabel_.apply(this,e)),s.insert(n.declutterBox)}}this.replayImageOrLabel_.apply(this,r)}++d;break;case hs.DRAW_CHARS:const oe=n[1],ae=n[2],se=n[3],le=n[4];T=n[5];const ce=n[6],ue=n[7],de=n[8];C=n[9];const pe=n[10];x=n[11],w=n[12];const fe=[n[13],n[13]],he=this.textStates[w],me=he.font,ge=[he.scale[0]*ue,he.scale[1]*ue];let ve;me in this.widths_?ve=this.widths_[me]:(ve={},this.widths_[me]=ve);const ye=Ts(l,oe,ae,2),be=Math.abs(ge[0])*ni(me,x,ve);if(le||be<=ye){const n=this.textStates[w].textAlign,r=Cs(l,oe,ae,2,x,(ye-be)*Ss[n],ce,Math.abs(ge[0]),ni,me,ve,N?0:this.viewRotation_);e:if(r){const n=[];let i,o,a,l,c;if(C)for(i=0,o=r.length;i<o;++i){c=r[i],a=c[4],l=this.createLabel(a,w,\"\",C),h=c[2]+(ge[0]<0?-pe:pe),m=se*l.height+2*(.5-se)*pe*ge[1]/ge[0]-de;const o=this.calculateImageOrLabelDimensions_(l.width,l.height,c[0],c[1],l.width,l.height,h,m,0,0,c[3],fe,!1,Wr,!1,k);if(s&&s.collides(o.declutterBox))break e;n.push([e,t,l,o,1,null,null])}if(T)for(i=0,o=r.length;i<o;++i){c=r[i],a=c[4],l=this.createLabel(a,w,T,\"\"),h=c[2],m=se*l.height-de;const o=this.calculateImageOrLabelDimensions_(l.width,l.height,c[0],c[1],l.width,l.height,h,m,0,0,c[3],fe,!1,Wr,!1,k);if(s&&s.collides(o.declutterBox))break e;n.push([e,t,l,o,1,null,null])}s&&s.load(n.map(Ds));for(let e=0,t=n.length;e<t;++e)this.replayImageOrLabel_.apply(this,n[e])}}++d;break;case hs.END_GEOMETRY:if(void 0!==o){k=n[1];const e=o(k,Z);if(e)return e}++d;break;case hs.FILL:j?E++:this.fill_(e),++d;break;case hs.MOVE_TO_LINE_TO:for(A=n[1],f=n[2],L=l[A],R=l[A+1],y=L+.5|0,b=R+.5|0,y===g&&b===v||(e.moveTo(L,R),g=y,v=b),A+=2;A<f;A+=2)L=l[A],R=l[A+1],y=L+.5|0,b=R+.5|0,A!=f-2&&y===g&&b===v||(e.lineTo(L,R),g=y,v=b);++d;break;case hs.SET_FILL_STYLE:M=n,this.alignFill_=n[2],E&&(this.fill_(e),E=0,O&&(e.stroke(),O=0)),e.fillStyle=n[1],++d;break;case hs.SET_STROKE_STYLE:P=n,O&&(e.stroke(),O=0),this.setStrokeStyle_(e,n),++d;break;case hs.STROKE:j?O++:e.stroke(),++d;break;default:++d}}E&&this.fill_(e),O&&e.stroke()}execute(e,t,n,r,i,o){this.viewRotation_=r,this.execute_(e,t,n,this.instructions,i,void 0,void 0,o)}executeHitDetection(e,t,n,r,i){return this.viewRotation_=n,this.execute_(e,1,t,this.hitDetectionInstructions,!0,r,i)}},ks=[\"Polygon\",\"Circle\",\"LineString\",\"Image\",\"Text\",\"Default\"],Ls={},Rs=class{constructor(e,t,n,r,i,o){this.maxExtent_=e,this.overlaps_=r,this.pixelRatio_=n,this.resolution_=t,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=[1,0,0,1,0,0],this.createExecutors_(i)}clip(e,t){const n=this.getClipCoords(t);e.beginPath(),e.moveTo(n[0],n[1]),e.lineTo(n[2],n[3]),e.lineTo(n[4],n[5]),e.lineTo(n[6],n[7]),e.clip()}createExecutors_(e){for(const t in e){let n=this.executorsByZIndex_[t];void 0===n&&(n={},this.executorsByZIndex_[t]=n);const r=e[t];for(const e in r){const t=r[e];n[e]=new js(this.resolution_,this.pixelRatio_,this.overlaps_,t)}}}hasExecutors(e){for(const t in this.executorsByZIndex_){const n=this.executorsByZIndex_[t];for(let t=0,r=e.length;t<r;++t)if(e[t]in n)return!0}return!1}forEachFeatureAtCoordinate(e,t,n,r,i,o){const a=2*(r=Math.round(r))+1,s=tr(this.hitDetectionTransform_,r+.5,r+.5,1/t,-1/t,-n,-e[0],-e[1]),l=!this.hitDetectionContext_;l&&(this.hitDetectionContext_=_t(a,a,void 0,{willReadFrequently:!0}));const c=this.hitDetectionContext_;let u;c.canvas.width!==a||c.canvas.height!==a?(c.canvas.width=a,c.canvas.height=a):l||c.clearRect(0,0,a,a),void 0!==this.renderBuffer_&&(u=(0,Gt.lJ)(),(0,Gt.Wj)(u,e),(0,Gt.f3)(u,t*(this.renderBuffer_+r),u));const d=function(e){if(void 0!==Ls[e])return Ls[e];const t=2*e+1,n=e*e,r=new Array(n+1);for(let i=0;i<=e;++i)for(let o=0;o<=e;++o){const a=i*i+o*o;if(a>n)break;let s=r[a];s||(s=[],r[a]=s),s.push(4*((e+i)*t+(e+o))+3),i>0&&s.push(4*((e-i)*t+(e+o))+3),o>0&&(s.push(4*((e+i)*t+(e-o))+3),i>0&&s.push(4*((e-i)*t+(e-o))+3))}const i=[];for(let e=0,t=r.length;e<t;++e)r[e]&&i.push(...r[e]);return Ls[e]=i,i}(r);let p;function f(e,t){const n=c.getImageData(0,0,a,a).data;for(let s=0,l=d.length;s<l;s++)if(n[d[s]]>0){if(!o||\"Image\"!==p&&\"Text\"!==p||o.includes(e)){const n=(d[s]-3)/4,o=r-n%a,l=r-(n/a|0),c=i(e,t,o*o+l*l);if(c)return c}c.clearRect(0,0,a,a);break}}const h=Object.keys(this.executorsByZIndex_).map(Number);let m,g,v,y,b;for(h.sort(at),m=h.length-1;m>=0;--m){const e=h[m].toString();for(v=this.executorsByZIndex_[e],g=ks.length-1;g>=0;--g)if(p=ks[g],y=v[p],void 0!==y&&(b=y.executeHitDetection(c,s,n,f,u),b))return b}}getClipCoords(e){const t=this.maxExtent_;if(!t)return null;const n=t[0],r=t[1],i=t[2],o=t[3],a=[n,r,n,o,i,o,i,r];return Ii(a,0,8,2,e,a),a}isEmpty(){return mt(this.executorsByZIndex_)}execute(e,t,n,r,i,o,a){const s=Object.keys(this.executorsByZIndex_).map(Number);let l,c,u,d,p,f;for(s.sort(at),this.maxExtent_&&(e.save(),this.clip(e,n)),o=o||ks,a&&s.reverse(),l=0,c=s.length;l<c;++l){const c=s[l].toString();for(p=this.executorsByZIndex_[c],u=0,d=o.length;u<d;++u)f=p[o[u]],void 0!==f&&f.execute(e,t,n,r,i,a)}this.maxExtent_&&e.restore()}},Zs=class extends gs{constructor(e,t,n,r,i,o,a){super(),this.context_=e,this.pixelRatio_=t,this.extent_=n,this.transform_=r,this.transformRotation_=r?(0,Wt.FH)(Math.atan2(r[1],r[0]),10):0,this.viewRotation_=i,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_=\"\",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=[1,0,0,1,0,0]}drawImages_(e,t,n,r){if(!this.image_)return;const i=Ii(e,t,n,r,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,s=o.globalAlpha;1!=this.imageOpacity_&&(o.globalAlpha=s*this.imageOpacity_);let l=this.imageRotation_;0===this.transformRotation_&&(l-=this.viewRotation_),this.imageRotateWithView_&&(l+=this.viewRotation_);for(let e=0,t=i.length;e<t;e+=2){const t=i[e]-this.imageAnchorX_,n=i[e+1]-this.imageAnchorY_;if(0!==l||1!=this.imageScale_[0]||1!=this.imageScale_[1]){const e=t+this.imageAnchorX_,r=n+this.imageAnchorY_;tr(a,e,r,1,1,l,-e,-r),o.setTransform.apply(o,a),o.translate(e,r),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.setTransform(1,0,0,1,0,0)}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,t,n,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(o.globalAlpha=s)}drawText_(e,t,n,r){if(!this.textState_||\"\"===this.text_)return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const i=Ii(e,t,n,r,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(0===this.transformRotation_&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);t<n;t+=r){const e=i[t]+this.textOffsetX_,n=i[t+1]+this.textOffsetY_;0!==a||1!=this.textScale_[0]||1!=this.textScale_[1]?(o.translate(e-this.textOffsetX_,n-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.setTransform(1,0,0,1,0,0)):(this.textStrokeState_&&o.strokeText(this.text_,e,n),this.textFillState_&&o.fillText(this.text_,e,n))}}moveToLineTo_(e,t,n,r,i){const o=this.context_,a=Ii(e,t,n,r,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let s=a.length;i&&(s-=2);for(let e=2;e<s;e+=2)o.lineTo(a[e],a[e+1]);return i&&o.closePath(),n}drawRings_(e,t,n,r){for(let i=0,o=n.length;i<o;++i)t=this.moveToLineTo_(e,t,n[i],r,!0);return t}drawCircle(e){if((0,Gt.kK)(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=function(e,t,n){const r=e.getFlatCoordinates();if(!r)return null;const i=e.getStride();return Ii(r,0,r.length,i,t,n)}(e,this.transform_,this.pixelCoordinates_),n=t[2]-t[0],r=t[3]-t[1],i=Math.sqrt(n*n+r*r),o=this.context_;o.beginPath(),o.arc(t[0],t[1],i,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}\"\"!==this.text_&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case\"Point\":this.drawPoint(e);break;case\"LineString\":this.drawLineString(e);break;case\"Polygon\":this.drawPolygon(e);break;case\"MultiPoint\":this.drawMultiPoint(e);break;case\"MultiLineString\":this.drawMultiLineString(e);break;case\"MultiPolygon\":this.drawMultiPolygon(e);break;case\"GeometryCollection\":this.drawGeometryCollection(e);break;case\"Circle\":this.drawCircle(e)}}drawFeature(e,t){const n=t.getGeometryFunction()(e);n&&(0,Gt.kK)(this.extent_,n.getExtent())&&(this.setStyle(t),this.drawGeometry(n))}drawGeometryCollection(e){const t=e.getGeometriesArray();for(let e=0,n=t.length;e<n;++e)this.drawGeometry(t[e])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),n=e.getStride();this.image_&&this.drawImages_(t,0,t.length,n),\"\"!==this.text_&&this.drawText_(t,0,t.length,n)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),n=e.getStride();this.image_&&this.drawImages_(t,0,t.length,n),\"\"!==this.text_&&this.drawText_(t,0,t.length,n)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,Gt.kK)(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,n=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(n,0,n.length,e.getStride(),!1),t.stroke()}if(\"\"!==this.text_){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getExtent();if((0,Gt.kK)(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,n=e.getFlatCoordinates();let r=0;const i=e.getEnds(),o=e.getStride();t.beginPath();for(let e=0,t=i.length;e<t;++e)r=this.moveToLineTo_(n,r,i[e],o,!1);t.stroke()}if(\"\"!==this.text_){const t=e.getFlatMidpoints();this.drawText_(t,0,t.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,Gt.kK)(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(\"\"!==this.text_){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,Gt.kK)(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,n=e.getOrientedFlatCoordinates();let r=0;const i=e.getEndss(),o=e.getStride();t.beginPath();for(let e=0,t=i.length;e<t;++e){const t=i[e];r=this.drawRings_(n,r,t,o)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(\"\"!==this.text_){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}}setContextFillState_(e){const t=this.context_,n=this.contextFillState_;n?n.fillStyle!=e.fillStyle&&(n.fillStyle=e.fillStyle,t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const t=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=e.lineCap&&(n.lineCap=e.lineCap,t.lineCap=e.lineCap),ut(n.lineDash,e.lineDash)||t.setLineDash(n.lineDash=e.lineDash),n.lineDashOffset!=e.lineDashOffset&&(n.lineDashOffset=e.lineDashOffset,t.lineDashOffset=e.lineDashOffset),n.lineJoin!=e.lineJoin&&(n.lineJoin=e.lineJoin,t.lineJoin=e.lineJoin),n.lineWidth!=e.lineWidth&&(n.lineWidth=e.lineWidth,t.lineWidth=e.lineWidth),n.miterLimit!=e.miterLimit&&(n.miterLimit=e.miterLimit,t.miterLimit=e.miterLimit),n.strokeStyle!=e.strokeStyle&&(n.strokeStyle=e.strokeStyle,t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const t=this.context_,n=this.contextTextState_,r=e.textAlign?e.textAlign:Gr;n?(n.font!=e.font&&(n.font=e.font,t.font=e.font),n.textAlign!=r&&(n.textAlign=r,t.textAlign=r),n.textBaseline!=e.textBaseline&&(n.textBaseline=e.textBaseline,t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=r,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:r,textBaseline:e.textBaseline})}setFillStrokeStyle(e,t){if(e){const t=e.getColor();this.fillState_={fillStyle:La(t||Fr)}}else this.fillState_=null;if(t){const e=t.getColor(),n=t.getLineCap(),r=t.getLineDash(),i=t.getLineDashOffset(),o=t.getLineJoin(),a=t.getWidth(),s=t.getMiterLimit(),l=r||Vr;this.strokeState_={lineCap:void 0!==n?n:zr,lineDash:1===this.pixelRatio_?l:l.map((e=>e*this.pixelRatio_)),lineDashOffset:(i||0)*this.pixelRatio_,lineJoin:void 0!==o?o:Hr,lineWidth:(void 0!==a?a:1)*this.pixelRatio_,miterLimit:void 0!==s?s:10,strokeStyle:La(e||Ur)}}else this.strokeState_=null}setImageStyle(e){let t;if(!e||!(t=e.getSize()))return void(this.image_=null);const n=e.getPixelRatio(this.pixelRatio_),r=e.getAnchor(),i=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=r[0]*n,this.imageAnchorY_=r[1]*n,this.imageHeight_=t[1]*n,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=i[0],this.imageOriginY_=i[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const o=e.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/n,o[1]*this.pixelRatio_/n],this.imageWidth_=t[0]*n}setTextStyle(e){if(e){const t=e.getFill();if(t){const e=t.getColor();this.textFillState_={fillStyle:La(e||Fr)}}else this.textFillState_=null;const n=e.getStroke();if(n){const e=n.getColor(),t=n.getLineCap(),r=n.getLineDash(),i=n.getLineDashOffset(),o=n.getLineJoin(),a=n.getWidth(),s=n.getMiterLimit();this.textStrokeState_={lineCap:void 0!==t?t:zr,lineDash:r||Vr,lineDashOffset:i||0,lineJoin:void 0!==o?o:Hr,lineWidth:void 0!==a?a:1,miterLimit:void 0!==s?s:10,strokeStyle:La(e||Ur)}}else this.textStrokeState_=null;const r=e.getFont(),i=e.getOffsetX(),o=e.getOffsetY(),a=e.getRotateWithView(),s=e.getRotation(),l=e.getScaleArray(),c=e.getText(),u=e.getTextAlign(),d=e.getTextBaseline();this.textState_={font:void 0!==r?r:Br,textAlign:void 0!==u?u:Gr,textBaseline:void 0!==d?d:Yr},this.text_=void 0!==c?Array.isArray(c)?c.reduce(((e,t,n)=>e+(n%2?\" \":t)),\"\"):c:\"\",this.textOffsetX_=void 0!==i?this.pixelRatio_*i:0,this.textOffsetY_=void 0!==o?this.pixelRatio_*o:0,this.textRotateWithView_=void 0!==a&&a,this.textRotation_=void 0!==s?s:0,this.textScale_=[this.pixelRatio_*l[0],this.pixelRatio_*l[1]]}else this.text_=\"\"}},Bs=.5,Fs={Point:function(e,t,n,r,i){const o=n.getImage(),a=n.getText();let s;if(o){if(2!=o.getImageState())return;let l=e;if(i){const c=o.getDeclutterMode();if(\"none\"!==c)if(l=i,\"obstacle\"===c){const i=e.getBuilder(n.getZIndex(),\"Image\");i.setImageStyle(o,s),i.drawPoint(t,r)}else a&&a.getText()&&(s={})}const c=l.getBuilder(n.getZIndex(),\"Image\");c.setImageStyle(o,s),c.drawPoint(t,r)}if(a&&a.getText()){let o=e;i&&(o=i);const l=o.getBuilder(n.getZIndex(),\"Text\");l.setTextStyle(a,s),l.drawText(t,r)}},LineString:function(e,t,n,r,i){const o=n.getStroke();if(o){const i=e.getBuilder(n.getZIndex(),\"LineString\");i.setFillStrokeStyle(null,o),i.drawLineString(t,r)}const a=n.getText();if(a&&a.getText()){const o=(i||e).getBuilder(n.getZIndex(),\"Text\");o.setTextStyle(a),o.drawText(t,r)}},Polygon:function(e,t,n,r,i){const o=n.getFill(),a=n.getStroke();if(o||a){const i=e.getBuilder(n.getZIndex(),\"Polygon\");i.setFillStrokeStyle(o,a),i.drawPolygon(t,r)}const s=n.getText();if(s&&s.getText()){const o=(i||e).getBuilder(n.getZIndex(),\"Text\");o.setTextStyle(s),o.drawText(t,r)}},MultiPoint:function(e,t,n,r,i){const o=n.getImage(),a=n.getText();let s;if(o){if(2!=o.getImageState())return;let l=e;if(i){const c=o.getDeclutterMode();if(\"none\"!==c)if(l=i,\"obstacle\"===c){const i=e.getBuilder(n.getZIndex(),\"Image\");i.setImageStyle(o,s),i.drawMultiPoint(t,r)}else a&&a.getText()&&(s={})}const c=l.getBuilder(n.getZIndex(),\"Image\");c.setImageStyle(o,s),c.drawMultiPoint(t,r)}if(a&&a.getText()){let o=e;i&&(o=i);const l=o.getBuilder(n.getZIndex(),\"Text\");l.setTextStyle(a,s),l.drawText(t,r)}},MultiLineString:function(e,t,n,r,i){const o=n.getStroke();if(o){const i=e.getBuilder(n.getZIndex(),\"LineString\");i.setFillStrokeStyle(null,o),i.drawMultiLineString(t,r)}const a=n.getText();if(a&&a.getText()){const o=(i||e).getBuilder(n.getZIndex(),\"Text\");o.setTextStyle(a),o.drawText(t,r)}},MultiPolygon:function(e,t,n,r,i){const o=n.getFill(),a=n.getStroke();if(a||o){const i=e.getBuilder(n.getZIndex(),\"Polygon\");i.setFillStrokeStyle(o,a),i.drawMultiPolygon(t,r)}const s=n.getText();if(s&&s.getText()){const o=(i||e).getBuilder(n.getZIndex(),\"Text\");o.setTextStyle(s),o.drawText(t,r)}},GeometryCollection:function(e,t,n,r,i){const o=t.getGeometriesArray();let a,s;for(a=0,s=o.length;a<s;++a)(0,Fs[o[a].getType()])(e,o[a],n,r,i)},Circle:function(e,t,n,r,i){const o=n.getFill(),a=n.getStroke();if(o||a){const i=e.getBuilder(n.getZIndex(),\"Circle\");i.setFillStrokeStyle(o,a),i.drawCircle(t,r)}const s=n.getText();if(s&&s.getText()){const o=(i||e).getBuilder(n.getZIndex(),\"Text\");o.setTextStyle(s),o.drawText(t,r)}}};function zs(e,t){return parseInt(bt(e),10)-parseInt(bt(t),10)}function Vs(e,t){return.5*e/t}function Hs(e,t,n,r,i,o,a){let s=!1;const l=n.getImage();if(l){const e=l.getImageState();2==e||3==e?l.unlistenImageChange(i):(0==e&&l.load(),l.listenImageChange(i),s=!0)}return function(e,t,n,r,i,o){const a=n.getGeometryFunction()(t);if(!a)return;const s=a.simplifyTransformed(r,i);n.getRenderer()?Us(e,s,n,t):(0,Fs[s.getType()])(e,s,n,t,o)}(e,t,n,r,o,a),s}function Us(e,t,n,r){if(\"GeometryCollection\"!=t.getType())e.getBuilder(n.getZIndex(),\"Default\").drawCustom(t,r,n.getRenderer(),n.getHitDetectionRenderer());else{const i=t.getGeometries();for(let t=0,o=i.length;t<o;++t)Us(e,i[t],n,r)}}const Gs=class extends fa{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=(0,Gt.lJ)(),this.wrappedRenderedExtent_=(0,Gt.lJ)(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(e,t,n){const r=t.extent,i=t.viewState,o=i.center,a=i.resolution,s=i.projection,l=i.rotation,c=s.getExtent(),u=this.getLayer().getSource(),d=t.pixelRatio,p=t.viewHints,f=!(p[0]||p[1]),h=this.compositionContext_,m=Math.round(t.size[0]*d),g=Math.round(t.size[1]*d),v=u.getWrapX()&&s.canWrapX(),y=v?(0,Gt.dz)(c):null,b=v?Math.ceil((r[2]-c[2])/y)+1:1;let S=v?Math.floor((r[0]-c[0])/y):0;do{const t=this.getRenderTransform(o,a,l,d,m,g,S*y);e.execute(h,1,t,l,f,void 0,n)}while(++S<b)}setupCompositionContext_(){if(1!==this.opacity_){const e=_t(this.context.canvas.width,this.context.canvas.height,da);this.compositionContext_=e}else this.compositionContext_=this.context}releaseCompositionContext_(){if(1!==this.opacity_){const e=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=e,jt(this.compositionContext_),da.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(e){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,e,e.declutterTree),this.releaseCompositionContext_())}renderFrame(e,t){const n=e.pixelRatio,r=e.layerStatesArray[e.layerIndex];!function(e,t,n){!function(e,t,n,r,i,o,a){e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=a}(e,t,0,0,n,0,0)}(this.pixelTransform,1/n,1/n),nr(this.inversePixelTransform,this.pixelTransform);const i=ir(this.pixelTransform);this.useContainer(t,i,this.getBackground(e));const o=this.context,a=o.canvas,s=this.replayGroup_,l=this.declutterExecutorGroup;if((!s||s.isEmpty())&&(!l||l.isEmpty()))return null;const c=Math.round(e.size[0]*n),u=Math.round(e.size[1]*n);a.width!=c||a.height!=u?(a.width=c,a.height=u,a.style.transform!==i&&(a.style.transform=i)):this.containerReused||o.clearRect(0,0,c,u),this.preRender(o,e);const d=e.viewState,p=d.projection;this.opacity_=r.opacity,this.setupCompositionContext_();let f=!1,h=!0;if(r.extent&&this.clipping){const t=(0,Yt.dY)(r.extent,p);h=(0,Gt.kK)(t,e.extent),f=h&&!(0,Gt.r4)(t,e.extent),f&&this.clipUnrotated(this.compositionContext_,e,t)}return h&&this.renderWorlds(s,e),f&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(o,e),this.renderedRotation_!==d.rotation&&(this.renderedRotation_=d.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(e){return new Promise((t=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const e=[this.context.canvas.width,this.context.canvas.height];er(this.pixelTransform,e);const t=this.renderedCenter_,n=this.renderedResolution_,r=this.renderedRotation_,i=this.renderedProjection_,o=this.wrappedRenderedExtent_,a=this.getLayer(),s=[],l=e[0]*Bs,c=e[1]*Bs;s.push(this.getRenderTransform(t,n,r,Bs,l,c,0).slice());const u=a.getSource(),d=i.getExtent();if(u.getWrapX()&&i.canWrapX()&&!(0,Gt.r4)(d,o)){let e=o[0];const i=(0,Gt.dz)(d);let a,u=0;for(;e<d[0];)--u,a=i*u,s.push(this.getRenderTransform(t,n,r,Bs,l,c,a).slice()),e+=i;for(u=0,e=o[2];e>d[2];)++u,a=i*u,s.push(this.getRenderTransform(t,n,r,Bs,l,c,a).slice()),e-=i}this.hitDetectionImageData_=function(e,t,n,r,i,o,a){const s=_t(e[0]*Bs,e[1]*Bs);s.imageSmoothingEnabled=!1;const l=s.canvas,c=new Zs(s,Bs,i,null,a),u=n.length,d=Math.floor(16777215/u),p={};for(let e=1;e<=u;++e){const t=n[e-1],a=t.getStyleFunction()||r;if(!r)continue;let s=a(t,o);if(!s)continue;Array.isArray(s)||(s=[s]);const l=(e*d).toString(16).padStart(7,\"#00000\");for(let e=0,n=s.length;e<n;++e){const n=s[e],r=n.getGeometryFunction()(t);if(!r||!(0,Gt.kK)(i,r.getExtent()))continue;const o=n.clone(),a=o.getFill();a&&a.setColor(l);const c=o.getStroke();c&&(c.setColor(l),c.setLineDash(null)),o.setText(void 0);const u=n.getImage();if(u&&0!==u.getOpacity()){const e=u.getImageSize();if(!e)continue;const t=_t(e[0],e[1],void 0,{alpha:!1}),n=t.canvas;t.fillStyle=l,t.fillRect(0,0,n.width,n.height),o.setImage(new $a({img:n,imgSize:e,anchor:u.getAnchor(),anchorXUnits:\"pixels\",anchorYUnits:\"pixels\",offset:u.getOrigin(),opacity:1,size:u.getSize(),scale:u.getScale(),rotation:u.getRotation(),rotateWithView:u.getRotateWithView()}))}const d=o.getZIndex()||0;let f=p[d];f||(f={},p[d]=f,f.Polygon=[],f.Circle=[],f.LineString=[],f.Point=[]);const h=r.getType();if(\"GeometryCollection\"===h){const e=r.getGeometriesArrayRecursive();for(let t=0,n=e.length;t<n;++t){const n=e[t];f[n.getType().replace(\"Multi\",\"\")].push(n,o)}}else f[h.replace(\"Multi\",\"\")].push(r,o)}}const f=Object.keys(p).map(Number).sort(at);for(let e=0,n=f.length;e<n;++e){const n=p[f[e]];for(const e in n){const r=n[e];for(let e=0,n=r.length;e<n;e+=2){c.setStyle(r[e+1]);for(let n=0,i=t.length;n<i;++n)c.setTransform(t[n]),c.drawGeometry(r[e])}}}return s.getImageData(0,0,l.width,l.height)}(e,s,this.renderedFeatures_,a.getStyleFunction(),o,n,r)}t(function(e,t,n){const r=[];if(n){const i=Math.floor(Math.round(e[0])*Bs),o=Math.floor(Math.round(e[1])*Bs),a=4*((0,Wt.uZ)(i,0,n.width-1)+(0,Wt.uZ)(o,0,n.height-1)*n.width),s=n.data[a],l=n.data[a+1],c=n.data[a+2]+256*(l+256*s),u=Math.floor(16777215/t.length);c&&c%u==0&&r.push(t[c/u-1])}return r}(e,this.renderedFeatures_,this.hitDetectionImageData_))}))}forEachFeatureAtCoordinate(e,t,n,r,i){if(!this.replayGroup_)return;const o=t.viewState.resolution,a=t.viewState.rotation,s=this.getLayer(),l={},c=function(e,t,n){const o=bt(e),a=l[o];if(a){if(!0!==a&&n<a.distanceSq){if(0===n)return l[o]=!0,i.splice(i.lastIndexOf(a),1),r(e,s,t);a.geometry=t,a.distanceSq=n}}else{if(0===n)return l[o]=!0,r(e,s,t);i.push(l[o]={feature:e,layer:s,geometry:t,distanceSq:n,callback:r})}};let u;const d=[this.replayGroup_];return this.declutterExecutorGroup&&d.push(this.declutterExecutorGroup),d.some((r=>u=r.forEachFeatureAtCoordinate(e,o,a,n,c,r===this.declutterExecutorGroup&&t.declutterTree?t.declutterTree.all().map((e=>e.value)):null))),u}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),n=t.getSource();if(!n)return!1;const r=e.viewHints[0],i=e.viewHints[1],o=t.getUpdateWhileAnimating(),a=t.getUpdateWhileInteracting();if(this.ready&&!o&&r||!a&&i)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const s=e.extent,l=e.viewState,c=l.projection,u=l.resolution,d=e.pixelRatio,p=t.getRevision(),f=t.getRenderBuffer();let h=t.getRenderOrder();void 0===h&&(h=zs);const m=l.center.slice(),g=(0,Gt.f3)(s,f*u),v=g.slice(),y=[g.slice()],b=c.getExtent();if(n.getWrapX()&&c.canWrapX()&&!(0,Gt.r4)(b,e.extent)){const e=(0,Gt.dz)(b),t=Math.max((0,Gt.dz)(g)/2,e);g[0]=b[0]-t,g[2]=b[2]+t,(0,Mr.Cf)(m,c);const n=(0,Gt.Cf)(y[0],c);n[0]<b[0]&&n[2]<b[2]?y.push([n[0]+e,n[1],n[2]+e,n[3]]):n[0]>b[0]&&n[2]>b[2]&&y.push([n[0]-e,n[1],n[2]-e,n[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==p&&this.renderedRenderOrder_==h&&(0,Gt.r4)(this.wrappedRenderedExtent_,g))return ut(this.renderedExtent_,v)||(this.hitDetectionImageData_=null,this.renderedExtent_=v),this.renderedCenter_=m,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const S=new ws(Vs(u,d),g,u,d);let x;this.getLayer().getDeclutter()&&(x=new ws(Vs(u,d),g,u,d));const w=(0,Yt.Cs)();let C;if(w){for(let e=0,t=y.length;e<t;++e){const t=y[e],r=(0,Yt.Fj)(t,c);n.loadFeatures(r,(0,Yt.on)(u,c),w)}C=(0,Yt.WO)(w,c)}else for(let e=0,t=y.length;e<t;++e)n.loadFeatures(y[e],u,c);const T=function(e,t){const n=Vs(e,t);return n*n}(u,d);let A=!0;const E=e=>{let n;const r=e.getStyleFunction()||t.getStyleFunction();if(r&&(n=r(e,u)),n){const t=this.renderFeature(e,T,n,S,C,x);A=A&&!t}},O=(0,Yt.Fj)(g,c),M=n.getFeaturesInExtent(O);h&&M.sort(h);for(let e=0,t=M.length;e<t;++e)E(M[e]);this.renderedFeatures_=M,this.ready=A;const P=S.finish(),D=new Rs(g,u,d,n.getOverlaps(),P,t.getRenderBuffer());return x&&(this.declutterExecutorGroup=new Rs(g,u,d,n.getOverlaps(),x.finish(),t.getRenderBuffer())),this.renderedResolution_=u,this.renderedRevision_=p,this.renderedRenderOrder_=h,this.renderedExtent_=v,this.wrappedRenderedExtent_=g,this.renderedCenter_=m,this.renderedProjection_=c,this.replayGroup_=D,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,n,r,i,o){if(!n)return!1;let a=!1;if(Array.isArray(n))for(let s=0,l=n.length;s<l;++s)a=Hs(r,e,n[s],t,this.boundHandleStyleImageChange_,i,o)||a;else a=Hs(r,e,n,t,this.boundHandleStyleImageChange_,i,o);return a}},Ys=class extends ls{constructor(e){super(e)}createRenderer(){return new Gs(this)}};var Ws=r(51523),Ks=r.n(Ws);function qs(e,t,n,r,i){if(e.hasFeatureAtPixel(t.pixel)){var o=e.getFeaturesAtPixel(t.pixel);if(o.length>0){var a=o[0],s=a.get(\"features\");s||i(),1===s.length?n(s[0]):r(a)}}else i()}function Qs(e){return Qs=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e},Qs(e)}function Xs(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Js=function(e,t,n,r){return function(i,o){var a=i.get(\"features\").length;return a>1&&r>0?e(i,o,a):t(i,o,n)}},$s=function(e){var t=e.mapSettings,n=e.mapInstance,r=e.clusterDistance,i=e.buildClusterStyle,o=e.buildSiteStyle,a=e.onSelect,s=e.onDoubleClick,l=e.onMouseover,c=e.showClusterList,u=function(e,t){var n=e.clusterDistance,r=e.buildClusterStyle,i=e.buildSiteStyle,o=new Na({}),a=new _a({distance:n,source:o});return new Ys({source:a,style:Js(r,i,t,n),zIndex:1e3})}({clusterDistance:r,buildClusterStyle:i,buildSiteStyle:o},t);return n.addLayer(u),function(e,t,n){if(!e.get(\"onPointermoveKey\")){var r=e.getTargetElement().style,i=Ks()((function(){r.cursor=\"\",window.olMouseInMarker&&(window.olMouseInMarker=null,n(null))}),300,{leading:!0}),o=e.on(\"pointermove\",(function(o){qs(e,o,(function(e){r.cursor=\"pointer\",window.olMouseInMarker=e,n(e)}),(function(e){r.cursor=\"pointer\",0===t&&(n(e),window.olMouseInMarker=e)}),i)}));e.set(\"onPointermoveKey\",o)}}(n,r,(function(e){l(e)})),function(e,t,n){if(!e.get(\"onClickKey\")){var r=e.on(\"click\",(function(t){qs(e,t,(function(e){!function(e){a(e)}(e.getProperties())}),(function(e){var t=e.get(\"features\");n(t)}),(function(){}))}));e.set(\"onClickKey\",r)}}(n,0,(function(e){n.getView().getZoom()>=20?c(e):wa(n,e.map((function(e){return{longitude:e.get(\"longitude\"),latitude:e.get(\"latitude\")}})))})),function(e){if(!e.get(\"onDoubleClickKey\")){var t=e.on(\"dblclick\",(function(t){qs(e,t,(function(e){!function(e){s(e)}(e.getProperties())}),(function(){}),(function(){}))}));e.set(\"onDoubleClickKey\",t)}}(n),u},el=function(e){e.getSource().getSource().clear()},tl=function(e,t){e.getSource().getSource().addFeatures(t)},nl=function(e,t){t&&e.removeLayer(t)},rl=function(e){var t=e.points;if(t){var n=t.map((function(e){var t=new Ta(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xs(Object(n),!0).forEach((function(t){var r,i,o,a;r=e,i=t,o=n[t],a=function(e){if(\"object\"!=Qs(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,\"string\");if(\"object\"!=Qs(n))return n;throw new TypeError(\"@@toPrimitive must return a primitive value.\")}return String(e)}(i),(i=\"symbol\"==Qs(a)?a:String(a))in r?Object.defineProperty(r,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xs(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({geometry:new io((0,Yt.mi)([e.longitude,e.latitude]))},e));return t}));return n}return[]},il=function(e){return e>1e6?\"\".concat(Math.floor(e/1e6),\"M+\"):e>1e3?\"\".concat(Math.floor(e/1e3),\"K+\"):e.toString()},ol=new Map,al=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.isCluster,i=void 0!==r&&r,o=n.clusterImage,a=void 0===o?\"images/cluster.png\":o,s=n.miniResolution,l=void 0===s?600:s,c=n.smallResolution,u=void 0===c?20:c,d=n.buildSiteImageUrl,p=void 0===d?function(){return\"\"}:d;if(i)return new $a({crossOrigin:\"anonymous\",src:(0,ce.default)(a)?a(e.get(\"features\"),t):a});var f=e.get(\"features\"),h=function(e,t,n){var r=n.buildSiteImageUrl,i=function(e,t){return e>t.miniResolution?\"mini\":e>t.smallResolution?\"small\":\"normal\"}(t,{miniResolution:n.miniResolution,smallResolution:n.smallResolution});return r(e,i)}((f?f[(null==f?void 0:f.length)-1]:e).getProperties(),t,{miniResolution:l,smallResolution:u,buildSiteImageUrl:p}),m=h.url,g=h.width,v=h.height,y=h.textOffset,b=\"\".concat(m).concat(g).concat(v);if(!ol.get(b)){var S=new Image(g,v);S.src=m;var x=new $a({crossOrigin:\"anonymous\",img:S,imgSize:[g,v]});ol.set(b,{key:b,icon:x,textOffset:y})}return ol.get(b)},sl=function(e,t){return new ts({text:il(e),font:\"\".concat(t,'px Titillium-Regular, \"Microsoft YaHei\"'),fill:new Va({color:\"#fff\"}),offsetY:2})},ll=function(e,t,n){return new ts({text:e,font:'12px Titillium-Regular, \"Microsoft YaHei\"',fill:new Va({color:t.isDark?\"rgba(255, 255, 255, 0.9)\":\"rgba(0, 0, 0, 0.9)\"}),offsetY:(null==n?void 0:n.y)||27})},cl=new Map,ul=function(e){return function(t,n,r){var i,o=al(t,n,{buildSiteImageUrl:function(t,n){return e(t,n,r)}}),a=o.key,s=o.icon,l=o.textOffset,c=t.get(\"features\")?t.get(\"features\")[0]:t;if(n<=20)(i=new qa({image:s})).setText(ll(c.get(\"name\"),r,l));else{if(!cl.get(a)){var u=new qa({image:s});cl.set(a,u)}i=cl.get(a)}return i}},dl=function(e){return function(t,n,r){var i=ue(r).url;return new qa({image:al(t,n,{isCluster:!0,clusterImage:e||i}),text:sl(r,e?11:16)})}},pl=function(e,t){return function(e,n,r){var i=e.get(\"features\")?e.get(\"features\")[0]:e,o=t(i.getProperties()),a=o.color,s=o.radius,l=new Va({color:a}),c=new qa({image:new Fa({fill:l,radius:s})});return n<=20&&c.setText(ll(i.get(\"name\"),r)),c}},fl=function(e){return function(t,n,r){return new qa({image:al(t,n,{isCluster:!0,clusterImage:e}),text:sl(r)})}};const hl=\"element\",ml=\"map\",gl=\"offset\",vl=\"position\",yl=\"positioning\",bl=class extends fn{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=void 0===e.insertFirst||e.insertFirst,this.stopEvent=void 0===e.stopEvent||e.stopEvent,this.element=document.createElement(\"div\"),this.element.className=void 0!==e.className?e.className:\"ol-overlay-container ol-selectable\",this.element.style.position=\"absolute\",this.element.style.pointerEvents=\"auto\",this.autoPan=!0===e.autoPan?{}:e.autoPan||void 0,this.rendered={transform_:\"\",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(hl,this.handleElementChanged),this.addChangeListener(ml,this.handleMapChanged),this.addChangeListener(gl,this.handleOffsetChanged),this.addChangeListener(vl,this.handlePositionChanged),this.addChangeListener(yl,this.handlePositioningChanged),void 0!==e.element&&this.setElement(e.element),this.setOffset(void 0!==e.offset?e.offset:[0,0]),this.setPositioning(e.positioning||\"top-left\"),void 0!==e.position&&this.setPosition(e.position)}getElement(){return this.get(hl)}getId(){return this.id}getMap(){return this.get(ml)||null}getOffset(){return this.get(gl)}getPosition(){return this.get(vl)}getPositioning(){return this.get(yl)}handleElementChanged(){Bt(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(Zt(this.element),Vt(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=Ft(e,fi,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(hl,e)}setMap(e){this.set(ml,e)}setOffset(e){this.set(gl,e)}setPosition(e){this.set(vl,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(vl))return;const n=this.getRect(t.getTargetElement(),t.getSize()),r=this.getElement(),i=this.getRect(r,[kt(r),Lt(r)]),o=void 0===(e=e||{}).margin?20:e.margin;if(!(0,Gt.r4)(n,i)){const r=i[0]-n[0],a=n[2]-i[2],s=i[1]-n[1],l=n[3]-i[3],c=[0,0];if(r<0?c[0]=r-o:a<0&&(c[0]=Math.abs(a)+o),s<0?c[1]=s-o:l<0&&(c[1]=Math.abs(l)+o),0!==c[0]||0!==c[1]){const n=t.getView().getCenterInternal(),r=t.getPixelFromCoordinateInternal(n);if(!r)return;const i=[r[0]+c[0],r[1]+c[1]],o=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(i),duration:o.duration,easing:o.easing})}}}getRect(e,t){const n=e.getBoundingClientRect(),r=n.left+window.pageXOffset,i=n.top+window.pageYOffset;return[r,i,r+t[0],i+t[1]]}setPositioning(e){this.set(yl,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?\"\":\"none\",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t)return void this.setVisible(!1);const n=e.getPixelFromCoordinate(t),r=e.getSize();this.updateRenderedPosition(n,r)}updateRenderedPosition(e,t){const n=this.element.style,r=this.getOffset(),i=this.getPositioning();this.setVisible(!0);let o=\"0%\",a=\"0%\";\"bottom-right\"==i||\"center-right\"==i||\"top-right\"==i?o=\"-100%\":\"bottom-center\"!=i&&\"center-center\"!=i&&\"top-center\"!=i||(o=\"-50%\"),\"bottom-left\"==i||\"bottom-center\"==i||\"bottom-right\"==i?a=\"-100%\":\"center-left\"!=i&&\"center-center\"!=i&&\"center-right\"!=i||(a=\"-50%\");const s=`translate(${o}, ${a}) translate(${Math.round(e[0]+r[0])+\"px\"}, ${Math.round(e[1]+r[1])+\"px\"})`;this.rendered.transform_!=s&&(this.rendered.transform_=s,n.transform=s)}getOptions(){return this.options}};function Sl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var xl=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(t<G||t>U)&&(t>0?(t-=Y,n++):(t+=Y,n--)),t>G&&t<U?n:e(t,n)},wl=function(e){var t=e.mapInstance,n=e.element;if(t){var r=new bl({element:n,autoPan:!0,autoPanAnimation:{duration:250},offset:[0,0]});return t.addOverlay(r),t.on(\"click\",(function(e){t.hasFeatureAtPixel(e.pixel)||r.setPosition(void 0)})),r}return null},Cl=function(e){var t=e.overlay,n=e.site,r=(e.offset,e.mapInstance),i=r.getOverlays().array_;i.length>1&&r.removeOverlay(i[0]);var o,a,s=(o=(n.isCluster?n.features[0]:n).getGeometry().flatCoordinates,a=2,function(e){if(Array.isArray(e))return e}(o)||function(e,t){var n=null==e?null:\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(null!=n){var r,i,o,a,s=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(o,a)||function(e,t){if(e){if(\"string\"==typeof e)return Sl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return\"Object\"===n&&e.constructor&&(n=e.constructor.name),\"Map\"===n||\"Set\"===n?Array.from(e):\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Sl(e,t):void 0}}(o,a)||function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}()),l=s[0],c=s[1],u=r.getView().getCenter(),d=(0,Yt.vs)(u,\"EPSG:3857\",\"EPSG:4326\")[0],p=(0,Yt.vs)([l,c],\"EPSG:3857\",\"EPSG:4326\"),f={lat:p[1],lng:p[0]},h=xl(d);(d>U||d<G)&&((d%=Y)>U||d<G)&&(d+=d>0?-360:Y);var m={lat:(0,Yt.vs)(u,\"EPSG:3857\",\"EPSG:4326\")[1],lng:d};d-p[0]<G&&h--,d-p[0]>U&&h++;var g=(0,Yt.vs)([h*Y+p[0]],\"EPSG:4326\",\"EPSG:3857\");t.setPositioning(be(m,f)),t.setPosition([g[0],c])},Tl=function(e){e.overlay.setPosition(void 0)},Al=function(e){var t=e.mapInstance,n=e.overlay;t&&n&&t.removeOverlay(n)},El=function(e){var t=e.getProperties(),n=t.features;return n&&n.length>0?n[n.length-1].getProperties():t};class Ol extends ki{constructor(e){super(),this.geometries_=e||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(Vt),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let e=0,t=this.geometries_.length;e<t;++e)this.changeEventsKeys_.push(Ft(this.geometries_[e],Xe,this.changed,this))}clone(){const e=new Ol(null);return e.setGeometries(this.geometries_),e.applyProperties(this),e}closestPointXY(e,t,n,r){if(r<(0,Gt.qf)(this.getExtent(),e,t))return r;const i=this.geometries_;for(let o=0,a=i.length;o<a;++o)r=i[o].closestPointXY(e,t,n,r);return r}containsXY(e,t){const n=this.geometries_;for(let r=0,i=n.length;r<i;++r)if(n[r].containsXY(e,t))return!0;return!1}computeExtent(e){(0,Gt.YN)(e);const t=this.geometries_;for(let n=0,r=t.length;n<r;++n)(0,Gt.l7)(e,t[n].getExtent());return e}getGeometries(){return Ml(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[];const t=this.geometries_;for(let n=0,r=t.length;n<r;++n)t[n].getType()===this.getType()?e=e.concat(t[n].getGeometriesArrayRecursive()):e.push(t[n]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=[],n=this.geometries_;let r=!1;for(let i=0,o=n.length;i<o;++i){const o=n[i],a=o.getSimplifiedGeometry(e);t.push(a),a!==o&&(r=!0)}if(r){const e=new Ol(null);return e.setGeometriesArray(t),e}return this.simplifiedGeometryMaxMinSquaredTolerance=e,this}getType(){return\"GeometryCollection\"}intersectsExtent(e){const t=this.geometries_;for(let n=0,r=t.length;n<r;++n)if(t[n].intersectsExtent(e))return!0;return!1}isEmpty(){return 0===this.geometries_.length}rotate(e,t){const n=this.geometries_;for(let r=0,i=n.length;r<i;++r)n[r].rotate(e,t);this.changed()}scale(e,t,n){n||(n=(0,Gt.qg)(this.getExtent()));const r=this.geometries_;for(let i=0,o=r.length;i<o;++i)r[i].scale(e,t,n);this.changed()}setGeometries(e){this.setGeometriesArray(Ml(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){const t=this.geometries_;for(let n=0,r=t.length;n<r;++n)t[n].applyTransform(e);this.changed()}translate(e,t){const n=this.geometries_;for(let r=0,i=n.length;r<i;++r)n[r].translate(e,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function Ml(e){const t=[];for(let n=0,r=e.length;n<r;++n)t.push(e[n].clone());return t}const Pl=Ol,Dl=class{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let n=t.dataProjection?(0,Yt.U2)(t.dataProjection):this.readProjection(e);t.extent&&n&&\"tile-pixels\"===n.getUnits()&&(n=(0,Yt.U2)(n),n.setWorldExtent(t.extent)),t={dataProjection:n,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},e)}getType(){return vt()}readFeature(e,t){return vt()}readFeatures(e,t){return vt()}readGeometry(e,t){return vt()}readProjection(e){return vt()}writeFeature(e,t){return vt()}writeFeatures(e,t){return vt()}writeGeometry(e,t){return vt()}};function Il(e,t,n){const r=n?(0,Yt.U2)(n.featureProjection):null,i=n?(0,Yt.U2)(n.dataProjection):null;let o;if(o=r&&i&&!(0,Yt.OP)(r,i)?(t?e.clone():e).transform(t?r:i,t?i:r):e,t&&n&&void 0!==n.decimals){const t=Math.pow(10,n.decimals),r=function(e){for(let n=0,r=e.length;n<r;++n)e[n]=Math.round(e[n]*t)/t;return e};o===e&&(o=e.clone()),o.applyTransform(r)}return o}function Nl(e){if(\"string\"==typeof e){return JSON.parse(e)||null}return null!==e?e:null}const _l=class extends Dl{constructor(){super()}getType(){return\"json\"}readFeature(e,t){return this.readFeatureFromObject(Nl(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(Nl(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return vt()}readFeaturesFromObject(e,t){return vt()}readGeometry(e,t){return this.readGeometryFromObject(Nl(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return vt()}readProjection(e){return this.readProjectionFromObject(Nl(e))}readProjectionFromObject(e){return vt()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return vt()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return vt()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return vt()}};function jl(e,t,n,r,i,o,a){let s,l;const c=(n-t)/r;if(1===c)s=t;else if(2===c)s=t,l=i;else if(0!==c){let o=e[t],a=e[t+1],c=0;const u=[0];for(let i=t+r;i<n;i+=r){const t=e[i],n=e[i+1];c+=Math.sqrt((t-o)*(t-o)+(n-a)*(n-a)),u.push(c),o=t,a=n}const d=i*c,p=function(e,t,n){let r,i;n=n||at;let o=0,a=e.length,s=!1;for(;o<a;)r=o+(a-o>>1),i=+n(e[r],t),i<0?o=r+1:(a=r,s=!i);return s?o:~o}(u,d);p<0?(l=(d-u[-p-2])/(u[-p-1]-u[-p-2]),s=t+(-p-2)*r):s=t+p*r}a=a>1?a:2,o=o||new Array(a);for(let t=0;t<a;++t)o[t]=void 0===s?NaN:void 0===l?e[s+t]:(0,Wt.t7)(e[s+t],e[s+r+t],l);return o}function kl(e,t,n,r,i,o){if(n==t)return null;let a;if(i<e[t+r-1])return o?(a=e.slice(t,t+r),a[r-1]=i,a):null;if(e[n-1]<i)return o?(a=e.slice(n-r,n),a[r-1]=i,a):null;if(i==e[t+r-1])return e.slice(t,t+r);let s=t/r,l=n/r;for(;s<l;){const t=s+l>>1;i<e[(t+1)*r-1]?l=t:s=t+1}const c=e[s*r-1];if(i==c)return e.slice((s-1)*r,(s-1)*r+r);const u=(i-c)/(e[(s+1)*r-1]-c);a=[];for(let t=0;t<r-1;++t)a.push((0,Wt.t7)(e[(s-1)*r+t],e[s*r+t],u));return a.push(i),a}class Ll extends Ri{constructor(e,t){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===t||Array.isArray(e[0])?this.setCoordinates(e,t):this.setFlatCoordinates(t,e)}appendCoordinate(e){this.flatCoordinates?ct(this.flatCoordinates,e):this.flatCoordinates=e.slice(),this.changed()}clone(){const e=new Ll(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,r){return r<(0,Gt.qf)(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Bi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),zi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,n,r))}forEachSegment(e){return bn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinateAtM(e,t){return\"XYM\"!=this.layout&&\"XYZM\"!=this.layout?null:(t=void 0!==t&&t,kl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t))}getCoordinates(){return Qi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(e,t){return jl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,this.stride)}getLength(){return Ts(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(e){const t=[];return t.length=Yi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new Ll(t,\"XY\")}getType(){return\"LineString\"}intersectsExtent(e){return Cn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ui(this.flatCoordinates,0,e,this.stride),this.changed()}}const Rl=Ll;class Zl extends Ri{constructor(e,t,n){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,t);else if(void 0!==t&&n)this.setFlatCoordinates(t,e),this.ends_=n;else{let t=this.getLayout();const n=e,r=[],i=[];for(let e=0,o=n.length;e<o;++e){const o=n[e];0===e&&(t=o.getLayout()),ct(r,o.getFlatCoordinates()),i.push(r.length)}this.setFlatCoordinates(t,r),this.ends_=i}}appendLineString(e){this.flatCoordinates?ct(this.flatCoordinates,e.getFlatCoordinates().slice()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Zl(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,n,r){return r<(0,Gt.qf)(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Fi(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Vi(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,n,r))}getCoordinateAtM(e,t,n){return\"XYM\"!=this.layout&&\"XYZM\"!=this.layout||0===this.flatCoordinates.length?null:(t=void 0!==t&&t,n=void 0!==n&&n,function(e,t,n,r,i,o,a){if(a)return kl(e,t,n[n.length-1],r,i,o);let s;if(i<e[r-1])return o?(s=e.slice(0,r),s[r-1]=i,s):null;if(e[e.length-1]<i)return o?(s=e.slice(e.length-r),s[r-1]=i,s):null;for(let o=0,a=n.length;o<a;++o){const a=n[o];if(t!=a){if(i<e[t+r-1])return null;if(i<=e[a-1])return kl(e,t,a,r,i,!1);t=a}}return null}(this.flatCoordinates,0,this.ends_,this.stride,e,t,n))}getCoordinates(){return Xi(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new Rl(this.flatCoordinates.slice(0===e?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){const e=this.flatCoordinates,t=this.ends_,n=this.layout,r=[];let i=0;for(let o=0,a=t.length;o<a;++o){const a=t[o],s=new Rl(e.slice(i,a),n);r.push(s),i=a}return r}getFlatMidpoints(){const e=[],t=this.flatCoordinates;let n=0;const r=this.ends_,i=this.stride;for(let o=0,a=r.length;o<a;++o){const a=r[o];ct(e,jl(t,n,a,i,.5)),n=a}return e}getSimplifiedGeometryInternal(e){const t=[],n=[];return t.length=function(e,t,n,r,i,o,a,s){for(let l=0,c=n.length;l<c;++l){const c=n[l];a=Yi(e,t,c,r,i,o,a),s.push(a),t=c}return a}(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,n),new Zl(t,\"XY\",n)}getType(){return\"MultiLineString\"}intersectsExtent(e){return function(e,t,n,r,i){for(let o=0,a=n.length;o<a;++o){if(Cn(e,t,n[o],r,i))return!0;t=n[o]}return!1}(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=Gi(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=0===n.length?0:n[n.length-1],this.changed()}}const Bl=Zl;class Fl extends Ri{constructor(e,t){super(),t&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendPoint(e){this.flatCoordinates?ct(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.changed()}clone(){const e=new Fl(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,r){if(r<(0,Gt.qf)(this.getExtent(),e,t))return r;const i=this.flatCoordinates,o=this.stride;for(let a=0,s=i.length;a<s;a+=o){const s=(0,Wt.bI)(e,t,i[a],i[a+1]);if(s<r){r=s;for(let e=0;e<o;++e)n[e]=i[a+e];n.length=o}}return r}getCoordinates(){return Qi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){const t=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return e<0||t<=e?null:new io(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){const e=this.flatCoordinates,t=this.layout,n=this.stride,r=[];for(let i=0,o=e.length;i<o;i+=n){const o=new io(e.slice(i,i+n),t);r.push(o)}return r}getType(){return\"MultiPoint\"}intersectsExtent(e){const t=this.flatCoordinates,n=this.stride;for(let r=0,i=t.length;r<i;r+=n){const n=t[r],i=t[r+1];if((0,Gt.jE)(e,n,i))return!0}return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ui(this.flatCoordinates,0,e,this.stride),this.changed()}}const zl=Fl;class Vl extends Ri{constructor(e,t,n){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(e[0])){let r=this.getLayout();const i=e,o=[],a=[];for(let e=0,t=i.length;e<t;++e){const t=i[e];0===e&&(r=t.getLayout());const n=o.length,s=t.getEnds();for(let e=0,t=s.length;e<t;++e)s[e]+=n;ct(o,t.getFlatCoordinates()),a.push(s)}t=r,e=o,n=a}void 0!==t&&n?(this.setFlatCoordinates(t,e),this.endss_=n):this.setCoordinates(e,t)}appendPolygon(e){let t;if(this.flatCoordinates){const n=this.flatCoordinates.length;ct(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let e=0,r=t.length;e<r;++e)t[e]+=n}else this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();this.endss_.push(t),this.changed()}clone(){const e=this.endss_.length,t=new Array(e);for(let n=0;n<e;++n)t[n]=this.endss_[n].slice();const n=new Vl(this.flatCoordinates.slice(),this.layout,t);return n.applyProperties(this),n}closestPointXY(e,t,n,r){return r<(0,Gt.qf)(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function(e,t,n,r,i){for(let o=0,a=n.length;o<a;++o){const a=n[o];i=Fi(e,t,a,r,i),t=a[a.length-1]}return i}(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),function(e,t,n,r,i,o,a,s,l,c,u){u=u||[NaN,NaN];for(let o=0,d=n.length;o<d;++o){const d=n[o];c=Vi(e,t,d,r,i,true,a,s,l,c,u),t=d[d.length-1]}return c}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,0,e,t,n,r))}containsXY(e,t){return function(e,t,n,r,i,o){if(0===n.length)return!1;for(let a=0,s=n.length;a<s;++a){const s=n[a];if(wn(e,t,s,r,i,o))return!0;t=s[s.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)}getArea(){return function(e,t,n,r){let i=0;for(let o=0,a=n.length;o<a;++o){const a=n[o];i+=eo(e,t,a,r),t=a[a.length-1]}return i}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let t;return void 0!==e?(t=this.getOrientedFlatCoordinates().slice(),uo(t,0,this.endss_,this.stride,e)):t=this.flatCoordinates,Ji(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=function(e,t,n,r){const i=[];let o=(0,Gt.lJ)();for(let a=0,s=n.length;a<s;++a){const s=n[a];o=(0,Gt.GN)(e,t,s[0],r),i.push((o[0]+o[2])/2,(o[1]+o[3])/2),t=s[s.length-1]}return i}(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=function(e,t,n,r,i){let o=[];for(let a=0,s=n.length;a<s;++a){const s=n[a];o=oo(e,t,s,r,i,2*a,o),t=s[s.length-1]}return o}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new zl(this.getFlatInteriorPoints().slice(),\"XYM\")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;!function(e,t,n,r){for(let i=0,o=n.length;i<o;++i){const o=n[i];if(!lo(e,t,o,r,undefined))return!1;o.length&&(t=o[o.length-1])}return!0}(e,0,this.endss_,this.stride)?(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=uo(this.orientedFlatCoordinates_,0,this.endss_,this.stride)):this.orientedFlatCoordinates_=e,this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],n=[];return t.length=function(e,t,n,r,i,o,a,s){for(let l=0,c=n.length;l<c;++l){const c=n[l],u=[];a=qi(e,t,c,r,i,o,a,u),s.push(u),t=c[c.length-1]}return a}(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,n),new Vl(t,\"XY\",n)}getPolygon(e){if(e<0||this.endss_.length<=e)return null;let t;if(0===e)t=0;else{const n=this.endss_[e-1];t=n[n.length-1]}const n=this.endss_[e].slice(),r=n[n.length-1];if(0!==t)for(let e=0,r=n.length;e<r;++e)n[e]-=t;return new fo(this.flatCoordinates.slice(t,r),this.layout,n)}getPolygons(){const e=this.layout,t=this.flatCoordinates,n=this.endss_,r=[];let i=0;for(let o=0,a=n.length;o<a;++o){const a=n[o].slice(),s=a[a.length-1];if(0!==i)for(let e=0,t=a.length;e<t;++e)a[e]-=i;const l=new fo(t.slice(i,s),e,a);r.push(l),i=s}return r}getType(){return\"MultiPolygon\"}intersectsExtent(e){return function(e,t,n,r,i){for(let o=0,a=n.length;o<a;++o){const a=n[o];if(An(e,t,a,r,i))return!0;t=a[a.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const n=function(e,t,n,r,i){i=i||[];let o=0;for(let a=0,s=n.length;a<s;++a){const s=Gi(e,t,n[a],r,i[o]);0===s.length&&(s[0]=t),i[o++]=s,t=s[s.length-1]}return i.length=o,i}(this.flatCoordinates,0,e,this.stride,this.endss_);if(0===n.length)this.flatCoordinates.length=0;else{const e=n[n.length-1];this.flatCoordinates.length=0===e.length?0:e[e.length-1]}this.changed()}}const Hl=Vl;function Ul(e,t){if(!e)return null;let n;switch(e.type){case\"Point\":n=function(e){return new io(e.coordinates)}(e);break;case\"LineString\":n=function(e){return new Rl(e.coordinates)}(e);break;case\"Polygon\":n=function(e){return new fo(e.coordinates)}(e);break;case\"MultiPoint\":n=function(e){return new zl(e.coordinates)}(e);break;case\"MultiLineString\":n=function(e){return new Bl(e.coordinates)}(e);break;case\"MultiPolygon\":n=function(e){return new Hl(e.coordinates)}(e);break;case\"GeometryCollection\":n=function(e){const t=e.geometries.map((function(e){return Ul(e,undefined)}));return new Pl(t)}(e);break;default:throw new Error(\"Unsupported GeoJSON type: \"+e.type)}return Il(n,!1,t)}function Gl(e,t){const n=(e=Il(e,!0,t)).getType();let r;switch(n){case\"Point\":r=function(e){return{type:\"Point\",coordinates:e.getCoordinates()}}(e);break;case\"LineString\":r=function(e){return{type:\"LineString\",coordinates:e.getCoordinates()}}(e);break;case\"Polygon\":r=function(e,t){let n;return t&&(n=t.rightHanded),{type:\"Polygon\",coordinates:e.getCoordinates(n)}}(e,t);break;case\"MultiPoint\":r=function(e){return{type:\"MultiPoint\",coordinates:e.getCoordinates()}}(e);break;case\"MultiLineString\":r=function(e){return{type:\"MultiLineString\",coordinates:e.getCoordinates()}}(e);break;case\"MultiPolygon\":r=function(e,t){let n;return t&&(n=t.rightHanded),{type:\"MultiPolygon\",coordinates:e.getCoordinates(n)}}(e,t);break;case\"GeometryCollection\":r=function(e,t){delete(t=Object.assign({},t)).featureProjection;return{type:\"GeometryCollection\",geometries:e.getGeometriesArray().map((function(e){return Gl(e,t)}))}}(e,t);break;case\"Circle\":r={type:\"GeometryCollection\",geometries:[]};break;default:throw new Error(\"Unsupported geometry type: \"+n)}return r}const Yl=class extends _l{constructor(e){e=e||{},super(),this.dataProjection=(0,Yt.U2)(e.dataProjection?e.dataProjection:\"EPSG:4326\"),e.featureProjection&&(this.defaultFeatureProjection=(0,Yt.U2)(e.featureProjection)),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=[\"application/geo+json\",\"application/vnd.geo+json\"]}readFeatureFromObject(e,t){let n=null;n=\"Feature\"===e.type?e:{type:\"Feature\",geometry:e,properties:null};const r=Ul(n.geometry,t),i=new Ta;return this.geometryName_?i.setGeometryName(this.geometryName_):this.extractGeometryName_&&\"geometry_name\"in n!==void 0&&i.setGeometryName(n.geometry_name),i.setGeometry(r),\"id\"in n&&i.setId(n.id),n.properties&&i.setProperties(n.properties,!0),i}readFeaturesFromObject(e,t){let n=null;if(\"FeatureCollection\"===e.type){n=[];const r=e.features;for(let e=0,i=r.length;e<i;++e)n.push(this.readFeatureFromObject(r[e],t))}else n=[this.readFeatureFromObject(e,t)];return n}readGeometryFromObject(e,t){return Ul(e,t)}readProjectionFromObject(e){const t=e.crs;let n;return t?\"name\"==t.type?n=(0,Yt.U2)(t.properties.name):\"EPSG\"===t.type?n=(0,Yt.U2)(\"EPSG:\"+t.properties.code):(0,tn.h)(!1,36):n=this.dataProjection,n}writeFeatureObject(e,t){t=this.adaptOptions(t);const n={type:\"Feature\",geometry:null,properties:null},r=e.getId();if(void 0!==r&&(n.id=r),!e.hasProperties())return n;const i=e.getProperties(),o=e.getGeometry();return o&&(n.geometry=Gl(o,t),delete i[e.getGeometryName()]),mt(i)||(n.properties=i),n}writeFeaturesObject(e,t){t=this.adaptOptions(t);const n=[];for(let r=0,i=e.length;r<i;++r)n.push(this.writeFeatureObject(e[r],t));return{type:\"FeatureCollection\",features:n}}writeGeometryObject(e,t){return Gl(e,this.adaptOptions(t))}};function Wl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Kl=new qa({stroke:new Ua({color:\"rgba(0, 180, 255, 1)\",width:2}),fill:new Va({color:\"rgba(12, 78, 127, 0.27)\"})}),ql=function(e){var t=e.mapInstance,n={type:\"FeatureCollection\",crs:{type:\"name\",properties:{name:\"EPSG:3857\"}},features:e.polygons.map((function(e){return{type:\"Feature\",geometry:{type:\"Polygon\",coordinates:[e.map((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(null!=n){var r,i,o,a,s=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(t,n)||function(e,t){if(e){if(\"string\"==typeof e)return Wl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return\"Object\"===n&&e.constructor&&(n=e.constructor.name),\"Map\"===n||\"Set\"===n?Array.from(e):\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Wl(e,t):void 0}}(t,n)||function(){throw new TypeError(\"Invalid attempt to destructure non-it