1,_isSelectingElement:!1,_hasEditInteraction:!1,_showRotateScale:!0,_paddingRight:0,_paddingBottom:0,_transparentSelectionEnable:R.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE,_debug:!1,_showShadowInEdit:!1,adjustBounds:function(t){if(B)this._rootCanvas=new O(t.width,t.height),this._topCanvas=new O(t.width,t.height),this.setViewRect(t.x,t.y,t.width,t.height);else{var e=!1,i=this._view.style;if(i.left==t.x+\"px\"&&i.top==t.y+\"px\"&&i.width==t.width+\"px\"&&i.height==t.height+\"px\"&&(e=!0),R.canvas.Network.superClass.adjustBounds.apply(this,arguments),1==e)return;var n=this._view.offsetWidth,s=this._view.offsetHeight;this._rootCanvas.setAttribute(\"width\",n),this._rootCanvas.setAttribute(\"height\",s),this._topCanvas.setAttribute(\"width\",n),this._topCanvas.setAttribute(\"height\",s),this.setViewRect(this.viewRect.x,this.viewRect.y,n,s)}void 0===R.gis&&(R.Util.makeHighRes(this._rootCanvas),R.Util.makeHighRes(this._topCanvas)),this.invalidateElementVisibility()},getLabel:function(t){return t.getStyle(\"network.label\")||t.getName()},getBackgroundImage:function(){return this._backgroundImage},setBackgroundImage:function(t){if(this._backgroundImage!=t){var e=this._backgroundImage;this._backgroundImage=t;var i=this._backgroundImage;if(i&&!i._viewRect)if(i.width>0)i._viewRect={x:0,y:0,width:i.width,height:i.height},this.validateCanvasSize(),this.firePropertyChange(\"backgroundImage\",e,i);else{var n=this;i.onload=function(){i._viewRect={x:0,y:0,width:i.width,height:i.height},n.validateCanvasSize(),n.firePropertyChange(\"backgroundImage\",e,i),i.onload=null}}else this.firePropertyChange(\"backgroundImage\",e,i),this.validateCanvasSize()}},getRootCanvas:function(){return this._rootCanvas},getTopCanvas:function(){return this._topCanvas},validateImpl:function(){if(!B&&ct.twm(this),1==this._invalidateElementVisibility){this._invalidateElementVisibility=!1;var t,e,i,n=this.getElementBox().getDatas()._as,s=n.length,o={},r=this._visibleFunction,a=1===this._box._layerBox.size()?this._box._layerBox._defaultLayer:null;for(t=0;t<s;t++)o[(e=n[t])._id]=this.isVisible(e,r,a);if(this._visibleMap)for(t=0;t<s;t++)o[(e=n[t])._id]!==this._visibleMap[e._id]&&(i=this._elementUIMap[e._id])&&i.invalidate();for(t=0;t<s;t++)e=n[t],(i=this._elementUIMap[e._id])&&i.validate();this._visibleMap=o,this.paintRoot()}this.validateCanvasSize(),1==this._repaintTopFlag&&(this._repaintTopFlag=!1,this.paintTopCanvas())},isLinkFlowEnabled:function(){return!!this._linkFlowEnabled},setLinkFlowEnabled:function(t){t?(this._linkFlowEnabled||(this._linkFlowEnabled=!0,this.firePropertyChange(\"linkFlowEnabled\",!1,!0)),clearInterval(this._linkFlowTimerId),this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval)):(this._linkFlowEnabled&&(this._linkFlowEnabled=!1,this.firePropertyChange(\"linkFlowEnabled\",!0,!1)),clearInterval(this._linkFlowTimerId),delete this._linkFlowTimerId)},getLinkFlowInterval:function(){return this._linkFlowInterval},setLinkFlowInterval:function(t){var e=this._linkFlowInterval;this._linkFlowInterval=t,this.firePropertyChange(\"linkFlowInterval\",e,t),clearInterval(this._linkFlowTimerId),this.isLinkFlowEnabled()&&(this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval))},getElementBox:function(){return this._box},setElementBox:function(t){if(!t)throw\"ElementBox can not be null\";if(this._box!==t){var e=this._box;e&&(e.removeDataBoxChangeListener(this.handleElementBoxChange,this),e.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),e.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),e.removeIndexChangeListener(this.handleIndexChange,this),e.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),e.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),e.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||e.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=t,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._flowLinkQuickFinder&&(this._flowLinkQuickFinder.dispose(),this._flowLinkQuickFinder=new R.QuickFinder(this._box,\"link.flow\",\"style\")),this._selectionModel?this._selectionModel._setDataBox(t):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.firePropertyChange(\"elementBox\",e,this._box)}},handleElementBoxChange:function(t){var e=t.data;if(\"add\"===t.kind)this.createElementUI(e),this.invalidateBundleLink(e);else if(\"remove\"===t.kind){var i=this.getElementUI(e);i&&(i.dispose(),delete this._elementUIMap[e.getId()]),e===this._currentSubNetwork&&null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null)}else if(\"clear\"===t.kind){for(var n in this._elementUIMap)this._elementUIMap[n]&&this._elementUIMap[n].dispose&&this._elementUIMap[n].dispose();this._elementUIMap={},null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null)}this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementPropertyChange:function(t){var e=t.source,i=this.getElementUI(e);i&&i.handlePropertyChange(t),this.invalidateBundleLink(e),this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementBoxPropertyChange:function(){this.invalidateElementVisibility()},handleIndexChange:function(t){this.invalidateElementVisibility()},handleLayerBoxChange:function(){this.invalidateElementVisibility()},handleLayerPropertyChange:function(t){\"editable\"===t.property&&this.invalidateSelectedElementUIs(!0),this.invalidateElementVisibility()},handleLayerHierarchyChange:function(){this.invalidateElementVisibility()},handleSelectionChange:function(t){t.datas.forEach(function(e){var i=this.getElementUI(e);i&&i.handleSelectionChange(t)},this);var e=this.getSelectionModel().getLastData();e&&(\"append\"!==t.kind&&\"set\"!==t.kind||(this.isMakeVisibleOnSelected()&&this.makeVisible(e),this.isSendToTopOnSelected()&&this.sendToTop(e))),this.invalidateElementVisibility()},sendToTop:function(t){if(this._box.contains(t)){for(var e=t;e._parent&&this.isVisible(e._parent)&&(e=e._parent););e!==t&&this._box.adjustElementIndex(e),this._box.adjustElementIndex(t)}},getScopeRect:function(t){var e=this._zoom;if(\"viewsize\"===t)return{x:this._unionBounds.x-this.viewRect.x,y:this._unionBounds.y-this.viewRect.y,width:this._unionBounds.width,height:this._unionBounds.height};if(\"viewport\"===t){if(this.viewRect)return D.cloneRect(this.viewRect)}else if(\"rootcanvas\"===t)return{x:this.viewRect.x,y:this.viewRect.y,width:(Math.abs(this.viewRect.x-this._unionBounds.x)+this._unionBounds.width)*e,height:(Math.abs(this.viewRect.y-this._unionBounds.y)+this._unionBounds.height)*e};return{x:0,y:0,width:0,height:0}},getViewRect:function(){return this.viewRect?D.clone(this.viewRect):{x:0,y:0,width:0,height:0}},getCanvasSize:function(){return{width:this.realWidth,height:this.realHeight}},getUnionBounds:function(){return this._unionBounds},setViewOffSet:function(t,e){var i=this.viewRect.x,n=this.viewRect.y,s=this.viewRect.width,o=this.viewRect.height;this.setViewRect(i+t,n+e,s,o)},setViewRect:function(t,e,i,n){1==this.isLimitViewInCanvas()&&(t<0&&(t=0),i>this.realWidth?t=0:t+i>this.realWidth&&(t=this.realWidth-i),e<0&&(e=0),n>this.realHeight?e=0:e+n>this.realHeight&&(e=this.realHeight-n));var s=this.viewRect;null!=this.viewRect&&t==this.viewRect.x&&e==this.viewRect.y&&i==this.viewRect.width&&n==this.viewRect.height||(this.viewRect={x:t,y:e,width:i,height:n},this.firePropertyChange(\"viewRect\",s,this.viewRect),this.invalidateElementVisibility())},isHScrollBarVisible:function(){return this.hScrollBarVisible},setHScrollBarVisible:function(t){this.hScrollBarVisible=t},isVScrollBarVisible:function(){return this.vScrollBarVisible},setVScrollBarVisible:function(t){this.vScrollBarVisible=t},dispose:function(){R.imageUtil.removeEventListener(this.invalidateElementUIs,this);for(var t in this._elementUIMap){var e=this._elementUIMap[t];e.curInterval&&clearTimeout(e.curInterval)}this.setInteractions(null)},invalidateElementVisibility:function(){this._invalidateElementVisibility||(this._invalidateElementVisibility=!0,this.invalidate())},repaintTopCanvas:function(){this._repaintTopFlag||(this._repaintTopFlag=!0,this.invalidate())},invalidateCanvasSize:function(t){this._invalidateCanvasSizeFlag||(this._invalidateCanvasSizeFlag=!0,this.invalidate())},validateCanvasSize:function(){0!=this._invalidateCanvasSizeFlag&&(this._invalidateCanvasSizeFlag=!1,this._validateCanvasSize())},_validateCanvasSize:function(){if(!this.isMovingElement()){if(0==this.isAutoValidateCanvasSize())return this.realWidth=0,this.realHeight=0,void(this._unionBounds={x:0,y:0,width:0,height:0});var t=this.getElementBox().getDatas(),e=t.size();if(e>0){for(var i={x:0,y:0,width:0,height:0},n=0;n<e;n++){var s=t.get(n);if(this._visibleMap[s._id]){var o=this._elementUIMap[s._id];o&&(i=W.unionRect(i,o._viewRect))}}var r=this.getBackgroundImage();if(r&&(i=W.unionRect(i,r._viewRect)),this.realWidth==(i.x+i.width)*this.getZoom()&&this.realHeight==(i.y+i.height)*this.getZoom())return;var a=this.getZoom();this.realWidth=(i.x+i.width)*a+this._paddingRight,this.realHeight=(i.y+i.height)*a+this._paddingBottom,this._unionBounds={x:i.x*a,y:i.y*a,width:i.width*a+this._paddingRight,height:i.height*a+this._paddingRight}}else this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0};this.setViewRect(this.viewRect.x,this.viewRect.y,this.viewRect.width,this.viewRect.height),this.firePropertyChange(\"canvasSizeChange\",null,this.viewRect)}},getElementUI:function(t){return null==t?null:this._elementUIMap[t._id]},createElementUI:function(t){var e=this._elementUIMap[t.getId()];e||(e=this._elementUIFunction(this,t))&&(this._elementUIMap[t.getId()]=e)},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(t){if(!t)throw\"ElementUIFunction can not be null\";if(this._elementUIFunction!==t){var e=this._elementUIFunction;this._elementUIFunction=t,this.firePropertyChange(\"elementUIFunction\",e,t),this._box.isEmpty()||(this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize())}},invalidateElementUI:function(t,e){var i=this.getElementUI(t);i&&i.invalidate(e)},invalidateElementUIs:function(t){for(var e in this._elementUIMap){this._elementUIMap[e].invalidate(t)}},invalidateSelectedElementUIs:function(t){this.getSelectionModel().getSelection().forEach(function(e){this.invalidateElementUI(e,t)},this)},invalidateBundleLink:function(t){if(t instanceof R.Link&&t._bundleLinks){var e=this._elementUIMap;t._bundleLinks.forEachSiblingLink(function(i){if(i!==t){var n=e[i._id];n&&n.invalidate(!1)}},this)}},paintRoot:function(){var t=this._rootCanvas.getContext(\"2d\");if(t.clearRect(0,0,this._rootCanvas.width,this._rootCanvas.height),this.visibleList=new R.List,this._topAttachmentList=new R.List,null!=this.getElementBox()){ne.draw(t,this);var e=this.getElementBox().getDatas()._as,i=e.length;t.save(),t.scale(this.getZoom(),this.getZoom()),t.translate(-this.viewRect.x/this.getZoom(),-this.viewRect.y/this.getZoom()),this.paintBottom(t);var n={x:this.viewRect.x/this.getZoom(),y:this.viewRect.y/this.getZoom(),width:this.viewRect.width/this.getZoom(),height:this.viewRect.height/this.getZoom()},s=this.getBackgroundImage(),o=this.getBackgroundImageRect();if(s instanceof F&&(o?t.drawImage(s,o.x,o.y,o.width,o.height):t.drawImage(s,0,0,s.width,s.height),s._viewRect={x:0,y:0,width:s.width,height:s.height}),\"string\"==typeof s){var r=D.getImageAsset(s),a={x:0,y:0,width:r.getWidth(),height:r.getHeight()};Dt(t,s,null,a,null,this)}var h,l,c,d,u=this._box._layerBox;if(1===u.size())for(h=0;h<i;h++)l=e[h],this._visibleMap[l._id]&&(null!=(c=this._elementUIMap[l._id])&&this._isInView(c,n)?(c.paint(t),c.setAttachmentVisible&&c.setAttachmentVisible(!0),this.visibleList.add(l)):c.setAttachmentVisible&&c.setAttachmentVisible(!1));else u.forEachByDepthFirst(function(s){for(h=0;h<i;h++)l=e[h],u.getLayerByElement(l)===s&&this._visibleMap[l._id]&&(null!=(c=this._elementUIMap[l._id])&&this._isInView(c,n)?(c.paint(t),c.setAttachmentVisible&&c.setAttachmentVisible(!0),this.visibleList.add(l)):c.setAttachmentVisible&&c.setAttachmentVisible(!1))},null,this);for(i=this._topAttachmentList.size(),h=0;h<i;h++)(d=this._topAttachmentList.get(h)).getElementUI().paintAttachment(t,d);if(this._xyz){var _=this._xyz,g=_.markText,f=_.type,v=(_.expired,_.innerHTML),m=0,p=0,w=this.viewRect;t.translate(this.viewRect.x/this.getZoom(),this.viewRect.y/this.getZoom()),t.scale(1/this.getZoom(),1/this.getZoom());this.getZoom();void 0!=g&&null!=g&&\"\"!=g||\"2\"==f?(t.font=\"15px Arial sans-serif\",i=D.g.getTextSize(t.font,v),t.fillStyle=\"red\",m=w.width-i.width,p=w.height-20):(t.font=\"10px Arial sans-serif\",i=D.g.getTextSize(t.font,v),m=w.width/2-i.width/2,p=w.height/2),t.fillText(v,m,p)}t.restore()}},paintBottom:function(t){},_isInView:function(t,e){return W.intersects(e,t._viewRect)},paintTopCanvas:function(){var t=this._topCanvas.getContext(\"2d\");t.clearRect(0,0,this._topCanvas.width,this._topCanvas.height),this.paintMarker(t)},paintMarker:function(t){for(var e=this.markerList.size(),i=0;i<e;i++){this.markerList.get(i).paint(t)}},getLayerByElement:function(t){return this._box.getLayerBox().getLayerByElement(t)},getLogicalPoint:function(t){if(V.isTouchable&&t.changedTouches&&t.changedTouches.length>0){var e=this._view.getBoundingClientRect(),i=t.changedTouches[0],n=V.isAndroid?0:yt.scrollLeft(),s=V.isAndroid?0:yt.scrollTop();return{x:(i.clientX+this.viewRect.x-e.left-n)/this._zoom,y:(i.clientY+this.viewRect.y-e.top-s)/this._zoom}}return V.isFirefox?{x:(t.layerX+this.viewRect.x)/this.getZoom(),y:(t.layerY+this.viewRect.y)/this.getZoom()}:{x:(t.offsetX+this.viewRect.x)/this.getZoom(),y:(t.offsetY+this.viewRect.y)/this.getZoom()}},getElementAt:function(t,e){if(null==this.visibleList)return null;1===arguments.length&&(e=!0);var i,n;if(t.target?i=this.getLogicalPoint(t):t.event?t.event.target&&(i=this.getLogicalPoint(t.event)):i=t,null!=this._topAttachmentList)for(var s=this._topAttachmentList.size()-1;s>=0;s--){var o=this._topAttachmentList.get(s);if(n=o.getElement(),(!e||this.isSelectable(n))&&o.hit(i.x,i.y))return n}if(null!=this.visibleList)for(var r=this.visibleList.size()-1;r>=0;r--){var a=this.visibleList.get(r),h=this.getElementUI(a);if((!e||this.isSelectable(a))&&h&&h.hit(i.x,i.y))return a}return null},hitTest:function(t){var e=this.getElementAt(t);if(!e)return null;var i=this.getElementUI(e);if(!i)return null;var n;return n=t.target?this.getLogicalPoint(t):t,i.hitTest(n.x,n.y)},getElementsAtRect:function(t,e,i,n){var s=new R.List;if(null==this.visibleList)return s;n=void 0===n||n;for(var o=this.visibleList.size()-1;o>=0;o--){var r=this.visibleList.get(o),a=this.getElementUI(r);a&&(!i||i(a._element))&&(n&&this.isSelectable(a._element)||!n)&&(e?a.intersects(t)&&s.add(r):W.contains(t,a.getViewRect())&&s.add(r))}return s},getPosition:function(t,e,i,n,s){var o,r=e instanceof R.canvas.ElementUI?e:this.getElementUI(e);if(r)if(\"from\"===t||\"to\"===t){if(r.getFromPosition&&(o=\"from\"===t?r.getFromPosition(n,s):r.getToPosition(n,s)))return i?{x:o.x-i.width/2,y:o.y-i.height/2}:o}else o=\"hotspot\"===t?r.getHotSpot():G.get(t,r.getBodyRect(),i);if(!o&&e.getRect&&(o=G.get(t,e.getRect(),i)),o)return{x:o.x+n,y:o.y+s};throw\"position '\"+t+\"' object '\"+e+\"'\"},isValidEvent:function(t){if(!t)return!1;var e,i;if(t.currentTarget===this._view){if(V.isFirefox?(e=t.layerX,i=t.layerY):(e=t.offsetX,i=t.offsetY),1==this.isHScrollBarVisible()&&i>=this.viewRect.height-this.getScrollBarWidth())return!1;if(1==this.isVScrollBarVisible()&&e>=this.viewRect.width-this.getScrollBarWidth())return!1}return!0},addMarker:function(t){this.markerList.add(t),this.repaintTopCanvas()},removeMarker:function(t){this.markerList.remove(t),this.repaintTopCanvas()},clearMarker:function(){this.markerList.clear(),this.repaintTopCanvas()},isMovable:function(t){return!!this._box.contains(t)&&(!(t instanceof R.Link)&&(!(this._movableFunction&&!this._movableFunction(t))&&this.getLayerByElement(t).isMovable()))},hasMovableSelectedElements:function(){for(var t=this.getSelectionModel().getSelection(),e=0;e<t.size();e++){var i=t.get(e);if(this.isMovable(i))return!0}return!1},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(t){return this.isMovable(t)},this)},moveSelectedElements:function(t,e,i,n){if(0!==t||0!==e){var s=this.getMovableSelectedElementsRect();null!=s&&(this._limitElementInPositiveLocation&&(s.x+t<0&&(t=-s.x),s.y+e<0&&(e=-s.y)),R.Util.moveElements(this.getMovableSelectedElements(),t,e,i,n,this))}},getMovableSelectedElementsRect:function(){var t=this.getMovableSelectedElements();if(0===t.size())return null;for(var e=null,i=0,n=t.size();i<n;i++){var s=t.get(i);if(s instanceof Pe){var o=this.getElementUI(s);o&&(e=W.unionRect(e,o.getViewRect()))}}return e},isVisible:function(t,e,i){if(!this._box.contains(t))return!1;if(!t.isVisible())return!1;if(3!==arguments.length&&(e=this._visibleFunction),e&&!e(t))return!1;if(!(i||this._box._layerBox.getLayerByElement(t))._visible)return!1;if(vt.getSubNetwork(t)!==this._currentSubNetwork)return!1;if(t instanceof R.Link){if(!this._noAgentLinkVisible){if(!t._fromAgent||!t._toAgent)return!1;if(!this.isVisible(t._fromAgent,e,i)||!this.isVisible(t._toAgent,e,i))return!1}if(t.getBundleIndex()>0&&t.getBundleCount()>1&&!t.getStyle(\"link.bundle.expanded\"))return!1}else for(var n=t._parent;n&&!n.ISubNetwork;){if(n instanceof R.Group&&(!n.isExpanded()||!this.isVisible(n,e,i)))return!1;n=n._parent}return!t.IDummy},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(t){var e=this._visibleFunction;this._visibleFunction=t,this.firePropertyChange(\"visibleFunction\",e,t),this.invalidateElementVisibility()},isEditable:function(t){return!!this._box.contains(t)&&(!(this._editableFunction&&!this._editableFunction(t))&&this.getLayerByElement(t).isEditable())},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(t){var e=this._editableFunction;this._editableFunction=t,this.firePropertyChange(\"editableFunction\",e,t),this.invalidateSelectedElementUIs(!0)},isRotatable:function(t){return!(this._rotatableFunction&&!this._rotatableFunction(t))},getRotatableFunction:function(){return this._rotatableFunction},setRotatableFunction:function(t){var e=this._rotatableFunction;this._rotatableFunction=t,this.firePropertyChange(\"rotatableFunction\",e,t),this.invalidateSelectedElementUIs(!0)},isLinkable:function(t){return null==this._linkableFunction||this._linkableFunction(t)},getLinkableFunction:function(){return this._linkableFunction},setLinkableFunction:function(t){var e=this._linkableFunction;this._linkableFunction=t,this.firePropertyChange(\"linkableFunction\",e,t),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getShadowColor:function(t){var e=t.getStyle(\"shadow.color\");return!e&&this.isSelected(t)&&\"shadow\"===t.getStyle(\"select.style\")?t.getStyle(\"select.color\"):e},getSelectColor:function(t){return t.getStyle(\"select.color\")},getAlarmLabel:function(t){var e=t.getAlarmState().getHighestNewAlarmSeverity();if(e){var i=t.getAlarmState().getNewAlarmCount(e)+e.nickName;return t.getAlarmState().hasLessSevereNewAlarms()&&(i+=\"+\"),i}return null},getLinkHandlerLabel:function(t){return t.isBundleAgent()?\"+(\"+t.getBundleCount()+\")\":null},setInteractions:function(t){var e=this._interactions;e&&e.forEach(function(t){t.tearDown()}),this._interactions=t,t&&t.forEach(function(t){t.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange(\"interactions\",e,t)},getInteractions:function(){return this._interactions},setDefaultInteractions:function(t,e){var i=[new R.canvas.interaction.DefaultInteraction(this),new R.canvas.interaction.SelectInteraction(this),new R.canvas.interaction.MoveInteraction(this,t),new R.canvas.interaction.ScrollInteraction(this)];e&&i.push(new R.canvas.interaction.MoveLinkInteraction(this,t)),this.setInteractions(i)},setTouchInteractions:function(){this.setInteractions([new R.canvas.interaction.DefaultInteraction(this),new R.canvas.interaction.SelectInteraction(this),new R.canvas.interaction.MoveInteraction(this,!1),new R.canvas.interaction.ScrollInteraction(this),new R.canvas.interaction.TouchInteraction(this)])},setMSTouchInteractions:function(){this.setInteractions([new R.canvas.interaction.ScrollInteraction(this),new R.canvas.interaction.MSTouchInteraction(this)])},setEditInteractions:function(t){this.setInteractions([new R.canvas.interaction.DefaultInteraction(this),new R.canvas.interaction.SelectInteraction(this),new R.canvas.interaction.EditInteraction(this,t),new R.canvas.interaction.MoveInteraction(this,t),new R.canvas.interaction.ScrollInteraction(this)])},setCreateElementInteractions:function(t){this.setInteractions([new R.canvas.interaction.DefaultInteraction(this),new R.canvas.interaction.CreateElementInteraction(this,t)])},setCreateLinkInteractions:function(t){this.setInteractions([new R.canvas.interaction.DefaultInteraction(this),new R.canvas.interaction.CreateLinkInteraction(this,t),new R.canvas.interaction.ScrollInteraction(this)])},setCreateShapeLinkInteractions:function(t){this.setInteractions([new R.canvas.interaction.DefaultInteraction(this),new R.canvas.interaction.CreateShapeLinkInteraction(this,t),new R.canvas.interaction.ScrollInteraction(this)])},setCreateShapeNodeInteractions:function(t){this.setInteractions([new R.canvas.interaction.DefaultInteraction(this),new R.canvas.interaction.CreateShapeNodeInteraction(this,t),new R.canvas.interaction.ScrollInteraction(this)])},setPanInteractions:function(){this.setInteractions([new R.canvas.interaction.DefaultInteraction(this),new R.canvas.interaction.PanInteraction(this),new R.canvas.interaction.ScrollInteraction(this)])},setMagnifyInteractions:function(){this.setInteractions([new R.canvas.interaction.DefaultInteraction(this),new R.canvas.interaction.SelectInteraction(this),new R.canvas.interaction.MoveInteraction(this),new R.canvas.interaction.ScrollInteraction(this),new R.canvas.interaction.MagnifyInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(t){var e=this._hasEditInteraction;this._hasEditInteraction=t,this.firePropertyChange(\"hasEditInteraction\",e,t)},addElementByInteraction:function(t){t.getParent()||t.setParent(this._currentSubNetwork),this._box.add(t),this.getSelectionModel().setSelection(t),this.fireInteractionEvent({kind:\"createElement\",element:t})},getToolTip:function(t){if(t){var e=t.getToolTip();return e||t.getName()}return null},isToolTipEnabled:function(){return!!this._toolTipEnabled},setToolTipEnabled:function(t){if(this._toolTipEnabled=t,t){if(!this._toolTipListener){var e=this;this._toolTipListener=function(t){if(e.isMovingElement())xt.hideToolTip();else{var i=e.getElementAt(t);if(e._preElement!==i)if(e._preElement=i,i){var n=e.getToolTip(i);xt.showToolTip({x:t.pageX,y:t.pageY},n);var s=xt.getToolTipDiv();if((s=xt.getToolTipDiv()).children.length>0){var o=e._view.getBoundingClientRect(),r=s.getBoundingClientRect();r.width+r.left>o.width+o.left&&(s.style.left=o.width+o.left-r.width+(z.documentElement.scrollLeft||z.body.scrollLeft)+\"px\"),r.height+r.top>o.height+o.top&&(s.style.top=o.height+o.top-r.height+(z.documentElement.scrollTop||z.body.scrollTop)+\"px\")}}else xt.hideToolTip()}},this._view.addEventListener(\"mousemove\",this._toolTipListener,!1),this.firePropertyChange(\"toolTipEnabled\",!1,!0)}}else this._toolTipListener&&(xt.hideToolTip(),this._view.removeEventListener(\"mousemove\",this._toolTipListener,!1),delete this._toolTipListener,this.firePropertyChange(\"toolTipEnabled\",!0,!1))},setZoom:function(t){t=this.checkZoom(t);var e=this._zoom;if(this._zoom!=t){var i=(this.viewRect.x+this.viewRect.width/2)/this.getZoom()*t,n=(this.viewRect.y+this.viewRect.height/2)/this.getZoom()*t;this._zoom=t,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.validateCanvasSize(),this.setViewRect(i-this.viewRect.width/2,n-this.viewRect.height/2,this.viewRect.width,this.viewRect.height),this.firePropertyChange(\"zoom\",e,this._zoom)}},getZoom:function(){return this._zoom},setTouchZoom:function(t){this.setZoom(t,!1)},zoomOverview:function(t){if(!(this.realWidth<=0||this.realHeight<=0)){var e=this.realWidth/this.getZoom(),i=this.realHeight/this.getZoom(),n=this.viewRect.width/e,s=this.viewRect.height/i,o=Math.min(n,s);this.setZoom(o)}},zoomReset:function(){this.setZoom(1)},zoomIn:function(){this.setZoom(1.2*this.getZoom())},zoomOut:function(){this.setZoom(this.getZoom()/1.2)},upSubNetwork:function(t,e){this._currentSubNetwork&&this.setCurrentSubNetwork(vt.getSubNetwork(this._currentSubNetwork),t,e)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(t,e,i){if(R.animate.AnimateManager.endAnimate(),e){if(this._currentSubNetwork===t)return;if(t&&!this._box.contains(t))throw t+\" is not contained in this network's elementBox\";var n=new R.animate.AnimateSubNetwork(this,t,i);R.animate.AnimateManager.start(n)}else this._setCurrentSubNetwork(t),i&&i()},_setCurrentSubNetwork:function(t){if(this._currentSubNetwork!==t){if(t&&!this._box.contains(t))throw t+\" is not contained in this network's elementBox\";var e=this._currentSubNetwork;this._currentSubNetwork=t,this.firePropertyChange(\"currentSubNetwork\",e,t),this.invalidateElementVisibility(),this.invalidateCanvasSize()}},makeVisible:function(t){var e=this.getElementUI(t);if(e){var i=vt.getSubNetwork(t);if(i===this._currentSubNetwork){for(var n=t;(n=n.getParent())&&n!==i;)n instanceof R.Group&&n.setExpanded(!0);var s=e.getViewRect();if(s){var o={x:s.x*this.getZoom(),y:s.y*this.getZoom(),width:s.width*this.getZoom(),height:s.height*this.getZoom()};W.intersects(this.viewRect,o)||this.isVisible(t)&&D.callLater(this.centerByLogicalPoint,this,[o.x+o.width/2,o.y+o.height/2])}}else{var r=this;this.setCurrentSubNetwork(i,this.isSubNetworkAnimate(),function(){D.callLater(r.makeVisible,r,[t])})}}},centerByLogicalPoint:function(t,e,i){var n=t-this.viewRect.width/2,s=e-this.viewRect.height/2;this.setViewRect(n,s,this.viewRect.width,this.viewRect.height)},panByOffset:function(t,e){this.setViewOffSet(t,e)},getIconsNames:function(t){return t.getStyle(\"icons.names\")},getIconsColors:function(t){return t.getStyle(\"icons.colors\")},getLinkFlowStepping:function(t){var e=parseInt(t.getStyle(\"link.flow.stepping\"));return e||(e=xe.NETWORK_LINK_FLOW_STEPPING),e},getLinkFlowOffset:function(t){var e=t.getStyle(\"link.flow.offset\");return isNaN(e)&&(e=0),e+this.getLinkFlowStepping(t)},toCanvas:function(t,e,i,n,s,o){i||(i=X.createCanvas()),i.setAttribute(\"width\",t),i.setAttribute(\"height\",e),i._viewRect?(i._viewRect.width=t,i._viewRect.height=e):i._viewRect={x:0,y:0,width:t,height:e};var r=i.getContext(\"2d\");if(r.translate(-s,-o),r.clearRect(0,0,t,e),ne.draw(r,this),0===this._view.clientWidth||0===this._view.clientHeight)return i;this.realWidth,this.getZoom(),this.realHeight,this.getZoom();r.scale(n,n);var a=this.getElementBox().getDatas()._as,h=a.length;this._topAttachmentList=new R.List;var l,c,d,u,_,g,f=this.getElementBox().getLayerBox(),v=f.getRoots(),m=v.size();if(1===m)for(d=0;d<h;d++)u=a[d],this._visibleMap[u._id]&&null!=(_=this._elementUIMap[u._id])&&_.paint(r);else for(l=0;l<m;l++)for(c=v.get(l),d=0;d<h;d++)u=a[d],f.getLayerByElement(u)===c&&this._visibleMap[u._id]&&null!=(_=this._elementUIMap[u._id])&&_.paint(r);for(h=this._topAttachmentList.size(),d=0;d<h;d++)(g=this._topAttachmentList.get(d)).getElementUI().paintAttachment(r,g);return i},toCanvasByRegion:function(t,e,i){i||(i=X.createCanvas());var n=t.width*e,s=t.height*e;i.setAttribute(\"width\",n),i.setAttribute(\"height\",s),i._viewRect?(i._viewRect.width=n,i._viewRect.height=s):i._viewRect={x:0,y:0,width:n,height:s};var o=i.getContext(\"2d\");if(o.clearRect(0,0,n,s),ne.draw(o,this),0===this._view.clientWidth||0===this._view.clientHeight)return i;o.save(),o.scale(e,e),o.beginPath(),o.translate(-t.x,-t.y);var r=this.getElementBox().getDatas()._as,a=r.length;this._topAttachmentList=new R.List;var h=this.getBackgroundImage();if(h&&h._viewRect&&W.intersects(t,h._viewRect)){t=W.intersection(t,h._viewRect);var l=h._viewRect;try{o.drawImage(h,l.x,l.y,l.width,l.height)}catch(t){}}var c,d,u,_,g,f,v=this.getElementBox().getLayerBox(),m=v.getRoots(),p=m.size();if(1===p)for(u=0;u<a;u++)_=r[u],this._visibleMap[_._id]&&null!=(g=this._elementUIMap[_._id])&&W.intersects(t,g._viewRect)&&g.paint(o);else for(c=0;c<p;c++)for(d=m.get(c),u=0;u<a;u++)_=r[u],v.getLayerByElement(_)===d&&this._visibleMap[_._id]&&null!=(g=this._elementUIMap[_._id])&&W.intersects(t,g._viewRect)&&g.paint(o);for(a=this._topAttachmentList.size(),u=0;u<a;u++)(f=this._topAttachmentList.get(u)).getElementUI().paintAttachment(o,f);return o.restore(),i},getGroupChildrenRects:function(t){var e=new oe;return t.getChildren().forEach(function(t){if(t instanceof Pe){var i=this.getElementUI(t);if(i){var n=i.getViewRect();n&&e.add(n)}}},this),e},getBackgroundImageRect:function(){return null},getLinkPathFunction:function(){return this._linkPathFunction},setLinkPathFunction:function(t){var e=this._linkPathFunction;this._linkPathFunction=t,this.firePropertyChange(\"linkPathFunction\",e,t),this.invalidateElementUIs()},onClickElement:function(t,e){},onClickBackground:function(t){},onDoubleClickElement:function(t,e){},onDoubleClickBackground:function(t){},onLongClickElement:function(t,e){},onLongClickBackground:function(t){},onMouseMove:function(t,e){},onMouseEnter:function(t,e){},onMouseLeave:function(t,e){},setMovingElement:function(t){if(t!=this._movingElement){var e=this._movingElement;this._movingElement=t,this.firePropertyChange(\"movingElement\",e,t),this._box._undoManager._enabled&&(t?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}},setEditingElement:function(t){if(t!=this._editingElement){var e=this._editingElement;this._editingElement=t,this.firePropertyChange(\"editingElement\",e,t),this._box._undoManager._enabled&&(t?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}}}),R.canvas.Overview=function(t){R.canvas.Overview.superClass.constructor.apply(this,t),this._view=X.createView(),this._rootDiv=X.createDiv(),this._imageCanvas=X.createCanvas(),this._imageDiv=X.createDiv(),this._maskCanvas=X.createCanvas(),this._selectDiv=X.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,X.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this._exportImageCanvas=X.createCanvas(),this._imageCtx=this._imageCanvas.getContext(\"2d\"),this.setNetwork(t),V.isTouchable?V.isMSTouchable?new R.canvas.OverviewMSTouchInteraction(this):(new R.canvas.OverviewTouchInteraction(this),new R.canvas.OverviewInteraction(this)):new R.canvas.OverviewInteraction(this)},D.ext(\"twaver.canvas.Overview\",R.controls.ControlBase,{__accessor:[\"fillColor\",\"outlineColor\",\"outlineWidth\",\"selectColor\",\"selectWidth\",\"padding\",\"maxPackingWidth\",\"maxPackingHeight\"],__bool:[\"animate\"],_fillColor:xe.OVERVIEW_FILL_COLOR,_outlineColor:xe.OVERVIEW_OUTLINE_COLOR,_outlineWidth:xe.OVERVIEW_OUTLINE_WIDTH,_selectColor:xe.OVERVIEW_SELECT_COLOR,_selectWidth:xe.OVERVIEW_SELECT_WIDTH,_padding:xe.OVERVIEW_PADDING,_animate:xe.OVERVIEW_ANIMATE,_maxPackingWidth:xe.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:xe.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(t){this._invalidateMask()},setNetwork:function(t){t!==this._network&&(this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),X.removeEventListener(\"scroll\",\"_handleScrollChange\",this._network.getView(),this)),this._network=t,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),X.addEventListener(\"scroll\",\"_handleScrollChange\",this._network.getView(),this)),this.invalidate())},_handleNetworkPropertyChange:function(t){\"zoom\"!==t.property&&\"currentSubNetwork\"!==t.property&&\"elementBox\"!==t.property&&\"dataBox\"!==t.property&&\"canvasSizeChange\"!==t.property||this.invalidate()},_handleNetworkViewChange:function(t){\"validateEnd\"===t.kind&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(t){this._isNetworkDirty&&this._isMaskDirty||(this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),D.callLater(this.validate,this,null,t))},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,D.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&0!==this._network.getViewRect().width&&0!==this._network.getViewRect().height&&!this._network._invalidate){var t,e=this._maxPackingWidth>0&&this._maxPackingHeight>0;t=e?{x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:{x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},W.grow(t,-this._padding,-this._padding),e&&(X.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),t.width=this._imageDiv._viewRect.width,t.height=this._imageDiv._viewRect.height);var i=this._network.getZoom(),n=this._network._unionBounds;n={x:(n=W.unionRect(n,{x:0,y:0,width:n.x,height:n.y})).x/i,y:n.y/i,width:n.width/i,height:n.height/i};var s={x:this._network.viewRect.x/i,y:this._network.viewRect.y/i,width:this._network.viewRect.width/i,height:this._network.viewRect.height/i},o=W.unionRect(n,s),r=Math.min(t.width/o.width,t.height/o.height),a=o.width*r,h=o.height*r,l=o.width*r,c=o.height*r,d=t.x+(t.width-l)/2,u=t.y+(t.height-c)/2;if(this._isNetworkDirty){var _={x:d,y:u,width:l,height:c};this._network.toCanvas(a,h,this._exportImageCanvas,r,o.x*r,o.y*r),this._imageCanvas.setAttribute(\"width\",l),this._imageCanvas.setAttribute(\"height\",c),this._imageCtx.drawImage(this._exportImageCanvas,0,0,a,h),X.setDiv(this._imageDiv,_,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle(\"background.color\")||\"\"),this._isNetworkDirty=!1}if(this._isMaskDirty){var g={x:(s.x-o.x)*r,y:(s.y-o.y)*r,width:s.width*r,height:s.height*r},f=X.setCanvas(this._maskCanvas,d,u,l,c);f.lineWidth=0,f.fillStyle=this._fillColor,Y.drawVector(f,\"rectangle\",null,d,u,l,c),f.closePath(),f.fill(),f.stroke(),f.clearRect(d+g.x,u+g.y,g.width,g.height),f.lineWidth=this._outlineWidth,f.strokeStyle=this._outlineColor;var v=g.width-2*this._outlineWidth,m=g.height-2*this._outlineWidth;v=Math.min(v,l-2-g.x-this._outlineWidth),m=Math.min(m,c-2-g.y-this._outlineWidth),Y.drawVector(f,\"rectangle\",null,d+g.x+this._outlineWidth,u+g.y+this._outlineWidth,v,m),f.closePath(),f.stroke(),this._isMaskDirty=!1}}else this._isNetworkDirty=!1,this._isMaskDirty=!1},getLogicalPoint:function(t){return X.getLogicalPoint(this._view,t,1,this._rootDiv)},centerNetwork:function(t,e){var i=this._imageDiv._viewRect;W.containsPoint(i,t)&&(this._network.centerByLogicalPoint((t.x-i.x)/i.width*this._network.getCanvasSize().width,(t.y-i.y)/i.height*this._network.getCanvasSize().height,e),this._invalidateMask())}}),R.canvas.OverviewTouchInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,X.addEventListener(\"touchstart\",\"handleTouchstart\",this.view,this)},D.ext(\"twaver.canvas.OverviewTouchInteraction\",Object,{handleTouchstart:function(t){X.preventDefault(t),this.clear(),this.endPoint=this.overview.getLogicalPoint(t),yt.isMultiTouch(t)&&(this.distance=yt.getDistance(t),this.zoom=this.network.getZoom()),X.addEventListener(\"touchmove\",\"handleTouchmove\",this.view,this),X.addEventListener(\"touchend\",\"handleTouchend\",this.view,this)},handleTouchmove:function(t){if(this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(t),yt.isSingleTouch(t))this.overview.centerNetwork(this.endPoint,!1);else if(this.distance){var e=yt.getDistance(t)/this.distance;this.network.setZoom(this.zoom*e,!1)}},handleTouchend:function(t){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(t);var e=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;e?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),e?D.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,X.removeEventListener(\"touchmove\",this.view,this),X.removeEventListener(\"touchend\",this.view,this)),this.moved=!1}}),R.canvas.OverviewMSTouchInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,this._pointerMap={},this._pointerIdArray=[],X.addEventListener(\"MSPointerDown\",\"handleTouchstart\",this.view,this),X.addEventListener(\"MSPointerMove\",\"handleTouchmove\",this.view,this),X.addEventListener(\"MSPointerUp\",\"handleTouchend\",this.view,this),X.addEventListener(\"MSPointerCancel\",\"handleTouchend\",this.view,this)},D.ext(\"twaver.canvas.OverviewMSTouchInteraction\",Object,{handleTouchstart:function(t){X.preventDefault(t),t.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[t.pointerId]&&this.overview.getLogicalPoint(t)&&(this._pointerIdArray.push(t.pointerId),this._pointerMap[t.pointerId]=t),1==this._pointerIdArray.length?(this._startTouchPoint=this.overview.getLogicalPoint(t),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(t){if(0!=this._pointerIdArray.length&&this._pointerMap[t.pointerId]&&!(W.getDistance({x:this._pointerMap[t.pointerId].pageX,y:this._pointerMap[t.pointerId].pageY},{x:t.pageX,y:t.pageY})<=10))if(this._pointerMap[t.pointerId]=t,2==this._pointerIdArray.length){var e=this._getDistance()/this._distance;this.network.setZoom(this._zoom*e,!1)}else if(1==this._pointerIdArray.length&&this._startTouchPoint){var i=this.overview.getLogicalPoint(t);if(null==i)return;this._startTouchPoint=i,this.overview.centerNetwork(this._startTouchPoint,!1)}},handleTouchend:function(t){var e=this.overview.getLogicalPoint(t);if(1==this._pointerIdArray.length&&e){var i=this._endTouchPoint&&this._endTouchTime&&(new Date).getTime()-this._endTouchTime.getTime()<=500&&W.getDistance(this._endTouchPoint,e)<=10;i?(this._endTouchPoint=null,this._endTouchTime=null):(this._endTouchPoint=e,this._endTouchTime=new Date),i?D.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this._endTouchPoint,this.overview._animate)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return W.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),R.canvas.OverviewInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,X.addEventListener(\"mousedown\",\"handleMousedown\",this.view,this)},D.ext(\"twaver.canvas.OverviewInteraction\",Object,{handleMousedown:function(t){0===t.button&&(this.clear(),this.endPoint=this.overview.getLogicalPoint(t),D.isCtrlDown(t)&&(this.startPoint=this.endPoint,X.setVisible(this.overview._selectDiv,!0)),X.addEventListener(\"mousemove\",\"handleMousemove\",this.view,this),X.addEventListener(\"mouseup\",\"handleMouseup\",z,this))},handleMouseup:function(t){if(this.endPoint=this.overview.getLogicalPoint(t),\"detail\"in t&&2===t.detail)D.callLater(this.network.zoomReset,this.network,[this.overview._animate]);else if(X.isVisible(this.overview._selectDiv)&&this.startPoint){var e=this.overview._imageDiv._viewRect,i=this.overview._selectDiv._viewRect.x,n=this.overview._selectDiv._viewRect.y,s=e.width/this.overview._selectDiv._viewRect.width,o=e.height/this.overview._selectDiv._viewRect.height,r=Math.min(s,o);this.network.setZoom(r*Math.min(this.network.getViewRect().width/this.network.getCanvasSize().width,this.network.getViewRect().height/this.network.getCanvasSize().height)*this.network.getZoom(),!1);var a=this.network.getCanvasSize().width*((i-e.x+this.overview._selectDiv._viewRect.width/2)/e.width),h=this.network.getCanvasSize().height*((n-e.y+this.overview._selectDiv._viewRect.height/2)/e.height);D.callLater(this.network.centerByLogicalPoint,this.network,[a,h,this.overview._animate]),X.setVisible(this.overview._selectDiv,!1),X.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else this.overview.centerNetwork(this.endPoint,this.overview._animate);this.clear()},handleMousemove:function(t){var e=this.overview.getLogicalPoint(t);if(this.endPoint=e,X.isVisible(this.overview._selectDiv)&&this.startPoint){var i=e.x>this.startPoint.x?this.startPoint.x:e.x,n=e.x>this.startPoint.x?this.startPoint.y:e.y;e.x>this.startPoint.x&&e.y<this.startPoint.y&&(n=e.y),e.x<this.startPoint.x&&e.y>this.startPoint.y&&(n=this.startPoint.y);var s=this.overview._imageDiv._viewRect;i<s.x&&(i=s.x),i>s.x+s.width&&(i=s.x+s.width),n<s.y&&(n=s.y),n>s.y+s.height&&(n=s.y+s.height);var o=Math.abs(e.x-this.startPoint.x),r=Math.abs(e.y-this.startPoint.y);i+o>s.x+s.width&&(o=s.x+s.width-i),n+r>s.y+s.height&&(r=s.y+s.height-n),X.setDiv(this.overview._selectDiv,{x:i,y:n,width:o,height:r},null,this.overview._selectWidth,this.overview._selectColor)}else this.overview.centerNetwork(e,!1)},clear:function(){this.endPoint&&(this.endPoint=null,X.removeEventListener(\"mousemove\",this.view,this),X.removeEventListener(\"mouseup\",z,this))}}),R.canvas.ElementUI=function(t,e){this._network=t,this._element=e,this._attachments=new R.List,this._bodyBounds=new R.List,this._hitTest=!1,this._hitTest=!1,this._intersectTest=!1,this.invalidate(!0)},D.ext(\"twaver.canvas.ElementUI\",Object,{getElement:function(){return this._element},getNetwork:function(){return this._network},handlePropertyChange:function(t){this.invalidate(!0)},handleSelectionChange:function(t){this.invalidate(!0)},invalidate:function(t){void 0===t&&(t=!0),t&&(this._invalidateAttachmentsFlag=!0),this._invalidateFlag||(this._hotSpot=null,this._bodyRect=null,this._invalidateFlag=!0,this._network.invalidateElementVisibility())},updateStyle:function(){this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle(\"shadow.xoffset\"),this._shadowYOffset=this._element.getStyle(\"shadow.yoffset\"),this._shadowBlur=this._element.getStyle(\"shadow.blur\"),this._wholeAlpha=this._element.getStyle(\"whole.alpha\")},validate:function(){if(0!=this._invalidateFlag){this._bodyBounds.clear(),this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this.updateStyle(),this.validateImpl(),this._attachments.forEach(function(t){t.validate()});var t;this._bodyBounds.forEach(function(e){t=W.unionRect(t,e)}),this._unionBodyBounds=D.clone(t),this._attachments.forEach(function(e){t=W.unionRect(t,e.getViewRect())}),this._viewRect=t}},validateImpl:function(){},setShadow:function(t,e){var i=t.isShadowable()&&this._shadowColor&&!this._editAttachment;return e.shadowOffsetX===this._shadowXOffset&&e.shadowOffsetY===this._shadowYOffset&&e.shadowBlur===this._shadowBlur?e:((i||this._network._showShadowInEdit)&&(e.shadowOffsetX=this._shadowXOffset,e.shadowOffsetY=this._shadowYOffset,e.shadowBlur=this._shadowBlur,e.shadowColor=this._shadowColor),e)},clearShadow:function(t){0==t.shadowOffsetX&&0==t.shadowOffsetY&&0==t.shadowBlur||(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0)},appendShadowBound:function(t,e){return t.isShadowable()&&this._shadowColor&&!this._editAttachment&&(this._shadowXOffset>0?e.width+=this._shadowXOffset:(e.x+=this._shadowXOffset,e.width+=-this._shadowXOffset),this._shadowYOffset>0?e.height+=this._shadowYOffset:(e.y+=this._shadowYOffset,e.height+=-this._shadowYOffset),W.grow(e,this._shadowBlur,this._shadowBlur)),e},isShadowable:function(){return!(!this._shadowColor||!this._network.isSelected(this._element)||\"shadow\"!==this._element.getStyle(\"select.style\"))},addAttachment:function(t){this._attachments.add(t)},removeAttachment:function(t){this._attachments.remove(t)},getAttachments:function(){return this._attachments},checkAttachments:function(){this.checkLabelAttachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var t=this._network.getLabel(this._element);null!=t&&\"\"!==t?this._labelAttachment||(this._labelAttachment=new R.canvas.LabelAttachment(this,xe.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var t=this._network.getAlarmLabel(this._element);null!=t&&\"\"!==t?this._alarmAttachment||(this._alarmAttachment=new R.canvas.AlarmAttachment(this,xe.SHOW_ALARM_IN_ATTACHMENT_DIV),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var t=this._network.getIconsNames(this._element);t&&t.length>0?this._iconsAttachment||(this._iconsAttachment=new R.canvas.IconsAttachment(this),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)&&this.isEditable()?this._editAttachment||(this._editAttachment=new R.canvas.EditAttachment(this),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},isEditable:function(){return!0},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getDyeColor:function(t){return this._innerColor?this._innerColor:this.getStyle(t)},getStyle:function(t){return this._element.getStyle(t)},getFont:function(t){var e=this._element.getStyle(t);return e||R.Defaults.FONT},paint:function(t){t.save(),t.globalAlpha=this._wholeAlpha,t.beginPath(),this.paintBody(t),this.clearShadow(t),t.closePath(),t.beginPath(),this.paintAttachments(t),t.closePath(),t.restore()},paintBody:function(t){},paintAttachments:function(t){t.beginPath();for(var e=this._attachments.size(),i=0;i<e;i++){var n=this._attachments.get(i);1==this._hitTest&&0==n.isShowOnTop()&&this.paintAttachment(t,n),1==this._intersectTest&&this.paintAttachment(t,n),0==this._hitTest&&0==this._intersectTest&&(n.isShowOnTop()?this._network._topAttachmentList.add(n):this.paintAttachment(t,n))}},paintAttachment:function(t,e){t.beginPath(),e.paint(t),this.clearShadow(t)},getViewRect:function(){return D.clone(this._viewRect)},getUnionBodyBounds:function(){return D.clone(this._unionBodyBounds)},addBodyBounds:function(t){t&&this._bodyBounds.add(t)},getBodyRect:function(){return this._bodyRect||(this._bodyRect=this.createBodyRect()),D.clone(this._bodyRect)},getHotSpot:function(){return this._hotSpot?D.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(t){this._hotSpot=t},hit:function(t,e){return!1},intersects:function(t){return!!W.contains(t,this.getViewRect())},hitCanvasRectAtBody:function(t){var e=Me.getHitCanvas(t.width,t.height),i=Me.getCtx(e);if(i.save(),i.translate(-t.x,-t.y),this._element.getImage){var n=D.getImageAsset(this._element.getImage());if(n&&n.getImage()instanceof be)return 1}this.paintBody(i);try{for(var s=i.getImageData(0,0,t.width,t.height),o=s.data,r=0;r<s.width;r++)for(var a=0;a<s.height;a++){if(0!==o[4*(a*s.width+r)+3])return i.restore(),1}}catch(e){if(Me.disposeHitCanvas(),W.contains(this.getUnionBodyBounds(),t))return 0}return i.restore(),-1},hitCanvasRectAtAttachments:function(t){var e=Me.getHitCanvas(t.width,t.height),i=Me.getCtx(e);i.save(),i.translate(-t.x,-t.y),this.paintAttachments(i);try{for(var n=i.getImageData(0,0,t.width,t.height),s=n.data,o=0;o<n.width;o++)for(var r=0;r<n.height;r++){if(0!==s[4*(r*n.width+o)+3])return i.restore(),1}}catch(t){Me.disposeHitCanvas()}return i.restore(),-1},hitCanvasRect:function(t){this._intersectTest=!0,1==this._hitTest&&(this._intersectTest=!1);var e=W.intersection(t,this._viewRect),i=this.hitCanvasRectAtBody(e);if(1==i)return this._intersectTest=!1,!0;return 1==this.hitCanvasRectAtAttachments(e)?(this._intersectTest=!1,!0):(this._intersectTest=!1,0==i)},hitCanvasPoint:function(t,e){var i={x:t,y:e,width:0,height:0},n=this._network.getSelectionTolerance();if(n&&n>0&&W.grow(i,n,n),!W.intersects(this._viewRect,i))return!1;this._hitTest=!0;var s=this.hitCanvasRect(i);return this._hitTest=!1,s},hitTest:function(t,e){var i={x:t,y:e,width:0,height:0},n=this._network.getSelectionTolerance();if(n&&n>0&&W.grow(i,n,n),!W.intersects(this._viewRect,i))return null;var s=W.intersection(i,this._viewRect),o=this.hitCanvasRectAtBody(s);if(1==o)return this;for(var r=this._attachments.size(),a=0;a<r;a++){var h=this._attachments.get(a);if(h.hit(t,e))return h}return 0==o?this:null},dispose:function(){this._attachments.forEach(function(t){t.dispose()}),this._attachments.clear()}}),R.canvas.NodeUI=function(t,e){R.canvas.NodeUI.superClass.constructor.call(this,t,e)},D.ext(\"twaver.canvas.NodeUI\",R.canvas.ElementUI,{invalidate:function(t){R.canvas.NodeUI.superClass.invalidate.call(this,t),this.curInterval&&clearInterval(this.curInterval);var e=this._element.getAgentLinks();e&&e.forEach(function(t){this._network.invalidateElementUI(t,!1)},this);var i=this._element.getParent();i instanceof R.Group&&this._network.invalidateElementUI(i,!1)},createBodyRect:function(){return this._element.getRect()},validateImpl:function(){R.canvas.NodeUI.superClass.validateImpl.call(this);var t=this.getStyle(\"vector.shape\"),e=this.getBodyRect();this._hotSpot=W.getHotSpot(e.x,e.y,e.width,e.height,t),this.validateBodyBounds()},validate:function(){0!=this._invalidateFlag&&R.canvas.NodeUI.superClass.validate.call(this)},validateBodyBounds:function(){var t=this.getStyle(\"body.type\");\"default\"===t?this.addBodyBounds(this.getDefaultBodyRect()):\"vector\"===t?this.addBodyBounds(this.getVectorBody()):\"default.vector\"===t?(this.addBodyBounds(this.getVectorBody()),this.addBodyBounds(this.getDefaultBodyRect())):\"vector.default\"===t&&(this.addBodyBounds(this.getDefaultBodyRect()),this.addBodyBounds(this.getVectorBody())),this._outerColor&&this.addBodyBounds(this.getOuterBorderRect()),!this._editAttachment&&\"border\"===this.getStyle(\"select.style\")&&this._network.isSelected(this._element)&&this.addBodyBounds(this.getSelectBorderRect())},getDefaultBodyRect:function(){var t=this._element,e=D.getImageAsset(t.getImage()),i=this.getBodyRect();if(!e)return i;W.addPadding(i,this._element,\"image.padding\",1),this._defaultRect=i;var n=D.clone(i);return this.appendShadowBound(this,n),i=n},getVectorBody:function(){return this.getPathRect(\"vector\")},getOuterBorderRect:function(){return this._getBorderRect(\"outer\")},getSelectBorderRect:function(){return this._getBorderRect(\"select\")},_getBorderRect:function(t){var e=this._element,i=e.getStyle(t+\".width\");if(i>0){var n=this.getBodyRect();W.addPadding(n,e,t+\".padding\",1);var s=D.clone(n);return W.grow(s,i/2,i/2),s}return null},getPathRect:function(t,e){var i=this._element,n=this.getBodyRect();e&&W.addPadding(n,i,t+\".padding\",1);var s=D.clone(n),o=i.getStyle(t+\".outline.width\");return o>0&&W.grow(s,o/2,o/2),this.appendShadowBound(this,s),s},paintBody:function(t){this.curInterval&&clearInterval(this.curInterval);var e=this.getStyle(\"body.type\");\"default\"===e?this.drawDefaultBody(t):\"vector\"===e?this.drawVectorBody(t):\"default.vector\"===e?(this.drawVectorBody(t),this.drawDefaultBody(t)):\"vector.default\"===e&&(this.drawDefaultBody(t),this.drawVectorBody(t)),this._outerColor&&this.drawOuterBorder(t),\"border\"===this.getStyle(\"select.style\")&&this._network.isSelected(this._element)&&this.drawSelectBorder(t)},drawOuterBorder:function(t){var e=this._element,i=e.getStyle(\"outer.width\");if(i>0){var n=this.getBodyRect();W.addPadding(n,e,\"outer.padding\",1),t.lineWidth=i,t.lineCap=e.getStyle(\"outer.cap\"),t.lineJoin=e.getStyle(\"outer.join\"),t.strokeStyle=this._outerColor,Y.drawVector(t,e.getStyle(\"outer.shape\"),null,n),t.stroke()}},drawDefaultBody:function(t){var e=this._element,i=D.getImageAsset(e.getImage()),n=this._defaultRect;if(i&&i.getImage()){0!=e.getAngle()&&(t.save(),n=e.getOriginalRect(),R.Util.rotateCanvas(t,n,e.getAngle())),this.setShadow(this,t);if(i.getImage()instanceof be){var s,o=i.getImage().frames,r=i.getImage().size,a=0;s=Le(o,r,0),t.drawImage(s,n.x,n.y,n.width,n.height),this.curInterval=setInterval(function(){a=(a+o.length)%o.length,s=Le(o,r,a),t.drawImage(s,n.x,n.y,n.width,n.height),a++},100)}else Dt(t,e.getImage(),this.getInnerColor(),n,e,this._network);0!=e.getAngle()&&t.restore()}},drawSelectBorder:function(t){var e=this._element,i=e.getStyle(\"select.width\");if(i>0){var n=this.getBodyRect();n=D.clone(n);var s=e.getStyle(\"select.physicalZoom\")?1:this._network.getZoom();W.addPadding(n,e,\"select.padding\",1/s),W.grow(n,i/2/s,i/2/s),t.lineWidth=i/s,t.lineCap=e.getStyle(\"select.cap\"),t.lineJoin=e.getStyle(\"select.join\"),t.strokeStyle=e.getStyle(\"select.color\"),Y.drawVector(t,e.getStyle(\"select.shape\"),null,n),t.stroke()}},drawVectorBody:function(t){this.drawPath(t,\"vector\",!0,this._element.getStyle(\"vector.outline.pattern\"));var e=this.getStyle(\"vector.deep\"),i=this.getStyle(\"vector.fill.color\"),n=this.getBodyRect();if(0!==e&&i){var s=this._element.getAngle();0!=s&&(t.save(),n=this._element.getOriginalRect(),R.Util.rotateCanvas(t,n,s)),\"rectangle\"===this.getStyle(\"vector.shape\")&&Y.draw3DRect(t,i,e,n),0!=s&&t.restore()}},drawPath:function(t,e,i,n,s,o,r){var a=this._element,h=this.getBodyRect();i&&W.addPadding(h,a,e+\".padding\",1);var l=a.getStyle(e+\".outline.width\");this.setShadow(this,t),0!=a.getAngle()&&(a instanceof De||(h=a.getOriginalRect()),t.save(),R.Util.rotateCanvas(t,h,a.getAngle()));var c,d=a.getStyle(e+\".fill\");if(d){c=this._innerColor&&!vt.hasDefault(this._element)?this._innerColor:a.getStyle(e+\".fill.color\");var u=a.getStyle(e+\".gradient\");u?Y.fill(t,c,u,a.getStyle(e+\".gradient.color\"),h):t.fillStyle=c}var _=a.getStyle(e+\".shape\"),g=a.getStyle(\"group.shape.roundrect.radius\");g<0&&(g=10),d&&(t.beginPath(),s?Y.drawLinePoints(t,s,null,o,r):\"roundrect\"===_&&\"group\"===e?Y.drawVector(t,_,null,h,g):Y.drawVector(t,_,null,h),t.fill()),l>0&&(t.lineWidth=l,t.lineCap=a.getStyle(e+\".cap\"),t.lineJoin=a.getStyle(e+\".join\"),t.strokeStyle=a.getStyle(e+\".outline.color\"),t.beginPath(),s?Y.drawLinePoints(t,s,n,o,r):\"roundrect\"===_&&\"group\"===e?Y.drawVector(t,_,n,h,g):Y.drawVector(t,_,n,h),t.stroke()),0!=a.getAngle()&&t.restore()},hit:function(t,e){var i={x:t,y:e,width:0,height:0},n=this._network.getSelectionTolerance();if(n&&n>0&&W.grow(i,n,n),this._network._transparentSelectionEnable){var s=this.getBodyRect();if(D.math.intersects(s,i))return!0}return!!W.intersects(this.getViewRect(),i)&&this.hitCanvasPoint(t,e)},intersects:function(t){if(1==R.canvas.NodeUI.superClass.intersects.apply(this,arguments))return!0;if(this._network._transparentSelectionEnable){var e=this.getBodyRect();if(D.math.intersects(e,t))return!0}return!!W.intersects(t,this.getViewRect())&&this.hitCanvasRect(t)}}),R.canvas.LinkUI=function(t,e){R.canvas.LinkUI.superClass.constructor.call(this,t,e)},D.ext(\"twaver.canvas.LinkUI\",R.canvas.ElementUI,{isEditable:function(){return!(!pt.isOrthogonalLink(this._element)||!this.getControlPoint())},invalidate:function(t){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,this._angle=null,R.canvas.LinkUI.superClass.invalidate.call(this,t)},validateImpl:function(){this.validateBodyBounds(),R.canvas.LinkUI.superClass.validateImpl.call(this)},validateBodyBounds:function(){var t=this.getLinkPoints();if(t&&!(t.size()<2)){var e=this._element,i=W.getLineRect(t),n=e.getStyle(\"link.width\");if(this._outerColor){n+=2*e.getStyle(\"outer.width\")}if(!this._editAttachment&&\"border\"===e.getStyle(\"select.style\")&&this._network.isSelected(this._element)){n+=2*e.getStyle(\"select.width\")}W.grow(i,n/2,n/2),e.getStyle(\"arrow.from\")&&(this._network._debug&&(this._arrowFromRect=re.getArrowRect(this,t,!0,e.getStyle(\"arrow.from.shape\"),e.getStyle(\"arrow.from.width\"),e.getStyle(\"arrow.from.height\"),e.getStyle(\"arrow.from.xoffset\"),e.getStyle(\"arrow.from.yoffset\"))),i=W.unionRect(i,re.getArrowRect(this,t,!0,e.getStyle(\"arrow.from.shape\"),e.getStyle(\"arrow.from.width\"),e.getStyle(\"arrow.from.height\"),e.getStyle(\"arrow.from.xoffset\"),e.getStyle(\"arrow.from.yoffset\")))),e.getStyle(\"arrow.to\")&&(this._network._debug&&(this._arrowToRect=re.getArrowRect(this,t,!1,e.getStyle(\"arrow.to.shape\"),e.getStyle(\"arrow.to.width\"),e.getStyle(\"arrow.to.height\"),e.getStyle(\"arrow.to.xoffset\"),e.getStyle(\"arrow.to.yoffset\"))),i=W.unionRect(i,re.getArrowRect(this,t,!1,e.getStyle(\"arrow.to.shape\"),e.getStyle(\"arrow.to.width\"),e.getStyle(\"arrow.to.height\"),e.getStyle(\"arrow.to.xoffset\"),e.getStyle(\"arrow.to.yoffset\")))),this.appendShadowBound(this,i),this.addBodyBounds(i)}},createBodyRect:function(){var t=this.getHotSpot();return t?{x:t.x-1,y:t.y-1,width:2,height:2}:null},paintBody:function(t){var e=this._linkPoints;if(e&&!(e.size()<2)){var i=this._element,n=i.getStyle(\"link.width\"),s=n;if(this._outerColor){var o=i.getStyle(\"outer.width\");s+=2*o}var r=!this._editAttachment&&\"border\"===i.getStyle(\"select.style\")&&this._network.isSelected(this._element);if(r){s+=2*i.getStyle(\"select.width\")}this.setShadow(this,t),t.lineCap=i.getStyle(\"link.cap\"),t.lineJoin=i.getStyle(\"link.join\");var a=i.getStyle(\"link.pattern\");r&&this.drawLinePoints(t,e,s,i.getStyle(\"select.color\"),a),this._outerColor&&this.drawLinePoints(t,e,n+2*o,this._outerColor,a),this.drawLinePoints(t,e,n,this._innerColor||i.getStyle(\"link.color\"),a),re.drawLinkArrow(this,t,e)}},drawLinePoints:function(t,e,i,n,s){if(t.lineWidth=i,t.strokeStyle=n,!0===this._element.getStyle(\"link.flow\")&&s&&s.length>1){var o=new ft(t,s[0],s[1]),r=this._element.getStyle(\"link.flow.offset\"),a=Math.floor(r/(s[0]+s[1]));a>2&&(r-=(s[0]+s[1])*a),this._element.getStyle(\"link.flow.converse\")?r<s[0]?o.overflow=s[0]-r:r>=s[0]&&r<=s[0]+s[1]?(o.overflow=s[1]-(r-s[0]),o.overflow&&(o.isLine=!1)):(r-=s[0]+s[1],o.overflow=s[0]-r):r<=s[1]?(o.overflow=r,r&&(o.isLine=!1)):r>s[1]&&r<=s[0]+s[1]?o.overflow=r-s[1]:((r-=s[0]+s[1])&&(o.isLine=!1),o.overflow=r),this._element._styleMap[\"link.flow.offset\"]=r,t.beginPath(),Y._drawLine(e,t),t.stroke(),t.shadowColor=\"transparent\",t.beginPath();var h=this._element.getStyle(\"link.flow.color\");h=h||xe.NETWORK_LINK_FLOW_COLOR,t.strokeStyle=h,Y._drawLine(e,o),t.stroke(),t.shadowColor=this._shadowColor}else t.beginPath(),Y.drawLinePoints(t,e,s),t.stroke()},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=W.calculateLineLength(this._linkPoints)),this._linkPoints},getFromPosition:function(t,e){var i=this.getFromPoint();return i?{x:i.x+t,y:i.y+e}:null},getToPosition:function(t,e){var i=this.getToPoint();return i?{x:i.x+t,y:i.y+e}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=pt.createFromPoint(this)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=pt.createToPoint(this)),this._toPoint},createLinkPoints:function(){var t=this.getFromPoint(),e=this.getToPoint(),i=this.getStyle(\"link.type\"),n=new R.List;if(pt.isOrthogonalOrFlexionalLink(this._element))n=pt.orthogonalAndFlexional(this,i);else if(this._element.isLooped()){var s=this._network.getElementUI(this._element.getFromAgent());null!=s&&(this._hotSpot=pt.fillLoopedPoints(this,s.getBodyRect(),n))}else{if(\"arc\"!==i&&\"triangle\"!==i&&\"parallel\"!==i)throw\"Can not resolve link type '\"+i+\"'\";this._hotSpot=pt.fillBundlePoints(this,i,t,e,n)}if(this._network._linkPathFunction){var o=this._network._linkPathFunction(this,n);o&&(n=o)}return n},checkAttachments:function(){R.canvas.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var t=this._network.getLinkHandlerLabel(this._element);null!=t&&\"\"!==t?this._linkHandlerAttachment||(this._linkHandlerAttachment=new R.canvas.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getControlPoint:function(){return pt.getControlPoint(this._element,this)},setControlPoint:function(t){if(t){var e=this.getStyle(\"link.type\");if(pt.hasControlPoint(e)){var i=pt.getLinkSourceBounds(this),n=pt.getLinkTargetBounds(this);pt.setParamsByControlPoint(t,i,n,e,this._element)}}},getLineLength:function(){return this._lineLength},hit:function(t,e){var i={x:t,y:e,width:0,height:0},n=this._network.getSelectionTolerance();return n&&n>0&&W.grow(i,n,n),!!W.intersects(this.getViewRect(),i)&&this.hitCanvasPoint(t,e)},intersects:function(t){if(1==R.canvas.LinkUI.superClass.intersects.apply(this,arguments))return!0;if(0==W.intersects(t,this.getViewRect()))return!1;var e=this.getLinkPoints(),i=e.size();if(2==i)for(var n=0;n<i;n+=2){var s=e.get(n);if(n+1<i){var o=e.get(n+1);if(Me.intersectsLine(s.x,s.y,o.x,o.y,t.x,t.y,t.width,t.height))return!0}}return this.hitCanvasRect(t)},getAngle:function(){return!this._angle&&this._fromPoint&&this._toPoint&&(this._angle=W.getAngle(this._fromPoint,this._toPoint)),this._angle||0}}),R.canvas.GroupUI=function(t,e){R.canvas.GroupUI.superClass.constructor.call(this,t,e)},D.ext(\"twaver.canvas.GroupUI\",R.canvas.NodeUI,{isEditable:function(){return!this._element.isExpanded()},paintBody:function(t){this._shapeRect?this.drawExpandedGroup(t):R.canvas.GroupUI.superClass.paintBody.apply(this,arguments)},validateBodyBounds:function(){this.getBodyRect(),this._shapeRect?this.addBodyBounds(this.getPathRect(\"group\",!1)):R.canvas.GroupUI.superClass.validateBodyBounds.call(this)},drawExpandedGroup:function(t){this.drawPath(t,\"group\",!1,this._element.getStyle(\"vector.outline.pattern\"));var e=this.getStyle(\"group.deep\"),i=this.getStyle(\"group.fill.color\");0!==e&&i&&\"rectangle\"===this.getStyle(\"group.shape\")&&Y.draw3DRect(t,i,e,this._bodyRect)},getChildrenRects:function(){return this._network.getGroupChildrenRects(this._element)},createBodyRect:function(){this._shapeRect=null;var t=this._element,e=this._network;if(t.isExpanded()){t.getChildren().forEach(function(t){var i=e.getElementUI(t);i&&i.validate()});var i=this.getChildrenRects();if(!i.isEmpty()){var n=t.getStyle(\"group.shape\"),s=Z[n];if(!s)throw\"Can not resolve group shape '\"+n+\"'\";this._shapeRect=s(i)}}return this._shapeRect?(W.addPadding(this._shapeRect,t,\"group.padding\",1),this._shapeRect):R.canvas.GroupUI.superClass.createBodyRect.call(this)}}),R.canvas.ShapeNodeUI=function(t,e){R.canvas.ShapeNodeUI.superClass.constructor.call(this,t,e)},D.ext(\"twaver.canvas.ShapeNodeUI\",R.canvas.NodeUI,{getDefaultBodyRect:function(){return this._element._points.size()<2?null:this.getPathRect(\"vector\",!0)},drawDefaultBody:function(t){this._element._points.size()<2||(this.drawPath(t,\"vector\",!0,this._element.getStyle(\"vector.outline.pattern\"),this._element._points,this._element._segments,this._element.getStyle(\"shapenode.closed\")),re.drawLinkArrow(this,t,W.getPointObject(this._element._points,this._element._segments)))},drawSelectBorder:function(t){var e=this._element,i=e.getStyle(\"select.width\");if(i>0){var n=this.getBodyRect();n=D.clone(n);var s=e.getStyle(\"select.physicalZoom\")?1:this._network.getGraphicsZoom();W.addPadding(n,e,\"select.padding\",1/s),W.grow(n,i/2,i/2);var o=e.getStyle(\"vector.outline.width\");o>0&&W.grow(n,o/2/s,o/2/s),t.lineWidth=i/s,t.lineCap=e.getStyle(\"select.cap\"),t.lineJoin=e.getStyle(\"select.join\"),t.strokeStyle=e.getStyle(\"select.color\"),Y.drawVector(t,e.getStyle(\"select.shape\"),null,n),t.stroke()}}}),R.canvas.ShapeLinkUI=function(t,e){R.canvas.ShapeLinkUI.superClass.constructor.call(this,t,e)},D.ext(\"twaver.canvas.ShapeLinkUI\",R.canvas.LinkUI,{isEditable:function(){return!0},createLinkPoints:function(){var t=this.getFromPoint(),e=this.getToPoint(),i=new R.List,n=this.getStyle(\"shapelink.type\");i.add(t),null!=this._element._points&&i.addAll(this._element._points),i.add(e);var s,o,r,a,h=W.calculateLineLength(i)/2,l=i.size(),c=0,d=0;for(s=0;s<l;s++)if(w=i.get(s),0!=s){if((r=w)instanceof oe&&(r=r._as),r instanceof Array?(a=W.calculateCurveLength(o,r,1),o=r[r.length-1]):(C=w.y-o.y,x=w.x-o.x,a=Math.sqrt(x*x+C*C),o=r),d+=a,c<=h&&d>=h){var u=h-c,_=i.get(s-1);_ instanceof oe&&(_=_._as)instanceof Array&&(_=_[_.length-1]);var g=i.get(s),f=W.getPathInfo(g,_,u,0,-1).point;this._hotSpot=D.clone(f)}c=d}else o=w;var v,m,p;if(\"lineto\"===n);else if(\"quadto\"===n){for(v=new R.List(i.get(0)),m=1,pointCount=i.size();m<pointCount;m++)m<pointCount-1?v.add(new R.List([i.get(m++),i.get(m)])):v.add(i.get(m));i=v}else if(\"cubicto\"===n){for(v=new R.List(i.get(0)),m=1,pointCount=i.size();m<pointCount;m++)m<pointCount-2?v.add(new R.List([i.get(m++),i.get(m++),i.get(m)])):m<pointCount-1?v.add(new R.List([i.get(m++),i.get(m)])):v.add(i.get(m));i=v}else{if(\"orthogonalto\"!==n)throw\"Can not resolve shapelink type '\"+n+\"'\";for(p=i.get(0),v=new R.List(p),m=1,pointCount=i.size();m<pointCount;m++)if(m<pointCount-1){var w,y=(w=D.clone(i.get(m))).x,A=w.y,x=y-p.x,C=A-p.y;Math.abs(x)>Math.abs(C)?(w.x=y,w.y=p.y):(w.x=p.x,w.y=A),p=w,v.add(p)}else v.add(i.get(m));i=v}return i}}),R.canvas.GridUI=function(t,e){R.canvas.GridUI.superClass.constructor.call(this,t,e)},D.ext(\"twaver.canvas.GridUI\",R.canvas.NodeUI,{drawDefaultBody:function(t){this._element.getImage()?R.canvas.GridUI.superClass.drawDefaultBody.apply(this,arguments):this.drawGridBody(t)},validateBodyBounds:function(){if(this._element.getImage())R.canvas.GridUI.superClass.validateBodyBounds.call(this);else{var t=this.getBodyRect(),e=D.clone(t);this.appendShadowBound(this,e),this.addBodyBounds(e)}},drawGridBody:function(t){var e=this.getStyle(\"grid.fill\"),i=this.getStyle(\"grid.deep\"),n=this.getStyle(\"grid.cell.deep\");if(e||0!==i||0!==n){t.beginPath();var s=this._element.getRect(),o=this.getDyeColor(\"grid.fill.color\");if(this.setShadow(this,t),e&&(t.fillStyle=o,t.rect(s.x,s.y,s.width,s.height),t.fill()),t.closePath(),this.clearShadow(t),t.beginPath(),0!=i&&Y.draw3DRect(t,o,i,s.x,s.y,s.width,s.height),t.closePath(),0!=n)for(var r=this.getStyle(\"grid.row.count\"),a=this.getStyle(\"grid.column.count\"),h=0;h<r;h++)for(var l=0;l<a;l++){var c=this._element.getCellRect(h,l);null!=c&&(t.beginPath(),Y.draw3DRect(t,o,n,c.x,c.y,c.width,c.height),t.closePath())}}}}),R.canvas.RotatableNodeUI=function(t,e){R.canvas.RotatableNodeUI.superClass.constructor.call(this,t,e)},D.ext(\"twaver.canvas.RotatableNodeUI\",R.canvas.NodeUI,{isEditable:function(){return!1},getDefaultBodyRect:function(){var t=this._element,e=D.getImageAsset(t.getImage()),i=this.getBodyRect();return e?(W.addPadding(i,this._element,\"image.padding\",1),i):i},drawDefaultBody:function(t){var e=this._element,i=D.getImageAsset(e.getImage()),n=this.getBodyRect();if(W.addPadding(n,this._element,\"image.padding\",1),i.getImage()){var s=this._element._getOrignalWidth(),o=this._element._getOrignalHeight(),r=this._element._getRotateRect();t.save(),t.translate(n.x-r.x+s/2,n.y-r.y+o/2),t.rotate(this._element._angle*Math.PI/180);n={x:-s/2,y:-o/2,width:s,height:o};Dt(t,i.getImage(this._innerColor,n.width,n.height),this._innerColor,n,e,this._network),t.restore()}else if(i.getSrc());else if(!i.getFunction())throw\"ImageAsset '\"+e.getImage()+\" ' is empty\"}}),R.canvas.HTMLNodeUI=function(t,e){R.canvas.HTMLNodeUI.superClass.constructor.call(this,t,e)},D.ext(\"twaver.canvas.HTMLNodeUI\",R.canvas.NodeUI,{checkAttachments:function(){R.canvas.NodeUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var t=this._element.getStyle(\"attachment.label.style\");if(t&&\"none\"===t)R.canvas.HTMLNodeUI.superClass.checkLabelAttachment.call(this);else{var e=this._network.getLabel(this._element);null!=e&&\"\"!==e?this._labelAttachment||(this._labelAttachment=new R.canvas.HTMLLabelAttachment(this,xe.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)}},checkAlarmAttachment:function(){var t=this._element.getStyle(\"attachment.alarm.style\");if(t&&\"none\"===t)R.canvas.HTMLNodeUI.superClass.checkAlarmAttachment.call(this);else{var e=this._network.getAlarmLabel(this._element);null!=e&&\"\"!==e?this._alarmAttachment||(this._alarmAttachment=new R.canvas.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)}},setAttachmentVisible:function(t){t?(this._labelAttachment&&this._labelAttachment.setVisibility(\"visible\"),this._alarmAttachment&&this._alarmAttachment.setVisibility(\"visible\")):(this._labelAttachment&&this._labelAttachment.setVisibility(\"hidden\"),this._alarmAttachment&&this._alarmAttachment.setVisibility(\"hidden\"))}}),R.canvas.HTMLLinkUI=function(t,e){R.canvas.HTMLLinkUI.superClass.constructor.call(this,t,e)},D.ext(\"twaver.canvas.HTMLLinkUI\",R.canvas.LinkUI,{checkAttachments:function(){R.canvas.LinkUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var t=this._element.getStyle(\"attachment.label.style\");if(t&&\"none\"===t)R.canvas.HTMLLinkUI.superClass.checkLabelAttachment.call(this);else{var e=this._network.getLabel(this._element);null!=e&&\"\"!==e?this._labelAttachment||(this._labelAttachment=new R.canvas.HTMLLabelAttachment(this),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)}},checkAlarmAttachment:function(){var t=this._element.getStyle(\"attachment.alarm.style\");if(t&&\"none\"===t)R.canvas.HTMLLinkUI.superClass.checkAlarmAttachment.call(this);else{var e=this._network.getAlarmLabel(this._element);null!=e&&\"\"!==e?this._alarmAttachment||(this._alarmAttachment=new R.canvas.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)}}}),R.canvas.Attachment=function(t,e){this._ui=t,this._element=this._ui.getElement(),this._network=t.getNetwork(),this._showOnTop=e},D.ext(\"twaver.canvas.Attachment\",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},isShowOnTop:function(){return!0===this._showOnTop},setShowOnTop:function(t){this._showOnTop=t},getStyle:function(t){return this._ui.getStyle(t)},getFont:function(t){return this._ui.getFont(t)},getViewRect:function(){return D.clone(this._viewRect)},getAlpha:function(){return 1},validate:function(){},paint:function(t){},hit:function(t,e){return!!W.containsPoint(this._viewRect,t,e)&&this.hitCanvasRect({x:t-1,y:e-1,width:2,height:2})},hitCanvasRect:function(t){var e=Me.getHitCanvas(t.width,t.height),i=Me.getCtx(e);i.save(),i.translate(-t.x,-t.y),this.paint(i);try{for(var n=i.getImageData(0,0,t.width,t.height),s=n.data,o=0;o<n.width;o++)for(var r=0;r<n.height;r++){if(0!==s[4*(r*n.width+o)+3])return i.restore(),!0}}catch(t){Me.disposeHitCanvas()}return i.restore(),!1},dispose:function(){},_rotatePoint:function(t,e,i){return W.createMatrix(e*Math.PI/180,i.x+i.width/2,i.y+i.height/2).transform(t)},_rotatePointList:function(t,e,i){var n=this,s=new R.List;return t.forEach(function(t){s.add(n._rotatePoint(t,e,i))}),s}}),R.canvas.BasicAttachment=function(t,e){R.canvas.BasicAttachment.superClass.constructor.call(this,t,e),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0}},D.ext(\"twaver.canvas.BasicAttachment\",R.canvas.Attachment,{paint:function(t){R.canvas.BasicAttachment.superClass.paint.apply(this,arguments);var e=this.isFill(),i=this.getOutlineWidth();if(this.getElementUI().setShadow(this,t),(i>0||e)&&(Y.drawRoundRect(t,this._roundRect.x,this._roundRect.y,this._roundRect.width,this._roundRect.height,this.getCornerRadius()),this._pointers&&(t.moveTo(this._pointers[0].x,this._pointers[0].y),t.lineTo(this._pointers[1].x,this._pointers[1].y),t.lineTo(this._pointers[2].x,this._pointers[2].y)),t.closePath(),i>0&&(t.lineWidth=i,t.strokeStyle=this.getOutlineColor(),t.lineCap=this.getCap(),t.lineJoin=this.getJoin(),t.stroke()),e)){var n=this.getFillColor(),s=this.getGradient();s?Y.fill(t,n,s,this.getGradientColor(),this._viewRect):t.fillStyle=n,t.fill()}},validate:function(){R.canvas.BasicAttachment.superClass.validate.call(this),this.calculateMeasure();var t=this.getOutlineWidth();this._viewRect=W.getRect(this._pointers),this._viewRect=W.unionRect(this._viewRect,this._roundRect),t>0&&W.grow(this._viewRect,t/2,t/2),this._viewRect=this._ui.appendShadowBound(this,this._viewRect)},calculateMeasure:function(){var t=this.getContentWidth(),e=this.getContentHeight(),i=this.getCornerRadius(),n=this.getPointerLength(),s=this.getPointerWidth(),o=this.getPosition(),r=this.getXOffset(),a=this.getYOffset(),h=this._roundRect;h.width=t+i,h.height=e;var l;if(this._ui._element instanceof R.Link){var c,d=this._ui.getLinkPoints();c=this._ui.getLineLength?this._ui.getLineLength():this._ui._element.getLineLength(),Math.abs(r)>0&&Math.abs(r)<1?\"from\"===o?r*=c:\"to\"===o?r=c*(1-r):(r/=2,r+=.5,r*=c):\"from\"===o?r=r:\"to\"===o?r=c-r:r+=c/2;var u,_=W.calculatePointInfoAlongLine(d,!0,r,a),g=_.point;_.angle;u=\"from\"===o?this._ui.getFromPoint():\"to\"===o?this._ui.getToPoint():this._ui._hotSpot,r=g.x-u.x,a=g.y-u.y}if(n>0){var f=this.getDirection();l=this._network.getPosition(o,this._ui,null,r,a,!1);var v;if(\"aboveleft\"===f)h.y=l.y-n-h.height,h.x=l.x-(h.width-i),v=Math.max(l.x-s,l.x-(h.width-i)+i/2),this._pointers=[l,{x:l.x,y:l.y-n},{x:v,y:l.y-n}];else if(\"aboveright\"===f)h.y=l.y-n-h.height,h.x=l.x-i,v=Math.min(l.x+s,l.x-i+h.width-i/2),this._pointers=[l,{x:l.x,y:l.y-n},{x:v,y:l.y-n}];else if(\"belowleft\"===f)h.y=l.y+n,h.x=l.x-(h.width-i),v=Math.max(l.x-s,l.x-(h.width-i)+i/2),this._pointers=[l,{x:l.x,y:l.y+n},{x:v,y:l.y+n}];else if(\"belowright\"===f)h.y=l.y+n,h.x=l.x-i,v=Math.min(l.x+s,l.x-i+h.width-i/2),this._pointers=[l,{x:l.x,y:l.y+n},{x:v,y:l.y+n}];else if(\"leftabove\"===f)h.y=l.y+i-h.height,h.x=l.x-n-h.width,v=Math.max(l.y-s,l.y+i-h.height+i/2),this._pointers=[l,{x:l.x-n,y:l.y},{x:l.x-n,y:v}];else if(\"leftbelow\"===f)h.y=l.y-i,h.x=l.x-n-h.width,v=Math.min(l.y+s,l.y-i+h.height-i/2),this._pointers=[l,{x:l.x-n,y:l.y},{x:l.x-n,y:v}];else if(\"rightabove\"===f)h.y=l.y+i-h.height,h.x=l.x+n,v=Math.max(l.y-s,l.y+i-h.height+i/2),this._pointers=[l,{x:l.x+n,y:l.y},{x:l.x+n,y:v}];else if(\"rightbelow\"===f)h.y=l.y-i,h.x=l.x+n,v=Math.min(l.y+s,l.y-i+h.height-i/2),this._pointers=[l,{x:l.x+n,y:l.y},{x:l.x+n,y:v}];else if(\"above\"===f)h.y=l.y-n-h.height,h.x=l.x-h.width/2,v=Math.min(t/2,s/2),this._pointers=[l,{x:l.x-v,y:l.y-n},{x:l.x+v,y:l.y-n}];else if(\"below\"===f)h.y=l.y+n,h.x=l.x-h.width/2,v=Math.min(t/2,s/2),this._pointers=[l,{x:l.x-v,y:l.y+n},{x:l.x+v,y:l.y+n}];else if(\"left\"===f)h.y=l.y-h.height/2,h.x=l.x-n-h.width,v=Math.min(e/2,s/2),this._pointers=[l,{x:l.x-n,y:l.y+v},{x:l.x-n,y:l.y-v}];else{if(\"right\"!==f)throw\"Can not resolve '\"+f+\"' attachment direction\";h.y=l.y-h.height/2,h.x=l.x+n,v=Math.min(e/2,s/2),this._pointers=[l,{x:l.x+n,y:l.y+v},{x:l.x+n,y:l.y-v}]}}else l=this._network.getPosition(o,this._ui,{width:h.width,height:h.height},r,a,!1),h.x=l.x,h.y=l.y,this._pointers=null;this._contentRect.x=h.x+(h.width-t)/2,this._contentRect.y=h.y+(h.height-e)/2,this._contentRect.width=t,this._contentRect.height=e;var m=this.getPadding();0!=m&&W.grow(h,m,m),0!=(m=this.getPaddingLeft())&&(h.x-=m,h.width+=m),0!=(m=this.getPaddingRight())&&(h.width+=m),0!=(m=this.getPaddingTop())&&(h.y-=m,h.height+=m),0!=(m=this.getPaddingBottom())&&(h.height+=m),h.width<0&&(h.width=h.width,h.x-=h.width),h.height<0&&(h.height=-h.height,h.y-=h.height)},getContentWidth:function(){return R.Defaults.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return R.Defaults.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return R.Defaults.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return R.Defaults.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return R.Defaults.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return R.Defaults.ATTACHMENT_POSITION},getXOffset:function(){return R.Defaults.ATTACHMENT_XOFFSET},getYOffset:function(){return R.Defaults.ATTACHMENT_YOFFSET},getPadding:function(){return R.Defaults.ATTACHMENT_PADDING},getPaddingLeft:function(){return R.Defaults.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return R.Defaults.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return R.Defaults.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return R.Defaults.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return R.Defaults.ATTACHMENT_DIRECTION},isFill:function(){return R.Defaults.ATTACHMENT_FILL},getFillColor:function(){return R.Defaults.ATTACHMENT_FILL_COLOR},getGradient:function(){return R.Defaults.ATTACHMENT_GRADIENT},getGradientColor:function(){return R.Defaults.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return R.Defaults.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return R.Defaults.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return R.Defaults.ATTACHMENT_CAP},getJoin:function(){return R.Defaults.ATTACHMENT_JOIN},isShadowable:function(){return R.Defaults.ATTACHMENT_SHADOWABLE},getRoundRect:function(){return D.clone(this._roundRect)},getContentRect:function(){return D.clone(this._contentRect)}}),R.canvas.LabelAttachment=function(t,e){R.canvas.LabelAttachment.superClass.constructor.call(this,t,e)},D.ext(\"twaver.canvas.LabelAttachment\",R.canvas.BasicAttachment,{paint:function(t){var e=this._element instanceof R.Link&&this._element.getStyle(\"link.label.rotatable\");if(e){t.save();var i=this._viewRect.x+this._viewRect.width/2,n=this._viewRect.y+this._viewRect.height/2;t.translate(i,n),t.rotate(this._network.getElementUI(this._element).getAngle()),t.translate(-i,-n)}R.canvas.LabelAttachment.superClass.paint.apply(this,arguments);var s=this._element.getStyle(\"label.align\"),o=this._element&&this._element.getStyle(\"label.rotate.angle\");0!==o&&(t.save(),R.Util.rotateCanvas(t,this._contentRect,o)),Y.drawText(t,this.text,this._contentRect,this.font,this.getStyle(\"label.color\"),s,this.getStyle(\"label.linespacing\")),(e||0!==o)&&t.restore()},validate:function(){this.font=this.getFont(\"label.font\");var t=this.getLabel(),e=D.g.getTextSize(this.font,t),i=this.getMaxLength();0!==i&&e.width>i?(this.text=D.g.getCollapseTextInLength(this.font,t,i),this._textSize=D.g.getTextSize(this.font,this.text)):(this.text=t,this._textSize=e),R.canvas.LabelAttachment.superClass.validate.call(this);var n=this._viewRect,s=this._element&&this._element.getStyle(\"label.rotate.angle\");if(0!==s){var o=new R.List;o.add({x:n.x,y:n.y}),o.add({x:n.x+n.width,y:n.y}),o.add({x:n.x+n.width,y:n.y+n.height}),o.add({x:n.x,y:n.y+n.height}),o=this._rotatePointList(o,s,n);var r=R.Util.getRect(o);this._viewRect=r}},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle(\"label.corner.radius\")},getPointerLength:function(){return this.getStyle(\"label.pointer.length\")},getPointerWidth:function(){return this.getStyle(\"label.pointer.width\")},getPosition:function(){return this.getStyle(\"label.position\")},getXOffset:function(){return this.getStyle(\"label.xoffset\")},getYOffset:function(){return this.getStyle(\"label.yoffset\")},getPadding:function(){return this.getStyle(\"label.padding\")},getPaddingLeft:function(){return this.getStyle(\"label.padding.left\")},getPaddingRight:function(){return this.getStyle(\"label.padding.right\")},getPaddingTop:function(){return this.getStyle(\"label.padding.top\")},getPaddingBottom:function(){return this.getStyle(\"label.padding.bottom\")},getDirection:function(){return this.getStyle(\"label.direction\")},isFill:function(){return this.getStyle(\"label.fill\")},getFillColor:function(){return this.getStyle(\"label.fill.color\")},getGradient:function(){return this.getStyle(\"label.gradient\")},getGradientColor:function(){return this.getStyle(\"label.gradient.color\")},getOutlineWidth:function(){return this.getStyle(\"label.outline.width\")},getOutlineColor:function(){return this.getStyle(\"label.outline.color\")},getCap:function(){return this.getStyle(\"label.cap\")},getJoin:function(){return this.getStyle(\"label.join\")},getAlpha:function(){return this.getStyle(\"label.alpha\")},getMaxLength:function(){return this.getStyle(\"label.maxlength\")},isShadowable:function(){return this.getStyle(\"label.shadowable\")}}),R.canvas.AlarmAttachment=function(t,e){R.canvas.AlarmAttachment.superClass.constructor.call(this,t,e)},D.ext(\"twaver.canvas.AlarmAttachment\",R.canvas.BasicAttachment,{paint:function(t){R.canvas.AlarmAttachment.superClass.paint.apply(this,arguments),Y.drawText(t,this.text,this._contentRect,this.font,this.getStyle(\"alarm.color\"))},validate:function(){this.font=this.getFont(\"alarm.font\"),this.text=this._network.getAlarmLabel(this._element),this._textSize=Y.getTextSize(this.font,this.text),this._fillColor=this._network.getAlarmFillColor(this._element),R.canvas.LabelAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle(\"alarm.corner.radius\")},getPointerLength:function(){return this.getStyle(\"alarm.pointer.length\")},getPointerWidth:function(){return this.getStyle(\"alarm.pointer.width\")},getPosition:function(){return this.getStyle(\"alarm.position\")},getXOffset:function(){return this.getStyle(\"alarm.xoffset\")},getYOffset:function(){return this.getStyle(\"alarm.yoffset\")},getPadding:function(){return this.getStyle(\"alarm.padding\")},getPaddingLeft:function(){return this.getStyle(\"alarm.padding.left\")},getPaddingRight:function(){return this.getStyle(\"alarm.padding.right\")},getPaddingTop:function(){return this.getStyle(\"alarm.padding.top\")},getPaddingBottom:function(){return this.getStyle(\"alarm.padding.bottom\")},getDirection:function(){return this.getStyle(\"alarm.direction\")},isFill:function(){return null!=this._fillColor},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle(\"alarm.gradient\")},getGradientColor:function(){return this.getStyle(\"alarm.gradient.color\")},getOutlineWidth:function(){return this.getStyle(\"alarm.outline.width\")},getOutlineColor:function(){return this.getStyle(\"alarm.outline.color\")},getCap:function(){return this.getStyle(\"alarm.cap\")},getJoin:function(){return this.getStyle(\"alarm.join\")},getAlpha:function(){return this.getStyle(\"alarm.alpha\")},isShadowable:function(){return this.getStyle(\"alarm.shadowable\")}}),R.canvas.LinkHandlerAttachment=function(t,e){R.canvas.LinkHandlerAttachment.superClass.constructor.call(this,t,e)},D.ext(\"twaver.canvas.LinkHandlerAttachment\",R.canvas.BasicAttachment,{paint:function(t){R.canvas.LinkHandlerAttachment.superClass.paint.apply(this,arguments),Y.drawText(t,this.linkHandlerLabel,this._contentRect,this.linkHandlerFont,this.getStyle(\"link.handler.color\"))},validate:function(){this.linkHandlerFont=this.getFont(\"link.handler.font\"),this.linkHandlerLabel=this._network.getLinkHandlerLabel(this._element),this._textSize=Y.getTextSize(this.linkHandlerFont,this.linkHandlerLabel),R.canvas.LinkHandlerAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle(\"link.handler.corner.radius\")},getPointerLength:function(){return this.getStyle(\"link.handler.pointer.length\")},getPointerWidth:function(){return this.getStyle(\"link.handler.pointer.width\")},getPosition:function(){return this.getStyle(\"link.handler.position\")},getXOffset:function(){return this.getStyle(\"link.handler.xoffset\")},getYOffset:function(){return this.getStyle(\"link.handler.yoffset\")},getPadding:function(){return this.getStyle(\"link.handler.padding\")},getPaddingLeft:function(){return this.getStyle(\"link.handler.padding.left\")},getPaddingRight:function(){return this.getStyle(\"link.handler.padding.right\")},getPaddingTop:function(){return this.getStyle(\"link.handler.padding.top\")},getPaddingBottom:function(){return this.getStyle(\"link.handler.padding.bottom\")},getDirection:function(){return this.getStyle(\"link.handler.direction\")},isFill:function(){return this.getStyle(\"link.handler.fill\")},getFillColor:function(){return this.getStyle(\"link.handler.fill.color\")},getGradient:function(){return this.getStyle(\"link.handler.gradient\")},getGradientColor:function(){return this.getStyle(\"link.handler.gradient.color\")},getOutlineWidth:function(){return this.getStyle(\"link.handler.outline.width\")},getOutlineColor:function(){return this.getStyle(\"link.handler.outline.color\")},getCap:function(){return this.getStyle(\"link.handler.cap\")},getJoin:function(){return this.getStyle(\"link.handler.join\")},getAlpha:function(){return this.getStyle(\"link.handler.alpha\")},isShadowable:function(){return this.getStyle(\"link.handler.shadowable\")}}),R.canvas.IconsAttachment=function(t,e){R.canvas.IconsAttachment.superClass.constructor.call(this,t,e)},D.ext(\"twaver.canvas.IconsAttachment\",R.canvas.Attachment,{isShadowable:function(){return R.Defaults.ATTACHMENT_SHADOWABLE},validate:function(){if(R.canvas.IconsAttachment.superClass.validate.call(this),this.iconsNames=this._network.getIconsNames(this._element),this.iconsNames&&0!=this.iconsNames.length){var t=this._makeGroup(this.iconsNames),e=this._makeGroup(this._network.getIconsColors(this._element));len=t.length,this.iconsOrientation=this._makeArray(this._element.getStyle(\"icons.orientation\"),len,\"right\"),this.iconsPosition=this._makeArray(this._element.getStyle(\"icons.position\"),len,\"topleft.bottomright\"),this.iconsXoffset=this._makeArray(this._element.getStyle(\"icons.xoffset\"),len,0),this.iconsYoffset=this._makeArray(this._element.getStyle(\"icons.yoffset\"),len,0),this.iconsXgap=this._makeArray(this._element.getStyle(\"icons.xgap\"),len,1),this.iconsYgap=this._makeArray(this._element.getStyle(\"icons.ygap\"),len,1),this.locations=[],this.iconsSizes=[];var n,s;for(i=0;i<len;i++){var o=t[i],r=this.iconsOrientation[i]||\"right\",a=this.iconsPosition[i]||\"topleft.bottomright\",h=this.iconsXgap[i]||1,l=this.iconsYgap[i]||1,c=this.iconsXoffset[i]||0,d=this.iconsYoffset[i]||0;if(this._ui._element instanceof R.Link){var u,_=this._ui.getLinkPoints();u=this._ui.getLineLength?this._ui.getLineLength():this._ui._element.getLineLength(),Math.abs(c)>0&&Math.abs(c)<1?\"from\"===a?c*=u:\"to\"===a?c=u*(1-c):(c/=2,c+=.5,c*=u):\"from\"===a?c=c:\"to\"===a?c=u-c:c+=u/2;var g,f=W.calculatePointInfoAlongLine(_,!0,c,d),v=f.point;f.angle;g=\"from\"===a?this._ui.getFromPoint():\"to\"===a?this._ui.getToPoint():this._ui._hotSpot,c=v.x-g.x,d=v.y-g.y}s=null,(n=this._getIconsSize(o,r,h,l))&&(s=this._network.getPosition(a,this._ui,n,c,d),\"top\"===r?s.y+=n.height:\"left\"===r&&(s.x+=n.width)),this.locations.push(s),this.iconsSizes.push(n)}var m=null;for(i=0;i<this.locations.length;i++)s=this.locations[i],n=this.iconsSizes[i],null!=s&&(m=null==m?{x:s.x,y:s.y,width:n.width,height:n.height}:W.unionRect(m,{x:s.x,y:s.y,width:n.width,height:n.height}));this._viewRect=m||{x:this._element.getLocation().x,y:this._element.getLocation().y,width:0,height:0},this.iconsGroups=t,this.colorGroups=e;var p=this._element instanceof R.Link&&this._element.getStyle(\"link.icons.rotatable\");for(i=0;i<len;i++)if(p instanceof Array&&p[i]&&this._viewRect){var w=this._viewRect.x+this._viewRect.width/2,y=this._viewRect.y+this._viewRect.height/2,A=Math.sqrt(this._viewRect.height*this._viewRect.height+this._viewRect.width*this._viewRect.width);this._viewRect={x:w-A/2,y:y-A/2,width:A,height:A}}}},_makeGroup:function(t){if(!Array.isArray(t))return[[t]];var e,i,n,s=[],o=!1,r=t.length;for(e=0;e<r;e++)i=t[e],Array.isArray(i)?(o=!0,s.push(i)):(n=[i],s.push(n));return o||(s.length=0,s.push(t)),s},_makeArray:function(t,e,i){if(Array.isArray(t))return t;for(var n=[],s=0;s<e;s++)n.push(t||i);return n},paint:function(t){if(R.canvas.IconsAttachment.superClass.paint.apply(this,arguments),this.iconsNames&&0!=this.iconsNames.length&&this.locations){var e,i,n,s,o,r,a,h;for(e=0;e<this.iconsGroups.length;e++)if(i=this.locations[e]){f=i.x,v=i.y,s=this.iconsGroups[e],o=this.colorGroups[e],r=this.iconsOrientation[e],a=this.iconsXgap[e]||1,h=this.iconsYgap[e]||1,n=0;for(var l in s){var c=null,d=null;o&&o.length>n&&(d=o[n++]);var u=D.getImageAsset(s[l]);if(null!=u){if(\"right\"===r)f+=(c={x:f,y:v,width:u.getWidth(),height:u.getHeight()}).width+a;else if(\"left\"===r)f-=(c={x:f-u.getWidth(),y:v,width:u.getWidth(),height:u.getHeight()}).width+a;else if(\"top\"===r)v-=(c={x:f,y:v-u.getHeight(),width:u.getWidth(),height:u.getHeight()}).height+h;else{if(\"bottom\"!==r)throw\"Can not resolve '\"+r+\"' orientation\";v+=(c={x:f,y:v,width:u.getWidth(),height:u.getHeight()}).height+h}var _=this._element instanceof R.Link&&this._element.getStyle(\"link.icons.rotatable\");if(_ instanceof Array&&_[e]){t.save();var g=c,f=g.x+g.width/2,v=g.y+g.height/2;t.translate(f,v),t.rotate(this._network.getElementUI(this._element).getAngle()),t.translate(-f,-v),Dt(t,u.getImage(d,c.width,c.height),d,c,this._element,this._network),t.restore()}else Dt(t,u.getImage(d,c.width,c.height),d,c,this._element,this._network);if(this._network._debug){c=this._viewRect;Y.strokeRect(t,c,\"#FCFC00\",1),Y.strokeRect(t,c,\"#FCFC00\",1)}}}}}},_getIconsSize:function(t,e,i,n){var s=0,o=0,r=null,a=null,h=null;for(var l in t)if(a=D.getImageAsset(t[l])){if(\"right\"===e)s+=(r={x:s,y:o,width:a.getWidth(),height:a.getHeight()}).width+i;else if(\"left\"===e)s-=(r={x:s-a.getWidth(),y:o,width:a.getWidth(),height:a.getHeight()}).width+i;else if(\"top\"===e)o-=(r={x:s,y:o-a.getHeight(),width:a.getWidth(),height:a.getHeight()}).height+n;else{if(\"bottom\"!==e)throw\"Can not resolve '\"+e+\"' orientation\";o+=(r={x:s,y:o,width:a.getWidth(),height:a.getHeight()}).height+n}h=null==h?D.clone(r):W.unionRect(h,r)}return h?{width:Math.abs(h.width),height:Math.abs(h.height)}:null}}),R.canvas.EditAttachment=function(t,e){R.canvas.EditAttachment.superClass.constructor.call(this,t,e)},D.ext(\"twaver.canvas.EditAttachment\",R.canvas.Attachment,{paint:function(t){R.canvas.EditAttachment.superClass.paint.apply(this,arguments),this._viewRect=null,this.paintResizingPoints(t),this.paintEditPoints(t),this.paintRotatePoints(t)},paintResizingPoints:function(t){var e=this.resizingPoints.size();if(!(e<=0)){var i=2*this.resizePointSize,n=2*this.resizePointSize,s=this._network.getResizePointFillColor(),o=this._network.getResizePointOutlineWidth(),r=this._network.getResizePointOutlineColor(),a=this._element.getAngle(),h=this._element.getOriginalRect();t.lineWidth=o;for(var l=0;l<e;l++){var c=this.resizingPoints.get(l),d={x:c.x-this.resizePointSize,y:c.y-this.resizePointSize,width:2*this.resizePointSize,height:2*this.resizePointSize},u=this._getRotateRect(d,a,{x:h.x+h.width/2,y:h.y+h.height/2});t.save(),R.Util.rotateCanvas(t,u,a),Me.rect(t,u.x,u.y,i,n),t.restore()}t.fillStyle=s,t.strokeStyle=r,t.fill(),t.stroke()}},paintEditPoints:function(t){var e=this.editPoints.size();if(!(e<=0)){var i=this._network.getEditPointOutlineColor(),n=this._network.getEditPointFillColor(),s=this._network.getEditPointOutlineWidth();t.beginPath(),t.lineWidth=s;for(var o=0;o<e;o++){var r=this.editPoints.get(o);t.beginPath(),Me.circle(t,r.x,r.y,this.editPointSize,n,i),t.closePath()}}},paintRotatePoints:function(t){var e=this.rotatePoints.size();if(!(e<=0)){var i=this._network.getRotatePointOutlineColor(),n=this._network.getRotatePointFillColor(),s=this._network.getRotatePointOutlineWidth();t.beginPath(),t.lineWidth=s;for(var o=0;o<e;o++){var r=this.rotatePoints.get(o);t.beginPath(),Me.circle(t,r.x,r.y,this.rotatePointSize,n,i),t.closePath()}}},validate:function(){R.canvas.EditAttachment.superClass.validate.call(this),this.editPointSize=this._network.getEditPointSize(),this.resizePointSize=this._network.getResizePointSize(),this.rotatePointSize=this._network.getRotatePointSize(),this.resizingPoints=new R.List,this.editPoints=new R.List,this.rotatePoints=new R.List,this._element instanceof R.Node&&this._addResizingPoint(this._element),!(this._network.isRotatable(this._element)&&this._element instanceof Pe)||this._element instanceof R.ShapeNode||this._element instanceof R.Grid||this._element instanceof R.Group||this._addRotatePoint(this._element),this._element instanceof R.ShapeNode&&(this._addResizingPoint(this._element),this._addShapeNodePoint(this._element)),this._ui instanceof R.canvas.ShapeLinkUI&&this._addShapeLinkPoints(this._element),this._ui instanceof R.canvas.LinkUI&&this._addLinkControlPoint(this._ui)},_addResizingPoint:function(t){var e=t.getOriginalRect();if(e){if(!(this._network.getResizePointSize()<=0)){var i=new oe([{x:e.x,y:e.y},{x:e.x+e.width/2,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x,y:e.y+e.height/2},{x:e.x+e.width,y:e.y+e.height/2},{x:e.x,y:e.y+e.height},{x:e.x+e.width/2,y:e.y+e.height},{x:e.x+e.width,y:e.y+e.height}]),n=this._network.getResizePointOutlineWidth(),s=this._network.getResizePointOutlineColor(),o=this._network.getResizePointFillColor();this._addPoints(t.getRect(),i,n,s,o,!0)}}},_addRotatePoint:function(t){var e=t.getOriginalRect();if(e){var i=this._network.getRotatePointSize();if(!(i<=0)){var n=2*i,s=new R.List([{x:e.x+e.width/2,y:e.y-this._network.getRotatePointOffset()-n/2}]),o=t.getAngle();0!=o&&(s=this._rotatePointList(s,o,t.getOriginalRect()));var r=s.get(0),a={x:r.x-n/2,y:r.y-n/2,width:n,height:n},h=this._network.getRotatePointOutlineWidth(),l=this.rotatePointSize+h;W.grow(e,l,l);var c=W.unionRect(t.getRect(),a);this._viewRect=W.unionRect(c,this._viewRect),this.rotatePoints=s}}},_addShapeNodePoint:function(t){this._addEditPoints(t.getPoints())},_addShapeLinkPoints:function(t){this._addEditPoints(t.getPoints())},_addLinkControlPoint:function(t){if(pt.isOrthogonalLink(t._element)){var e=t.getControlPoint();if(e){var i=new R.List;i.add(e),this._addEditPoints(i)}}},_addEditPoints:function(t){var e=W.getRect(t);if(e){if(!(this._network.getEditPointSize()<=0)){var i=this._network.getEditPointOutlineWidth();this._addPoints(e,t,i,!1)}}},_addPoints:function(t,e,i,n,s,o){var r=o?this._network.getResizePointSize():this._network.getEditPointSize();if(!(r<0)){var a=r+i;W.grow(t,a,a),this._viewRect=W.unionRect(t,this._viewRect),1==o?this.resizingPoints=e:this.editPoints=e}},_rotatePoint:function(t,e,i){return W.createMatrix(e*Math.PI/180,i.x+i.width/2,i.y+i.height/2).transform(t)},_rotatePointList:function(t,e,i){var n=this,s=new R.List;return t.forEach(function(t){s.add(n._rotatePoint(t,e,i))}),s},_getRotateRect:function(t,e,i){var n=W.createMatrix(e*Math.PI/180,i.x,i.y),s={x:t.x+t.width/2,y:t.y+t.height/2},o=n.transform(s),r=new R.List([{x:o.x-t.width/2,y:o.y-t.height/2},{x:o.x+t.width/2,y:o.y-t.height/2},{x:o.x+t.width/2,y:o.y+t.height/2},{x:o.x-t.width/2,y:o.y+t.height/2}]);return W.getRect(r)}}),R.canvas.HTMLLabelAttachment=function(t,e){R.canvas.HTMLLabelAttachment.superClass.constructor.call(this,t,e),this._triangleDiv=R.Util.createDiv(),this._roundDiv=R.Util.createDiv(),this._contentDiv=R.Util.createDiv();this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},D.ext(\"twaver.canvas.HTMLLabelAttachment\",R.canvas.LabelAttachment,{validate:function(){var t=this._element.getStyle(\"attachment.pointer.events\");R.Util.setCSSStyle(this._triangleDiv,\"pointer-events\",t),R.Util.setCSSStyle(this._contentDiv,\"pointer-events\",t),R.Util.setCSSStyle(this._triangleDiv,\"border-style\",\"solid\"),R.Util.setCSSStyle(this._contentDiv,\"white-space\",\"nowrap\");this.getFont(\"label.font\");var e=this.getLabel();this._contentDiv.innerHTML=e,this._contentDiv.style.visibility=\"hidden\",R.canvas.HTMLLabelAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(R.Util.getCSSStyle(this._contentDiv.firstChild,\"width\"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(R.Util.getCSSStyle(this._contentDiv.firstChild,\"height\"))},paint:function(t){var e=this.isFill(),i=this.getOutlineWidth(),n=this._contentRect;if(this.getElementUI().setShadow(this,t),i>0||e){if(Y.drawRoundRect(t,n.x,n.y,n.width,n.height,this.getCornerRadius()),this._pointers){var s=this._pointers;t.moveTo(s[0].x,s[0].y),t.lineTo(s[1].x,s[1].y),t.lineTo(s[2].x,s[2].y)}if(t.closePath(),i>0&&(t.lineWidth=i,t.strokeStyle=this.getOutlineColor(),t.lineCap=this.getCap(),t.lineJoin=this.getJoin(),t.stroke()),e){var o=this.getFillColor(),r=this.getGradient();r?Y.fill(t,o,r,this.getGradientColor(),this._viewRect):t.fillStyle=o,t.fill()}}this.getFont(\"label.font\"),this.getLabel();var a=this._network.getViewRect().x,h=this._network.getViewRect().y,l=this._network.getZoom(),c=this._contentRect.x+this._contentRect.width/2,d=this._contentRect.y+this._contentRect.height/2,u=c*l-a-this._contentDiv.offsetWidth/2*l+\"px\",_=d*l-h-this._contentDiv.offsetHeight/2*l+\"px\";this._contentDiv.style.left=u,this._contentDiv.style.top=_,this._contentDiv.style.setProperty(\"-webkit-transform\",\"scale(\"+l+\")\",null),this._contentDiv.style.setProperty(\"-webkit-transform-origin\",\"0 0\",null),this._network._debug&&Y.strokeRect(t,this._contentRect,\"#AAAAAA\")},setVisibility:function(t){this._contentDiv.style.visibility=t},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),R.canvas.HTMLAlarmAttachment=function(t,e){R.canvas.HTMLAlarmAttachment.superClass.constructor.call(this,t,e),this._triangleDiv=R.Util.createDiv(),this._roundDiv=R.Util.createDiv(),this._contentDiv=R.Util.createDiv(),R.Util.setCSSStyle(this._triangleDiv,\"border-style\",\"solid\"),R.Util.setCSSStyle(this._triangleDiv,\"pointer-events\",\"none\"),R.Util.setCSSStyle(this._contentDiv,\"white-space\",\"nowrap\"),R.Util.setCSSStyle(this._contentDiv,\"pointer-events\",\"none\");this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},D.ext(\"twaver.canvas.HTMLAlarmAttachment\",R.canvas.AlarmAttachment,{validate:function(){this.getFont(\"alarm.font\");var t=this._network.getAlarmLabel(this._element);this._contentDiv.innerHTML=t,this._contentDiv.style.visibility=\"hidden\",R.canvas.HTMLAlarmAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(R.Util.getCSSStyle(this._contentDiv.firstChild,\"width\"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(R.Util.getCSSStyle(this._contentDiv.firstChild,\"height\"))},paint:function(t){var e=this.isFill(),i=this.getOutlineWidth(),n=this._contentRect;if(this.getElementUI().setShadow(this,t),i>0||e){if(Y.drawRoundRect(t,n.x,n.y,n.width,n.height,this.getCornerRadius()),this._pointers){var s=this._pointers;t.moveTo(s[0].x,s[0].y),t.lineTo(s[1].x,s[1].y),t.lineTo(s[2].x,s[2].y)}if(t.closePath(),i>0&&(t.lineWidth=i,t.strokeStyle=this.getOutlineColor(),t.lineCap=this.getCap(),t.lineJoin=this.getJoin(),t.stroke()),e){var o=this.getFillColor(),r=this.getGradient();r?Y.fill(t,o,r,this.getGradientColor(),this._viewRect):t.fillStyle=o,t.fill()}}this.getFont(\"alarm.font\"),this._network.getAlarmLabel(this._element);var a=this._network.getViewRect().x,h=this._network.getViewRect().y,l=this._network.getZoom(),c=this._contentRect.x+this._contentRect.width/2,d=this._contentRect.y+this._contentRect.height/2,u=c*l-a-this._contentDiv.offsetWidth/2*l+\"px\",_=d*l-h-this._contentDiv.offsetHeight/2*l+\"px\";this._contentDiv.style.left=u,this._contentDiv.style.top=_,this._contentDiv.style.setProperty(\"-webkit-transform\",\"scale(\"+l+\")\",null),this._contentDiv.style.setProperty(\"-webkit-transform-origin\",\"0 0\",null),this._network._debug&&Y.strokeRect(t,this._contentRect,\"#AAAAAB\"),R.canvas.AlarmAttachment.superClass.paint.apply(this,arguments)},setVisibility:function(t){this._contentDiv.style.visibility=t},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),R.canvas.interaction.BaseInteraction=function(t){this.network=t},D.ext(\"twaver.canvas.interaction.BaseInteraction\",Object,{setUp:function(){},tearDown:function(){},repaint:function(){this.network.repaintTopCanvas()},convertPointFromView:function(t){return{x:t.x*this.network.getZoom()-this.network.getViewRect().x,y:t.y*this.network.getZoom()-this.network.getViewRect().y}},convertFromUIToMarkerRect:function(t,e,i){var n=this.network.getZoom();return{x:t.x*n-this.network.getViewRect().x+e*n,y:t.y*n-this.network.getViewRect().y+i*n,width:t.width*n,height:t.height*n}},getMarkerPoint:function(t){if(V.isTouchable&&t.changedTouches&&t.changedTouches.length>0){var e=t.changedTouches[0];return{x:e.clientX,y:e.clientY}}return V.isFirefox?{x:t.layerX,y:t.layerY}:{x:t.offsetX,y:t.offsetY}},paint:function(t){},addListener:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];X.addEventListener(e,\"handle_\"+e,this.network.getView(),this)}},removeListener:function(){for(var t=0;t<arguments.length;t++)X.removeEventListener(arguments[t],this.network.getView(),this)},_handle_mousedown:function(t){0===t.button&&(this._startLogical=this.network.getLogicalPoint(t),this._startClient=X.getClientPoint(t),this._startLogical&&X.handle_mousedown(this,t))},_handle_mousemove:function(t){this._endLogical={x:this._startLogical.x+(t.clientX-this._startClient.x)/this.network.getZoom(),y:this._startLogical.y+(t.clientY-this._startClient.y)/this.network.getZoom()}},_handle_mouseup:function(t){delete this._startClient,delete this._startLogical,delete this._endLogical}}),R.canvas.interaction.SelectInteraction=function(t){R.canvas.interaction.SelectInteraction.superClass.constructor.call(this,t)},D.ext(\"twaver.canvas.interaction.SelectInteraction\",R.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener(\"mousedown\",\"mouseup\"),this.network.addMarker(this)},tearDown:function(){this.removeListener(\"mousedown\",\"mouseup\"),this.end(),this.network.removeMarker(this)},paint:function(t){if(null!=this.startPoint&&null!=this.endPoint){var e=this.convertPointFromView(this.startPoint),i=this.convertPointFromView(this.endPoint),n=e.x,s=e.y,o=i.x,r=i.y,a=W.getRect([{x:n,y:s},{x:o,y:r}]);if(null!=a){t.beginPath();var h=this.network.getSelectOutlineWidth(),l=this.getIntersectMode()?this.network.getSelectFillColor():null;t.strokeStyle=this.network.getSelectOutlineColor(),t.lineWidth=h,Me.rect(t,a.x,a.y,a.width,a.height,l,this.network.getSelectOutlineColor()),t.closePath()}}},handle_mousedown:function(t){if(this.network.isValidEvent(t)&&!this.network.isMovingElement()&&!this.network.isEditingElement()&&!t.shiftKey){var e=this.network.getElementAt(t),i=this.network.getSelectionModel();e?D.isCtrlDown(t)?i.contains(e)?i.removeSelection(e):i.appendSelection(e):i.contains(e)||i.setSelection(e):(D.isCtrlDown(t)||i.clearSelection(),this.end(t),this.startPoint=this.network.getLogicalPoint(t),this.startPoint&&this.network.isRectSelectEnabled()&&this.addListener(\"mousemove\"))}},handle_mouseup:function(t){this.end(t)},handle_mousemove:function(t){if(this.network.isMovingElement()||this.network.isEditingElement())this.end(t);else{var e=this.network.getLogicalPoint(t);e&&(this.network.setSelectingElement(!0),null==this.endPoint?this.network.fireInteractionEvent({kind:\"selectStart\",event:t}):this.network.fireInteractionEvent({kind:\"selectBetween\",event:t}),this.endPoint=e,this.repaint())}},end:function(t){if(this.startPoint){if(this.endPoint&&this.startPoint.x!==this.endPoint.x&&this.startPoint.y!==this.endPoint.y){var e=W.getRect([this.startPoint,this.endPoint]),i=this.network.getElementsAtRect(e,this.getIntersectMode(),this.network.getRectSelectFilter());if(i&&i.size()>0){var n=this.network.getSelectionModel(),s=n.toSelection();i.forEach(function(t){n.contains(t)?s.remove(t):s.add(t)},this),n.setSelection(s)}this.network.fireInteractionEvent({kind:\"selectEnd\",event:t})}this.network.setSelectingElement(!1),this.removeListener(\"mousemove\"),this.startPoint=null,this.endPoint=null,this.repaint()}},getIntersectMode:function(){return\"intersect\"===this.network.getSelectMode()||\"contain\"!==this.network.getSelectMode()&&(this.startPoint.x>this.endPoint.x&&this.startPoint.y>this.endPoint.y)}}),R.canvas.interaction.MoveInteraction=function(t,e){this.lazyMode=e,R.canvas.interaction.MoveInteraction.superClass.constructor.call(this,t)},D.ext(\"twaver.canvas.interaction.MoveInteraction\",R.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener(\"mousedown\",\"mouseup\",\"keydown\",\"mouseout\"),this.network.addMarker(this)},tearDown:function(){this.removeListener(\"mousedown\",\"mouseup\",\"keydown\",\"mouseout\"),this.end(),this.network.removeMarker(this)},handle_keydown:function(t){this.currentKeyEvent=t,this.addListener(\"keyup\")},handle_keyup:function(t){this.currentKeyEvent=null,this.removeListener(\"keyup\")},isParenting:function(){return this.pressPoint&&null!=this.currentKeyEvent&&80===this.currentKeyEvent.keyCode},parentProcess:function(t,e){var i=null;this.parent=null;if(!e&&this.isParenting()){var n={},s=this.network.getLogicalPoint(t);n.x=s.x-1,n.y=s.y-1,n.width=2,n.height=2;var o=this.network.getElementsAtRect(n,!0);if(o&&o.size()>0)for(var r=o.size(),a=0;a<r;a++){var h=o.get(a);if(!this.network.getElementBox().getSelectionModel().contains(h)){this.parent=h;break}}}else this.parent=null;null!=this.parent&&(i=this.network.getElementUI(this.parent).getViewRect()),this.parentRect=null==i||e?null:i},paint:function(t){if(this.lazyMode){if(null==this.pressPoint||null==this.dragPoint)return;t.beginPath();var e=this.dragPoint.x-this.pressPoint.x,i=this.dragPoint.y-this.pressPoint.y,n=this.network.getMovableSelectedElements(),s=n.size(),o=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,r=this.network.getLazyMoveOutlineWidth(),a=this.network.getLazyMoveOutlineColor();t.strokeStyle=a,t.lineWidth=r,t.fillStyle=o;for(var h=0;h<s;h++){var l=n.get(h),c=this.network.getElementUI(l);if(c){var d=this.convertFromUIToMarkerRect(c.getViewRect(),e,i);Me.rect(t,d.x,d.y,d.width,d.height)}}t.fill(),t.stroke()}if(this.parentRect){t.beginPath();o=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,r=this.network.getLazyMoveOutlineWidth(),a=this.network.getLazyMoveOutlineColor();t.strokeStyle=a,t.lineWidth=r,t.fillStyle=o;d=this.parentRect;Me.rect(t,d.x,d.y,d.width,d.height),t.fill(),t.stroke()}},handle_mousedown:function(t){if(0===t.button&&this.network.isValidEvent(t)&&!this.network.isSelectingElement()&&!this.network.isEditingElement()){var e=this.network.getElementAt(t);this.network.isMovable(e)&&(this.end(t),this.lastPoint=this.network.getLogicalPoint(t),this.lazyMode&&(this.pressPoint=this.lastPoint),this.lastPoint&&this.addListener(\"mousemove\"))}},handle_mouseup:function(t){this.end(t)},handle_mouseout:function(t){this.end(t)},handle_mousemove:function(t){if(this.network.isSelectingElement()||this.network.isEditingElement()||!this.network.hasMovableSelectedElements())this.end(t);else{var e=this.network.getLogicalPoint(t);e&&this.lastPoint&&(this.xoffset=e.x-this.lastPoint.x,this.yoffset=e.y-this.lastPoint.y,Math.abs(this.xoffset)<1&&Math.abs(this.yoffset)<1||(this.lazyMode?null==this.dragPoint?(this.network.fireInteractionEvent({kind:\"lazyMoveStart\",event:t}),this.network.setMovingElement(!0)):this.network.fireInteractionEvent({kind:\"lazyMoveBetween\",event:t}):(this.lastPoint=e,this.network.isMovingElement()?this.network.fireInteractionEvent({kind:\"liveMoveBetween\",event:t}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:\"liveMoveStart\",event:t})),this.network.moveSelectedElements(this.xoffset,this.yoffset)),this.parentProcess(t,!1),this.lazyMode&&(this.dragPoint=e),(this.lazyMode||this.isParenting())&&this.repaint()))}},end:function(t){if(this.lazyMode){if(null!=this.dragPoint&&null!=this.pressPoint){var e=this,i=this.dragPoint.x-this.pressPoint.x,n=this.dragPoint.y-this.pressPoint.y;this.network.moveSelectedElements(i,n,this.network.isLazyMoveAnimate(),function(){e.network.fireInteractionEvent({kind:\"lazyMoveEnd\",event:t}),e.network.setMovingElement(!1)})}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:\"liveMoveEnd\",event:t}));if(this.isParenting()){null==this.parent&&(this.parent=this.network.getCurrentSubNetwork());e=this;this.network.getMovableSelectedElements().forEach(function(t){t.setParent(e.parent)},this.network)}this.parentProcess(t,!0),this.isParenting()&&this.repaint(),this.network.invalidateCanvasSize(),this.removeListener(\"mousemove\"),this.lastPoint=null,this.dragPoint=null,this.pressPoint=null}}),R.canvas.interaction.ScrollInteraction=function(t){R.canvas.interaction.ScrollInteraction.superClass.constructor.call(this,t),this.hThumbRect=null,this.vThumbRect=null,this.scrollBarVisible=!1},D.ext(\"twaver.canvas.interaction.ScrollInteraction\",R.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener(\"mousedown\",\"mouseover\",\"mouseout\"),V.isFirefox?X.addEventListener(\"DOMMouseScroll\",\"handleMouseWheel\",this.network.getView(),this):X.addEventListener(\"mousewheel\",\"handleMouseWheel\",this.network.getView(),this),X.addEventListener(\"mouseup\",\"handleMouseUp\",window,this),X.addEventListener(\"mousemove\",\"handleMouseMove\",window,this),this.network.addPropertyChangeListener(this.handleViewRectChange,this),this.validateScrollBar(),this.network.addMarker(this)},tearDown:function(){this.removeListener(\"mousedown\",\"mouseover\",\"mouseout\"),V.isFirefox?X.removeEventListener(\"DOMMouseScroll\",this.network.getView(),this):X.removeEventListener(\"mousewheel\",this.network.getView(),this),X.removeEventListener(\"mouseup\",window,this),X.removeEventListener(\"mousemove\",window,this),this.network.removePropertyChangeListener(this.handleViewRectChange,this),this.network.removeMarker(this)},handleViewRectChange:function(t){\"viewRect\"!=t.property&&\"canvasSizeChange\"!=t.property||this.validateScrollBar()},getScrollBarWidth:function(){return this.network.getScrollBarWidth()},getScrollBarColor:function(){return\"#cccccc\"},validateScrollBar:function(){if(this.hThumbRect=null,this.vThumbRect=null,0!=this.network.isScrollBarVisible()){var t=this.network.getViewRect().height,e=this.network.getViewRect().width,i=this.network.getViewRect().x,n=this.network.getViewRect().y,s=this.network.getCanvasSize(),o=s.width,r=s.height;if(o>e&&(i<0||i+e>o))this.repaint();else if(r>t&&(n<0||n+t>r))this.repaint();else{var a=0,h=t<r,l=e<o,c=this.getScrollBarWidth();if(t<r){var d=n/(r-t)*(t-(a=l?t*(t-c)/r:t*t/r)-c);this.vThumbRect={x:e-c,y:d,width:c,height:a}}var u=0;if(e<o){var _=i/(o-e)*(e-(u=h?e*(e-c)/o:e*e/o)-c);this.hThumbRect={x:_,y:t-c,width:u,height:c}}this.network.setHScrollBarVisible(null!=this.hThumbRect),this.network.setVScrollBarVisible(null!=this.vThumbRect),this.repaint()}}else this.repaint()},scrollXOffset:function(t){var e=this.network.getViewRect().height,i=this.network.getViewRect().width,n=this.network.getViewRect().x,s=this.network.getViewRect().y,o=30;t&&(o=-30),this.network.setViewRect(n+o,s,i,e)},scrollYOffset:function(t){var e=this.network.getViewRect().height,i=this.network.getViewRect().width,n=this.network.getViewRect().x,s=this.network.getViewRect().y,o=30;t&&(o=-30),this.network.setViewRect(n,s+o,i,e)},handle_mousedown:function(t){if(1!=this.network.isValidEvent(t)){var e=this.getMarkerPoint(t);this.hBarDownPoint=null,this.vBarDownPoint=null,null!=this.vThumbRect&&W.containsPoint(this.vThumbRect,e.x,e.y)&&(this.vBarDownPoint={x:t.screenX,y:t.screenY},this.vBarDownOffset=this.vBarDownPoint.y-this.vThumbRect.y),null!=this.hThumbRect&&W.containsPoint(this.hThumbRect,e.x,e.y)&&(this.hBarDownPoint={x:t.screenX,y:t.screenY},this.hBarDownOffset=this.hBarDownPoint.x-this.hThumbRect.x)}},handle_mouseover:function(t){1!=this.scrollBarVisible&&(this.scrollBarVisible=!0,this.repaint())},handle_mouseout:function(t){0!=this.scrollBarVisible&&(this.scrollBarVisible=!1,this.repaint())},handleMouseUp:function(t){this.vBarDownPoint=null,this.hBarDownPoint=null,this.repaint()},handleMouseMove:function(t){var e={x:t.screenX,y:t.screenY},i=this.network.getCanvasSize(),n=this.network.getViewRect().height,s=this.network.getViewRect().width,o=this.getScrollBarWidth();if(null!=this.hBarDownPoint){var r=e.x-this.hBarDownPoint.x;return this.hBarDownPoint=e,void this.network.setViewOffSet(r*i.width/(s-o),0)}if(null!=this.vBarDownPoint){var a=e.y-this.vBarDownPoint.y;return this.vBarDownPoint=e,void this.network.setViewOffSet(0,a*i.height/(n-o))}},handleMouseWheel:function(t){var e=!1;t.wheelDelta,t.wheelDeltaX,t.wheelDelta?t.wheelDelta>0&&(e=!0):t.detail<0&&(e=!0),this.scrollYOffset(e)},paintRoundRect:function(t,e,i,n,s,o,r,a){t.beginPath(),t.globalAlpha=i,t.fillStyle=e,Y.drawRoundRect(t,n,s,o,r,a),t.fill()},paint:function(t){if(0!=this.network.isScrollBarVisible()&&(0!=this.scrollBarVisible||null!=this.hBarDownPoint||null!=this.vBarDownPoint)){var e=this.getScrollBarWidth(),i=this.network.getViewRect().height,n=this.network.getViewRect().width;t.save();var s,o=this.getScrollBarColor();null!=this.hThumbRect&&((s=t.createLinearGradient(this.hThumbRect.x,this.hThumbRect.y,this.hThumbRect.x,this.hThumbRect.y+this.hThumbRect.height)).addColorStop(0,o),s.addColorStop(1,\"#666666\"),this.paintRoundRect(t,this.getScrollBarColor(),.5,0,i-e,n-e,e,e/2),this.paintRoundRect(t,s,.9,this.hThumbRect.x,this.hThumbRect.y+1,this.hThumbRect.width,this.hThumbRect.height-2,e/2)),null!=this.vThumbRect&&((s=t.createLinearGradient(this.vThumbRect.x,this.vThumbRect.y,this.vThumbRect.x+this.vThumbRect.width,this.vThumbRect.y)).addColorStop(0,o),s.addColorStop(1,\"#666666\"),this.paintRoundRect(t,this.getScrollBarColor(),.5,n-e,0,e,i-e,e/2),this.paintRoundRect(t,s,.9,this.vThumbRect.x+1,this.vThumbRect.y,this.vThumbRect.width-2,this.vThumbRect.height,e/2)),t.restore()}}}),R.canvas.interaction.DefaultInteraction=function(t){R.canvas.interaction.DefaultInteraction.superClass.constructor.call(this,t)},D.ext(\"twaver.canvas.interaction.DefaultInteraction\",R.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener(\"mousedown\",\"mousemove\",\"keydown\")},tearDown:function(){this.removeListener(\"mousedown\",\"mousemove\",\"keydown\")},handle_mousedown:function(t){if(this.network.isValidEvent(t)){this.network.isFocusOnClick()&&R.Util.setFocus(this.network.getView());var e=this.network.getElementAt(t);2===t.detail?this.handleDoubleClicked(t,e):this.handleClicked(t,e)}},handleClicked:function(t,e){Ct.handleClicked(this.network,t,e)},handleDoubleClicked:function(t,e){Ct.handleDoubleClicked(this.network,t,e)},handle_keydown:function(t){Ct.handleKeyDown(this.network,t)},handle_mousemove:function(t){var e=this.network.getElementAt(t),i=this._preElement,n=Et(i),s=Et(e);i!==e&&(i&&(n&&n.onMouseLeave&&n.onMouseLeave(i,this.network),this.network.onMouseLeave(i,t)),e&&(s&&s.onMouseEnter&&s.onMouseEnter(e,this.network),this.network.onMouseEnter(e,t))),e&&s&&s.onMouseMove&&s.onMouseMove(e,this.network),this.network.onMouseMove(e,t),this._preElement=e}}),R.canvas.interaction.PanInteraction=function(t){R.canvas.interaction.PanInteraction.superClass.constructor.call(this,t)},D.ext(\"twaver.canvas.interaction.PanInteraction\",R.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener(\"mousedown\",\"mouseup\"),this._oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener(\"mousedown\",\"mouseup\")},handle_mousedown:function(t){this.network.isValidEvent(t)&&(this.lastPoint=this.getMarkerPoint(t),this.lastPoint&&(this.addListener(\"mousemove\"),this.network.getView().style.cursor=\"pointer\"))},handle_mouseup:function(t){this._clear()},handle_mousemove:function(t){if(this.lastPoint){var e=this.getMarkerPoint(t);if(e){var i=e.x-this.lastPoint.x,n=e.y-this.lastPoint.y;this.network.panByOffset(-i,-n),this.lastPoint=e}}},_clear:function(t){this.lastPoint&&(this.lastPoint=null,this.network.getView().style.cursor=this._oldCursor,this.removeListener(\"mousemove\"))}}),R.canvas.interaction.CreateElementInteraction=function(t,e){e||(e=R.Node),R.Util.isTypeOf(e,R.Node)?this.elementFunction=function(t){var i=new e;return i instanceof R.Node&&i.setCenterLocation(t),i}:this.elementFunction=e,R.canvas.interaction.CreateElementInteraction.superClass.constructor.call(this,t)},D.ext(\"twaver.canvas.interaction.CreateElementInteraction\",R.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener(\"mousedown\")},tearDown:function(){this.removeListener(\"mousedown\")},handle_mousedown:function(t){var e=this.network.getLogicalPoint(t);if(e){var i=this.elementFunction(e);i&&this.network.addElementByInteraction(i)}}}),R.canvas.interaction.EditInteraction=function(t,e){this.lazyMode=e,this.pointIndex=-1,R.canvas.interaction.EditInteraction.superClass.constructor.call(this,t)},D.ext(\"twaver.canvas.interaction.EditInteraction\",R.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener(\"mousedown\",\"mouseup\",\"mousemove\"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0),this.network.addMarker(this)},tearDown:function(){this.removeListener(\"mousedown\",\"mouseup\",\"mousemove\"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear(),this.network.removeMarker(this)},paint:function(t){if(1==this.lazyMode&&null!=this.resizingRect){t.lineWidth=this.network.getResizeLineWidth();var e=this.convertFromUIToMarkerRect(this.resizingRect,0,0);t.save(),R.Util.rotateCanvas(t,e,this.node.getAngle()),t.beginPath(),Me.rect(t,e.x,e.y,e.width,e.height,null,this.network.getResizeLineColor()),t.restore()}this.isStartRotate&&this.showRotateScale(t)},clear:function(){this.network.setEditingElement(!1),this.network.setRotatingElement(!1),this.isStart=!1,this.isStartRotate=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null,this.network.repaintTopCanvas()},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||\"default\",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor(\"crosshair\"),this.isCrossCursor=!0)},_setCursor:function(t){this.cursorID=t,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},isKeyDown:function(t){return D.isAltDown(t)},handle_mousedown:function(t){if(0===t.button)if(!this.isKeyDown(t)||this.network.isEditingElement())!this.network.isEditingElement()||this.isStart||this.isStartRotate||(this.node&&this.resizeDirection?(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:this.lazyMode?\"lazyResizeStart\":\"liveResizeStart\",event:t,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?this.isKeyDown(t)?(this.shapeNode.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:\"removePoint\",event:t,element:this.shapeNode})):(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:\"liveMovePointStart\",event:t,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0?this.isKeyDown(t)?(this.shapeLink.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:\"removePoint\",event:t,element:this.shapeLink})):(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:\"liveMovePointStart\",event:t,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI?(this.isStart=!0,this.network.fireInteractionEvent({kind:\"liveMovePointStart\",event:t,element:this.linkUI._element})):this.node&&(this.isStartRotate=!0,this._handle_mousedown(t)));else{var e=this.network.getElementAt(t),i=this.network.getLogicalPoint(t);if(e instanceof R.ShapeNode){(o=this.getPointIndex(e.getPoints(),i,!0))>0&&(this._handle_mousedown(t),this.pointIndex=o,this.shapeNode=e,e.addPoint(i,o),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:\"addPoint\",event:t,element:e,pointIndex:o}),this.network.fireInteractionEvent({kind:\"liveMovePointStart\",event:t,element:e,pointIndex:o}))}if(e instanceof R.ShapeLink){var n=new R.List(e.getPoints()),s=this.network.getElementUI(e);n.add(s.getFromPoint(),0),n.add(s.getToPoint());var o;(o=this.getPointIndex(n,i)-1)>0&&(this._handle_mousedown(t),this.pointIndex=o,this.shapeLink=e,e.addPoint(i,o),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:\"addPoint\",event:t,element:e,pointIndex:o}),this.network.fireInteractionEvent({kind:\"liveMovePointStart\",event:t,element:e,pointIndex:o}))}}},handle_mouseup:function(t){if(this.isStart){var e=this.network.getLogicalPoint(t);if(this.resizingRect)if(this.lazyMode)if(this.network.isResizeAnimate()){var i=this,n=new R.animate.AnimateBounds(this.node,this.resizingRect,function(){i.network.fireInteractionEvent({kind:\"lazyResizeEnd\",event:t,element:i.node,resizeDirection:i.resizeDirection}),i.clear()});R.animate.AnimateManager.start(n)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:\"lazyResizeEnd\",event:t,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:\"liveResizeEnd\",event:t,element:this.node,resizeDirection:this.resizeDirection});else this.shapeNode&&this.pointIndex>=0&&e?(this.shapeNode.setPoint(this.pointIndex,e),this.network.fireInteractionEvent({kind:\"liveMovePointEnd\",event:t,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0&&e?(this.shapeLink.setPoint(this.pointIndex,e),this.network.fireInteractionEvent({kind:\"liveMovePointEnd\",event:t,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI&&e&&(this.linkUI.setControlPoint(e),this.network.fireInteractionEvent({kind:\"liveMovePointEnd\",event:t,element:this.linkUI._element}))}this._handle_mouseup(t),this.clear()},handle_mousemove:function(t){if(this.network.isValidEvent(t)){if(this.isStartRotate&&this.node)return this._handleRotateElement(t,this.node),void(this.network.isShowRotateScale()&&this.repaint());if(this.isStart){if(this.shapeNode&&this.pointIndex>=0)return void this._handleMovingShapeNodePoint(t);if(this.shapeLink&&this.pointIndex>=0)return void this._handleMovingShapeLinkPoint(t);if(this.node&&this.resizeDirection)return void this._handleResizing(t);if(this.linkUI)return void this._handleMovingLinkControlPoint(t)}if(this.network.isSelectingElement()||this.network.isMovingElement()||0===this.network.getSelectionModel().size())this.clear();else{var e=this.network.getElementAt(t),i=this.network.getElementUI(e);if(i&&i.getEditAttachment()){var n=this.network.getLogicalPoint(t);if(e instanceof R.Node){if(this.node=e,this._isEditingShapeNode(n)||this._isResizingNode(n))return void this.network.setEditingElement(!0);if(this._isRotatingElement(n))return this.network.setRotatingElement(!0),void this.network.setEditingElement(!0)}else if(e instanceof R.ShapeLink){if(this.shapeLink=e,this._isEditingShapeLink(n))return void this.network.setEditingElement(!0)}else if(i instanceof R.canvas.LinkUI){var s=this.network.getEditPointSize();if(pt.isOrthogonalLink(i._element)){this.linkUI=i;var o=this.linkUI.getControlPoint();return void(o&&this._contains(n,o,s)&&(this._setCrossCursor(),this.network.setEditingElement(!0)))}}this.clear()}else this.clear()}}},_isRotatingElement:function(t){if(this.network.getRotatePointSize()<=0)return!1;var e=this.node.getOriginalRect(),i=this.node.getAngle();return this._isRotating(t,\"crosshair\",e,i)},_isRotating:function(t,e,i,n){var s=this.network.getRotatePointSize(),o={x:i.x+i.width/2,y:i.y-this.network.getRotatePointOffset()-s},r=this._rotatePoint(o,n,i),a={x:r.x-s,y:r.y-s,width:2*s,height:2*s};return!!W.containsPoint(a,t)&&(this._removeCursor(),this._setCursor(e),!0)},_handleRotateElement:function(t,e){this._handle_mousemove(t);var i=this._calculateAngle(this.network.getLogicalPoint(t),e);e.setAngle(i)},_calculateAngle:function(t,e){var i=e.getCenterLocation();return Math.round(180*Math.atan2(i.x-t.x,t.y-i.y)/Math.PI+180)},_handleMovingShapeNodePoint:function(t){var e=this.network.getLogicalPoint(t);this.shapeNode.setPoint(this.pointIndex,e),this.network.fireInteractionEvent({kind:\"liveMovePointBetween\",e:t,element:this.shapeNode,pointIndex:this.pointIndex})},_handleMovingShapeLinkPoint:function(t){var e=this.network.getLogicalPoint(t);this.shapeLink.setPoint(this.pointIndex,e),this.network.fireInteractionEvent({kind:\"liveMovePointBetween\",e:t,element:this.shapeLink,pointIndex:this.pointIndex})},_handleMovingLinkControlPoint:function(t){this.linkUI.setControlPoint(this.network.getLogicalPoint(t)),this.network.fireInteractionEvent({kind:\"liveMovePointBetween\",e:t,element:this.linkUI._element})},_handleResizing:function(t){this._handle_mousemove(t);var e=this.node.getAngle(),i=this.node.getLocation(),n=this.node.getWidth()/2,s=this.node.getHeight()/2,o={x:i.x+n,y:i.y+s},r={x:-n,y:-s},a={x:-n,y:s},h={x:n,y:s},l={x:n,y:-s},c={x:0,y:-s},d={x:n,y:0},u={x:0,y:s},_={x:-n,y:0};if(\"northwest\"===this.resizeDirection&&(this._transformPoint(h,o,e),r.x=this._endLogical.x,r.y=this._endLogical.y,o.x=(r.x+h.x)/2,o.y=(r.y+h.y)/2,this._reversPoint(r,o,e),this._reversPoint(h,o,e),this.resizingRect={x:r.x,y:r.y,width:h.x-r.x,height:h.y-r.y}),\"north\"===this.resizeDirection){var g={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(g,o,e),c.y=g.y-o.y,this._transformPoint(c,o,e),this._transformPoint(u,o,e),o.x=(c.x+u.x)/2,o.y=(c.y+u.y)/2,this._reversPoint(c,o,e),this._reversPoint(u,o,e),this.resizingRect={x:o.x-this.node.getWidth()/2,y:o.y-(u.y-c.y)/2,width:this.node.getWidth(),height:u.y-c.y}}if(\"northeast\"===this.resizeDirection&&(this._transformPoint(a,o,e),l.x=this._endLogical.x,l.y=this._endLogical.y,o.x=(a.x+l.x)/2,o.y=(a.y+l.y)/2,this._reversPoint(a,o,e),this._reversPoint(l,o,e),this.resizingRect={x:a.x,y:l.y,width:l.x-a.x,height:a.y-l.y}),\"west\"===this.resizeDirection){g={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(g,o,e),_.x=g.x-o.x,this._transformPoint(d,o,e),this._transformPoint(_,o,e),o.x=(d.x+_.x)/2,o.y=(d.y+_.y)/2,this._reversPoint(d,o,e),this._reversPoint(_,o,e),this.resizingRect={x:o.x-(d.x-_.x)/2,y:o.y-this.node.getHeight()/2,width:d.x-_.x,height:this.node.getHeight()}}if(\"east\"===this.resizeDirection){g={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(g,o,e),d.x=g.x-o.x,this._transformPoint(d,o,e),this._transformPoint(_,o,e),o.x=(d.x+_.x)/2,o.y=(d.y+_.y)/2,this._reversPoint(d,o,e),this._reversPoint(_,o,e),this.resizingRect={x:o.x-(d.x-_.x)/2,y:o.y-this.node.getHeight()/2,width:d.x-_.x,height:this.node.getHeight()}}if(\"southwest\"===this.resizeDirection&&(this._transformPoint(l,o,e),a.x=this._endLogical.x,a.y=this._endLogical.y,o.x=(a.x+l.x)/2,o.y=(a.y+l.y)/2,this._reversPoint(a,o,e),this._reversPoint(l,o,e),this.resizingRect={x:a.x,y:l.y,width:l.x-a.x,height:a.y-l.y}),\"south\"===this.resizeDirection){g={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(g,o,e),u.y=g.y-o.y,this._transformPoint(c,o,e),this._transformPoint(u,o,e),o.x=(c.x+u.x)/2,o.y=(c.y+u.y)/2,this._reversPoint(c,o,e),this._reversPoint(u,o,e),this.resizingRect={x:o.x-this.node.getWidth()/2,y:o.y-(u.y-c.y)/2,width:this.node.getWidth(),height:u.y-c.y}}\"southeast\"===this.resizeDirection&&(this._transformPoint(r,o,e),h.x=this._endLogical.x,h.y=this._endLogical.y,o.x=(r.x+h.x)/2,o.y=(r.y+h.y)/2,this._reversPoint(r,o,e),this._reversPoint(h,o,e),this.resizingRect={x:r.x,y:r.y,width:h.x-r.x,height:h.y-r.y}),this.lazyMode?(this.repaint(),this.network.fireInteractionEvent({kind:\"lazyResizeBetween\",event:t,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:\"liveResizeBetween\",event:t,element:this.node,resizeDirection:this.resizeDirection}))},_isEditingShapeNode:function(t){var e=this.network.getEditPointSize();if(this.node instanceof R.ShapeNode){this.shapeNode=this.node;for(var i=this.shapeNode.getPoints(),n=0,s=i.size();n<s;n++){var o=i.get(n);if(this._contains(t,o,e))return this._setCrossCursor(),this.pointIndex=n,!0}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(t){for(var e=this.network.getEditPointSize(),i=this.shapeLink.getPoints(),n=0,s=i.size();n<s;n++){var o=i.get(n);if(this._contains(t,o,e))return this._setCrossCursor(),this.pointIndex=n,!0}return this.pointIndex=-1,!1},_isResizingNode:function(t){if(this.network.getResizePointSize()<=0)return!1;var e=this.node.getOriginalRect(),i=this.node.getAngle(),n={x:e.x,y:e.y},s=this._rotatePoint(n,i,e);return!!this._isResizing(t,s.x,s.y,\"northwest\",\"nwse-resize\")||(n={x:e.x+e.width/2,y:e.y},s=this._rotatePoint(n,i,e),!!this._isResizing(t,s.x,s.y,\"north\",\"ns-resize\")||(n={x:e.x+e.width,y:e.y},s=this._rotatePoint(n,i,e),!!this._isResizing(t,s.x,s.y,\"northeast\",\"nesw-resize\")||(n={x:e.x,y:e.y+e.height/2},s=this._rotatePoint(n,i,e),!!this._isResizing(t,s.x,s.y,\"west\",\"ew-resize\")||(n={x:e.x+e.width,y:e.y+e.height/2},s=this._rotatePoint(n,i,e),!!this._isResizing(t,s.x,s.y,\"east\",\"ew-resize\")||(n={x:e.x,y:e.y+e.height},s=this._rotatePoint(n,i,e),!!this._isResizing(t,s.x,s.y,\"southwest\",\"nesw-resize\")||(n={x:e.x+e.width/2,y:e.y+e.height},s=this._rotatePoint(n,i,e),!!this._isResizing(t,s.x,s.y,\"south\",\"ns-resize\")||(n={x:e.x+e.width,y:e.y+e.height},s=this._rotatePoint(n,i,e),!!this._isResizing(t,s.x,s.y,\"southeast\",\"nwse-resize\"))))))))},_rotatePoint:function(t,e,i){return W.createMatrix(e*Math.PI/180,i.x+i.width/2,i.y+i.height/2).transform(t)},_isResizing:function(t,e,i,n,s){var o=this.network.getResizePointSize();return!!this._contains(t,{x:e,y:i},o)&&(this.resizeDirection!==n&&(this._removeCursor(),s=this._changeCursorWithAngle(n,this.node.getAngle()),this._setCursor(s),this.resizeDirection=n),!0)},_getRect:function(t,e,i,n){return{x:t<i?t:i,y:e<n?e:n,width:Math.abs(t-i),height:Math.abs(e-n)}},_contains:function(t,e,i){var n={x:e.x-i,y:e.y-i,width:2*i,height:2*i};return W.containsPoint(n,t)},getPointIndex:function(t,e,i){if(t.size()<2)return 0;for(var n,s=t.get(0),o=1;o<t.size();o++){if(n=t.get(o),this.isPointOnLine(e,s,n,6))return o;s=n}return s=t.get(0),i&&this.isPointOnLine(e,s,n,6)?t.size():0},showRotateScale:function(t){new R.List;var e,i,n,s,o=this.network.getRotateScaleWidth(),r=this.network.getRotateScaleHeight(),a=this.network.getRotatePointSize(),h=this.node.getAngle(),l=this.node.getOriginalRect(),c={x:l.x+l.width/2,y:l.y-this.network.getRotatePointOffset()-a},d=this._rotatePoint(c,h,l),u=h+\"\";this.node.getAngle()>=0&&this.node.getAngle()<=180?(n={x:(i={x:(e={x:d.x+a,y:d.y}).x+o,y:e.y}).x,y:i.y-r},s={x:e.x,y:n.y}):this.node.getAngle()>180&&this.node.getAngle()<=360&&(n={x:(i={x:(e={x:d.x-a,y:d.y}).x-o,y:e.y}).x,y:i.y-r},s={x:e.x,y:n.y});var _=new R.List([e,i,n,s]),g=D.math.getRect(_);t.fillStyle=this.network.getRotateScaleFillColor(),t.fillRect(g.x,g.y,g.width,g.height),t.fillStyle=this.network.getRotateScaleFontColor(),t.textBaseline=\"middle\",t.textAlign=\"center\",t.font=\"13px Arial\",t.fillText(u,g.x+g.width/2,g.y+g.height/2)},isPointOnLine:function(t,e,i,n){n<0&&(n=0);return this.getDistanceFromPointToLine(t,e,i)<=n&&t.x>=Math.min(e.x,i.x)-n&&t.x<=Math.max(e.x,i.x)+n&&t.y>=Math.min(e.y,i.y)-n&&t.y<=Math.max(e.y,i.y)+n},getDistanceFromPointToLine:function(t,e,i){if(e.x===i.x)return Math.abs(t.x-e.x);var n=(i.y-e.y)/(i.x-e.x),s=(i.x*e.y-e.x*i.y)/(i.x-e.x);return Math.abs(n*t.x-t.y+s)/Math.sqrt(n*n+1)},_transformPoint:function(t,e,i){var n=Math.cos(i*Math.PI/180),s=Math.sin(i*Math.PI/180),o=t.x,r=t.y,a=o*n-r*s,h=o*s+r*n;t.x=a+e.x,t.y=h+e.y},_reversPoint:function(t,e,i){i*=-1;var n=Math.cos(i*Math.PI/180),s=Math.sin(i*Math.PI/180),o=t.x-e.x,r=t.y-e.y,a=o*n-r*s,h=o*s+r*n;t.x=a+e.x,t.y=h+e.y},_changeCursorWithAngle:function(t,e){var i;switch(t){case\"northwest\":i=1;break;case\"north\":i=2;break;case\"northeast\":i=3;break;case\"east\":i=4;break;case\"southeast\":i=5;break;case\"south\":i=6;break;case\"southwest\":i=7;break;case\"west\":i=8;break;default:i=0}return(e>=360||e<=-360)&&(e%=360),e>22.5&&e<=67.5&&(i+=1),e<-22.5&&e>=-67.5&&(i-=1),e>67.5&&e<=112.5&&(i+=2),e<-67.5&&e>=-112.5&&(i-=2),e>112.5&&e<=157.5&&(i+=3),e<-112.5&&e>=-157.5&&(i-=3),e>157.5&&e<=202.5&&(i+=4),e<-157.5&&e>=-202.5&&(i-=4),e>202.5&&e<=247.5&&(i+=5),e<-202.5&&e>=-247.5&&(i-=5),e>247.5&&e<=292.5&&(i+=6),e<-247.5&&e>=-292.5&&(i-=6),e>292.5&&e<=337.5&&(i+=7),e<-292.5&&e>=-337.5&&(i-=7),i>8&&(i-=8),i<=0&&(i+=8),[\"auto\",\"nwse-resize\",\"ns-resize\",\"nesw-resize\",\"ew-resize\",\"nwse-resize\",\"ns-resize\",\"nesw-resize\",\"ew-resize\"][i]}}),R.canvas.interaction.CreateLinkInteraction=function(t,e){e||(e=R.Link),R.Util.isTypeOf(e,R.Link)?this.linkFunction=function(t,i){var n=new e;return n instanceof R.Link&&(n.setFromNode(t),n.setToNode(i)),n}:this.linkFunction=e,R.canvas.interaction.CreateLinkInteraction.superClass.constructor.call(this,t)},D.ext(\"twaver.canvas.interaction.CreateLinkInteraction\",R.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener(\"mousedown\",\"mousemove\"),this.network.addMarker(this)},tearDown:function(){this.removeListener(\"mousedown\",\"mousemove\"),this.clear(),this.network.removeMarker(this)},paint:function(t){t.beginPath();var e,i;t.lineWidth=this.network.getEditLineWidth();var n=this.network.getEditLineColor();this.currentNode&&this.currentNode!==this.fromNode&&(e=this.network.getElementUI(this.currentNode).getViewRect(),i=this.convertFromUIToMarkerRect(e,0,0),Me.rect(t,i.x,i.y,i.width,i.height,null,n)),this.fromNode&&(e=this.network.getElementUI(this.fromNode).getViewRect(),i=this.convertFromUIToMarkerRect(e,0,0),Me.rect(t,i.x,i.y,i.width,i.height,null,n)),this.currentPoint&&this.paintLine(t),t.closePath()},paintLine:function(t){var e=this.network.getEditLineColor(),i=this.convertPointFromView(this.fromNode.getCenterLocation()),n=i.x,s=i.y,o=this.currentPoint.x,r=this.currentPoint.y;t.strokeStyle=e,t.beginPath(),t.moveTo(n,s),t.lineTo(o,r),t.stroke()},clear:function(){this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(t){if(this.network.isValidEvent(t))if(this.fromNode){if(this.toNode=this.currentNode,this.toNode){var e=this.createLink();e&&this.network.addElementByInteraction(e)}this.clear()}else this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.repaint()},handle_mousemove:function(t){var e=this.getMarkerPoint(t);if(e)if(this.network.isMovingElement()||this.network.isEditingElement())this.clear();else{var i=null;this.fromNode?(this.currentNode=this.getToNode(t),this.currentPoint=e,this.repaint()):(i=this.getFromNode(t),this.currentNode!==i&&(this.currentNode=i,this.repaint()))}},getFromNode:function(t){return this.getNode(t)},getToNode:function(t){return this.getNode(t)},getNode:function(t){var e=this.network.getElementAt(t);return e instanceof Pe&&this.network.isLinkable(e)&&this.network.getElementBox().getSelectionModel().isSelectable(e)?e:null}}),R.canvas.interaction.CreateShapeLinkInteraction=function(t,e){R.canvas.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,t),e||(e=R.ShapeLink),R.Util.isTypeOf(e,R.ShapeLink)?this.linkFunction=function(t,i,n){var s=new e;return s instanceof R.ShapeLink&&(s.setFromNode(t),s.setToNode(i),n&&s.setPoints(n)),s}:this.linkFunction=e},D.ext(\"twaver.canvas.interaction.CreateShapeLinkInteraction\",R.canvas.interaction.CreateLinkInteraction,{clear:function(){this.points=null,R.canvas.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(t){if(0===t.button){var e=this.network.getLogicalPoint(t);if(e){if(this.fromNode)if(this.toNode=this.currentNode,this.toNode){var i=this.createLink();i&&this.network.addElementByInteraction(i),this.clear()}else{if(this.points||(this.points=new R.List),this.points.size()>0){var n=this.points.get(this.points.size()-1);if(n.x===e.x&&n.y===e.y)return}this.points.add(e)}else this.fromNode=this.currentNode,this.points=null,this.currentNode=null,this.currentPoint=null;this.repaint()}}},paintLine:function(t){if(this.currentPoint){var e,i=new R.List;if(e=this.convertPointFromView(this.fromNode.getCenterLocation()),i.add(e,0),this.points&&this.points.size()>0)for(var n=this.points.size(),s=0;s<n;s++)e=this.convertPointFromView(this.points.get(s)),i.add(e);e=this.currentPoint,i.add(e),t.lineWidth=this.network.getEditLineWidth(),t.strokeStyle=this.network.getEditLineColor(),t.beginPath(),Y.drawLinePoints(t,i),t.stroke()}}}),R.canvas.interaction.CreateShapeNodeInteraction=function(t,e){e||(e=R.ShapeNode),R.Util.isTypeOf(e,R.ShapeNode)?this.shapeNodeFunction=function(t){var i=new e;return i instanceof R.ShapeNode&&t&&i.setPoints(t),i}:this.shapeNodeFunction=e,R.canvas.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,t),this.timeStamp=-1},D.ext(\"twaver.canvas.interaction.CreateShapeNodeInteraction\",R.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener(\"mousedown\",\"mousemove\"),this.network.addMarker(this)},tearDown:function(){this.removeListener(\"mousedown\",\"mousemove\"),this.clear(),this.network.removeMarker(this),this.network.setEditingElement(!1)},clear:function(){this.points=null,this.currentPoint=null},paint:function(t){if(this.points&&this.points.size()>0&&this.currentPoint){for(var e,i=new R.List,n=this.points.size(),s=0;s<n;s++)e=this.convertPointFromView(this.points.get(s)),i.add(e);e=this.convertPointFromView(this.currentPoint),i.add(e),t.lineWidth=this.network.getEditLineWidth(),t.strokeStyle=this.network.getEditLineColor(),t.beginPath(),Y.drawLinePoints(t,i),t.stroke()}},handle_mousedown:function(t){if(0===t.button){var e=this.network.getLogicalPoint(t);if(e){if(2===t.detail||t.timeStamp-this.timeStamp<300){if(this.points){var i=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(i),this.clear();var n=this;setTimeout(function(){n.network.setEditingElement(!1)},0)}}else{if(this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new R.List),this.points.size()>0){var s=this.points.get(this.points.size()-1);if(s.x===e.x&&s.y===e.y)return}this.points.add(e)}this.timeStamp=t.timeStamp,this.repaint()}}},handle_mousemove:function(t){this.points&&(this.currentPoint=this.network.getLogicalPoint(t),this.repaint())}}),R.canvas.interaction.MagnifyInteraction=function(t,e,i,n,s){R.canvas.interaction.MagnifyInteraction.superClass.constructor.call(this,t),this.zoom=e||2,this.xRadius=i||100,this.yRadius=n||100,this.shape=s||\"circle\",this.borderColor=\"black\",this.borderWidth=1,this.backgroundColor=\"white\",this.markCanvas=X.createCanvas()},D.ext(\"twaver.canvas.interaction.MagnifyInteraction\",R.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener(\"mousemove\"),this.network.addMarker(this)},tearDown:function(){this.removeListener(\"mousemove\"),this.network.removeMarker(this)},paint:function(t){if(this.point){var e=this.network._zoom,i=this.zoom*e,n=this.point.x*e-this.network.viewRect.x-this.xRadius,s=this.point.y*e-this.network.viewRect.y-this.yRadius,o=2*this.xRadius,r=2*this.yRadius,a={x:this.point.x-this.xRadius/i,y:this.point.y-this.yRadius/i,width:o/i,height:r/i},h=this.borderWidth,l=X.createCanvas();l.width=o,l.height=r,this.network.toCanvasByRegion(a,i,l),t.save(),t.beginPath(),Y.drawVector(t,this.shape,null,n,s,o,r),t.clip(),t.fillStyle=this.backgroundColor,t.beginPath(),t.rect(n,s,o,r),t.fill(),t.drawImage(l,n,s),t.restore(),t.beginPath(),t.lineWidth=h,Y.drawVector(t,this.shape,null,n+h/2,s+h/2,o-h,r-h),t.strokeStyle=this.borderColor,t.stroke()}},handle_mousemove:function(t){this.point=this.network.getLogicalPoint(t),this.point&&this.repaint()},getZoom:function(){return this.zoom},setZoom:function(t){this.zoom=t,this.network.repaintTopCanvas()},getShape:function(){return this.shape},setShape:function(t){this.shape=t,this.network.repaintTopCanvas()},getXRadius:function(){return this.xRadius},setXRadius:function(t){this.xRadius=t,this.network.repaintTopCanvas()},getYRadius:function(){return this.yRadius},setYRadius:function(t){this.yRadius=t,this.network.repaintTopCanvas()},getBorderColor:function(){return this.borderColor},setBorderColor:function(t){this.borderColor=t,this.network.repaintTopCanvas()},getBorderWidth:function(){return this.borderWidth},setBorderWidth:function(t){this.borderWidth=t,this.network.repaintTopCanvas()},getBackgroundColor:function(){return this.backgroundColor},setBackgroundColor:function(t){this.backgroundColor=t,this.network.repaintTopCanvas()}}),R.canvas.interaction.TouchInteraction=function(t){R.canvas.interaction.TouchInteraction.superClass.constructor.call(this,t)},D.ext(\"twaver.canvas.interaction.TouchInteraction\",R.canvas.interaction.BaseInteraction,{setUp:function(){var t=this.network.getView();X.addEventListener(\"touchstart\",\"handleTouchstart\",t,this),X.addEventListener(\"touchmove\",\"handleTouchmove\",t,this),X.addEventListener(\"touchend\",\"handleTouchend\",t,this),X.addEventListener(\"touchcancel\",\"handleTouchend\",t,this),this.network.addMarker(this)},tearDown:function(){var t=this.network.getView();X.removeEventListener(\"touchstart\",this.network.getView(),this),X.removeEventListener(\"touchmove\",t,this),X.removeEventListener(\"touchend\",t,this),X.removeEventListener(\"touchcancel\",t,this),this.network.removeMarker(this)},handleTouchstart:function(t){if(X.preventDefault(t),t.touches&&1==t.touches.length){var e=this.network.getLogicalPoint(t),i=this.network.getElementAt(e);this._startTouchTime=new Date,this._startTouchPoint=e,this._startTouchClient=this.getMarkerPoint(t),i?(this._haveElementUnderTouch=!0,this._startTouchElement=i):(this._haveElementUnderTouch=!1,this._startTouchElement=null),this.timer=setTimeout(function(){Ct.handleLongClicked(self.network,t,i)},1e3)}else t.touches&&2==t.touches.length&&(this._distance=yt.getDistance(t),this._zoom=this.network.getZoom());this._touchCount=t.touches.length},handleTouchmove:function(t){if(X.preventDefault(t),2==this._touchCount&&t.touches&&2==t.touches.length)if(this.timer&&clearTimeout(this.timer),Math.abs(this._distance-yt.getDistance(t))>=xe.TOUCH_ZOOM_THRESHOLD||this._zoomFlag){this._zoomFlag=!0;var e=yt.getDistance(t)/this._distance;this.network.setTouchZoom(this._zoom*e,!1)}else{var i=this.getMarkerPoint(t),n=this._startTouchClient.x-i.x,s=this._startTouchClient.y-i.y;this.network.panByOffset(n,s),this._startTouchClient=i}else if(1==this._touchCount&&t.touches&&1==t.touches.length)if(this._haveElementUnderTouch||!this.network.isRectSelectEnabled()){var o=this.network.getLogicalPoint(t),r=this.network.getElementAt(o);if(this.network.isMovingElement()||null!=this._startTouchElement&&this._startTouchElement==r&&this.network.getMovableSelectedElements().contains(r)){n=o.x-this._startTouchPoint.x,s=o.y-this._startTouchPoint.y;(Math.abs(n)>=xe.TOUCH_MOVE_THRESHOLD||Math.abs(s)>=xe.TOUCH_MOVE_THRESHOLD)&&(this._startTouchPoint=o,this.network.moveSelectedElements(n,s),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:\"liveMoveBetween\",event:t}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:\"liveMoveStart\",event:t}),this.timer&&clearTimeout(this.timer)))}else{n=o.x-this._startTouchPoint.x,s=o.y-this._startTouchPoint.y;(Math.abs(n)>=xe.TOUCH_MOVE_THRESHOLD||Math.abs(s)>=xe.TOUCH_MOVE_THRESHOLD)&&this.timer&&clearTimeout(this.timer);i=this.getMarkerPoint(t),n=this._startTouchClient.x-i.x,s=this._startTouchClient.y-i.y;this.network.panByOffset(n,s),this._startTouchClient=i}}else{var a=this.network.getLogicalPoint(t);if(!a)return;n=a.x-this._startTouchPoint.x,s=a.y-this._startTouchPoint.y;Math.abs(n)>=xe.TOUCH_RECT_SELECT_THRESHOLD&&Math.abs(s)>=xe.TOUCH_RECT_SELECT_THRESHOLD&&(this.network.setSelectingElement(!0),this._moveTouchPoint?this.network.fireInteractionEvent({kind:\"selectBetween\",event:t}):(this.network.fireInteractionEvent({kind:\"selectStart\",event:t}),this.timer&&clearTimeout(this.timer)),this._moveTouchPoint=a,this.repaint())}},handleTouchend:function(t){if(X.preventDefault(t),this.network.isMovingElement())this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:\"liveMoveEnd\",event:t});else if(this.network.isSelectingElement()){var e=W.getRect([this._startTouchPoint,this._moveTouchPoint]),i=this.network.getElementsAtRect(e,this.getIntersectMode(),this.network.getRectSelectFilter());if(i&&i.size()>0){var n=this.network.getSelectionModel(),s=n.toSelection();i.forEach(function(t){n.contains(t)?s.remove(t):s.add(t)},this),n.setSelection(s)}this.network.fireInteractionEvent({kind:\"selectEnd\",event:t}),this._moveTouchPoint=null,this.network.setSelectingElement(!1),this.repaint()}else if(this._startTouchPoint){this._zoomFlag=!1;var o=new Date,r=this.network.getLogicalPoint(t),a=this.network.getElementAt(this._startTouchPoint);r&&o.getTime()-this._startTouchTime.getTime()<=500&&W.getDistance(this._startTouchPoint,r)<=20&&(a?this.network.getSelectionModel().contains(a)||this.network.getSelectionModel().setSelection(a):this.network.getSelectionModel().clearSelection(),Ct.handleClicked(this.network,t,a),this.timer&&clearTimeout(this.timer),this._endTouchTime&&o.getTime()-this._endTouchTime.getTime()<=500&&W.getDistance(this._endTouchPoint,r)<=20?(delete this._endTouchTime,delete this._endTouchPoint,Ct.handleDoubleClicked(this.network,t,a)):(this._endTouchTime=o,this._endTouchPoint=r))}},paint:function(t){if(this._startTouchPoint&&this._moveTouchPoint){var e=this.convertPointFromView(this._startTouchPoint),i=this.convertPointFromView(this._moveTouchPoint),n=e.x,s=e.y,o=i.x,r=i.y,a=W.getRect([{x:n,y:s},{x:o,y:r}]);if(null!=a){t.beginPath();var h=this.network.getSelectOutlineWidth(),l=this.getIntersectMode()?this.network.getSelectFillColor():null;t.strokeStyle=this.network.getSelectOutlineColor(),t.lineWidth=h,Me.rect(t,a.x,a.y,a.width,a.height,l,this.network.getSelectOutlineColor()),t.closePath()}}},getIntersectMode:function(){return\"intersect\"===this.network.getSelectMode()||\"contain\"!==this.network.getSelectMode()&&(this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y)}}),R.canvas.interaction.MSTouchInteraction=function(t){R.canvas.interaction.MSTouchInteraction.superClass.constructor.call(this,t),this._pointerMap={},this._pointerIdArray=[]},D.ext(\"twaver.canvas.interaction.MSTouchInteraction\",R.canvas.interaction.BaseInteraction,{setUp:function(){var t=this.network.getView();X.addEventListener(\"MSPointerDown\",\"handleTouchstart\",t,this),X.addEventListener(\"MSPointerMove\",\"handleTouchmove\",t,this),X.addEventListener(\"MSPointerUp\",\"handleTouchend\",t,this),X.addEventListener(\"MSPointerCancel\",\"handleTouchend\",t,this),this.network.addMarker(this)},tearDown:function(){var t=this.network.getView();X.removeEventListener(\"MSPointerDown\",t,this),X.removeEventListener(\"MSPointerMove\",t,this),X.removeEventListener(\"MSPointerUp\",t,this),X.removeEventListener(\"MSPointerCancel\",t,this),this.network.removeMarker(this)},handleTouchstart:function(t){if(this.network.isFocusOnClick()&&R.Util.setFocus(this.network._view),!this.network.isSelectingElement()||t.pointerType!=t.MSPOINTER_TYPE_MOUSE){var e=this.network.getLogicalPoint(t),i=new Date;if(t.isPrimary&&this._pointerIdArray.length>0&&this.handle_mouseup(t),this._pointerMap[t.pointerId]||(this._pointerIdArray.push(t.pointerId),this._pointerMap[t.pointerId]=t),1==this._pointerIdArray.length){var n=this.network.getElementAt(e);this._startTouchElement=n,this._startClientPoint={x:t.clientX,y:t.clientY},Ct.handleClicked(this.network,t,n),this._startTouchTime&&this._startTouchPoint&&i.getTime()-this._startTouchTime.getTime()<=500&&W.getDistance(this._startTouchPoint,e)<=20?(Ct.handleDoubleClicked(this.network,t,n),this._doubleClick=!0):(X.handle_mousedown(this,t),this._startTouchPoint=e,this._startTouchTime=i);var s=this.network.getSelectionModel();n?D.isCtrlDown(t)?s.contains(n)?s.removeSelection(n):s.appendSelection(n):s.contains(n)||s.setSelection(n):D.isCtrlDown(t)||s.clearSelection()}else 2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())}},handleTouchmove:function(t){if(null!=this._startTouchPoint&&0!=this._pointerIdArray.length&&this._pointerMap[t.pointerId]&&!(W.getDistance({x:this._pointerMap[t.pointerId].pageX,y:this._pointerMap[t.pointerId].pageY},{x:t.pageX,y:t.pageY})<=10)&&(this._pointerMap[t.pointerId]=t,2==this._pointerIdArray.length)){var e=this._getDistance()/this._distance;this.network.setZoom(this._zoom*e,!1)}},handleTouchend:function(t){if(this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:\"liveMoveEnd\",event:t})),this.network.isSelectingElement()){var e=W.getRect([this._startTouchPoint,this._moveTouchPoint]),i=this.network.getElementsAtRect(e,this.getIntersectMode(),this.network.getRectSelectFilter());if(i&&i.size()>0){var n=this.network.getSelectionModel(),s=n.toSelection();i.forEach(function(t){n.contains(t)?s.remove(t):s.add(t)},this),n.setSelection(s)}this.network.fireInteractionEvent({kind:\"selectEnd\",event:t}),this._moveTouchPoint=null,this.network.setSelectingElement(!1),this.repaint()}this._doubleClick&&(delete this._doubleClick,delete this._startTouchPoint,delete this._startTouchTime);for(var o=-1,r=0;r<this._pointerIdArray.length;r++)if(this._pointerIdArray[r]==t.pointerId){o=r;break}o>=0&&this._pointerIdArray.splice(o,1),delete this._pointerMap[t.pointerId],this._startTouchPoint=null,this._moveTouchPoint=null},_getDistance:function(){return W.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})},getIntersectMode:function(){return\"intersect\"===this.network.getSelectMode()||\"contain\"!==this.network.getSelectMode()&&(this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y)},handle_mousemove:function(t){var e={x:t.clientX,y:t.clientY};if(!(W.getDistance(this._startClientPoint,e)<3)&&this._startTouchPoint&&1==this._pointerIdArray.length)if(this._moveTouchPoint={x:this._startTouchPoint.x+(e.x-this._startClientPoint.x)/this.network.getZoom(),y:this._startTouchPoint.y+(e.y-this._startClientPoint.y)/this.network.getZoom()},null==this._startTouchElement&&this.network.isRectSelectEnabled()){if(!this.network.getLogicalPoint(t))return;this.network.setSelectingElement(!0),this._moveTouchPoint?this.network.fireInteractionEvent({kind:\"selectBetween\",event:t}):this.network.fireInteractionEvent({kind:\"selectStart\",event:t}),this.repaint()}else{var i=this.network.getElementAt(this._moveTouchPoint);if(null!=this._startTouchElement||this.network.isRectSelectEnabled()){if(this.network.isMovingElement()||null!=this._startTouchElement&&i==this._startTouchElement&&this.network.getMovableSelectedElements().contains(i)){n=this._moveTouchPoint.x-this._startTouchPoint.x,s=this._moveTouchPoint.y-this._startTouchPoint.y;this.network.moveSelectedElements(n,s),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:\"liveMoveBetween\",event:t}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:\"liveMoveStart\",event:t}))}}else{var n=this._startClientPoint.x-e.x,s=this._startClientPoint.y-e.y;this.network.panByOffset(n,s)}this._startClientPoint=e}},handle_mouseup:function(t){this.handleTouchend(t),this._pointerIdArray=[],this._pointerMap={}},paint:function(t){if(this._startTouchPoint&&this._moveTouchPoint&&!this._startTouchElement&&this.network.isRectSelectEnabled()){var e=this.convertPointFromView(this._startTouchPoint),i=this.convertPointFromView(this._moveTouchPoint),n=e.x,s=e.y,o=i.x,r=i.y,a=W.getRect([{x:n,y:s},{x:o,y:r}]);if(null!=a){t.beginPath();var h=this.network.getSelectOutlineWidth(),l=this.getIntersectMode()?this.network.getSelectFillColor():null;t.strokeStyle=this.network.getSelectOutlineColor(),t.lineWidth=h,Me.rect(t,a.x,a.y,a.width,a.height,l,this.network.getSelectOutlineColor()),t.closePath()}}}});var Oe=function(t,e){D.registerImage(t,e),Be[t]=1},Be={};Oe(\"node_image\",{w:32,h:24,origin:{x:0,y:0},v:[{shape:\"path\",data:\"M32,23.5c0,0.276-0.224,0.5-0.5,0.5h-31C0.224,24,0,23.776,0,23.5v-2C0,21.224,0.224,21,0.5,21h31  c0.276,0,0.5,0.224,0.5,0.5V23.5z\",gradient:{id:\"SVGID_1_\",type:\"linear\",x1:\"15.9995\",y1:\"21\",x2:\"15.9995\",y2:\"24\",stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"path\",data:\"M15,22.3c0-0.165-0.134-0.3-0.3-0.3H3.3C3.134,22,3,22.135,3,22.3V24h12V22.3z\",gradient:{id:\"SVGID_2_\",type:\"linear\",x1:\"9\",y1:\"22\",x2:\"9\",y2:\"25\",stop:[{offset:\"0\",color:\"#69B4A5\"},{offset:\"0.1\",color:\"#61AD9C\"}]}},{shape:\"path\",data:\"M31,20H1V1c0-0.553,0.448-1,1-1h28c0.553,0,1,0.447,1,1V20z\",gradient:{id:\"SVGID_3_\",type:\"linear\",x1:\"15.9995\",y1:\"-0.1221\",x2:\"15.9995\",y2:\"19.9471\",stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"rect\",x:2,y:1,w:28,h:18,fill:\"#FFFFFF\"},{shape:\"rect\",x:3,y:2,w:26,h:16,gradient:{id:\"SVGID_4_\",type:\"linear\",x1:\"15.9995\",y1:\"2.0654\",x2:\"15.9995\",y2:\"17.3835\",stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#0089C1\"}]}},{shape:\"path\",data:\"9.649,17.034 6.815,17.034 9.935,2.966 12.768,2.966 z\",fill:\"#FFFFFF\"},{shape:\"path\",data:\"12.065,17.034 10.815,17.034 13.935,2.966 15.185,2.966 z\",fill:\"#FFFFFF\"},{shape:\"path\",data:\"14.065,17.034 13.315,17.034 16.435,2.966 17.185,2.966 z\",fill:\"#FFFFFF\"}]}),Oe(\"group_image\",{w:32,h:24,origin:{x:0,y:0},v:[{shape:\"path\",data:\"M32,16.5c0,0.276-0.224,0.5-0.5,0.5h-24C7.224,17,7,16.776,7,16.5v-1C7,15.224,7.224,15,7.5,15h24   c0.276,0,0.5,0.224,0.5,0.5V16.5z\",gradient:{id:\"SVGID_1_\",type:\"linear\",x1:\"19.5\",y1:\"15\",x2:\"19.5\",y2:\"17\",stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"path\",data:\"M19,16.5c0-0.277-0.224-0.5-0.5-0.5h-8c-0.276,0-0.5,0.223-0.5,0.5V17h9V16.5z\",gradient:{id:\"SVGID_2_\",type:\"linear\",x1:\"14.4995\",y1:\"15.9209\",x2:\"14.4995\",y2:\"17.0459\",stop:[{offset:\"0\",color:\"#58AC9A\"},{offset:\"1\",color:\"#248576\"}]}},{shape:\"path\",data:\"M31,14H8V1c0-0.553,0.448-1,1-1h21c0.553,0,1,0.447,1,1V14z\",gradient:{id:\"SVGID_3_\",type:\"linear\",x1:\"19.5\",y1:\"0\",x2:\"19.5\",y2:\"14.0005\",stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"rect\",x:9,y:1,w:21,h:12,fill:\"#FFFFFF\"},{shape:\"rect\",x:10,y:2,w:19,h:10,gradient:{id:\"SVGID_4_\",type:\"linear\",x1:\"19.5\",y1:\"1.9619\",x2:\"19.5\",y2:\"11.9744\",stop:[{offset:\"0\",color:\"#58AC9A\"},{offset:\"1\",color:\"#248576\"}]}},{shape:\"path\",data:\"M25,23.5c0,0.276-0.224,0.5-0.5,0.5h-24C0.224,24,0,23.776,0,23.5v-1C0,22.224,0.224,22,0.5,22h24   c0.276,0,0.5,0.224,0.5,0.5V23.5z\",gradient:{id:\"SVGID_5_\",type:\"linear\",x1:\"12.4995\",y1:\"22\",x2:\"12.4995\",y2:\"24\",stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"path\",data:\"M12,23.5c0-0.277-0.224-0.5-0.5-0.5h-8C3.224,23,3,23.223,3,23.5V24h9V23.5z\",gradient:{id:\"SVGID_6_\",type:\"linear\",x1:\"7.5\",y1:\"22.9209\",x2:\"7.5\",y2:\"24.0459\",stop:[{offset:\"0\",color:\"#58AC9A\"},{offset:\"1\",color:\"#248576\"}]}},{shape:\"path\",data:\"M24,21H1V8c0-0.553,0.448-1,1-1h21c0.553,0,1,0.447,1,1V21z\",gradient:{id:\"SVGID_7_\",type:\"linear\",x1:\"12.4995\",y1:\"7\",x2:\"12.4995\",y2:\"21.0005\",stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"rect\",x:2,y:8,w:21,h:12,fill:\"#FFFFFF\"},{shape:\"rect\",x:3,y:9,w:19,h:10,gradient:{id:\"SVGID_8_\",type:\"linear\",x1:\"12.4995\",y1:\"8.9619\",x2:\"12.4995\",y2:\"18.9749\",stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#0089C1\"}]}}]}),Oe(\"subnetwork_image\",{w:32,h:24,origin:{x:0,y:0},v:[{shape:\"path\",data:\"M32,14.499c0,0.276-0.224,0.5-0.5,0.5h-20c-0.276,0-0.5-0.224-0.5-0.5v-1c0-0.276,0.224-0.5,0.5-0.5  h20c0.276,0,0.5,0.224,0.5,0.5V14.499z\",gradient:{id:\"SVGID_1_\",type:\"linear\",x1:21.5,y1:12.999,x2:21.5,y2:14.9995,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"path\",data:\"M22,14.499c0-0.277-0.224-0.5-0.5-0.5h-7c-0.276,0-0.5,0.223-0.5,0.5v0.5h8V14.499z\",gradient:{id:\"SVGID_2_\",type:\"linear\",x1:18,y1:13.9199,x2:18,y2:15.0449,stop:[{offset:\"0\",color:\"#58AC9A\"},{offset:\"1\",color:\"#248576\"}]}},{shape:\"path\",data:\"M31,11.499c0,0.276-0.224,0.5-0.5,0.5h-18c-0.276,0-0.5-0.224-0.5-0.5v-11c0-0.276,0.224-0.5,0.5-0.5  h18c0.276,0,0.5,0.224,0.5,0.5V11.499z\",gradient:{id:\"SVGID_3_\",type:\"linear\",x1:21.5,y1:-.9502,x2:21.5,y2:12.5498,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"rect\",x:13,y:.999,w:17,h:10,fill:\"#FFFFFF\"},{shape:\"rect\",x:14,y:1.999,w:15,h:8,gradient:{id:\"SVGID_4_\",type:\"linear\",x1:21.5,y1:1.9312,x2:21.5,y2:9.6537,stop:[{offset:\"0\",color:\"#58AC9A\"},{offset:\"1\",color:\"#248576\"}]}},{shape:\"path\",data:\"M21,23.5c0,0.276-0.224,0.5-0.5,0.5h-20C0.224,24,0,23.776,0,23.5v-1C0,22.224,0.224,22,0.5,22h20  c0.276,0,0.5,0.224,0.5,0.5V23.5z\",gradient:{id:\"SVGID_5_\",type:\"linear\",x1:10.4995,y1:22,x2:10.4995,y2:24,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"rect\",x:22,y:20.5,w:3,h:1.999,gradient:{id:\"SVGID_6_\",type:\"linear\",x1:-464.9424,y1:-722.2754,x2:-462.9424,y2:-722.2754,stop:[{offset:\"0\",color:\"#58AC9A\"},{offset:\"1\",color:\"#248576\"}]}},{shape:\"rect\",x:28,y:16,w:2,h:3,gradient:{id:\"SVGID_7_\",type:\"linear\",x1:29,y1:16,x2:29,y2:19,stop:[{offset:\"0\",color:\"#58AC9A\"},{offset:\"1\",color:\"#248576\"}]}},{shape:\"path\",data:\"M11,23.5c0-0.277-0.224-0.5-0.5-0.5h-7C3.224,23,3,23.223,3,23.5V24h8V23.5z\",gradient:{id:\"SVGID_8_\",type:\"linear\",x1:7,y1:22.9209,x2:7,y2:24.0459,stop:[{offset:\"0\",color:\"#58AC9A\"},{offset:\"1\",color:\"#248576\"}]}},{shape:\"path\",data:\"M20,20.5c0,0.276-0.224,0.5-0.5,0.5h-18C1.224,21,1,20.776,1,20.5v-11C1,9.224,1.224,9,1.5,9h18  C19.776,9,20,9.224,20,9.5V20.5z\",gradient:{id:\"SVGID_9_\",type:\"linear\",x1:10.4995,y1:8.0508,x2:10.4995,y2:21.5513,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"rect\",x:2,y:10,w:17,h:10,fill:\"#FFFFFF\"},{shape:\"rect\",x:3,y:11,w:15,h:8,gradient:{id:\"SVGID_10_\",type:\"linear\",x1:10.4995,y1:10.9321,x2:10.4995,y2:18.6551,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#0089C1\"}]}},{shape:\"path\",data:\"M32,22.7c0,0.165-0.135,0.3-0.301,0.3h-5.4C26.134,23,26,22.865,26,22.7v-2.4  c0-0.165,0.134-0.3,0.299-0.3h5.4C31.865,20,32,20.135,32,20.3V22.7z\",gradient:{id:\"SVGID_11_\",type:\"linear\",x1:29,y1:20,x2:29,y2:23,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}}]}),Oe(\"bus_icon\",{w:16,h:16,origin:{x:0,y:0},v:[{shape:\"rect\",x:4,y:6,w:1,h:1,fill:\"#232424\"},{shape:\"path\",data:\"M7,4c0,0.552-0.448,1-1,1H3C2.448,5,2,4.552,2,4V3c0-0.552,0.448-1,1-1h3c0.552,0,1,0.448,1,1V4z\",gradient:{id:\"SVGID_1_\",type:\"linear\",x1:4.5,y1:2,x2:4.5,y2:5,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"rect\",x:3,y:3,w:3,h:1,fill:\"#232424\"},{shape:\"rect\",x:3,y:3,w:3,h:1,fill:\"#FFFFFF\"},{shape:\"path\",data:\"M6,5.5C6,5.776,5.776,6,5.5,6h-2C3.224,6,3,5.776,3,5.5l0,0C3,5.224,3.224,5,3.5,5h2  C5.776,5,6,5.224,6,5.5L6,5.5z\",gradient:{id:\"SVGID_2_\",type:\"linear\",x1:4.5,y1:6,x2:4.5,y2:5,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"rect\",x:12,y:6,w:1,h:1,fill:\"#232424\"},{shape:\"path\",data:\"M15,4c0,0.552-0.447,1-1,1h-3c-0.553,0-1-0.448-1-1V3c0-0.552,0.447-1,1-1h3c0.553,0,1,0.448,1,1V4z\",gradient:{id:\"SVGID_3_\",type:\"linear\",x1:12.5,y1:2,x2:12.5,y2:5,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"rect\",x:11,y:3,w:3,h:1,fill:\"#232424\"},{shape:\"rect\",x:11,y:3,w:3,h:1,fill:\"#FFFFFF\"},{shape:\"path\",data:\"M14,5.5C14,5.776,13.777,6,13.5,6h-2C11.225,6,11,5.776,11,5.5l0,0C11,5.224,11.225,5,11.5,5h2  C13.777,5,14,5.224,14,5.5L14,5.5z\",gradient:{id:\"SVGID_4_\",type:\"linear\",x1:12.5,y1:6,x2:12.5,y2:5,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"rect\",x:8,y:10,w:1,h:1,fill:\"#232424\"},{shape:\"path\",data:\"M6,13c0-0.553,0.448-1,1-1h3c0.553,0,1,0.447,1,1v1c0,0.553-0.447,1-1,1H7c-0.552,0-1-0.447-1-1V13z\",gradient:{id:\"SVGID_5_\",type:\"linear\",x1:-1428.3853,y1:-571.5747,x2:-1428.3853,y2:-568.5747,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"rect\",x:7,y:13,w:3,h:1,fill:\"#232424\"},{shape:\"rect\",x:7,y:13,w:3,h:1,fill:\"#FFFFFF\"},{shape:\"path\",data:\"M7,11.5C7,11.223,7.224,11,7.5,11h2c0.277,0,0.5,0.223,0.5,0.5l0,0c0,0.275-0.223,0.5-0.5,0.5h-2  C7.224,12,7,11.775,7,11.5L7,11.5z\",gradient:{id:\"SVGID_6_\",type:\"linear\",x1:-1428.3862,y1:-567.5737,x2:-1428.3862,y2:-568.5737,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"path\",data:\"M15,7.5C15,7.776,14.777,8,14.5,8h-12C2.224,8,2,7.776,2,7.5l0,0C2,7.224,2.224,7,2.5,7h12  C14.777,7,15,7.224,15,7.5L15,7.5z\",gradient:{id:\"SVGID_7_\",type:\"linear\",x1:8.4995,y1:6.1152,x2:8.4995,y2:7.5558,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"path\",data:\"M15,9.5c0,0.275-0.223,0.5-0.5,0.5h-12C2.224,10,2,9.775,2,9.5l0,0C2,9.223,2.224,9,2.5,9h12  C14.777,9,15,9.223,15,9.5L15,9.5z\",gradient:{id:\"SVGID_8_\",type:\"linear\",x1:8.4995,y1:8.1147,x2:8.4995,y2:9.556,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}}]}),Oe(\"data_icon\",{w:16,h:16,origin:{x:0,y:0},v:[{shape:\"path\",data:\"M15,12c0,0.553-0.447,1-1,1H7c-0.552,0-1-0.447-1-1V8c0-0.552,0.448-1,1-1h7c0.553,0,1,0.448,1,1V12   z\",gradient:{id:\"SVGID_1_\",type:\"linear\",x1:10.5,y1:6.959,x2:10.5,y2:12.2259,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"rect\",x:7,y:8,w:7,h:4,fill:\"#FFFFFF\"},{shape:\"rect\",x:8,y:9,w:5,h:2,gradient:{id:\"SVGID_2_\",type:\"linear\",x1:10.5,y1:8.6997,x2:10.5,y2:11.0333,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"path\",data:\"M15,14.5c0,0.275-0.225,0.5-0.5,0.5h-8C6.224,15,6,14.775,6,14.5l0,0C6,14.223,6.224,14,6.5,14h8   C14.775,14,15,14.223,15,14.5L15,14.5z\",gradient:{id:\"SVGID_3_\",type:\"linear\",x1:10.5,y1:13.125,x2:10.5,y2:14.5518,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"rect\",x:8,y:14,w:1,h:1,gradient:{id:\"SVGID_4_\",type:\"linear\",x1:8.4995,y1:14.0049,x2:8.4995,y2:14.9471,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"path\",data:\"M12,4H6c0,0-0.152-0.275-0.5-1C5.021,2,5.021,2,4,2C3.057,2,2,2,2,2C1.448,2,1,2.448,1,3v8  c0,0.553,0.448,1,1,1h3v-1H2V3h2.387l1.024,1.998L12,5v1h1V5C13,4.448,12.553,4,12,4z\",gradient:{id:\"SVGID_5_\",type:\"linear\",x1:6.9995,y1:2.0527,x2:6.9995,y2:11.4757,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"path\",data:\"M12,5L5.411,4.998L4.387,3H2v8h3v-0.645V7.254V7c0-0.552,0.448-1,1-1h0.324h3.032H12V5z\",gradient:{id:\"SVGID_6_\",type:\"linear\",x1:6.9995,y1:2.9902,x2:6.9995,y2:11.0032,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}}]}),Oe(\"grid_icon\",{w:16,h:16,origin:{x:0,y:0},v:[{shape:\"path\",data:\"M15,14c0,0.553-0.447,1-1,1H3c-0.552,0-1-0.447-1-1V3c0-0.552,0.448-1,1-1h11c0.553,0,1,0.448,1,1V14  z\",gradient:{id:\"SVGID_1_\",type:\"linear\",x1:8.4995,y1:2.1255,x2:8.4995,y2:14.909,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"rect\",x:3,y:3,w:11,h:11,fill:\"#FFFFFF\"},{shape:\"rect\",x:3,y:5,w:11,h:1,gradient:{id:\"SVGID_2_\",type:\"linear\",x1:8.4995,y1:3.209,x2:8.4995,y2:13.8043,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"rect\",x:3,y:8,w:11,h:1,gradient:{id:\"SVGID_3_\",type:\"linear\",x1:8.4995,y1:3.209,x2:8.4995,y2:13.8043,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"rect\",x:3,y:11,w:11,h:1,gradient:{id:\"SVGID_4_\",type:\"linear\",x1:8.4995,y1:3.2095,x2:8.4995,y2:13.8048,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"rect\",x:11,y:3,w:1,h:11,gradient:{id:\"SVGID_5_\",type:\"linear\",x1:11.5,y1:3.209,x2:11.5,y2:13.8048,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"rect\",x:8,y:3,w:1,h:11,gradient:{id:\"SVGID_6_\",type:\"linear\",x1:8.4995,y1:3.209,x2:8.4995,y2:13.8048,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"rect\",x:5,y:3,w:1,h:11,gradient:{id:\"SVGID_7_\",type:\"linear\",x1:5.5,y1:3.209,x2:5.5,y2:13.8048,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}}]}),Oe(\"databox_icon\",{w:16,h:16,origin:{x:0,y:0},v:[{shape:\"path\",data:\"M14.5,6h-12H2v0.5v7C2,13.776,2.224,14,2.5,14h12c0.276,0,0.5-0.224,0.5-0.5v-7V6H14.5z\",gradient:{id:\"SVGID_1_\",type:\"linear\",x1:8.4995,y1:6.0625,x2:8.4995,y2:14.063,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"path\",data:\"M14.776,5.553l-1.553-3.105C13.101,2.201,12.775,2,12.5,2h-8C4.225,2,3.899,2.201,3.776,2.447  L2.224,5.553L2,6h0.5h12H15L14.776,5.553z\",gradient:{id:\"SVGID_2_\",type:\"linear\",x1:8.5005,y1:3.104,x2:8.5005,y2:-5.6467,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"path\",data:\"12,2 9.5,2 7.5,2 5,2 3,6 7.5,6 9.5,6 14,6 z\",gradient:{id:\"SVGID_3_\",type:\"linear\",x1:8.5005,y1:9.2295,x2:8.5005,y2:5.4586,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"path\",data:\"M11.5,9c0,0.276-0.224,0.5-0.5,0.5H6C5.724,9.5,5.5,9.276,5.5,9l0,0c0-0.276,0.224-0.5,0.5-0.5h5  C11.276,8.5,11.5,8.724,11.5,9L11.5,9z\",fill:\"#FFFFFF\"}]}),Oe(\"group_icon\",{w:16,h:16,origin:{x:0,y:0},v:[{shape:\"path\",data:\"M15,8.5C15,8.776,14.776,9,14.5,9h-10C4.224,9,4,8.776,4,8.5v-7C4,1.224,4.224,1,4.5,1h10    C14.776,1,15,1.224,15,1.5V8.5z\",gradient:{id:\"SVGID_1_\",type:\"linear\",x1:9.5,y1:.9512,x2:9.5,y2:8.9787,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"rect\",x:5,y:2,w:9,h:6,fill:\"#FFFFFF\"},{shape:\"rect\",x:6,y:3,w:7,h:4,gradient:{id:\"SVGID_2_\",type:\"linear\",x1:9.5,y1:3.02,x2:9.5,y2:6.9606,stop:[{offset:\"0\",color:\"#58AC9A\"},{offset:\"1\",color:\"#248576\"}]}},{shape:\"path\",data:\"M16,10.5c0,0.276-0.224,0.5-0.5,0.5h-12C3.224,11,3,10.776,3,10.5l0,0C3,10.224,3.224,10,3.5,10h12    C15.776,10,16,10.224,16,10.5L16,10.5z\",gradient:{id:\"SVGID_3_\",type:\"linear\",x1:9.5,y1:9.9941,x2:9.5,y2:10.9976,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"rect\",x:6,y:10.001,w:2,h:.999,gradient:{id:\"SVGID_4_\",type:\"linear\",x1:7,y1:10.0059,x2:7,y2:10.9472,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"path\",data:\"M12,12.5c0,0.276-0.224,0.5-0.5,0.5h-10C1.224,13,1,12.776,1,12.5v-7C1,5.224,1.224,5,1.5,5h10    C11.776,5,12,5.224,12,5.5V12.5z\",gradient:{id:\"SVGID_5_\",type:\"linear\",x1:6.4995,y1:4.9512,x2:6.4995,y2:12.9792,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"rect\",x:2,y:6,w:9,h:6,fill:\"#FFFFFF\"},{shape:\"rect\",x:3,y:7,w:7,h:4,gradient:{id:\"SVGID_6_\",type:\"linear\",x1:6.4995,y1:7.02,x2:6.4995,y2:10.9611,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"path\",data:\"M13,14.5c0,0.276-0.224,0.5-0.5,0.5h-12C0.224,15,0,14.776,0,14.5l0,0C0,14.224,0.224,14,0.5,14h12    C12.776,14,13,14.224,13,14.5L13,14.5z\",gradient:{id:\"SVGID_7_\",type:\"linear\",x1:6.4995,y1:13.9941,x2:6.4995,y2:14.9976,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"rect\",x:3,y:14.001,w:2,h:.999,gradient:{id:\"SVGID_8_\",type:\"linear\",x1:4,y1:14.0059,x2:4,y2:14.9472,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}}]}),Oe(\"link_icon\",{w:16,h:16,origin:{x:0,y:0},v:[{shape:\"line\",p1:{x:2.5,y:2.5},p2:{x:13.5,y:13.5},lineColor:\"url(#SVGID_1_)\",lineWidth:1},{shape:\"ellipse\",cx:13,cy:13,rx:2,ry:2,gradient:{id:\"SVGID_2_\",type:\"linear\",x1:11.5371,y1:11.5371,x2:14.2155,y2:14.2155,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"ellipse\",cx:13,cy:13,rx:1,ry:1,fill:\"#FFFFFF\"},{shape:\"ellipse\",cx:3,cy:3,rx:2,ry:2,gradient:{id:\"SVGID_3_\",type:\"linear\",x1:1.4956,y1:1.4956,x2:4.1473,y2:4.1473,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"ellipse\",cx:3,cy:3,rx:1,ry:1,fill:\"#FFFFFF\"}]}),Oe(\"linksubnetwork_icon\",{w:16,h:16,origin:{x:0,y:0},v:[{shape:\"path\",data:\"M15,7.661c0-1.202-0.642-2.247-1.596-2.835C12.848,3.188,11.314,2,9.486,2  c-1.587,0-2.95,0.902-3.649,2.211C4.573,4.22,3.548,5.194,3.438,6.432C3.389,6.429,3.342,6.417,3.292,6.417  C2.026,6.417,1,7.443,1,8.708C1,9.975,2.026,11,3.292,11h8.371l0,0C13.506,11,15,9.506,15,7.661z\",gradient:{id:\"SVGID_1_\",type:\"linear\",x1:7.9995,y1:1.959,x2:7.9995,y2:11.0921,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"path\",data:\"M3.292,10C2.58,10,2,9.42,2,8.708c0-0.712,0.58-1.292,1.292-1.292C3.286,7.422,3.332,7.427,3.379,7.43  l0.969,0.058L4.435,6.52C4.5,5.779,5.106,5.216,5.844,5.211l0.595-0.004l0.28-0.524C7.273,3.645,8.334,3,9.486,3  c1.342,0,2.535,0.863,2.971,2.147l0.116,0.341l0.307,0.189C13.581,6.11,14,6.851,14,7.661C14,8.951,12.951,10,11.661,10H3.292z\",fill:\"#FFFFFF\"},{shape:\"path\",data:\"M3.292,10h8.37c1.11,0,2.04-0.781,2.276-1.821c-0.131-0.615-0.5-1.158-1.058-1.501l-0.307-0.189  l-0.116-0.341C12.021,4.863,10.828,4,9.486,4C8.334,4,7.273,4.645,6.719,5.682l-0.28,0.524L5.844,6.211  C5.106,6.216,4.5,6.779,4.435,7.52L4.349,8.487L3.379,8.43C3.332,8.427,3.286,8.422,3.292,8.417c-0.535,0-0.994,0.328-1.19,0.792  C2.297,9.672,2.757,10,3.292,10z\",gradient:{id:\"SVGID_2_\",type:\"linear\",x1:8.019,y1:4.084,x2:8.019,y2:9.8062,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"line\",p1:{x:8.01,y:8.01},p2:{x:13.186,y:13.186},lineColor:\"url(#SVGID_3_)\",lineWidth:1},{shape:\"ellipse\",cx:8,cy:8,rx:2,ry:2,gradient:{id:\"SVGID_4_\",type:\"linear\",x1:6.7881,y1:6.7881,x2:9.9924,y2:9.9924,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"ellipse\",cx:8,cy:8,rx:1,ry:1,fill:\"#FFFFFF\"},{shape:\"ellipse\",cx:13,cy:13,rx:2,ry:2,gradient:{id:\"SVGID_5_\",type:\"linear\",x1:11.5791,y1:11.5791,x2:14.3132,y2:14.3132,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"ellipse\",cx:13,cy:13,rx:1,ry:1,fill:\"#FFFFFF\"}]}),Oe(\"node_icon\",{w:16,h:16,origin:{x:0,y:0},v:[{shape:\"path\",data:\"M15,11.5c0,0.276-0.224,0.5-0.5,0.5h-13C1.224,12,1,11.776,1,11.5v-9C1,2.224,1.224,2,1.5,2h13  C14.776,2,15,2.224,15,2.5V11.5z\",gradient:{id:\"SVGID_1_\",type:\"linear\",x1:7.9995,y1:1.939,x2:7.9995,y2:11.9739,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"rect\",x:2,y:3,w:12,h:8,fill:\"#FFFFFF\"},{shape:\"rect\",x:3,y:4,w:10,h:6,gradient:{id:\"SVGID_2_\",type:\"linear\",x1:7.9995,y1:4.0513,x2:7.9995,y2:9.865,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"path\",data:\"M16,14.5c0,0.276-0.224,0.5-0.5,0.5h-15C0.224,15,0,14.776,0,14.5v-1C0,13.224,0.224,13,0.5,13h15  c0.276,0,0.5,0.224,0.5,0.5V14.5z\",gradient:{id:\"SVGID_3_\",type:\"linear\",x1:7.9995,y1:13.0508,x2:7.9995,y2:14.9258,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"path\",data:\"M9,14.5C9,14.224,8.776,14,8.5,14h-5C3.224,14,3,14.224,3,14.5V15h6V14.5z\",gradient:{id:\"SVGID_4_\",type:\"linear\",x1:5.9995,y1:14.0508,x2:5.9995,y2:15.9258,stop:[{offset:\"0\",color:\"#69B4A5\"},{offset:\"0.1\",color:\"#61AD9C\"},{offset:\"0.4637\",color:\"#449981\"},{offset:\"0.7764\",color:\"#2C8E73\"},{offset:\"1\",color:\"#218A6E\"}]}}]}),Oe(\"shapelink_icon\",{w:16,h:16,origin:{x:0,y:0},v:[{shape:\"line\",p1:{x:7.5,y:2.5},p2:{x:2.5,y:7.5},lineColor:\"url(#SVGID_1_)\",lineWidth:1},{shape:\"line\",p1:{x:2.5,y:7.5},p2:{x:8.5,y:13.5},lineColor:\"url(#SVGID_2_)\",lineWidth:1},{shape:\"line\",p1:{x:9,y:13.186},p2:{x:13.5,y:6.5},lineColor:\"url(#SVGID_3_)\",lineWidth:1},{shape:\"ellipse\",cx:7,cy:3,rx:2,ry:2,gradient:{id:\"SVGID_4_\",type:\"linear\",x1:5.5864,y1:1.5864,x2:8.4149,y2:4.4149,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"ellipse\",cx:7,cy:3,rx:1,ry:1,fill:\"#FFFFFF\"},{shape:\"ellipse\",cx:2,cy:8,rx:2,ry:2,gradient:{id:\"SVGID_5_\",type:\"linear\",x1:.5864,y1:6.5864,x2:3.4142,y2:9.4142,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"ellipse\",cx:2,cy:8,rx:1,ry:1,fill:\"#FFFFFF\"},{shape:\"ellipse\",cx:8,cy:13,rx:2,ry:2,gradient:{id:\"SVGID_6_\",type:\"linear\",x1:6.5869,y1:11.5869,x2:9.4147,y2:14.4147,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"ellipse\",cx:8,cy:13,rx:1,ry:1,fill:\"#FFFFFF\"},{shape:\"ellipse\",cx:13,cy:7,rx:2,ry:2,gradient:{id:\"SVGID_7_\",type:\"linear\",x1:11.5859,y1:5.5859,x2:14.4144,y2:8.4144,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"ellipse\",cx:13,cy:7,rx:1,ry:1,fill:\"#FFFFFF\"}]}),Oe(\"shapenode_icon\",{w:16,h:16,origin:{x:0,y:0},v:[{shape:\"path\",data:\"M14.5,3h-9l-4,4v7h13L9,8.5L14.5,3z M12.086,13H2.5V7.414L5.914,4h6.172l-4.5,4.5L12.086,13z\",gradient:{id:\"SVGID_1_\",type:\"linear\",x1:7.9995,y1:3.209,x2:7.9995,y2:13.6621,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"ellipse\",cx:6,cy:3,rx:2,ry:2,gradient:{id:\"SVGID_2_\",type:\"linear\",x1:4.5859,y1:1.5859,x2:7.4151,y2:4.4151,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"ellipse\",cx:6,cy:3,rx:1,ry:1,fill:\"#FFFFFF\"},{shape:\"ellipse\",cx:13,cy:3,rx:2,ry:2,gradient:{id:\"SVGID_3_\",type:\"linear\",x1:11.5869,y1:1.5864,x2:14.4153,y2:4.4149,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"ellipse\",cx:13,cy:3,rx:1,ry:1,fill:\"#FFFFFF\"},{shape:\"ellipse\",cx:9,cy:8,rx:2,ry:2,gradient:{id:\"SVGID_4_\",type:\"linear\",x1:7.5864,y1:6.5864,x2:10.4149,y2:9.4149,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"ellipse\",cx:9,cy:8,rx:1,ry:1,fill:\"#FFFFFF\"},{shape:\"ellipse\",cx:2,cy:7,rx:2,ry:2,gradient:{id:\"SVGID_5_\",type:\"linear\",x1:.5859,y1:5.5859,x2:3.4144,y2:8.4144,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"ellipse\",cx:2,cy:7,rx:1,ry:1,fill:\"#FFFFFF\"},{shape:\"ellipse\",cx:12.825,cy:13,rx:2,ry:2,gradient:{id:\"SVGID_6_\",type:\"linear\",x1:11.4111,y1:11.5869,x2:14.2396,y2:14.4153,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"ellipse\",cx:12.825,cy:13,rx:1,ry:1,fill:\"#FFFFFF\"}]}),Oe(\"shapesubnetwork_icon\",{w:16,h:16,origin:{x:0,y:0},v:[{shape:\"path\",data:\"M15,6.661c0-1.202-0.642-2.247-1.596-2.835C12.848,2.188,11.314,1,9.486,1  c-1.587,0-2.95,0.902-3.649,2.211C4.573,3.22,3.548,4.194,3.438,5.432C3.389,5.429,3.342,5.417,3.292,5.417  C2.026,5.417,1,6.443,1,7.708S2.026,10,3.292,10h8.371l0,0C13.506,10,15,8.505,15,6.661z\",gradient:{id:\"SVGID_1_\",type:\"linear\",x1:7.9995,y1:1.3755,x2:7.9995,y2:9.733,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"path\",data:\"M3.292,9C2.58,9,2,8.42,2,7.708s0.58-1.292,1.292-1.292C3.286,6.422,3.332,6.427,3.379,6.43l0.969,0.058  L4.435,5.52C4.5,4.779,5.106,4.216,5.844,4.211l0.595-0.004l0.28-0.524C7.273,2.645,8.334,2,9.486,2  c1.342,0,2.535,0.863,2.971,2.147l0.116,0.341l0.307,0.189C13.581,5.11,14,5.851,14,6.661C14,7.951,12.951,9,11.661,9H3.292z\",fill:\"#FFFFFF\"},{shape:\"path\",data:\"M3.272,9h8.37c1.11,0,2.039-0.689,2.275-1.729c-0.131-0.615-0.499-1.249-1.057-1.593l-0.307-0.189  l-0.116-0.341C12.002,3.863,10.809,3,9.468,3C8.314,3,7.254,3.645,6.7,4.682L6.42,5.207L5.825,5.211  C5.087,5.216,4.481,5.779,4.416,6.52L4.33,7.487L3.36,7.43C3.313,7.427,3.267,7.422,3.272,7.417c-0.535,0-0.994,0.327-1.19,0.792  C2.278,8.672,2.738,9,3.272,9z\",gradient:{id:\"SVGID_2_\",type:\"linear\",x1:7.9995,y1:3.459,x2:7.9995,y2:8.4597,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"path\",data:\"M11.516,7.102h-8l2.469,6h8.5L11.516,7.102z M5.024,8.123h5.905l1.938,3.979H6.662L5.024,8.123z\",gradient:{id:\"SVGID_3_\",type:\"linear\",x1:7.4443,y1:7.1724,x2:10.1111,y2:12.8383,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"path\",data:\"5,8.112 10.904,8.112 12.842,12.092 6.638,12.092 z\",fill:\"#FFFFFF\"},{shape:\"ellipse\",cx:5,cy:8,rx:2,ry:2,gradient:{id:\"SVGID_4_\",type:\"linear\",x1:3,y1:8,x2:7,y2:8,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"ellipse\",cx:5,cy:8,rx:1,ry:1,fill:\"#FFFFFF\"},{shape:\"ellipse\",cx:12,cy:8,rx:2,ry:2,gradient:{id:\"SVGID_5_\",type:\"linear\",x1:10,y1:8,x2:14,y2:8,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"ellipse\",cx:12,cy:8,rx:1,ry:1,fill:\"#FFFFFF\"},{shape:\"ellipse\",cx:7,cy:12,rx:2,ry:2,gradient:{id:\"SVGID_6_\",type:\"linear\",x1:5,y1:12,x2:9,y2:12,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"ellipse\",cx:7,cy:12,rx:1,ry:1,fill:\"#FFFFFF\"},{shape:\"ellipse\",cx:14,cy:12,rx:2,ry:2,gradient:{id:\"SVGID_7_\",type:\"linear\",x1:12,y1:12,x2:16,y2:12,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"ellipse\",cx:14,cy:12,rx:1,ry:1,fill:\"#FFFFFF\"}]}),Oe(\"subnetwork_icon\",{w:16,h:16,origin:{x:0,y:0},v:[{shape:\"rect\",x:10,y:14.001,w:2,h:1,gradient:{id:\"SVGID_1_\",type:\"linear\",x1:11,y1:14.0059,x2:11,y2:14.9481,stop:[{offset:\"0\",color:\"#58AC9A\"},{offset:\"1\",color:\"#248576\"}]}},{shape:\"rect\",x:14,y:10.001,w:1,h:2,gradient:{id:\"SVGID_2_\",type:\"linear\",x1:14.5,y1:10.0117,x2:14.5,y2:11.8962,stop:[{offset:\"0\",color:\"#58AC9A\"},{offset:\"1\",color:\"#248576\"}]}},{shape:\"path\",data:\"M16,6.001c0,0.552-0.447,1-1,1H8c-0.552,0-1-0.448-1-1v-4c0-0.552,0.448-1,1-1h7   c0.553,0,1,0.448,1,1V6.001z\",gradient:{id:\"SVGID_3_\",type:\"linear\",x1:11.5,y1:.96,x2:11.5,y2:6.2265,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"rect\",x:8,y:2.001,w:7,h:4,fill:\"#FFFFFF\"},{shape:\"rect\",x:9,y:3.001,w:5,h:2,gradient:{id:\"SVGID_4_\",type:\"linear\",x1:11.5,y1:2.7007,x2:11.5,y2:5.0337,stop:[{offset:\"0\",color:\"#58AC9A\"},{offset:\"1\",color:\"#248576\"}]}},{shape:\"path\",data:\"M16,8.501c0,0.276-0.225,0.5-0.5,0.5h-8c-0.276,0-0.5-0.224-0.5-0.5l0,0c0-0.276,0.224-0.5,0.5-0.5   h8C15.775,8.001,16,8.225,16,8.501L16,8.501z\",gradient:{id:\"SVGID_5_\",type:\"linear\",x1:11.5,y1:7.126,x2:11.5,y2:8.5535,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"rect\",x:9,y:8.001,w:1,h:.999,gradient:{id:\"SVGID_6_\",type:\"linear\",x1:9.5,y1:8.0063,x2:9.5,y2:8.9477,stop:[{offset:\"0\",color:\"#58AC9A\"},{offset:\"1\",color:\"#248576\"}]}},{shape:\"path\",data:\"M9,12c0,0.553-0.447,1-1,1H1c-0.552,0-1-0.447-1-1V8c0-0.552,0.448-1,1-1h7c0.553,0,1,0.448,1,1V12z   \",gradient:{id:\"SVGID_7_\",type:\"linear\",x1:4.4995,y1:6.959,x2:4.4995,y2:12.2259,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"rect\",x:1,y:8,w:7,h:4,fill:\"#FFFFFF\"},{shape:\"rect\",x:2,y:9,w:5,h:2,gradient:{id:\"SVGID_8_\",type:\"linear\",x1:4.5,y1:8.6997,x2:4.5,y2:11.0333,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"path\",data:\"M9,14.5C9,14.776,8.775,15,8.5,15h-8C0.224,15,0,14.776,0,14.5l0,0C0,14.224,0.224,14,0.5,14h8   C8.775,14,9,14.224,9,14.5L9,14.5z\",gradient:{id:\"SVGID_9_\",type:\"linear\",x1:4.4995,y1:13.125,x2:4.4995,y2:14.5518,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}},{shape:\"rect\",x:2,y:14,w:1,h:1,gradient:{id:\"SVGID_10_\",type:\"linear\",x1:2.5,y1:14.0049,x2:2.5,y2:14.9471,stop:[{offset:\"0\",color:\"#61B7D9\"},{offset:\"1\",color:\"#005EAD\"}]}},{shape:\"path\",data:\"M16,14.501c0,0.276-0.224,0.5-0.5,0.5h-2c-0.276,0-0.5-0.224-0.5-0.5v-1c0-0.276,0.224-0.5,0.5-0.5  h2c0.276,0,0.5,0.224,0.5,0.5V14.501z\",gradient:{id:\"SVGID_11_\",type:\"linear\",x1:14.5,y1:13.0117,x2:14.5,y2:14.8962,stop:[{offset:\"0\",color:\"#666767\"},{offset:\"1\",color:\"#232424\"}]}}]});Me={_hitCanvas:null,getHitCanvas:function(t,e){null==this._hitCanvas&&(this._hitCanvas=X.createCanvas()),0==arguments.length&&(t=2,e=2),this._hitCanvas.setAttribute(\"width\",\"\"+t-1),this._hitCanvas.setAttribute(\"height\",\"\"+e-1),this._hitCanvas.setAttribute(\"width\",\"\"+t),this._hitCanvas.setAttribute(\"height\",\"\"+e);return this.getCtx(this._hitCanvas).clearRect(0,0,t,e),this._hitCanvas},disposeHitCanvas:function(){this._hitCanvas=null},getCtx:function(t){return t.getContext(\"2d\")},render:function(t,e,i){void 0!=e&&(t.fillStyle=e,t.fill()),void 0!=i&&(t.strokeStyle=i,t.stroke())},text:function(t,e,i,n,s,o){t.textAlign=\"center\",t.textBaseline=\"middle\",null!=s&&(t.fillStyle=s,t.fillText(e,i,n)),o&&(t.strokeStyle=o,t.strokeText(e,i,n))},circle:function(t,e,i,n,s,o){t.arc(e,i,n,0,2*Math.PI,!0),t.closePath(),this.render(t,s,o)},rect:function(t,e,i,n,s,o,r){t.rect(e,i,n,s),t.closePath(),this.render(t,o,r)},OUT_LEFT:1,OUT_TOP:2,OUT_RIGHT:4,OUT_BOTTOM:8,outcode:function(t,e,i,n,s,o){var r=0;return s<=0?r|=this.OUT_LEFT|this.OUT_RIGHT:t<i?r|=this.OUT_LEFT:t>i+s&&(r|=this.OUT_RIGHT),o<=0?r|=this.OUT_TOP|this.OUT_BOTTOM:e<n?r|=this.OUT_TOP:e>n+o&&(r|=this.OUT_BOTTOM),r},intersectsLine:function(t,e,i,n,s,o,r,a){var h,l;if(0==(l=this.outcode(i,n,s,o,r,a)))return!0;for(;0!=(h=this.outcode(t,e,s,o,r,a));){if(0!=(h&l))return!1;if(0!=(h&(this.OUT_LEFT|this.OUT_RIGHT))){var c=s;0!=(h&this.OUT_RIGHT)&&(c+=r),e+=(c-t)*(n-e)/(i-t),t=c}else{var d=o;0!=(h&this.OUT_BOTTOM)&&(d+=a),t+=(d-e)*(i-t)/(n-e),e=d}}return!0}};R.vector={},R.vector.interaction={},R.vector.Network=function(t){R.vector.Network.superClass.constructor.apply(this,arguments),this.zoomManager=new R.vector.PhysicalZoomManager(this),this._view=X.createView(\"hidden\"),this._rootCanvas=X.createCanvas(),this._topCanvas=X.createCanvas(),this._view.appendChild(this._rootCanvas),this._view.appendChild(this._topCanvas),this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0},this._zoom=1,this._elementUIMap={},this._zoomMap={},this._viewRectMap={},this.viewRect={x:0,y:0,width:0,height:0},this.state={zooming:!1,panning:!1,autoLayout:!1},this.hScrollBarVisible=!1,this.vScrollBarVisible=!1,this.markerList=new R.List,this._topAttachmentList=new R.List,this._hitTestTopAttachmentList=new R.List,this.setElementBox(t||new R.ElementBox),V.isTouchable?V.isMSTouchable?this.setDefaultInteractions(!1,!1):this.setTouchInteractions():this.setDefaultInteractions(!1,!1);var e=this;this._flowLink=function(){if(!(e.isMovingElement()||e.isSelectingElement()||e.isEditingElement()||e._box._layoutMovingElements)){e._flowLinkQuickFinder||(e._flowLinkQuickFinder=new R.QuickFinder(e._box,\"link.flow\",\"style\"));e._flowLinkQuickFinder.find(!0).forEach(function(t){t._styleMap[\"link.flow.offset\"]=e.getLinkFlowOffset(t),e.invalidateElementUI(t)})}},this.setToolTipEnabled(R.Defaults.NETWORK_TOOLTIP_ENABLED),this._paintAll=!0,this._dirtyRects=new oe,this._invalidateMap={},this._invalidateAll=!0,e._count=0,e._invalidate=!0,function t(i){e._loopId=requestAnimationFrame(t),e._invalidate&&(e._count++,e._now=i,e.validate())}(0),R.imageUtil.addEventListener(this.invalidateElementUIs,this),X.addEventListener(\"mousemove\",\"handle_mousemove\",this._view,this)},D.ext(\"twaver.vector.Network\",R.controls.View,{__accessor:[\"selectMode\",\"makeVisibleOnSelected\",\"movableFunction\",\"editPointSize\",\"editPointFillColor\",\"scrollBarWidth\",\"editPointOutlineWidth\",\"editPointOutlineColor\",\"editLineColor\",\"editLineWidth\",\"resizePointSize\",\"resizePointFillColor\",\"resizePointOutlineWidth\",\"resizePointOutlineColor\",\"resizeLineColor\",\"resizeLineWidth\",\"rotatePointSize\",\"rotatePointFillColor\",\"rotatePointOffset\",\"rotatePointOutlineWidth\",\"rotatePointOutlineColor\",\"rotateScaleFillColor\",\"rotateScaleFontColor\",\"rotateScaleWidth\",\"rotateScaleHeight\",\"selectOutlineColor\",\"selectOutlineWidth\",\"selectFillColor\",\"lazyMoveOutlineColor\",\"lazyMoveOutlineWidth\",\"lazyMoveFillColor\",\"rectSelectFilter\",\"selectionTolerance\"],__bool:[\"doubleClickToUpSubNetwork\",\"doubleClickToSubNetwork\",\"doubleClickToEmptySubNetwork\",\"doubleClickToLinkBundle\",\"doubleClickToGroupExpand\",\"scrollBarVisible\",\"limitViewInCanvas\",\"autoValidateCanvasSize\",\"subNetworkAnimate\",\"lazyMoveAnimate\",\"resizeAnimate\",\"noAgentLinkVisible\",\"keyboardRemoveEnabled\",\"keyboardSelectEnabled\",\"sendToTopOnSelected\",\"lazyMoveFill\",\"editingElement\",\"rotatingElement\",\"movingElement\",\"selectingElement\",\"rectSelectEnabled\",\"limitElementInPositiveLocation\",\"showRotateScale\",\"transparentSelectionEnable\",\"edgeDetect\",\"dragToPan\",\"wheelToZoom\",\"asyncZoomAndViewRect\",\"debug\",\"zoomDivVisible\",\"showShadowInEdit\",\"showAttachOnChg\"],_currentSubNetwork:null,_subNetworkAnimate:R.Defaults.NETWORK_SUBNETWORK_ANIMATE,_scrollBarWidth:10,_scrollBarVisible:!0,_limitViewInCanvas:!1,_autoValidateCanvasSize:!0,_makeVisibleOnSelected:R.Defaults.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:R.Defaults.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:R.Defaults.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:xe.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_elementUIFunction:R.Defaults.VECTORUI_FUNCTION,_doubleClickToUpSubNetwork:R.Defaults.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:R.Defaults.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:R.Defaults.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:R.Defaults.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:R.Defaults.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_selectOutlineColor:R.Defaults.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:R.Defaults.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:R.Defaults.NETWORK_SELECT_FILL_COLOR,_sendToTopOnSelected:R.Defaults.NETWORK_SENDTOTOP_ON_SELECTED,_lazyMoveOutlineColor:R.Defaults.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:R.Defaults.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:R.Defaults.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:R.Defaults.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:R.Defaults.NETWORK_LAZYMOVE_ANIMATE,_resizePointSize:R.Defaults.NETWORK_RESIZE_POINT_SIZE,_resizePointFillColor:R.Defaults.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:R.Defaults.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:R.Defaults.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:R.Defaults.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:R.Defaults.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:R.Defaults.NETWORK_RESIZE_ANIMATE,_rotatePointSize:R.Defaults.NETWORK_ROTATE_POINT_SIZE,_rotatePointFillColor:R.Defaults.NETWORK_ROTATE_POINT_FILL_COLOR,_rotatePointOffset:R.Defaults.NETWORK_ROTATE_POINT_OFFSET,_rotatePointOutlineWidth:R.Defaults.NETWORK_ROTATE_POINT_OUTLINE_WIDTH,_rotatePointOutlineColor:R.Defaults.NETWORK_ROTATE_POINT_OUTLINE_COLOR,_rotateScaleWidth:xe.NETWORK_ROTATE_SCALE_WIDTH,_rotateScaleHeight:xe.NETWORK_ROTATE_SCALE_HEIGHT,_rotateScaleFillColor:xe.NETWORK_ROTATE_SCALE_FILL_COLOR,_rotateScaleFontColor:xe.NETWORK_ROTATE_SCALE_FONT_COLOR,_editPointSize:R.Defaults.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:R.Defaults.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:R.Defaults.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:R.Defaults.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:R.Defaults.NETWORK_EDIT_LINE_COLOR,_editLineWidth:R.Defaults.NETWORK_EDIT_LINE_WIDTH,_limitElementInPositiveLocation:!1,_linkFlowInterval:xe.NETWORK_LINK_FLOW_INTERVAL,_selectionTolerance:xe.NETWORK_SELECTION_TOLERANCE,_invalidateViewRectFlag:!1,_repaintTopFlag:!1,_invalidateCanvasSizeFlag:!1,_isEditingElement:!1,_isRotatingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,_showRotateScale:!0,_transparentSelectionEnable:R.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE,_edgeDetect:!1,_dragToPan:!0,_wheelToZoom:!0,_asyncZoomAndViewRect:!1,_debug:!1,_zoomDivVisible:!0,_showShadowInEdit:!1,_showAttachOnChg:!0,adjustBounds:function(t){var e=!1,i=this._view.style;if(i.left==t.x+\"px\"&&i.top==t.y+\"px\"&&i.width==t.width+\"px\"&&i.height==t.height+\"px\"&&(e=!0),R.vector.Network.superClass.adjustBounds.apply(this,arguments),1!=e){var n=t.width,s=t.height;this._rootCanvas.setAttribute(\"width\",n),this._rootCanvas.setAttribute(\"height\",s),this._topCanvas.setAttribute(\"width\",n),this._topCanvas.setAttribute(\"height\",s),this.setViewRect(this.viewRect.x,this.viewRect.y,n,s),void 0===R.gis&&(R.Util.makeHighRes(this._rootCanvas),R.Util.makeHighRes(this._topCanvas)),this.invalidateElementVisibility()}},getLabel:function(t){return t.getStyle(\"network.label\")||t.getName()},getLabel2:function(t){return t.getStyle(\"network.label\")||t.getName2()},setZoomManager:function(t){var e=this.zoomManager;e!=t&&(this.zoomManager=t,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.validateCanvasSize(),this.invalidateElementUIs(),this.firePropertyChange(\"zoomManager\",e,t))},getZoomManager:function(){return this.zoomManager},getRootCanvas:function(){return this._rootCanvas},getTopCanvas:function(){return this._topCanvas},validateImpl:function(){ct.twm(this);var t,e,i,n,s=this.getElementBox().getDatas()._as,o=s.length,r={},a=this._visibleFunction,h=1===this._box._layerBox.size()?this._box._layerBox._defaultLayer:null;for(t=0;t<o;t++)r[(i=s[t])._id]=this.isVisible(i,a,h);var l=this.getGraphicsZoom(),c=null,d={x:this.viewRect.x/l,y:this.viewRect.y/l,width:this.viewRect.width/l,height:this.viewRect.height/l};if(this._invalidateAll){if(this._visibleMap)for(t=0;t<o;t++)r[(i=s[t])._id]!==this._visibleMap[i._id]&&(n=this._elementUIMap[i._id])&&n.invalidate();for(t=0;t<o;t++)i=s[t],(n=this._elementUIMap[i._id])&&n.validate();this._paintAll=!0}else if(this._paintAll){for(e in this._invalidateMap)(n=this._elementUIMap[e])&&n.invalidate();for(e in this._invalidateMap)(n=this._elementUIMap[e])&&n.validate()}else{for(e in this._invalidateMap)(n=this._elementUIMap[e])&&(this._dirtyRects.add(n.getZoomViewRect(!1)),n.invalidate());for(e in this._invalidateMap)(n=this._elementUIMap[e])&&(n.validate(),this._dirtyRects.add(n.getZoomViewRect(!0)))}this._paintAll?c=d:(this._dirtyRects.forEach(function(t){c=null==c?D.cloneRect(t):W.unionRect(c,t)}),c?(W.grow(c,2,2),c=W.intersection(c,d)):c=d),this._visibleMap=r,c&&this.paintRoot(c),this.validateCanvasSize(),1==this._repaintTopFlag&&(this._repaintTopFlag=!1,this.paintTopCanvas())},isLinkFlowEnabled:function(){return!!this._linkFlowEnabled},setLinkFlowEnabled:function(t){t?(this._linkFlowEnabled||(this._linkFlowEnabled=!0,this.firePropertyChange(\"linkFlowEnabled\",!1,!0)),clearInterval(this._linkFlowTimerId),this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval)):(this._linkFlowEnabled&&(this._linkFlowEnabled=!1,this.firePropertyChange(\"linkFlowEnabled\",!0,!1)),clearInterval(this._linkFlowTimerId),delete this._linkFlowTimerId)},getLinkFlowInterval:function(){return this._linkFlowInterval},setLinkFlowInterval:function(t){var e=this._linkFlowInterval;this._linkFlowInterval=t,this.firePropertyChange(\"linkFlowInterval\",e,t),clearInterval(this._linkFlowTimerId),this.isLinkFlowEnabled()&&(this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval))},getElementBox:function(){return this._box},setElementBox:function(t){if(!t)throw\"ElementBox can not be null\";if(this._box!==t){var e=this._box;e&&(e.removeDataBoxChangeListener(this.handleElementBoxChange,this),e.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),e.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),e.removeIndexChangeListener(this.handleIndexChange,this),e.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),e.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),e.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||e.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=t,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._flowLinkQuickFinder&&(this._flowLinkQuickFinder.dispose(),this._flowLinkQuickFinder=new R.QuickFinder(this._box,\"link.flow\",\"style\")),this._selectionModel?this._selectionModel._setDataBox(t):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.firePropertyChange(\"elementBox\",e,this._box)}},handleElementBoxChange:function(t){var e=t.data;if(\"add\"===t.kind)this.createElementUI(e),this.invalidateBundleLink(e);else if(\"remove\"===t.kind){var i=this.getElementUI(e);i&&(this._dirtyRects.add(i.getZoomViewRect()),i.dispose(),delete this._elementUIMap[e.getId()]),e===this._currentSubNetwork&&null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null),delete this._invalidateMap[e._id]}else if(\"clear\"===t.kind){for(var n in this._elementUIMap)this._elementUIMap[n]&&this._elementUIMap[n].dispose&&this._elementUIMap[n].dispose();this._elementUIMap={},null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null),this._paintAll=!0}else\"layoutEnd\"===t.kind?this.state.layouting=!1:\"layouting\"===t.kind&&(this.state.layouting=!0);this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementPropertyChange:function(t){var e=t.source,i=this.getElementUI(e);i&&(this.invalidateElementUI(e),i.handlePropertyChange(t)),this.invalidateBundleLink(e),this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementBoxPropertyChange:function(){this.invalidateElementVisibility()},handleIndexChange:function(t){this.invalidateElementVisibility()},handleLayerBoxChange:function(){this.invalidateElementVisibility()},handleLayerPropertyChange:function(t){\"editable\"===t.property&&this.invalidateSelectedElementUIs(!0),this.invalidateElementVisibility()},handleLayerHierarchyChange:function(){this.invalidateElementVisibility()},handleSelectionChange:function(t){var e=this.getSelectionModel().getLastData();e&&(\"append\"!==t.kind&&\"set\"!==t.kind||(this.isMakeVisibleOnSelected()&&this.makeVisible(e),this.isSendToTopOnSelected()&&this.sendToTop(e))),t.datas.forEach(function(e){var i=this.getElementUI(e);i&&i.handleSelectionChange(t),this.invalidateElementUI(e)},this),this.invalidateElementVisibility()},sendToTop:function(t){if(this._box.contains(t)){for(var e=t;e._parent&&this.isVisible(e._parent)&&(e=e._parent););e!==t&&this._box.adjustElementIndex(e),this._box.adjustElementIndex(t)}},getScopeRect:function(t){var e=this.getGraphicsZoom();this.zoomManager;if(\"viewsize\"===t)return{x:this._unionBounds.x-this.viewRect.x,y:this._unionBounds.y-this.viewRect.y,width:this._unionBounds.width,height:this._unionBounds.height};if(\"viewport\"===t){if(this.viewRect)return D.cloneRect(this.viewRect)}else if(\"rootcanvas\"===t)return{x:this.viewRect.x,y:this.viewRect.y,width:(Math.abs(this.viewRect.x-this._unionBounds.x)+this._unionBounds.width)*e,height:(Math.abs(this.viewRect.y-this._unionBounds.y)+this._unionBounds.height)*e};return{x:0,y:0,width:0,height:0}},getViewRect:function(){return this.viewRect?D.cloneRect(this.viewRect):{x:0,y:0,width:0,height:0}},getCanvasSize:function(){return{width:this.realWidth,height:this.realHeight}},setViewOffSet:function(t,e){var i=this.viewRect.x,n=this.viewRect.y,s=this.viewRect.width,o=this.viewRect.height;this.setViewRect(i+t,n+e,s,o)},setViewRect:function(t,e,i,n){1==this.isLimitViewInCanvas()&&(t<0&&(t=0),i>this.realWidth?t=0:t+i>this.realWidth&&(t=this.realWidth-i),e<0&&(e=0),n>this.realHeight?e=0:e+n>this.realHeight&&(e=this.realHeight-n));var s=this.viewRect;null!=this.viewRect&&t==this.viewRect.x&&e==this.viewRect.y&&i==this.viewRect.width&&n==this.viewRect.height||(this.viewRect={x:t,y:e,width:i,height:n},this.firePropertyChange(\"viewRect\",s,this.viewRect),this.invalidateElementVisibility(),this._paintAll=!0)},isHScrollBarVisible:function(){return this.hScrollBarVisible},setHScrollBarVisible:function(t){this.hScrollBarVisible=t},isVScrollBarVisible:function(){return this.vScrollBarVisible},setVScrollBarVisible:function(t){this.vScrollBarVisible=t},setZoomVisibilityThresholds:function(t){var e=this._visibilityThresholds;this._zoomVisibilityThresholds=t,this.firePropertyChange(\"zoomVisibilityThresholds\",e,t),this.invalidateElementVisibility()},getZoomVisibilityThresholds:function(){return this._zoomVisibilityThresholds||{}},invalidateElementVisibility:function(){this.invalidate()},repaintTopCanvas:function(){this._repaintTopFlag||(this._repaintTopFlag=!0,this.invalidate())},invalidateCanvasSize:function(t){this._invalidateCanvasSizeFlag||(this._invalidateCanvasSizeFlag=!0,this.invalidate())},validateCanvasSize:function(){0!=this._invalidateCanvasSizeFlag&&(this._invalidateCanvasSizeFlag=!1,this._validateCanvasSize())},_validateCanvasSize:function(){if(0==this.isAutoValidateCanvasSize())return this.realWidth=0,this.realHeight=0,void(this._unionBounds={x:0,y:0,width:0,height:0});var t,e=this.getElementBox().getDatas(),i=e.size();if(i>0){for(var n=0;n<i;n++){var s=e.get(n);if(this._visibleMap[s._id]){var o=this._elementUIMap[s._id];o&&(t=t?W.unionRect(t,o.getZoomViewRect(!0)):D.cloneRect(o.getZoomViewRect(!0)))}}null==t&&(t={x:0,y:0,width:0,height:0});var r=this.getGraphicsZoom();if(this._unionBounds={x:t.x*r,y:t.y*r,width:t.width*r,height:t.height*r},this.realWidth==(t.x+t.width)*r&&this.realHeight==(t.y+t.height)*r)return;this.realWidth=(t.x+t.width)*r,this.realHeight=(t.y+t.height)*r}else this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0};this.setViewRect(this.viewRect.x,this.viewRect.y,this.viewRect.width,this.viewRect.height),this.firePropertyChange(\"canvasSizeChange\",null,this.viewRect)},getElementUI:function(t){return null==t?null:this._elementUIMap[t._id]},getUnionBounds:function(){return this._unionBounds},getZoomBodyRect:function(t){var e=this.getElementUI(t);return e?e.getZoomBodyRect():null},getShapeNodeZoomPoints:function(t,e){if(t._points){var i=this.getElementUI(t);if(i)return i._getZoomPoints()}return null},createElementUI:function(t){var e=this._elementUIMap[t.getId()];if(!e){if(!(e=this._elementUIFunction(this,t))){var i=t.getClassName(),n=i.substr(i.indexOf(\".\")+1)+\"UI\",s=R.vector[n];s&&(e=new s(this,t))}e&&(this._elementUIMap[t.getId()]=e)}return this._invalidateMap&&(this._invalidateMap[t._id]=t),e},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(t){if(!t)throw\"ElementUIFunction can not be null\";if(this._elementUIFunction!==t){var e=this._elementUIFunction;this._elementUIFunction=t,this.firePropertyChange(\"elementUIFunction\",e,t),this._box.isEmpty()||(this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize())}},invalidateElementUI:function(t,e){if(!this._invalidateAll){this._invalidateMap[t._id]=t;this.getElementUI(t);if(t instanceof Pe){var i=t.getAgentLinks();null!=i&&i.forEach(this.invalidateElementUI,this);var n=t.getParent();n instanceof R.Group&&this.invalidateElementUI(n)}this.invalidateElementVisibility()}},invalidateElementUIs:function(t){this._invalidateAll=!0,this._invalidateMap={},this._visibleMap={},this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.invalidate()},invalidateSelectedElementUIs:function(t){this.getSelectionModel().getSelection().forEach(function(e){this.invalidateElementUI(e,t)},this)},invalidateBundleLink:function(t){if(t instanceof R.Link&&t._bundleLinks){var e=this._elementUIMap;t._bundleLinks.forEachSiblingLink(function(i){if(i!==t){var n=e[i._id];n&&n.invalidate(!1)}},this)}},customPaint:function(t,e){},paintRoot:function(t){var e=this._rootCanvas.getContext(\"2d\");e.save();var i=this.getGraphicsZoom(),n=window.devicePixelRatio,s=t.x*i-this.viewRect.x,o=t.y*i-this.viewRect.y,r=t.width*i,a=t.height*i;s=Math.floor(s*n)/n,o=Math.floor(o*n)/n,r=Math.ceil(r*n)/n,a=Math.ceil(a*n)/n,e.beginPath(),e.rect(s,o,r,a),e.clip(),e.clearRect(s,o,r,a),this.visibleList=new R.List,this._topAttachmentList=new R.List,ne.draw(e,this);var h=this.getElementBox().getDatas()._as,l=h.length;this.zoomManager._zoomGraphicsBegin(e),this.paintBottom(e,t);var c,d,u,_,g=this._box._layerBox,f=(i=this.getGraphicsZoom(),{x:this.viewRect.x/i,y:this.viewRect.y/i,width:this.viewRect.width/i,height:this.viewRect.height/i});if(this.adjustLinkIndex(),1===g.size())for(c=0;c<l;c++)d=h[c],this._visibleMap[d._id]?(u=this._elementUIMap[d._id],this._debug&&Y.strokeRect(e,t,\"red\"),null!=u&&this._isInView(u,t)&&(u.paint(e),u.setAttachmentVisible&&u.setAttachmentVisible(!0)),null!=u&&W.intersects(f,u.getZoomViewRect())?u.setAttachmentVisible&&u.setAttachmentVisible(!0):u.setAttachmentVisible&&u.setAttachmentVisible(!1),this.visibleList.add(d)):(u=this._elementUIMap[d._id])&&u.setAttachmentVisible&&u.setAttachmentVisible(!1);else g.forEachByDepthFirst(function(i){for(c=0;c<l;c++)d=h[c],g.getLayerByElement(d)===i&&this._visibleMap[d._id]?(null!=(u=this._elementUIMap[d._id])&&this._isInView(u,t)&&(u.paint(e),u.setAttachmentVisible&&u.setAttachmentVisible(!0)),null!=u&&W.intersects(f,u.getZoomViewRect())?u.setAttachmentVisible&&u.setAttachmentVisible(!0):u.setAttachmentVisible&&u.setAttachmentVisible(!1),u&&u.validateZIndex&&u.validateZIndex(g.getDatas().indexOf(i)),this.visibleList.add(d)):u=this._elementUIMap[d._id]},null,this);for(l=this._topAttachmentList.size(),c=0;c<l;c++)(_=this._topAttachmentList.get(c)).getElementUI().paintAttachment(e,_);if(this.customPaint(e,t),this.paintTop(e,t),void 0!==this._xyz){var v=this._xyz,m=v.markText,p=v.type,w=(v.expired,v.innerHTML),y=0,A=0,x=this.viewRect;e.translate(this.viewRect.x/this.getZoom(),this.viewRect.y/this.getZoom()),e.scale(1/this.getZoom(),1/this.getZoom());i=this.getZoom();void 0!=m&&null!=m&&\"\"!=m||\"2\"==p?(e.font=\"15px Arial sans-serif\",l=D.g.getTextSize(e.font,w),e.fillStyle=\"red\",y=x.width-l.width,A=x.height-20):(e.font=\"10px Arial sans-serif\",l=D.g.getTextSize(e.font,w),y=x.width/2-l.width/2,A=x.height/2),e.fillText(w,y,A)}e.restore(),this._invalidateMap={},this._invalidateAll=!1,this._paintAll=!1,this._dirtyRects=new oe},adjustLinkIndex:function(){var t,e,n=this._box.getDatas()._as;if(this.hasEditInteraction()){for(this._hasAdjustedLinks=!1,i=n.length-1;i>-1;i--)if((t=n[i])instanceof R.Link)if(this.isEditable(t)&&this.getElementUI(t).isEditable()&&this.isSelected(t))e=this._box.getDatas().indexOf(t),this._box.getDatas().removeAt(e),this._box.getDatas().add(t),this._hasAdjustedLinks=!0;else{var s=t.getToNode();e=this._box.getDatas().indexOf(s),this._box.getDatas().removeAt(e),this._box.getDatas().add(s);var o=t.getFromNode();e=this._box.getDatas().indexOf(o),this._box.getDatas().removeAt(e),this._box.getDatas().add(o)}}else if(this._hasAdjustedLinks){for(i=n.length-1;i>-1;i--)if((t=n[i])instanceof R.Link){s=t.getToNode();e=this._box.getDatas().indexOf(s),this._box.getDatas().removeAt(e),this._box.getDatas().add(s);o=t.getFromNode();e=this._box.getDatas().indexOf(o),this._box.getDatas().removeAt(e),this._box.getDatas().add(o)}this._hasAdjustedLinks=!1}},paintBottom:function(t,e){},paintTop:function(t,e){},_isInView:function(t,e){return W.intersects(e,t.getZoomViewRect())},paintTopCanvas:function(){var t=this._topCanvas.getContext(\"2d\");t.clearRect(0,0,this._topCanvas.width,this._topCanvas.height),this.paintMarker(t)},paintMarker:function(t){for(var e=this.markerList.size(),i=0;i<e;i++){this.markerList.get(i).paint(t)}},getLayerByElement:function(t){return this._box.getLayerBox().getLayerByElement(t)},getLogicalPoint2:function(t){return this.zoomManager._getLogicalPoint(t)},getLogicalPoint:function(t){return this.zoomManager._getLogicalPoint(t,!0)},getElementAt:function(t){if(null==this.visibleList)return null;var e;if(t.target?e=this.getLogicalPoint2(t):t.event?t.event.target&&(e=this.getLogicalPoint2(t.event)):e=t,null!=this._hitTestTopAttachmentList)for(var i=this._hitTestTopAttachmentList.size()-1;i>=0;i--){var n=this._hitTestTopAttachmentList.get(i);if(n.hit(e.x,e.y)&&this.isVisible(n.getElement()))return n.getElement()}if(null!=this.visibleList)for(var s=this.visibleList.size()-1;s>=0;s--){var o=this.visibleList.get(s),r=this.getElementUI(o);if(r&&r.hit(e.x,e.y))return o}return null},getElementsAt:function(t){var e=new R.List;if(null==this.visibleList)return null;var i;if(t.target?i=this.getLogicalPoint2(t):t.event?t.event.target&&(i=this.getLogicalPoint2(t.event)):i=t,null!=this._hitTestTopAttachmentList)for(var n=this._hitTestTopAttachmentList.size()-1;n>=0;n--){var s=this._hitTestTopAttachmentList.get(n);s.hit(i.x,i.y)&&this.isVisible(s.getElement())&&e.add(s.getElement())}if(null!=this.visibleList)for(var o=this.visibleList.size()-1;o>=0;o--){var r=this.visibleList.get(o),a=this.getElementUI(r);a&&a.hit(i.x,i.y)&&e.add(r)}return e},hitTest:function(t){var e=this.getElementAt(t);if(!e)return null;var i=this.getElementUI(e);if(!i)return null;var n;return n=t.target?this.getLogicalPoint2(t):t.event?this.getLogicalPoint2(t.event):t,i.hitTest(n.x,n.y)},getElementsAtRect:function(t,e,i,n){var s=new R.List;if(null==this.visibleList)return s;n=void 0===n||n;for(var o=this.visibleList.size()-1;o>=0;o--){var r=this.visibleList.get(o),a=this.getElementUI(r);a&&(!i||i(a._element))&&(n&&this.isSelectable(a._element)||!n)&&(e?a.intersects(t)&&s.add(r):W.contains(t,a.getZoomViewRect(at))&&s.add(r))}return s},getPosition:function(t,e,i,n,s,o){var r,a=e instanceof R.vector.ElementUI?e:this.getElementUI(e);if(a)if(\"from\"===t||\"to\"===t){if(a.getFromPosition&&(r=\"from\"===t?a.getFromPosition(n,s):a.getToPosition(n,s)))return i?{x:r.x-i.width/2,y:r.y-i.height/2}:r}else r=\"hotspot\"===t?o?a.getZoomHotSpot(this.zoomManager):a.getHotSpot():G.get(t,o?a.getZoomBodyRect():a.getBodyRect(),i);if(!r&&e.getRect&&(r=G.get(t,e.getRect(),i)),r)return{x:r.x+n,y:r.y+s};throw\"position '\"+t+\"' object '\"+e+\"'\"},isValidEvent:function(t){if(!t)return!1;var e,i;if(t.currentTarget===this._view){if(V.isFirefox?(e=t.layerX,i=t.layerY):(e=t.offsetX,i=t.offsetY),1==this.isHScrollBarVisible()&&i>=this.viewRect.height-this.getScrollBarWidth())return!1;if(1==this.isVScrollBarVisible()&&e>=this.viewRect.width-this.getScrollBarWidth())return!1}return!0},addMarker:function(t){this.markerList.add(t),this.repaintTopCanvas()},removeMarker:function(t){this.markerList.remove(t),this.repaintTopCanvas()},clearMarker:function(){this.markerList.clear(),this.repaintTopCanvas()},isMovable:function(t){return!!this._box.contains(t)&&(!!t.isMovable()&&(!(this._movableFunction&&!this._movableFunction(t))&&this.getLayerByElement(t).isMovable()))},hasMovableSelectedElements:function(){for(var t=this.getSelectionModel().getSelection(),e=0;e<t.size();e++){var i=t.get(e);if(this.isMovable(i))return!0}return!1},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(t){return this.isMovable(t)},this)},moveSelectedElements:function(t,e,i,n){if(0!==t||0!==e){var s=this.getMovableSelectedElementsRect();null!=s&&(this._limitElementInPositiveLocation&&(s.x+t<0&&(t=-s.x),s.y+e<0&&(e=-s.y)),R.Util.moveElements(this.getMovableSelectedElements(),t,e,i,n,this))}},getMovableSelectedElementsRect:function(){var t=this.getMovableSelectedElements();if(0===t.size())return null;for(var e=null,i=0,n=t.size();i<n;i++){var s=t.get(i);if(s instanceof Pe){var o=this.getElementUI(s);o&&(e=W.unionRect(e,o.getViewRect()))}}return e},isVisibleAttachment:function(t){return!this.state.zooming&&!this.state.panning&&!this.state.layouting},isVisible:function(t,e,i){if(!this._box.contains(t))return!1;if(!t.isVisible())return!1;if(3!==arguments.length&&(e=this._visibleFunction),e&&!e(t))return!1;if(!(i||this._box._layerBox.getLayerByElement(t))._visible)return!1;if(vt.getSubNetwork(t)!==this._currentSubNetwork)return!1;if(!this.zoomManager.isElementVisible(t))return!1;if(t instanceof R.Link){if(!this._noAgentLinkVisible){if(!t._fromAgent||!t._toAgent)return!1;if(!this.isVisible(t._fromAgent,e,i)||!this.isVisible(t._toAgent,e,i))return!1}if(t.getBundleIndex()>0&&t.getBundleCount()>1&&!t.getStyle(\"link.bundle.expanded\"))return!1}else for(var n=t._parent;n&&!n.ISubNetwork;){if(n instanceof R.Group&&(!n.isExpanded()||!this.isVisible(n,e,i)))return!1;n=n._parent}return!t.IDummy},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(t){var e=this._visibleFunction;this._visibleFunction=t,this.firePropertyChange(\"visibleFunction\",e,t),this.invalidateElementVisibility()},isEditable:function(t){return!!this._box.contains(t)&&(!(this._editableFunction&&!this._editableFunction(t))&&this.getLayerByElement(t).isEditable())},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(t){var e=this._editableFunction;this._editableFunction=t,this.firePropertyChange(\"editableFunction\",e,t),this.invalidateSelectedElementUIs(!0)},isRotatable:function(t){return!(this._rotatableFunction&&!this._rotatableFunction(t))},getRotatableFunction:function(){return this._rotatableFunction},setRotatableFunction:function(t){var e=this._rotatableFunction;this._rotatableFunction=t,this.firePropertyChange(\"rotatableFunction\",e,t),this.invalidateSelectedElementUIs(!0)},isLinkable:function(t,e){return null==this._linkableFunction||this._linkableFunction(t,e)},getLinkableFunction:function(){return this._linkableFunction},setLinkableFunction:function(t){var e=this._linkableFunction;this._linkableFunction=t,this.firePropertyChange(\"linkableFunction\",e,t),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getShadowColor:function(t){var e=t.getStyle(\"shadow.color\");return!e&&this.isSelected(t)&&\"shadow\"===t.getStyle(\"select.style\")?t.getStyle(\"select.color\"):e},getSelectColor:function(t){return t.getStyle(\"select.color\")},getAlarmLabel:function(t){var e=t.getAlarmState().getHighestNewAlarmSeverity();if(e){var i=t.getAlarmState().getNewAlarmCount(e)+e.nickName;return t.getAlarmState().hasLessSevereNewAlarms()&&(i+=\"+\"),i}return null},getLinkHandlerLabel:function(t){return t.isBundleAgent()?\"+(\"+t.getBundleCount()+\")\":null},setInteractions:function(t){var e=this._interactions;e&&e.forEach(function(t){t.tearDown()}),this._interactions=t,t&&t.forEach(function(t){t.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange(\"interactions\",e,t)},getInteractions:function(){return this._interactions},setDefaultInteractions:function(t,e){var i=[new R.vector.interaction.DefaultInteraction(this,t)];e&&i.push(new R.vector.interaction.MoveLinkInteraction(this,t)),this.setInteractions(i)},setTouchInteractions:function(){this.setInteractions([new R.vector.interaction.DefaultInteraction(this,!1),new R.vector.interaction.TouchInteraction(this)])},setMSTouchInteractions:function(){this.setInteractions([new R.vector.interaction.MSTouchInteraction(this)])},setEditInteractions:function(t,e){var i=[new R.vector.interaction.EditInteraction(this,t),new R.vector.interaction.DefaultInteraction(this)];e&&i.push(new R.vector.interaction.MoveLinkInteraction(this,t)),this.setInteractions(i)},setCreateElementInteractions:function(t){this.setInteractions([new R.vector.interaction.CreateElementInteraction(this,t),new R.vector.interaction.DefaultInteraction(this)])},setCreateLinkInteractions:function(t){this.setInteractions([new R.vector.interaction.CreateLinkInteraction(this,t),new R.vector.interaction.DefaultInteraction(this)])},setCreateShapeLinkInteractions:function(t){this.setInteractions([new R.vector.interaction.CreateShapeLinkInteraction(this,t),new R.vector.interaction.DefaultInteraction(this)])},setCreateShapeNodeInteractions:function(t){this.setInteractions([new R.vector.interaction.CreateShapeNodeInteraction(this,t),new R.vector.interaction.DefaultInteraction(this)])},setMagnifyInteractions:function(){this.setInteractions([new R.vector.interaction.DefaultInteraction(this),new R.vector.interaction.MagnifyInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(t){var e=this._hasEditInteraction;this._hasEditInteraction=t,this.firePropertyChange(\"hasEditInteraction\",e,t)},addElementByInteraction:function(t){t.getParent()||t.setParent(this._currentSubNetwork),this._box.add(t),this.getSelectionModel().setSelection(t),this.fireInteractionEvent({kind:\"createElement\",element:t})},getToolTip:function(t){if(t){var e=t.getToolTip();return e||t.getName()}return null},isToolTipEnabled:function(){return!!this._toolTipEnabled},setToolTipEnabled:function(t){if(this._toolTipEnabled=t,t){if(!this._toolTipListener){var e=this;this._toolTipListener=function(t){if(e.isMovingElement())xt.hideToolTip();else{var i=e.getElementAt(t);if(e._preElement!==i)if(e._preElement=i,i){var n=e.getToolTip(i);xt.showToolTip({x:t.pageX,y:t.pageY},n,function(t){var i=e._view.getBoundingClientRect(),n=t.getBoundingClientRect();n.width+n.left>i.width+i.left&&(t.style.left=i.width+i.left-n.width+(z.documentElement.scrollLeft||z.body.scrollLeft)+\"px\"),n.height+n.top>i.height+i.top&&(t.style.top=i.height+i.top-n.height+(z.documentElement.scrollTop||z.body.scrollTop)+\"px\")})}else xt.hideToolTip()}},this._view.addEventListener(\"mousemove\",this._toolTipListener,!1),this.firePropertyChange(\"toolTipEnabled\",!1,!0)}}else this._toolTipListener&&(xt.hideToolTip(),this._view.removeEventListener(\"mousemove\",this._toolTipListener,!1),delete this._toolTipListener,this.firePropertyChange(\"toolTipEnabled\",!0,!1))},setZoom:function(t,e){if(t=this.checkZoom(t),this.isAsyncZoomAndViewRect())var i=this._zoomMap[this._currentSubNetwork].zoom;else i=this._zoom;if(t!=i){var n=this.getViewRect();e||(e={x:n.width/2,y:n.height/2});var s=this.viewRect,o=e.x-(e.x+s.x)*t/i,r=e.y-(e.y+s.y)*t/i;this.isAsyncZoomAndViewRect()?this._zoomMap[this._currentSubNetwork].zoom=t:this._zoom=t,this._paintAll=!0,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.zoomManager._invalidateZoom(),this.setViewRect(-o,-r,this.viewRect.width,this.viewRect.height),this._asyncZoomAndViewRect?this.firePropertyChange(\"zoom\",i,this._zoomMap[this._currentSubNetwork].zoom):this.firePropertyChange(\"zoom\",i,this._zoom),this.state.zooming=!0;var a=null,h=this;a?clearTimeout(a):a=setTimeout(function(){a=null,h.state.zooming=!1,h.invalidateElementUIs(!0)},100)}},getZoom:function(){if(this.isAsyncZoomAndViewRect()){return this._zoomMap[this._currentSubNetwork]||(this._zoomMap[this._currentSubNetwork]={zoom:1}),this._zoomMap[this._currentSubNetwork].zoom}return this._zoom},getSizeZoom:function(t){return this.zoomManager.getSizeZoom(t)},getLocationZoom:function(){return this.zoomManager.getLocationZoom()},getGraphicsZoom:function(){return this.zoomManager.getGraphicsZoom()},zoomOverview:function(t){if(!(this._unionBounds.width<=0||this._unionBounds.width<=0)){var e=this.getZoom(),i=this._unionBounds,n=i.width/e,s=i.height/e,o=this.viewRect.width/n,r=this.viewRect.height/s,a=Math.min(o,r);this.setZoom(a);var h=this.getZoom(),l=this.viewRect.width/2-this._unionBounds.width/2*h/e,c=this.viewRect.height/2-this._unionBounds.height/2*h/e;if(this.setViewRect(this._unionBounds.x*h/e-l,this._unionBounds.y*h/e-c,this.viewRect.width,this.viewRect.height),1!=this.getLocationZoom()){var d=null==arguments[1]?5:arguments[1];if(d>0){d--;var u=this;setTimeout(function(){u.zoomOverview(t,d)},25)}}}},zoomReset:function(t){this.setZoom(1,t)},zoomIn:function(t){this.setZoom(1.2*this.getZoom(),t)},zoomOut:function(t){this.setZoom(this.getZoom()/1.2,t)},upSubNetwork:function(t,e){this._currentSubNetwork&&this.setCurrentSubNetwork(vt.getSubNetwork(this._currentSubNetwork),t,e)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(t,e,i){if(R.animate.AnimateManager.endAnimate(),e){if(this._currentSubNetwork===t)return;if(t&&!this._box.contains(t))throw t+\" is not contained in this network's elementBox\";var n=new R.animate.AnimateSubNetwork(this,t,i);R.animate.AnimateManager.start(n)}else this._setCurrentSubNetwork(t),i&&i()},_setCurrentSubNetwork:function(t){if(this._currentSubNetwork!==t){if(t&&!this._box.contains(t))throw t+\" is not contained in this network's elementBox\";if(this.isAsyncZoomAndViewRect()){var e=this._viewRectMap[this._currentSubNetwork];this._viewRectMap[this._currentSubNetwork]=e?this.viewRect:this.viewRect?this.viewRect:{x:0,y:0,width:this.viewRect.width,height:this.viewRect.height}}var i=this._currentSubNetwork;if(this._currentSubNetwork=t,this.firePropertyChange(\"currentSubNetwork\",i,t),this.isAsyncZoomAndViewRect()){this._viewRectMap[this._currentSubNetwork]||(this._viewRectMap[this._currentSubNetwork]={x:0,y:0,width:this.viewRect.width,height:this.viewRect.height});e=this._viewRectMap[this._currentSubNetwork];this.setViewRect(e.x,e.y,e.width,e.height),this.invalidateElementUIs()}this.invalidateElementVisibility(),this.invalidateCanvasSize(),this._paintAll=!0}},makeVisible:function(t){var e=this.getElementUI(t);if(e){var i=vt.getSubNetwork(t);if(i===this._currentSubNetwork){for(var n=t;(n=n.getParent())&&n!==i;)n instanceof R.Group&&n.setExpanded(!0);var s=e.getViewRect();if(s){var o,r=e.getZoomViewRect(this.zoomManager);o=s.x==r.x&&s.y==r.y&&s.width==r.width&&s.height==r.height?{x:s.x*this.getGraphicsZoom(),y:s.y*this.getGraphicsZoom(),width:s.width*this.getGraphicsZoom(),height:s.height*this.getGraphicsZoom()}:r,W.intersects(this.viewRect,o)||this.isVisible(t)&&D.callLater(this.centerByLogicalPoint,this,[o.x+o.width/2,o.y+o.height/2])}}else{var a=this;this.setCurrentSubNetwork(i,this.isSubNetworkAnimate(),function(){D.callLater(a.makeVisible,a,[t])})}}},centerByLogicalPoint:function(t,e,i){var n=t-this.viewRect.width/2,s=e-this.viewRect.height/2;this.setViewRect(n,s,this.viewRect.width,this.viewRect.height)},panByOffset:function(t,e){this.setViewOffSet(t,e)},getIconsNames:function(t){return t.getStyle(\"icons.names\")},getIconsColors:function(t){return t.getStyle(\"icons.colors\")},getLinkFlowStepping:function(t){var e=parseInt(t.getStyle(\"link.flow.stepping\"));return e||(e=xe.NETWORK_LINK_FLOW_STEPPING),e},getLinkFlowOffset:function(t){var e=t.getStyle(\"link.flow.offset\");return isNaN(e)&&(e=0),e+this.getLinkFlowStepping(t)},toCanvas:function(t,e,i,n,s,o){i||(i=X.createCanvas()),i.setAttribute(\"width\",t),i.setAttribute(\"height\",e),i._viewRect?(i._viewRect.width=t,i._viewRect.height=e):i._viewRect={x:0,y:0,width:t,height:e};var r=i.getContext(\"2d\");if(r.translate(-s,-o),r.clearRect(0,0,t,e),ne.draw(r,this),0===this._view.clientWidth||0===this._view.clientHeight)return i;this.realWidth,this.getGraphicsZoom(),this.realHeight,this.getGraphicsZoom();r.scale(n,n);var a=this.getElementBox().getDatas()._as,h=a.length;this._topAttachmentList=new R.List;var l,c,d,u,_,g,f=this.getElementBox().getLayerBox(),v=f.getRoots(),m=v.size();if(this.adjustLinkIndex(),1===m)for(d=0;d<h;d++)u=a[d],this._visibleMap[u._id]&&null!=(_=this._elementUIMap[u._id])&&_.paint(r);else for(l=0;l<m;l++)for(c=v.get(l),d=0;d<h;d++)u=a[d],f.getLayerByElement(u)===c&&this._visibleMap[u._id]&&null!=(_=this._elementUIMap[u._id])&&_.paint(r);for(h=this._topAttachmentList.size(),d=0;d<h;d++)(g=this._topAttachmentList.get(d)).getElementUI().paintAttachment(r,g);return i},toCanvasByRegion:function(t,e,i){i||(i=X.createCanvas());var n=t.width*e,s=t.height*e;i.setAttribute(\"width\",n),i.setAttribute(\"height\",s),i._viewRect?(i._viewRect.width=n,i._viewRect.height=s):i._viewRect={x:0,y:0,width:n,height:s};var o=i.getContext(\"2d\");if(o.clearRect(0,0,n,s),ne.draw(o,this),0===this._view.clientWidth||0===this._view.clientHeight)return i;o.save(),o.scale(e,e),o.beginPath(),o.translate(-t.x,-t.y);var r=this.getElementBox().getDatas()._as,a=r.length;this._topAttachmentList=new R.List;var h,l,c,d,u,_,g=this.getElementBox().getLayerBox(),f=g.getRoots(),v=f.size();if(this.adjustLinkIndex(),1===v)for(c=0;c<a;c++)d=r[c],this._visibleMap[d._id]&&null!=(u=this._elementUIMap[d._id])&&W.intersects(t,u.getZoomViewRect())&&u.paint(o);else for(h=0;h<v;h++)for(l=f.get(h),c=0;c<a;c++)d=r[c],g.getLayerByElement(d)===l&&this._visibleMap[d._id]&&null!=(u=this._elementUIMap[d._id])&&W.intersects(t,u.getZoomViewRect())&&u.paint(o);for(a=this._topAttachmentList.size(),c=0;c<a;c++)(_=this._topAttachmentList.get(c)).getElementUI().paintAttachment(o,_);return o.restore(),i},getGroupChildrenRects:function(t){return this.zoomManager._getGroupChildrenRects(t)},convertPointFromView:function(t){return this.zoomManager._convertPointFromView(t)},getOffset:function(t,e){return this.zoomManager._getOffset(t,e)},panToCenter:function(){this.setViewRect((this.realWidth-this.viewRect.width)/2,(this.realHeight-this.viewRect.height)/2,this.viewRect.width,this.viewRect.height)},moveElementsToCenter:function(){if(this._limitViewInCanvas){var t=this.viewRect,e=this._unionBounds,i=t.x+t.width/2-e.x-e.width/2,n=t.y+t.height/2-e.y-e.height/2;R.Util.moveElements(this._box.toDatas(),i,n)}else{i=this.viewRect.width/2-this._unionBounds.width/2,n=this.viewRect.height/2-this._unionBounds.height/2;this.setViewRect(this._unionBounds.x-i,this._unionBounds.y-n,this.viewRect.width,this.viewRect.height)}},getLinkPathFunction:function(){return this._linkPathFunction},setLinkPathFunction:function(t){var e=this._linkPathFunction;this._linkPathFunction=t,this.firePropertyChange(\"linkPathFunction\",e,t),this.invalidateElementUIs()},invalidate:function(){this._invalidate||(this._invalidate=!0,this.fireViewEvent({kind:\"invalidate\"}))},validate:function(){this._invalidate&&(B||0!==this._view.offsetWidth||0!==this._view.offsetHeight)&&(this._invalidate=!1,this._isValidating=!0,this.fireViewEvent({kind:\"validateStart\"}),this.validateImpl(),this.fireViewEvent({kind:\"validateEnd\"}),this._isValidating=!1)},onClickElement:function(t,e){},onClickBackground:function(t){},onDoubleClickElement:function(t,e){},onDoubleClickBackground:function(t){},onLongClickElement:function(t,e){},onLongClickBackground:function(t){},onMouseMove:function(t,e){},onMouseEnter:function(t,e){},onMouseLeave:function(t,e){},setMovingElement:function(t){if(t!=this._movingElement){var e=this._movingElement;this._movingElement=t,this.firePropertyChange(\"movingElement\",e,t),this._box._undoManager._enabled&&(t?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}},setEditingElement:function(t){if(t!=this._editingElement){var e=this._editingElement;this._editingElement=t,this.firePropertyChange(\"editingElement\",e,t),this._box._undoManager._enabled&&(t?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}},dispose:function(){R.imageUtil.removeEventListener(this.invalidateElementUIs,this),this.setInteractions(null),cancelAnimationFrame(this._loopId)},handle_mousemove:function(t){var e=this.getElementAt(t),i=this.__preElement,n=Et(i),s=Et(e);i!==e&&(i&&(n&&n.onMouseLeave&&n.onMouseLeave(i,this),this.onMouseLeave(i,t)),e&&(s&&s.onMouseEnter&&s.onMouseEnter(e,this),this.onMouseEnter(e,t))),e&&s&&s.onMouseMove&&s.onMouseMove(e,this),this.onMouseMove(e,t),this.__preElement=e}}),R.vector.Overview=function(t){R.vector.Overview.superClass.constructor.apply(this,t),this._view=X.createView(),this._rootDiv=X.createDiv(),this._imageCanvas=X.createCanvas(),this._imageDiv=X.createDiv(),this._maskCanvas=X.createCanvas(),this._selectDiv=X.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,X.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this._exportImageCanvas=X.createCanvas(),this._imageCtx=this._imageCanvas.getContext(\"2d\"),this.setNetwork(t),V.isTouchable?V.isMSTouchable?new R.vector.OverviewMSTouchInteraction(this):(new R.vector.OverviewTouchInteraction(this),new R.vector.OverviewInteraction(this)):new R.vector.OverviewInteraction(this)},D.ext(\"twaver.vector.Overview\",R.controls.ControlBase,{__accessor:[\"fillColor\",\"outlineColor\",\"outlineWidth\",\"selectColor\",\"selectWidth\",\"padding\",\"maxPackingWidth\",\"maxPackingHeight\"],__bool:[\"animate\"],_fillColor:xe.OVERVIEW_FILL_COLOR,_outlineColor:xe.OVERVIEW_OUTLINE_COLOR,_outlineWidth:xe.OVERVIEW_OUTLINE_WIDTH,_selectColor:xe.OVERVIEW_SELECT_COLOR,_selectWidth:xe.OVERVIEW_SELECT_WIDTH,_padding:xe.OVERVIEW_PADDING,_animate:xe.OVERVIEW_ANIMATE,_maxPackingWidth:xe.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:xe.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(t){this._invalidateMask()},setNetwork:function(t){t!==this._network&&(this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),X.removeEventListener(\"scroll\",\"_handleScrollChange\",this._network.getView(),this)),this._network=t,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),X.addEventListener(\"scroll\",\"_handleScrollChange\",this._network.getView(),this)),this.invalidate())},_handleNetworkPropertyChange:function(t){\"zoom\"!==t.property&&\"currentSubNetwork\"!==t.property&&\"elementBox\"!==t.property&&\"dataBox\"!==t.property&&\"canvasSizeChange\"!==t.property||this.invalidate()},_handleNetworkViewChange:function(t){\"validateEnd\"===t.kind&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(t){this._isNetworkDirty&&this._isMaskDirty||(this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),D.callLater(this.validate,this,null,t))},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,D.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&0!==this._network.getViewRect().width&&0!==this._network.getViewRect().height&&!this._network._invalidate){var t,e=this._maxPackingWidth>0&&this._maxPackingHeight>0;t=e?{x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:{x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},W.grow(t,-this._padding,-this._padding),e&&(X.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),t.width=this._imageDiv._viewRect.width,t.height=this._imageDiv._viewRect.height);var i=this._network.getGraphicsZoom(),n=this._network._unionBounds;n={x:(n=W.unionRect(n,{x:0,y:0,width:n.x,height:n.y})).x/i,y:n.y/i,width:n.width/i,height:n.height/i};var s=this._network.viewRect.x/i,o=this._network.viewRect.y/i,r=this._network.viewRect.width/i,a=this._network.viewRect.height/i,h=n,l=Math.min(t.width/h.width,t.height/h.height),c=h.width*l,d=h.height*l,u=h.width*l,_=h.height*l,g=t.x+(t.width-u)/2,f=t.y+(t.height-_)/2;if(this._isNetworkDirty){var v={x:g,y:f,width:u,height:_};this._network.toCanvas(c,d,this._exportImageCanvas,l,h.x*l,h.y*l),this._imageCanvas.setAttribute(\"width\",u),this._imageCanvas.setAttribute(\"height\",_),this._imageCtx.drawImage(this._exportImageCanvas,0,0,c,d),X.setDiv(this._imageDiv,v,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle(\"background.color\")||\"\"),this._isNetworkDirty=!1}if(this._isMaskDirty){var m={x:(s-h.x)*l,y:(o-h.y)*l,width:r*l,height:a*l},p=X.setCanvas(this._maskCanvas,g,f,u,_);p.lineWidth=0,p.fillStyle=this._fillColor,Y.drawVector(p,\"rectangle\",null,g,f,u,_),p.closePath(),p.fill(),p.stroke(),p.clearRect(g+m.x,f+m.y,m.width,m.height),p.lineWidth=this._outlineWidth,p.strokeStyle=this._outlineColor;var w=m.width-2*this._outlineWidth,y=m.height-2*this._outlineWidth;w=Math.min(w,u-2-m.x-this._outlineWidth),y=Math.min(y,_-2-m.y-this._outlineWidth),Y.drawVector(p,\"rectangle\",null,g+m.x+this._outlineWidth,f+m.y+this._outlineWidth,w,y),p.closePath(),p.stroke(),this._isMaskDirty=!1}}else this._isNetworkDirty=!1,this._isMaskDirty=!1},getLogicalPoint:function(t){return X.getLogicalPoint(this._view,t,1,this._rootDiv)},centerNetwork:function(t,e){var i=this._imageDiv._viewRect;if(W.containsPoint(i,t)){var n=this._network.getGraphicsZoom(),s=this._network._unionBounds;s={x:(s=W.unionRect(s,{x:0,y:0,width:s.x,height:s.y})).x/n,y:s.y/n,width:s.width/n,height:s.height/n};var o={x:this._network.viewRect.x/n,y:this._network.viewRect.y/n,width:this._network.viewRect.width/n,height:this._network.viewRect.height/n},r=W.unionRect(s,o);this._network.centerByLogicalPoint((r.x+(t.x-i.x)/i.width*r.width)*n,(r.y+(t.y-i.y)/i.height*r.height)*n,e),this._invalidateMask()}}}),R.vector.OverviewTouchInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,X.addEventListener(\"touchstart\",\"handleTouchstart\",this.view,this)},D.ext(\"twaver.vector.OverviewTouchInteraction\",Object,{handleTouchstart:function(t){X.preventDefault(t),this.clear(),this.endPoint=this.overview.getLogicalPoint(t),yt.isMultiTouch(t)&&(this.distance=yt.getDistance(t),this.zoom=this.network.getZoom()),X.addEventListener(\"touchmove\",\"handleTouchmove\",this.view,this),X.addEventListener(\"touchend\",\"handleTouchend\",this.view,this)},handleTouchmove:function(t){if(this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(t),yt.isSingleTouch(t))this.overview.centerNetwork(this.endPoint,!1);else if(this.distance){var e=yt.getDistance(t)/this.distance;this.network.setZoom(this.zoom*e,!1)}},handleTouchend:function(t){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(t);var e=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;e?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),e?D.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,X.removeEventListener(\"touchmove\",this.view,this),X.removeEventListener(\"touchend\",this.view,this)),this.moved=!1}}),R.vector.OverviewMSTouchInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,this._pointerMap={},this._pointerIdArray=[],X.addEventListener(\"MSPointerDown\",\"handleTouchstart\",this.view,this),X.addEventListener(\"MSPointerMove\",\"handleTouchmove\",this.view,this),X.addEventListener(\"MSPointerUp\",\"handleTouchend\",this.view,this),X.addEventListener(\"MSPointerCancel\",\"handleTouchend\",this.view,this)},D.ext(\"twaver.vector.OverviewMSTouchInteraction\",Object,{handleTouchstart:function(t){X.preventDefault(t),t.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[t.pointerId]&&this.overview.getLogicalPoint(t)&&(this._pointerIdArray.push(t.pointerId),this._pointerMap[t.pointerId]=t),1==this._pointerIdArray.length?(this._startTouchPoint=this.overview.getLogicalPoint(t),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(t){if(0!=this._pointerIdArray.length&&this._pointerMap[t.pointerId]&&!(W.getDistance({x:this._pointerMap[t.pointerId].pageX,y:this._pointerMap[t.pointerId].pageY},{x:t.pageX,y:t.pageY})<=10))if(this._pointerMap[t.pointerId]=t,2==this._pointerIdAr