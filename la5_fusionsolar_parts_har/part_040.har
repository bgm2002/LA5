axisTick:{show:!1},axisLine:C.re,axisLabel:{formatter:e=>(0,C.Lm)(t,e)},scale:!0,data:n,axisPointer:{type:\"shadow\"},boundaryGap:!0}],yAxis:(0,S.j2)(\"\",o),series:[{name:i,color:\"#69CEA1\",data:r,...C.MX}],backgroundColor:\"transparent\",unit:a}})(this.intlMessage,t,r,i)},this.exportRevenue=()=>{const{period:e,currentYear:t,currentMonth:n}=this.state,r=\"month\"===e?s()(n):s()(t).year();nn.Z.exportRevenueInfo(this.props.stationDn,{year:0,lifetime:1,month:2}[e],r,this.setExportListModal,V.ji.PV_REVENUE)},this.setExportListModal=e=>{this.setState({showExportListModal:e})},this.renderChart=e=>{var t;if(!this.props.hasNewPrice)return(0,D.jsx)(Et.Z,{image:\"/pvmswebsite/assets/build/images/station/noData.png\",description:this.intlMessage(\"neteco.pvms.power.noPrice.businessSattion.detail.new\",{0:(0,D.jsx)(\"a\",{onClick:()=>(0,st.er)(this.state.stationDn,on.e.elecPriceEntry.entryType.BY_PLANT_BENEFIT_ANALYSIS),children:this.intlMessage(\"neteco.pvms.power.noPrice.businessSattion.detail.new.jump\")})})});const{loading:n,data:r}=this.state;return n?(0,D.jsx)(b.Z,{className:\"report-loading\",size:\"large\"}):null!=r&&null!==(t=r.xAxis)&&void 0!==t&&t.length?(0,D.jsxs)(\"div\",{className:\"charts-container\",children:[(0,D.jsx)(\"div\",{className:\"yAxis-name-area\",children:(0,D.jsx)(\"div\",{className:\"chart-title-unit\",children:e.unit})}),(0,D.jsx)(At.Z,{option:e,style:{width:\"100%\",height:\"100%\"}})]}):(0,D.jsx)(Et.Z,{image:\"/pvmswebsite/assets/build/images/station/noData.png\",description:this.intlMessage(\"neteco.pvms.noData\")})},this.state={period:\"year\",currentYear:s()().startOf(\"year\"),currentMonth:s()().startOf(\"month\"),current:s()(),data:{},stationDn:e.stationDn,showExportListModal:!1,loading:!1}}componentDidMount(){(0,v.lVp)(v.i$n)&&this.props.hasNewPrice&&this.getPvRevenue()}render(){const{period:e,currentMonth:t,currentYear:n,data:r}=this.state;return(0,D.jsxs)(\"div\",{className:\"nco-monitor-station-pv-revenue tab-content\",children:[(0,D.jsxs)(\"div\",{className:\"report-operation\",children:[(0,D.jsxs)(Fn,{children:[(0,D.jsx)(oe.Z,{type:\"month\"===e?\"primary\":\"default\",onClick:()=>{this.selectPeriodHandler(\"month\")},title:this.intlMessage(\"neteco.pvms.systemSetting.amendment.month\"),children:this.intlMessage(\"neteco.pvms.systemSetting.amendment.month\")}),(0,D.jsx)(oe.Z,{type:\"year\"===e?\"primary\":\"default\",onClick:()=>{this.selectPeriodHandler(\"year\")},title:this.intlMessage(\"neteco.pvms.systemSetting.amendment.year\"),children:this.intlMessage(\"neteco.pvms.systemSetting.amendment.year\")}),(0,D.jsx)(oe.Z,{type:\"lifetime\"===e?\"primary\":\"default\",onClick:()=>{this.selectPeriodHandler(\"lifetime\")},title:this.intlMessage(\"neteco.pvms.KPI.kpiView.lifelimit\"),children:this.intlMessage(\"neteco.pvms.KPI.kpiView.lifelimit\")})]}),(0,D.jsxs)(\"div\",{className:\"report-datetime\",children:[(0,D.jsx)(Ot.Z,{title:this.intlMessage(\"neteco.pvms.power.lastYear\"),className:\"datetime-arrow\",onClick:()=>this.forwardOrNextDate(-1)}),(0,D.jsx)(Dt.Z,{timeDimension:e,value:\"month\"===e?t:n,onChange:this.handTimeChange}),(0,D.jsx)(Mt.Z,{title:this.intlMessage(\"neteco.pvms.power.nextYear\"),className:\"datetime-arrow\",onClick:()=>this.forwardOrNextDate(1)})]}),(0,v.lVp)(v.ql_)&&(0,D.jsx)(oe.Z,{onClick:this.exportRevenue,children:(0,D.jsx)(gn.Z,{id:\"neteco.pvms.componentSetting.export\"})})]}),(0,D.jsxs)(\"div\",{className:\"echarts-list\",children:[(0,D.jsxs)(\"div\",{className:\"echarts pvIncome-content-echarts\",children:[(0,D.jsx)(\"div\",{className:\"chart-title\",children:this.intlMessage(\"neteco.pvms.station.revenue.key10\")}),this.renderChart(this.buildBenefitsOption(r.measureUnit))]}),(0,D.jsxs)(\"div\",{className:\"echarts pv-power-echarts\",children:[(0,D.jsx)(\"div\",{className:\"chart-title\",children:this.intlMessage(\"neteco.pvms.station.overview.chartLegend3\")}),this.renderChart(this.buildCapicityOption(this.intlMessage(\"neteco.pvms.unit.KWh\")))]})]}),(0,D.jsx)(vn.Z,{showExportListModal:this.state.showExportListModal,setExportListModal:this.setExportListModal,reportId:V.xL,exportOperation:v.ql_})]})}}const Hn=(0,o.ZP)(Vn),Un=e=>{const t=e(\"neteco.pvms.station.revenue.tip.allRevenue\"),n=e(\"neteco.pvms.smsrc.stationRevenue.tip.pvRevenue\"),r=e(\"neteco.pvms.smsrc.stationRevenue.tip.demandRevenue\"),i=e(\"neteco.pvms.smsrc.stationRevenue.tip.arbitrageRevenue\"),o=e(\"neteco.pvms.station.revenue.tip.allRevenue.noBenifit\"),a=e(\"neteco.pvms.smsrc.stationRevenue.tip.pvRevenue.noBenifit\"),s=e(\"neteco.pvms.smsrc.stationRevenue.tip.demandRevenue.noBenifit\"),l=e(\"neteco.pvms.smsrc.stationRevenue.tip.arbitrageRevenue.noBenifit\"),c=(0,ut.jA)()?e(\"neteco.pvms.aifc.revenueReport.CI.tit\"):e(\"neteco.pvms.aifc.revenueReport.no.china.CI.tit\");return{allRevenueTip:e(\"neteco.pvms.smsrc.stationRevenue.defaultTip\",{timePeriod:t}),allEmmaRevenueTip:e(\"neteco.pvms.smsrc.stationRevenue.EMMATip\",{timePeriod:t,AIName:c}),pvRevenueTip:n,demandRevenueTip:r,arbitrageRevenueTip:i,pvRevenue:e(\"neteco.pvms.smsrc.stationRevenue.defaultTip\",{timePeriod:n}),pvEmmaRevenue:e(\"neteco.pvms.smsrc.stationRevenue.EMMATip\",{timePeriod:n,AIName:c}),demandRevenue:e(\"neteco.pvms.smsrc.stationRevenue.defaultTip\",{timePeriod:r}),demandEmmaRevenue:e(\"neteco.pvms.smsrc.stationRevenue.EMMATip\",{timePeriod:r,AIName:c}),arbitrageRevenue:e(\"neteco.pvms.smsrc.stationRevenue.defaultTip\",{timePeriod:i}),arbitrageEmmaRevenue:e(\"neteco.pvms.smsrc.stationRevenue.EMMATip\",{timePeriod:i,AIName:c}),emmaRevenueRatioTip:e(\"neteco.pvms.smsrc.stationRevenue.legend.emmaIncreaseRatio\",{AIName:c}),allRevenueNoBenifitTip:e(\"neteco.pvms.smsrc.stationRevenue.defaultTip\",{timePeriod:o}),allEmmaRevenueNoBenifitTip:e(\"neteco.pvms.smsrc.stationRevenue.EMMATip\",{timePeriod:o,AIName:c}),pvRevenueNoBenifitTip:a,demandRevenueNoBenifitTip:s,arbitrageRevenueNoBenifitTip:l,pvRevenueNoBenifit:e(\"neteco.pvms.smsrc.stationRevenue.defaultTip\",{timePeriod:a}),pvEmmaRevenueNoBenifit:e(\"neteco.pvms.smsrc.stationRevenue.EMMATip\",{timePeriod:a,AIName:c}),demandRevenueNoBenifit:e(\"neteco.pvms.smsrc.stationRevenue.defaultTip\",{timePeriod:s}),demandEmmaRevenueNoBenifit:e(\"neteco.pvms.smsrc.stationRevenue.EMMATip\",{timePeriod:s,AIName:c}),arbitrageRevenueNoBenifit:e(\"neteco.pvms.smsrc.stationRevenue.defaultTip\",{timePeriod:l}),arbitrageEmmaRevenueNoBenifit:e(\"neteco.pvms.smsrc.stationRevenue.EMMATip\",{timePeriod:l,AIName:c})}};function Gn(e,t,n,r,i){return{name:t,color:n,stack:[\"default\",\"emma\"][r],yAxisIndex:i,data:(0,S.sD)(e),...C.MX}}function Yn(e,t,n){const{pvRevenueNoBenifit:r,demandRevenueNoBenifit:i,arbitrageRevenueNoBenifit:o,emmaRevenueRatioTip:a,arbitrageEmmaRevenueNoBenifit:s,demandEmmaRevenueNoBenifit:l,pvEmmaRevenueNoBenifit:c}=Un(t);return[!n&&{name:r,icon:\"circle\"},e&&{name:i,icon:\"circle\"},{name:o,icon:\"circle\"},!n&&{name:c,icon:\"circle\"},e&&{name:l,icon:\"circle\"},{name:s,icon:\"circle\"},{name:a,icon:S.qz}]}function Wn(e,t,n,r){const{pvRevenueNoBenifit:i,demandRevenueNoBenifit:o,arbitrageRevenueNoBenifit:a,emmaRevenueRatioTip:s,arbitrageEmmaRevenueNoBenifit:l,demandEmmaRevenueNoBenifit:c,pvEmmaRevenueNoBenifit:u}=Un(n);return[{...Gn(e.std_peakVallyRevenue,a,\"#0A59F7\",0,0)},t&&{...Gn(e.std_demandRevenue,o,\"#5990FD\",0,0)},!r&&{...Gn(e.std_pvRevenue,i,\"#BBDAFD\",0,0)},{...Gn(e.ai_peakVallyRevenue,l,\"#2DA769\",1,0)},t&&{...Gn(e.ai_demandRevenue,c,\"#6ACA94\",1,0)},!r&&{...Gn(e.ai_pvRevenue,u,\"#BAEDCD\",1,0)},{name:s,type:\"line\",color:\"#ECB613\",yAxisIndex:1,data:(0,S.sD)(e.emmaRevenueRatio)}]}const Kn=e=>{const t=e(\"neteco.pvms.smsrc.stationRevenue.demand.tip\"),n=(0,ut.jA)()?e(\"neteco.pvms.aifc.revenueReport.CI.tit\"):e(\"neteco.pvms.aifc.revenueReport.no.china.CI.tit\");return{demand:e(\"neteco.pvms.smsrc.stationRevenue.defaultTip\",{timePeriod:t}),emmaDemand:e(\"neteco.pvms.smsrc.stationRevenue.EMMATip\",{timePeriod:t,AIName:n}),demandIncrease:e(\"neteco.pvms.smsrc.stationRevenue.legend.demandRevenueIncrease\")}};function qn(e,t){const{std_demandValue:n,ai_demandValue:r,revenue:i}=e,{demand:o,emmaDemand:a,demandIncrease:s}=Kn(t);return[n.length>0&&{name:o,color:\"#5990FD\",yAxisIndex:1,data:(0,S.sD)(n),...C.MX},r.length>0&&{name:a,color:\"#6ACA94\",yAxisIndex:1,data:(0,S.sD)(r),...C.MX},{name:s,type:\"line\",color:\"#FDD42E\",yAxisIndex:0,data:(0,S.sD)(i)}]}function Qn(e,t){const{stdData:n,aiData:r}=t,i=[],o=(0,ut.jA)()?e(\"neteco.pvms.aifc.revenueReport.CI.tit\"):e(\"neteco.pvms.aifc.revenueReport.no.china.CI.tit\");for(let t=0;t<n.length;t++)i.push({name:1===n.length&&\"\"===n[t].name?e(\"neteco.pvms.smsrc.stationRevenue.plain.defaultTip\"):e(\"neteco.pvms.smsrc.stationRevenue.defaultTip\",{timePeriod:n[t].name}),icon:\"circle\"});for(let t=0;t<r.length;t++)i.push({name:1===r.length&&\"\"===r[t].name?o:e(\"neteco.pvms.smsrc.stationRevenue.EMMATip\",{timePeriod:r[t].name,AIName:o}),icon:\"circle\"});return i.push({name:e(\"neteco.pvms.smsrc.stationRevenue.tip.arbitrageRevenue\"),icon:S.qz}),i}function Xn(e,t){const{revenue:n,stdData:r,aiData:i}=e,o=[],a=(0,ut.jA)()?t(\"neteco.pvms.aifc.revenueReport.CI.tit\"):t(\"neteco.pvms.aifc.revenueReport.no.china.CI.tit\");for(let e=r.length-1;e>=0;e--)o.push({...Gn(r[e].data,1===r.length&&\"\"===r[e].name?t(\"neteco.pvms.smsrc.stationRevenue.plain.defaultTip\"):t(\"neteco.pvms.smsrc.stationRevenue.defaultTip\",{timePeriod:r[e].name}),Lt.Xe[r.length-1][e],0,1)});for(let e=i.length-1;e>=0;e--)o.push({...Gn(i[e].data,1===i.length&&\"\"===i[e].name?a:t(\"neteco.pvms.smsrc.stationRevenue.EMMATip\",{timePeriod:i[e].name,AIName:a}),Lt.X[i.length-1][e],1,1)});return o.push({name:t(\"neteco.pvms.smsrc.stationRevenue.tip.arbitrageRevenue\"),type:\"line\",color:\"#D19900\",yAxisIndex:0,data:(0,S.sD)(n)}),o}const Jn=oe.Z.Group,{NONE:$n,ACTUAL_TYPE_MONTH:er,FIXED_VALUE_TYPE:tr,TRANSFORMER_CAPACITY_TYPE:nr}=V.wF;class rr extends l.Component{constructor(e){super(e),this.intlMessage=(e,t)=>this.props.intl.formatMessage({id:e},t),this.getRevenueContentData=()=>{this.setState({emmaRevenueData:{xAxis:[]},emmaRevenueLoading:!0});const{period:e,currentYear:t,currentMonth:n}=this.state,r=\"month\"===e?s()(n):s()(t).year();nn.Z.getEMMARevenueContent(this.props.stationDn,{year:0,lifetime:1,month:2}[e],r).then((e=>{0===e.code&&this.setState({emmaRevenueData:e.data})})).finally((()=>{this.setState({emmaRevenueLoading:!1})}))},this.getDemandRevenueData=()=>{if(\"month\"===this.state.period)return;this.setState({demandRevenueData:{xAxis:[],basicTariffType:nr},demandRevenueLoading:!0});const{period:e,currentYear:t}=this.state;nn.Z.getEMMADemandRevenue(this.props.stationDn,{year:0,lifetime:1,month:2}[e],s()(t).year()).then((e=>{0===e.code&&this.setState({demandRevenueData:e.data})})).finally((()=>{this.setState({demandRevenueLoading:!1})}))},this.getArbitrageRevenueData=()=>{this.setState({arbitrageRevenueLoading:!0,arbitrageRevenueData:{xAxis:[]}});const{period:e,currentYear:t,currentMonth:n}=this.state,r=\"month\"===e?s()(n):s()(t).year();nn.Z.getEMMAArbitrageRevenue(this.props.stationDn,{year:0,lifetime:1,month:2}[e],r).then((e=>{0===e.code&&this.setState({arbitrageRevenueData:e.data})})).finally((()=>{this.setState({arbitrageRevenueLoading:!1})}))},this.getEMMARevenueReport=()=>{this.setState({operateLegendOfIncome:null,operateLegendOfDemand:null,operateLegendOfArbitrage:null}),(0,v.lVp)(v.en$)&&this.getRevenueContentData(),(0,v.lVp)(v.KWA)&&this.getDemandRevenueData(),(0,v.lVp)(v.lxn)&&this.getArbitrageRevenueData()},this.selectPeriodHandler=e=>{const{period:t}=this.state;e!==t&&this.setState({period:e,currentYear:s()().startOf(\"year\"),currentMonth:s()().startOf(\"month\")},(()=>this.props.hasEMMAPrice&&this.getEMMARevenueReport()))},this.forwardOrNextDate=e=>{this.setState((t=>\"month\"===t.period?{currentMonth:s()(t.currentMonth).add(e,\"month\")}:{currentYear:s()(t.currentYear).add(e,\"year\")}),(()=>this.props.hasEMMAPrice&&this.getEMMARevenueReport()))},this.handTimeChange=e=>{\"month\"===this.state.period?this.setState({currentMonth:e},(()=>this.props.hasEMMAPrice&&this.getEMMARevenueReport())):this.setState({currentYear:e},(()=>this.props.hasEMMAPrice&&this.getEMMARevenueReport()))},this.getSelectedLegendOfArbitrage=e=>{this.setState({operateLegendOfArbitrage:e})},this.getSelectedLegendOfDemand=e=>{this.setState({operateLegendOfDemand:e})},this.getSelectedLegendOfIncome=e=>{this.setState({operateLegendOfIncome:e})},this.setExportListModal=e=>{this.setState({showExportListModal:e})},this.exportEmmaRevenue=()=>{const{period:e,currentYear:t,currentMonth:n}=this.state,r=\"month\"===e?s()(n):s()(t).year();nn.Z.exportRevenueInfo(this.props.stationDn,{year:0,lifetime:1,month:2}[e],r,this.setExportListModal,V.ji.EMMA_REVENUE)},this.showDemandRevenueChart=e=>{const{demandRevenueData:t,period:n}=this.state;return!(\"month\"===n||![$n,er,tr].includes(t.basicTariffType)||e&&e&&t.basicTariffType===$n)},this.state={period:\"year\",currentYear:s()().startOf(\"year\"),currentMonth:s()().startOf(\"month\"),emmaRevenueLoading:!1,emmaRevenueData:{xAxis:[]},demandRevenueLoading:!1,demandRevenueData:{xAxis:[],basicTariffType:nr},arbitrageRevenueLoading:!1,arbitrageRevenueData:{xAxis:[]},showExportListModal:!1,operateLegendOfIncome:null,operateLegendOfDemand:null,operateLegendOfArbitrage:null}}componentDidMount(){this.props.hasEMMAPrice&&this.getEMMARevenueReport()}componentDidUpdate(e){this.props.hasEMMAPrice&&e.hasEMMAPrice!==this.props.hasEMMAPrice&&this.getEMMARevenueReport()}buildArbitrageRevenueChart(e,t){const n=e?{}:((e,t,n,r)=>{const{measureUnit:i,revenue:o,std_data:a,ai_data:s}=t;let l=a,c=s,u=l.map((e=>e.data)),d=c.map((e=>e.data));const p=(0,C.JM)(u),f=(0,C.JM)(d);a.length>Lt.Xe.length&&(u=[...p],d=[...f],l=[{name:\"\",data:[...u]}],c=[{name:\"\",data:[...d]}]);const h=\"name\";l=Ln({dataList:l,intlMessage:e,keyName:h}),c=Ln({dataList:c,intlMessage:e,keyName:h});const{arbitrageRevenueLegendAndDataMap:m,leftOriginLegend:g,rightOriginLegend:v,stdLegend:y,aiLegend:b}=function(e,t){const{stdData:n,aiData:r,revenue:i}=t,o={},a=[],s=[],l=[],c=[],u=(0,ut.jA)()?e(\"neteco.pvms.aifc.revenueReport.CI.tit\"):e(\"neteco.pvms.aifc.revenueReport.no.china.CI.tit\");for(let t=0;t<n.length;t++){const r=e(\"neteco.pvms.smsrc.stationRevenue.defaultTip\",{timePeriod:n[t].name});s.push(r),l.push(r),o[r]=n[t].data}for(let t=0;t<r.length;t++){const n=e(\"neteco.pvms.smsrc.stationRevenue.EMMATip\",{timePeriod:r[t].name,AIName:u});s.push(n),c.push(n),o[n]=r[t].data}return a.push(e(\"neteco.pvms.smsrc.stationRevenue.tip.arbitrageRevenue\")),o[e(\"neteco.pvms.smsrc.stationRevenue.tip.arbitrageRevenue\")]=i,{arbitrageRevenueLegendAndDataMap:o,leftOriginLegend:a,rightOriginLegend:s,stdLegend:l,aiLegend:c}}(e,{...t,stdData:l,aiData:c}),x=[],w=[],T=[];if(r){const t=(0,C.rG)(r),n=(0,ut.jA)()?e(\"neteco.pvms.aifc.revenueReport.CI.tit\"):e(\"neteco.pvms.aifc.revenueReport.no.china.CI.tit\"),i={[e(\"neteco.pvms.smsrc.stationRevenue.plain.defaultTip\")]:e(\"neteco.pvms.smsrc.stationRevenue.defaultTip\",{timePeriod:\"\"}),[n]:e(\"neteco.pvms.smsrc.stationRevenue.EMMATip\",{timePeriod:\"\",AIName:n})};for(let n=0;n<t.length;n++){let r=t[n];1===l.length&&\"\"===l[0].name&&r!==e(\"neteco.pvms.smsrc.stationRevenue.tip.arbitrageRevenue\")&&(r=i[r]);const o=m[r];y.includes(r)&&x.push(o),b.includes(r)&&w.push(o),g.includes(t[n])&&T.push(o)}}const A=(0,C.JM)(x),E=(0,C.JM)(w),O=r?[E,A,...x,...w]:[p,f,...d,...u],M=r?T:o,{leftYProps:P,rightYProps:D}=(0,S.vg)({leftOriginData:M,rightOriginData:O,splitNumber:5}),{min:I,max:N}=P,{min:_,max:j}=D,{multiple:k,unit:L}=(0,S.dN)([N,I],Pt.qG,i),{multiple:R,unit:Z}=(0,S.dN)([j,_],Pt.s1);return{tooltip:{...C.W,formatter:t=>function(e,t,n,r,i){const o=e.length-1,a=e[0].dataIndex,{stdData:s,aiData:l,allOriginAiPower:c,allOriginStdPower:u}=n,d=c[a],p=u[a],f=[...(0,st.Dc)(s.map((e=>e.data[a])).reverse()),...(0,st.Dc)(l.map((e=>e.data[a])).reverse())].filter(((t,n)=>e.map((e=>e.seriesIndex)).includes(n))),h=e[o].seriesName===t(\"neteco.pvms.smsrc.stationRevenue.tip.arbitrageRevenue\"),m=e.length>1||!h,g=(0,ut.jA)()?t(\"neteco.pvms.aifc.revenueReport.CI.tit\"):t(\"neteco.pvms.aifc.revenueReport.no.china.CI.tit\"),v=t(\"neteco.pvms.smsrc.stationRevenue.allPower.tip\"),y=[],b=[],x=[],w=[];m&&(y.push(t(\"neteco.pvms.smsrc.stationRevenue.defaultTip\",{timePeriod:v})),b.push((0,C.yn)(p,i)),x.push(t(\"neteco.pvms.smsrc.stationRevenue.EMMATip\",{timePeriod:v,AIName:g})),w.push((0,C.yn)(d,i)));for(let t=h?o-1:o;t>=0;t--){const n=e[t].seriesName.lastIndexOf(\"-\"),r=e[t].seriesName.substring(0,n);if(\"\"===r)continue;const o=e[t].color,a=(0,C.yn)(e[t].value,i),s=Number(f[t])>0?`${f[t]}%`:V.lH,l=`${e[t].marker} ${r}`,c=(0,S.hC)(a,`${a} (${s})`);Lt.Xe.flat().includes(o)?(y.push(l),b.push(c)):Lt.X.flat().includes(o)&&(x.push(l),w.push(c))}if(h){const t=(0,st.VF)(r)?C.z:C.i0,n=(0,st.VF)(r);y.push(`${(0,S.hH)(e[o].color)}${e[o].seriesName}`),b.push((0,C.yn)(e[o].value,r,t,n))}return(0,S.OA)(e[0].axisValueLabel,y,b,x,w)}(t,e,{stdData:l,aiData:c,allOriginAiPower:f,allOriginStdPower:p},i,e(\"neteco.pvms.unit.kWhUnit\"))},grid:{...C.o3},legend:{...C.hv,data:Qn(e,{stdData:l,aiData:c}),type:\"scroll\"},xAxis:[{type:\"category\",axisTick:{show:!1},axisLine:C.re,axisLabel:{formatter:e=>(0,C.Lm)(n,e)},scale:!0,data:t.xAxis,axisPointer:{type:\"shadow\"},boundaryGap:!0}],yAxis:[{...(0,S.j2)((0,st.lF)(i)?\"\":L,k),...P},{...(0,S.j2)(\"\",R),...D}],series:Xn({revenue:o,stdData:l,aiData:c},e),backgroundColor:\"transparent\",energyUnit:Z,moneyUnit:(0,st.lF)(i)?L:i}})(this.intlMessage,this.state.arbitrageRevenueData,t,this.state.operateLegendOfArbitrage);return(0,D.jsxs)(\"div\",{className:\"echarts arbitrage-income-echarts\",children:[(0,D.jsx)(\"div\",{className:\"chart-title\",children:this.intlMessage(\"neteco.pvms.smsrc.stationRevenue.emma.arbitrageTitle\")}),(0,D.jsx)(\"div\",{className:\"report-echarts\",children:this.buildArbitrageRevenueContent(e,n)})]})}buildArbitrageRevenueContent(e,t){return this.state.arbitrageRevenueLoading?(0,D.jsx)(b.Z,{className:\"report-loading\",size:\"large\"}):this.props.hasEMMAPrice?e?(0,D.jsx)(Et.Z,{image:\"/pvmswebsite/assets/build/images/station/noData.png\",description:this.intlMessage(\"neteco.pvms.noData\")}):(0,D.jsxs)(\"div\",{className:\"charts-container\",children:[(0,D.jsxs)(\"div\",{className:\"yAxis-name-area\",children:[(0,D.jsx)(\"span\",{className:\"yAxis-name-left\",children:t.moneyUnit}),(0,D.jsx)(\"span\",{className:\"yAxis-name-right\",children:t.energyUnit})]}),(0,D.jsx)(At.Z,{style:{width:\"100%\",height:\"90%\"},afterCreated:e=>(0,C.KR)(e,this.getSelectedLegendOfArbitrage),option:t})]}):(0,D.jsx)(Et.Z,{image:\"/pvmswebsite/assets/build/images/station/noData.png\",description:this.intlMessage(\"neteco.pvms.power.noPrice.businessSattion.detail.new\",{0:(0,D.jsx)(\"a\",{onClick:()=>(0,st.er)(this.props.stationDn,on.e.elecPriceEntry.entryType.BY_PLANT_BENEFIT_ANALYSIS,this.props.hasOnGridTariff),children:this.intlMessage(\"neteco.pvms.power.noPrice.businessSattion.detail.new.jump\")})})})}buildDemandRevenueChart(e,t){return(0,D.jsxs)(\"div\",{className:\"echarts demand-income-echarts\",children:[(0,D.jsx)(\"div\",{className:\"chart-title\",children:this.intlMessage(\"neteco.pvms.smsrc.stationRevenue.emma.demandTitle\")}),(0,D.jsx)(\"div\",{className:\"report-echarts\",children:this.buildDemandChartContent(e,t)})]})}buildDemandChartContent(e,t){if(this.state.demandRevenueLoading)return(0,D.jsx)(b.Z,{className:\"report-loading\",size:\"large\"});if(\"month\"===t)return(0,D.jsx)(Et.Z,{image:\"/pvmswebsite/assets/build/images/station/noData.png\",description:this.intlMessage(\"neteco.pvms.smsrc.stationRevenue.month.tip\")});if(!this.props.hasEMMAPrice)return(0,D.jsx)(Et.Z,{image:\"/pvmswebsite/assets/build/images/station/noData.png\",description:this.intlMessage(\"neteco.pvms.power.noPrice.businessSattion.detail.new\",{0:(0,D.jsx)(\"a\",{onClick:()=>(0,st.er)(this.props.stationDn,on.e.elecPriceEntry.entryType.BY_PLANT_BENEFIT_ANALYSIS,this.props.hasOnGridTariff),children:this.intlMessage(\"neteco.pvms.power.noPrice.businessSattion.detail.new.jump\")})})});if(e)return(0,D.jsx)(Et.Z,{image:\"/pvmswebsite/assets/build/images/station/noData.png\",description:this.intlMessage(\"neteco.pvms.noData\")});const n=e?{}:((e,t,n,r)=>{const{std_demandValue:i,ai_demandValue:o,revenue:a,measureUnit:s}=t,{demand:l,emmaDemand:c,demandIncrease:u}=Kn(e),d={[l]:{stdDemandValue:i},[c]:{aiDemandValue:o},[u]:{revenue:a}},p=[u],f=[l,c],h={revenue:a},m={stdDemandValue:i,aiDemandValue:o},{lastLeftBigintMap:g,lastLeftDataArray:v,lastRightBigintMap:y,lastRightDataArray:b}=(0,C.m1)({legendAndDataMap:d,leftOriginLegend:p,rightOriginLegend:f,leftOriginData:h,rightOriginData:m,selectedLegend:r}),{leftYProps:x,rightYProps:w}=(0,S.vg)({leftOriginData:v,rightOriginData:b,splitNumber:5}),{min:T,max:A}=x,{min:E,max:O}=w,{multiple:M,unit:P}=(0,S.dN)([A,T],Pt.qG,s),{multiple:D,unit:I}=(0,S.dN)([O,E],Pt.js);return{tooltip:{...C.W,formatter:t=>function(e,t,n,r){const i=[],o=[],a=[],s=[],{demand:l,emmaDemand:c,demandIncrease:u}=Kn(t);for(let t=0;t<e.length;t++)switch(e[t].seriesName){case l:i.push(`${e[t].marker} ${e[t].seriesName}`),o.push((0,C.yn)(e[t].value,r));break;case c:a.push(`${e[t].marker} ${e[t].seriesName}`),s.push((0,C.yn)(e[t].value,r));break;case u:{const r=(0,st.VF)(n)?C.z:C.i0,a=(0,st.VF)(n);i.push(`${(0,S.hH)(e[t].color)}${e[t].seriesName}`),o.push((0,C.yn)(e[t].value,n,r,a));break}}return(0,S.OA)(e[0].axisValueLabel,i,o,a,s)}(t,e,s,e(\"neteco.pvms.unit.KW\"))},grid:{...C.o3},legend:{...C.hv,data:[i.length>0&&{name:l,icon:\"circle\"},o.length>0&&{name:c,icon:\"circle\"},{name:u,icon:S.qz}]},xAxis:[{type:\"category\",axisLabel:{formatter:e=>(0,C.Lm)(n,e)},axisTick:{show:!1},axisLine:C.re,scale:!0,data:t.xAxis,axisPointer:{type:\"shadow\"},boundaryGap:!0}],yAxis:[{...(0,S.j2)((0,st.lF)(s)?\"\":P,M),...x},i.length>0&&{...(0,S.j2)(\"\",D),...w}],series:qn(t,e),backgroundColor:\"transparent\",powerUnit:i.length>0?I:\"\",moneyUnit:(0,st.lF)(s)?P:s}})(this.intlMessage,this.state.demandRevenueData,t,this.state.operateLegendOfDemand);return(0,D.jsxs)(\"div\",{className:\"charts-container\",children:[(0,D.jsxs)(\"div\",{className:\"yAxis-name-area\",children:[(0,D.jsx)(\"span\",{className:\"yAxis-name-left\",children:n.moneyUnit}),(0,D.jsx)(\"span\",{className:\"yAxis-name-right\",children:n.powerUnit})]}),(0,D.jsx)(At.Z,{style:{width:\"100%\",height:\"90%\"},afterCreated:e=>(0,C.KR)(e,this.getSelectedLegendOfDemand),option:n})]})}buildIncomeContentChart(e,t){const n=e?{}:((e,t,n,r,i)=>{const{std_pvRevenue:o,ai_pvRevenue:a,std_demandRevenue:s,ai_demandRevenue:l,std_peakVallyRevenue:c,ai_peakVallyRevenue:u,emmaRevenueRatio:d,measureUnit:p}=t,f=s&&(null==s?void 0:s.length)>0&&l&&(null==l?void 0:l.length)>0,{LegendAndDataMap:h,revenueLegend:m,emmaRevenueLegend:g,rightLegend:v}=((e,t,n)=>{const{pvRevenue:r,demandRevenue:i,arbitrageRevenue:o,emmaRevenueRatioTip:a,arbitrageEmmaRevenue:s,demandEmmaRevenue:l,pvEmmaRevenue:c}=Un(e),{std_pvRevenue:u,ai_pvRevenue:d,std_demandRevenue:p,ai_demandRevenue:f,std_peakVallyRevenue:h,ai_peakVallyRevenue:m,emmaRevenueRatio:g}=t;return{LegendAndDataMap:{[r]:u,[i]:p,[o]:h,[a]:g,[s]:m,[l]:f,[c]:d},revenueLegend:n?[r,i,o]:[r,o],emmaRevenueLegend:n?[s,l,c]:[s,c],rightLegend:[a]}})(e,t,f),y=f?[o,c,s]:[o,c],b=f?[a,u,l]:[a,u],x=[],w=[],T=[];if(i){const e=(0,C.rG)(i);for(let t=0;t<e.length;t++)m.includes(e[t])&&x.push(h[e[t]]),g.includes(e[t])&&w.push(h[e[t]]),v.includes(e[t])&&T.push(h[e[t]])}const A=(0,C.JM)(y),E=(0,C.JM)(b),O=(0,C.JM)(x),M=(0,C.JM)(w),P=i?[O,M,...x,...w]:[...y,...b,E,A],D=i?T:d,{leftYProps:I,rightYProps:N}=(0,S.vg)({leftOriginData:P,rightOriginData:D,splitNumber:5}),{min:_,max:j}=I,{multiple:k,unit:L}=(0,S.dN)([j,_],Pt.qG,p),R=r===jt.Fg.PURE_STORAGE;return{tooltip:{...C.W,formatter:n=>function(e){let{params:t,haveDemand:n,intlMessage:r,emmaRevenueData:i,moneyTooltipUnit:o,isPureStorage:a}=e;const{std_pvRevenue:s,ai_pvRevenue:l,std_demandRevenue:c,ai_demandRevenue:u,allOriginRevenue:d,allOriginEMMARevenue:p,std_peakVallyRevenue:f,ai_peakVallyRevenue:h}=i,m=t[0].dataIndex,g=d[m],v=p[m],y=t.length-1;let b=[];b=n?a?[f,c]:[f,c,s]:a?[f]:[f,s];let x=[];x=n?a?[h,u]:[h,u,l]:a?[h]:[h,l];const w=[...(0,st.Dc)(b.map((e=>e[m]))),...(0,st.Dc)(x.map((e=>e[m])))].filter(((e,n)=>t.map((e=>e.seriesIndex)).includes(n))),{allRevenueNoBenifitTip:T,allEmmaRevenueNoBenifitTip:A,pvRevenueNoBenifitTip:E,demandRevenueNoBenifitTip:O,arbitrageRevenueNoBenifitTip:M}=Un(r);let P=[];P=n?a?[M,O,M,O]:[M,O,E,M,O,E]:a?[M,M]:[M,E,M,E];const D=P.filter(((e,n)=>t.map((e=>e.seriesIndex)).includes(n))),I=(0,st.VF)(o)?C.z:C.i0,N=(0,st.VF)(o),_=[T],j=[(0,C.yn)(g,o,I,N)],k=[A],L=[(0,C.yn)(v,o,I,N)],R=t.length%2==0?Math.ceil(t.length/2)-1:Math.ceil(t.length/2)-2,Z=t.length%2==0?t.length-1:t.length-2;for(let e=R;e>=0;e--){const n=(0,C.yn)(t[e].value,o,I,N),r=Number(w[e])>0?`${w[e]}%`:V.lH;_.push(`${t[e].marker} ${D[e]}`),j.push((0,S.hC)(n,`${n} (${r})`))}if(t.length%2!=0){const e=(0,C.yn)(t[y].value,\"%\",2,!1);_.push(`${(0,S.hH)(t[y].color)}${t[y].seriesName}`),j.push((0,S.hC)(e,e))}for(let e=Z;e>t.length/2-1;e--){const n=(0,C.yn)(t[e].value,o,I,N),r=Number(w[e])>0?`${w[e]}%`:V.lH;k.push(`${t[e].marker} ${D[e]}`),L.push((0,S.hC)(n,`${n} (${r})`))}return(0,S.OA)(t[0].axisValueLabel,_,j,k,L,[])}({params:n,haveDemand:f,intlMessage:e,emmaRevenueData:{...t,allOriginRevenue:A,allOriginEMMARevenue:E},moneyTooltipUnit:p,isPureStorage:R})},grid:{...C.o3},legend:{...C.hv,data:Yn(f,e,R)},xAxis:[{type:\"category\",axisTick:{show:!1},axisLabel:{formatter:e=>(0,C.Lm)(n,e)},axisLine:C.re,scale:!0,data:t.xAxis,axisPointer:{type:\"shadow\"},boundaryGap:!0}],yAxis:[{...(0,S.j2)((0,st.lF)(p)?\"\":L,k),...I},{...(0,S.j2)(\"\",1),...N}],series:Wn(t,f,e,R),backgroundColor:\"transparent\",unit:(0,st.lF)(p)?L:p}})(this.intlMessage,this.state.emmaRevenueData,t,this.props.sceneType,this.state.operateLegendOfIncome),r=(0,ut.jA)()?this.intlMessage(\"neteco.pvms.aifc.revenueReport.CI.tit\"):this.intlMessage(\"neteco.pvms.aifc.revenueReport.no.china.CI.tit\");return(0,D.jsxs)(\"div\",{className:\"echarts income-content-echarts\",children:[(0,D.jsxs)(\"div\",{className:\"chart-title\",children:[this.props.intl.formatMessage({id:\"neteco.pvms.smsrc.stationRevenue.emma.contentTitle\"},{AIName:r}),(0,D.jsx)(d.Z,{placement:\"right\",overlayClassName:\"nco-station-emma-revenue-tip\",title:(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(\"p\",{children:this.props.intl.formatMessage({id:\"neteco.pvms.smsrc.stationRevenue.aiIncreaseRatio.tip\"},{AIName:r})}),(0,D.jsx)(\"p\",{children:this.props.intl.formatMessage({id:\"neteco.pvms.station.defaultRevenue.moreThan.emmaRevenue2\"},{service:r})})]}),children:(0,D.jsx)(\"i\",{className:\"icon-questionmark-circle-lined\"})})]}),(0,D.jsx)(\"div\",{className:\"report-echarts\",children:this.buildIncomeContentContent(e,n)})]})}buildIncomeContentContent(e,t){return this.state.emmaRevenueLoading?(0,D.jsx)(b.Z,{className:\"report-loading\",size:\"large\"}):this.props.hasEMMAPrice?e?(0,D.jsx)(Et.Z,{image:\"/pvmswebsite/assets/build/images/station/noData.png\",description:this.intlMessage(\"neteco.pvms.noData\")}):(0,D.jsxs)(\"div\",{className:\"charts-container\",children:[(0,D.jsxs)(\"div\",{className:\"yAxis-name-area\",children:[(0,D.jsx)(\"span\",{className:\"yAxis-name-left\",children:t.unit}),(0,D.jsx)(\"span\",{className:\"yAxis-name-right\",children:\"%\"})]}),(0,D.jsx)(At.Z,{style:{width:\"100%\",height:\"90%\"},afterCreated:e=>(0,C.KR)(e,this.getSelectedLegendOfIncome),option:t})]}):(0,D.jsx)(Et.Z,{image:\"/pvmswebsite/assets/build/images/station/noData.png\",description:this.intlMessage(\"neteco.pvms.power.noPrice.businessSattion.detail.new\",{0:(0,D.jsx)(\"a\",{onClick:()=>(0,st.er)(this.props.stationDn,on.e.elecPriceEntry.entryType.BY_PLANT_BENEFIT_ANALYSIS,this.props.hasOnGridTariff),children:this.intlMessage(\"neteco.pvms.power.noPrice.businessSattion.detail.new.jump\")})})})}buildTimeSelection(e,t,n){return(0,D.jsxs)(\"div\",{className:\"report-operation\",children:[(0,D.jsxs)(Jn,{children:[(0,D.jsx)(oe.Z,{type:\"month\"===e?\"primary\":\"default\",onClick:()=>{this.selectPeriodHandler(\"month\")},title:this.intlMessage(\"neteco.pvms.systemSetting.amendment.month\"),children:this.intlMessage(\"neteco.pvms.systemSetting.amendment.month\")}),(0,D.jsx)(oe.Z,{type:\"year\"===e?\"primary\":\"default\",onClick:()=>{this.selectPeriodHandler(\"year\")},title:this.intlMessage(\"neteco.pvms.systemSetting.amendment.year\"),children:this.intlMessage(\"neteco.pvms.systemSetting.amendment.year\")}),(0,D.jsx)(oe.Z,{type:\"lifetime\"===e?\"primary\":\"default\",onClick:()=>{this.selectPeriodHandler(\"lifetime\")},title:this.intlMessage(\"neteco.pvms.KPI.kpiView.lifelimit\"),children:this.intlMessage(\"neteco.pvms.KPI.kpiView.lifelimit\")})]}),(0,D.jsxs)(\"div\",{className:\"report-datetime\",children:[(0,D.jsx)(Ot.Z,{title:this.intlMessage(\"neteco.pvms.power.lastYear\"),className:\"datetime-arrow\",onClick:()=>this.forwardOrNextDate(-1)}),(0,D.jsx)(Dt.Z,{timeDimension:e,value:\"month\"===e?t:n,onChange:this.handTimeChange}),(0,D.jsx)(Mt.Z,{title:this.intlMessage(\"neteco.pvms.power.nextYear\"),className:\"datetime-arrow\",onClick:()=>this.forwardOrNextDate(1)})]}),(0,v.lVp)(v.ql_)&&(0,D.jsx)(oe.Z,{onClick:this.exportEmmaRevenue,children:(0,D.jsx)(gn.Z,{id:\"neteco.pvms.componentSetting.export\"})})]})}render(){const{period:e,currentMonth:t,currentYear:n,emmaRevenueData:r,demandRevenueData:i,arbitrageRevenueData:o}=this.state,a=!r.xAxis||0===r.xAxis.length,s=!i.xAxis||0===i.xAxis.length,l=!o.xAxis||0===o.xAxis.length,c=this.showDemandRevenueChart(s);return(0,D.jsxs)(\"div\",{className:\"nco-emma-report tab-content\",children:[this.buildTimeSelection(e,t,n),(0,D.jsxs)(\"div\",{className:\"echarts-list\",children:[this.buildIncomeContentChart(a,e),c&&this.buildDemandRevenueChart(s,e),this.buildArbitrageRevenueChart(l,e)]}),(0,D.jsx)(vn.Z,{showExportListModal:this.state.showExportListModal,setExportListModal:this.setExportListModal,reportId:V.xL,exportOperation:v.ql_})]})}}const ir=(0,o.ZP)(rr);var or=n(44331);const{TabPane:ar}=ln.Z;class sr extends l.Component{constructor(e){var t;super(e),this.changeTabHandler=e=>{this.props.onChildTabChange&&this.props.onChildTabChange(e),this.setState({activeTab:e})},this.showUserGuideModal=()=>{this.setState({userGuideModalVisible:!0})},this.onModalCancel=()=>{var e;this.setState({userGuideModalVisible:!1}),null===(e=this.videoRef.current)||void 0===e||e.pause()},this.renderUserGuide=()=>{const{intl:e}=this.props,t=\"zh-cn\"===window.neteco.i18n.getLocale(),n=or.station_revenue_pre_video_url,r=t?`${n}?actionFlag=download&mid=SUPE_DOC&nid=EDOC1100356164&partNo=o001&play=1`:`${n}?actionFlag=download&mid=SUPE_DOC&nid=EDOC1100356165&partNo=o001&play=1`,i=t?or.guide_link_url_zh:or.guide_link_url_en,o=(0,ut.jA)()?e.formatMessage({id:\"neteco.pvms.aifc.revenueReport.CI.tit\"}):e.formatMessage({id:\"neteco.pvms.aifc.revenueReport.no.china.CI.tit\"});return(0,D.jsxs)(m.Z,{visible:this.state.userGuideModalVisible,className:\"user-guide-modal\",size:\"middle\",title:e.formatMessage({id:\"neteco.pvms.stationRevenue.userGuideVideoModal.title\"}),footer:null,onCancel:this.onModalCancel,children:[(0,D.jsx)(\"video\",{ref:this.videoRef,controls:!0,autoPlay:!0,className:\"user-guide-animated\",children:(0,D.jsx)(\"source\",{src:r,type:\"video/mp4\"})}),(0,D.jsx)(\"div\",{className:\"user-guide-text\",children:e.formatMessage({id:\"neteco.pvms.stationRevenue.userGuideModal.content.fie\"},{0:(0,D.jsx)(\"a\",{href:i,target:\"_blank\",rel:\"noopener noreferrer\",children:e.formatMessage({id:\"neteco.pvms.stationRevenue.userGuideModal.linkContent.fie\"})}),AIName:o})})]})};const{match:n}=e;this.videoRef=l.createRef(),this.state={activeTab:null==n||null===(t=n.params)||void 0===t?void 0:t.activeTab,hasNewPrice:!0,hasEMMAPrice:!0,hasOnGridTariff:!0,hasPurchaseTariff:!0}}componentDidMount(){localStorage.getItem(\"firstRenderRevenue\")||(this.showUserGuideModal(),localStorage.setItem(\"firstRenderRevenue\",\"true\")),nn.Z.getPriceCondition(this.props.stationDn).then((e=>{const t=\"NEW\"===(null==e?void 0:e.purchaseTariff)||\"NEW\"===(null==e?void 0:e.onGridTariff),n=(null==e?void 0:e.onGridTariff)&&\"NONE\"!==(null==e?void 0:e.onGridTariff),r=(null==e?void 0:e.purchaseTariff)&&\"NONE\"!==(null==e?void 0:e.purchaseTariff),i=n&&r;this.setState({hasNewPrice:t,hasEMMAPrice:i,hasOnGridTariff:n,hasPurchaseTariff:r})}))}render(){const{showAIFCReport:e,intl:t,stationDn:n,sceneType:r}=this.props,{hasNewPrice:i}=this.state,o=this.state.activeTab?{activeKey:this.state.activeTab}:{},a=(0,ut.jA)()?t.formatMessage({id:\"neteco.pvms.aifc.revenueReport.CI.tit\"}):t.formatMessage({id:\"neteco.pvms.aifc.revenueReport.no.china.CI.tit\"}),s=(0,ut.ej)(\"locale\"),l=(0,ut.jA)()||\"zh-cn\"!==s;return(0,v.lVp)(v.ofE)?(0,D.jsxs)(\"div\",{className:\"nco-station-revenue-container tab-content\",children:[(0,D.jsx)(\"div\",{className:\"content\",children:(0,D.jsxs)(\"div\",{className:\"left-content\",children:[(0,D.jsx)(rn.Z,{className:\"report-alert\",message:t.formatMessage({id:\"neteco.pvms.aifc.revenueInfo.alert\"}),type:\"info\",showIcon:!0}),(0,D.jsxs)(ln.Z,{...o,className:\"aui-tabs\",onChange:this.changeTabHandler,destroyInactiveTabPane:!0,children:[(0,v.lVp)(v.HSx)&&(0,D.jsx)(ar,{tab:t.formatMessage({id:\"neteco.pvms.station.revenue.allRevenue\"}),children:(0,D.jsx)(\"div\",{className:\"nco-report-tab-container\",children:(0,D.jsx)(Tn,{stationDn:n,sceneType:r,hasNewPrice:i})})},V.Ft.ALL),(0,v.lVp)(v.Dco)&&r!==jt.Fg.PURE_STORAGE&&(0,D.jsx)(ar,{tab:t.formatMessage({id:\"neteco.pvms.smsrc.stationRevenue.tip.pvRevenueTitle\"}),children:(0,D.jsx)(\"div\",{className:\"nco-report-tab-container\",children:(0,D.jsx)(Hn,{stationDn:n,hasNewPrice:i})})},V.Ft.PV),(0,v.lVp)(v.ArY)&&r!==jt.Fg.PURE_LIGHT&&(0,D.jsx)(ar,{tab:t.formatMessage({id:\"neteco.pvms.smsrc.stationRevenue.tab.battery\"}),children:(0,D.jsx)(\"div\",{className:\"nco-report-tab-container\",children:(0,D.jsx)(Bn,{stationDn:n,hasNewPrice:i,isLightStorage:r===jt.Fg.LIGHT_STORAGE})})},V.Ft.BATTERY),(0,v.lVp)(v.mxS)&&e&&r!==jt.Fg.PURE_LIGHT&&(0,D.jsx)(ar,{tab:t.formatMessage({id:\"neteco.pvms.smsrc.stationRevenue.tab.emma\"},{AIName:a}),children:(0,D.jsx)(\"div\",{className:\"nco-report-tab-container\",children:(0,D.jsx)(ir,{stationDn:n,hasEMMAPrice:this.state.hasEMMAPrice,sceneType:r,hasOnGridTariff:this.state.hasOnGridTariff,hasPurchaseTariff:this.state.hasPurchaseTariff})})},V.Ft.EMMA)]}),l&&(0,D.jsxs)(\"div\",{className:\"user-guide\",onClick:this.showUserGuideModal,children:[(0,D.jsx)(mn,{className:\"user-guide-icon\"}),(0,D.jsx)(\"a\",{children:t.formatMessage({id:\"neteco.pvms.stationRevenue.userGuideVideo.title\"})})]})]})}),l&&this.renderUserGuide()]}):(0,D.jsx)(y.Z,{})}}const lr=sr,cr=n(49651).Z,ur=(0,l.createContext)(),dr=(0,l.createContext)(),pr=(0,l.createContext)(),fr=(0,l.createContext)(),hr=\"setState\",mr={};function gr(e,t){switch(t.type){case hr:{const{key:n,value:r}=t;return\"function\"==typeof r?{...e,[n]:r(e[n])}:{...e,[n]:r}}case\"updateState\":return{...e,...t.data};default:return!0}}const vr=()=>{const[e,t]=(0,l.useReducer)(gr,mr);return{state:e,dispatch:t}},yr=(e,t,n)=>{var r;const{state:i,dispatch:o}=(0,l.useContext)(e),a=null!==(r=i[t])&&void 0!==r?r:n,s=(0,l.useCallback)((e=>o(((e,t)=>({type:hr,key:e,value:t}))(t,e))),[o]);return[a,s]};var br=n(10623),Sr=n(28884),xr=n(91987),wr=n(18801),Cr=n(11817),Tr=n(61906),Ar=n(95693),Er=n(63604),Or=n(64854);const Mr=e=>{const t=\"function\"==typeof e?e:()=>e;return function(){try{const e=t(...arguments);return e instanceof Promise?e:Promise.resolve(e)}catch(e){return Promise.reject(e)}}};var Pr=n(20818);function Dr(e){const{className:t,buttonClassName:n,title:r,placement:i,trigger:o,style:a,disabled:s,showDropdownTipIcon:l,active:c,getPopupContainer:u,children:p,theme:f=\"default\",isDropdownOpen:m,...g}=e,v=Qe()(\"nco-icon-button-container\",{active:c,disabled:s},t),y=Qe()(\"icon-button\",n);return(0,D.jsx)(d.Z,{title:!s&&(p||r),placement:i,trigger:o,getPopupContainer:u,children:(0,D.jsxs)(\"div\",{className:v,theme:f,children:[(0,D.jsx)(h.Z,{className:y,disabled:s,style:a,...g,type:\"text\"}),l&&(0,D.jsx)(Pr.Z,{className:\"dropdown-tip-icon\"})]})})}const Ir={pending:0,success:1,fail:2},Nr={type:\"\",taskId:\"\",taskLoading:!1},_r=(e,t)=>t,jr=(e,t)=>{(0,st.mf)(t)&&t(e)};function kr(e,t){let{createTask:n,getTasks:r,onCreate:i,onDownload:o,onDelete:a,onError:c,onOk:u,onCancel:d,columns:p,defaultColumnsConfig:v,title:y,tip:b,visible:S,delay:x=2e3,showOpenButton:w=!1,...C}=e;const T=Mr((0,st.mf)(n)?n:()=>!0),A=Mr(r),E=Mr(o),O=Mr(a),M=Mr(c),P=(0,Ar.Z)(),{modal:I}=Cr.Z.useApp(),[N,_]=(0,l.useState)(!1),[j,k]=(0,l.useReducer)(_r,Nr),[L,R,Z]=((e,t,n,r)=>{const[i,o]=(0,l.useState)([]),[a,s]=(0,l.useState)(!0),c=(0,l.useRef)(null),u=(0,l.useRef)(!0),d=(0,l.useCallback)((()=>{u.current&&r({type:4,taskLoading:!0}),e().then((e=>{let t=!0;(0,st.kJ)(e)&&(t=e.every((e=>e.state!==Ir.processing&&e.state!==Ir.pending)),o(e)),s(t)})).catch((e=>jr({type:1,err:e},n))).finally((()=>r({type:4,taskLoading:!1})))}),[e]);return(0,l.useEffect)((()=>{a?(clearInterval(c.current),c.current=null,u.current=!0):c.current||(u.current=!1,c.current=setInterval((()=>d()),null!=t?t:2e3))}),[a]),[i,d,s]})(A,x,M,k),B=((e,t)=>{const n=(0,Ar.Z)();return(0,l.useMemo)((()=>{const r=[{title:n.formatMessage({id:\"neteco.pvms.inspect.task.taskName\"}),key:\"taskName\",dataIndex:\"taskName\",ellipsis:!0},{title:n.formatMessage({id:\"ncoNewDeviceManagement.label.deviceCreateTime\"}),key:\"createTime\",dataIndex:\"createTime\",render:e=>s()(e).format(\"YYYY/MM/DD HH:mm:ss\")},{title:n.formatMessage({id:\"common.label.action\"}),key:\"action\",dataIndex:\"action\",render:(e,r)=>(0,D.jsx)(D.Fragment,{children:r.state===Ir.processing||r.state===Ir.pending?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(h.Z,{type:\"text\",style:{pointerEvents:\"none\"},icon:(0,D.jsx)(Er.Z,{spin:!0})}),r.state===Ir.processing?n.formatMessage({id:\"neteco.pvms.alarm.exporting\"}):n.formatMessage({id:\"neteco.pvms.plantDiagnosis.export.status.pending\"})]}):(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(Dr,{disabled:r.state!==Ir.success,icon:(0,D.jsx)(Or.Z,{}),onClick:()=>t({type:2,taskId:r.taskId,record:r}),children:n.formatMessage({id:\"neteco.pvms.station.availability.btn.download\"})}),(0,D.jsx)(Dr,{icon:(0,D.jsx)(f.Z,{}),onClick:()=>t({type:3,taskId:r.taskId,record:r}),children:n.formatMessage({id:\"common.button.delete\"})})]})})}];return(0,st.Kn)(e)?r.filter((t=>{const{key:n}=t,{disabled:r=!1}=e[n]||t;return!r})).map((t=>{const{key:n}=t,{disabled:r,...i}=e[n]||{};return{...t,...i}})):r}),[e,n])})(v,k),F=(0,l.useMemo)((()=>(0,st.mf)(p)?p(B):(0,st.kJ)(p)?p:B),[B,p]),z=(0,l.useCallback)((()=>{_(!1),(0,st.mf)(u)&&u()}),[u]),V=(0,l.useCallback)((()=>{_(!1),(0,st.mf)(d)&&d()}),[d]);return(0,l.useImperativeHandle)(t,(()=>({dispatchAction:k,openModal:_})),[k]),(0,l.useEffect)((()=>{S?T().then((e=>{if(!e)throw new Error(\"Failed to create task\");(0,st.mf)(i)&&i()})).catch((e=>jr({type:0,err:e},M))).finally((()=>{_(!0)})):_(!1)}),[S]),(0,l.useEffect)((()=>{N?R():Z(!0)}),[N]),(0,l.useEffect)((()=>{const{type:e,taskId:t,record:n}=j;2===e&&E(t,n).catch((e=>jr({type:2,err:e},M))),3===e&&I.confirm({title:P.formatMessage({id:\"neteco.pvms.tasksManager.delete.confirm.title\"}),onOk:()=>((e,t)=>{k({type:4,taskLoading:!0}),O(e,t).then((()=>R())).catch((e=>{jr({type:3,err:e},M),k({type:4,taskLoading:!1})}))})(t,n),onCancel:()=>jr({type:3,err:\"delete canceled\"},M)})}),[j]),(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(m.Z,{className:\"nco-tasks-manager-modal\",title:y||P.formatMessage({id:\"neteco.pvms.station.availability.download.title\"}),width:900,visible:N,destroyOnClose:!0,cancelText:\"\",onOk:z,cancelButtonProps:{style:{display:\"none\"}},onCancel:V,...C,children:[(0,D.jsx)(rn.Z,{className:\"nco-tasks-manager-modal-alert\",type:\"info\",cancelText:\"\",message:b||P.formatMessage({id:\"neteco.pvms.station.availability.download.tip.new\"}),showIcon:!0}),(0,D.jsx)(g.Z,{className:\"nco-tasks-manager-table\",rowKey:\"taskId\",columns:F,dataSource:L,pagination:!1,loading:j.taskLoading})]}),w&&(0,D.jsx)(\"div\",{onClick:()=>_(!0),className:\"nco-tasks-manager-open-button\",draggable:!0,title:P.formatMessage({id:\"neteco.pvms.documentManage.download\"}),children:(0,D.jsx)(\"img\",{src:\"/pvmswebsite/assets/build/images/device/download.png\",width:\"100%\"})})]})}const Lr=(0,l.memo)((0,l.forwardRef)(kr));function Rr(e){let{className:t,createExportTask:n,getTasks:r,deleteTask:i,downloadReport:o,canDownload:a=!0}=e;const[s,c]=(0,l.useState)(!1),[u,d]=(0,l.useState)(!1),{translate:p}=(0,Tr.qM)(),{modal:f}=Cr.Z.useApp();return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(h.Z,{className:Qe()(\"nco-pv-diagnosis-export-button\",t),onClick:()=>{c(!0),n().then((()=>{d(!0)})).catch((e=>{var t;\"current export task already exist\"===(null==e||null===(t=e.responseJSON)||void 0===t?void 0:t.exceptionId)?f.info({title:p(\"neteco.pvms.info\"),content:p(\"neteco.pvms.plantDiagnosis.essDiagnosis.exportInfo.1\")}):f.error({title:p(\"neteco.pvms.station.availability.export.failed\")})})).finally((()=>{c(!1)}))},loading:s,disabled:!a,children:p(\"common.button.export\")}),(0,D.jsx)(Lr,{visible:u,onOk:()=>d(!1),onCancel:()=>d(!1),getTasks:r,onDownload:o,onDelete:i,showOpenButton:!0})]})}var Zr=n(26075),Br=n(7399),Fr=n(52883),zr=n(50606),Vr=n(31458),Hr=n(3308),Ur=n(88490);const Gr=e=>{const t=\"1.5rem\";switch(e){case\"success\":return(0,D.jsx)(zr.Z,{type:\"success\",style:{fontSize:t,color:Vr.Z.colors.semanticSuccess}});case\"info\":return(0,D.jsx)(Hr.Z,{type:\"info\",style:{fontSize:t,color:Vr.Z.colors.semanticTips}});case\"warning\":return(0,D.jsx)(Hr.Z,{type:\"warning\",style:{fontSize:t,color:Vr.Z.colors.semanticSecondary}});case\"error\":return(0,D.jsx)(Ur.Z,{type:\"error\",style:{fontSize:t,color:Vr.Z.colors.semanticUrgent}});default:return null}},Yr={style:{borderRadius:\"0.75rem\",padding:\"1rem\"},description:null,placement:\"topRight\",top:\"70px\",duration:5},Wr=(e,t)=>{var n;const r=null===(n=null==t?void 0:t.hasCloseIcon)||void 0===n||n?{}:{closeIcon:(0,D.jsx)(D.Fragment,{})};return{...Yr,...r,icon:Gr(e)}},Kr=e=>{Fr.Z.error({...Wr(\"error\",e),...e})},qr=()=>(0,l.useContext)(fr),Qr=e=>{if(null==e)return[];const t=s()(e).startOf(\"day\").valueOf(),n=s()(e).endOf(\"day\").valueOf();return[Math.max(t,1),n]},Xr=\"/rest\",Jr=\"/dp/pvms/diagnose/v1/ess\",$r=`${Xr}${Jr}/task`,ei=(e,t,n,r,i)=>{const o=`${Xr}${Jr}/detail`,a={startTime:e,endTime:t,parentDnId:n,pageNo:r,pageSize:i};return(0,O.U2)(o,a)},ti=()=>(0,O.U2)($r),ni=e=>{const t=`${$r}?taskId=${e}`;return(0,O.IV)(t)},ri=e=>{const t=`${Xr}${Jr}/download`;try{return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e+\"?\"+Object.entries(t).map((e=>{let[t,n]=e;return`${t}=${n}`})).join(\"&\");window.open(n,\"_self\")}(t,{taskId:e}),Promise.resolve(e)}catch(e){return Promise.reject(e)}},ii={healthDegree:\"smartpvms.energystorage.indicatortype.Health\",consistency:\"smartpvms.energystorage.indicatortype.Consistency\",chargingAndDischarging:\"smartpvms.energystorage.indicatortype.Chargeanddischarge\",operation:\"smartpvms.energystorage.indicatortype.O&M\",eliminateDeficiency:\"smartpvms.energystorage.indicatortype.Alarm\"},oi=\"TEMPERATURE\",ai=\"HUMIDITY\",si=\"VOLTAGE\",li=\"SOC\",ci=\"CHARGE\",ui=\"EXPANSION\",di=\"ISO\",pi=\"RESISTANCE\",fi=\"POWER\",hi=\"WORK\",mi=\"SOH\",gi={1:\"neteco.pvms.plantDiagnosis.essDiagnosis.deviceStatistic.severe\",2:\"neteco.pvms.plantDiagnosis.essDiagnosis.deviceStatistic.moderate\",3:\"neteco.pvms.plantDiagnosis.essDiagnosis.deviceStatistic.mild\"};function vi(){const e=(0,Ar.Z)();return{translate:(t,n)=>e.formatMessage({id:t||\"-\"},n),intl:e}}const yi=[],bi=Symbol(\"essDiagnosisDate\"),Si=Symbol(\"timeRange\"),xi=()=>{const[e,t]=yr(pr,bi),[n,r]=yr(pr,Si,[]);return{essDiagnosisDate:e,setESSDiagnosisDate:t,timeRange:n,setTimeRange:r,clearConditionInfo:()=>{t(),r([])}}},wi=Symbol(\"inspectDateList\"),Ci=Symbol(\"nextInspectDate\"),Ti=Symbol(\"dayOfWeek\"),Ai=Symbol(\"indicatorList\"),Ei=Symbol(\"indicatorTable\"),Oi=()=>{const{translate:e}=vi(),[t,n]=yr(pr,wi,[]),[r,i]=yr(pr,Ci),[o,a]=yr(pr,Ti,1),[l,c]=yr(pr,Ai,[]),[u,d]=yr(pr,Ei,[]);return{inspectDateList:t,setInspectDateList:n,nextInspectDate:r,setNextInspectDate:i,dayOfWeek:o,setDayOfWeek:a,indicatorList:l,setIndicatorList:c,indicatorTable:u,setIndicatorTable:d,getESSDiagnoseTime:async e=>{try{var t;const r={stationDn:e},i=await(e=>(0,O.U2)(\"/rest/dp/pvms/diagnose/v1/ess/inspect-time\",e))(r),o=null!==(t=null==i?void 0:i.map((e=>s()(e).startOf(\"day\").valueOf())))&&void 0!==t?t:[],a=[...new Set(o)];return n(a),a}catch(e){return n([]),[]}},getESSDiagnosePeriod:async e=>{try{const t={stationDn:e},n=await(e=>(0,O.U2)(\"/rest/dp/pvms/diagnose/v1/ess/inspect-period\",e))(t),{dayOfWeek:r=1,indicatorList:o=[]}=null!=n?n:{};a(r),c(o);const l=new Set;d(o.filter((e=>!l.has(e.indicatorName)&&(l.add(e.indicatorName),!0))));const u=(e=>0===e?s()().add(1,\"day\").startOf(\"day\"):s()().day(e).add(s()().day()<e?0:7,\"days\").startOf(\"day\"))(r);i(u)}catch(e){a(1),c([])}}}},Mi={[ii.healthDegree]:null,[ii.consistency]:null,[ii.chargingAndDischarging]:null,[ii.operation]:null,[ii.eliminateDeficiency]:null,loading:!1},Pi=e=>{const[t,n]=yr(pr,e,Mi),r=(0,l.useCallback)(((e,r,i)=>{n({...t,loading:!0}),((e,t,n,r)=>{const i=`${Xr}${Jr}/statistics`,o={stationDn:n,diagnoseType:r,startTime:e,endTime:t},a=Object.entries(o).map((e=>{let[t,n]=e;return(0,st.kJ)(n)?n.map((e=>`${t}=${encodeURIComponent(e)}`)).join(\"&\"):`${t}=${n}`})).join(\"&\");return(0,O.U2)(`${i}?${a}`)})(e,r,i,Object.values(ii)).then((e=>{const{totalList:t}=null!=e?e:{};if(t&&t.length>0){const e={...Mi};t.forEach((t=>{const{diagnoseTypeId:n,total:r}=t;e[n]=r})),n({...e,loading:!1})}else n({...Mi,loading:!1})})).catch((e=>{n({...Mi,loading:!1})}))}),[t,n]);return[t,r,()=>{n(Mi)}]},Di=Symbol(\"statisticCurrentQuantity\"),Ii=Symbol(\"statisticBaseQuantity\"),Ni=()=>{const[e,t,n]=Pi(Di),[r,i,o]=Pi(Ii);return{currentStatistic:e,baseStatistic:r,refreshStatistic:(e,n,r,o)=>{const a=o.findIndex((t=>t===e)),s=o[a-1],[l,c]=Qr(null!=s?s:e);t(e,n,r),i(l,c,r)},clearStatistic:()=>{n(),o()}}},_i=Symbol(\"deviceTypeLoading\"),ji=Symbol(\"deviceTypeOptions\"),ki={grid:{top:5,bottom:25,left:0,right:0},dataZoom:null,legend:{bottom:0,icon:\"rect\",textStyle:{color:\"#777777\"},type:\"scroll\"},xAxis:{data:[]},yAxis:{},series:[{data:[]}]},Li=()=>{const[e,t]=yr(pr,_i,!1),[n,r]=yr(pr,ji,ki),[i,o]=(0,l.useState)(170),{translate:a}=vi(),s=qr(),{timeRange:c}=xi();(0,l.useEffect)((()=>(window.addEventListener(\"resize\",u),u(),()=>{window.removeEventListener(\"resize\",u)})),[]);const u=()=>{const e=window.innerWidth<1550?100:170;o(e)};(0,l.useEffect)((()=>{const[e,t]=c;d(e,t,s)}),[i]);const d=async(e,n,o)=>{try{t(!0);const s={startTime:e,endTime:n,stationDn:o},l=await(e=>(0,O.U2)(\"/rest/dp/pvms/diagnose/v1/ess/device-type-statistics\",e))(s);if(null!=l&&l.listData){const e={...ki,xAxis:{type:\"category\",axisTick:{alignWithLabel:!0},axisLabel:{width:i,interval:0,overflow:\"breakAll\"},data:l.listData.map((e=>e.deviceTypeName))},series:[{name:a(\"neteco.pvms.plantDiagnosis.essDiagnosis.deviceStatistic.severe\"),stack:\"count\",data:l.listData.map((e=>e.severeCount)),itemStyle:{color:\"#F46465\"},barMaxWidth:32},{name:a(\"neteco.pvms.plantDiagnosis.essDiagnosis.deviceStatistic.moderate\"),stack:\"count\",data:l.listData.map((e=>e.moderateCount)),itemStyle:{color:\"#F59869\"},barMaxWidth:32},{name:a(\"neteco.pvms.plantDiagnosis.essDiagnosis.deviceStatistic.mild\"),stack:\"count\",data:l.listData.map((e=>e.mildCount)),itemStyle:{color:\"#999999\"},barMaxWidth:32}]};r(e)}else r(ki)}catch(e){r(ki)}finally{t(!1)}};return{loading:e,options:n,queryDeviceStatistic:d,clearDeviceStatistic:()=>{r(ki)}}},Ri=Symbol(\"faultCountLoading\"),Zi=Symbol(\"faultCount\"),Bi=()=>{const e={},[t,n]=yr(pr,Ri,!1),[r,i]=yr(pr,Zi,e);return{loading:t,faultCount:r,queryFaultCountStatistic:async(t,r,o)=>{try{n(!0);const a={startTime:t,endTime:r,stationDn:o},s=await(e=>(0,O.U2)(\"/rest/dp/pvms/diagnose/v1/ess/fault-info-statistics\",e))(a);if(s){const{exceptionItemTotal:e=0,severeCount:t=0,moderateCount:n=0,mildCount:r=0}=s;i({exceptionItemTotal:e,severeCount:t,moderateCount:n,mildCount:r})}else i(e)}catch(t){i(e)}finally{n(!1)}},clearFaultCountStatistic:()=>{i(e)}}},Fi=Symbol(\"deviceRankLoading\"),zi=Symbol(\"deviceRankList\"),Vi=Symbol(\"deviceRankOptions\"),Hi={grid:{top:0,bottom:0},dataZoom:null,legend:null,color:[\"#FDC000\"],xAxis:{},yAxis:{},series:[{data:[]}]},Ui=()=>{const[e,t]=yr(pr,Fi,!1),[n,r]=yr(pr,zi,[]),[i,o]=yr(pr,Vi,Hi),{translate:a}=vi();return{loading:e,rankList:n,options:i,queryDeviceRank:async(e,n,i)=>{try{t(!0);const s={startTime:e,endTime:n,stationDn:i},l=await(e=>(0,O.U2)(\"/rest/dp/pvms/diagnose/v1/ess/device-fault-list\",e))(s);if(Array.isArray(null==l?void 0:l.listData)){const e=l.listData.slice(0,5),t={...Hi,xAxis:{type:\"value\",position:\"top\",axisLabel:{show:!1}},yAxis:{type:\"category\",inverse:!0,data:e.map((e=>e.dnName)),axisLabel:{show:!1}},series:[{type:\"bar\",name:a(\"neteco.pvms.plantDiagnosis.essDiagnosis.amountStatistic.total\"),barWidth:16,data:e.map((e=>e.faultCount))}]};r(e),o(t)}else r([]),o(Hi)}catch(e){r([]),o(Hi)}finally{t(!1)}},clearDeviceRank:()=>{r([]),o(Hi)}}},Gi=Symbol(\"diagnosisItemList\"),Yi=Symbol(\"diagnosisItemLoading\"),Wi=()=>{const[e,t]=yr(pr,Gi,[]),[n,r]=yr(pr,Yi,!1);return{diagnosisItemList:e,loading:n,queryDiagnosisItemStatistic:async(e,n,i)=>{try{var o;r(!0);const a={startTime:e,endTime:n,stationDn:i},s=await(e=>(0,O.U2)(\"/rest/dp/pvms/diagnose/v1/ess/diagnostic-item-statistics\",e))(a);t(null!==(o=null==s?void 0:s.listData)&&void 0!==o?o:[])}catch(e){t([])}finally{r(!1)}},clearDiagnosisItemStatistic:()=>{t([])}}},Ki=Symbol(\"essDiagnosisList\"),qi=Symbol(\"essDiagnosisListLoading\"),Qi=()=>{const[e,t]=yr(pr,Ki,yi),[n,r]=yr(pr,qi,!1),{translate:i}=vi();return{essDiagnosisList:e,setESSDiagnosisList:t,loading:n,setLoading:r,queryESSDiagnosisFaultDevice:async(e,n,o)=>{try{r(!0);const i={stationDn:o,startTime:e,endTime:n,pageNo:1,pageSize:1e3},a=await(e=>(0,O.U2)(\"/rest/dp/pvms/diagnose/v1/ess/overviews\",e))(i);if(a){const{listData:e=[]}=a;t(e)}else t([])}catch(e){Kr({message:i(\"neteco.pvms.ncoSystemParameter.common.searchFailed\")}),t([])}finally{r(!1)}},clearESSDiagnosisFaultDevice:()=>{t([])}}},Xi=[{label:\"neteco.pvms.plantDiagnosis.solor.config.option1\",value:0},{label:\"neteco.pvms.plantDiagnosis.solor.config.option2\",value:1}],Ji=[{label:\"neteco.pvms.weather.day.monday\",value:1},{label:\"neteco.pvms.weather.day.tuesday\",value:2},{label:\"neteco.pvms.weather.day.wednesday\",value:3},{label:\"neteco.pvms.weather.day.thursday\",value:4},{label:\"neteco.pvms.weather.day.friday\",value:5},{label:\"neteco.pvms.weather.day.saturday\",value:6},{label:\"neteco.pvms.weather.day.sunday\",value:7}],$i=e=>{let{visible:t,onOk:n,onCancel:r}=e;const{translate:i}=(0,Tr.qM)(),o=qr(),{dayOfWeek:a,setDayOfWeek:s,indicatorList:c,setIndicatorList:u,indicatorTable:p,setIndicatorTable:f}=Oi(),[h,v]=(0,l.useState)(!1),[y,b]=(0,l.useState)(1),[S,x]=(0,l.useState)(1);(0,l.useEffect)((()=>{b(0===a?0:1),x(a||1)}),[a]);const w=[{dataIndex:\"indicatorTypeName\",title:i(\"neteco.pvms.plantDiagnosis.essDiagnosis.itemStatistic.column1\")},{dataIndex:\"indicatorName\",title:i(\"neteco.pvms.plantDiagnosis.table.columnTitle.diagItem\")},{dataIndex:\"riskLevel\",title:i(\"neteco.pvms.plantDiagnosis.table.columnTitle.faultLevel\"),render:e=>gi[e]?i(gi[e]):e},{dataIndex:\"status\",title:()=>(0,D.jsxs)(br.Z,{children:[(0,D.jsx)(\"div\",{children:i(\"neteco.pvms.plantDiagnosis.essDiagnosis.settingModal.items.column.status\")}),(0,D.jsx)(d.Z,{title:i(\"neteco.pvms.plantDiagnosis.essDiagnosis.settingModal.items.column.status.tip\"),children:(0,D.jsx)(Zr.Z,{})})]}),render:(e,t)=>(0,D.jsx)(Br.Z,{checked:1===e,checkedChildren:i(\"neteco.pvms.open\"),unCheckedChildren:i(\"neteco.pvms.close\"),onChange:e=>{const n=(0,Sr.cloneDeep)(p),r=n.find((e=>e.bizId===t.bizId));r&&(r.status=e?1:0),f(n)}})}];return(0,D.jsxs)(m.Z,{className:\"nco-ess-diagnosis-setting-modal\",confirmLoading:h,visible:t,title:i(\"neteco.pvms.stationInfo.addStation.configBtn\"),width:\"56.25rem\",maskClosable:!1,onCancel:r,onOk:async()=>{try{v(!0);const t=(0,Sr.cloneDeep)(c);t.forEach((e=>{const t=p.find((t=>t.indicatorName===e.indicatorName));e.status=t.status})),u(t);const r={stationDn:o,dayOfWeek:a,indicatorList:t},s=await(e=>(0,O.v_)(\"/rest/dp/pvms/diagnose/v1/ess/inspect-period\",e))(r);s?(e={message:i(\"neteco.pvms.station.availability.paramSetting.success\")},Fr.Z.success({...Wr(\"success\",e),...e}),n()):Kr({message:i(\"neteco.pvms.station.availability.paramSetting.failed\")})}catch(e){Kr({message:i(\"neteco.pvms.station.availability.paramSetting.failed\")})}finally{v(!1)}var e},children:[(0,D.jsx)(rn.Z,{message:i(\"neteco.pvms.plantDiagnosis.essDiagnosis.settingModal.alert\"),type:\"info\",showIcon:!0,closable:!0}),(0,D.jsx)(\"div\",{className:\"diagnosis-period-title\",children:i(\"neteco.pvms.plantDiagnosis.essDiagnosis.settingModal.period.title\")}),(0,D.jsxs)(br.Z,{className:\"diagnosis-period-content\",children:[(0,D.jsx)(\"div\",{className:\"diagnosis-period-label\",children:i(\"neteco.pvms.plantDiagnosis.essDiagnosis.itemStatistic.time\")}),(0,D.jsx)(Ue.Z,{value:y,options:Xi.map((e=>({...e,label:i(e.label)}))),onChange:e=>{b(e),x(e),s(e)}}),1===y&&(0,D.jsx)(Ue.Z,{value:S,options:Ji.map((e=>({...e,label:i(e.label)}))),onChange:e=>{x(e),s(e)}})]}),(0,D.jsx)(\"div\",{className:\"diagnosis-items-title\",children:i(\"neteco.pvms.plantDiagnosis.essDiagnosis.settingModal.items.title\")}),(0,D.jsx)(\"div\",{className:\"diagnosis-items-table-wrapper\",children:(0,D.jsx)(g.Z,{dataSource:p,columns:w,rowKey:\"bizId\",scroll:{y:320},pagination:!1})})]})},eo=(0,l.memo)($i);var to=[\"className\",\"rotate\",\"spin\",\"style\",\"color\"];function no(e){return no=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e},no(e)}function ro(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function io(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ro(Object(n),!0).forEach((function(t){oo(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ro(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function oo(e,t,n){return t=function(e){var t=function(e){if(\"object\"!==no(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,\"string\");if(\"object\"!==no(n))return n;throw new TypeError(\"@@toPrimitive must return a primitive value.\")}return String(e)}(e);return\"symbol\"===no(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ao=function(e){return(0,D.jsxs)(\"svg\",io(io({fill:\"currentColor\",viewBox:\"0 0 24 24\",width:\"1em\",height:\"1em\"},e),{},{children:[(0,D.jsx)(\"defs\",{children:(0,D.jsx)(\"clipPath\",{children:(0,D.jsx)(\"rect\",{x:0,y:0,width:24,height:24,rx:0})})}),(0,D.jsx)(\"path\",{d:\"M11.25,4.31066L11.25,21.5C11.25,21.9142,11.58579,22.25,12,22.25C12.41421,22.25,12.75,21.9142,12.75,21.5L12.75,4.31066L16.9693,8.52994L16.9697,8.53033C17.110300000000002,8.67098,17.301099999999998,8.75,17.5,8.75C17.698900000000002,8.75,17.889699999999998,8.67098,18.0303,8.53033C18.171,8.38968,18.25,8.19891,18.25,8C18.25,7.80109,18.171,7.61032,18.0303,7.46967L18.029899999999998,7.46928L12.53033,1.96967C12.38968,1.8290176,12.19891,1.75,12,1.75C11.80109,1.7499999403954,11.61032,1.8290176,11.46967,1.96967L5.96967,7.46967C5.8290176,7.61032,5.75,7.80109,5.75,8C5.7500000596046,8.19891,5.8290177,8.38968,5.96967,8.53033C6.110322,8.67098,6.301088,8.75,6.5,8.75C6.698912,8.75,6.88968,8.67098,7.03033,8.53033L11.25,4.31066Z\",fillRule:\"evenodd\",fill:\"currentColor\",transform:\"matrix(1,-1.6081230200044232e-16,1.6081230200044232e-16,1,0,0) matrix(1,-1.6081230200044232e-16,1.6081230200044232e-16,1,0,8.881784197001252e-16)\"})]}))};const so=function(e){var t=e.className,n=e.rotate,r=e.spin,i=e.style,o=e.color,a=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,to),s=\"dpicon\",l={msTransform:\"rotate(\".concat(n,\"deg)\"),transform:\"rotate(\".concat(n,\"deg)\")},c=Boolean(n)?l:void 0,u=Qe()(s,t,oo({},\"\".concat(s,\"-spin\"),Boolean(r)));return(0,D.jsx)(\"span\",io(io({style:io({color:o},i),role:\"img\",className:u},a),{},{children:(0,D.jsx)(ao,{style:io({},c)})}))};var lo=n(31746);const co={[ii.healthDegree]:\"neteco.pvms.plantDiagnosis.health.diagnose\",[ii.consistency]:\"neteco.pvms.plantDiagnosis.consistency.diagnose\",[ii.chargingAndDischarging]:\"neteco.pvms.plantDiagnosis.charging.and.discharging.diagnose\",[ii.operation]:\"neteco.pvms.plantDiagnosis.essDiagnosis.statistic.operation\",[ii.eliminateDeficiency]:\"neteco.pvms.plantDiagnosis.essDiagnosis.statistic.eliminateDeficiency\"},uo=\"INCREASE\",po=\"DECREASE\",fo=\"UNCREASE\",ho={[uo]:\"neteco.pvms.plantDiagnosis.essDiagnosis.statistic.compare.increase\",[po]:\"neteco.pvms.plantDiagnosis.essDiagnosis.statistic.compare.decrease\",[fo]:\"neteco.pvms.plantDiagnosis.essDiagnosis.statistic.compare.uncrease\"},mo=(e,t)=>(0,Sr.isNumber)(t)&&(0,Sr.isNumber)(e)?Math.abs(e-t):V.Ot,go=(e,t)=>(0,Sr.isNumber)(t)&&(0,Sr.isNumber)(e)?t<e?uo:t>e?po:fo:fo,vo=e=>{const{currentStatistic:t,baseStatistic:n}=Ni(),{currentQuantity:r,compareLastTimeAmount:i,compareLastTimeType:o,loading:a}=(0,l.useMemo)((()=>{var r,i;const o=null!==(r=t[e])&&void 0!==r?r:t,a=null!==(i=n[e])&&void 0!==i?i:n,s=t.loading||n.loading;let l={},c={};return e?(l=mo(o,a),c=go(o,a)):Object.values(ii).forEach((e=>{l[e]=mo(t[e],n[e]),c[e]=go(t[e],n[e])})),{currentQuantity:o,compareLastTimeAmount:l,compareLastTimeType:c,loading:s}}),[e,t,n]);return{currentQuantity:r,compareLastTimeAmount:i,compareLastTimeType:o,loading:a}},yo=e=>{let{essType:t}=e;const{translate:n}=(0,Tr.qM)(),{currentQuantity:r,compareLastTimeAmount:i,compareLastTimeType:o,loading:a}=vo(t),s=ho[o],l=s?n(s,{amount:i}):\"\";return(0,D.jsxs)(\"div\",{className:\"ess-card-container\",children:[(0,D.jsx)(\"div\",{className:\"card-title\",title:n(co[t]),children:n(co[t])}),a?(0,D.jsx)(\"div\",{className:\"card-loading-wrapper\",children:(0,D.jsx)(b.Z,{})}):(0,D.jsxs)(\"div\",{className:\"card-content\",children:[(0,D.jsxs)(\"div\",{className:\"diagnosis-content\",children:[(0,D.jsxs)(\"div\",{className:\"diagnosis-current\",children:[(0,D.jsx)(\"div\",{className:\"diagnosis-amount\",children:(0,Sr.isNumber)(r)?r:V.Ot}),(0,Sr.isNumber)(r)&&(0,D.jsx)(\"div\",{className:\"diagnosis-unit\",children:n(\"neteco.pvms.station.availability.chart.unit\")})]}),(0,D.jsxs)(\"div\",{className:`diagnosis-compare ${(0,st.HD)(o)?o.toLowerCase():\"\"}`,children:[(0,D.jsx)(\"div\",{className:\"compare-desc\",title:l,children:l}),o===uo&&(0,D.jsx)(so,{}),o===po&&(0,D.jsx)(lo.Z,{})]})]}),(0,D.jsx)(\"div\",{className:\"diagnosis-label\",children:n(\"neteco.pvms.plantDiagnosis.abnormal.diagnosis.items\")})]})]})},bo=()=>(0,D.jsxs)(\"div\",{className:\"nco-ess-card-list-wrap\",children:[(0,D.jsx)(yo,{essType:ii.healthDegree}),(0,D.jsx)(yo,{essType:ii.consistency}),(0,D.jsx)(yo,{essType:ii.chargingAndDischarging}),(0,D.jsx)(yo,{essType:ii.operation}),(0,D.jsx)(yo,{essType:ii.eliminateDeficiency})]}),So=(0,l.memo)(bo),xo=()=>{const{translate:e}=(0,Tr.qM)(),t=qr(),{essDiagnosisDate:n,setESSDiagnosisDate:r,timeRange:i,setTimeRange:o}=xi(),{inspectDateList:a,getESSDiagnoseTime:c,getESSDiagnosePeriod:u}=Oi(),{handleQuery:d,handleClear:p}=(()=>{const{translate:e}=vi(),t=qr(),{timeRange:n,clearConditionInfo:r}=xi(),{refreshStatistic:i,clearStatistic:o}=Ni(),{queryDeviceStatistic:a,clearDeviceStatistic:s}=Li(),{queryFaultCountStatistic:l,clearFaultCountStatistic:c}=Bi(),{queryDeviceRank:u,clearDeviceRank:d}=Ui(),{queryDiagnosisItemStatistic:p,clearDiagnosisItemStatistic:f}=Wi(),{queryESSDiagnosisFaultDevice:h,clearESSDiagnosisFaultDevice:m}=Qi();return{handleQuery:(n,r)=>{if(0===n.length)return o={message:e(\"neteco.pvms.plantDiagnosis.essDiagnosis.selectDate.tip\")},void Fr.Z.warning({...Wr(\"warning\",o),...o});var o;const[s,c]=n;i(s,c,t,r),a(s,c,t),l(s,c,t),u(s,c,t),p(s,c,t),h(s,c,t)},handleClear:()=>{r(),o(),s(),c(),d(),f(),m()}}})(),{visible:f,openModal:m,closeModal:g}=(()=>{const[e,t]=(0,l.useState)(!1);return{visible:e,openModal:(0,l.useCallback)((()=>t(!0)),[]),closeModal:(0,l.useCallback)((()=>t(!1)),[])}})(),v=vo(),{currentStatistic:y}=Ni(),b=(0,l.useMemo)((()=>y&&Object.keys((0,Sr.omit)(y,[\"loading\"])).some((e=>y[e]>0))),[y]);(0,l.useEffect)((()=>{t&&(c(t).then((e=>{if(e.length>0){const t=s()(e[e.length-1]);r(t);const n=Qr(t);o(n),d(n,e)}else p()})),u(t))}),[t]);const S=(0,l.useCallback)((()=>{const{currentQuantity:e,compareLastTimeAmount:n,compareLastTimeType:r}=v,[o,a]=i,s=Object.keys(n).map((t=>({diagnoseTypeId:t,total:e[t],monthToMonth:n[t],trend:r[t]})));return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,O.v_)($r,e)}({startTime:o,endTime:a,stationDn:t,overview:s})}),[t,i,v]),x=(0,l.useCallback)((()=>{g(),u(t),(0,st.xb)(i)||d(i,a)}));return(0,D.jsxs)(\"div\",{className:\"nco-ess-top-bar-wrap\",children:[(0,D.jsxs)(br.Z,{size:8,children:[(0,D.jsx)(xr.Z,{value:n,disabledDate:e=>!a.includes(e.valueOf()),onChange:e=>{r(e);const t=Qr(e);o(t)},allowClear:!1}),(0,D.jsx)(h.Z,{type:\"primary\",onClick:()=>d(i,a),children:e(\"common.button.search\")}),(0,D.jsx)(Rr,{getTasks:ti,createExportTask:S,downloadReport:ri,deleteTask:ni,canDownload:b}),(0,D.jsx)(\"div\",{className:\"operations\",children:(0,D.jsx)(h.Z,{icon:(0,D.jsx)(wr.Z,{style:{color:\"#111A2CE5\"}}),onClick:m,type:\"text\"})})]}),(0,D.jsx)(eo,{visible:f,onOk:x,onCancel:()=>{g(),u(t)}})]})},wo=(0,l.memo)(xo);var Co=n(48312),To=n(72786);const Ao=()=>{const{translate:e}=(0,Tr.qM)(),{loading:t,options:n}=Li();return(0,D.jsxs)(\"div\",{className:\"statistic-chart-item\",children:[(0,D.jsx)(\"div\",{className:\"statistic-chart-item-title\",children:e(\"neteco.pvms.plantDiagnosis.essDiagnosis.deviceStatistic.title\")}),(0,D.jsx)(\"div\",{className:\"statistic-chart-item-content\",children:t?(0,D.jsx)(b.Z,{}):(0,D.jsx)(\"div\",{className:\"device-statistic\",children:(0,D.jsx)(H.Z,{options:n,leftYaxis:e(\"neteco.pvms.comparePlants.number\")})})})]})},Eo=()=>{const{translate:e}=(0,Tr.qM)(),t=(0,l.useRef)(null),{loading:n,faultCount:r}=Bi(),{exceptionItemTotal:i,severeCount:o,moderateCount:a,mildCount:s}=r,c={total:{value:i,iconColor:null,title:e(\"neteco.pvms.plantDiagnosis.essDiagnosis.amountStatistic.total\")},severe:{value:o,iconColor:\"#F46465\",title:e(\"neteco.pvms.plantDiagnosis.essDiagnosis.deviceStatistic.severe\")},moderate:{value:a,iconColor:\"#F59869\",title:e(\"neteco.pvms.plantDiagnosis.essDiagnosis.deviceStatistic.moderate\")},mild:{value:s,iconColor:\"#999999\",title:e(\"neteco.pvms.plantDiagnosis.essDiagnosis.deviceStatistic.mild\")}};t.current&&(()=>{const e=To.init(t.current),n={series:[{type:\"pie\",label:{show:!1},radius:[\"73%\",\"100%\"],emphasis:{scale:!1},data:[c.mild,c.moderate,c.severe].map((e=>({value:e.value,name:e.title,itemStyle:{color:e.iconColor}})))}]};e.setOption(n)})();const u=e=>{var t,n,r,i;let{type:o}=e;return(0,D.jsxs)(\"div\",{className:\"amount-statistic-item\",children:[(0,D.jsx)(\"div\",{className:Qe()(\"item-value\",{\"item-value-big\":\"total\"===o}),children:null===(t=c[o])||void 0===t?void 0:t.value}),(0,D.jsxs)(\"div\",{className:\"item-key\",children:[(null===(n=c[o])||void 0===n?void 0:n.iconColor)&&(0,D.jsx)(\"div\",{className:\"item-icon\",style:{backgroundColor:null===(r=c[o])||void 0===r?void 0:r.iconColor}}),(0,D.jsx)(\"div\",{className:\"item-title\",children:null===(i=c[o])||void 0===i?void 0:i.title})]})]})};return(0,D.jsxs)(\"div\",{className:\"statistic-chart-item\",children:[(0,D.jsx)(\"div\",{className:\"statistic-chart-item-title\",children:e(\"neteco.pvms.plantDiagnosis.essDiagnosis.amountStatistic.title\")}),(0,D.jsxs)(\"div\",{className:\"statistic-chart-item-content\",children:[n&&(0,D.jsx)(b.Z,{}),(0,st.xb)(r)&&(0,D.jsx)(Co.Z,{}),!n&&!(0,st.xb)(r)&&(0,D.jsxs)(\"div\",{className:\"amount-statistic\",children:[(0,D.jsxs)(\"div\",{className:\"amount-statistic-overview\",children:[(0,D.jsx)(u,{type:\"total\"}),(0,D.jsxs)(\"div\",{className:\"amount-statistic-items\",children:[(0,D.jsx)(u,{type:\"severe\"}),(0,D.jsx)(u,{type:\"moderate\"}),(0,D.jsx)(u,{type:\"mild\"})]})]}),(0,D.jsx)(\"div\",{ref:t,className:\"amount-statistic-chart\"})]})]})]})},Oo=()=>{const{translate:e}=(0,Tr.qM)(),{loading:t,rankList:n,options:r}=Ui();return(0,D.jsxs)(\"div\",{className:\"statistic-chart-item\",children:[(0,D.jsx)(\"div\",{className:\"statistic-chart-item-title\",children:e(\"neteco.pvms.plantDiagnosis.essDiagnosis.deviceRank.title\")}),(0,D.jsx)(\"div\",{className:\"statistic-chart-item-content\",children:t?(0,D.jsx)(b.Z,{}):(0,D.jsxs)(\"div\",{className:\"device-rank\",children:[(0,D.jsx)(\"div\",{className:\"device-title\",children:n.map(((e,t)=>(0,D.jsxs)(\"div\",{className:\"device-title-item\",children:[(0,D.jsx)(\"div\",{className:\"item-index\",children:t+1}),(0,D.jsx)(\"div\",{className:\"item-name\",title:e.dnName||V.Ot,children:e.dnName||V.Ot})]},t)))}),(0,D.jsx)(H.Z,{options:r})]})})]})},Mo=()=>(0,D.jsxs)(\"div\",{className:\"nco-ess-statistic-charts-container\",children:[(0,D.jsx)(Ao,{}),(0,D.jsx)(Eo,{}),(0,D.jsx)(Oo,{})]}),Po=(0,l.memo)(Mo),Do=()=>{const{translate:e}=(0,Tr.qM)(),{essDiagnosisDate:t}=xi(),{loading:n,diagnosisItemList:r}=Wi(),i=r.map(((e,t)=>({...e,index:t}))),o=[{key:\"diagnoseTypeName\",dataIndex:\"diagnoseTypeName\",title:e(\"neteco.pvms.plantDiagnosis.essDiagnosis.itemStatistic.column1\"),width:\"25%\"},{key:\"diagnoseName\",dataIndex:\"diagnoseName\",title:e(\"neteco.pvms.plantDiagnosis.table.columnTitle.diagItem\"),width:\"25%\"},{key:\"deviceTypeName\",dataIndex:\"deviceTypeName\",title:e(\"neteco.pvms.plantDiagnosis.essDiagnosis.itemStatistic.column3\"),width:\"20%\"},{key:\"deviceTotal\",dataIndex:\"deviceTotal\",title:e(\"neteco.pvms.plantDiagnosis.essDiagnosis.itemStatistic.column4\"),defaultSortOrder:\"descend\",sorter:(e,t)=>e.deviceTotal-t.deviceTotal,width:\"10%\"},{key:\"deviceNormalTotal\",dataIndex:\"deviceNormalTotal\",title:e(\"neteco.pvms.plantDiagnosis.essDiagnosis.itemStatistic.column5\"),sorter:(e,t)=>e.deviceNormalTotal-t.deviceNormalTotal,width:\"10%\"},{key:\"deviceExceptionTotal\",dataIndex:\"deviceExceptionTotal\",title:e(\"neteco.pvms.plantDiagnosis.essDiagnosis.itemStatistic.column6\"),width:\"10%\",sorter:(e,t)=>e.deviceExceptionTotal-t.deviceExceptionTotal}];return(0,D.jsxs)(\"div\",{className:\"nco-ess-statistic-diagnosis-item-table\",children:[(0,D.jsxs)(\"div\",{className:\"diagnosis-item-statistic-header\",children:[(0,D.jsx)(\"div\",{className:\"diagnosis-item-statistic-title\",children:e(\"neteco.pvms.plantDiagnosis.essDiagnosis.itemStatistic.title\")}),(0,D.jsxs)(\"div\",{className:\"diagnosis-item-statistic-time\",children:[(0,D.jsx)(\"span\",{children:e(\"neteco.pvms.plantDiagnosis.essDiagnosis.itemStatistic.time\")}),(0,D.jsx)(\"span\",{children:null==t?void 0:t.format(\"YYYY/MM/DD\")})]})]}),(0,D.jsx)(\"div\",{className:\"diagnosis-item-statistic-table-container\",children:(0,D.jsx)(g.Z,{sortDirections:[\"descend\",\"ascend\"],dataSource:i,columns:o,loading:n,pagination:!1,rowKey:\"index\",scroll:{y:400}})})]})},Io=(0,l.memo)(Do),No=Symbol(\"visible\"),_o=()=>{const[e,t]=yr(ur,No,!1),{setParentDnId:n,setParentDnName:r}=Ho(),{handleQuery:i}=Uo();return{visible:e,open:(0,l.useCallback)(((e,o)=>{n(e),r(o),t(!0),i(e,o)}),[t,n,r,i]),close:(0,l.useCallback)((()=>t(!1)),[t])}},jo=Symbol(\"page\"),ko=Symbol(\"pageSize\"),Lo=Symbol(\"total\"),Ro=Symbol(\"totalException\"),Zo=Symbol(\"detailData\"),Bo=Symbol(\"parentDnId\"),Fo=Symbol(\"parentDnName\"),zo=Symbol(\"detailDataLoading\"),Vo=[],Ho=()=>{const[e,t]=yr(ur,jo,1),[n,r]=yr(ur,ko,10),[i,o]=yr(ur,Lo,0),[a,s]=yr(ur,Ro,0),[l,c]=yr(ur,Zo,Vo),[u,d]=yr(ur,Bo,null),[p,f]=yr(ur,Fo,null),[h,m]=yr(ur,zo);return{page:e,setPage:t,pageSize:n,setPageSize:r,total:i,totalException:a,setTotal:o,detailData:l,setDetailData:c,setTotalException:s,parentDnId:u,parentDnName:p,setParentDnId:d,setParentDnName:f,loading:h,setLoading:m}},Uo=()=>{const{translate:e}=vi(),{page:t,parentDnId:n,pageSize:r,setPage:i,setDetailData:o,setPageSize:a,setTotal:s,setTotalException:c,setLoading:u}=Ho(),{timeRange:d}=xi(),p=(0,l.useCallback)((t=>{const{detailList:n,totalNum:r,totalException:i}=null!=t?t:{};(0,Sr.isNil)(n)||(0,Sr.isNil)(r)||(o(n.map((t=>((e,t)=>{const{diagnoseDetailList:n=[]}=null!=e?e:{},r=[],i=[],o=[];return n.forEach((e=>{let{diagnoseName:t,diagnoseTypeName:n,diagnoseTime:a}=e;r.push(t),i.includes(n)||i.push(n),o.push(a)})),{...e,spliceDiagnoseName:r.join(t(\"neteco.pvms.rule.separator.label\")),spliceDiagnoseTypeName:i.join(t(\"neteco.pvms.rule.separator.label\")),lastDiagnoseTime:(0,Sr.max)(o)}})(t,e)))),s(r),c(i))}),[]),f=(0,l.useCallback)((()=>{s(0),o(Vo),i(1),a(10)}),[s,o,i,a]);return{handleQuery:(0,l.useCallback)((e=>{const[n,i]=d;u(!0),ei(n,i,e,t,r).then(p,f).finally((()=>u(!1)))}),[d,n,t,r,p,f]),handlePaginationChange:(0,l.useCallback)(((e,t)=>{u(!0),i(e),a(t);const[r,o]=d;ei(r,o,n,e,t).then(p,f).finally((()=>u(!1)))}),[d,n,i,a,p,f]),resetDetailModalInfo:(0,l.useCallback)((()=>{i(1),a(10),s(0),o(Vo)}),[i,a,s,o])}},Go=[{title:\"neteco.pvms.plantDiagnosis.device.name\",width:\"12%\",dataIndex:\"dnName\",render:(e,t)=>{const{dnId:n,dnName:r,open:i}=t;return(0,D.jsx)(\"a\",{onClick:()=>{i(n,r)},children:r})}},{title:\"neteco.pvms.plantDiagnosis.table.columnTitle.diagItem\",dataIndex:\"diagnoseName\",render:e=>e||V.lH},{title:\"neteco.pvms.plantDiagnosis.essDiagnosis.overviewInfo.column.totalFaultCount\",width:\"10%\",dataIndex:\"totalFaultCount\",render:e=>null!=e?e:V.lH,defaultSortOrder:\"descend\",sorter:(e,t)=>e.totalFaultCount-t.totalFaultCount},{title:\"neteco.pvms.plantDiagnosis.essDiagnosis.overviewInfo.column.severeFaultCount\",width:\"10%\",dataIndex:\"severeFaultCount\",render:e=>null!=e?e:V.lH,sorter:(e,t)=>e.severeFaultCount-t.severeFaultCount},{title:\"neteco.pvms.plantDiagnosis.essDiagnosis.overviewInfo.column.moderateFaultCount\",width:\"10%\",dataIndex:\"moderateFaultCount\",render:e=>null!=e?e:V.lH,sorter:(e,t)=>e.moderateFaultCount-t.moderateFaultCount},{title:\"neteco.pvms.plantDiagnosis.essDiagnosis.overviewInfo.column.mildFaultCount\",width:\"10%\",dataIndex:\"mildFaultCount\",render:e=>null!=e?e:V.lH,sorter:(e,t)=>e.mildFaultCount-t.mildFaultCount},{title:\"neteco.pvms.plantDiagnosis.diagnosis.type\",width:\"20%\",dataIndex:\"diagnoseType\",render:e=>e||V.lH}],Yo=()=>{var e;const{translate:t}=(0,Tr.qM)(),{open:n}=_o(),{essDiagnosisDate:r}=xi(),{essDiagnosisList:i,loading:o}=Qi(),[a,s]=(0,l.useState)(10),c=(0,l.useMemo)((()=>i.map(((e,t)=>({key:t,...e,open:n})))),[i,n]),u=(0,l.useMemo)((()=>Go.map((e=>({...e,title:t(e.title)})))),[t]);return(0,D.jsxs)(\"div\",{className:\"nco-ess-diagnosis-content-wrap\",children:[(0,D.jsxs)(\"div\",{className:\"ess-diagnosis-content-title\",children:[(0,D.jsx)(\"span\",{className:\"title\",children:t(\"neteco.pvms.plantDiagnosis.essDiagnosis.overviewInfo.title\")}),(0,D.jsxs)(\"span\",{className:\"diagnosis-time\",children:[(0,D.jsx)(\"span\",{children:t(\"neteco.pvms.plantDiagnosis.essDiagnosis.itemStatistic.time\")}),(0,D.jsx)(\"span\",{children:null==r?void 0:r.format(\"YYYY/MM/DD\")})]})]}),(0,D.jsx)(g.Z,{sortDirections:[\"descend\",\"ascend\"],columns:u,dataSource:c,pagination:{showQuickJumper:!0,pageSize:a,showSizeChanger:!0,total:null!==(e=null==c?void 0:c.length)&&void 0!==e?e:0,showTotal:e=>t(\"neteco.pvms.station.subarray.pagination.total\",{total:e}),totalFixedLeft:!0,onChange:(e,t)=>s(t)},size:\"large\",loading:o,scroll:{y:\"16rem\"}})]})},Wo=(0,l.memo)(Yo);var Ko=[\"className\",\"rotate\",\"spin\",\"style\",\"color\"];function qo(e){return qo=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e},qo(e)}function Qo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qo(Object(n),!0).forEach((function(t){Jo(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Jo(e,t,n){return t=function(e){var t=function(e){if(\"object\"!==qo(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,\"string\");if(\"object\"!==qo(n))return n;throw new TypeError(\"@@toPrimitive must return a primitive value.\")}return String(e)}(e);return\"symbol\"===qo(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var $o=function(e){return(0,D.jsx)(\"svg\",Xo(Xo({fill:\"currentColor\",viewBox:\"0 0 24 24\",width:\"1em\",height:\"1em\"},e),{},{children:(0,D.jsx)(\"path\",{d:\"M4.24036,21.25L2,21.25C1.585786,21.25,1.25,20.9142,1.25,20.5C1.25,20.0858,1.585786,19.75,2,19.75L3.49036,19.75L3.49042,11.25802Q3.49045,7.73388,5.9824,5.24194Q8.47436,2.75,11.9985,2.75Q15.5227,2.75,18.0146,5.241960000000001Q20.5066,7.73392,20.5066,11.25809L20.5066,19.75L22,19.75C22.4142,19.75,22.75,20.0858,22.75,20.5C22.75,20.9142,22.4142,21.25,22,21.25L4.24036,21.25ZM19.0066,19.75L19.0066,11.25809Q19.0066,8.35524,16.954,6.30262Q14.9014,4.25,11.9985,4.25Q9.09568,4.25,7.04306,6.3026Q4.9904399999999995,8.35521,4.99042,11.25803L4.99036,19.75L19.0066,19.75ZM13.1363,10.418C13.2193,10.29439,13.2636,10.14888,13.2636,10C13.2636,9.58579,12.9278,9.25,12.5136,9.25C12.2637,9.25,12.0302,9.37449,11.8909,9.582L9.87729,12.58174C9.79431,12.70536,9.75,12.8509,9.75,12.9997C9.75,13.414,10.08579,13.7497,10.5,13.7497L12.0774,13.7497L10.82669,15.5763C10.74124,15.701,10.69551,15.8488,10.69551,16C10.69551,16.4142,11.0313,16.75,11.4455,16.75C11.693,16.75,11.9245,16.6279,12.0643,16.4237L14.1188,13.4235C14.2312,13.2594,14.2738,13.0573,14.2372,12.8618C14.2006,12.66629,14.0879,12.49331,13.9237,12.38093C13.799,12.29548,13.6512,12.24975,13.5,12.24975L11.9068,12.24975L13.1363,10.418L13.1363,10.418Z\",fillRule:\"evenodd\",fill:\"currentColor\"})}))};const ea=function(e){var t=e.className,n=e.rotate,r=e.spin,i=e.style,o=e.color,a=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,Ko),s=\"dpicon\",l={msTransform:\"rotate(\".concat(n,\"deg)\"),transform:\"rotate(\".concat(n,\"deg)\")},c=Boolean(n)?l:void 0,u=Qe()(s,t,Jo({},\"\".concat(s,\"-spin\"),Boolean(r)));return(0,D.jsx)(\"span\",Xo(Xo({style:Xo({color:o},i),role:\"img\",className:u},a),{},{children:(0,D.jsx)($o,{style:Xo({},c)})}))},ta={[oi]:\"neteco.pvms.plantDiagnosis.temperature.details\",[ai]:\"neteco.pvms.plantDiagnosis.humidity.details\",[si]:\"neteco.pvms.plantDiagnosis.voltage.details\",[li]:\"neteco.pvms.plantDiagnosis.cell.soc.details\",[ci]:\"neteco.pvms.plantDiagnosis.charge.and.discharge.power.details\",[ui]:\"neteco.pvms.plantDiagnosis.cooling.system.details\",[di]:\"neteco.pvms.plantDiagnosis.insulation.resistance.details\",[pi]:\"neteco.pvms.plantDiagnosis.insulation.resistance.details\",[fi]:\"neteco.pvms.plantDiagnosis.system.derating.details\",[hi]:\"neteco.pvms.plantDiagnosis.system.derating.details\",[mi]:\"neteco.pvms.plantDiagnosis.soh.details\"},na=Symbol(\"dnName\"),ra=Symbol(\"chartTitle\"),ia=Symbol(\"leftYaxis\"),oa=Symbol(\"rightYaxis\"),aa=Symbol(\"option\"),sa={series:[{data:[]}]},la=()=>{const[e,t]=yr(dr,na,\"\"),[n,r]=yr(dr,ra,\"\"),[i,o]=yr(dr,ia,\"\"),[a,s]=yr(dr,oa,\"\"),[l,c]=yr(dr,aa,sa);return{dnName:e,setDnName:t,chartTitle:n,setChartTitle:r,leftYaxis:i,setLeftYaxis:o,rightYaxis:a,setRightYaxis:s,option:l,setOption:c}},ca=Symbol(\"visible\"),ua=Symbol(\"loading\"),da=()=>{const{translate:e}=vi(),[t,n]=yr(dr,ca,!1),[r,i]=yr(dr,ua,!1),{setDnName:o,setOption:a,setRightYaxis:c,setChartTitle:u,setLeftYaxis:d}=la();return{loading:r,visible:t,open:(0,l.useCallback)((t=>{let{dn:r,dnName:l,diagnoseId:p,diagnoseTime:f}=t;n(!0),i(!0),o(l);const[h,m]=((e,t)=>\"smartpvms.energystorage.indicator.8\"===t||\"smartpvms.energystorage.indicator.24\"===t?[s()(e).subtract(6,\"day\").startOf(\"day\").valueOf(),s()(e).add(1,\"day\").startOf(\"day\").valueOf()]:[s()(e).startOf(\"day\").valueOf(),s()(e).add(1,\"day\").startOf(\"day\").valueOf()])(f,p);((e,t,n,r)=>{const i=`${Xr}${Jr}/chart`,o={startTime:e,endTime:t,deviceDn:n,diagnoseItem:r};return(0,O.U2)(i,o)})(h,m,r,p).then((t=>{const{chartData:n,chartType:r}=null!=t?t:{};if(n&&n.length>0){var i;a(ha(t,h,m,e));const[o,s]=n.map((e=>e.unit));d(o),c(s);const l=null!==(i=e(ta[r]))&&void 0!==i?i:\"\";u(l)}})).finally((()=>{i(!1)}))}),[n,o,d,a,u]),close:(0,l.useCallback)((()=>{n(!1),a(sa)}),[n,a])}},pa=[\"#5990FD\",\"#6ACA94\",\"#D975FA\",\"#999999\",\"#FDC000\",\"#3ba272\"],fa=\"#00000000\",ha=(e,t,n,r)=>{const{chartType:i,chartData:o}=e,a=o[0].lines,l=((e,t)=>{let n={type:\"value\",axisLine:{onZero:!1},min:e,max:t,minInterval:18e5,maxInterval:36e5,axisLabel:{formatter:function(e){return s()(e).format(\"HH:mm\")}},axisLine:{onZero:!1},splitLine:{show:!1}};return t-e>2592e5&&(n={...n,interval:864e5,axisLabel:{formatter:function(e){return s()(e).format(\"MM/DD\")}}}),{legend:{icon:\"rect\",bottom:30},color:pa,grid:{top:6,left:12,right:18,bottom:105,containLabel:!0},xAxis:n,yAxis:{type:\"value\",axisLine:{show:!1},axisTick:{show:!1},scale:!0},tooltip:{trigger:\"axis\",formatter:e=>{const t=`<p>${Ta(e[0].axisValue)}</p>`,n=e.map((e=>{let{seriesName:t,data:n,seriesIndex:r=0}=e;return`<div style=\"padding-bottom: 8px;display: flex;align-items: center;\">\\n            <span style=\"background-color: ${pa[r]}; width: 8px; height: 8px; float: left; margin-right: 8px;\">\\n            </span>\\n            <span style=\"font-size: ; color: rgba(17, 26, 44, 0.9); margin-right: 16px\">\\n              ${t}\\n            </span>\\n            <span style=\"font-size: ; color: rgba(17, 26, 44, 0.9); 16px\">\\n              ${n[1]}\\n            </span>\\n          </div>`})).join(\"\");return`<div>${t}${n}</div>`}},dataZoom:[{left:35,right:35,bottom:65,type:\"slider\",show:!0,labelFormatter:\"\"}],visualMap:[],series:[{data:[]}]}})(t,n);switch(i){case oi:return{...l,...ma(a)};case ai:return{...l,...ga(a)};case si:return{...l,...va(o)};case\"SOC\":return{...l,...ya(a)};case ci:return{...l,...ba(o,r)};case ui:return(0,Sr.merge)(l,function(e){const t=[];(null!=e?e:[]).map(((e,n)=>{let{lines:r}=e;r.forEach((e=>{let{label:r,points:i}=e;const o=i.map((e=>{let{time:t,value:n}=e;return[t,null!=n?n:V.Ot]})),a=wa(i),s={normal:{color:new To.graphic.LinearGradient(0,1,0,0,[{offset:.4,color:`${pa[n]}00`},{offset:1,color:`${pa[n]}33`}]),origin:\"start\"}};t.push({type:\"line\",name:r,smooth:!0,data:o,markArea:a,areaStyle:s,sampling:\"average\",yAxisIndex:n})}))}));const n={formatter:e=>{const t=`<p>${Ta(e[0].axisValue)}</p>`,n=e.map((e=>{let{seriesName:t,data:n,seriesIndex:r}=e,i=n[1];return`<div style=\"padding-bottom: 8px;display: flex;align-items: center;\">\\n          <span style=\"background-color: ${pa[r]}; width: 8px; height: 8px; float: left; margin-right: 8px;\">\\n          </span>\\n          <span style=\"font-size: ; color: rgba(17, 26, 44, 0.9); margin-right: 16px\">\\n            ${t}\\n          </span>\\n          <span style=\"font-size: ; color: rgba(17, 26, 44, 0.9); 16px\">\\n            ${i}\\n          </span>\\n        </div>`})).join(\"\");return`<div>${t}${n}</div>`}};return{grid:{bottom:130},dataZoom:[{bottom:90}],tooltip:n,yAxis:[{type:\"value\",splitNumber:5,axisLine:{show:!1},axisTick:{show:!1},scale:!0},{type:\"value\",position:\"right\",splitNumber:5,axisLine:{show:!1},axisTick:{show:!1},scale:!0}],series:t}}(o));case\"ISO\":case pi:return{...l,...Sa(a)};case fi:case hi:return{...l,...ma(a)};case\"SOH\":return{...l,...ya(a)};default:return sa}};function ma(e){const t=e.map(((e,t)=>{const{label:n,points:r}=e;return{type:\"line\",name:n,smooth:!0,data:r.map((e=>{let{time:t,value:n}=e;return[t,null!=n?n:V.Ot]})),markArea:wa(r),areaStyle:{normal:{color:new To.graphic.LinearGradient(0,1,0,0,[{offset:.4,color:`${pa[t]}00`},{offset:1,color:`${pa[t]}33`}]),origin:\"start\"}},sampling:\"average\"}}));return{visualMap:e.map(((e,t)=>{let{points:n}=e;return{type:\"piecewise\",show:!1,dimension:0,seriesIndex:t,pieces:Ca(n),outOfRange:{color:pa[t]}}})),series:t}}function ga(e){const t=e.map(((e,t)=>{const{label:n,points:r}=e;return{type:\"line\",name:n,smooth:!0,data:r.map((e=>{let{time:t,value:n}=e;return[t,null!=n?n:V.Ot]})),markArea:wa(r),areaStyle:{normal:{color:new To.graphic.LinearGradient(0,1,0,0,[{offset:.4,color:`${pa[t]}00`},{offset:1,color:`${pa[t]}33`}]),origin:\"start\"}},sampling:\"average\"}}));return{visualMap:e.map(((e,t)=>{let{points:n}=e;return{type:\"piecewise\",show:!1,dimension:0,seriesIndex:t,pieces:Ca(n),outOfRange:{color:pa[t]}}})),series:t}}function va(e){if(e.length>1){let t=0;const n=[],r=e.map(((e,r)=>{let{lines:i}=e;return i.map((e=>{const{label:i,points:o}=e,a=o.map((e=>{let{time:t,value:n}=e;return[t,null!=n?n:V.Ot]})),s=Ca(o),l=wa(o),c={normal:{color:new To.graphic.LinearGradient(0,1,0,0,[{offset:.4,color:`${pa[t]}00`},{offset:1,color:`${pa[t]}33`}]),origin:\"start\"}};return n.push({type:\"piecewise\",show:!1,dimension:0,seriesIndex:t,pieces:s,outOfRange:{color:pa[t]}}),t++,{type:\"line\",name:i,smooth:!0,data:a,markArea:l,areaStyle:c,sampling:\"average\",yAxisIndex:r}}))}));return{yAxis:[{type:\"value\",axisLine:{show:!1},axisTick:{show:!1},scale:!0},{type:\"value\",position:\"right\",axisLine:{show:!1},axisTick:{show:!1},scale:!0}],visualMap:n,series:[...r[0],...r[1]]}}{const t=e[0].lines,n=t.map(((e,t)=>{const{label:n,points:r}=e;return{type:\"line\",name:n,smooth:!0,data:r.map((e=>{let{time:t,value:n}=e;return[t,null!=n?n:V.Ot]})),markArea:wa(r),areaStyle:{normal:{color:new To.graphic.LinearGradient(0,1,0,0,[{offset:.4,color:`${pa[t]}00`},{offset:1,color:`${pa[t]}33`}]),origin:\"start\"}},sampling:\"average\"}}));return{visualMap:t.map(((e,t)=>{let{points:n}=e;return{type:\"piecewise\",show:!1,dimension:0,seriesIndex:t,pieces:Ca(n),outOfRange:{color:pa[t]}}})),series:n}}}function ya(e){return{series:e.map(((e,t)=>{const{label:n,points:r}=e;return{type:\"line\",smooth:!0,name:n,data:r.map((e=>{let{time:t,value:n}=e;return[t,null!=n?n:V.Ot]})),markArea:wa(r),areaStyle:{normal:{color:new To.graphic.LinearGradient(0,1,0,0,[{offset:.4,color:`${pa[t]}00`},{offset:1,color:`${pa[t]}33`}]),origin:\"start\"}}}})),visualMap:e.map(((e,t)=>{let{points:n}=e;return{type:\"piecewise\",show:!1,dimension:0,seriesIndex:t,pieces:Ca(n),outOfRange:{color:pa[t]}}}))}}function ba(e,t){var n,r,i,o;let a=[null==e||null===(n=e[0])||void 0===n||null===(r=n.lines)||void 0===r?void 0:r[0],null==e||null===(i=e[1])||void 0===i||null===(o=i.lines)||void 0===o?void 0:o[0]];a=a.filter(Boolean);let s=[];if(a.length>1){const e=a[0].isSpecial?1:0,n=a[0].isSpecial?0:1,r=a[n],i=a[e],o=r.points.map((e=>{let{time:t,value:n}=e;return[t,null!=n?n:V.Ot]})),l=i.points.map((e=>{let{time:t,value:n}=e;return[t,null!=n?n:V.Ot]}));s=[{type:\"line\",name:t(\"neteco.pvms.thirdInterface.itemCode.charge_power\"),data:o,sampling:\"average\",itemStyle:{color:\"#5990FD\"},yAxisIndex:n},{type:\"line\",name:t(\"neteco.pvms.thirdInterface.itemCode.discharge_power\"),data:o,sampling:\"average\",itemStyle:{color:\"#6ACA94\"},yAxisIndex:n},{type:\"line\",smooth:!0,name:i.label,data:l,sampling:\"average\",itemStyle:{color:\"#D975FA\"},yAxisIndex:e}]}else if(1===a.length){var l,c;const e=null!==(l=null===(c=a[0].points)||void 0===c?void 0:c.map((e=>{let{time:t,value:n}=e;return[t,null!=n?n:V.Ot]})))&&void 0!==l?l:[];var u;s=a[0].isSpecial?[{type:\"line\",name:t(\"neteco.pvms.thirdInterface.itemCode.charge_power\"),data:e,sampling:\"average\",itemStyle:{color:\"#5990FD\"},yAxisIndex:0},{type:\"line\",name:t(\"neteco.pvms.thirdInterface.itemCode.discharge_power\"),data:e,sampling:\"average\",itemStyle:{color:\"#6ACA94\"},yAxisIndex:0}]:[{type:\"line\",smooth:!0,name:null!==(u=a[0].label)&&void 0!==u?u:\"\",data:e,sampling:\"average\",itemStyle:{color:\"#5990FD\"},yAxisIndex:0}]}const d={formatter:e=>{const t=`<p>${Ta(e[0].axisValue)}</p>`,n=e.map((e=>{let{seriesName:t,data:n,seriesIndex:r}=e,i=n[1];return 0===r?i<0&&(i=V.Ot):1===r&&(i=i>0?V.Ot:Math.abs(i)),`<div style=\"padding-bottom: 8px;display: flex;align-items: center;\">\\n          <span style=\"background-color: ${pa[r]}; width: 8px; height: 8px; float: left; margin-right: 8px;\">\\n          </span>\\n          <span style=\"font-size: ; color: rgba(17, 26, 44, 0.9); margin-right: 16px\">\\n            ${t}\\n          </span>\\n          <span style=\"font-size: ; color: rgba(17, 26, 44, 0.9); 16px\">\\n            ${i}\\n          </span>\\n        </div>`})).join(\"\");return`<div>${t}${n}</div>`}};return{tooltip:d,yAxis:[{type:\"value\",splitNumber:5,axisLine:{show:!1},axisTick:{show:!1},scale:!0},{type:\"value\",position:\"right\",splitNumber:5,axisLine:{show:!1},axisTick:{show:!1},scale:!0}],visualMap:[{show:!1,dimension:1,seriesIndex:0,pieces:[{gt:0,lt:Number.MAX_SAFE_INTEGER,color:\"#5990FD\"}],outOfRange:{color:fa}},{show:!1,dimension:1,seriesIndex:1,pieces:[{lt:0,gt:Number.MIN_SAFE_INTEGER,color:\"#6ACA94\"}],outOfRange:{color:fa}}],series:s}}function Sa(e){const t=e.map(((e,t)=>{const{label:n,points:r}=e;return{type:\"line\",name:n,smooth:!0,data:r.map((e=>{let{time:t,value:n}=e;return[t,null!=n?n:V.Ot]})),areaStyle:{normal:{color:new To.graphic.LinearGradient(0,1,0,0,[{offset:.4,color:`${pa[t]}00`},{offset:1,color:`${pa[t]}33`}]),origin:\"start\"}},sampling:\"average\"}}));return{visualMap:e.map(((e,t)=>{let{points:n}=e;return{type:\"piecewise\",show:!1,dimension:0,seriesIndex:t,outOfRange:{color:pa[t]}}})),series:t}}function xa(e){const t=[];let n=null;const r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e5)/2;return e.forEach((e=>{let{time:i,isException:o}=e;o?null===n?(n={start:i-r,end:i+r},t.push(n)):n.end=i+r:n=null})),t}function wa(e){return{itemStyle:{color:\"#F4314619\"},data:xa(e).map((e=>{let{start:t,end:n}=e;return[{xAxis:t},{xAxis:n}]}))}}function Ca(e){return xa(e).map((e=>{let{start:t,end:n}=e;return{gte:t,lte:n,color:\"#F43146\"}}))}function Ta(e){return s()(Number(e)).format(\"YYYY/MM/DD HH:mm\")}function Aa(e){let{text:t=\"\",maxLine:n=2}=e;const r=(0,l.useMemo)((()=>t.replace(/\\\\r|\\r/g,\"\").replace(/\\\\n/g,\"\\n\").split(/\\n/).map(((e,t)=>(0,D.jsx)(\"p\",{className:\"nco-plant-diag-suggestions-text-paragraph\",children:e},t)))),[t,n]);return n>0?(0,D.jsx)(d.Z,{overlayClassName:\"nco-plant-diag-suggestions-text\",needCheckEllipsis:!0,maxLine:isFinite(n)?n:null,title:r,children:r}):r}const Ea=[{title:\"ncoEnergyStorageSearchForm.label.device\",width:\"25%\",dataIndex:\"dnPath\"},{title:\"neteco.pvms.plantDiagnosis.table.columnTitle.diagItem\",width:\"50%\",dataIndex:\"spliceDiagnoseName\"},{title:\"neteco.pvms.plantDiagnosis.diagnosis.type\",width:\"25%\",dataIndex:\"spliceDiagnoseTypeName\"}],Oa=e=>{let{operation:t}=e;const{translate:n}=(0,Tr.qM)();return(0,D.jsx)(d.Z,{placement:\"top\",title:n(\"neteco.pvms.station.availability.ECO.columns.reason\"),color:\"#fff\",overlayInnerStyle:{color:\"#191919\"},children:(0,D.jsx)(\"div\",{onClick:t,className:\"ess-diagnosis-detail-expanded-operation-icon-container\",children:(0,D.jsx)(p.Z,{})})})},Ma=e=>{let{operation:t}=e;const{translate:n}=(0,Tr.qM)();return(0,D.jsx)(d.Z,{placement:\"top\",title:n(\"neteco.pvms.plantDiagnosis.modal.alert.tips\"),color:\"#fff\",overlayInnerStyle:{color:\"#191919\"},children:(0,D.jsx)(\"div\",{onClick:t,className:\"ess-diagnosis-detail-expanded-operation-icon-container\",children:(0,D.jsx)(ea,{})})})},Pa=[],Da=()=>{const{translate:e}=(0,Tr.qM)(),{visible:t,close:n}=_o(),{page:r,pageSize:i,parentDnName:o,total:a,detailData:s,totalException:c,loading:u}=Ho(),{handlePaginationChange:d,resetDetailModalInfo:p}=Uo(),f=(0,l.useMemo)((()=>((e,t)=>e.map((e=>({...e,title:t(e.title)}))))(Ea,e)),[e]),v=(0,l.useMemo)((()=>s.map(((e,t)=>({...e,key:t})))),[s]),{isShowExpandAll:y,expandable:b,resetExpand:S,expandAll:x}=(e=>{const{translate:t}=(0,Tr.qM)(),{open:n}=da(),[r,i]=(0,l.useState)(Pa),o=(0,l.useMemo)((()=>(e=>[{title:e(\"neteco.pvms.plantDiagnosis.table.columnTitle.diagItem\"),width:\"195px\",dataIndex:\"diagnoseName\"},{title:e(\"neteco.pvms.plantDiagnosis.diagnosis.type\"),width:\"100px\",dataIndex:\"diagnoseTypeName\"},{title:e(\"neteco.pvms.plantDiagnosis.table.columnTitle.faultLevel\"),width:\"100px\",dataIndex:\"faultLevel\",render:t=>gi[t]?e(gi[t]):t},{title:e(\"neteco.pvms.plantDiagnosis.exception.cause\"),width:\"280px\",dataIndex:\"reason\",render:e=>(0,D.jsx)(Aa,{text:e,maxLine:4})},{title:e(\"neteco.pvms.plantDiagnosis.detail.column.possibleRisk\"),width:\"200px\",dataIndex:\"possibleRisk\",render:e=>(0,D.jsx)(Aa,{text:e,maxLine:4})},{title:e(\"neteco.pvms.plantDiagnosis.table.columnTitle.searchAdvice\"),width:\"495px\",dataIndex:\"suggestion\",render:e=>(0,D.jsx)(Aa,{text:e,maxLine:4})},{title:e(\"common.label.action\"),width:\"80px\",dataIndex:\"operation\",render:e=>e}])(t)),[t]),a=(0,l.useCallback)((e=>{const{diagnoseDetailList:t=[],dn:r,dnId:i,dnName:a}=e||{},s=t.map(((e,t)=>({key:t,...e,operation:\"smartpvms.energystorage.indicator.32\"!==e.diagnoseId?(0,D.jsx)(Oa,{operation:()=>n({dn:r,dnId:i,dnName:a,...e})}):(0,D.jsx)(Ma,{operation:()=>{window.open(`/pvmswebsite/assets/build/index.html#${pp(dp.deviceSubmatrixAlarm.path,r)}`,\"_blank\",\"noopener=yes,noreferrer=yes\")}})})));return(0,D.jsx)(g.Z,{columns:o,dataSource:s,pagination:!1,size:\"large\"})}),[o]),s=(0,l.useMemo)((()=>!e.map((e=>e.key)).every((e=>r.includes(e)))),[r,e]),c=(0,l.useCallback)((()=>i(Pa)),[]),u=(0,l.useCallback)((()=>{i(e.map((e=>e.key)))}),[e]);return{isShowExpandAll:s,expandable:{expandedRowRender:a,expandedRowKeys:r,onExpandedRowsChange:i},resetExpand:c,expandAll:u}})(v),w=e(y?\"neteco.pvms.plantDiagnosis.expand.all\":\"neteco.pvms.plantDiagnosis.shrinke.all\"),C=(0,l.useCallback)((()=>{y?x():S()}),[y,x,S]),T=(0,l.useCallback)(((e,t)=>{S(),d(e,t)}),[S,d]);(0,l.useEffect)((()=>{t||(S(),p())}),[t]);const A=(0,l.useMemo)((()=>1===c?e(\"neteco.pvms.plantDiagnosis.one.of.exceptions.identified\"):e(\"neteco.pvms.plantDiagnosis.number.of.exceptions.identified\",{number:null!=c?c:0})),[c,e]);return(0,D.jsx)(m.Z,{visible:t,title:o,maskClosable:!1,onCancel:n,footer:null,width:\"84.75rem\",wrapClassName:\"nco-ess-diagnosis-detail-modal\",getContainer:()=>document.querySelector(\".nco-monitor-layout-container\"),children:(0,D.jsxs)(\"div\",{className:\"nco-ess-diagnosis-detail-modal-container\",children:[(0,D.jsxs)(\"div\",{className:\"top-bar-container\",children:[(0,D.jsx)(\"div\",{className:\"description-text\",children:A}),(0,D.jsx)(h.Z,{onClick:C,children:w})]}),(0,D.jsx)(g.Z,{scroll:{y:800},columns:f,dataSource:v,pagination:!1,size:\"large\",expandable:b,loading:!!(0,st.xb)(u)||u}),(0,D.jsx)(\"div\",{className:\"pagination-shell\",children:(0,D.jsx)(at.Z,{showQuickJumper:!0,totalFixedLeft:!0,total:a,current:r,pageSize:i,onChange:T,pageSizeOptions:[10,20],showTotal:!1})})]})})},Ia=(0,l.memo)(Da),Na=()=>{const{option:e,dnName:t,chartTitle:n,leftYaxis:r,rightYaxis:i}=la(),{loading:o,visible:a,close:s}=da();return(0,D.jsxs)(m.Z,{destroyOnClose:!0,width:\"84rem\",visible:a,title:t,maskClosable:!1,onCancel:s,footer:null,wrapClassName:\"nco-ess-diagnosis-detail-modal\",getContainer:()=>document.querySelector(\".nco-monitor-layout-container\"),children:[(0,D.jsx)(\"div\",{className:\"chart-title\",children:n}),(0,D.jsx)(\"div\",{className:\"nco-ess-diagnosis-chart-modal-container\",children:o?(0,D.jsx)(b.Z,{style:{width:\"84rem\"}}):(0,D.jsx)(x.Z,{leftYaxis:r,rightYaxis:i,options:e})})]})},_a=(0,l.memo)(Na),ja=()=>(0,D.jsxs)(\"div\",{className:\"nco-ess-diagnosis-view-wrap\",children:[(0,D.jsx)(wo,{}),(0,D.jsx)(So,{}),(0,D.jsx)(Po,{}),(0,D.jsx)(Io,{}),(0,D.jsx)(Wo,{}),(0,D.jsx)(Ia,{}),(0,D.jsx)(_a,{})]});function ka(e){let{elementDn:t}=e;const n=vr(),r=vr(),i=vr();return(0,D.jsx)(ur.Provider,{value:n,children:(0,D.jsx)(dr.Provider,{value:r,children:(0,D.jsx)(pr.Provider,{value:i,children:(0,D.jsx)(fr.Provider,{value:t,children:(0,D.jsx)(ja,{})})})})})}const La=l.memo(ka);var Ra=n(5320),Za=n(20610),Ba=n(2326);function Fa(){const e=(0,Ar.Z)();return{translate:(t,n)=>e.formatMessage({id:t||\"-\"},n),intl:e}}function za(e,t){const{translate:n}=Fa(),r=[...new Set([\"label\",\"title\",...t||[]])];return(0,l.useMemo)((()=>e.map((e=>{const t={...e};return r.forEach((r=>e[r]&&(t[r]=n(e[r])))),t}))),[e,t,n])}const Va=\"NCOPLANTDIAG/SET_STATE\",Ha=\"NCOPLANTDIAG/SET_STATES\",Ua={};function Ga(e,t){switch(t.type){case Va:return{...e,[t.key]:t.value};case Ha:return{...e,...t.value||{}};default:return!0}}const Ya=(0,l.createContext)();function Wa(e){let{children:t}=e;const[n,r]=(0,l.useReducer)(Ga,Ua);return(0,D.jsx)(Ya.Provider,{value:{state:n,dispatch:r},children:t})}const Ka={all:\"all\",light:\"LIGHT\",medium:\"MEDIUM\",major:\"MAJOR\"},qa={[Ka.light]:\"neteco.pvms.plantDiagnosis.tip.faultLevel.light\",[Ka.medium]:\"neteco.pvms.plantDiagnosis.tip.faultLevel.medium\",[Ka.major]:\"neteco.pvms.plantDiagnosis.tip.faultLevel.major\"},Qa={[Ka.light]:{backgroundColor:\"#111A2C19\",color:\"#111A2C99\"},[Ka.medium]:{backgroundColor:\"#EC6F1A19\",color:\"#EC6F1A\"},[Ka.major]:{backgroundColor:\"#F4314619\",color:\"#F43146\"}},Xa=0,Ja=1,$a=2,es=3,ts={[Xa]:\"neteco.pvms.plantDiagnosis.tip.deviceHealthy\",[Ja]:\"neteco.pvms.plantDiagnosis.tip.potentialDanger\",[$a]:\"neteco.pvms.plantDiagnosis.tip.opRequired\",[es]:\"neteco.pvms.icon.state.notConnected\"},ns={[Xa]:\"#2DA769\",[Ja]:\"#EC6F1A\",[$a]:\"#F43146\",[es]:\"#111A2C99\"},rs={pvString:\"PV\",inverter:\"INVERTER\",sts:\"STS\",sppc:\"SPPC\"},is={[rs.pvString]:\"neteco.pvms.devTypeLangKey.string\",[rs.inverter]:\"neteco.pvms.configuration.inverter\",[rs.sts]:\"neteco.pvms.plantDiagnosis.name.sts\",[rs.sppc]:\"neteco.pvms.station.gridConnectionPoint\"},os={[rs.pvString]:1,[rs.inverter]:2,[rs.sts]:3,[rs.sppc]:4},as={PV_AND_CABLE_LOSS:1,INVERTER_LOSS:2,AC_CABLE_LOSS:3,STS_AND_CABLE_LOSS:4},ss={[as.PV_AND_CABLE_LOSS]:[\"neteco.pvms.plantDiagnosis.solar.topology.pvStringLoss\",\"neteco.pvms.plantDiagnosis.solar.topology.pvStringLoss.new\"],[as.INVERTER_LOSS]:[\"neteco.pvms.plantDiagnosis.solar.topology.loss\",\"neteco.pvms.plantDiagnosis.solar.topology.loss.new\"],[as.AC_CABLE_LOSS]:[\"neteco.pvms.plantDiagnosis.solar.topology.acCableLoss\",\"neteco.pvms.plantDiagnosis.solar.topology.acCableLoss.new\"],[as.STS_AND_CABLE_LOSS]:[\"neteco.pvms.plantDiagnosis.solar.topology.stsLoss\",\"neteco.pvms.plantDiagnosis.solar.topology.stsLoss.new\"]},ls={2:\"neteco.pvms.plantDiagnosis.diagItem.abnormal.1\",3:\"neteco.pvms.plantDiagnosis.diagItem.abnormal.2\",4:\"neteco.pvms.plantDiagnosis.diagItem.abnormal.3\",5:\"neteco.pvms.plantDiagnosis.diagItem.abnormal.4\",6:\"neteco.pvms.plantDiagnosis.diagItem.abnormal.5\",7:\"neteco.pvms.plantDiagnosis.diagItem.abnormal.6\",8:\"neteco.pvms.plantDiagnosis.diagItem.abnormal.7\",9:\"neteco.pvms.plantDiagnosis.diagItem.abnormal.8\",10:\"neteco.pvms.plantDiagnosis.diagItem.abnormal.9\",11:\"neteco.pvms.plantDiagnosis.diagItem.abnormal.10\",12:\"neteco.pvms.plantDiagnosis.diagItem.abnormal.11\",13:\"neteco.pvms.plantDiagnosis.diagItem.abnormal.12\",14:\"neteco.pvms.plantDiagnosis.diagItem.abnormal.13\",15:\"neteco.pvms.plantDiagnosis.diagItem.abnormal.14\"},cs=\"pvDiagnoseDay\",us=\"pvDiagnosisSummary\",ds={hyphen:\"YYYY-MM-DD\",slash:\"YYYY/MM/DD\",slashMonth:\"YYYY/MM\",hyphenMonth:\"YYYY-MM\"};function ps(e,t){const{state:n,dispatch:r}=(0,l.useContext)(Ya),i=(0,l.useCallback)((t=>{r({key:e,value:t,type:e?Va:Ha})}),[e]);return(0,l.useEffect)((()=>{e&&(0,st.xb)(n[e])&&!(0,st.xb)(t)&&r({key:e,value:t,type:(0,st.xb)(e)?Ha:Va})}),[e,n,t]),e?(0,st.xb)(n[e])?[t,i]:[n[e],i]:[n,i]}function fs(){return ps(\"pvDiagnosisLoadConfig\",!1)}function hs(){return ps(\"pvDiagnosisUpdateConfig\",!1)}function ms(){return ps(\"pvDiagnosisLoadDetail\",!1)}function gs(){return ps(\"pvDiagnosisLoadSummary\",!1)}const vs=[{label:\"neteco.pvms.plantDiagnosis.solor.config.option1\",value:0},{label:\"neteco.pvms.plantDiagnosis.solor.config.option2\",value:1}],ys=[{label:\"neteco.pvms.weather.day.monday\",value:1},{label:\"neteco.pvms.weather.day.tuesday\",value:2},{label:\"neteco.pvms.weather.day.wednesday\",value:3},{label:\"neteco.pvms.weather.day.thursday\",value:4},{label:\"neteco.pvms.weather.day.friday\",value:5},{label:\"neteco.pvms.weather.day.saturday\",value:6},{label:\"neteco.pvms.weather.day.sunday\",value:7}];function bs(e){let{visible:t,onCancel:n,onOk:r,config:i}=e;const{translate:o}=Fa(),[a,s]=(0,l.useState)(i.diagEn),[c,u]=(0,l.useState)(i.diagnoseFrequencyId),[d,p]=(0,l.useState)(i.dayNumOfWeek),f=za(ys),h=za(vs),[g]=hs(),v=(0,l.useCallback)((()=>{\"function\"==typeof r&&r({diagEn:a,diagnoseFrequencyId:c,dayNumOfWeek:d})}),[a,c,d]);return(0,l.useEffect)((()=>{const{diagEn:e,diagnoseFrequencyId:t,dayNumOfWeek:n}=i;e!==a&&s(e),t!==c&&u(t),n!==d&&p(n)}),[i]),(0,D.jsxs)(m.Z,{destroyOnClose:!0,title:o(\"neteco.pvms.plantDiagnosis.solor.config.title\"),visible:t,onCancel:n,onOk:v,className:\"nco-plant-diag-config-modal\",style:{minWidth:\"520px\"},width:\"min-content\",children:[t&&g&&(0,D.jsx)(\"div\",{className:\"nco-plant-diag-config-modal-loading-layer\",children:(0,D.jsx)(b.Z,{})}),(0,D.jsx)(rn.Z,{className:\"config-alert\",message:o(\"neteco.pvms.plantDiagnosis.solor.config.tip\"),type:\"info\",showIcon:!0}),(0,D.jsxs)(\"div\",{className:\"config-item\",children:[(0,D.jsx)(\"label\",{children:o(\"neteco.pvms.plantDiagnosis.solor.config.label1\")}),(0,D.jsx)(Br.Z,{defaultChecked:!0,checked:a,onChange:s})]}),(0,D.jsxs)(\"div\",{className:\"config-item\",children:[(0,D.jsx)(\"label\",{children:o(\"neteco.pvms.plantDiagnosis.solor.config.label2\")}),(0,D.jsx)(Ue.Z,{className:\"config-item-select\",value:c,onChange:u,disabled:!a,options:h}),1===c&&(0,D.jsx)(Ue.Z,{className:\"config-item-select last\",disabled:!a,value:d,onChange:p,options:f})]})]})}const Ss=l.memo(bs);function xs(e){let{style:t,type:n,className:r=\"\",textId:i,linkTextId:o,onClick:a}=e;const{translate:s}=Fa(),[l]=fs();return(0,D.jsx)(\"div\",{className:`nco-plant-diagnosis-empty ${r}`,style:t,children:l||\"loading\"===n?(0,D.jsx)(b.Z,{}):(0,D.jsx)(Co.Z,{description:(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(\"p\",{style:{marginTop:\"0.5rem\"},children:s(\"neteco.pvms.noData\")}),(0,D.jsx)(\"p\",{children:i&&o&&s(i,{toOpenLink:(0,D.jsx)(\"a\",{style:{color:\"#0A59F7\"},onClick:a,children:o&&s(o)})})})]})})})}var ws=n(29912);function Cs(e){let{faultLevel:t,deviceCount:n}=e;const{translate:r}=Fa();return(0,D.jsx)(\"span\",{className:\"nco-plant-diag-fault-level-tag\",children:(0,D.jsx)(ws.Z,{style:Qa[t],className:\"fault-level-tag\",children:r(qa[t])+(n>=0?\" \"+n:\"\")})})}var Ts=n(36513),As=[\"className\",\"rotate\",\"spin\",\"style\",\"color\"];function Es(e){return Es=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e},Es(e)}function Os(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ms(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Os(Object(n),!0).forEach((function(t){Ps(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Os(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ps(e,t,n){return t=function(e){var t=function(e){if(\"object\"!==Es(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,\"string\");if(\"object\"!==Es(n))return n;throw new TypeError(\"@@toPrimitive must return a primitive value.\")}return String(e)}(e);return\"symbol\"===Es(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ds=function(e){return(0,D.jsx)(\"svg\",Ms(Ms({fill:\"currentColor\",viewBox:\"0 0 24 24\",width:\"1em\",height:\"1em\"},e),{},{children:(0,D.jsx)(\"path\",{d:\"M9.6474067578125,3.9385177929687503L1.6957217578125001,17.07608779296875Q0.8637517578125,18.45058779296875,1.6526837578125,19.85028779296875Q2.4416167578125,21.24998779296875,4.048346757812499,21.24998779296875L19.9516767578125,21.24998779296875Q21.5583767578125,21.24998779296875,22.3472767578125,19.85028779296875Q23.1362767578125,18.45058779296875,22.3042767578125,17.07608779296875L14.3526767578125,3.9385177929687503Q13.5500767578125,2.61247694496875,12.0000767578125,2.61247479916875Q10.4500067578125,2.61247277256875,9.6474067578125,3.9385177929687503ZM11.2499967578125,10.00000779296875L11.2499967578125,13.49998779296875C11.2499967578125,13.91418779296875,11.5857767578125,14.24998779296875,11.9999767578125,14.24998779296875C12.4141767578125,14.24998779296875,12.7499767578125,13.91418779296875,12.7499767578125,13.49998779296875L12.7499767578125,10.00000779296875C12.7499767578125,9.58578779296875,12.4141767578125,9.25000779296875,11.9999767578125,9.25000779296875C11.5857767578125,9.25000779296875,11.2499967578125,9.58578779296875,11.2499967578125,10.00000779296875ZM11.2928767578125,15.20708779296875C10.9023667578125,15.59758779296875,10.9023667578125,16.230787792968748,11.2928767578125,16.62128779296875C11.6833767578125,17.01188779296875,12.3165767578125,17.01188779296875,12.7070767578125,16.62128779296875C13.0976767578125,16.230787792968748,13.0976767578125,15.59758779296875,12.7070767578125,15.20708779296875C12.3165767578125,14.81658779296875,11.6833767578125,14.81658779296875,11.2928767578125,15.20708779296875Z\",fillRule:\"evenodd\",fill:\"currentColor\"})}))};const Is=function(e){var t=e.className,n=e.rotate,r=e.spin,i=e.style,o=e.color,a=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,As),s=\"dpicon\",l={msTransform:\"rotate(\".concat(n,\"deg)\"),transform:\"rotate(\".concat(n,\"deg)\")},c=Boolean(n)?l:void 0,u=Qe()(s,t,Ps({},\"\".concat(s,\"-spin\"),Boolean(r)));return(0,D.jsx)(\"span\",Ms(Ms({style:Ms({color:o},i),role:\"img\",className:u},a),{},{children:(0,D.jsx)(Ds,{style:Ms({},c)})}))};var Ns=n(39207);const _s=n.p+\"static/media/dp_unlink_filled.83712a9f1c8c661116f8d57f24a85fa8.svg\";function js(e){let{alertType:t,deviceCount:n}=e;const{translate:r}=Fa();return(0,D.jsxs)(\"div\",{className:\"nco-pv-diagnosis-alert\",children:[(0,D.jsxs)(\"div\",{className:\"diag-alert-sign\",children:[2===t&&(0,D.jsx)(Is,{className:\"diag-alert-icon\",style:{color:\"#F43146\"}}),1===t&&(0,D.jsx)(Ns.Z,{className:\"diag-alert-icon\",style:{color:\"#EEBA18\"}}),0===t&&(0,D.jsx)(zr.Z,{className:\"diag-alert-icon\",style:{color:\"#2DA769\"}}),3===t&&(0,D.jsx)(\"div\",{className:\"diag-alert-tag\",style:{backgroundColor:ns[t]},children:(0,D.jsx)(\"img\",{src:_s,className:\"icon-not-connected\"})})]}),(0,D.jsx)(\"span\",{className:\"diag-alert-info\",children:r(ts[t]||ts[3])})]})}function ks(e){let{abnormal:t,input:n,output:r,icon:i}=e;const{translate:o}=Fa(),{alertType:a,major:s,medium:l,light:c}=t||{},u=n&&n.value,p=r&&r.value,f=0!==a&&3!==a;return i&&(u||p||f)?(0,D.jsx)(d.Z,{color:\"#fff\",overlayInnerStyle:{minWidth:\"12.875rem\",display:\"inline-block\"},title:(0,D.jsxs)(\"div\",{className:\"nco-pv-diag-topology-item-tooltip\",children:[(0,D.jsx)(\"div\",{className:\"topology-item-tooltip-line title\",children:o(ts[a])}),u&&(0,D.jsxs)(\"p\",{className:\"topology-item-tooltip-line content\",children:[(0,D.jsx)(\"span\",{className:\"label\",children:n.label}),(0,D.jsx)(\"span\",{className:\"value\",children:n.value})]}),p&&(0,D.jsxs)(\"p\",{className:\"topology-item-tooltip-line content\",children:[(0,D.jsx)(\"span\",{className:\"label\",children:r.label}),(0,D.jsx)(\"span\",{className:\"value\",children:r.value})]}),f&&(0,D.jsxs)(\"div\",{className:\"fault-level-area\",children:[(0,D.jsx)(Cs,{faultLevel:Ka.major,deviceCount:s}),(0,D.jsx)(Cs,{faultLevel:Ka.medium,deviceCount:l}),(0,D.jsx)(Cs,{faultLevel:Ka.light,deviceCount:c})]})]}),children:(0,D.jsx)(Ts.Z,{className:\"topology-image\",preview:!1,src:i})}):i&&(0,D.jsx)(Ts.Z,{className:\"topology-image\",preview:!1,src:i})}function Ls(e){let{input:t,output:n,loss:r,showLossTip:i=!1,abnormal:o,device:a=\"\",icon:s=\"\"}=e;const{translate:l}=Fa(),{abnormalDevices:c,alertType:u}=o||{};return(0,D.jsxs)(\"div\",{className:\"topology-item\",\"alert-type\":3===u?\"not-connected\":\"\",children:[(0,D.jsxs)(\"div\",{className:\"topology-item-main\",children:[(0,D.jsx)(\"div\",{className:\"topology-item-alert\",children:a&&(0,D.jsx)(js,{alertType:u,deviceCount:c})}),(0,D.jsx)(\"div\",{className:\"topology-item-image\",children:(0,D.jsx)(ks,{input:t,output:n,abnormal:o,icon:s})}),(0,D.jsxs)(\"div\",{className:\"topology-item-wire\",input:t?\"input\":\"\",output:n?\"output\":\"\",children:[a&&(0,D.jsx)(\"div\",{className:\"topology-item-wire-name before\"}),a&&(0,D.jsx)(\"div\",{className:\"topology-item-wire-name content\",children:a}),(0,D.jsx)(\"div\",{className:\"topology-item-wire-name after\"})]})]}),(r||i)&&(0,D.jsx)(\"div\",{className:\"topology-item-loss-tip\",\"wire-only\":a?\"\":\"wire-only\",children:r&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(\"span\",{className:\"topology-item-loss-tip-label\",children:r.label}),(0,D.jsx)(\"span\",{className:\"topology-item-loss-tip-value\",children:r.value||V.Nw}),r.value&&(0,D.jsxs)(\"span\",{className:\"topology-item-loss-tip-unit\",children:[\" \",l(\"neteco.pvms.unit.KWh\")]})]})})]})}const Rs=n.p+\"static/media/pvString.e6179d377fdddd3e3517.png\",Zs=n.p+\"static/media/inverter.916316e21f27ae9a9b79.png\",Bs=n.p+\"static/media/ppc.ca2b9778cb335a8e48f8.png\",Fs=n.p+\"static/media/sts.79559458d286aa859c91.png\",{PV_AND_CABLE_LOSS:zs,INVERTER_LOSS:Vs,AC_CABLE_LOSS:Hs,STS_AND_CABLE_LOSS:Us}=as,{THEORETICAL_ENERGY_YIELD:Gs,INVERTER_INTPUT_ENERGY:Ys,INVERTER_OUTPUT_ENERGY:Ws,STS_INPUT_ENERGY:Ks,SPPC_ON_GRID_ENERGY:qs}={THEORETICAL_ENERGY_YIELD:1,INVERTER_INTPUT_ENERGY:2,INVERTER_OUTPUT_ENERGY:3,STS_INPUT_ENERGY:4,SPPC_ON_GRID_ENERGY:5};function Qs(e){var t,n,r;let{lossSummary:i,deviceStateSummary:o,electricitySummary:a,calcLoss:s}=e;const{translate:c}=Fa(),{pvLoss:u,inverterLoss:d,acLoss:p,stsLoss:f,energyYield:h}={pvLoss:i[zs],inverterLoss:i[Vs],acLoss:i[Hs],stsLoss:i[Us],energyYield:a[Gs]},m=(0,l.useCallback)(((e,t)=>{const[n,r]=ss[e];return(0,st.hj)(t)?c(n,{percent:`${(t/h*100).toFixed(2)}%`}):c(r)}),[c,h]);return(0,D.jsxs)(\"div\",{className:\"nco-pv-diagnosis-topology\",children:[(0,D.jsx)(Ls,{device:c(\"neteco.pvms.partials.main.dm.devStringDetail.pvIndex\"),input:{label:c(\"neteco.pvms.plantDiagnosis.solar.topology.theoreticalPower\"),value:null==h?void 0:h.toFixed()},abnormal:o[rs.pvString],icon:Rs}),(0,D.jsx)(Ls,{showLossTip:!0,loss:s&&{label:m(zs,u),value:null==u?void 0:u.toFixed()}}),(0,D.jsx)(Ls,{device:c(\"neteco.pvms.configuration.inverter\"),input:{label:c(\"neteco.pvms.plantDiagnosis.solar.topology.inputPower\"),value:null===(t=a[Ys])||void 0===t?void 0:t.toFixed()},output:{label:c(\"neteco.pvms.plantDiagnosis.solar.topology.outputPower\"),value:null===(n=a[Ws])||void 0===n?void 0:n.toFixed()},abnormal:o[rs.inverter],icon:Zs,loss:s&&{label:m(Vs,d),value:null==d?void 0:d.toFixed()}}),(0,D.jsx)(Ls,{showLossTip:!0,loss:s&&{label:m(Hs,p),value:null==p?void 0:p.toFixed()}}),(0,D.jsx)(Ls,{device:c(\"neteco.pvms.plantDiagnosis.name.sts\"),abnormal:o[rs.sts],input:{label:c(\"neteco.pvms.plantDiagnosis.solar.topology.inputPower\"),value:null===(r=a[Ks])||void 0===r?void 0:r.toFixed()},icon:Fs})]})}const Xs=l.memo(Qs),Js=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:\"hyphen\";const n=s()(e);return e&&n.isValid()?n.format(ds[t]||ds.hyphen):e},$s={[rs.pvString]:0,[rs.inverter]:1,[rs.sts]:2,[rs.sppc]:3};function el(e){let{intl:t,calcLoss:n}=e;const r=(0,l.useMemo)((()=>(e=>[{title:\"neteco.pvms.plantDiagnosis.table.columnTitle.diagItem\",key:\"diagnoseItem\",dataIndex:\"diagnoseItem\"},{title:\"neteco.pvms.plantDiagnosis.table.columnTitle.diagType\",key:\"diagnoseItemType\",dataIndex:\"diagnoseItemType\"},{title:\"ncoHomeSearchBarView.label.stationDeviceTypes\",key:\"deviceType\",dataIndex:\"deviceType\",sorter:!0,render:t=>e.formatMessage({id:is[t]})},{title:\"neteco.pvms.plantDiagnosis.table.columnTitle.faultLevel\",key:\"faultLevel\",dataIndex:\"faultLevel\",render:e=>(0,D.jsx)(Cs,{faultLevel:e}),filters:[{text:e.formatMessage({id:\"neteco.pvms.plantDiagnosis.tip.faultLevel.light\"}),value:Ka.light},{text:e.formatMessage({id:\"neteco.pvms.plantDiagnosis.tip.faultLevel.medium\"}),value:Ka.medium},{text:e.formatMessage({id:\"neteco.pvms.plantDiagnosis.tip.faultLevel.major\"}),value:Ka.major}],onFilter:e=>e},{title:\"neteco.pvms.plantDiagnosis.table.columnTitle.abnormalDeviceCount\",key:\"faultDeviceNum\",dataIndex:\"faultDeviceNum\",sorter:!0}])(t)),[t]),[i]=gs(),[{pvDiagnoseDay:o,pvDiagnosisSummary:{diagnosisItemSummary:a,lossSummary:s,deviceStateSummary:c,electricitySummary:u}}]=ps(),[d,p]=(0,l.useState)({faultLevelList:new Set(Object.values(Ka)),sorter:{columnKey:\"deviceType\",field:\"deviceType\",order:\"ascend\"}}),f=(0,l.useMemo)((()=>{const{faultLevelList:e,sorter:t}=d,{order:n,field:r}=t,i=a.filter((t=>e.has(t.faultLevel)&&t.faultDeviceNum>0));return\"deviceType\"===r?((e,t)=>{const n=[[],[],[],[]];return t?(e.forEach((e=>{const r=$s[e.deviceType];n[\"ascend\"===t?r:3-r].push(e)})),n.reduce(((e,t)=>[...e,...t]),[])):e})(i,n):((e,t)=>t?e.sort(((e,n)=>\"ascend\"===t?e.faultDeviceNum-n.faultDeviceNum:n.faultDeviceNum-e.faultDeviceNum)):e)(i,n)}),[a,d]),h=(0,l.useCallback)((function(){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const t=new Set((arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).faultLevel||Object.values(Ka));t===d.faultLevelList&&e===d.sorter||p({...d,faultLevelList:t,sorter:e})}),[a,d]);return(0,D.jsxs)(\"div\",{className:\"nco-pv-diagnosis-overview\",children:[(0,D.jsx)(\"div\",{className:\"nco-pv-diagnosis-topology-area\",children:i?(0,D.jsx)(xs,{type:\"loading\",style:{height:\"11.5rem\",backgroundColor:\"transparent\"}}):(0,D.jsx)(Xs,{lossSummary:s,deviceStateSummary:c,electricitySummary:u,calcLoss:n})}),(0,D.jsxs)(\"div\",{className:\"nco-pv-diagnosis-table-area\",children:[(0,D.jsxs)(\"div\",{className:\"nco-plant-diag-table-header\",children:[(0,D.jsx)(\"span\",{className:\"nco-plant-diag-table-title\",children:t.formatMessage({id:\"neteco.pvms.plantDiagnosis.solar.table.title.overview.new\"})}),(0,D.jsx)(\"span\",{className:\"nco-plant-diag-table-subtitle\",children:`${t.formatMessage({id:\"neteco.pvms.plantDiagnosis.tip.diagTime\"})}${Js(o,\"slash\")}`})]}),(0,D.jsx)(\"div\",{className:\"nco-plant-diag-table-main\",children:(0,D.jsx)(g.Z,{rowKey:\"diagnoseId\",columns:za(r),dataSource:f,pagination:!1,loading:i,onChange:h})})]})]})}const tl=l.memo(el);function nl(e){let{icon:t,deviceType:n}=e;const{translate:r}=Fa(),[{deviceStateSummary:i,diagnosisItemSummary:o}]=ps(us),{alertType:a,abnormalDevices:s,diagnosisItems:c}=(0,l.useMemo)((()=>{const e=[],{alertType:t,abnormalDevices:a}=i[n];return o.forEach((t=>{const{deviceType:i,faultDeviceNum:o,diagnoseId:a}=t;n===i&&o>0&&e.push({diagItemName:r(ls[a]),deviceCount:o})})),{alertType:t,abnormalDevices:a,diagnosisItems:e}}),[i,o]);return(0,D.jsxs)(\"div\",{className:\"nco-plant-diag-statistic-panel\",children:[(0,D.jsxs)(\"div\",{className:\"left-area\",children:[(0,D.jsx)(js,{alertType:a,deviceCount:s}),(0,D.jsx)(Ts.Z,{preview:!1,src:t,className:\"device-icon\"})]}),(0,D.jsxs)(\"div\",{className:\"right-area\",children:[(0,D.jsx)(\"p\",{className:\"title\",children:r(\"neteco.pvms.partials.main.io.dispersion_iv.delResult\")}),(0,D.jsxs)(\"div\",{className:\"statistic-items\",children:[(0,D.jsx)(\"div\",{className:\"statistic-items-content\",children:c.map((e=>(0,D.jsxs)(\"div\",{className:\"statistic-item\",children:[(0,D.jsxs)(\"p\",{children:[(0,D.jsx)(\"span\",{className:\"device-count\",children:e.deviceCount}),(0,D.jsx)(\"span\",{className:\"statistic-unit\",children:r(\"neteco.pvms.comparePlants.number\")})]}),(0,D.jsx)(\"p\",{className:\"diag-item-name\",children:e.diagItemName})]},e.diagItemName)))}),c.length<=0&&(0,D.jsx)(\"span\",{className:\"empty-content\",children:r(\"neteco.pvms.plantDiagnosis.tip.noAbnormal\")})]})]})]})}const rl=l.memo(nl);function il(e){const[t,n]=ms(),[r,i]=(0,l.useState)([]);return(0,l.useEffect)((()=>{var t;e&&(n(!0),(t=e,(0,O.v_)(\"/rest/dp/pvms/diagnose/v1/photovoltaic/detail\",t)).then((e=>{i(e||[]),n(!1)})).catch((e=>{i([]),n(!1)})))}),[e]),r}function ol(e){let{icon:t,tableColumns:n,deviceType:r,title:i,stationDn:o}=e;const{intl:a,translate:s}=Fa(),[{pvDiagnoseDay:c}]=ps(),[u]=ms(),[d,p]=(0,l.useState)({stationDn:o,diagnoseDay:Js(c),locale:a.locale,currPage:1,pageSize:10,faultLevelStrList:`${Ka.light},${Ka.medium},${Ka.major}`,deviceTypeList:r}),{total:f,list:h}=il(d),m=(0,l.useMemo)((()=>(0,st.kJ)(h)?h.map(((e,t)=>({key:t,...e}))):[]),[h]),v=(0,l.useMemo)((()=>({total:f,size:\"default\",totalFixedLeft:!0,pageSizeOptions:[5,10,20,30],showQuickJumper:!0,showSizeChanger:!0,showSizeJumper:!0,showTotal:e=>e&&s(\"neteco.pvms.station.subarray.pagination.total\",{total:e})})),[f]),y=(0,l.useCallback)((function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{current:r,pageSize:i}=t,o=(null===(e=n.faultLevel)||void 0===e?void 0:e.join(\",\"))||`${Ka.light},${Ka.medium},${Ka.major}`;r===d.currPage&&i===d.pageSize&&o===d.faultLevelStrList||p({...d,currPage:r,pageSize:i,faultLevelStrList:o})}),[d]);return(0,l.useEffect)((()=>{const e=Js(c);!o||o===d.stationDn&&e===d.diagnoseDay||p({...d,stationDn:o,diagnoseDay:e})}),[o,c,d]),(0,D.jsxs)(\"div\",{className:\"nco-pv-diagnosis-view-template\",children:[(0,D.jsx)(\"div\",{className:\"nco-pv-diagnosis-statistic-area\",children:(0,D.jsx)(rl,{icon:t,deviceType:r})}),(0,D.jsxs)(\"div\",{className:\"nco-pv-diagnosis-table-area\",children:[(0,D.jsx)(\"div\",{className:\"nco-plant-diag-table-header\",children:(0,D.jsx)(\"span\",{className:\"nco-plant-diag-table-title\",children:i})}),(0,D.jsx)(\"div\",{className:\"nco-plant-diag-table-main\",children:(0,D.jsx)(g.Z,{columns:n,dataSource:m,pagination:v,loading:u,onChange:y})})]})]})}const al=l.memo(ol);function sl(e){let{text:t=\"\",maxLine:n=2}=e;const r=(0,l.useMemo)((()=>t.replace(/\\\\r|\\r/g,\"\").replace(/\\\\n/g,\"\\n\").split(/\\n/).map(((e,t)=>(0,D.jsx)(\"p\",{className:\"nco-plant-diag-suggestions-text-paragraph\",children:e},t)))),[t,n]);return n>0?(0,D.jsx)(d.Z,{overlayClassName:\"nco-plant-diag-suggestions-text\",needCheckEllipsis:!0,maxLine:isFinite(n)?n:null,title:r,children:r}):r}function ll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{translate:t}=Fa();return za((0,l.useMemo)((()=>[{title:\"ncoPvTable.column.deviceName\",key:\"deviceName\",dataIndex:\"deviceName\"},{title:\"neteco.pvms.plantDiagnosis.table.columnTitle.pvStringNo\",key:\"deviceNameAttached\",dataIndex:\"deviceNameAttached\",disabled:!0},{title:\"neteco.pvms.plantDiagnosis.table.columnTitle.abnormalDiagItemCount\",key:\"diagnoseItem\",dataIndex:\"diagnoseItem\"},{title:\"neteco.pvms.plantDiagnosis.table.columnTitle.diagType\",key:\"diagnoseItemType\",dataIndex:\"diagnoseItemType\"},{title:\"neteco.pvms.plantDiagnosis.table.columnTitle.faultLevel\",key:\"faultLevel\",dataIndex:\"faultLevel\",render:e=>(0,D.jsx)(Cs,{faultLevel:e}),filters:[{text:t(\"neteco.pvms.plantDiagnosis.tip.faultLevel.light\"),value:Ka.light},{text:t(\"neteco.pvms.plantDiagnosis.tip.faultLevel.medium\"),value:Ka.medium},{text:t(\"neteco.pvms.plantDiagnosis.tip.faultLevel.major\"),value:Ka.major}],onFilter:e=>e},{title:\"neteco.pvms.plantDiagnosis.table.columnTitle.faultReason\",key:\"faultCause\",dataIndex:\"faultCause\",width:\"18.3%\",render:e=>e?(0,D.jsx)(sl,{text:e}):\"\"},{title:\"neteco.pvms.intelAlarm.getSuggestion\",key:\"faultRecoverAdvice\",dataIndex:\"faultRecoverAdvice\",width:\"31.2%\",render:e=>e?(0,D.jsx)(sl,{text:e}):\"\"},{title:\"ncoEnergyStorageSearchForm.label.statisticTime\",key:\"statDay\",dataIndex:\"statDay\",render:e=>Js(e,\"slash\")}].filter((t=>{const{dataIndex:n}=t,{disabled:r=!1}=e[n]||t;return!r})).map((t=>{const{dataIndex:n}=t,{disabled:r,...i}=e[n]||{};return{...t,...i}}))),[e]))}function cl(e){let{intl:t,stationDn:n}=e;const r=ll((0,l.useRef)({deviceName:{title:\"neteco.pvms.cascadedInverter.busiName\"},deviceNameAttached:{disabled:!1}}).current);return(0,D.jsx)(al,{icon:Rs,title:t.formatMessage({id:\"neteco.pvms.plantDiagnosis.solar.table.title.pvString\"}),deviceType:rs.pvString,tableColumns:r,stationDn:n})}const ul=l.memo(cl);function dl(e){let{text:t,onClick:n}=e;return(0,D.jsx)(\"a\",{className:\"nco-plant-diag-clickable-table-cell\",onClick:n,children:t})}function pl(e){let{visible:t,afterClose:n,deviceDn:r,deviceName:i,deviceType:o,stationDn:a}=e;const{translate:s,intl:c}=Fa(),[u,d]=(0,l.useState)(!1),[{pvDiagnoseDay:p}]=ps(),[f,h]=(0,l.useState)({stationDn:a,deviceDn:r,diagnoseDay:Js(p),deviceTypeList:o,currPage:1,pageSize:50,locale:c.locale,faultLevelStrList:`${Ka.light},${Ka.medium},${Ka.major}`}),{list:v}=il(f),y=(0,l.useMemo)((()=>(0,st.kJ)(v)?v.map(((e,t)=>({key:t,...e}))):[]),[v]),[b]=ms(),S=ll((0,l.useRef)({deviceName:{disabled:!0},faultCause:{width:\"16rem\"},faultRecoverAdvice:{width:\"24rem\"}}).current),x=(0,l.useCallback)((function(){var e;let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};h({...f,faultLevelStrList:(null===(e=t.faultLevel)||void 0===e?void 0:e.join(\",\"))||`${Ka.light},${Ka.medium},${Ka.major}`})}),[f]);return(0,l.useEffect)((()=>{const e={deviceDn:r,stationDn:a,pvDiagnoseDay:Js(p),deviceType:o};Object.keys(e).some((t=>f[t]!==e[t]))&&h({...f,...e})}),[r,a,p,o]),(0,l.useEffect)((()=>d(t)),[t]),(0,D.jsxs)(m.Z,{destroyOnClose:!0,title:(0,D.jsxs)(\"div\",{className:\"nco-plant-diag-detail-modal-title\",children:[(0,D.jsx)(\"span\",{className:\"title\",children:i}),(0,D.jsxs)(\"span\",{className:\"subtitle\",children:[c.formatMessage({id:\"neteco.pvms.plantDiagnosis.tip.diagTime\"}),Js(p,\"slash\")]})]}),width:1200,visible:u,onCancel:()=>d(!1),footer:null,bodyStyle:{paddingBottom:\"24px\"},className:\"nco-plant-diag-detail-modal\",afterClose:n,children:[(0,D.jsx)(\"div\",{className:\"header\",style:{marginBottom:\"1rem\"},children:1!==(null==v?void 0:v.length)?s(\"neteco.pvms.plantDiagnosis.tip.diagStatistic\",{num:(null==v?void 0:v.length)||0}):s(\"neteco.pvms.plantDiagnosis.tip.diagStatistic.singular\")}),(0,D.jsx)(g.Z,{columns:S,dataSource:y,pagination:!1,loading:b,onChange:x})]})}const fl=l.memo(pl);function hl(e){let{title:t,deviceType:n,icon:r,stationDn:i}=e;const[o,a]=(0,l.useState)(!1),[s,c]=(0,l.useState)({}),u=ll((0,l.useRef)({deviceName:{render:(e,t)=>(0,D.jsx)(dl,{onClick:()=>d(t),text:e})},faultCause:{disabled:!0},faultRecoverAdvice:{disabled:!0}}).current),d=(0,l.useCallback)((e=>{a(!0),c(e)}),[]);return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(al,{icon:r,title:t,deviceType:n,tableColumns:u,stationDn:i}),o&&(0,D.jsx)(fl,{visible:o,afterClose:()=>a(!1),deviceDn:s.deviceDn,deviceName:s.deviceName,deviceType:n,stationDn:i})]})}const ml=l.memo(hl);function gl(e){let{intl:t,stationDn:n}=e;const r=ll((0,l.useRef)({faultCause:{render:e=>(0,D.jsx)(sl,{maxLine:1/0,text:e})},faultRecoverAdvice:{render:e=>(0,D.jsx)(sl,{maxLine:1/0,text:e})}}).current);return(0,D.jsx)(al,{title:t.formatMessage({id:\"neteco.pvms.plantDiagnosis.solar.table.title.sts\"}),icon:Fs,deviceType:rs.sts,tableColumns:r,stationDn:n})}const vl=[{key:0,title:\"neteco.pvms.plantDiagnosis.solar.tab.overview\",path:\"/view/station/:stationDn/plantDiagnosis/overview\",component:tl},{key:1,title:\"neteco.pvms.plantDiagnosis.solar.tab.pvString\",path:\"/view/station/:stationDn/plantDiagnosis/pvString\",component:ul},{key:2,title:\"neteco.pvms.plantDiagnosis.solar.tab.inverter\",path:\"/view/station/:stationDn/plantDiagnosis/inverter\",component:ml,props:{deviceType:rs.inverter,icon:Zs}},{key:3,title:\"neteco.pvms.plantDiagnosis.solar.tab.sts\",path:\"/view/station/:stationDn/plantDiagnosis/sts\",component:l.memo(gl)},{key:4,title:\"neteco.pvms.plantDiagnosis.tab.ppc\",path:\"/view/station/:stationDn/plantDiagnosis/pcc\",component:ml,props:{deviceType:rs.sppc,icon:Bs}}],yl=Object.values(rs),bl=(e,t)=>{const n={},r=new Set(t);return e.forEach((e=>{const{deviceType:t,majorDeviceNum:r=0,mediumDeviceNum:i=0,lightDeviceNum:o=0}=e;let a;a=r?2:i+o?1:0,n[t]={abnormalDevices:r+i+o,alertType:a,major:r,medium:i,light:o}})),yl.forEach((e=>!r.has(e)&&(n[e]={alertType:3}))),n},Sl=e=>{const t={};return e.forEach((e=>{const{evaluateTypeId:n,evaluateValue:r}=e;r>=0&&(t[n]=Number(r))})),t},xl=e=>{const t={};return e.forEach((e=>{const{eletricityType:n,eletricityValue:r}=e;r>=0&&(t[n]=Number(r))})),t},wl={deviceStateSummary:{},lossSummary:{},diagnosisItemSummary:[],existingDevices:[],electricitySummary:[],stationName:\"\"};const Cl={diagEn:!1,diagnoseFrequencyId:1,dayNumOfWeek:7,lossEvaluateEn:!0};const Tl=l.memo((e=>{var t;let{tabList:n,selectedMenuKeys:r}=e;const i=(0,Ba.k6)(),o=(0,l.useCallback)((e=>{const t=n.find((t=>t.key===Number(e)));i.push(t.path)}),[n]);return(0,D.jsx)(c.Z,{type:\"text\",items:n,activeKey:null===(t=r[0])||void 0===t?void 0:t.toString(),onChange:o})})),Al=l.memo((e=>{let{intl:t,stationDn:n,stationName:r,defaultDate:i,selectedMenuKeys:o,onConfigButtonClick:a,availableTime:c}=e;const[u,p]=ps(cs,i),f=(0,l.useCallback)((e=>!c.has(Js(e))),[c]);return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(xr.Z,{className:\"toolbar-item\",style:{minWidth:\"15rem\"},value:u,onChange:p,disabledDate:f,allowClear:!1}),(0,D.jsx)(h.Z,{className:\"toolbar-item search-button\",type:\"primary\",onClick:()=>p(s()(u)),children:t.formatMessage({id:\"common.button.search\"})}),0===Number(o[0])&&(0,D.jsx)(h.Z,{className:\"toolbar-item\",onClick:()=>(e=>{let{intl:t,diagnoseDay:n,stationDn:r,stationName:i}=e;const o=Js(n);!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e+\"?\"+Object.entries(t).map((e=>{let[t,n]=e;return`${t}=${n}`})).join(\"&\");window.open(n,\"_self\")}(`/rest/dp/pvms/diagnose/v1/photovoltaic/export/${t.formatMessage({id:\"neteco.pvms.plantDiagnosis.export.filename\"})}_${i}_${o}.xlsx`,{stationDn:r,diagnoseDay:o,locale:t.locale})})({intl:t,diagnoseDay:u,stationDn:n,stationName:r}),children:t.formatMessage({id:\"common.button.export\"})}),(0,D.jsx)(d.Z,{title:t.formatMessage({id:\"neteco.pvms.stationInfo.addStation.configBtn\"}),children:(0,D.jsx)(h.Z,{className:\"toolbar-item icon-button\",type:\"text\",icon:(0,D.jsx)(wr.Z,{}),onClick:a})})]})}));function El(e){let{intl:t,stationDn:n}=e;const r=(0,Ba.k6)(),[i,o]=(0,l.useState)(!1),[a,c]=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const[n,r]=(0,l.useState)(Cl),[i,o]=fs(),[a,s]=hs(),c=(0,l.useCallback)((async t=>{s(!0);try{await(n={stationDn:e,...t},(0,O.v_)(\"/rest/dp/pvms/diagnose/v1/photovoltaic/config\",n))&&r(t),s(!1)}catch(e){s(!1)}var n}),[e]),u=(0,l.useCallback)((()=>{e&&(o(!0),(e=>(0,O.U2)(\"/rest/dp/pvms/diagnose/v1/photovoltaic/config\",{stationDn:e}))(e).then((e=>{if(e){const{diagEn:t,diagnoseFrequencyId:n=Cl.diagnoseFrequencyId,dayNumOfWeek:i=Cl.dayNumOfWeek,lossEvaluateEn:o}=e;r({diagEn:t,diagnoseFrequencyId:n,dayNumOfWeek:i,lossEvaluateEn:o})}else r(Cl);o(!1)})).catch((e=>{r(Cl),o(!1)})))}),[e,t]);return(0,l.useEffect)((()=>u()),[e]),(0,l.useEffect)((()=>{t&&u()}),[t]),[n,c]}(n,i),u=(0,l.useMemo)((()=>a.diagEn),[a]),[d,p]=ps(cs,s()((e=>{const t=e||window.location.href,n=t.substring(t.lastIndexOf(\"?\")+1).split(\"&\"),r={};return n.forEach((e=>{const[t,n]=e.split(\"=\");r[t]=n})),r})(r.location.search||\"\").diagnoseDay)),f=function(e){const[t,n]=(0,l.useState)(new Set);return(0,l.useEffect)((()=>{(e=>(0,O.U2)(\"/rest/dp/pvms/diagnose/v1/photovoltaic/timedata\",{stationDn:e}))(e).then((e=>{n(e?new Set(e):new Set)})).catch((e=>{n(new Set)}))}),[e]),t}(n),[h,m]=ps(us,{}),[g,v]=(0,l.useState)([0]),{menuList:y,selectedMenuKeys:b,tabList:S}=function(e,t,n){const r=za(vl),i=(0,l.useMemo)((()=>{const e=new Set(t||[]);return r.filter((t=>e.has(t.key)))}),[r,t]),o=(0,l.useMemo)((()=>r.filter((t=>e.indexOf(pp(t.path,n))>=0)).map((e=>e.key))),[e,n]),[a,s]=(0,l.useMemo)((()=>{const e=[],t=[];return i.forEach((r=>{const{key:i,path:o,title:a}=r,s=pp(o,n);e.push({...r,path:s}),t.push({key:i,label:a,path:s})})),[e,t]}),[i,n]);return{menuList:a,selectedMenuKeys:o,tabList:s}}(r.location.pathname,g,n),x=(0,l.useMemo)((()=>y.filter((e=>0!==e.key&&1!==e.key)).length>0),[y]),w=function(e){const[t,n]=gs(),[r,i]=(0,l.useState)(wl),o=(0,l.useCallback)((e=>{const{deviceTypeResultSummary:t=[],itemResultSummary:n=[],lossSummary:r=[],existsDeviceTypes:i=[],eletricitySummary:o=[],stationName:a}=e;return{deviceStateSummary:bl(t,i),lossSummary:Sl(r),existingDevices:i,diagnosisItemSummary:n,electricitySummary:xl(o),stationName:a}}),[]);return(0,l.useEffect)((()=>{e&&(n(!0),(async e=>(0,O.U2)(\"/rest/dp/pvms/diagnose/v1/photovoltaic/summary\",e))(e).then((e=>{i(e?o(e):wl),n(!1)})).catch((e=>{i(wl),n(!1)})))}),[e]),r}((0,l.useMemo)((()=>{if(n&&d&&t)return{stationDn:n,locale:t.locale,diagnoseDay:Js(d)}}),[n,d,t])),C=(0,l.useCallback)((async e=>{await c(e),o(!1)}),[c]);return(0,l.useEffect)((()=>{const{existingDevices:e}=w,t=[0];e.forEach((e=>t.push(os[e]))),v(t),m(w)}),[w]),(0,l.useEffect)((()=>{if(f.size>0&&!f.has(Js(d))){const e=Array.from(f);p(s()(e[e.length-1]))}}),[f,d]),(0,D.jsxs)(D.Fragment,{children:[u&&x&&(0,D.jsxs)(\"div\",{className:\"nco-pv-diagnosis-view\",children:[(0,D.jsxs)(\"div\",{className:\"nco-pv-diagnosis-nav-bar\",children:[(0,D.jsx)(\"div\",{className:\"left-area\",children:(0,D.jsx)(Tl,{tabList:S,selectedMenuKeys:b})}),(0,D.jsx)(\"div\",{className:\"right-area toolbar\",children:(0,D.jsx)(Al,{intl:t,stationDn:n,stationName:w.stationName,defaultDate:d,selectedMenuKeys:b,availableTime:f,onConfigButtonClick:()=>o(!0)})})]}),(0,D.jsxs)(Ba.rs,{children:[y.map((e=>(0,D.jsx)(Ba.AW,{path:e.path,render:()=>(0,D.jsx)(e.component,{intl:t,stationDn:n,title:e.title,calcLoss:a.lossEvaluateEn,...e.props})},e.key))),y.length>0&&(0,D.jsx)(Ba.l_,{to:y[0].path})]})]}),u&&!x&&(0,D.jsx)(\"div\",{className:\"nco-monitor-plant-diagnosis-empty-wrapper\",children:(0,D.jsx)(xs,{textId:\"neteco.pvms.plantDiagnosis.tip.noDataButConfigOpen\",linkTextId:\"neteco.pvms.plantDiagnosis.tip.noDataButConfigOpen.linkText\",onClick:()=>o(!0)})}),!u&&(0,D.jsx)(\"div\",{className:\"nco-monitor-plant-diagnosis-empty-wrapper\",children:(0,D.jsx)(xs,{textId:\"neteco.pvms.plantDiagnosis.tip.notOpen\",linkTextId:\"neteco.pvms.plantDiagnosis.tip.notOpen.linkText\",onClick:()=>o(!0)})}),(0,D.jsx)(Ss,{visible:i,onCancel:()=>o(!1),onOk:C,config:a})]})}const Ol=l.memo(El);function Ml(e){let{intl:t,stationDn:n}=e;return(0,D.jsx)(\"div\",{className:\"nco-monitor-plant-diagnosis-view\",children:(0,D.jsx)(Ol,{intl:t,stationDn:n})})}const Pl=l.memo(Ml),Dl=(0,o.ZP)((e=>{let{intl:t,stationDn:n,mocId:r}=e;return(0,D.jsx)(Wa,{children:(0,D.jsx)(Pl,{intl:t,stationDn:n,mocId:r})})}));var Il=n(92873),Nl=n(84809),_l=n(5776),jl=n(83862),kl=n(92252),Ll=n(31464);const{Option:Rl}=kl.Z;var Zl=n(55534),Bl=n.n(Zl),Fl=n(48719),zl=n(15657),Vl=n(534),Hl=n(69896);const{neteco:Ul}=window,Gl=e=>(0,D.jsx)(kl.Z,{virtual:!1,onChange:e,disabled:!(0,v.lVp)(v.rEn),children:Object.entries(Ll.qD).sort(((e,t)=>e[1].toLocaleLowerCase().localeCompare(t[1].toLocaleLowerCase()))).map((e=>{let[t,n]=e;return(0,D.jsx)(Rl,{value:t,children:n},t)}))});class Yl extends l.Component{constructor(e){super(e),this.formRef=l.createRef(),this.handleUpdate=e=>{e.preventDefault();const{dn:t,onSubmit:n,intl:r,enterpriseInfo:i}=this.props,o=this.formRef.current;o.validateFields().then((()=>{const e=o.getFieldsValue(),a=new Map;Object.entries(e).forEach((e=>{const t=e[0];let n=e[1];\"string\"==typeof n&&(n=n.trim()),o.isFieldTouched(t)&&a.set(t,n)}));const s=Object.fromEntries(a);n({...s,dn:t},r,o,i)})),this.setState({canClickButton:!1,disabledSaveButton:!1})},this.handleInputChange=()=>{this.setState({canClickButton:!0,disabledSaveButton:!0})},this.handleCancel=()=>{this.formRef.current.resetFields(),this.setState({canClickButton:!1,disabledSaveButton:!1})},this.handleRegionNameValidator=async(e,t,n)=>{const{intl:r}=this.props,i=n(),o=this.state.cusValidator;if(!o)return Promise.resolve();let{name:a}=i;if(a||(a=\"\"),\"null\"===t||/[`|:,&\\'<>\\?]+/.test(t))return Promise.reject(r.formatMessage({id:\"neteco.pvms.systemSetting.domainNameVacInfo\"}));const s=await async function(e,t,n){const r=await n.validateRegionName(e,t);if(r)return r}(a,r,o);return s?Promise.reject(s):void 0},this.disabledDate=e=>e&&s()(e)>s()().endOf(\"day\"),this.websiteValidator=(e,t)=>{const{intl:n}=this.props;if(this.formRef.current.isFieldTouched(\"companyWebsite\")){if(!t||0===t.trim().length)return Promise.resolve();if(!t.startsWith(\"http://\")&&!t.startsWith(\"https://\"))return this.setState({disabledSaveButton:!1}),Promise.reject(n.formatMessage({id:\"neteco.pvms.partials.main.systemMessage.illegalWebSite\"}))}return Promise.resolve()},this.handleRangeLonLatChange=e=>{this.handleInputChange(),this.formRef.current.setFieldsValue({rangeRadius:e})},this.handleRangeRadiusChange=e=>{this.handleInputChange(),this.formRef.current.setFieldsValue({rangeLonLat:e})},this.state={canClickButton:!1,disabledSaveButton:!1,povertyStationEnable:!1}}componentWillMount(){(0,zl.W)().then((e=>{const t=e;this.setState({cusValidator:t})})).catch(_e.mz)}componentWillUnmount(){this.setState=_e.mz}componentDidMount(){const{loadNcoEnterpriseInfo:e,checkHasSetupPovertyLicense:t}=this.props;e&&e(),t&&t(),Hl.Z.getSystemConfigs().then((e=>{this.setState({povertyStationEnable:(null==e?void 0:e.povertyStationEnable)||!1})}))}componentDidUpdate(e,t,n){const{enterpriseInfo:r,dn:i}=this.props,o=this.formRef.current;Bl()(r,e.enterpriseInfo)||o.resetFields(),Bl()(i,e.dn)||(o.resetFields(),this.setState({canClickButton:!1,disabledSaveButton:!1}))}render(){const{intl:e,enterpriseInfo:t,dn:n}=this.props,{name:r,description:i,startRunningDate:o,longitude:a,latitude:l,radius:c,currency:u,supportPoor:d,companyAddress:p,companyTel:f,companyWebsite:h,filingNo:m,titlePlants:g,logoPlants:y,titleLogin:b,logoLogin:S,titleMain:x,logoMain:w}=t,C=(0,Vl.mV)(e),T=(0,Vl.IL)(e),A=(Number.parseFloat(a),Number.parseFloat(l),Number.parseFloat(c),e=>Ul.util.iUnescape(e)||\"\");function E(e){return 1===e}(0,Vl.lB)(e,\"nco-logo-login-uploader\",Yl.uploadUrl,C.logoPlantsAdviceMessage,(0,Vl.oG)(\"1\",n,S),A(S),\"logoLogin\");const O=(0,Vl.lB)(e,\"nco-logo-main-uploader\",Yl.uploadUrl,C.logoPlantsAdviceMessage,(0,Vl.oG)(\"2\",n,w),A(w),\"logoLogin\"),M=(0,Vl.lB)(e,\"nco-logo-plants-uploader\",Yl.uploadUrl,C.logoPlantsAdviceMessage,(0,Vl.oG)(\"3\",n,y),A(y),\"logoPlants\"),P=[{pattern:/^[^'<>,/&\"|']*$/,message:e.formatMessage({id:\"neteco.pvms.validator.vacSepecialString\"})},{validator(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:\"\";return n&&\"null\"===n?Promise.reject(e.formatMessage({id:\"neteco.pvms.validator.vacSepecialString\"})):Promise.resolve()}}],{handleRegionNameValidator:I}=this;return(0,D.jsx)(Ie.Bo,{children:t=>{let{type:a}=t;const l=a===_e.M5.smartpvms;return(0,D.jsxs)(\"div\",{className:\"nco-enterprisein-info-configuration-form\",children:[(0,D.jsxs)(fe.Z,{name:\"ncoEnterpriseInfoConfigurationForm\",ref:this.formRef,layout:\"horizontal\",children:[(0,D.jsx)(fe.Z.Item,{name:\"name\",validateFirst:!0,rules:[{required:!0,max:60,message:e.formatMessage({id:\"neteco.pvms.systemSetting.domainNameVacInfo\"},{maxLength:60})},e=>{let{getFieldValue:t}=e;return{validator:(e,n)=>I(e,n,t)}}],initialValue:A(r),...(0,Vl.ST)(C.name,4),children:(0,D.jsx)(he.Z,{autoFocus:!0,onChange:this.handleInputChange})}),l&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(fe.Z.Item,{name:\"description\",initialValue:A(i),...(0,Vl.ST)(C.description,4),children:(0,D.jsx)(he.Z,{onChange:this.handleInputChange,maxLength:1e3})}),(0,D.jsx)(fe.Z.Item,{name:\"companyTel\",initialValue:A(f),rules:[{pattern:/^\\d+$/,message:e.formatMessage({id:\"neteco.pvms.systemSetting.telVacInfo\"})}],...(0,Vl.ST)(C.companyTel,4),children:(0,D.jsx)(he.Z,{maxLength:25,onChange:this.handleInputChange})}),(0,D.jsx)(fe.Z.Item,{name:\"companyAddress\",initialValue:A(p),rules:[{pattern:/^[^'<>,/&\"']*$/,message:`${e.formatMessage({id:\"neteco.pvms.partials.main.systemMessage.illegalInput\"})}<>/'\"()\\\\`}],...(0,Vl.ST)(C.companyAddress,4),children:(0,D.jsx)(he.Z,{maxLength:64,onChange:this.handleInputChange})}),(0,D.jsx)(fe.Z.Item,{name:\"companyWebsite\",validateFirst:!0,initialValue:A(h).split(\" \").join(\"://\"),rules:[{validator:(e,t)=>this.websiteValidator(e,t)}],...(0,Vl.ST)(C.companyWebsite,4),children:(0,D.jsx)(he.Z,{onChange:this.handleInputChange})}),(0,D.jsx)(fe.Z.Item,{name:\"filingNo\",initialValue:A(m),...(0,Vl.ST)(C.filingNo,4),children:(0,D.jsx)(he.Z,{maxLength:64,onChange:this.handleInputChange})}),(0,D.jsx)(fe.Z.Item,{name:\"startRunningDate\",initialValue:o?s()(o):void 0,...(0,Vl.ST)(C.startRunningDate,4),children:(0,D.jsx)(jl.Z,{allowClear:!1,onChange:this.handleInputChange,disabledDate:this.disabledDate})})]}),(0,D.jsx)(fe.Z.Item,{name:\"currency\",initialValue:`${A(u)}`,...(0,Vl.ST)(C.currency,4),children:Gl(this.handleInputChange)}),l&&this.state.povertyStationEnable&&(0,D.jsx)(fe.Z.Item,{name:\"supportPoor\",initialValue:E(d),valuePropName:\"checked\",...(0,Vl.ST)(C.supportPoor,4),children:(0,D.jsx)(_l.Z,{onChange:this.handleInputChange})}),(0,D.jsx)(fe.Z.Item,{name:\"titleMain\",validateFirst:!0,rules:P,initialValue:A(x),...(0,Vl.ST)(T.titleMain,4),children:(0,D.jsx)(he.Z,{maxLength:64,onChange:this.handleInputChange})}),(0,D.jsxs)(fe.Z.Item,{...(0,Vl.ST)(T.logoMain,4),children:[(0,D.jsx)(Fl.Z,{dn:n,...O,imgStyle:{width:\"90%\",height:\"90%\"}}),(0,D.jsx)(\"p\",{children:e.formatMessage({id:\"ncoEnterpriseInfo.upload.LogoAdviceMessage\"},{width:50,height:50})})]}),(0,D.jsx)(fe.Z.Item,{name:\"titlePlants\",validateFirst:!0,rules:P,initialValue:A(g),...(0,Vl.ST)(T.titlePlants,4),children:(0,D.jsx)(he.Z,{maxLength:64,onChange:this.handleInputChange})}),(0,D.jsxs)(fe.Z.Item,{...(0,Vl.ST)(T.logoPlants,4),children:[(0,D.jsx)(Fl.Z,{dn:n,...M,imgStyle:{width:\"90%\",height:\"90%\"}}),(0,D.jsx)(\"p\",{children:e.formatMessage({id:\"ncoEnterpriseInfo.upload.LogoAdviceMessage\"},{width:50,height:50})})]})]}),(!l||(0,v.lVp)(v.rEn))&&(0,D.jsxs)(\"div\",{children:[(0,D.jsx)(oe.Z,{type:\"default\",size:\"default\",onClick:this.handleCancel,disabled:!this.state.canClickButton,className:\"nco-enterprise-info-update-button\",children:e.formatMessage({id:\"common.button.cancel\"})}),(0,D.jsx)(oe.Z,{type:\"primary\",size:\"default\",onClick:this.handleUpdate,disabled:!this.state.disabledSaveButton,className:\"nco-enterprise-info-update-button\",children:e.formatMessage({id:\"neteco.pvms.systemSetting.save\"})})]})]})}})}}Yl.uploadUrl=\"/rest/pvms/web/enterprise/v1/enterprise/upload-logo\";const Wl=(0,o.ZP)(Yl);var Kl=n(39699),ql=n(13616),Ql=n(95059),Xl=n(9641),Jl=n(34641),$l=n(19330),ec=n(65595),tc=n(62995),nc=n(69131),rc=n(16910),ic=n(65835);const{pageName:oc,accessId:ac,leaveId:sc}=on.e.deviceDetail,{operationConfirm:lc,operationInfo:cc,operationFailed:uc,operationSuccess:dc}=Ql.Z,{neteco:pc}=window;class fc extends l.Component{constructor(e){super(e),this.getRealName=e=>{const{intl:t}=this.props;return 33595395===e.id?t.formatMessage({id:\"neteco.pvms.sm.psm.sname\"}):33595396===e.id?t.formatMessage({id:\"neteco.pvms.upgrade.heads.devTypeId\"}):33595393===e.id?t.formatMessage({id:\"neteco.pvms.partials.main.rm.dayCapPrpfit.data.dName\"}):21022===e.id?t.formatMessage({id:\"neteco.pvms.pcs.station.detail.address\"}):e.name||\"\"},this.hideSignalIds=[33595395,21022],this.loadBasicData=e=>{let{deviceDn:t,properties:n}=e;(0,ec.q$)({deviceDn:t,properties:n}).then((e=>{const{success:t,data:n}=e;t?this.updateState({basicInfo:n.filter((e=>!this.hideSignalIds.includes(e.id))).map((e=>({label:this.getRealName(e),value:pc.util.iUnescape(pc.util.iUnescape(e.value))||\"-\",unit:e.unit||\"\",dataType:e.dataType||\"\"})))}):this.updateState({basicInfo:[]})})).catch((()=>{})).finally((()=>{}))},this.loadRealtimeInfoData=e=>{let{deviceDn:t,properties:n}=e;(0,ec.cx)(t).then((e=>{const{success:t,data:n}=e;if(t){const e=new Map,t=10007,r=10018,i=10025;n.forEach((n=>{var o,a,s;null!==(o=n.signals)&&void 0!==o&&o.some((e=>e.id===t))&&e.set(\"direct\",n.signals),null!==(a=n.signals)&&void 0!==a&&a.some((e=>e.id===r))&&e.set(\"alter\",n.signals),null!==(s=n.signals)&&void 0!==s&&s.some((e=>e.id===i))&&e.set(\"pcs\",n.signals)})),this.setState({realtimeInfo:e.get(\"pcs\").map((e=>({label:e.name||\"\",value:e.value||\"-\",unit:e.unit||\"\",id:e.id}))),directInfo:e.get(\"direct\")||[],alterInfo:e.get(\"alter\")||[]})}else this.updateState({realtimeInfo:[]})})).catch((()=>{})).finally((()=>{}))},this.updateState=e=>{this.setState({...this.state,...e})},this.state={basicInfo:[],directInfo:[],alterInfo:[],MOStatus:\"\"},this.startTime=ic.$.pageAccess(ac,{pageName:oc,deviceType:String(null==e?void 0:e.selectedTreeNode.mocId)})}async componentDidMount(){const{selectedTreeNode:{elementDn:e,elementId:t}}=this.props;if(e){const n=await(0,ec.uT)([t]);null==n||n.forEach((e=>{e.dnId===Number(t)&&this.setState({deviceStatus:e.deviceStatus})})),this.loadPcsData(e),this.loadBasicData({deviceDn:e,properties:\"\"}),this.loadRealtimeInfoData({deviceDn:e,properties:\"\"})}this.realtimeInfoTimer=setInterval((()=>{this.loadRealtimeInfoData({deviceDn:e,properties:\"\"}),this.loadPcsData(e)}),this.props.subscriptionTime*nc.v.monitorPcsDetail_loadPcsData)}componentDidUpdate(e){if(this.props.subscriptionTime!==e.subscriptionTime){const{selectedTreeNode:{elementDn:e},subscriptionTime:t}=this.props;this.realtimeInfoTimer&&clearInterval(this.realtimeInfoTimer),this.realtimeInfoTimer=setInterval((()=>{this.loadRealtimeInfoData({elementDn:e,properties:\"\"}),this.loadPcsData(e)}),t*nc.v.monitorPcsDetail_loadPcsData)}}loadPcsData(e){const{intl:t}=this.props;(0,ec.Do)({deviceDn:e}).then((e=>{if(e.success){const{alter:n,direct:r}=e.data;if(!n||!r)return;const i=[],o=[];n.data.map((e=>{\"A\"===e.mockUnit?i.push(e):o.push(e),10018===e.id&&(e.tips=t.formatMessage({id:\"neteco.pvms.PCS.activePower.mes\"}))})),this.setState({MOStatus:e.data.MOStatus||\"Disconnected\"})}}))}componentWillUnmount(){var e;ic.$.pageLeave(this.startTime,sc,{pageName:oc,deviceType:String(null===(e=this.props)||void 0===e?void 0:e.selectedTreeNode.mocId)}),clearInterval(this.realtimeInfoTimer),this.setState=()=>{}}render(){const{intl:e,selectedTreeNode:t}=this.props,{elementDn:n,nodeName:r,mocId:i}=t,{basicInfo:o,realtimeInfo:a,alterInfo:s,directInfo:l,MOStatus:c,deviceStatus:u}=this.state,d={apiParams:{stationDn:n,status:c||\"Disconnected\",type:\"pcs\"},dataLoaderClass:Xl.Z};return(0,D.jsx)(\"div\",{className:\"nco-monitor-pcs-detail tab-content\",children:(0,D.jsx)(\"div\",{className:\"content\",children:(0,D.jsxs)(\"div\",{className:\"pcs-content\",children:[(0,D.jsxs)(\"div\",{className:\"top-content\",children:[(0,D.jsx)(\"div\",{className:\"top-content-title\",children:pc.util.iUnescape(r)}),(0,D.jsx)(tc.Z,{mocId:i,deviceName:r,deviceDn:n,device:{deviceDn:n},realtimeInformation:a,...this.props})]}),(0,D.jsxs)(\"div\",{className:\"bottom-content \"+((0,rc.VP)()?\"bottom-content-new\":\"\"),children:[(0,D.jsx)(\"div\",{className:\"bottom-content-left\",children:(0,D.jsx)($l.Z,{...d})}),(0,D.jsxs)(\"div\",{className:\"bottom-content-right\",children:[(0,D.jsx)(\"div\",{className:\"dc-info pcs-details-info\",children:(0,D.jsx)(Jl.Z,{title:e.formatMessage({id:\"neteco.pvms.business.pcs.dcSide\"})||\" \",data:l,columns:5})}),(0,D.jsx)(\"div\",{className:\"pcs-info pcs-details-info\",children:(0,D.jsx)(Jl.Z,{title:\"PCS\",data:a,columns:5,showStatusId:10025,deviceStatus:u})}),(0,D.jsx)(\"div\",{className:\"ac-info pcs-details-info\",children:(0,D.jsx)(Jl.Z,{title:e.formatMessage({id:\"neteco.pvms.business.pcs.acSide\"})||\" \",data:s,columns:5})}),(0,D.jsx)(\"div\",{className:\"basic-info\",children:(0,D.jsx)(Jl.Z,{title:e.formatMessage({id:\"neteco.pvms.devEport.basicInfo\"})||\" \",data:o,columns:3,type:\"base\",isBasicInfo:!0,deviceType:i})})]})]})]})})})}}const hc=(0,o.ZP)(fc);var mc=n(56828),gc=n(45258),vc=n(53304);const yc=e=>({Connected:e.formatMessage({id:\"neteco.pvms.partials.main.dm.devConnected\"}),Disconnected:e.formatMessage({id:\"neteco.pvms.partials.main.dm.devDisconnected\"}),UnAvailable:e.formatMessage({id:\"pvms.device.status.unavailable\"}),Deleted:e.formatMessage({id:\"pvms.device.status.deleted\"}),Initialized:e.formatMessage({id:\"pvms.device.status.initialized\"})});var bc=n(17085),Sc=n(54236),xc=n(77577);const{pageName:wc,accessId:Cc,leaveId:Tc}=on.e.deviceDetail,{operationSuccess:Ac,operationFailed:Ec,operationInfo:Oc}=Ql.Z;class Mc extends l.Component{constructor(e){super(e),this.buildStatusIcon=e=>{const{intl:t}=this.props,n=\"Connected\"===e?\"device-status-icon status-up\":\"device-status-icon status-down\";return(0,D.jsx)(\"span\",{title:yc(t)[e],className:n})},this.dataFormat=e=>{const t=(0,kt.af)(e);return(0,D.jsx)(\"span\",{title:t,children:t})},this.getOptTableColumns=()=>{const{intl:e}=this.props,{dataFormat:t}=this;return yc(e).Connected,yc(e).Disconnected,[{title:e.formatMessage({id:\"neteco.pvms.partials.main.io.dispersion_iv.promtCode\"}),dataIndex:\"optNumber\",render:(e,t)=>(0,D.jsx)(\"span\",{title:e,children:e||t.optNum})},{title:e.formatMessage({id:\"neteco.pvms.troubleInfo.optName\"}),dataIndex:\"optName\",render:e=>(0,D.jsx)(\"span\",{title:e,children:e})},{title:`${e.formatMessage({id:\"neteco.pvms.partials.plants.index.totalPowerProduct\"})}(${e.formatMessage({id:\"nco.unit.kWh\"})})`,dataIndex:\"totalEnergy\",render:e=>t(e)},{title:`${e.formatMessage({id:\"neteco.pvms.basicUnifSignal.optimizer.outputPower\"})}(W)`,dataIndex:\"outputPower\",render:e=>t(e)},{title:`${e.formatMessage({id:\"neteco.pvms.basicUnifSignal.optimizer.outputVol\"})}(V)`,dataIndex:\"outputVoltage\",render:e=>t(e)},{title:`${e.formatMessage({id:\"neteco.pvms.basicUnifSignal.optimizer.inputVol\"})}(V)`,dataIndex:\"inputVoltage\",render:e=>t(e)},{title:`${e.formatMessage({id:\"neteco.pvms.basicUnifSignal.optimizer.inputCur\"})}(A)`,dataIndex:\"inputCurrent\",render:e=>t(e)},{title:e.formatMessage({id:\"neteco.pvms.basicUnifSignal.optimizer.runStatus\"}),dataIndex:\"runningStatus\",render:e=>t(e)},{title:e.formatMessage({id:\"common.label.action\"}),dataIndex:\"\",render:(t,n)=>(0,v.lVp)(v.ITW)&&(0,D.jsx)(\"span\",{style:{cursor:\"Disconnected\"===n.moStatus?\"pointer\":\"not-allowed\",marginRight:\".5rem\"},title:e.formatMessage({id:\"common.button.delete\"}),onClick:()=>{\"Disconnected\"===n.moStatus&&this.handDeleteConfirm([n])},children:(0,D.jsx)(\"span\",{className:\"icon-trash-lined icon-size \"+(\"Disconnected\"===n.moStatus?\"\":\"disable-icon-trash-lined\")})})}]},this.getOptBasicTableColumns=()=>{const{intl:e}=this.props,t=e=>(0,D.jsx)(\"span\",{title:e,children:e});return[{title:e.formatMessage({id:\"neteco.pvms.ivcurve.totalHeads.6\"}),dataIndex:\"optNumber\",render:(e,t)=>(0,D.jsx)(\"span\",{title:e,children:e||t.optNum})},{title:e.formatMessage({id:\"neteco.pvms.partials.main.dm.detailInfo.optDevInfo.optDevESN\"}),dataIndex:\"esn\",render:t},{title:e.formatMessage({id:\"neteco.pvms.partials.main.configuration.model\"}),dataIndex:\"modelName\",render:t},{title:e.formatMessage({id:\"neteco.pvms.partials.main.dm.detailInfo.optDevInfo.softWareVersion\"}),dataIndex:\"softwareVersion\",render:t},(0,ut.ux)()&&{title:e.formatMessage({id:\"neteco.optimizer.mbus\"}),dataIndex:\"moBusVersion\",render:t}].filter(Boolean)},this.getPagination=()=>{const{intl:e}=this.props,{optList:t=[]}=this.state;return{defaultPageSize:5,showSizeChanger:!0,total:t.length,pageSizeOptions:[5,10,20,50,100],showTotal:t=>e.formatMessage({id:\"neteco.pvms.station.subarray.pagination.total\"},{total:t})}},this.getTableProps=()=>{const{optList:e=[]}=this.state,t=e.map((e=>(e.status=e.moStatus,e)));return{columns:this.getOptTableColumns(),size:\"small\",dataSource:t,rowKey:\"dn\",onChange:this.handleTableChange,pagination:this.getPagination()}},this.getOptBasicTableProps=()=>{const{optList:e=[]}=this.state,t=e.map((e=>({optNumber:e.optNumber||e.optNum||V.lH,manufacturer:e.manufacturer||V.lH,esn:e.sn||V.lH,softwareVersion:e.softwareVersion||V.lH,modelName:e.modelName||V.lH,moBusVersion:e.moBusVersion||V.lH})));return{columns:this.getOptBasicTableColumns(),size:\"small\",dataSource:t,rowKey:\"esn\",pagination:this.getPagination()}},this.onSelectChange=(e,t)=>{const{intl:n}=this.props;t.forEach((e=>e.mocTypeName=n.formatMessage({id:\"neteco.pvms.devTypeLangKey.optimizer\"}))),this.setState({selectedRows:t})},this.handleTableChange=(e,t)=>{const n=t.moStatus?t.moStatus.join(\",\"):\"\";this.setState({filterStatus:n}),this.loadOptList(n)},this.loadOptList=e=>{const{inverterDn:t}=this.props;t&&(0,R.uf)(t,e).then((e=>{const{success:t,data:{data:n=[]}}=e;t&&this.setState({optList:n})}))},this.handDeleteConfirm=e=>{const{intl:t}=this.props;gc.Z.confirm({content:t.formatMessage({id:\"neteco.deviceManagement.deleteDeviceWarning\"}),onOk:()=>this.deleteOptList(e)})},this.deleteOptList=e=>{const{intl:t,inverterDn:n}=this.props,{filterStatus:r}=this.state,i=[];e.map((e=>{i.push(e.dnId)})),(0,vc.AO)(i)().then((e=>{0===e.code?e.data||e.total?Ac(t,t.formatMessage({id:\"neteco.pvms.device.delete.async.information\"}),this.loadOptList(r),bc.k.next(n)):Oc(t,t.formatMessage({id:\"neteco.pvms.device.management.not_exists\"})):-1===e.code?Oc(t,t.formatMessage({id:\"neteco.pvms.device.management.deviceMissing\"})):Ec(t,t.formatMessage({id:\"neteco.pvms.alarmTemp.deleteError\"}))}))},this.deleteHandler=()=>{const{intl:e}=this.props,{selectedRows:t=[]}=this.state;t.find((e=>20814===e.mocId&&\"Connected\"===e.moStatus))?Oc(e,e.formatMessage({id:\"neteco.pvms.deleteTip.delRunDev\"})):this.handDeleteConfirm(t)},this.showDeviceChangeModal=()=>{const{intl:e}=this.props,{selectedRows:t}=this.state;\"Connected\"!==t[0].moStatus?this.setState({deviceChangeModalVisible:!0}):Oc(e,e.formatMessage({id:\"neteco.pvms.device.replace.status.fail\"}))},this.hideDeviceChange=()=>{this.setState({deviceChangeModalVisible:!1})},this.showSettingModal=()=>{this.setState({initialSettingModalVisible:!0,shouldShowInitialSettingModal:!0})},this.hideSettingModal=()=>{this.setState({initialSettingModalVisible:!1,batchConfiguring:!1}),setTimeout(this.eliminateSettingModal,300)},this.eliminateSettingModal=()=>{this.setState({shouldShowInitialSettingModal:!1})},this.startBatchConfiguring=()=>{this.setState({batchConfiguring:!0})},this.finishBatchConfiguring=()=>{this.setState({batchConfiguring:!1})},this.buildBtnAndips=(e,t)=>{const{intl:n}=this.props;return(0,D.jsx)(me.Z,{title:!t&&n.formatMessage({id:\"ncoPvToolbar.tip.selectDevice\"}),children:e})},this.state={selectedRows:[],isInSharedStation:!1,optList:[],filterStatus:\"\",deviceChangeModalVisible:!1,initialSettingModalVisible:!1,batchConfiguring:!1,shouldShowInitialSettingModal:!1},this.startTime=ic.$.pageAccess(Cc,{pageName:wc,deviceType:String(null==e?void 0:e.selectedTreeNode.mocId)})}componentDidMount(){const{deviceDn:e,inverterDn:t,subscriptionTime:n}=this.props;e&&(0,R.PW)(e).then((e=>{const{success:t,data:n}=e;t&&this.setState({isInSharedStation:n})})),t&&this.loadOptList(),this.timer=setInterval((()=>{this.loadOptList()}),n*nc.v.optimizerRealTimeInfo_loadOptList)}componentDidUpdate(e){this.props.inverterDn&&this.props.inverterDn!==e.inverterDn&&this.loadOptList()}componentWillUnmount(){var e;ic.$.pageLeave(this.startTime,Tc,{pageName:wc,deviceType:String(null===(e=this.props)||void 0===e?void 0:e.selectedTreeNode.mocId)}),this.timer&&clearInterval(this.timer),this.setState=()=>{}}render(){const{intl:e,inverterDn:t}=this.props,{selectedRowKeys:n,selectedRows:r,isInSharedStation:i,initialSettingModalVisible:o,shouldShowInitialSettingModal:a,deviceChangeModalVisible:s,batchConfiguring:l}=this.state,c=this.getTableProps(),u={selectedRowKeys:n,onChange:this.onSelectChange};return(0,D.jsx)(\"div\",{className:\"nco-opt-realtime-page tab-content\",children:(0,D.jsx)(\"div\",{className:\"content\",children:(0,D.jsx)(\"div\",{className:\"left-content\",children:(0,D.jsxs)(\"div\",{className:\"realtime-info-wrapper\",children:[(0,D.jsxs)(\"div\",{children:[!i&&(0,v.lVp)(v.ITW)&&(0,D.jsxs)(\"div\",{className:\"setting-btns-wrapper\",children:[this.buildBtnAndips((0,D.jsx)(oe.Z,{onClick:this.showSettingModal,disabled:1!==r.length,title:e.formatMessage({id:\"ncoPvToolbar.label.parameterSettings\"}),children:(0,D.jsx)(\"span\",{children:(0,D.jsx)(gn.Z,{id:\"ncoPvToolbar.label.parameterSettings\"})})}),r.length),this.buildBtnAndips((0,D.jsx)(oe.Z,{onClick:this.showDeviceChangeModal,disabled:1!==r.length,title:e.formatMessage({id:\"ncoPvTable.toolbar.swapDevice\"}),children:(0,D.jsx)(\"span\",{children:(0,D.jsx)(gn.Z,{id:\"ncoPvTable.toolbar.swapDevice\"})})}),r.length),this.buildBtnAndips((0,D.jsx)(oe.Z,{onClick:this.deleteHandler,disabled:0===r.length,title:e.formatMessage({id:\"common.button.delete\"}),children:(0,D.jsx)(\"span\",{children:(0,D.jsx)(gn.Z,{id:\"common.button.delete\"})})}),r.length)]}),(0,D.jsx)(\"h3\",{className:\"part-title\",children:e.formatMessage({id:\"neteco.pvms.thirdInterface.src.devReal\"})}),(0,D.jsx)(\"div\",{className:\"realtime-content bottom-gap\",children:(0,D.jsx)(re.Z,{rowSelection:u,...c})})]}),(0,D.jsxs)(\"div\",{className:\"basic-part bottom-gap\",children:[(0,D.jsx)(\"h3\",{className:\"part-title\",children:e.formatMessage({id:\"neteco.pvms.devEport.basicInfo\"})}),(0,D.jsx)(re.Z,{...this.getOptBasicTableProps()})]}),(0,D.jsx)(xc.Z,{visible:s,cancelChange:this.hideDeviceChange,loadDataSource:this.loadOptList,intl:e,selectedRows:[...r],isOpt:!0}),a&&(0,D.jsx)(Sc.Z,{visible:o,close:this.hideSettingModal,hide:this.eliminateSettingModal,show:this.showSettingModal,ok:this.hideSettingModal,parentDn:this.props.parentDn,selectedRows:[...r],startBatchConfiguring:this.startBatchConfiguring,finishBatchConfiguring:this.finishBatchConfiguring,batchConfiguring:l,isOpt:!0,inverterDn:t})]})})})})}}const Pc=Mc,Dc=n(99002).Z,Ic=n(13531).Z,Nc=(0,o.ZP)((e=>{let{selectedTreeNode:t,props:n,subscriptionTime:r}=e;const i={apiParams:{type:\"meter\"},dataLoaderClass:Xl.Z};return(0,D.jsxs)(\"div\",{className:\"station-meter-detail\",children:[(0,D.jsx)(\"div\",{className:\"left\",children:(0,D.jsx)($l.Z,{...i})}),(0,D.jsx)(mc.Z,{props:n,selectedTreeNode:t,subscriptionTime:r})]})})),_c=new Map([[\"online\",\"#008000\"],[\"lost\",\"#FF0000\"],[\"not-connected\",\"#808080\"]]),jc=e=>{let{status:t,text:n,className:r}=e;const i=_c.get(t);return(0,D.jsx)(\"div\",{className:`online-status-wrapper ${r}`,children:(0,D.jsxs)(\"span\",{title:n,className:\"statusTxt ellipsis\",children:[(0,D.jsx)(\"span\",{className:\"circle m_r_10\",style:{backgroundColor:i}}),n]})})},{pageName:kc,accessId:Lc,leaveId:Rc}=on.e.deviceDetail;var Zc=n(49966),Bc=n(20928);const{pageName:Fc,accessId:zc,leaveId:Vc}=on.e.deviceDetail;class Hc extends l.Component{constructor(e){super(e),this.addKey=e=>e&&e.map(((e,t)=>(e.key=e.ncuName+t,e))),this.getAlarmTable=()=>{const{intl:e}=this.props,{a_loading:t,alarmTableData:n,selectedRowKeys:r}=this.state,{total:i,pageNo:o,pageSize:a,list:s}=n,l=[{title:e.formatMessage({id:\"neteco.pvms.setting.TCUId\"}),dataIndex:\"tcuName\",key:\"tcuName\",align:\"center\",width:\"10%\"},{title:e.formatMessage({id:\"neteco.pvms.setting.alarms\"}),dataIndex:\"almSigList\",align:\"center\",width:\"10%\",key:\"almSigList\",render:e=>e?(0,D.jsx)(\"a\",{children:e.length}):(0,D.jsx)(\"a\",{children:\"-\"})},{title:(0,D.jsx)(\"div\",{className:\"tableCol ellipsis\",children:e.formatMessage({id:\"neteco.pvms.partials.main.dm.detailInfo.alarmInfo.name\"})}),dataIndex:\"almSigList\",key:\"almSigList\",render:e=>{const t=e.map(((e,t)=>(0,D.jsx)(\"span\",{className:\"alarmItem ellipsis\",title:e.signalName,children:e.signalName},t)));return(0,D.jsx)(\"div\",{className:\"alarmList\",children:t})}}];return(0,D.jsxs)(\"div\",{className:\"table\",children:[(0,D.jsx)(re.Z,{columns:l,dataSource:s,bordered:!0,loading:t,pagination:!1,size:\"small\"}),(0,D.jsx)(ne.Z,{style:{marginTop:\"0.5rem\"},size:\"small\",total:i,showSizeChanger:!0,showTotal:(0,ce.Z)(e),current:o,pageSize:a,pageSizeOptions:[\"10\",\"20\",\"30\",\"50\",\"100\"],onChange:this.onChangeAlarmPage})]})},this.getRunningTable=()=>{const{intl:e}=this.props,{r_loading:t,runningTableData:n}=this.state,{total:r,pageNo:i,pageSize:o,list:a}=n,s=(e,t)=>{const n=e.filter((e=>e.stdId===t))[0];if(!n)return\"-\";const r=n.value,i=n.desc;let o;switch(t){case 10008:case 10010:case 10009:o=\"0\"===r?\"online\":\"lost\";break;case 10007:case 10006:o=\"1\"===r?\"online\":\"lost\"}return(0,D.jsx)(jc,{status:o,text:i})},l=[{title:e.formatMessage({id:\"neteco.pvms.setting.TCUId\"}),dataIndex:\"tcuName\",key:\"tcuName\",align:\"center\"},{title:e.formatMessage({id:\"neteco.pvms.partials.main.dm.detailInfo.curInfo.pvStatus\"}),dataIndex:\"statusSigList\",key:\"statusSigList\",align:\"center\",render:e=>s(e,10006)},{title:e.formatMessage({id:\"neteco.pvms.setting.communicationStatus\"}),dataIndex:\"statusSigList\",key:\"statusSigList\",align:\"center\",render:e=>s(e,10007)},{title:e.formatMessage({id:\"neteco.pvms.setting.TCUStatus\"}),dataIndex:\"statusSigList\",key:\"statusSigList\",align:\"center\",render:e=>s(e,10008)},{title:e.formatMessage({id:\"neteco.pvms.setting.testStatus\"}),dataIndex:\"statusSigList\",key:\"statusSigList\",align:\"center\",render:e=>s(e,10009)},{title:e.formatMessage({id:\"neteco.pvms.setting.trialRunningStatus\"}),dataIndex:\"statusSigList\",key:\"statusSigList\",align:\"center\",render:e=>s(e,10010)}];return(0,D.jsxs)(\"div\",{className:\"table\",children:[(0,D.jsx)(re.Z,{columns:l,dataSource:a,bordered:!0,loading:t,pagination:!1,size:\"small\"}),(0,D.jsx)(ne.Z,{style:{marginTop:\"0.5rem\"},size:\"small\",total:r,showSizeChanger:!0,showTotal:(0,ce.Z)(e),current:i,pageSize:o,pageSizeOptions:[\"10\",\"20\",\"30\",\"50\",\"100\"],onChange:this.onChangeRunningPage})]})},this.onChangeRunningPage=(e,t)=>{this.getRunningStatusList(e,t)},this.onChangeAlarmPage=(e,t)=>{this.getAlarmStatusList(e,t)},this.exportReport=async()=>{var e;e=this.state.elementDn,(0,Bc.Z)(`/rest/pvms/web/ncu/v1/tcu/alarm-export?ncuDn=${e}`)},this.getRunningStatusList=(e,t)=>{var n;this.setState({r_loading:!0}),(n={ncuDn:this.state.elementDn,currPage:e,pageSize:t},(0,O.v_)(\"/rest/pvms/web/ncu/v1/tcu/status\",n)).then((e=>{e.success&&(e.data.list=this.addKey(e.data.list),this.setState({runningTableData:e.data}),this.setState({r_loading:!1}))}))},this.getAlarmStatusList=async(e,t)=>{var n;this.setState({a_loading:!0}),(n={ncuDn:this.state.elementDn,currPage:e,pageSize:t},(0,O.v_)(\"/rest/pvms/web/ncu/v1/tcu/alarm\",n)).then((e=>{e.success&&(e.data.list=this.addKey(e.data.list),this.setState({alarmTableData:e.data}),this.setState({a_loading:!1}))}))},this.setExportListModal=e=>{this.setState({showExportListModal:e})};const{props:{selectedTreeNode:{elementDn:t}}}=e;this.state={elementDn:t,r_loading:!1,a_loading:!1,exportLoading:!1,showExportListModal:!1,selectedRowKeys:[],runningTableData:{list:[],total:0,pageNo:1,pageSize:10},alarmTableData:{list:[],total:0,pageNo:1,pageSize:10}};const{props:n}=e;this.startTime=ic.$.pageAccess(zc,{pageName:Fc,deviceType:String(null==n?void 0:n.selectedTreeNode.mocId)})}componentDidMount(){const{runningTableData:e,alarmTableData:t,elementDn:n}=this.state;this.getRunningStatusList(e.pageNo,e.pageSize),this.getAlarmStatusList(t.pageNo,t.pageSize)}componentWillUnmount(){const{props:e}=this.props;ic.$.pageLeave(this.startTime,Vc,{pageName:Fc,deviceType:String(null==e?void 0:e.selectedTreeNode.mocId)}),this.setState=()=>{}}render(){const{intl:e}=this.props,{exportLoading:t,showExportListModal:n}=this.state;return(0,D.jsx)(\"div\",{className:\"station-tcu-detail tab-content\",children:(0,D.jsx)(\"div\",{className:\"content\",children:(0,D.jsx)(\"div\",{className:\"left-content\",children:(0,D.jsxs)(\"div\",{className:\"middle\",children:[(0,D.jsxs)(\"div\",{className:\"nco-tcue-table noborder\",children:[(0,D.jsx)(\"div\",{className:\"top-content\",children:(0,D.jsx)(\"div\",{className:\"top-left\",children:e.formatMessage({id:\"neteco.pvms.basicUnifSignal.backup.runStatus\"})})}),this.getRunningTable()]}),(0,D.jsxs)(\"div\",{className:\"nco-tcue-table\",children:[(0,D.jsxs)(\"div\",{className:\"top-content\",children:[(0,D.jsx)(\"div\",{className:\"top-left\",children:e.formatMessage({id:\"neteco.pvms.tcue.alarmStatus\"})}),(0,D.jsx)(\"div\",{className:\"top-right\",children:(0,D.jsxs)(oe.Z,{loading:t,onClick:this.exportReport,children:[(0,D.jsx)(Zc.Z,{}),(0,D.jsx)(gn.Z,{id:\"common.button.export\"})]})})]}),this.getAlarmTable()]})]})})})})}}const Uc=(0,o.ZP)(Hc);var Gc=n(75528),Yc=n(2203),Wc=n(50634),Kc=n(57923);const{twaver:qc}=window,Qc=[class{constructor(e,t,n){this.changeButton=async(e,t,n,r)=>{const{deviceDn:i}=this._apiParams,o={elementDn:i,changeValues:[{id:String(Kc.KE[String(e._id)]),value:\"65280\"}]},a=await(0,ec.Xq)({elementDn:i,signals:Kc.Ge}),s=a.data.findIndex((t=>t.id===e._id));(0,ec.sl)(o).then((t=>{if(t){let t=0,o=2e3,l=6e4,c=[[230530108,230530109],[230530112,230530113],[230530119,230530120]].find((t=>t.includes(Number(e._id))));const u=()=>{t!==l/o?((0,ec.cn)(i,c),this.timer&&clearTimeout(this.timer),this.timer=setTimeout((()=>{(0,ec.Xq)({elementDn:i,signals:Kc.Ge}).then((e=>{e.success&&this._network.getDataLoader().loadRes(e),a.data[s].value===e.data[s].value?u():n()}))}),o)):r(),t++};u()}else r()})).catch((()=>{r()}))},this.createInput=(e,t,n,r,i,o)=>{const a=n.getElementBox(),s=a.getDataById(Kc.M7[e]),l=a.getDataById(e),c=null==l?void 0:l.c(\"hidden\");if(s){const a=s.getLocation(),u=200,d=32,p=n.getZoom();let f=document.createElement(\"input\");f.id=t;const{style:h}=f;h.position=\"absolute\",h.font=\"500 12px FZLTHJW--GB1-0\",h.border=\"1px solid #BBBBBB \",h.borderRadius=\"4px\",h.color=\"#1C1C1C\",h.width=`${u}px`,h.height=`${d}px`,h.outline=\"none\";const m={input1:\"neteco.pvms.sts.overview.upstsTo\",input2:\"neteco.pvms.sts.overview.downstsTo\",input3:\"neteco.pvms.sts.overview.current\"};f.placeholder=o.formatMessage({id:m[t]});const g=n.getViewRect().x,v=n.getViewRect().y;let y=a.x*p-(100-70*p)-g+\"px\";return\"input3\"!==t&&(y=a.x*p-g+\"px\"),h.left=y,h.top=a.y*p-(13-10*p)-v+\"px\",h.transform=`scale(${p})`,h.display=\"\",h.zIndex=100,l.setVisible(!1),s.c(\"value\")&&(f.style.display=\"none\",l.setVisible(!0)),c&&(f.style.display=\"none\",l.setVisible(!1)),this.inputEvent(f,e,l,n,i),r.current.appendChild(f),f}},this.autofitInput=(e,t,n)=>{const r=t.getElementBox().getDataById(Kc.M7[e]);if(r){const e=r.getLocation(),i=t.getZoom(),{style:o}=n,a=t.getViewRect().x,s=t.getViewRect().y;let l=e.x*i-(100-70*i)-a+\"px\";\"input3\"!==n.id&&(l=e.x*i-a+\"px\"),o.left=e.x*i-a+\"px\",o.top=e.y*i-(13-10*i)-s+\"px\",o.transform=`scale(${i})`}else n.parentNode.removeChild(n)},this._network=e,this._apiParams=n,this.init()}init(){const e=this._network,{switchCallback:t,resSuccessCallback:n,resFailedCallback:r}=this._apiParams;this._handler=this.centerLayoutHandler.bind(this),e.removeViewListener(this._handler),e.addViewListener(this._handler);const i=this._network.getElementBox();e.setEditInteractions(),e.addInteractionListener((async o=>{let a=o.element;if(e.hasEditInteraction()){if(\"clickElement\"===o.kind&&a._image&&\"sts_edit\"===a._image){const e={paintNode1:\"input1\",paintNode2:\"input2\",paintNode3:\"input3\"},t=document.getElementById(e[a._id]);this.changeEdit(t,a._id,i)}if(\"clickElement\"===o.kind&&a._image&&\"sts_button\"===a._image){const e=a.getClient(\"value\")||\"1\",o=a.getClient(\"isOnline\")||!1,s=a.getClient(\"isAbnormal\")||!1;Kc.g$.indexOf(a._id)>-1&&\"0\"===e&&o&&!s&&await t()&&this.changeButton(a,i,n,r)}}})),e.getView().addEventListener(\"mousemove\",(t=>{const n=e.getElementAt(t);e.getView().style.cursor=n?\"pointer\":\"default\",e.setToolTipEnabled(!0)}),!1),e.getView().addEventListener(\"mouseout\",(t=>{e.setToolTipEnabled(!1)}),!1)}centerLayoutHandler(e){if(\"validateEnd\"===e.kind){this._network.zoomOverview();const e=this._network.getZoom();this._network.setZoom(e)}}resizeHandler(e,t){const n=this._network;t.id&&\"sts\"===t.id&&(this.stsNumberTimer&&clearTimeout(this.stsNumberTimer),this.stsNumberTimer=setTimeout((()=>{const r={input1:\"paintNode1\",input2:\"paintNode2\",input3:\"paintNode3\"};Object.keys(r).forEach((i=>{const o=document.getElementById(i);o?this.autofitInput(r[i],n,o):this.createInput(r[i],i,n,e,t.apiParams,t.intl)}))}),50))}changeEdit(e,t,n){const r=n.getDataById(Kc.M7[t]),i=n.getDataById(t),{style:o}=e;e.value=r.c(\"value\")||\"\",o.display=\"\",i.setVisible(!1),e.focus()}inputEvent(e,t,n,r,i){e.addEventListener(\"blur\",(()=>{e.style.display=\"none\",n.setVisible(!0);const{deviceDn:o}=i;let a={elementDn:o,changeValues:[{id:String(Kc.M7[t]),value:e.value}]};(0,ec.sl)(a).then((e=>{(0,ec.Xq)({elementDn:o,signals:Kc.Ge}).then((e=>{e&&r.getDataLoader().loadRes(e)}))}))})),e.addEventListener(\"focus\",(()=>{e.style.border=\"2px solid #0067D1\"})),e.onkeydown=t=>{const n=t||(window.event?window.event:null);13===(null==n?void 0:n.keyCode)&&(e.style.display=\"none\")}}getApiMethods(){return[\"NetworkEnhancer\",\"resizeHandler\"]}}];var Xc=n(79397),Jc=n(88345),$c=n(99167);const eu={Node:[{id:230530502,image:\"sts_name\",cloc:[70,100],client:{value:\"\",fontSize:\"20px\"}},{id:\"paintNode3\",image:\"sts_edit\",cloc:[180,100],client:{}},{id:\"paintIcon1\",image:\"sts_icon\",cloc:[321,120],client:{}},{id:230530500,image:\"sts_name\",cloc:[400,120],client:{}},{id:\"paintNode1\",image:\"sts_edit\",cloc:[480,120],client:{}},{id:\"paintIcon2\",image:\"sts_icon\",cloc:[809,120],client:{}},{id:230530501,image:\"sts_name\",cloc:[888,120],client:{}},{id:\"paintNode2\",image:\"sts_edit\",cloc:[968,120],client:{}},{id:230530128,image:\"sts_switch\",loc:[312,180],name:\"neteco.pvms.sts.overview.loadSwitch.1\",client:{},style:{\"label.linespacing\":20,\"label.position\":\"left\",\"label.pointer.length\":10,\"label.direction\":\"left\"}},{id:230530132,image:\"sts_switch\",loc:[800,180],name:\"neteco.pvms.sts.overview.outLoadSwitch.3\",client:{},style:{\"label.linespacing\":20,\"label.position\":\"left\",\"label.pointer.length\":10,\"label.direction\":\"left\"}},{id:230530121,image:\"sts_switch\",loc:[556,380],name:\"neteco.pvms.sts.overview.DisconnectorSwitch.2\",style:{\"label.linespacing\":20,\"label.position\":\"left\",\"label.pointer.length\":10,\"label.direction\":\"left\"},client:{type:2}},{id:230530130,image:\"sts_grouding\",loc:[400,150],name:\"neteco.pvms.sts.overview.groundingSwitch.1\",client:{},style:{\"label.linespacing\":20}},{id:230530134,image:\"sts_grouding\",loc:[890,150],name:\"neteco.pvms.sts.overview.outGroundingSwitch.3\",style:{\"label.linespacing\":20},client:{value:\"0\"}},{id:230530123,image:\"sts_grouding\",loc:[650,430],name:\"neteco.pvms.sts.overview.groundingSwitch.2\",client:{},style:{\"label.linespacing\":20,\"label.pointer.length\":10,\"label.position\":\"bottomleft.topright\",\"label.direction\":\"rightbelow\"}},{id:\"transformerNode\",image:\"sts_transformer\",loc:[520,460],client:{isDoubleWinding:!1}},{id:\"lowVSwitchA\",image:\"sts_breaker\",loc:[300,525],name:\"neteco.pvms.sts.overview.lowVoltageA.breaker\",style:{\"label.linespacing\":20,\"label.pointer.length\":10,\"label.direction\":\"aboveright\",\"label.xoffset\":-14,\"label.yoffset\":-20},client:{value:\"0\",isRotate:!0}},{id:\"lowVSwitchA_danger\",image:\"sts_danger\",loc:[280,530],size:[13,13]},{id:\"lowVSwitchB\",image:\"sts_breaker\",loc:[788,525],name:\"neteco.pvms.sts.overview.lowVoltageB.breaker\",style:{\"label.linespacing\":20,\"label.pointer.length\":10,\"label.direction\":\"aboveright\",\"label.xoffset\":-14,\"label.yoffset\":-20},client:{value:\"0\",isRotate:!0}},{id:\"lowVSwitchB_danger\",image:\"sts_danger\",loc:[768,530],size:[13,13]},{id:\"breakerSwitch\",image:\"sts_breaker\",loc:[556,300],name:\"neteco.pvms.sts.overview.breaker.g2\",style:{\"label.linespacing\":20,\"label.pointer.length\":25,\"label.direction\":\"aboveright\",\"label.xoffset\":14,\"label.yoffset\":-10},client:{}},{id:\"breaker_danger\",image:\"sts_danger\",loc:[536,310],size:[13,13]},{id:230530111,image:\"sts_status\",loc:[300,546],client:{value:\"0\"}},{id:230530108,image:\"sts_button\",loc:[300,566],client:{buttonText:\"neteco.pvms.sts.overview.close\",value:\"0\"}},{id:230530109,image:\"sts_button\",loc:[360,566],client:{buttonText:\"neteco.pvms.sts.overview.divide\",value:\"1\"}},{id:230530115,image:\"sts_status\",loc:[788,546],client:{value:\"0\"}},{id:230530112,image:\"sts_button\",loc:[788,566],client:{buttonText:\"neteco.pvms.sts.overview.close\",value:\"0\"}},{id:230530113,image:\"sts_button\",loc:[848,566],client:{buttonText:\"neteco.pvms.sts.overview.divide\",value:\"1\"}},{id:230530126,image:\"sts_status\",loc:[582,315],client:{value:\"0\"}},{id:230530119,image:\"sts_button\",loc:[582,335],client:{buttonText:\"neteco.pvms.sts.overview.close\",value:\"0\"}},{id:230530120,image:\"sts_button\",loc:[642,335],client:{buttonText:\"neteco.pvms.sts.overview.divide\",value:\"1\"}}],Link:[{id:\"link1\",from:\"paintIcon1\",to:230530128,style:{\"link.width\":1,\"link.from.yoffset\":11,\"link.to.yoffset\":-26}},{id:\"link2\",from:\"paintIcon2\",to:230530132,style:{\"link.width\":1,\"link.from.yoffset\":11,\"link.to.yoffset\":-26}},{id:\"link3\",from:230530128,to:\"bus1\",style:{\"link.width\":1,\"link.from.xoffset\":0,\"link.from.yoffset\":15,\"link.to.xoffset\":0,\"link.to.yoffset\":0}},{id:\"link4\",from:230530132,to:\"bus1\",style:{\"link.width\":1,\"link.from.xoffset\":0,\"link.from.yoffset\":15,\"link.to.xoffset\":0,\"link.to.yoffset\":0}},{id:\"link5\",from:\"bus1\",to:\"breakerSwitch\",style:{\"link.width\":1,\"link.to.yoffset\":-15}},{id:\"link6\",from:\"breakerSwitch\",to:230530121,style:{\"link.width\":1,\"link.from.yoffset\":15,\"link.to.yoffset\":-20}},{id:\"link7\",from:230530121,to:\"transformerNode\",style:{\"link.width\":1,\"link.from.yoffset\":20,\"link.to.yoffset\":-44}}],Bus:[{id:\"bus1\",points:[{x:321,y:268},{x:809,y:268}]},{id:\"bus2\",points:[{x:321,y:165},{x:400,y:165}],client:{}},{id:\"bus3\",points:[{x:809,y:165},{x:890,y:165}],client:{}},{id:\"bus4\",points:[{x:200,y:516},{x:300,y:516}]},{id:\"bus5\",points:[{x:836,y:516},{x:963,y:516}]},{id:\"bus6\",points:[{x:348,y:516},{x:522,y:516}],prePoints:[{x:348,y:516},{x:542,y:516}]},{id:\"bus7\",points:[{x:608,y:516},{x:788,y:516}]},{id:\"bus8\",points:[{x:565,y:445},{x:680,y:445}]}]},tu={Node:[{id:230530121,preY:380,curY:290},{id:230530123,preY:430,curY:340},{id:\"breakerSwitch\",preY:300,curY:395,preStyle:{\"label.direction\":\"aboveright\",\"label.xoffset\":15,\"label.yoffset\":-10},curStyle:{\"label.direction\":\"aboveleft\",\"label.xoffset\":-20,\"label.yoffset\":-10}},{id:\"breaker_danger\",preX:536,curX:580,preY:305,curY:405},{id:230530126,preX:582,curX:430,preY:315,curY:410},{id:230530119,preX:582,curX:430,preY:335,curY:430},{id:230530120,preX:642,curX:490,preY:335,curY:430}],Bus:[{id:\"bus8\",prePoints:[{x:565,y:445},{x:650,y:445}],curPoints:[{x:565,y:355},{x:650,y:355}]}]},nu=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.resultData=e}getSignalData(e){return void 0===this[`signal_data_${e}`]&&(this[`signal_data_${e}`]=this.resultData.find((t=>{let{id:n}=t;return n===Number(e)}))),this[`signal_data_${e}`]}paramMask2(){return this.getSignalData(Kc.m6.argSignal2.id)}featureMask1(){return this.getSignalData(Kc.m6.specialSignal.id)}lvcAACB(){return this.getSignalData(Kc.m6.lowASignal.id)}lvcBACB(){return this.getSignalData(Kc.m6.lowBSignal.id)}lvcACB(){return this.getSignalData(Kc.m6.lowACBSignal.id)}showLowVSwitchA(){const e=this.paramMask2();if(!e)return!1;const t=this.lvcAACB(),n=this.lvcACB(),r=(0,Jc.vA)(e.value,6);return\"0\"===r&&\"1\"===(null==t?void 0:t.value)||\"1\"===r&&\"1\"===(null==n?void 0:n.value)}showLowVSwitchB(){const e=this.paramMask2();if(!e)return!1;const t=(0,Jc.vA)(e.value,6),n=this.lvcACB(),r=this.lvcBACB(),i=this.featureMask1(),o=(0,Jc.vA)(i.value,0);return\"0\"===t&&\"1\"===(null==r?void 0:r.value)&&\"1\"===o||\"1\"===t&&\"1\"===(null==n?void 0:n.value)&&\"1\"===o}},{twaver:ru}=window;class iu extends Xc.Z{constructor(e,t,n){super(e,t,n),this.setNodeStyles=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object.keys(t).forEach((n=>{e.s(n,t[n])}))},this._box=e.getElementBox(),this._tagFinder=null}api(){const{deviceDn:e}=this._apiParams,t=Kc.Ge+\",\"+Kc.C2;return(0,ec.Xq)({elementDn:e,signals:t})}fetch(e){const{deviceDn:t}=this._apiParams;Promise.all([(0,ec.lr)(t),this.api(),(0,ec.CU)(t)]).then((t=>{let[n,r,i]=t;this.isDoubleSplitSTS=i,r.success&&(this.signalInstance=new nu(r.data)),e?this.refresh(r):(n.success&&(this._apiParams.stsStatus=n.data.mo.status||\"Disconnected\"),r.success&&this.load(r));const o=this._network.getInteractionhandler(\"callback\");o&&o(r)}))}load(e){this.registerImage(),this._network.getSelectionModel().setFilterFunction((()=>!1));const t=JSON.parse(JSON.stringify(eu));this.loopNode(t),t.Bus.forEach((e=>{e.style={\"vector.outline.width\":1,\"vector.outline.color\":\"#999999\",\"select.color\":\"transparent\"},\"bus6\"!==e.id||this.isDoubleSplitSTS||(e.points=e.prePoints);const t=this.createBus(e,this._box);t.getClient(\"cannotExist\")&&t.setVisible(!1),this._box.add(t)})),t.Link.forEach((e=>{e.isId=!0;const t=this.createLink(e);t._id=e.id,t.s(\"link.color\",\"RGB(149,149,149)\"),this._box.add(t)})),this._tagFinder=new ru.QuickFinder(this._box,\"id\");const n={230530500:\"paintNode1\",230530501:\"paintNode2\",230530503:\"paintNode3\"};e.data.forEach((e=>{if(Object.keys(n).includes(String(e.id))){const t=this._box.getDataById(n[e.id]);t.setVisible(!!e.value),t.c(\"hidden\",\"\")}})),this.loadRes(e)}loopNode(e){e.Node.forEach((e=>{\"sts_button\"===e.image&&(e.client.buttonText=this._intl.formatMessage({id:e.client.buttonText})),\"transformerNode\"===e.id&&(e.client.isDoubleWinding=!this.isDoubleSplitSTS);const t=this.createNode(e);if(t.s(\"label.font\",\"12px FZLTHJW--GB1-0\"),e.name){const n=this._intl.formatMessage({id:e.name}),r=[\"lowVSwitchA\"],i=[\"230530121\",\"230530123\",\"breakerSwitch\",\"lowVSwitchB\"];t.setToolTip(n),r.includes(String(e.id))?t.setName((0,Jc.dX)(n,36)):i.includes(String(e.id))?t.setName((0,Jc.dX)(n,72)):t.setName((0,Jc.dX)(n,32,2))}t.getClient(\"cannotExist\")&&t.setVisible(!1),this._box.add(t)}))}loadRes(e){const t=this.signalInstance.showLowVSwitchA();this._tagFinder.findFirst(\"lowVSwitchA\").setVisible(t),this._tagFinder.findFirst(\"bus4\").setPoints(new ru.List([{x:200,y:516},{x:t?300:348,y:516}]));const n=this.signalInstance.showLowVSwitchB();this._tagFinder.findFirst(\"lowVSwitchB\").setVisible(n),n?this._tagFinder.findFirst(\"bus7\").setPoints(new ru.List([{x:n?605:589,y:516},{x:n?788:836,y:516}])):this.removeLowVSwitchBAbout();let r={};const i=this.signalInstance.featureMask1(),o=(0,Jc.vk)(null==i?void 0:i.value,4,\"0\").split(\"\").reverse();Kc.g$.forEach((e=>{var t;r[e]=null===(t=this.signalInstance.getSignalData(e))||void 0===t?void 0:t.value})),this.validDangerTip(r,t,n),this.validBreakerOfG2(o[3]),e.data.forEach((e=>{const r=this._tagFinder.findFirst(e.id);r&&(r.c(\"name\",e.name),r.c(\"value\",e.value)),Kc.Ac.includes(e.id)?this.validThreeStatus(e,t,n,o[0]):Kc.g$.includes(e.id)?this.validThreeButton(e):Kc.m6.RMUSignal.id===e.id&&this.validRMUSig(e,o[1],o[2])}))}validThreeStatus(e,t,n,r){Object.keys(Kc.AI).forEach((i=>{const o=this._tagFinder.findFirst(Number(i)),a=this._tagFinder.findFirst(Kc.AI[i]),s=this._tagFinder.findFirst(Kc.zX[i]);i===String(e.id)&&(o.c(\"statusText\",this._intl.formatMessage({id:{0:\"neteco.pvms.sts.overview.local\",1:\"neteco.pvms.sts.overview.remote\"}[e.value||0]})),230530111===e.id?(o.setVisible(t),a.setVisible(!(!t||\"1\"!==e.value)),s.setVisible(!(!t||\"1\"!==e.value))):230530115===e.id?(o.setVisible(\"1\"===r&&n),a.setVisible(!(\"1\"!==r||!n||\"1\"!==e.value)),s.setVisible(!(\"1\"!==r||!n||\"1\"!==e.value))):(o.setVisible(!0),a.setVisible(\"1\"===e.value),s.setVisible(\"1\"===e.value)))}))}validThreeButton(e){const{stsStatus:t}=this._apiParams;Kc.bj.includes(e.id)&&this._tagFinder.findFirst(Kc.G$[e.id]).c(\"value\",e.value),this._tagFinder.findFirst(e.id).c(\"isOnline\",\"Connected\"===t)}validDangerTip(e,t,n){Kc.pq.forEach(((r,i)=>{const o=this._tagFinder.findFirst(r),a=this._tagFinder.findFirst(Kc.Fp[r]),s=this._tagFinder.findFirst(Kc.KZ[r]);let l,c=2*i;switch(r){case\"lowVSwitchA_danger\":l=t&&e[Kc.g$[c]]===e[Kc.g$[c+1]];break;case\"lowVSwitchB_danger\":l=n&&e[Kc.g$[c]]===e[Kc.g$[c+1]];break;case\"breaker_danger\":l=e[Kc.g$[c]]===e[Kc.g$[c+1]]}l&&(a.c(\"isAbnormal\",!0),s.c(\"isAbnormal\",!0)),o.setVisible(l),o.setToolTip(this._intl.formatMessage({id:\"neteco.pvms.sts.overview.dangerTooltips\"}))}))}validRMUSig(e,t,n){const r=this._tagFinder.findFirst(230530128),i=this._tagFinder.findFirst(230530132),o=this._tagFinder.findFirst(230530130),a=this._tagFinder.findFirst(230530134),s=this._tagFinder.findFirst(\"link1\"),l=this._tagFinder.findFirst(\"link2\"),c=this._tagFinder.findFirst(\"bus1\"),u=this._tagFinder.findFirst(\"bus2\"),d=this._tagFinder.findFirst(\"bus3\"),p=e.value,f=\"1\"===t&&(\"0\"===p||\"3\"===p);r.setVisible(f),o.setVisible(f),c.setPoints(new ru.List([{x:321,y:268},{x:\"3\"===p?565:809,y:268}])),u.setVisible(f),s.setToNode(f?r:c),s.s(\"link.to.yoffset\",f?-26:0);const h=\"1\"===n&&(\"0\"===p||\"1\"===p);if(i.setVisible(h),a.setVisible(h),d.setVisible(h),l.setToNode(h?i:c),l.s(\"link.to.yoffset\",h?-26:0),\"3\"===p){const e=this._tagFinder.findFirst(230530501),t=this._tagFinder.findFirst(\"paintNode2\");l.setVisible(h),e.setVisible(h),t.setVisible(h),t.c(\"hidden\",!0)}}validBreakerOfG2(e){const t=\"1\"===e;tu.Node.forEach((e=>{const n=this._tagFinder.findFirst(e.id);n.setY(t?e.curY:e.preY),e.curX&&e.preX&&n.setX(t?e.curX:e.preX),this.setNodeStyles(n,t?e.curStyle:e.preStyle)})),tu.Bus.forEach((e=>{this._tagFinder.findFirst(e.id).setPoints(new ru.List(t?e.curPoints:e.prePoints))}));const n=this._tagFinder.findFirst(230530121),r=this._tagFinder.findFirst(\"breakerSwitch\"),i=this._tagFinder.findFirst(\"link5\"),o=this._tagFinder.findFirst(\"link6\"),a=this._tagFinder.findFirst(\"link7\");i.setToNode(t?n:r),o.s(\"link.from.yoffset\",t?-20:15).s(\"link.to.yoffset\",t?15:-20),a.setFromNode(t?r:n)}async refresh(e){e.success&&this.loadRes(e)}registerImage(){(0,Jc.Q)(\"sts_danger\",$c.Z.sts_danger,this._network)}removeLowVSwitchBAbout(){[\"bus5\",\"bus7\"].forEach((e=>{const t=this._tagFinder.findFirst(e);t&&t.setVisible(!1)}))}}const ou=e=>{let{title:t=\"\",columns:n=3,data:r=[],intl:i={},order:o}=e,a=[];const s=[\"Ia\",\"Ib\",\"Ic\",\"Uab\",\"Ubc\",\"Uca\"],c={\"neteco.pvms.sts.overview.oilTemp\":\"\",\"neteco.pvms.sts.overview.windingTemp\":\"\",\"neteco.pvms.sts.overview.temp\":\"\",Ia:\"A\",Ib:\"A\",Ic:\"A\",Uab:\"V\",Ubc:\"V\",Uca:\"V\",\"neteco.pvms.sts.overview.humidity\":\"%\",\"neteco.pvms.sts.overview.activePower\":\"MW\",\"neteco.pvms.sts.overview.reactivePower\":\"kVar\",\"neteco.pvms.sts.overview.powerFactor\":\"cos\",\"neteco.pvms.sts.overview.transformerRoom.oilTemp\":\"\",\"neteco.pvms.sts.overview.transformerRoom.windingTemp\":\"\",\"neteco.pvms.sts.overview.transformerRoom.Ia\":\"A\",\"neteco.pvms.sts.overview.transformerRoom.Ib\":\"A\",\"neteco.pvms.sts.overview.transformerRoom.Ic\":\"A\",\"neteco.pvms.sts.overview.transformerRoom.Uab\":\"V\",\"neteco.pvms.sts.overview.transformerRoom.Ubc\":\"V\",\"neteco.pvms.sts.overview.transformerRoom.Uca\":\"V\",\"neteco.pvms.sts.overview.transformerRoom.activePower\":\"MW\",\"neteco.pvms.sts.overview.transformerRoom.reactivePower\":\"kVar\",\"neteco.pvms.sts.overview.transformerRoom.powerFactor\":\"cos\"},u=(0,l.useRef)();(0,l.useEffect)((()=>{if(null!=u&&u.current){const e=[[],[],[],[]];Object.values(u.current.children).forEach((t=>{Object.values(t.children).forEach(((t,n)=>{e[n].push(t.clientHeight)}))})),e.forEach(((e,t)=>{e.some((e=>e>40))&&Object.values(u.current.children).forEach((e=>{e.children[t]&&(e.children[t].style.height=\"60px\")}))}))}}));const d=e=>{let t=s.includes(e.name)?e.name:i.formatMessage({id:e.name}),n=\"cos\"===c[e.name]?\"\":`${e.unit||c[e.name]}`;return(0,D.jsxs)(\"div\",{className:\"nco-item\",children:[(0,D.jsxs)(\"div\",{className:\"item-value\",children:[(0,D.jsx)(\"div\",{className:\"card-value\",children:(\"N/A\"===e.value?\"--\":(0,kt.af)(e.value))||\"--\"}),(0,D.jsx)(\"div\",{className:\"card-unit\",children:n})]}),(0,D.jsx)(me.Z,{title:t,children:(0,D.jsx)(\"div\",{className:\"item-name\",children:t})})]})};return r.length>0?(r.forEach(((e,t)=>{3===n?0==t%4&&a.push((0,D.jsxs)(\"div\",{className:t>7?\"nco-col2\":\"nco-col1\",children:[r[t]&&d(r[t]),r[t+1]&&d(r[t+1]),r[t+2]&&d(r[t+2]),r[t+3]&&d(r[t+3])]},t)):a.push((0,D.jsx)(\"div\",{className:\"nco-col\",children:d(e)},t))})),a=(0,D.jsx)(\"div\",{className:\"dom\",ref:u,children:a})):a=(0,D.jsx)(Et.Z,{image:Et.Z.PRESENTED_IMAGE_SIMPLE}),(0,D.jsx)(b.Z,{spinning:!r,children:(0,D.jsxs)(\"div\",{className:\"nco-info-card-box\",children:[(0,D.jsx)(\"div\",{className:\"title-wrap\",children:(0,D.jsx)(me.Z,{title:t,children:(0,D.jsx)(\"div\",{className:\"title\",children:t})})}),(0,D.jsx)(\"div\",{className:3===o?\"nco-info-content rightborder\":\"nco-info-content\",children:a})]})})};var au=n(39011);const su=e=>{let{data:t=[],intl:n={}}=e;return(0,D.jsx)(\"div\",{className:\"nco-status-info-warp\",children:t&&t.map((e=>(0,D.jsx)(au.K,{label:n.formatMessage({id:e.label}),imgUrl:e.imgUrl},e.label)))})};var lu=n(88927);const{operationFailed:cu,operationSuccess:uu}=Ql.Z,{Prel:du,location:pu}=window;class fu extends l.Component{constructor(e){super(e),this.setSingleVoltageValue=(e,t)=>{t.data&&t.data.forEach((t=>{t.id===e.id&&(t.value=e.value,t.unit=e.unit)}))},this.setVoltageValue=(e,t)=>{e.data&&e.data.forEach((e=>{this.setSingleVoltageValue(e,t)}))},this.resetValues=(e,t)=>{e&&\"Connected\"!==e&&t.forEach((e=>{e.data.forEach((e=>{e.value=\"--\"}))}))},this.dealTransformerData=(e,t)=>{if(e.data){const{transformerTempSig:n,argSignal:r}=this.state,i=r.split(\"\").reverse();this.setVoltageValue(e,t),\"0\"===n&&t.data.splice(1,1),e.data.forEach((e=>{Kc.KQ.forEach((n=>{if(i[n.index]===Kc.QA&&e.id===n.sigId){const n=t.data.findIndex((t=>t.id===e.id));t.data.splice(n,1)}}))}))}},this.verifyingPasswords=async e=>{const{intl:t}=this.props,n={pwdCode:e},r=await(0,O.v_)(\"/rest/pvms/web/management/v1/config/change_Pwd\",n);return r.success||(cu(t,t.formatMessage({id:\"neteco.pvms.checkPwd.error\"})),this.setState({verifyPwdLoading:!1})),r},this.pwdChange=e=>{const{intl:t}=this.props;e.target.value?this.setState({pwdValue:e.target.value,text:\"\"}):this.setState({pwdValue:null,text:t.formatMessage({id:\"neteco.pvms.systemSetting.inputPassward\"})})},this.state={cardData:[],specialSigValue0:null,argSignal:null,transformerTempSig:null,transformerDn:\"\",voltageADn:\"\",voltageBDn:\"\",pwdValue:\"\",verifyPwdLoading:!1,equipOverviewLoading:!1}}getCardDetailData(e){this.setState({equipOverviewLoading:!0});const{transformerDn:t,voltageADn:n,voltageBDn:r}=this.state,{deviceDn:i}=this.props,o={elementDn:i,signals:\"10012,10013\"},a={elementDn:t,signals:Kc.eA+\",\"+Kc.XX},s={elementDn:n,signals:Kc.io},l={elementDn:r,signals:Kc.e2};Promise.all([(0,ec.Xq)(o),(0,ec.Xq)(a),(0,ec.Xq)(s),(0,ec.Xq)(l),(0,ec.lr)(i)]).then((t=>{let[n,r,i,o,a]=t;const s=JSON.parse(JSON.stringify(Kc.fZ)),[l,c,u,d]=s;e||s.splice(1,1);const p=a.data.mo.status;this.setVoltageValue(n,u),this.dealTransformerData(r,d),this.setVoltageValue(i,l),e&&this.setVoltageValue(o,c),this.resetValues(p,s),this.setState({cardData:s})})).catch((e=>{this.setState({cardData:JSON.parse(JSON.stringify(Kc.fZ))})})).finally((()=>{this.setState({equipOverviewLoading:!1})}))}componentDidMount(){const{deviceDn:e}=this.props;Promise.all([(0,ec.Xq)({elementDn:e,signals:\"10049,230532062,230530025\"}),(0,ec.EG)({deviceDn:e}),(0,ec.CU)(e)]).then((e=>{let[t,n,r]=e;this.setState({isDoubleSplitSTS:r}),t.data&&n.data&&(t.data.forEach((e=>{switch(e.id){case 10049:this.setState({specialSigValue0:Number(e.value).toString(2).slice(-1)});break;case 230530025:this.setState({argSignal:(0,Jc.vk)(e.value,32,\"0\")});break;case 230532062:this.setState({transformerTempSig:e.value})}})),n.data.forEach((e=>{\"TR-1\"===e.name&&this.setState({transformerDn:e.dn}),\"LV-1\"===e.name&&this.setState({voltageADn:e.dn}),\"LV-2\"===e.name&&this.setState({voltageBDn:e.dn})})),this.getCardDetailData(r))}))}render(){const{cardData:e,specialSigValue0:t,pwdValue:n,verifyPwdLoading:r,equipOverviewLoading:i,isDoubleSplitSTS:o}=this.state,{intl:a,deviceDn:s}=this.props,l={id:\"sts\",enhancerClasses:Qc,dataLoaderClass:iu,intl:a,apiParams:{deviceDn:s,switchCallback:()=>new Promise((e=>{gc.Z.confirm({title:a.formatMessage({id:\"neteco.pvms.checkPassword.Title\"}),content:(0,D.jsx)(fe.Z,{style:{marginTop:\"10%\"},children:(0,D.jsx)(fe.Z.Item,{label:a.formatMessage({id:\"neteco.pvms.userDialog.password\"}),name:\"userPass\",children:(0,D.jsx)(he.Z,{type:\"password\",name:\"pwd\",value:n,onChange:this.pwdChange,onCopy:e=>{e.preventDefault()},onCut:e=>{e.preventDefault()}})})}),okText:a.formatMessage({id:\"common.button.ok\"}),centered:!0,onOk:()=>{const{pwdValue:t}=this.state;this.setState({verifyPwdLoading:!0}),this.verifyingPasswords(t).then((t=>{const{success:n,data:r}=t,{number:i}=r;n?e(!0):(i<1&&(pu.href=du.logoutUrl),e(!1))})),this.setState({pwdValue:\"\"})},onCancel:()=>{}})})),resSuccessCallback:()=>{this.setState({verifyPwdLoading:!1}),uu(a,a.formatMessage({id:\"common.message.success\"}))},resFailedCallback:()=>{const{intl:e}=this.props;this.setState({verifyPwdLoading:!1}),cu(e,e.formatMessage({id:\"common.message.failure\"}))}}},c=(e,t)=>(0,D.jsx)(\"div\",{className:\"nco-sts-item\",style:{width:e.width},children:(0,D.jsx)(ou,{title:a.formatMessage({id:e.title}),columns:e.columns,data:e.data,intl:a,order:t})},e.title),u=_t()($c.Z.sts);return o||(u[0].imgUrl=u[0].preImgUrl),(0,D.jsxs)(\"div\",{className:\"nco-sts-wrap\",children:[(0,D.jsxs)(\"div\",{className:\"nco-sts-network\",children:[r&&(0,D.jsx)(\"div\",{className:\"nco-sts-loading\",children:(0,D.jsxs)(\"div\",{className:\"nco-sts-loading-style\",children:[(0,D.jsx)(lu.Z,{style:{fontSize:24}}),(0,D.jsx)(\"div\",{children:a.formatMessage({id:\"neteco.pvms.realtimeinfo.loading\"})})]})}),(0,D.jsx)($l.Z,{...l})]}),(0,D.jsx)(b.Z,{spinning:i,children:(0,D.jsx)(\"div\",{className:\"nco-sts-top\",children:!i&&e.map(((e,n)=>\"neteco.pvms.sts.overview.lVoltageB\"===e.title?\"1\"===t&&c(e,n):c(e,n)))})}),(0,D.jsx)(\"div\",{className:\"nco-sts-bottom\",children:(0,D.jsx)(su,{data:u,intl:a})})]})}}const hu=(0,o.ZP)(fu),mu=e=>(0,O.U2)(\"/rest/pvms/web/device/v1/mo-details\",{dn:e}),{deviceOverview:gu}=on.e,{neteco:vu}=window;class yu extends l.Component{constructor(e){super(e),this.getStatisticsList=e=>{const{deviceDn:t,intl:n}=this.props,r=[{title:n.formatMessage({id:\"neteco.pvms.sts.overview.transformer\"}),data:[]},{title:n.formatMessage({id:\"neteco.pvms.sts.overview.mediumVoltageRoom\"}),data:[]},{title:n.formatMessage({id:\"neteco.pvms.sts.overview.lowVoltageRoom\"}),data:[]},{title:n.formatMessage({id:\"neteco.pvms.more.icon.tip\"}),data:[]}];var i,o;e&&this.setState({spinning:!0}),Promise.all([(i=t,o=Kc.pU,(0,O.U2)(\"/rest/pvms/web/device/v1/deviceExt/get-device-signals\",{dn:i,signalIds:o})),mu(t)]).then((e=>{let[t,n]=e;if(t.success&&n.success&&this._isMounted){this.signalInstance=new nu(t.data),n.data&&this.setState({stsStatus:n.data.mo.status||\"Disconnected\"}),t.data.forEach((e=>{Object.keys(Kc.m6).forEach((t=>{Kc.m6[t].id===e.id&&(Kc.m6[t]={...e})}))})),Kc.m6.specialSignal.value=(0,Jc.vk)(Kc.m6.specialSignal.value,4,\"0\"),Kc.m6.argSignal.value=(0,Jc.vk)(Kc.m6.argSignal.value,32,\"0\"),Kc.m6.argSignal2.value=(0,Jc.vk)(Kc.m6.argSignal2.value,32,\"0\"),t.data.forEach((e=>{if(Kc.A7.includes(e.id)){if(this.validTransformer(Kc.m6.trTempSignal,Kc.m6.maintainFreeSignal,e))return;r[0].data.push(e)}if(Kc.Rp.includes(e.id)){if(this.validMediumVoltage(Kc.m6.argSignal.value,e))return;r[1].data.push(e)}if(Kc.Jq.includes(e.id)){if(!this.signalInstance.showLowVSwitchA()&&e.id===Kc.m6.lowVfaultOfA.id)return;if(!this.signalInstance.showLowVSwitchB()&&e.id===Kc.m6.lowVfaultOfB.id)return;r[2].data.push(e)}if(Kc.bU.includes(e.id)){if(this.validMore(Kc.m6,e))return;r[3].data.push(e)}}));const e=r[1].data.filter((e=>e.id===Kc.My[0]))[0],i=r[1].data.indexOf(e);if(e&&\"0\"===e.value){const e=r[1].data.filter((e=>e.id===Kc.My[1]))[0],t=r[1].data.indexOf(e);t>-1&&r[1].data.splice(t,1)}i>-1&&r[1].data.splice(i,1),this.setState({statistics:r})}})).finally((()=>{e&&this._isMounted&&this.setState({spinning:!1})}))},this.componentDidUpdate=e=>{const{refreshCount:t,subscriptionTime:n}=this.props;t!==e.refreshCount&&this.getStatisticsList(!1),n!==e.subscriptionTime&&(this.realtimeInfoTimer&&clearInterval(this.realtimeInfoTimer),this.realtimeInfoTimer=setInterval((()=>{this.getStatisticsList(!0)}),n*nc.v.monitorStsOverview_getStatisticsList))},this.getStatusStyle=e=>{const{stsStatus:t}=this.state;return\"Connected\"===t?\"0\"===e.value?\"status-point status-up\":\"status-point status-down\":\"status-point status-offLine\"},this.buildDataDom=e=>{const{Panel:t}=Gc.Z,{intl:n}=this.props;return(0,D.jsx)(\"div\",{className:\"sts-right-content\",children:e.length>0&&e.map(((e,r)=>{const i=(0,D.jsx)(\"div\",{className:\"sts-right-card-content\",children:e.data.length>0&&e.data.map(((e,t)=>{e.name=vu?vu.util.iUnescape(vu.util.iUnescape(e.name)):e.name;const n=this.getStatusStyle(e);return e.name&&(0,D.jsxs)(de.Z,{className:\"nco-status\",children:[(0,D.jsx)(pe.Z,{title:e.name,span:3,children:(0,D.jsx)(\"span\",{className:n})}),(0,D.jsx)(pe.Z,{title:e.name,span:21,children:(0,D.jsx)(\"span\",{className:\"name\",children:e.name})})]},t)}))});return e.title===n.formatMessage({id:\"neteco.pvms.more.icon.tip\"})?(0,D.jsx)(\"div\",{className:\"sts-right-card\",children:(0,D.jsx)(Gc.Z,{defaultActiveKey:[\"1\"],expandIconPosition:\"right\",expandIcon:e=>{let{isActive:t}=e;return t?(0,D.jsx)(Yc.Z,{}):(0,D.jsx)(Wc.Z,{})},ghost:!0,children:(0,D.jsx)(t,{header:e.title,children:i})},r)},r):(0,D.jsxs)(\"div\",{className:\"sts-right-card\",children:[(0,D.jsx)(\"div\",{className:\"sts-right-card-title\",children:e.title}),i]},r)}))})},this.buildEmptyDom=e=>(0,D.jsx)(\"div\",{className:\"empty\",children:!e&&(0,D.jsx)(Et.Z,{image:Et.Z.PRESENTED_IMAGE_SIMPLE})}),this.validTransformer=(e,t,n)=>e.value===Kc.QA&&(n.id===Kc.m6.trTempHigh.id||n.id===Kc.m6.trTempHigher.id)||t.value===Kc.QA&&n.id===Kc.m6.maintainFreeHitSignal.id||void 0,this.validMediumVoltage=(e,t)=>{const n=e.split(\"\").reverse();let r=!1;return Kc.KQ.forEach((e=>{n[e.index]===Kc.QA&&t.id===e.sigId&&(r=!0)})),230532063===t.id&&t.value===Kc.QA&&(r=!0),r},this.validMore=(e,t)=>{const{argSignal:n,argSignal2:r,IMDSignal:i,PDCSignal:o,UPSSignal:a,NumberofDTSignal:s,specialSignal:l,midVMSignal:c}=e,u=n.value.split(\"\").reverse(),d=r.value.split(\"\").reverse();return i.value===Kc.QA&&(230530140===t.id||230530141===t.id)||o.value===Kc.QA&&230530155===t.id||a.value===Kc.QA&&(230530178===t.id||230530179===t.id)||u[30]===Kc.QA&&(d[16]===Kc.QA||t.value===Kc.QA)&&230530181===t.id||(d[15]===Kc.QA||\"1\"!==c.value)&&230530211===t.id||d[15]===Kc.QA&&230530211===t.id||!!this.validDTSignal(s,t)||!!this.validSpecialSignal(l,i,t)||void 0},this.validDTSignal=(e,t)=>e.value<1&&(230530156===t.id||230530157===t.id||230530158===t.id)||e.value<2&&(230530159===t.id||230530160===t.id)||e.value<3&&(230530182===t.id||230530183===t.id)||e.value<4&&(230530184===t.id||230530185===t.id)||void 0,this.validSpecialSignal=(e,t,n)=>{const r=e.value.split(\"\").reverse();return r[0]===Kc.QA&&230530164===n.id||r[1]===Kc.QA&&(230530204===n.id||230530206===n.id)||r[2]===Kc.QA&&(230530205===n.id||230530207===n.id)||!(r[0]!==Kc.QA&&t.value!==Kc.QA||230530142!==n.id&&230530143!==n.id)||void 0},this.state={spinning:!1,statistics:[],stsStatus:\"\"},this._isMounted=!1,this.startTime=ic.$.pageAccess(gu.accessId,{pageName:gu.pageName,deviceType:String(e.mocId)})}componentDidMount(){const{subscriptionTime:e}=this.props;this._isMounted=!0,this.getStatisticsList(!0),this.realtimeInfoTimer=setInterval((()=>{this.getStatisticsList(!0)}),e*nc.v.monitorStsOverview_getStatisticsList)}componentWillUnmount(){ic.$.pageLeave(this.startTime,gu.leaveId,{pageName:gu.pageName,deviceType:String(this.props.mocId)}),this._isMounted=!1,this.setState=()=>{},clearInterval(this.realtimeInfoTimer)}render(){const{deviceDn:e,intl:t,mocId:n}=this.props,{statistics:r,spinning:i}=this.state,o=r.length?this.buildDataDom(r):this.buildEmptyDom(i);return(0,D.jsx)(\"div\",{className:\"nco-monitor-sts-overview tab-content\",children:(0,D.jsx)(\"div\",{className:\"content\",children:(0,D.jsxs)(\"div\",{className:\"sts-content\",children:[(0,D.jsx)(\"div\",{className:\"sts-left-content\",children:(0,D.jsx)(hu,{deviceDn:e})}),(0,D.jsxs)(\"div\",{className:\"sts-right-wrapper\",children:[(0,D.jsx)(\"div\",{className:\"sts-right-title\",children:t.formatMessage({id:\"neteco.pvms.sts.overview.deviceStatusOverview\"})}),(0,D.jsx)(b.Z,{spinning:i,children:o})]})]})})})}}const bu=(0,Ba.EN)((0,o.ZP)(yu));var Su=n(6550);const xu=e=>!e&&0!==e||\"N/A\"===e?V.lH:e,wu=e=>e||0===e?(0,rc._v)(e):\"\",Cu=(e,t)=>(0,O.U2)(\"/rest/pvms/web/device/v1/deviceExt/get-device-signals\",{dn:e,signalIds:t});async function Tu(e){return(await Promise.allSettled(e)).map((e=>\"fulfilled\"===e.status?e.value:{}))}const Au=(e,t)=>{const n=(0,Jc.vk)(e,32,\"0\");return n[n.length-1-t]},Eu=async(e,t,n,r,i,o,a)=>{const[s,l,c,u,d]=await Tu([Cu(n,o),Cu(n,\"10049\"),Cu(e,r),Cu(n,i),Cu(t,\"230560026\")]),{data:p}=c,f=l.data[0].value,h=s.data[7].value,m=\"1\"===s.data[8].value&&\"1\"===Au(h,7),g=[{title:a.formatMessage({id:\"neteco.pvms.sts.titp3\"}),value:xu(p[10].value),unit:wu(p[10].unit),isShow:!0},{title:a.formatMessage({id:\"neteco.pvms.sts.titp4\"}),value:xu(p[11].value),unit:wu(p[11].unit),isShow:!0},{title:a.formatMessage({id:\"neteco.pvms.sts.titp5\"}),value:xu(p[12].value),unit:wu(p[12].unit),isShow:!0},{title:a.formatMessage({id:\"neteco.pvms.sts.titp6\"}),value:xu(p[13].value),unit:wu(p[13].unit),isShow:!0},{title:a.formatMessage({id:\"neteco.pvms.sts.titp7\"}),value:xu(p[14].value),unit:wu(p[14].unit),isShow:!0},{title:a.formatMessage({id:\"neteco.pvms.sts.titp8\"}),value:xu(p[15].value),unit:wu(p[15].unit),isShow:!0},{title:a.formatMessage({id:\"neteco.pvms.sts.titp9\"}),value:xu(p[16].value),unit:wu(p[16].unit),isShow:!0},{title:a.formatMessage({id:\"neteco.pvms.sts.titp10\"}),value:xu(p[17].value),unit:wu(p[17].unit),isShow:!0},{title:a.formatMessage({id:\"neteco.pvms.sts.titp11\"}),value:xu(p[18].value),unit:wu(p[18].unit),isShow:!0},{title:a.formatMessage({id:\"neteco.pvms.sts.titp12\"}),value:xu(p[19].value),unit:wu(p[19].unit),isShow:!0},{title:a.formatMessage({id:\"neteco.pvms.sts.titp13\"}),value:xu(p[20].value),unit:wu(p[20].unit),isShow:!0},{title:a.formatMessage({id:\"neteco.pvms.sts.titp14\"}),value:xu(p[21].value),unit:wu(p[21].unit),isShow:!0},{title:a.formatMessage({id:\"neteco.pvms.sts.titp15\"}),value:xu(p[22].value),unit:wu(p[22].unit),isShow:!0},{title:a.formatMessage({id:\"neteco.pvms.sts.titp16\"}),value:xu(p[8].value),unit:wu(p[8].unit),isShow:!0},{title:a.formatMessage({id:\"neteco.pvms.sts.titp17\"}),value:xu(p[9].value),unit:wu(p[9].unit),isShow:!0},{title:a.formatMessage({id:\"neteco.pvms.sts.titp18\"}),value:xu(u.data[0].value),unit:wu(u.data[0].unit),isShow:!0},{title:a.formatMessage({id:\"neteco.pvms.sts.titp19\"}),value:xu(u.data[1].value),unit:wu(u.data[1].unit),isShow:\"0\"===Au(f,5)},{title:a.formatMessage({id:\"neteco.pvms.sts.titp20\"}),value:xu(u.data[2].value),unit:wu(u.data[2].unit),isShow:!0},{title:a.formatMessage({id:\"neteco.pvms.sts.titp21\"}),value:xu(u.data[3].value),unit:wu(u.data[3].unit),isShow:\"0\"===Au(f,5)},{title:a.formatMessage({id:\"neteco.pvms.sts.titp22\"}),value:xu(u.data[4].value),unit:wu(u.data[4].unit),isShow:e===t?\"1\"===s.data[5].value&&\"0\"===Au(h,7)||m:\"1\"===s.data[9].value&&\"0\"===Au(h,7)||m},{title:a.formatMessage({id:\"neteco.pvms.sts.titp23\"}),value:xu(d.data[0].value),unit:wu(d.data[0].unit),isShow:!0},{title:a.formatMessage({id:\"neteco.pvms.sts.titp24\"}),value:xu(p[0].value),unit:wu(p[0].unit),isShow:\"1\"===s.data[6].value},{title:a.formatMessage({id:\"neteco.pvms.sts.titp25\"}),value:xu(p[1].value),unit:wu(p[1].unit),isShow:\"1\"===s.data[6].value},{title:a.formatMessage({id:\"neteco.pvms.sts.titp26\"}),value:xu(p[2].value),unit:wu(p[2].unit),isShow:\"1\"===s.data[6].value},{title:a.formatMessage({id:\"neteco.pvms.sts.titp27\"}),value:xu(p[3].value),unit:wu(p[3].unit),isShow:\"1\"===s.data[6].value},{title:a.formatMessage({id:\"neteco.pvms.sts.titp28\"}),value:xu(p[4].value),unit:wu(p[4].unit),isShow:\"1\"===s.data[6].value},{title:a.formatMessage({id:\"neteco.pvms.sts.titp29\"}),value:xu(p[5].value),unit:wu(p[5].unit),isShow:\"1\"===s.data[6].value},{title:a.formatMessage({id:\"neteco.pvms.sts.titp30\"}),value:xu(p[6].value),unit:wu(p[6].unit),isShow:\"1\"===s.data[6].value},{title:a.formatMessage({id:\"neteco.pvms.sts.titp31\"}),value:xu(p[7].value),unit:wu(p[7].unit),isShow:\"1\"===s.data[6].value}].filter((e=>e.isShow));return Ou(10,{data:p[0]?g:[],success:!0})},Ou=(e,t)=>new Promise((n=>setTimeout(n,e,t))),{pageName:Mu,accessId:Pu,leaveId:Du}=on.e.deviceDetail,Iu=[230532062,20005,230530025,230532058,230532059,230532055,230532066,230530026,230532226,230532056,230532067,230532068].join(\",\"),Nu=[230532150,10001,50009,50010,50012,50020,10105,230530002,230532215,230532217,230532219,230532221].join(\",\"),_u=[230560050,230560051,230560052,230560053,230560054,230560055,230560056,230560057,230560027,230560028,23056e4,230560001,230560002,230560003,230560004,230560005,230560006,230560007,230560008,230560009,230560010,230560011,230560012].join(\",\"),ju=[230530400,230530401,230530402,230530403,230530404].join(\",\"),ku=[230560050,230560051,230560052,230560053,230560054,230560055,230560056,230560057,230560027,230560028,23056e4,230560001,230560002,230560003,230560004,230560005,230560006,230560007,230560008,230560009,230560010,230560011,230560012].join(\",\"),Lu=[230530405,230530406,230530407,230530408,230530409].join(\",\"),Ru=[230530300,230530301,230530302,230530303,230530304,230530305,230530306,230530307,230530308,230530313,230530309,230530310,230530311,230530312].join(\",\"),Zu=[10002,10003,10004,10005,10006,10007,10008,10009,10010,10001,10012,10011,230570001].join(\",\"),Bu=[230570060,230570061,230570062,230570063,230570064,230570065].join(\",\"),Fu=[230530410,230530411,10012,10013].join(\",\");class zu extends l.Component{constructor(e){super(e),this.getLowVoltageList=e=>{const{deviceDn:t,intl:n}=this.props;e&&this.setState({lowVoltageSpinning:!0}),t&&(0,O.U2)(\"/rest/neteco/web/config/device/v1/children-list\",{\"conditionParams.parentDn\":t}).then((r=>{let i,o,a;r.data&&r.data.forEach((e=>{\"TR-1\"===e.name&&(i=e.dn),\"LV-1\"===e.name&&(o=e.dn),\"LV-2\"===e.name&&(a=e.dn)})),Eu(o,o,t,_u,ju,Iu,n).then((e=>{e.success&&this._isMounted&&this.setState({lowVoltageA:e.data}),Eu(a,o,t,ku,Lu,Iu,n).then((e=>{e.success&&this._isMounted&&this.setState({lowVoltageB:e.data})}))})).finally((()=>{e&&this._isMounted&&this.setState({lowVoltageSpinning:!1})}))}))},this.getTransformerList=e=>{const{deviceDn:t,intl:n}=this.props;e&&this.setState({transformerSpinning:!0}),t&&(async(e,t,n,r)=>{const[i,o]=await Tu([(0,O.U2)(\"/rest/neteco/web/config/device/v1/children-list\",{\"conditionParams.parentDn\":e}),Cu(e,n)]);let a,s,l;i.data&&i.data.forEach((e=>{\"TR-1\"===e.name&&(a=e.dn),\"LV-1\"===e.name&&(s=e.dn),\"LV-2\"===e.name&&(l=e.dn)}));const c=(0,Jc.vk)(o.data[2].value,32,\"0\"),u=await Cu(a,t),{data:d}=u,p=[{type:r.formatMessage({id:\"neteco.pvms.sts.titp32\"}),data:[{title:r.formatMessage({id:\"neteco.pvms.sts.titp34\"}),value:xu(d[11].value),unit:wu(d[11].unit),isShow:!0},{title:r.formatMessage({id:\"neteco.pvms.sts.titp35\"}),value:xu(d[12].value),unit:wu(d[12].unit),isShow:\"1\"===o.data[0].value},{title:r.formatMessage({id:\"neteco.pvms.sts.titp36\"}),value:xu(d[10].value),unit:wu(d[10].unit),isShow:\"1\"===o.data[1].value}].filter((e=>e.isShow))},{type:r.formatMessage({id:\"neteco.pvms.sts.titp33\"}),data:[{title:r.formatMessage({id:\"neteco.pvms.sts.titp3\"}),value:xu(d[0].value),unit:wu(d[0].unit),isShow:\"1\"===c.slice(-13,-12)},{title:r.formatMessage({id:\"neteco.pvms.sts.titp4\"}),value:xu(d[1].value),unit:wu(d[1].unit),isShow:\"1\"===c.slice(-14,-13)},{title:r.formatMessage({id:\"neteco.pvms.sts.titp5\"}),value:xu(d[2].value),unit:wu(d[2].unit),isShow:\"1\"===c.slice(-15,-14)},{title:r.formatMessage({id:\"neteco.pvms.sts.titp6\"}),value:xu(d[3].value),unit:wu(d[3].unit),isShow:\"1\"===c.slice(-16,-15)},{title:r.formatMessage({id:\"neteco.pvms.sts.titp7\"}),value:xu(d[4].value),unit:wu(d[4].unit),isShow:\"1\"===c.slice(-17,-16)},{title:r.formatMessage({id:\"neteco.pvms.sts.titp8\"}),value:xu(d[5].value),unit:wu(d[5].unit),isShow:\"1\"===c.slice(-18,-17)},{title:r.formatMessage({id:\"neteco.pvms.sts.titp9\"}),value:xu(d[6].value),unit:wu(d[6].unit),isShow:\"1\"===c.slice(-19,-18)},{title:r.formatMessage({id:\"neteco.pvms.sts.titp10\"}),value:xu(d[7].value),unit:wu(d[7].unit),isShow:\"1\"===c.slice(-20,-19)},{title:r.formatMessage({id:\"neteco.pvms.sts.titp11\"}),value:xu(d[8].value),unit:wu(d[8].unit),isShow:\"1\"===c.slice(-21,-20)},{title:r.formatMessage({id:\"neteco.pvms.sts.titp37\"}),value:xu(d[9].value),unit:wu(d[9].unit),isShow:\"1\"===c.slice(-22,-21)}].filter((e=>e.isShow))}];return Ou(200,{data:p,success:!0})})(t,Zu,Iu,n).then((e=>{e.success&&this._isMounted&&this.setState({transformer:e.data})})).finally((()=>{e&&this._isMounted&&this.setState({transformerSpinning:!1})}))},this.getMediumPressureList=e=>{const{deviceDn:t,intl:n}=this.props;e&&this.setState({mediumPressureSpinning:!0}),t&&(async(e,t,n,r,i)=>{const[o,a,s]=await Promise.all([(0,O.U2)(\"/rest/neteco/web/config/device/v1/children-list\",{\"conditionParams.parentDn\":e}),Cu(e,r),Cu(e,n)]);let l,c,u;o.data&&o.data.forEach((e=>{\"TR-1\"===e.name&&(l=e.dn),\"LV-1\"===e.name&&(c=e.dn),\"LV-2\"===e.name&&(u=e.dn)}));const d=(0,Jc.vk)(a.data[2].value,32,\"0\"),p=await Cu(l,t),f=[{data:[{title:i.formatMessage({id:\"neteco.pvms.sts.titp39\"}),value:xu(s.data[2].value),unit:wu(s.data[2].unit),isShow:!0},{title:i.formatMessage({id:\"neteco.pvms.sts.titp40\"}),value:xu(s.data[3].value),unit:wu(s.data[3].unit),isShow:!0},{title:i.formatMessage({id:\"neteco.pvms.sts.titp41\"}),value:xu(s.data[0].value),unit:wu(s.data[0].unit),isShow:\"1\"===a.data[3].value},{title:i.formatMessage({id:\"neteco.pvms.sts.titp42\"}),value:xu(s.data[1].value),unit:wu(s.data[1].unit),isShow:\"1\"===a.data[3].value},{title:i.formatMessage({id:\"neteco.pvms.sts.titp43\"}),value:xu(p.data[0].value),unit:wu(p.data[0].unit),isShow:\"1\"===d.slice(-23,-22)},{title:i.formatMessage({id:\"neteco.pvms.sts.titp44\"}),value:xu(p.data[1].value),unit:wu(p.data[1].unit),isShow:\"1\"===d.slice(-24,-23)},{title:i.formatMessage({id:\"neteco.pvms.sts.titp45\"}),value:xu(p.data[2].value),unit:wu(p.data[2].unit),isShow:\"1\"===d.slice(-25,-24)},{title:i.formatMessage({id:\"neteco.pvms.sts.titp46\"}),value:xu(p.data[3].value),unit:wu(p.data[3].unit),isShow:\"1\"===d.slice(-26,-25)},{title:i.formatMessage({id:\"neteco.pvms.sts.titp47\"}),value:xu(p.data[4].value),unit:wu(p.data[4].unit),isShow:\"1\"===d.slice(-27,-26)},{title:i.formatMessage({id:\"neteco.pvms.sts.titp48\"}),value:xu(p.data[5].value),unit:wu(p.data[5].unit),isShow:\"1\"===d.slice(-28,-27)}].filter((e=>e.isShow))}];return Ou(400,{data:f,success:!0})})(t,Bu,Fu,Iu,n).then((e=>{e.success&&this._isMounted&&this.setState({mediumPressure:e.data})})).finally((()=>{e&&this._isMounted&&this.setState({mediumPressureSpinning:!1})}))},this.getAuxiliaryList=e=>{const{deviceDn:t,intl:n}=this.props;e&&this.setState({auxiliarySpinning:!0}),t&&(async(e,t,n,r)=>{const[i,o]=await Promise.all([Cu(e,n),Cu(e,t)]),{data:a}=o,s=\"1\"===i.data[10].value||i.data[11].value>\"0\",l=e=>r.formatMessage({id:\"neteco.pvms.sts.auxiliaryI\"},{1:e}),c=\"1\"===i.data[4].value,u=[{data:[{title:r.formatMessage({id:\"neteco.pvms.sts.titp75\"}),value:xu(a[0].value),unit:wu(a[0].unit),isShow:\"0\"===i.data[4].value},{title:c?r.formatMessage({id:\"neteco.pvms.sts.titp3\"}):l(\"I1\"),value:xu(a[0].value),unit:wu(a[0].unit),isShow:s&&\"0\"!==i.data[4].value},{title:c?r.formatMessage({id:\"neteco.pvms.sts.titp4\"}):l(\"I2\"),value:xu(a[1].value),unit:wu(a[1].unit),isShow:s},{title:r.formatMessage({id:\"neteco.pvms.sts.titp5\"}),value:xu(a[2].value),unit:wu(a[2].unit),isShow:c&&s},{title:r.formatMessage({id:\"neteco.pvms.sts.titp74\"}),value:xu(a[3].value),unit:wu(a[3].unit),isShow:s},{title:r.formatMessage({id:\"neteco.pvms.sts.titp53\"}),value:xu(a[3].value),unit:wu(a[3].unit),isShow:\"1\"===i.data[4].value},{title:r.formatMessage({id:\"neteco.pvms.sts.titp54\"}),value:xu(a[4].value),unit:wu(a[4].unit),isShow:\"1\"===i.data[4].value},{title:r.formatMessage({id:\"neteco.pvms.sts.titp55\"}),value:xu(a[5].value),unit:wu(a[5].unit),isShow:\"1\"===i.data[4].value},{title:r.formatMessage({id:\"neteco.pvms.sts.titp9\"}),value:xu(a[6].value),unit:wu(a[6].unit),isShow:!0},{title:r.formatMessage({id:\"neteco.pvms.sts.titp10\"}),value:xu(a[7].value),unit:wu(a[7].unit),isShow:s},{title:r.formatMessage({id:\"neteco.pvms.sts.titp11\"}),value:xu(a[8].value),unit:wu(a[8].unit),isShow:s},{title:r.formatMessage({id:\"neteco.pvms.sts.titp12\"}),value:xu(a[10].value),unit:wu(a[10].unit),isShow:s},{title:r.formatMessage({id:\"neteco.pvms.sts.titp13\"}),value:xu(a[11].value),unit:wu(a[11].unit),isShow:s},{title:r.formatMessage({id:\"neteco.pvms.sts.titp14\"}),value:xu(a[12].value),unit:wu(a[12].unit),isShow:s},{title:r.formatMessage({id:\"neteco.pvms.sts.titp15\"}),value:xu(a[13].value),unit:wu(a[13].unit),isShow:s},{title:r.formatMessage({id:\"neteco.pvms.sts.titp23\"}),value:xu(a[9].value),unit:wu(a[9].unit),isShow:!0}].filter((e=>e.isShow))}];return Ou(600,{data:a[0]?u:[],success:!0})})(t,Ru,Iu,n).then((e=>{e.success&&this._isMounted&&this.setState({auxiliary:e.data})})).finally((()=>{e&&this._isMounted&&this.setState({auxiliarySpinning:!1})}))},this.getBaseInfoList=e=>{const{deviceDn:t,intl:n}=this.props;e&&this.setState({baseInfoSpinning:!0}),t&&(async(e,t,n)=>{const r=await(0,O.U2)(\"/rest/pvms/web/business/v1/device/basic-info\",{deviceDn:e,signalIds:t}),{data:i}=r,o=[{name:n.formatMessage({id:\"neteco.pvms.sts.titp65\"}),value:xu(i[12].value)},{name:n.formatMessage({id:\"neteco.pvms.sts.titp66\"}),value:xu(i[1].value)},{name:n.formatMessage({id:\"neteco.pvms.sts.titp67\"}),value:xu(i[2].value)},{name:n.formatMessage({id:\"neteco.pvms.sts.titp69\"}),value:xu(i[4].value)},{name:n.formatMessage({id:\"neteco.pvms.sts.titp70\"}),value:xu(i[5].value)},{name:n.formatMessage({id:\"neteco.pvms.sts.titp72\"}),value:xu(i[3].value)},{name:n.formatMessage({id:\"neteco.pvms.sts.titp73\"}),value:xu(i[6].value)},{name:n.formatMessage({id:\"neteco.pvms.ratedCapacity\"}),value:(0,kt.af)(xu(i[7].value)),unit:\"kVA\"},{name:i[8].name,value:xu(i[8].value)},{name:i[9].name,value:xu(i[9].value)},{name:i[10].name,value:xu(i[10].value)},{name:i[11].name,value:xu(i[11].value)}];return Ou(800,{data:o,success:!0})})(t,Nu,n).then((e=>{e.success&&this._isMounted&&this.setState({baseInfo:e.data})})).finally((()=>{e&&this._isMounted&&this.setState({baseInfoSpinning:!1})}))},this.buildLowVoltageDom=e=>(0,D.jsx)(\"div\",{className:\"sts-details-card-content\",children:e.length>0&&e.map(((e,t)=>(0,D.jsx)(\"div\",{className:\"nco-sts-details-card-col\",title:`${e.title}${(0,kt.af)(e.value)}${e.unit||\"\"}`,children:(0,D.jsx)(\"div\",{className:\"nco-counter-value\",children:(0,D.jsxs)(\"div\",{className:\"counter-value-main\",children:[(0,D.jsxs)(\"div\",{className:\"counter-value-main-value\",children:[(0,D.jsx)(\"div\",{className:\"value\",children:(0,kt.af)(e.value)}),(0,D.jsx)(\"div\",{className:\"unit\",children:e.unit})]}),(0,D.jsx)(\"div\",{className:\"counter-value-main-title\",children:e.title})]})})},t)))}),this.buildTransformerDom=e=>(0,D.jsx)(\"div\",{children:e.length>0&&e.map(((e,t)=>(0,D.jsxs)(\"div\",{children:[e.type&&(0,D.jsx)(\"div\",{className:\"sts-details-card-subtitle\",children:e.type}),this.buildLowVoltageDom(e.data)]},t)))}),this.buildBaseInfoDom=e=>(0,D.jsx)(\"div\",{className:\"sts-details-baseInfo-content\",children:e.length>0&&(0,D.jsx)(Jl.Z,{data:e,columns:3,type:\"base\",valueBottom:!0,isBasicInfo:!0})}),this.buildEmptyDom=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:\"\";return(0,D.jsx)(\"div\",{className:`empty ${t}`,children:!e&&(0,D.jsx)(Et.Z,{image:Et.Z.PRESENTED_IMAGE_SIMPLE})})},this.getMainInfoArray=(e,t,n,r,i)=>{const{lowVoltageSpinning:o,transformerSpinning:a,mediumPressureSpinning:s,auxiliarySpinning:l,isShowVoltageB:c}=this.state;return[{title:\"neteco.pvms.sts.overview.lVoltageA\",img:Su.uo,spinning:o,dom:e,id:\"lVoltageA\",isShow:!0},{title:\"neteco.pvms.sts.overview.lVoltageB\",img:Su.uo,spinning:o,dom:t,id:\"lVoltageB\",isShow:c},{title:\"neteco.pvms.sts.titp76\",img:Su.Kv,spinning:a,dom:n,id:\"titp76\",isShow:!0},{title:\"neteco.pvms.sts.titp38\",img:Su.d4,spinning:s,dom:r,id:\"titp38\",isShow:!0},{title:\"neteco.pvms.sts.titp49\",img:Su.p6,spinning:l,dom:i,id:\"titp49\",isShow:!0}]},this.renderMainInfo=()=>{const{lowVoltageA:e,lowVoltageB:t,lowVoltageSpinning:n,transformer:r,transformerSpinning:i,mediumPressure:o,mediumPressureSpinning:a,auxiliary:s,auxiliarySpinning:l}=this.state,c=e.length?this.buildLowVoltageDom(e):this.buildEmptyDom(n,\"lVoltageA\"),u=t.length?this.buildLowVoltageDom(t):this.buildEmptyDom(n,\"lVoltageB\"),d=r.length?this.buildTransformerDom(r):this.buildEmptyDom(i,\"titp76\"),p=o.length?this.buildTransformerDom(o):this.buildEmptyDom(a,\"titp38\"),f=s.length?this.buildTransformerDom(s):this.buildEmptyDom(l,\"titp49\"),h=this.getMainInfoArray(c,u,d,p,f),{intl:m}=this.props;return h.map(((e,t)=>e.isShow&&(0,D.jsxs)(\"div\",{className:\"sts-details-card\",children:[(0,D.jsx)(\"div\",{className:\"sts-details-card-title\",children:m.formatMessage({id:e.title})}),(0,D.jsxs)(\"div\",{className:\"sts-details-card-wrapper \"+(e.spinning?`${e.id}-loading-height`:\"\"),children:[(0,D.jsx)(\"div\",{className:\"sts-details-card-img\",children:e.img}),(0,D.jsx)(b.Z,{spinning:e.spinning,children:e.dom})]})]},t)))},this.language=(0,ut.ej)(\"locale\")||\"en-us\",this.state={lowVoltageSpinning:!1,lowVoltageA:[],lowVoltageB:[],transformerSpinning:!1,transformer:[],mediumPressureSpinning:!1,mediumPressure:[],auxiliarySpinning:!1,auxiliary:[],baseInfoSpinning:!1,baseInfo:[]},this._isMounted=!1,this.startTime=ic.$.pageAccess(Pu,{pageName:Mu,deviceType:String(e.mocId)})}componentDidMount(){const{deviceDn:e}=this.props;this._isMounted=!0,this.getBaseInfoList(!0),this.getLowVoltageList(!0),this.getTransformerList(!0),this.getMediumPressureList(!0),this.getAuxiliaryList(!0),(e=>(0,O.U2)(\"/rest/pvms/web/device/v1/deviceExt/is-double-split-sts\",{stsDn:e}))(e).then((e=>{this.setState({isShowVoltageB:e.data})}))}componentWillUnmount(){ic.$.pageLeave(this.startTime,Du,{pageName:Mu,deviceType:String(this.props.mocId)}),this._isMounted=!1,this.setState=()=>{}}render(){const{baseInfo:e,baseInfoSpinning:t}=this.state,{intl:n}=this.props,r=(this.language,e.length?this.buildBaseInfoDom(e):this.buildEmptyDom(t));return(0,D.jsx)(\"div\",{className:\"nco-monitor-sts-details tab-content\",children:(0,D.jsx)(\"div\",{className:\"content\",children:(0,D.jsxs)(\"div\",{className:\"sts-content\",children:[(0,D.jsxs)(\"div\",{className:\"sts-details-mainInfo\",children:[(0,D.jsx)(\"div\",{className:\"setting-btns-wrapper\",children:(0,D.jsx)(tc.Z,{...this.props})}),void 0!==this.state.isShowVoltageB&&this.renderMainInfo()]}),(0,D.jsxs)(\"div\",{className:\"sts-details-baseInfo\",children:[(0,D.jsx)(\"div\",{className:\"sts-details-baseInfo-title\",children:n.formatMessage({id:\"neteco.pvms.partials.main.io.dispersion_iv.basicInfo\"})}),(0,D.jsx)(b.Z,{spinning:t,children:r})]})]})})})}}const Vu=(0,Ba.EN)((0,o.ZP)(zu));var Hu=n(21148);const{Paragraph:Uu}=Hu.Z,{operationConfirm:Gu,operationInfo:Yu,operationFailed:Wu}=Ql.Z,{neteco:Ku}=window,qu=new Map([[\"33595393\",\"ncoInverterTable.column.device\"],[\"10002\",\"neteco.pvms.pointTable.modelCode\"],[\"33595396\",\"neteco.pvms.devUpgrade.devType\"],[\"33595395\",\"ncoHomeSiteList.columns.siteName\"],[\"50012\",\"neteco.pvms.DCChild.esnCode\"],[\"50020\",\"neteco.pvms.partials.main.dm.detailInfo.devInfo.devChangeHistory\"],[\"21022\",\"neteco.pvms.map.stationInfoWin.stationAddress\"],[\"50010\",\"ncoPvTable.column.softwareVersion\"],[\"10105\",\"neteco.pvms.device.upgrade.packageName\"]]);class Qu extends l.Component{constructor(e){var t;super(e),t=this,this.getStationTcueRealTimeDeviceData=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&t.setState({realTimeDeviceLoading:!0});const{tcueDn:e}=t.state;(0,ec.x4)({deviceDn:e,signalIds:\"10007,10008,10009\"}).then((e=>{if(e.success){const{data:n=[]}=e;t.setState({realTimeDeviceData:n})}})).finally((()=>{t.setState({realTimeDeviceLoading:!1})}))},this.getStationTcueBaseDeviceData=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&t.setState({baseDeviceLoading:!0});const{tcueDn:e}=t.state;(0,ec.nP)({deviceDn:e,signalIds:\"50020,50010,50012,10002,10105\"}).then((e=>{if(e.success){const{data:n=[]}=e;t.setState({baseDeviceData:t.convertBasicData(n)})}})).finally((()=>{t.setState({baseDeviceLoading:!1})}))},this.convertBasicData=e=>{const{intl:t}=this.props,n=new Map;for(const t of e)n.set(String(t.id),t.realValue||t.value||\"-\");const r=[];for(const[e,i]of qu)r.push({name:t.formatMessage({id:i}),value:n.get(e)});return r},this.resetClick=()=>{const{intl:e}=this.props,{tcueDn:t}=this.state;return Gu(e,e.formatMessage({id:\"neteco.pvms.configuration.trans.modal.tips\"}),(async()=>{this.setState({resetLoading:!0});const n=await(0,ec.uY)(t),{code:r,data:i}=n;if(0===Number(r)&&0===i[0].code)Yu(e,e.formatMessage({id:\"neteco.pvms.storageBox.resetsuccess\"}));else if(1020===r)Wu(e,e.formatMessage({id:\"neteco.pvms.device.management.not_exists\"}));else{var o;Wu(e,e.formatMessage({id:Object.values(null===(o=i[0].data)||void 0===o?void 0:o.data)[0]}))}this.setState({resetLoading:!1})}))};const{props:{selectedTreeNode:{elementDn:n}}}=e;this.state={realTimeDeviceData:[],connectState:!1,baseDeviceData:[],realTimeDeviceLoading:!1,baseDeviceLoading:!1,resetLoading:!1,tcueDn:n,deviceMoStatus:\"\",isInSharedStation:!1}}componentDidMount(){this.getStationTcueRealTimeDeviceData(!0),this.getStationTcueBaseDeviceData(!0);const{tcueDn:e}=this.state;(0,ec.ph)(e).then((e=>{const{success:t,data:n}=e;t&&this.setState({connectState:n})})).catch((()=>{})),this.subArrayTimer=setInterval((()=>{this.getStationTcueRealTimeDeviceData()}),nc.v.monitorTcuDetail_getRealTime),e&&(0,R.PW)(e).then((e=>{const{success:t,data:n}=e;t&&this.setState({isInSharedStation:n})}))}componentWillUnmount(){clearInterval(this.subArrayTimer),this.setState=()=>{}}render(){const{intl:e,props:{selectedTreeNode:{nodeName:t},selectedTreeNode:n}}=this.props,{tcueDn:r,realTimeDeviceLoading:i,baseDeviceLoading:o,realTimeDeviceData:a,baseDeviceData:s,deviceMoStatus:l,connectState:c,resetLoading:u,isInSharedStation:d}=this.state,p={dataLoaderClass:Xl.Z,apiParams:{status:l||\"\",type:\"tcue\"}};return(0,D.jsx)(\"div\",{className:\"nco-monitor-tcue-detail tab-content\",children:(0,D.jsx)(\"div\",{className:\"content\",children:(0,D.jsxs)(\"div\",{className:\"tcue-content\",children:[(0,D.jsxs)(\"div\",{className:\"top-content\",children:[(0,D.jsx)(\"div\",{className:\"top-content-title\",title:Ku.util.iUnescape(t),children:(0,D.jsx)(Uu,{ellipsis:{rows:1},children:Ku.util.iUnescape(t)})}),!d&&(0,D.jsx)(\"div\",{className:\"top-content-buttons\",children:(0,D.jsx)(oe.Z,{onClick:this.resetClick,disabled:!c,loading:u,children:(0,D.jsx)(gn.Z,{id:\"neteco.pvms.dataCollector.dataCollector_remoteReset\"})},\"reset\")})]}),(0,D.jsxs)(\"div\",{className:\"bottom-content\",children:[(0,D.jsx)(\"div\",{className:\"bottom-content-left\",children:(0,D.jsx)($l.Z,{...p})}),(0,D.jsxs)(\"div\",{className:\"bottom-content-right\",children:[a.length>0&&(0,D.jsx)(\"div\",{className:\"tcue-details-info\",children:(0,D.jsx)(Jl.Z,{title:e.formatMessage({id:\"neteco.pvms.partials.main.dm.detailInfo.curInfo.realData\"})||\" \",data:a,columns:5})}),s.length>0&&(0,D.jsx)(\"div\",{className:\"basic-info\",children:(0,D.jsx)(Jl.Z,{title:e.formatMessage({id:\"neteco.pvms.devEport.basicInfo\"})||\" \",data:s,columns:3,type:\"base\",sBasicInfo:!0})})]})]})]})})})}}const Xu=(0,o.ZP)(Qu);var Ju=n(68660),$u=n(97809),ed=n(14044);const{twaver:td,_twaver:nd}=window;class rd extends td.Node{constructor(){super(...arguments),this._currentStatus=null,this._statusMap={}}changeNodeBy(e){Object.keys(this._statusMap).length||this.setStatusMap(),this._currentStatus=e,this.c(\"status\",this._statusMap[e])}setStatusMap(){const e=this.getImage(),t=ed.Z[e];e&&t&&(this._statusMap=t)}getStatusMap(){return this._statusMap}getVectorUIClass(){return id}}class id extends td.vector.NodeUI{paintBody(e){const t=this.getElement(),n=this.getZoomBodyRect();if(t.c(\"light\")){const r=nd.getImageAsset(t.getImage());if(t.getImage()&&r){const t=(0,Jc.Vl)(r.getImage());e.drawImage(t,n.x,n.y,n.width,n.height),e.save(),e.globalCompositeOperation=\"source-atop\",e.fillStyle=\"rgba(236,109,113,0.3)\",e.fillRect(n.x,n.y,n.width,n.height),e.restore()}}else super.paintBody(e)}}const{twaver:od}=window;class ad extends Xc.Z{constructor(e,t,n){super(e,t,n),this._box=e.getElementBox(),this._network=e,this._apiParams=n}load(){this.registerImage(),this.layout();const e=this.relayout.bind(this);window.addEventListener(\"resize\",e)}layout(){const e=this._network.viewRect.width,t=this._network.viewRect.height;this.removeSelection();const n=new rd;n.setImage(\"leftView_input\"),n.setSize(96,96),n.setLocation(e/2-n.getWidth()/2,32),this._box.add(n);const r=new rd;r.setImage(\"leftView_mppt\"),r.setSize(96,96),r.setLocation(e/2-r.getWidth()/2,3*t/7-r.getHeight()/2),this._box.add(r);const i=new rd;i.setSize(0,0),i.setLocation(e/2-i.getWidth()/2,t-i.getHeight()-32),this._box.add(i);const o=new od.Link(n,r);o.s(\"link.color\",\"#939393\").s(\"link.width\",1),o.s(\"link.from.yoffset\",n.getHeight()/2+0),o.s(\"link.to.yoffset\",-(r.getHeight()/2+0)),this._box.add(o);const a=new od.Link(r,i);a.s(\"link.color\",\"#939393\").s(\"link.width\",1),a.s(\"link.from.yoffset\",r.getHeight()/2+0),a.s(\"link.to.yoffset\",-(i.getHeight()/2+0)),this._box.add(a)}relayout(){this._box.clear(),this.layout()}removeSelection(){this._network.getSelectionModel().setFilterFunction((()=>!1))}registerImage(){(0,Jc.Q)(\"leftView_input\",$c.Z.input,this._network),(0,Jc.Q)(\"leftView_mppt\",$c.Z.mppt,this._network),(0,Jc.Q)(\"leftView_output\",$c.Z.output,this._network)}}var sd=n(27540);const{neteco:ld}=window;class cd extends l.Component{constructor(e){super(e),this.getRealName=e=>{const{intl:t}=this.props;return 33595395===e.id?t.formatMessage({id:\"neteco.pvms.sm.psm.sname\"}):33595396===e.id?t.formatMessage({id:\"neteco.pvms.upgrade.heads.devTypeId\"}):33595393===e.id?t.formatMessage({id:\"neteco.pvms.partials.main.rm.dayCapPrpfit.data.dName\"}):21022===e.id?t.formatMessage({id:\"neteco.pvms.pcs.station.detail.address\"}):e.name||\"\"},this.groupList=(e,t)=>{const n=[];for(let r=0,i=e.length;r<i;r+=t)n.push(e.slice(r,r+t));return n},this.getOutputList=e=>{const{deviceDn:t}=this.props;e&&this.setState({outputSpinning:!0}),(e=>(0,O.U2)(\"/rest/pvms/web/business/v1/mppt/mppt-sync-info\",{deviceDn:e}))(t).then((e=>{if(e.success&&this._isMounted){const s=[],l=e.data.input;for(const e in l){var t,n,r,i,o,a;Object.prototype.hasOwnProperty.call(l,e)&&s.push({name:e,voltage:null===(t=l[e])||void 0===t||null===(n=t.voltage)||void 0===n?void 0:n.value,current:null===(r=l[e])||void 0===r||null===(i=r.current)||void 0===i?void 0:i.value,pvAccess:null===(o=l[e])||void 0===o||null===(a=o.status.value)||void 0===a?void 0:a.toString()})}s.sort(((e,t)=>e.name.slice(2)-t.name.slice(2))),this.setState({dataSource:this.groupList(s,16),outputList:e.data.output,mpptList:e.data.running})}})).finally((()=>{e&&this._isMounted&&this.setState({outputSpinning:!1,mpptSpinning:!1})}))},this.getBaseList=e=>{const{deviceDn:t}=this.props;e&&this.setState({baseSpinning:!0}),(e=>(0,O.U2)(\"/rest/pvms/web/business/v1/mppt/mppt-basic-info\",{deviceDn:e}))(t).then((e=>{e.success&&this._isMounted&&this.setState({baseList:e.data})})).finally((()=>{e&&this._isMounted&&this.setState({baseSpinning:!1})}))},this.buildMpptOrOutputDom=e=>{const{deviceStatus:t}=this.state;return(0,D.jsx)(\"div\",{className:\"mppt-details-card-content bottom-border\",children:e.length>0&&e.map(((e,n)=>(0,D.jsx)(\"div\",{className:\"nco-mppt-details-card-col\",title:`${e.name}${e.value}${e.unit||\"\"}`,children:(0,D.jsxs)(\"div\",{className:\"mppt-status\",children:[10025===e.id&&(0,D.jsx)($u.Z,{deviceStatus:t,form:\"pcs\"}),(0,D.jsx)(Ju.Z,{title:e.name,value:\"-\"!==e.realValue&&ld.util.iUnescape(e.realValue)||e.value&&ld.util.iUnescape(e.value)||\"-\",unit:e.unit})]})},n)))})},this.buildBaseDom=e=>{const{intl:t}=this.props;return(0,D.jsx)(\"div\",{className:\"mppt-details-baseInfo-content\",children:e.length>0&&e.map(((e,t)=>(0,D.jsx)(pe.Z,{className:\"nco-mppt-details-baseInfo-col\",span:8,title:`${this.getRealName(e)}${e.value}`,children:(0,D.jsx)(Ju.Z,{title:e.value,value:this.getRealName(e)})},t)))})},this.buildEmptyDom=e=>(0,D.jsx)(\"div\",{className:\"empty\",children:!e&&(0,D.jsx)(Et.Z,{image:Et.Z.PRESENTED_IMAGE_SIMPLE})}),this.state={dataSource:[],mpptSpinning:!1,mpptList:[],outputSpinning:!1,outputList:[],baseSpinning:!1,baseList:[],deviceStatus:void 0},this._isMounted=!1}async componentDidMount(){const{selectedTreeNode:{elementId:e}}=this.props;this._isMounted=!0,this.getOutputList(!0),this.getBaseList(!0),this.runingTimer=setInterval((()=>{this.getOutputList(!1)}),nc.v.monitorStationMpptDetails_getOutputList);const t=await(0,ec.uT)([e]);null==t||t.forEach((t=>{t.dnId===Number(e)&&this.setState({deviceStatus:t.deviceStatus})}))}componentWillUnmount(){this._isMounted=!1,clearInterval(this.runingTimer),this.setState=()=>{}}render(){const e={apiParams:{status:\"Connected\"},dataLoaderClass:ad},{dataSource:t,mpptSpinning:n,mpptList:r,outputSpinning:i,outputList:o,baseSpinning:a,baseList:s}=this.state,{intl:l,nodeName:c}=this.props,u=[{title:\"neteco.pvms.monitor.mppt.details.label.mppt\",spinning:n,dom:r.length?this.buildMpptOrOutputDom(r):this.buildEmptyDom(n)},{title:\"neteco.pvms.monitor.mppt.details.label.outputSide\",spinning:i,dom:o.length?this.buildMpptOrOutputDom(o):this.buildEmptyDom(i)},{title:\"neteco.pvms.devEport.basicInfo\",spinning:a,dom:s.length?this.buildBaseDom(s):this.buildEmptyDom(a)}];return(0,D.jsx)(\"div\",{className:\"nco-monitor-mppt-details tab-content\",children:(0,D.jsx)(\"div\",{className:\"content\",children:(0,D.jsxs)(\"div\",{className:\"mppt-content\",children:[(0,D.jsxs)(\"div\",{className:\"mppt-top\",children:[(0,D.jsx)(\"div\",{className:\"mppt-details-title\",children:ld.util.iUnescape(c)}),(0,D.jsxs)(\"div\",{className:\"mppt-details-switches\",children:[(0,D.jsxs)(\"div\",{className:\"mppt-details-switch\",children:[(0,D.jsx)(_l.Z,{defaultChecked:!0}),(0,D.jsx)(\"span\",{children:l.formatMessage({id:\"neteco.pvms.monitor.mppt.details.label.powerOn\"})})]}),(0,D.jsxs)(\"div\",{className:\"mppt-details-switch\",children:[(0,D.jsx)(_l.Z,{defaultChecked:!0}),(0,D.jsx)(\"span\",{children:l.formatMessage({id:\"neteco.pvms.dataCollector.dataCollector_remoteReset\"})})]}),(0,D.jsxs)(\"div\",{className:\"mppt-details-switch\",children:[(0,D.jsx)(_l.Z,{defaultChecked:!0}),(0,D.jsx)(\"span\",{children:l.formatMessage({id:\"neteco.pvms.alarm.afci.clear.button\"})})]})]})]}),(0,D.jsxs)(\"div\",{className:\"mppt-details-content\",children:[(0,D.jsx)(\"div\",{className:\"left\",children:(0,D.jsx)($l.Z,{...e})}),(0,D.jsxs)(\"div\",{className:\"right\",children:[(0,D.jsxs)(\"div\",{className:\"mppt-details-tables bottom-border\",children:[(0,D.jsx)(\"div\",{className:\"mppt-details-subtitle\",children:l.formatMessage({id:\"neteco.pvms.monitor.mppt.details.label.inputSide\"})}),(0,D.jsx)(\"div\",{className:\"mppt-tables-container\",children:t.map(((e,t)=>(0,D.jsx)(sd.Z,{data:e,isShowStatus:!0,intl:l},t)))})]}),u.map(((e,t)=>(0,D.jsxs)(\"div\",{className:\"mppt-details-card\",children:[(0,D.jsx)(\"div\",{className:\"mppt-details-subtitle\",children:l.formatMessage({id:e.title})}),(0,D.jsx)(b.Z,{spinning:e.spinning,children:e.dom})]},t)))]})]})]})})})}}const ud=(0,o.ZP)(cd);var dd=n(91609);const pd=(0,o.ZP)((e=>{let{selectedTreeNode:t,props:n,subscriptionTime:r}=e;return(0,D.jsx)(\"div\",{className:\"station-device-detail\",children:(0,D.jsx)(mc.Z,{props:n,selectedTreeNode:t,subscriptionTime:r})})}));var fd=n(70440),hd=n(6197),md=n(33371);const gd={MANUFACTURER:21122,MODEL:21123,PROTOCOL_TYPE:21127,SOFT_VERSION:10059,RATED_CURRENT:10008,GUN_NO:10003,PORT_COUNT:10009,RATED_POWER:10033},vd={DEVICE_STATUS:10003,CONNECT_STATUS:10099,GUN_NUMBER:10009};var yd=n(41621);const{SOFT_VERSION:bd,MANUFACTURER:Sd,MODEL:xd,PROTOCOL_TYPE:wd,RATED_CURRENT:Cd,GUN_NO:Td,PORT_COUNT:Ad,RATED_POWER:Ed}=gd,Od=[\"neteco.pvms.partials.main.dm.detailInfo.curInfo.realData\",\"neteco.pvms.station.availability.addECO.base\",\"neteco.pvms.thirdInterface.src.subDevList\"],Md=neteco.util.iUnescape,Pd=(0,o.ZP)((e=>{const{intl:t,selectedTreeNode:n={},tableProps:r}=e,{elementDn:i,nodeName:o,mocId:a,parentNode:s={}}=n,[c,u]=(0,l.useState)([]),[d,p]=(0,l.useState)([]),[f,h]=(0,l.useState)();(0,l.useEffect)((()=>{m(),v(),y()}),[i]);const m=()=>{(0,ec.cx)(i).then((e=>{e.success&&u((e=>{const n=t.formatMessage({id:\"neteco.pvms.unit.KWh\"}),r=t.formatMessage({id:\"neteco.pvms.unit.kWUnit\"}),i=[];return null==e||e.forEach((e=>{(0,st.kJ)(e.signals)&&i.push(...e.signals)})),i.map((e=>{let t=e.unit;return\"kW\"===t&&(t=r),\"kWh\"===t&&(t=n),{...e,unit:t}}))})(e.data))})).catch((e=>{u([])}))},v=()=>{const e=Object.values(gd).join(\",\");(0,ec.sb)(i,e).then((e=>{e.success&&p(e.data)})).catch((e=>{p([])}))},y=()=>{(0,hd.Z0)(i).then((e=>{h(e||V.lH)})).catch((e=>{h(V.lH)}))},b=(e,n)=>(0,D.jsx)(md.Z,{className:\"nco-signal-card\",title:t.formatMessage({id:e}),children:(0,D.jsx)(de.Z,{gutter:[16,16],children:null==n?void 0:n.map((e=>(0,D.jsx)(pe.Z,{span:6,children:(0,D.jsxs)(\"div\",{className:\"nco-signal-info\",children:[(0,D.jsx)(\"span\",{className:\"nco-signal-info-label\",children:e.name}),(0,D.jsx)(\"span\",{children:`${(0,st.xb)(e.value)||e.value===V.Nw?V.lH:e.value} ${e.unit||\"\"}`})]})},e.id)))})});return(0,D.jsx)(\"div\",{className:\"nco-realtime-container\",children:(0,D.jsxs)(\"div\",{className:\"nco-realtime-content\",children:[b(Od[0],c),b(Od[1],(()=>{const e=[{intlKey:\"neteco.pvms.plantDiagnosis.device.name\",value:Md(o)||V.lH},{intlKey:\"neteco.pvms.maintenance.alarmManagement.table.title2\",value:f}];return(e=>{const t=[{intlKey:\"neteco.pvms.monitor.sub.sys.manufacturer\",value:(0,yd.X)(d,Sd)},{intlKey:\"ncoPvSearchBar.label.model\",value:(0,yd.X)(d,xd)},{intlKey:\"neteco.pvms.communication.mode\",value:(0,yd.X)(d,wd)},{intlKey:\"neteco.pvms.monitor.sub.sys.software.version\",value:(0,yd.X)(d,bd)},{intlKey:\"neteco.pvms.monitor.sub.sys.rated.current\",value:(0,yd.X)(d,Cd)},{intlKey:\"neteco.pvms.monitor.sub.sys.charging.port.count\",value:(0,yd.X)(d,Ad)}];if((0,fd.VA)(a)){const e={intlKey:\"neteco.pvms.ncomonitor.station.ratedPower\",value:(0,yd.X)(d,Ed)};t.splice(4,1,e)}e.push(...t)})(e),e.map((e=>({...e,name:t.formatMessage({id:e.intlKey})})))})()),r&&(e=>(0,D.jsx)(md.Z,{className:\"nco-signal-card\",title:t.formatMessage({id:Od[2]}),children:(0,D.jsx)(g.Z,{...e})}))(r)]})})}));var Dd=n(3746);const Id=(0,o.ZP)((e=>{const{intl:t,selectedTreeNode:n={}}=e,{elementDn:r,mocId:i}=n,o=Dd.UW,[a,s]=(0,l.useState)([]),[c,u]=(0,l.useState)([]);(0,l.useEffect)((()=>{(0,fd.SL)(i)&&f(),(0,fd.VA)(i)&&d()}),[]);const d=async()=>{const e=Object.values(vd);let t=[];p(12).map((e=>Object.values(e).map((e=>{t.includes(e)||t.push(e)}))));const n=e.concat(t).join(\",\");(0,ec.sb)(r,n).then((e=>{e.success&&(u(e.data),h(e.data))})).catch((e=>{s([])}))},p=e=>{let t=[];for(let n=0;n<e;n++)t.push({status:10500+5*n,chargeGunNo:10560+n,workStatus:10500+5*n,power:10502+5*n,dailyCharge:10504+5*n,accumulatedCharge:10503+5*n});return t},f=()=>{(0,R.sJ)(r,[20868],!1,\"10001,10002,10003,10032\").then((e=>{s(e||[])})).catch((e=>{s([])}))},h=e=>{const t=(0,yd.X)(e,vd.GUN_NUMBER,\"value\"),n=p(t);s(n)},m=[{id:[2,9],message:t.formatMessage({id:\"neteco.pvms.chargeRealTimeChargeStatusNumber.Monitoring.3\"})},{id:[0,4,5],message:t.formatMessage({id:\"neteco.pvms.basicUnifSignal.backup.backupStatusItem.1\"})},{id:[3,1],message:t.formatMessage({id:\"neteco.pvms.monitor.details.deviceList.gun.occupying\"})},{id:[8],message:t.formatMessage({id:\"neteco.pvms.monitor.details.deviceList.gun.abnormal\"})},{id:[7],message:t.formatMessage({id:\"neteco.pvms.monitor.details.deviceList.gun.retire\"})}];return(0,D.jsx)(\"div\",{className:\"nco-device-business-charge-detail-info tab-content\",children:(0,D.jsx)(Pd,{selectedTreeNode:n,tableProps:{columns:[{title:t.formatMessage({id:\"neteco.pvms.station.availability.deviceDeatil.columns.status\"}),dataIndex:\"status\",key:\"status\",render:e=>(e=>{let n=o.Disconnected;if((0,fd.VA)(i)){const t=(0,yd.X)(c,e,\"value\",!1),r=(0,yd.X)(c,vd.DEVICE_STATUS,\"value\",!1),i=(0,yd.X)(c,vd.CONNECT_STATUS,\"value\",!1);n=8===Number(t)||2===Number(r)||0===Number(r)?o.Unavailable:45057===Number(i)?o.Connected:o.Disconnected}else n=o[e];return e?(0,D.jsxs)(\"div\",{className:\"nco-device-run-status\",children:[(0,D.jsx)(\"span\",{className:\"nco-point\",style:{backgroundColor:n.color}}),(0,D.jsx)(\"span\",{className:\"nco-text\",children:t.formatMessage({id:n.title})})]}):V.lH})(e)},{title:t.formatMessage({id:\"neteco.pvms.monitor.sub.sys.charging.gun.with.no\"}),dataIndex:\"chargeGunNo\",key:\"chargeGunNo\",render:e=>((0,fd.VA)(i)?(0,yd.X)(c,e,\"value\",!1):e)||V.lH},{title:t.formatMessage({id:\"neteco.pvms.charge.device.realTime.chargeStatus\"}),dataIndex:\"workStatus\",key:\"workStatus\",render:e=>(e=>{const n=(0,yd.X)(c,e,\"value\",!1),r=m.find((e=>e.id.includes(Number(n))));return(0,st.xb)(r)?t.formatMessage({id:\"neteco.pvms.hems.intelligent.switch.communication.unonline\"}):(null==r?void 0:r.message)||V.lH})(e)},{title:t.formatMessage({id:\"neteco.pvms.current.power\"}),dataIndex:\"power\",key:\"power\",render:e=>((0,fd.VA)(i)?(0,yd.X)(c,e,\"value\"):e)||V.lH},{title:t.formatMessage({id:\"neteco.pvms.monitor.details.deviceList.gun.chargedAmount.daily\"}),dataIndex:\"dailyCharge\",key:\"dailyCharge\",render:e=>((0,fd.VA)(i)?(0,yd.X)(c,e,\"value\"):e)||V.lH},{title:t.formatMessage({id:\"neteco.pvms.monitor.details.deviceList.gun.chargedAmount.accumulated\"}),dataIndex:\"accumulatedCharge\",key:\"accumulatedCharge\",render:e=>((0,fd.VA)(i)?(0,yd.X)(c,e,\"value\"):e)||V.lH}],pagination:!1,dataSource:a}})})})),Nd=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2435),n.e(8620),n.e(75)]).then(n.bind(n,63414)))),_d=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2435),n.e(8620),n.e(7290)]).then(n.bind(n,90878)))),jd=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2239),n.e(3529),n.e(9303),n.e(4973),n.e(8233)]).then(n.bind(n,90217)))),kd=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2435),n.e(2539),n.e(9613),n.e(9649)]).then(n.bind(n,27746)))),Ld=(0,r.Z)((()=>n.e(4627).then(n.bind(n,56110)))),Rd=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2239),n.e(3529),n.e(9303),n.e(4973),n.e(8233)]).then(n.bind(n,23368)))),Zd=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(9479)]).then(n.bind(n,79479)))),Bd=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2435),n.e(9613),n.e(9807)]).then(n.bind(n,94536)))),Fd=(0,r.Z)((()=>n.e(9481).then(n.bind(n,61037)))),zd=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2435),n.e(8620),n.e(4973),n.e(1330)]).then(n.bind(n,81228)))),Vd=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2435),n.e(8620),n.e(4973),n.e(1330)]).then(n.bind(n,56153)))),Hd=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2435),n.e(8620),n.e(4973),n.e(1330)]).then(n.bind(n,41080)))),Ud=(0,r.Z)((()=>n.e(5303).then(n.bind(n,85104)))),Gd=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2435),n.e(8620),n.e(4973),n.e(1330)]).then(n.bind(n,28524)))),Yd=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2435),n.e(8620),n.e(4973),n.e(1330)]).then(n.bind(n,70939)))),Wd=(0,r.Z)((()=>n.e(542).then(n.bind(n,13464)))),Kd=(0,r.Z)((()=>n.e(542).then(n.bind(n,7397)))),qd=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2435),n.e(8620),n.e(4973),n.e(1330)]).then(n.bind(n,25346)))),Qd=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2435),n.e(8620),n.e(4973),n.e(1330)]).then(n.bind(n,24891)))),Xd=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2435),n.e(8620),n.e(4973),n.e(1330)]).then(n.bind(n,64575)))),Jd=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2435),n.e(8620),n.e(4973),n.e(1330)]).then(n.bind(n,32359)))),$d=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2435),n.e(8620),n.e(4973),n.e(1330)]).then(n.bind(n,14920)))),ep=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2435),n.e(8620),n.e(4973),n.e(1330)]).then(n.bind(n,29465)))),tp=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2435),n.e(8620),n.e(4973),n.e(1330)]).then(n.bind(n,11173)))),np=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2435),n.e(8620),n.e(4973),n.e(1330)]).then(n.bind(n,87863)))),rp=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2435),n.e(8620),n.e(4973),n.e(1330)]).then(n.bind(n,92610)))),ip=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2435),n.e(8620),n.e(4973),n.e(1330)]).then(n.bind(n,9387)))),op=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2435),n.e(8620),n.e(4973),n.e(1330)]).then(n.bind(n,22673)))),ap=(0,r.Z)((()=>n.e(7040).then(n.bind(n,28885)))),sp=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2435),n.e(8620),n.e(4973),n.e(1330)]).then(n.bind(n,73463)))),lp=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2435),n.e(8620),n.e(4973),n.e(1330)]).then(n.bind(n,19230)))),cp=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2435),n.e(8620),n.e(4973),n.e(1330)]).then(n.bind(n,51039)))),up=(0,r.Z)((()=>Promise.all([n.e(5186),n.e(638),n.e(2435),n.e(8620),n.e(4973),n.e(1330)]).then(n.bind(n,14909)))),dp={container:{path:\"/view/:activePage/:dn?\",component:(0,rc.VP)()?_d:Nd,redirectPage:\"redirect\"},companyReport:{path:\"/view/company/:companyDn/report/:activeTab?\",component:De,tabKeys:{site:\"site\",inverter:\"inverter\",pcs:\"pcs\",storage:\"storage\"}},companyAlarm:{path:\"/view/company/:companyDn/alarm\",component:Za.Z},companyConfig:{path:\"/view/company/:companyDn/config\",component:Wl},companyPrice:{path:\"/view/company/:companyDn/price\",component:Kl.Z},station:{path:\"/view/station/:stationDn\",component:jd},stationOverview:{path:\"/view/station/:stationDn/overview\"},stationSubsystem:{path:\"/view/station/:stationDn/subsystem/:activeTab\",component:kd},stationEMSconfiguration:{path:\"/view/station/:stationDn/stationEMSconfiguration\",component:Ld},stationLayout:{path:\"/view/station/:stationDn/layout\",component:Rd},stationReport:{path:\"/view/station/:stationDn/report\",component:De},stationDevManage:{path:\"/view/station/:stationDn/device-manage\",component:He},stationUser:{path:\"/view/station/:stationDn/station-user\",component:Tt},stationDefectMgt:{path:\"/view/station/:stationDn/defect-manage\",component:Za.Z},stationRevenue:{path:\"/view/station/:stationDn/station-revenue/:activeTab?\",component:lr},stationTrendAnalysis:{path:\"/view/station/:stationDn/station-trend-analysis/:activeTab?\",component:te},stationAI:{path:\"/view/station/:stationDn/aifc\",component:sn},stationArchive:{path:\"/view/station/:stationDn/archive\",component:Ae},dispersionRateAnalysis:{path:\"/view/station/:stationDn/dispersion-rateAnalysis\",component:cr},powerNormalization:{path:\"/view/station/:stationDn/powerNormalization\"},plantDiagnosis:{path:\"/view/station/:stationDn/plantDiagnosis\",component:Dl},essDiagnosis:{path:\"/view/station/:stationDn/ncoESSDiagnosis\",component:La},smartLoadShedding:{path:\"/view/station/:stationDn/smart-load-shedding/:activeTab?\",component:Zd},deviceStorage:{path:\"/view/device/:deviceDn/storageBox\",component:Bd},deviceStorageOverview:{path:\"/view/device/:deviceDn/storageBox/overview\"},deviceStorageDetails:{path:\"/view/device/:deviceDn/storageBox/details\",component:Ra.Z},deviceStorageAlarm:{path:\"/view/device/:deviceDn/storageBox/alarm\",component:Za.Z},deviceStorageHistory:{path:\"/view/device/:deviceDn/storageBox/history\",component:Il.Z},deviceStorageConfig:{path:\"/view/device/:deviceDn/storageBox/config\",component:Nl.Z},deviceInverter:{path:\"/view/device/:deviceDn/inverter\",component:Fd},deviceInverterDetails:{path:\"/view/device/:deviceDn/inverter/details\",component:ql.Z},deviceInverterAlarm:{path:\"/view/device/:deviceDn/inverter/alarm\",component:Za.Z},deviceInverterHistory:{path:\"/view/device/:deviceDn/inverter/history\",component:Il.Z},deviceInverterConfig:{path:\"/view/device/:deviceDn/inverter/config\",component:Nl.Z},devicePCS:{path:\"/view/device/:deviceDn/pcs\",component:zd},devicePCSDetails:{path:\"/view/device/:deviceDn/pcs/details\",component:hc},devicePCSAlarm:{path:\"/view/device/:deviceDn/pcs/alarm\",component:Za.Z},devicePCSHistory:{path:\"/view/device/:deviceDn/pcs/history\",component:Il.Z},devicePCSConfig:{path:\"/view/device/:deviceDn/pcs/config\",component:Nl.Z},deviceEMI:{path:\"/view/device/:deviceDn/emi\",component:Vd},deviceEMIDetails:{path:\"/view/device/:deviceDn/emi/details\",component:mc.Z},deviceEMIAlarm:{path:\"/view/device/:deviceDn/emi/alarm\",component:Za.Z},deviceEMIHistory:{path:\"/view/device/:deviceDn/emi/history\",component:Il.Z},deviceEMIConfig:{path:\"/view/device/:deviceDn/emi/config\",component:Nl.Z},deviceSubmatrix:{path:\"/view/device/:deviceDn/submatrix\",component:Hd},deviceSubmatrixOverview:{path:\"/view/device/:deviceDn/submatrix/overview\"},deviceSubmatrixDetails:{path:\"/view/device/:deviceDn/submatrix/details\",component:mc.Z},deviceSubmatrixDevManage:{pat