ops.deviceDn).then((e=>{const{success:t,data:n}=e;t&&this.setState({isInSharedStation:n})}))},this.loadButtonStatusInfo=()=>{const{mocId:e,deviceDn:t}=this.props;((0,N.hy)(e)||(0,N.Zr)(e)||(0,_.Z9)(e))&&this.shouldShowConfigButtons(),(0,N.Zr)(e)&&this.shouldShowClearButtonFunc(),(0,j.LG)(t).then((e=>{this.setState({connectState:e})}))},this.handlePowerId=()=>{let e;return e=(0,N.f3)(this.props.mocId)?10005:(0,_.mu)(this.props.mocId,this.props.typeId)?10102:10025,e},this.getDeviceStatus=e=>{var t;const n=this.handlePowerId(),r={};r[Y.o.STRING_INVERTER]=G.kB,r[Y.o.PID]=G._E,r[Y.o.PCS]=G.Y4,r[Y.o.ESS]=G.YV;const i=r[this.props.mocId]||G.kB;let o=(null==e?void 0:e[n])&&(null===(t=e[n])||void 0===t?void 0:t.realValue)&&i.includes(e[n].realValue);if((0,_.Z9)(this.props.mocId)&&(0,ln.kJ)(e)){var a,s;const t=null==e||null===(a=e.find((e=>e.id.toString()===String(n))))||void 0===a||null===(s=a.status)||void 0===s?void 0:s.toString();o=i.includes(t)}if((0,_.mu)(this.props.mocId,this.props.typeId)&&(0,ln.kJ)(e)){var l;const t=null==e||null===(l=e.find((e=>e.id.toString()===String(n))))||void 0===l?void 0:l.value;o=i.includes(t)}this.setState({switchOn:!o})},this.changeSwitchStatus=e=>{const{mocId:t,typeId:n}=this.props;(0,un.WW)(xn,{pageName:Sn,operationType:e?Cn.open:Cn.close,actionName:wn});let r=[];r=(0,_.mu)(t,n)?e?[{id:\"230770150\",value:\"1\"}]:[{id:\"230770150\",value:\"2\"}]:e?[{id:\"21009\",value:\"0\"}]:[{id:\"21010\",value:\"0\"}],this.showCommonModal(r,e,!0)},this.showCommonModal=(e,t,n)=>{const{intl:r,deviceDn:i}=this.props;let o=\"neteco.pvms.reset.tips\";return n&&(o=t?\"neteco.pvms.powerOn.tips\":\"neteco.pvms.powerOff.tips\"),mn(r,this.intlMessage(o),(()=>{const o={successCallback:n=>{(0,L.Lc)(i,e,n).then((n=>{const{code:i,data:o}=n;if(0===i)return\"21011\"===e[0].id&&\"21016\"===e[0].id||this.setState({switchOn:t}),fn(r,this.intlMessage(\"neteco.pvms.ipLock.modifySuccess\"));const a=o&&Object.keys(o).length>0&&Object.values(o)[0];return hn(r,this.intlMessage(a||\"neteco.pvms.ipLock.modifyFailed\"))}))},errorCallback:m.mz},a={successCallback:async()=>{this.setState({resetLoading:!0});const e=await(0,sn.Ks)(this.props.deviceDn),{code:t,data:n}=e;if(0===Number(t)&&0===n[0].code)gn(r,this.intlMessage(\"neteco.pvms.storageBox.resetsuccess\"));else if(1020===t)hn(r,this.intlMessage(\"neteco.pvms.device.management.not_exists\"));else{var i;hn(r,this.intlMessage(Object.values(null===(i=n[0].data)||void 0===i?void 0:i.data)[0]))}this.setState({resetLoading:!1})}},s=(0,_.Z9)(this.props.mocId)&&!n;(0,N.Nu)(\"use-verify-pass\",s?a:o)}))},this.changeResetStatus=e=>{(0,un.WW)(yn,{pageName:Sn,actionName:bn});const{mocId:t}=this.props,n={};n[Y.o.SMART_LOGGER]=\"21016\",n[Y.o.BUSINESS_SMART_LOGGER]=\"21016\",n[Y.o.DONGLE]=\"21016\",n[Y.o.HEMS]=\"21016\",n[Y.o.STRING_INVERTER]=\"21011\",n[Y.o.PID]=\"230250028\",n[Y.o.STS]=\"230532155\",n[Y.o.ESS]=\"20001\";const r={[n[Y.o.ESS]]:\"1\"}[n[t]]||\"0\",i=n[t]?[{id:n[t],value:r}]:[];this.showCommonModal(i,e)},this.checkDeviceSearchSignal=()=>{(0,L.FD)(this.props.deviceDn).then((e=>{const{success:t,data:n}=e;if(t&&n&&n.signals){const{signals:e}=n;if(\"{}\"!==JSON.stringify(e)){const{value:t}=e[10095],n=parseInt(t);if(isNaN(n))return;(n>>>2&1||n>>>5&1)&&this.setState({isHasOptimizeSignal:!0})}}}))},this.isShowOptimize=()=>{const{mocId:e}=this.props,{isHasOptimizeSignal:t}=this.state;return(0,P.lVp)(P.ZTu)&&t&&((0,N.Zr)(e)||(0,N.hy)(e))},this.deviceSearch=e=>{const{mocId:t,deviceDn:n,intl:r}=this.props,i={};i[Y.o.SMART_LOGGER]=\"21017\",i[Y.o.BUSINESS_SMART_LOGGER]=\"21017\",i[Y.o.DONGLE]=\"21007\",i[Y.o.HEMS]=\"230700074\";const o=i[t]?[{id:i[t],value:\"0\"}]:[];(0,L.wb)(n,o).then((e=>{const{code:t,data:n}=e;return 0===t&&0===n[0].code?fn(r,this.intlMessage(\"neteco.pvms.paramsSetting.unifiedSetting.devControl.deviceSearchSucceeded\")):hn(r,this.intlMessage(\"neteco.pvms.paramsSetting.unifiedSetting.devControl.deviceSearchFailed\"))}))},this.showConfirmModalFunc=()=>{a.Z.confirm({title:this.intlMessage(\"neteco.pvms.info\"),centered:!0,content:this.intlMessage(\"neteco.pvms.device.resetInverter\"),onOk:()=>{this.setState({showConfirmModal:!0})}})},this.confirmToClearAfcAlarm=e=>{(0,L.Nz)(e).then((e=>{const{code:t,description:n}=e;0===t?(fn(this.props.intl,this.intlMessage(\"neteco.pvms.afci.command.result.success\")),this.closeConfirmModal()):hn(this.props.intl,this.intlMessage(n||\"neteco.pvms.afci.command.result.failed\"))})).catch((()=>{hn(this.props.intl,this.intlMessage(\"neteco.pvms.dataCollector.remoteResetFailed\"))}))},this.closeConfirmModal=()=>{this.setState({showConfirmModal:!1})},this.shouldShowClearButtonFunc=()=>{if(!(0,P.lVp)(P.o5$))return;const{device:e={}}=this.props,{deviceDn:t}=e;t&&(0,k.Sg)(\"/rest/neteco/web/config/v1/alarm-mgr/is-support-reset\",{dn:t},3e4).then((e=>{const{code:t}=e;0===t&&this.setState({supportAlarmClear:!0})}))},this.isShowSyncChildrenSignalsBtn=async()=>{const{mocId:e,device:t={}}=this.props,{deviceDn:n}=t;if(!(0,P.lVp)(P.RcF)||!(0,N.Zr)(e))return;const r=await(0,L.wR)(n);this.setState({ShowSyncChildrenSignalsBtn:r})},this.extractPowerFactorDetail=e=>{if(!e)return{};const{mocId:t}=this.props,{value:n=\"\",valueRange:r,tips:i=\"\",name:o=\"\",unit:a=\"\",validatePattern:s,precision:l}=e;let c=\"\",u=[];return r?(c=r.displayRange||\"\",u=r.ranges||[]):c=i,{...e,mocId:t,value:n,name:o,tips:i,unit:a,displayRange:c,validatePattern:s,precision:l,ranges:u.map((e=>({min:e.minValue,max:e.maxValue,minClose:!0,maxClose:!0})))}},this.getRegulateProps=()=>{const{powerSignals:e}=this.state,{activeSignal:t,reactiveSignal:n,powerFactor:r}=e,{shouldShowActivePowerRegulationModal:i,shouldShowReactivePowerRegulationModal:o,shouldShowPowerFactorRegulationModal:a,powerSignalDetail:s}=this.state,{device:l,deviceName:c,deviceDn:u,mocId:d}=this.props,p=this.extractPowerFactorDetail(s),{ranges:f,value:h}=p;return{activePowerRegulateProps:{device:l,visible:i,onOk:I.TD,exists:!0,onCancel:this.hideActivePowerRegulationModal,type:\"ACTIVE_POWER\",regulationValue:h,limits:f,mocId:d,deviceName:c,deviceDn:u,signalId:t,...p},reactivePowerRegulateProps:{device:l,visible:o,onOk:I.TD,exists:!0,onCancel:this.hideReactivePowerRegulationModal,type:\"REACTIVE_POWER\",regulationValue:h,limits:f,mocId:d,deviceName:c,deviceDn:u,signalId:n,...p},powerFactorRegulateProps:{device:l,visible:a,exists:!0,onOk:I.TD,onCancel:this.hidePowerFactorRegulationModal,type:\"POWER_FACTOR\",regulationValue:h,limits:f,mocId:d,deviceName:c,deviceDn:u,signalId:r,...p}}},this.getActiveSignalId=()=>{const{powerSignals:e}=this.state,{activeSignal:t}=e;return t},this.getReactiveSignalId=()=>{const{powerSignals:e}=this.state,{reactiveSignal:t}=e;return t},this.getPowerFactor=()=>{const{powerSignals:e}=this.state,{powerFactor:t}=e;return t},this.openActivePowerRegulationModal=()=>{const e=this.getActiveSignalId();this.getRegulateValues(e),this.setState({shouldShowActivePowerRegulationModal:!0,activePowerRegulationModalExists:!0})},this.hideActivePowerRegulationModal=()=>{this.state.isInFreezingPeriod||(this.setState({shouldShowActivePowerRegulationModal:!1}),setTimeout((()=>{this.setState({powerSignalDetail:void 0,isInFreezingPeriod:!1})}),600))},this.openReactivePowerRegulationModal=()=>{const e=this.getReactiveSignalId();this.getRegulateValues(e),this.setState({shouldShowReactivePowerRegulationModal:!0,reactivePowerRegulationModalExists:!0})},this.hideReactivePowerRegulationModal=()=>{this.state.isInFreezingPeriod||(this.setState({shouldShowReactivePowerRegulationModal:!1}),setTimeout((()=>{this.setState({powerSignalDetail:void 0,isInFreezingPeriod:!1})}),600))},this.openPowerFactorRegulationModal=()=>{const e=this.getPowerFactor();this.getRegulateValues(e),this.setState({shouldShowPowerFactorRegulationModal:!0,powerFactorRegulationModalExists:!0})},this.hidePowerFactorRegulationModal=()=>{this.state.isInFreezingPeriod||(this.setState({shouldShowPowerFactorRegulationModal:!1}),setTimeout((()=>{this.setState({powerSignalDetail:void 0,isInFreezingPeriod:!1})}),600))},this.getRegulateValues=e=>{if(!(0,P.lVp)(P.o5$))return;const{deviceDn:t}=this.props;(0,I._r)(t,e).then((e=>{this.setState({isInFreezingPeriod:!0});const{code:t,data:n}=e;0===t&&this.setState({powerSignalDetail:n,isInFreezingPeriod:!1})})).catch((()=>{this.setState({isInFreezingPeriod:!1})}))},this.shouldShowConfigButtons=()=>{if(!(0,P.lVp)(P.o5$))return;if((0,_.Z9)(this.props.mocId))return void this.setState({showConfigButtons:!0});const{device:e={}}=this.props,{deviceDn:t}=e;t&&(0,j.bX)(\"/rest/neteco/web/config/device/v1/config/get-device-power-signals\",{dn:t}).then((e=>{const{success:t,data:n}=e;if(t){const{code:e,data:t}=n;if(!t)return;0===e?this.setState({showConfigButtons:!0,powerSignals:{activeSignal:t.ACTIVE_POWER,reactiveSignal:t.REACTIVE_POWER,powerFactor:t.POWER_FACTOR}}):this.setState({showConfigButtons:!1})}}))},this.renderPowerConfigButtons=()=>{const{connectState:e,isInFreezingPeriod:t}=this.state,{device:n={}}=this.props,{deviceDn:r}=n;return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(\"span\",{title:this.intlMessage(\"neteco.pvms.paramsSetting.unifiedSetting.devControl.actPowerReg\"),children:(0,C.jsx)(B.Z,{operationId:P.o5$,targetId:[r],targetType:\"device\",intl:this.props.intl,onClick:()=>{t||(this.setState({isInFreezingPeriod:!0}),this.openActivePowerRegulationModal())},disabled:!e||t,children:(0,C.jsx)(\"span\",{children:(0,C.jsx)(vn,{ellipsis:!0,children:(0,C.jsx)(c.Z,{id:\"neteco.pvms.paramsSetting.unifiedSetting.devControl.actPowerReg\"})})})})}),(0,C.jsx)(\"span\",{title:this.intlMessage(\"neteco.pvms.paramsSetting.unifiedSetting.devControl.reacPowerReg\"),children:(0,C.jsx)(B.Z,{operationId:P.o5$,targetId:[r],targetType:\"device\",intl:this.props.intl,onClick:()=>{t||(this.setState({isInFreezingPeriod:!0}),this.openReactivePowerRegulationModal())},disabled:!e||t,children:(0,C.jsx)(\"span\",{children:(0,C.jsx)(vn,{ellipsis:!0,children:(0,C.jsx)(c.Z,{id:\"neteco.pvms.paramsSetting.unifiedSetting.devControl.reacPowerReg\"})})})})}),(0,C.jsx)(\"span\",{title:this.intlMessage(\"neteco.pvms.paramsSetting.unifiedSetting.devControl.powFactorReg\"),children:(0,C.jsx)(B.Z,{operationId:P.o5$,targetId:[r],targetType:\"device\",intl:this.props.intl,onClick:()=>{t||(this.setState({isInFreezingPeriod:!0}),this.openPowerFactorRegulationModal())},disabled:!e||t,children:(0,C.jsx)(\"span\",{children:(0,C.jsx)(vn,{ellipsis:!0,children:(0,C.jsx)(c.Z,{id:\"neteco.pvms.paramsSetting.unifiedSetting.devControl.powFactorReg\"})})})})})]})},this.isShowSwitchDevice=(e,t,n)=>(0,N.Zr)(e)&&!t||(0,N.f3)(e)||(0,_.Z9)(e)||(0,_.mu)(e,n),this.isShowResetDevice=(e,t)=>(0,N.Zr)(e)&&!(0,N.cx)(e,t)||(0,N.hy)(e)||(0,N.ht)(e,t)||(0,N.Ou)(e)||(0,N.f3)(e)||(0,_.Ne)(e)||(0,an.bF)(e)&&!(0,N.Po)(e,t)||(0,_.Z9)(e)||(0,_.mu)(e,t)||(0,_.hy)(e,t),this.isShowDeviceSearchDevice=(e,t)=>(0,N.hy)(e)||(0,N.Ou)(e)||(0,N.ht)(e,t)||(0,_.Ne)(e),this.updateChildrenSignals=()=>{const{elementId:e,intl:t}=this.props;(0,pn.xf)(this.intlMessage(\"neteco.pvms.synchronize.subdevice.information.tip\"),t,(async()=>{(await(0,L.PS)(e)).success?o.ZP.success(this.intlMessage(\"common.message.success\")):o.ZP.error(this.intlMessage(\"common.message.failure\"))}))},this.renderSettingBtns=()=>{const{deviceDn:e,mocId:t,typeId:n}=this.props,{showConfigButtons:r,remoteSwitchState:i,switchOn:o,connectState:a,supportAlarmClear:s,resetLoading:l,ShowSyncChildrenSignalsBtn:u}=this.state,d=((e,t)=>{const n=new Set([23060,23061,23062,23063,23064,23066,23067]),r=new Set([20816,20822,20824,20847]);return n.has(Number(e))&&r.has(Number(t))})(n,t),p=i&&(0,P.lVp)(P.uAD)&&this.isShowSwitchDevice(t,d,n),f=i&&(0,P.lVp)(P.u4l)&&this.isShowResetDevice(t,n),h=(0,N.Zr)(t)&&s,m=this.isShowDeviceSearchDevice(t,n),g=r&&!d;return(0,C.jsxs)(\"div\",{className:\"setting-btns-wrapper\",children:[p&&(0,C.jsxs)(\"span\",{className:\"nco-pv-switch\",children:[(0,C.jsx)(B.Z,{operationId:P.uAD,targetId:[e],targetType:\"device\",intl:this.props.intl,type:\"switch\",onClick:this.changeSwitchStatus,checked:o,disabled:!a}),(0,C.jsx)(\"span\",{className:\"switch-label\",children:o?this.intlMessage(\"pvms.device.info.remote.switch.on\"):this.intlMessage(\"pvms.device.info.remote.switch.off\")})]}),f&&(0,C.jsx)(\"span\",{title:this.intlMessage(\"neteco.pvms.dataCollector.dataCollector_remoteReset\"),children:(0,C.jsx)(B.Z,{operationId:P.u4l,targetId:[e],targetType:\"device\",intl:this.props.intl,disabled:!a,onClick:this.changeResetStatus,loading:l,children:(0,C.jsx)(\"span\",{children:(0,C.jsx)(vn,{ellipsis:!0,children:(0,C.jsx)(c.Z,{id:\"neteco.pvms.dataCollector.dataCollector_remoteReset\"})})})})}),this.isShowOptimize()&&(0,C.jsx)(U,{deviceDn:e}),h&&!d&&(0,C.jsx)(\"span\",{title:this.intlMessage(\"neteco.pvms.alarm.afci.clear.button\"),children:(0,C.jsx)(B.Z,{operationId:P.hYL,targetId:[e],targetType:\"device\",intl:this.props.intl,disabled:!a,onClick:this.showConfirmModalFunc,children:(0,C.jsx)(\"span\",{children:(0,C.jsx)(vn,{ellipsis:!0,children:(0,C.jsx)(c.Z,{id:\"neteco.pvms.alarm.afci.clear.button\"})})})})}),m&&(0,C.jsx)(\"span\",{title:this.intlMessage(\"neteco.pvms.paramsSetting.unifiedSetting.devControl.deviceSearch\"),children:(0,C.jsx)(B.Z,{operationId:P.cRN,targetId:[e],targetType:\"device\",intl:this.props.intl,disabled:!a,onClick:this.deviceSearch,children:(0,C.jsx)(\"span\",{children:(0,C.jsx)(vn,{ellipsis:!0,children:(0,C.jsx)(c.Z,{id:\"neteco.pvms.paramsSetting.unifiedSetting.devControl.deviceSearch\"})})})})}),g&&this.renderPowerConfigButtons(),u&&(0,C.jsx)(dn.Z,{title:this.intlMessage(\"neteco.pvms.syncChildrenSignals.btn.tip\"),placement:\"bottom\",children:(0,C.jsx)(B.Z,{operationId:P.RcF,targetId:[e],targetType:\"device\",intl:this.props.intl,disabled:!a,onClick:this.updateChildrenSignals,children:(0,C.jsx)(\"span\",{children:(0,C.jsx)(vn,{ellipsis:!0,children:(0,C.jsx)(c.Z,{id:\"neteco.pvms.synchronize.subdevice.information.btn\"})})})})})]})},this.state={shouldShowActivePowerRegulationModal:!1,shouldShowReactivePowerRegulationModal:!1,shouldShowPowerFactorRegulationModal:!1,powerSignalDetail:void 0,showConfigButtons:!1,powerSignals:{activeSignal:(0,N.hy)(e.mocId)?21003:21022,reactiveSignal:(0,N.hy)(e.mocId)?21004:21024,powerFactor:(0,N.hy)(e.mocId)?21013:21023},remoteSwitchState:!1,switchOn:!1,connectState:!1,isHasOptimizeSignal:!1,showConfirmModal:!1,isInSharedStation:!1,supportAlarmClear:!1,resetLoading:!1,ShowSyncChildrenSignalsBtn:!1}}componentDidMount(){this.checkDeviceSearchSignal(),(0,N.Zr)(this.props.mocId)&&this.shouldShowClearButtonFunc(),this.getDeviceStatus(this.props.realtimeInformation),this.loadButtonStatusInfo(),this.checkRemoteControl(),this.checkShareStation(),this.isShowSyncChildrenSignalsBtn()}render(){const{deviceDn:e}=this.props,{showConfirmModal:t,isInSharedStation:n}=this.state,{activePowerRegulateProps:o,reactivePowerRegulateProps:a,powerFactorRegulateProps:s}=this.getRegulateProps();return(0,C.jsxs)(\"div\",{children:[(0,C.jsx)(D.Z,{}),(0,l.createElement)(M,{...o,key:\"ACTIVE_POWER\"}),(0,l.createElement)(M,{...a,key:\"REACTIVE_POWER\"}),(0,l.createElement)(M,{...s,key:\"POWER_FACTOR\"}),!n&&this.renderSettingBtns(),(0,C.jsx)(r.Z,{title:this.intlMessage(\"neteco.pvms.info\"),visible:t,maskClosable:!1,centered:!0,destroyOnClose:!0,onCancel:()=>this.setState({showConfirmModal:!1}),footer:[(0,C.jsx)(i.Z,{onClick:()=>this.setState({showConfirmModal:!1}),children:this.intlMessage(\"neteco.pvms.main.hhsrc.cancel\")},\"back\"),(0,C.jsx)(i.Z,{type:\"primary\",onClick:()=>this.confirmToClearAfcAlarm(e),children:this.intlMessage(\"neteco.pvms.main.hhsrc.comfirm\")},\"submit\")],children:this.intlMessage(\"neteco.pvms.intelAlarm.clear.message\")})]})}}const An=(0,u.ZP)(Tn)},25947:(e,t,n)=>{\"use strict\";n.d(t,{$Y:()=>w,Hc:()=>C,Nv:()=>S,Y4:()=>v,YV:()=>y,ZP:()=>u,_E:()=>b,kB:()=>g,on:()=>x,qO:()=>T});var r=n(91650),i=n(23712);const{pvInputASignals:o,pvInputVSignals:a,pvStatusSignals:s}=r.ZP,l={MODULE_INFO_ID:\"moduleInfoID\",PACK_ID:\"packId\",VERSION:\"version\",PACK_SN:\"packSN\",WORK_STATUS:\"workStatus\",VOLTAGE:\"voltage\",POWER:\"power\",MAX_TEMPERATURE:\"maxTemperature\",MIN_TEMPERATURE:\"minTemperature\",SOC:\"SOC\",DISCHARGE:\"discharge\",HEALTH:\"health\",HEATING_STATUS:\"heatingStatus\",SOH:\"SOH\",MODEL:\"model\"},c={MODULE_ONE_SIGNALS:new Map([[l.MODULE_INFO_ID,[\"230320252\",\"230320459\",\"230320275\",\"230320146\",\"230320463\",\"230320473\",\"230320462\",\"230320469\",\"230320470\",\"230320108\",\"230320460\",\"230320461\",\"230320514\",\"230320107\"]],[l.PACK_ID,[\"230320265\",\"230320266\",\"230320267\"]],[l.VERSION,[\"230320148\",\"230320165\",\"230320181\"]],[l.PACK_SN,[\"230320147\",\"230320164\",\"230320180\"]],[l.WORK_STATUS,[\"230320151\",\"230320168\",\"230320184\"]],[l.VOLTAGE,[\"230320159\",\"230320174\",\"230320190\"]],[l.POWER,[\"230320158\",\"230320173\",\"230320189\"]],[l.MAX_TEMPERATURE,[\"230320446\",\"230320448\",\"230320450\"]],[l.MIN_TEMPERATURE,[\"230320447\",\"230320449\",\"230320451\"]],[l.SOC,[\"230320152\",\"230320169\",\"230320185\"]],[l.DISCHARGE,[\"230320163\",\"230320179\",\"230320194\"]],[l.HEALTH,[\"230320492\",\"230320493\",\"230320494\"]],[l.HEATING_STATUS,[\"230320498\",\"230320499\",\"230320500\"]],[l.SOH,[\"230320154\",\"230320170\",\"230320186\"]],[l.MODEL,[\"230320663\",\"230320664\",\"230320665\"]]]),MODULE_TWO_SIGNALS:new Map([[l.MODULE_INFO_ID,[\"230320253\",\"230320464\",\"230320276\",\"230320145\",\"230320468\",\"230320474\",\"230320467\",\"230320471\",\"230320472\",\"230320115\",\"230320465\",\"230320466\",\"230320515\",\"230320114\"]],[l.PACK_ID,[\"230320268\",\"230320269\",\"230320270\"]],[l.VERSION,[\"230320196\",\"230320211\",\"230320226\"]],[l.PACK_SN,[\"230320195\",\"230320210\",\"230320225\"]],[l.WORK_STATUS,[\"230320199\",\"230320214\",\"230320229\"]],[l.VOLTAGE,[\"230320205\",\"230320220\",\"230320235\"]],[l.POWER,[\"230320204\",\"230320219\",\"230320234\"]],[l.MAX_TEMPERATURE,[\"230320452\",\"230320454\",\"230320456\"]],[l.MIN_TEMPERATURE,[\"230320453\",\"230320455\",\"230320457\"]],[l.SOC,[\"230320200\",\"230320215\",\"230320230\"]],[l.DISCHARGE,[\"230320209\",\"230320224\",\"230320239\"]],[l.HEALTH,[\"230320495\",\"230320496\",\"230320497\"]],[l.HEATING_STATUS,[\"230320501\",\"230320502\",\"230320503\"]],[l.SOH,[\"230320201\",\"230320216\",\"230320231\"]],[l.MODEL,[\"230320666\",\"230320667\",\"230320668\"]]]),MODULE_THREE_SIGNALS:new Map([[l.MODULE_INFO_ID,[\"230320640\",\"230320526\",\"230320536\",\"230320542\",\"230320529\",\"230320527\",\"230320535\",\"230320532\",\"230320533\",\"230320539\",\"230320528\",\"230320534\",\"230320516\",\"230320538\"]],[l.PACK_ID,[\"230320646\",\"230320647\",\"230320648\"]],[l.VERSION,[\"230320544\",\"230320555\",\"230320566\"]],[l.PACK_SN,[\"230320543\",\"230320554\",\"230320565\"]],[l.WORK_STATUS,[\"230320545\",\"230320556\",\"230320567\"]],[l.VOLTAGE,[\"230320549\",\"230320560\",\"230320571\"]],[l.POWER,[\"230320548\",\"230320559\",\"230320570\"]],[l.MAX_TEMPERATURE,[\"230320576\",\"230320578\",\"230320580\"]],[l.MIN_TEMPERATURE,[\"230320577\",\"230320579\",\"230320581\"]],[l.SOC,[\"230320546\",\"230320557\",\"230320568\"]],[l.DISCHARGE,[\"230320552\",\"230320563\",\"230320574\"]],[l.HEALTH,[\"230320553\",\"230320564\",\"230320575\"]],[l.HEATING_STATUS,[\"230320504\",\"230320505\",\"230320506\"]],[l.SOH,[\"230320547\",\"230320558\",\"230320569\"]],[l.MODEL,[\"230320669\",\"230320670\",\"230320671\"]]]),MODULE_FOUR_SIGNALS:new Map([[l.MODULE_INFO_ID,[\"230320641\",\"230320583\",\"230320593\",\"230320599\",\"230320586\",\"230320584\",\"230320592\",\"230320589\",\"230320590\",\"230320596\",\"230320585\",\"230320591\",\"230320517\",\"230320595\"]],[l.PACK_ID,[\"230320649\",\"230320650\",\"230320651\"]],[l.VERSION,[\"230320601\",\"230320612\",\"230320623\"]],[l.PACK_SN,[\"230320600\",\"230320611\",\"230320622\"]],[l.WORK_STATUS,[\"230320602\",\"230320613\",\"230320624\"]],[l.VOLTAGE,[\"230320606\",\"230320617\",\"230320628\"]],[l.POWER,[\"230320605\",\"230320616\",\"230320627\"]],[l.MAX_TEMPERATURE,[\"230320633\",\"230320635\",\"230320637\"]],[l.MIN_TEMPERATURE,[\"230320634\",\"230320636\",\"230320638\"]],[l.SOC,[\"230320603\",\"230320614\",\"230320625\"]],[l.DISCHARGE,[\"230320609\",\"230320620\",\"230320631\"]],[l.HEALTH,[\"230320610\",\"230320621\",\"230320632\"]],[l.HEATING_STATUS,[\"230320507\",\"230320508\",\"230320509\"]],[l.SOH,[\"230320604\",\"230320615\",\"230320626\"]],[l.MODEL,[\"230320672\",\"230320673\",\"230320674\"]]])},u={DEVICE_MOC_IDS:{HOUSEHOLD_INVERTER:20810,STORAGE:20815,OPTIMIZER:20814,METER:20816,SMART_LOGGER:20821,BUSINESS_SMART_LOGGER:20820,DONGLE:20819,STRING_INVERTER:20822,POWER_METER:20823,EMI:20824,PID:20825,PLC:20826,GATEWAY_ENERGY_METER:20823,STS3RD:20847,HEMS:20851},HOUSEHOLD_INVERTER_REALTIME_SIGNAL_KEYS:{DEVICE_STATUS:\"10025\",MODE:\"21021\",CURRENT_GENERATION:\"10032\",POWER_FACTOR:\"10020\",CUMULATIVE_GENERATION:\"10029\",GRID_FREQUENCY:\"10021\",OUTPUT_REACTIVE_POWER:\"10019\",RATED_POWER:\"10006\",UP_TIME:\"10027\",OFF_TIME:\"10028\",OUTPUT_WAY:\"21029\",ACTIVE_POWER:\"10018\",AB_VOLTAGE:\"10008\",BC_VOLTAGE:\"10009\",CA_VOLTAGE:\"10010\",A_VOLTAGE:\"10011\",B_VOLTAGE:\"10012\",C_VOLTAGE:\"10013\",A_CURRENT:\"10014\",B_CURRENT:\"10015\",C_CURRENT:\"10016\",ON_SWITCH:\"21009\"},HOUSEHOLD_STORAGE_REALTIME_SIGNAL_KEYS:{BATTERY_STATUS:\"10003\",BATTERY_SOC:\"10006\",BATTERY_CHARGE_DISCHARGE_MODE:\"10008\",BATTERY_SOH:\"10007\",BATTERY_CHARGE_CAP:\"10001\",BATTERY_BUS_BAR_U:\"10005\",BATTERY_DISCHARGE_CAP:\"10002\",BATTERY_CHARGE_DISCHARGE_POWER:\"10004\",BATTERY_BACKUP_TIME:\"10015\",BATTERY_RATED_CAPACITY:\"10013\"},HOUSEHOLD_METER_REALTIME_SIGNAL_KEYS:{METER_OUTPUT_WAY:\"10015\",METER_STATUS:\"10001\",METER_ACTIVE_CAP:\"10008\",METER_REVERSE_ACTIVE_CAP:\"10009\",METER_POWER_FACTOR:\"10006\",METER_REACTIVE_POWER:\"10005\",METER_GRID_RATE:\"10007\",METER_A_ACTIVE_POWER:\"10019\",METER_B_ACTIVE_POWER:\"10020\",METER_C_ACTIVE_POWER:\"10021\",METER_A_U:\"10002\",METER_B_U:\"10010\",METER_C_U:\"10011\",METER_A_I:\"10003\",METER_B_I:\"10012\",METER_C_I:\"10013\"},HOUSEHOLD_REGULATE_VALUE_SIGNAL_KEYS:{ACTIVE_POWER_REGULATE_VALUE:\"21022\",REACTIVE_POWER_REGULATE_VALUE:\"21023\",POWER_FACTOR_REGULATE_VALUE:\"21024\"},STRING_INVERTER_REALTIME_SIGNAL_KEYS:{DEVICE_STATUS:\"10025\",CURRENT_GENERATION:\"10032\",CUMULATIVE_GENERATION:\"10029\",OUTPUT_REACTIVE_POWER:\"10019\",EFFICIENCY:\"10022\",RATED_POWER:\"10006\",POWER_FACTOR:\"10020\",GRID_FREQUENCY:\"10021\",UP_TIME:\"10027\",OFF_TIME:\"10028\",OUTPUT_WAY:\"21029\",ACTIVE_POWER:\"10018\",AB_VOLTAGE:\"10008\",BC_VOLTAGE:\"10009\",CA_VOLTAGE:\"10010\",A_VOLTAGE:\"10011\",B_VOLTAGE:\"10012\",C_VOLTAGE:\"10013\",A_CURRENT:\"10014\",B_CURRENT:\"10015\",C_CURRENT:\"10016\",DC_CURRENT:\"10113\",DC_VOLTAGE:\"10114\",DC_POWER:\"10115\",INTERNAL_TEMPERATURE:\"10023\",INSULATION_IMPEDANCE:\"10024\"},EMI_REALTIME_SIGNAL_KEYS:{WIND_SPEED:\"10001\",WIND_DIRECTION:\"10002\",PV_TEMPERATURE:\"10003\",TEMPERATURE:\"10004\",IRR:\"10005\",RADIANT_TOTAL:\"10006\",STATUS:\"19999\"},GATEWAY_ENERGY_METER_REALTIME_SIGNAL_KEYS:{AB_V:\"10004\",BC_V:\"10005\",CA_V:\"10006\",A_V:\"10001\",B_V:\"10002\",C_V:\"10003\",GRID_FREQUENCY:\"10024\",POWER_FACTOR:\"10013\",A_A:\"10007\",B_A:\"10008\",C_A:\"10009\",TOTAL_VIEWABLE_FACTOR:\"10015\",ACTIVE_POWER:\"10010\",ACTIVE_POWER_A:\"10016\",ACTIVE_POWER_B:\"10017\",ACTIVE_POWER_C:\"10018\",POSITIVE_TOTAL_ACTIVE_POWER:\"10012\",REVERSE_TOTAL_ACTIVE_POWER:\"10021\",REACTIVE_POWER:\"10011\",REACTIVE_POWER_QA:\"10019\",REACTIVE_POWER_QB:\"10020\",REACTIVE_POWER_QC:\"10023\",POSITIVE_TOTAL_REACTIVE_POWER:\"10014\",REVERSE_TOTAL_REACTIVE_POWER:\"10022\"},PID_REALTIME_SIGNAL_KEYS:{DEVICE_MODEL:\"10001\",ESN:\"10002\",MODBUS_VERSION:\"10003\",SOFT_VERSON:\"10004\",MODULE_STATE:\"10005\",OUTPUT_VOLTAGE:\"10006\",OUTPUT_CURRENT:\"10007\",MODULE_TEMP:\"10008\",AB_CURRENT:\"10011\",BC_CURRENT:\"10012\",AC_CURRENT:\"10013\",GRID_FREQUENCY:\"10014\",CONNECT_STATE:\"19999\"},HOUSEHOLD_STORAGE_HISTORY_DATA_SIGNAL_KEYS:{CHARGE_DISCHARGE_POWER:\"30005\",SOC:\"30007\"},HOUSEHOLD_STORAGE_MODULE_SIGNAL_IDS:{MODULE_ONE:230320107,MODULE_TWO:230320114,MODULE_THREE:230320538,MODULE_FOUR:230320595,MODULE_ONE_NUM:230320252,MODULE_TWO_NUM:230320253,MODULE_THREE_NUM:230320640,MODULE_FOUR_NUM:230320641,FESTATUS_SIGNAL_ONE:230320514,FESTATUS_SIGNAL_TWO:230320515,FESTATUS_SIGNAL_THREE:230320516,FESTATUS_SIGNAL_FOUR:230320517},HOUSEHOLD_STORAGE_TYPE:{STORAGE_LG:23015,STORAGE_LUNA:23032},SYSNC_SIGNALS:[\"230320146\",\"230320145\",\"230320542\",\"230320599\",\"230320275\",\"230320276\",\"230320536\",\"230320593\",...c.MODULE_ONE_SIGNALS.get(l.VERSION),...c.MODULE_TWO_SIGNALS.get(l.VERSION),...c.MODULE_THREE_SIGNALS.get(l.VERSION),...c.MODULE_FOUR_SIGNALS.get(l.VERSION),...c.MODULE_ONE_SIGNALS.get(l.SOH),...c.MODULE_TWO_SIGNALS.get(l.SOH),...c.MODULE_THREE_SIGNALS.get(l.SOH),...c.MODULE_FOUR_SIGNALS.get(l.SOH),...c.MODULE_ONE_SIGNALS.get(l.MODEL),...c.MODULE_TWO_SIGNALS.get(l.MODEL),...c.MODULE_THREE_SIGNALS.get(l.MODEL),...c.MODULE_FOUR_SIGNALS.get(l.MODEL)],MODULE_SIGNALS_ALL:c,MODULE_SIGNALS_KEY:l},d=\"768\",p=\"769\",f=\"770\",h=\"771\",m=\"772\",g=[d,p,f,h,m,\"773\",\"774\",\"775\",\"776\"],v=[d,p,f,h,m,\"773\",\"774\",\"775\",\"776\",\"777\",\"778\"],y=[d,p,f,h,m],b=[\"3\",\"7\",\"8\",\"10\"],S=(e,t,n,r)=>{const o={};return e===(r?45057:1)?(o.css=\"nco-station-state-green-circle\",o.title=n?t.formatMessage({id:\"neteco.pvms.hems.intelligent.switch.channel.close\"}):t.formatMessage({id:\"neteco.pvms.hems.intelligent.switch.communication.online\"})):(o.css=\"nco-station-state-grey-circle\",o.title=n?t.formatMessage({id:\"neteco.pvms.hems.intelligent.switch.channel.open\"}):t.formatMessage({id:\"neteco.pvms.hems.intelligent.switch.communication.unonline\"})),(0,i.jsxs)(\"span\",{className:\"hems-status\",children:[(0,i.jsx)(\"div\",{className:o.css}),o.title]})},x=(e,t)=>0===e?t.formatMessage({id:\"neteco.pvms.hems.intelligent.switch.device.type\"}):\"-\",w=230320678,C={TO_BE_DETECTED:\"0\",AUTO_DETECTING:\"1\",MANUAL_DETECTING:\"2\",DETECT_SUCCESSED:\"3\",DETECT_FAILED:\"4\"},T=[{protocolKey:\"0\",protocolValue:\"Modbus_TCP\"},{protocolKey:\"1\",protocolValue:\"EEBUS\"}]},84272:(e,t,n)=>{\"use strict\";n.d(t,{FD:()=>s,Jq:()=>p,Lc:()=>l,MM:()=>d,Nz:()=>o,OW:()=>u,PS:()=>m,pm:()=>a,tz:()=>f,wR:()=>h,wb:()=>c});var r=n(49453),i=n(44184);const o=e=>new Promise(((t,n)=>{(0,r.v_)(`/rest/neteco/web/config/v1/alarm-mgr/fault-reset?dn=${e}`).then((e=>{t(e)})).catch((()=>{n()}))})),a=()=>new Promise((e=>{(0,r.U2)(\"/rest/pvms/web/management/v1/config/get_management_item\",{}).then((t=>{e(t)})).catch((t=>{e(t)}))})),s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10095;return new Promise((n=>{(0,r.U2)(\"/rest/pvms/web/device/v1/device-real-kpi\",{deviceDn:e,signalIds:t}).then((e=>{n(e)})).catch((e=>{n(e)}))}))},l=(e,t,n)=>new Promise((i=>{(0,r.Md)(\"/rest/neteco/config/device/v1/config/set-signal-with-randomval\",{dn:e,changeValues:JSON.stringify(t),randomVal:null==n?void 0:n.check}).then((e=>{i(e)})).catch((e=>{i(e)}))})),c=(e,t)=>new Promise((n=>{(0,r.Md)(\"/rest/pvms/web/device/v1/deviceExt/set-config-signals\",{dn:e,changeValues:JSON.stringify(t)}).then((e=>{n(e)})).catch((e=>{n(e)}))})),u=e=>new Promise((t=>{(0,r.Sg)(\"/rest/pvms/web/device/v1/mo-details\",{dn:e},18e4).then((e=>{const{success:n,data:r}=e;if(n){const{mo:e}=r,{typeId:n,versionId:i}=e;t({typeId:n,versionId:i})}else t({})})).catch((()=>{t({})}))})),d=async e=>{const[t,n]=await(0,i.AM)((0,r.U2)(\"/rest/dp/pvms/device/v1/load/hems-device-detail\",{dn:e}));return t?{}:n},p=async()=>{const[e,t]=await(0,i.AM)((0,r.U2)(\"/rest/pvms/web/device/v1/battery-delete-function-privilege\"));return e?{}:t},f=async e=>{const[t,n]=await(0,i.AM)((0,r.v_)(\"/rest/neteco/web/imodbus/v1/ne-service/ne/batch-deletion?careResetPwdResult=false\",e));return t?{}:n},h=async e=>{const[t,n]=await(0,i.AM)((0,r.U2)(`/rest/neteco/web/config/device/v1/children-list?conditionParams.parentDn=${e}&conditionParams.curPage=0&conditionParams.recordperpage=1&conditionParams.mocTypes=20815`));return!t&&!!n.total},m=async e=>{const[t,n]=await(0,i.AM)((0,r.v_)(`/rest/dp/pvms/device/v1/sync/sync-children-signals?deviceDnId=${e}`));return t?{}:n}},49651:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>bt});var r=n(32449),i=n(88391),o=n(93706),a=n(31519),s=n(21499),l=n(44184),c=n(24301),u=n(11854),d=n(91987),p=n(13450),f=n(22800),h=n(9490),m=n(37920),g=n.n(m),v=n(78939);const y=[0,5,10,20],b=[-20,-10,10,20],S={NOT_ANALYZED:0,VALID_DATA:1,NO_DATA:2},x={LEVEL_TERRIBLE:\"terrible\",LEVEL_BAD:\"bad\",LEVEL_NORMAL:\"normal\",LEVEL_GOOD:\"good\",LEVEL_EXCELLENT:\"excellent\",LEVEL_UNKNOWN:\"unknown\"},w={TIP_RANGE:{[x.LEVEL_TERRIBLE]:`<${b[0]}%`,[x.LEVEL_BAD]:`${b[0]}% ~ ${b[1]}%`,[x.LEVEL_NORMAL]:`${b[1]}% ~ ${b[2]}%`,[x.LEVEL_GOOD]:`${b[2]}% ~ ${b[3]}%`,[x.LEVEL_EXCELLENT]:`>${b[3]}%`,[x.LEVEL_UNKNOWN]:\"\"},TIP_DESC:{[x.LEVEL_TERRIBLE]:\"neteco.pvms.dispersionRate.rectification\",[x.LEVEL_BAD]:\"neteco.pvms.dispersionRate.slightlyBad\",[x.LEVEL_NORMAL]:\"neteco.pvms.dispersionRate.general\",[x.LEVEL_GOOD]:\"neteco.pvms.dispersionRate.good\",[x.LEVEL_EXCELLENT]:\"neteco.pvms.dispersionRate.great\",[x.LEVEL_UNKNOWN]:\"neteco.pvms.dispersionRate.titp.21\"},TIP_STRING_RANGE:{[x.LEVEL_TERRIBLE]:`>${y[3]}%`,[x.LEVEL_BAD]:`${y[2]}% - ${y[3]}%`,[x.LEVEL_NORMAL]:`${y[1]}% - ${y[2]}%`,[x.LEVEL_EXCELLENT]:`${y[0]}% - ${y[1]}%`,[x.LEVEL_UNKNOWN]:\"neteco.pvms.dispersionRate.titp.21\"}},C={[x.LEVEL_TERRIBLE]:{color:\"#F43146\"},[x.LEVEL_BAD]:{color:\"#EEBA18\"},[x.LEVEL_NORMAL]:{color:\"#5990FD\"},[x.LEVEL_GOOD]:{color:\"#6ACA94\"},[x.LEVEL_EXCELLENT]:{color:\"#2DA769\"},[x.LEVEL_UNKNOWN]:{color:\"#999999\"}},T=\"rangeLevel\",A=function(e){switch(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0){case 0:return\"number\"!=typeof e||isNaN(e)?x.LEVEL_UNKNOWN:e<b[0]?x.LEVEL_TERRIBLE:e<b[1]?x.LEVEL_BAD:e<b[2]?x.LEVEL_NORMAL:e<b[3]?x.LEVEL_GOOD:x.LEVEL_EXCELLENT;case 1:return\"number\"!=typeof e||isNaN(e)?x.LEVEL_UNKNOWN:e>=y[3]?x.LEVEL_TERRIBLE:e>=y[2]?x.LEVEL_BAD:e>=y[1]?x.LEVEL_NORMAL:e>=y[0]?x.LEVEL_EXCELLENT:x.LEVEL_UNKNOWN;default:return x.LEVEL_UNKNOWN}};var E=n(99073),O=n(13528);const{LEVEL_UNKNOWN:M}=x,{NOT_ANALYZED:P,VALID_DATA:D,NO_DATA:I}=S;var N=n(97382),_=n(11946),j=n(66915),k=n(70250),L=n.n(k),R=n(23712);const Z=i.memo((0,o.ZP)((function(e){let{intl:t,className:n=\"\",style:r={},contentStyle:o={},disabledTip:a=\"\",tagContent:s,showCheckAll:l=!1,maxCount:u=1/0,options:d=[],defaultValue:p,...f}=e;const[h,m]=(0,i.useState)(p||[]),[g,v]=(0,i.useState)(!1),[y,b]=(0,i.useState)(!1),S=(0,i.useMemo)((()=>d.length),[d]),x=(0,i.useMemo)((()=>{const e=L()(d),t=h;if(e.length<=u||t.length<u)return e;const n={};return t.forEach((e=>n[e.value]=!0)),e.forEach((e=>{n[e.value]||(e.disabled=!0,a&&(e.label=(0,R.jsx)(c.Z,{trigger:\"hover\",title:a,children:(0,R.jsx)(\"span\",{className:\"disabled-option-label\",children:e.label})})))})),e}),[d,p,h]),w=e=>{const{onChange:t}=f;v(e.length===S),b(e.length>0&&e.length<S),m(e),\"function\"==typeof t&&t(e)},C=e=>{if(e.stopPropagation(),\"SPAN\"===e.target.nodeName)return;const{labelInValue:t=!0}=f,n=t?d:d.map((e=>e.value));(h||[]).length<n.length?w(n):w([])},T=(0,i.useCallback)((e=>{const{dropdownRender:n}=f,r=\"function\"==typeof n?n(e):e;return l&&u>=S?(0,R.jsxs)(R.Fragment,{children:[S>0&&(0,R.jsx)(\"div\",{className:\"checked-all-checkbox-wrapper\",onClick:C,children:(0,R.jsx)(_.Z,{checked:g,indeterminate:y,children:t.formatMessage({id:\"neteco.pvms.common.selectAll\"})})}),r]}):r}),[g,y]);return(0,i.useEffect)((()=>{p&&w(p)}),[p]),(0,R.jsx)(\"div\",{className:`nco-stations-select ${n}`,style:r,children:(0,R.jsx)(j.Z,{style:o,...f,mode:\"multiple\",value:h,showSearch:!1,labelInValue:!0,options:x,onChange:w,dropdownRender:T,getPopupContainer:e=>e})})}))),{TIP_STRING_RANGE:B}=w;class F extends i.Component{constructor(e){var t;super(e),t=this,this.buttonGroupActiveId=0,this.formRef=i.createRef(),this.chartData={options:{},selectedData:null,selectedSeries:null,zoomStart:null,zoomEnd:null,splitArea:{show:!0,areaStyle:{}}},this.getDispersionRateData=async e=>{const{NOT_ANALYZED:t,VALID_DATA:n,NO_DATA:r}=S,{stationOptions:i}=this.state,o=new Set,a=new Set,s={},c={},u=await(0,N.Pc)({...e});u&&u.forEach((e=>{a.add(e.statDay),o.add(e.stationDn);const r=e.calcStatus===n?{type:n,name:e.stationName,value:Number(e.dispersionValStr),summary:e.invDeviationStatistic,dn:e.stationDn}:{type:t,name:e.stationName,value:0,summary:e.invDeviationStatistic,dn:e.stationDn};s[e.stationDn]?s[e.stationDn].push(r):s[e.stationDn]=[r],c[e.statDay]?c[e.statDay][e.stationDn]=r:c[e.statDay]={[e.stationDn]:r}}));const d=[];i.forEach((e=>{d.push(s[e.value])}));const p={date:Array.from(a),rateList:this.props.isOperation?d.filter((e=>!(0,l.xb)(e))):d,info:c};return this.setState({dispersionRateData:p}),p},this.getRecentDayDispersionRateData=e=>{this.getDispersionRateData({...e,startDay:g()(new Date).format(\"YYYY-MM-DD\"),endDay:g()(new Date).format(\"YYYY-MM-DD\")})},this.changeOccurTime=e=>{e?this.setState({dateRange:[e[0],e[1]],customSearchTimeRange:[e[0].format(\"YYYY-MM-DD\"),e[1].format(\"YYYY-MM-DD\")]}):this.setState({dateRange:[],customSearchTimeRange:null})},this.getRangeTime=e=>{this.setState({dateRange:e})},this.disabledOccurTime=e=>{var t;if(!this.state.dateRange)return!1;const n=this.state.dateRange[0]&&(null==e?void 0:e.diff(this.state.dateRange[0],\"days\"))>=7;return this.state.dateRange[1]&&(null===(t=this.state.dateRange[1])||void 0===t?void 0:t.diff(e,\"days\"))>=7||n},this.handleButtonGroupOnClick=e=>{const{stationDn:t}=this.state,{earliestMoment:n}=this.props;if(this.resetChart(),\"today\"===e){const e=g()();this.buttonGroupActiveId=0,this.getRecentDayDispersionRateData({stationDn:t}),e.isBefore(n)?this.setState({dateRange:[g()(n),g()()]}):this.setState({dateRange:[e,g()()]}),this.setState({dateRange:[e,g()()],showDatePicker:!1})}else if(\"sevenDaysAgo\"===e){const e=g()().subtract(6,\"days\");this.buttonGroupActiveId=1,this.getDispersionRateData({stationDn:t,startDay:e.format(\"YYYY-MM-DD\"),endDay:g()().format(\"YYYY-MM-DD\")}),e.isBefore(n)?this.setState({dateRange:[e,g()()]}):this.setState({dateRange:[g()(n),g()()]}),this.setState({showDatePicker:!1})}else this.buttonGroupActiveId=2,this.setState({showDatePicker:!0})},this.handleSearchButtonClick=()=>{const{customSearchTimeRange:e,stationDn:t}=this.state;e&&2===this.buttonGroupActiveId?this.getDispersionRateData({startDay:e[0],endDay:e[1],stationDn:t}):0===this.buttonGroupActiveId?this.getRecentDayDispersionRateData({stationDn:t}):this.getDispersionRateData({startDay:g()().subtract(6,\"days\").format(\"YYYY-MM-DD\"),endDay:g()().format(\"YYYY-MM-DD\"),stationDn:t})},this.clearSelectedData=()=>{if(!this.chartData.selectedData)return;const{dispersionRateData:e}=this.state,{series:t,dataIndex:n}=this.chartData.selectedData;e.rateList[t][n].itemStyle={}},this.clearSelectedSeries=()=>{const{dispersionRateData:e}=this.state;this.chartData.selectedSeries=null,this.setSplitAreaColor(e.date)},this.setSplitAreaColor=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const{selectedSeries:n}=t.chartData,r=new Array(e.length).fill(\"transparent\");null!==n&&(r[n]=\"rgba(10, 89, 247, 0.1)\"),t.chartData.splitArea.areaStyle.color=r},this.resetChart=()=>{this.chartData={...this.chartData,options:{},selectedData:null,selectedSeries:null,zoomStart:null,zoomEnd:null,splitArea:{show:!0,areaStyle:{}}},this.clearSelectedData(),this.clearSelectedSeries()},this.handleChartInit=e=>{const t=e.getZr(),{onChartChunkClick:n,onChartStickClick:r}=this.props;e.on(\"click\",(t=>{const{dispersionRateData:n}=this.state,{options:i,selectedData:o}=this.chartData,{seriesIndex:a,dataIndex:s}=t;if(this.clearSelectedSeries(),o){const{series:e,dataIndex:t}=o;n.rateList[e][t].itemStyle={}}else this.chartData.selectedData={};n.rateList[a][s].itemStyle={borderColor:\"#000000\"},this.chartData.selectedData={series:a,dataIndex:s},i&&e.setOption(i);const c=t.data.dn,u=n.date[s];(0,l.mf)(r)&&r(u,c)})),t.on(\"click\",(t=>{if(t.target)return;this.clearSelectedData();const r=[t.offsetX,t.offsetY];if(e.containPixel(\"grid\",r)){const r=e.convertFromPixel({seriesIndex:0},[t.offsetX,t.offsetY]),{dispersionRateData:i}=this.state;if(!r)return;const o=r[0],a=i.date[o],s=i.rateList.map((e=>{var t;return null===(t=e[0])||void 0===t?void 0:t.dn}))[0];this.chartData.selectedSeries=o,this.setSplitAreaColor(i.date),e.setOption(this.chartData.options),(0,l.mf)(n)&&n(a,s)}}))},this.state={earliestMoment:null,stationNameMap:{},stationOptions:[],customSearchTimeRange:null,dispersionRateData:{},showDatePicker:!1,stationDn:\"\",dateRange:[]}}componentDidUpdate(e){const{defaultSelectStations:t,stationNameMap:n,stationOptions:r,isOperation:i}=this.props;var o;t===e.defaultSelectStations&&r===e.stationOptions||this.setState({stationDn:i?null==t||null===(o=t.map((e=>e.value)))||void 0===o?void 0:o[0]:t,stationOptions:r},(()=>{let e=this.state.stationDn;this.getRecentDayDispersionRateData({stationDn:e})})),n!==e.stationNameMap&&this.setState({stationNameMap:n})}dispersionHistoryChartLegendShow(){return Object.values(x).slice(0,5).filter((e=>\"good\"!==e)).map((e=>(0,R.jsxs)(\"div\",{className:\"dispersion-rate-chart-bottom-tip\",children:[(0,R.jsx)(\"span\",{className:`sign ${e}`}),(0,R.jsxs)(\"span\",{children:[\" \",B[e],\" \"]})]})))}render(){const{dispersionRateData:e,showDatePicker:t,dateRange:n,stationOptions:r}=this.state,{intl:i,defaultSelectStations:o,isOperation:a}=this.props;this.setSplitAreaColor(e.date);const m={xAxis:e.date||[],yData:e.rateList||[],splitArea:this.chartData.splitArea,intl:i};return(0,R.jsxs)(\"div\",{className:\"nco-dispersion-history\",children:[(0,R.jsxs)(\"div\",{className:\"header\",children:[(0,R.jsxs)(\"div\",{className:\"left-area\",children:[(0,R.jsx)(\"span\",{className:\"title header-item\",children:i.formatMessage({id:\"neteco.pvms.dispersionRate.dispersionRateTrend\"})}),(0,R.jsx)(c.Z,{placement:\"right\",overlayClassName:\"nco-inverter-dispersion-tooltip\",overlayStyle:{width:\"25rem\",maxWidth:\"none\"},title:i.formatMessage({id:\"neteco.pvms.dispersionRate.tip2\"}),children:(0,R.jsx)(\"i\",{className:\"icon-pv-status-unrecognized\"})})]}),(0,R.jsxs)(\"div\",{className:\"right-area\",children:[(0,R.jsxs)(u.Z,{type:\"capsule\",style:{width:\"auto\"},onTabClick:this.handleButtonGroupOnClick,children:[(0,R.jsx)(u.Z.TabPane,{tab:i.formatMessage({id:\"neteco.pvms.map.stationInfoWin.currentDay\"})},\"today\"),(0,R.jsx)(u.Z.TabPane,{tab:i.formatMessage({id:\"neteco.pvms.station.overview.select3\"})},\"sevenDaysAgo\"),(0,R.jsx)(u.Z.TabPane,{tab:i.formatMessage({id:\"neteco.pvms.partials.main.dm.devStringDetail.selfDefine\"})},\"customDays\")]}),t&&(0,R.jsx)(d.Z.RangePicker,{className:\"header-item header-item-flex range-picker\",disabledDate:this.disabledOccurTime,suffixIcon:(0,R.jsx)(\"span\",{className:\"range-date icon-calendar-lined\"}),onChange:e=>this.changeOccurTime(e),onCalendarChange:e=>this.getRangeTime(e),locale:i.locale,value:n}),(0,R.jsx)(p.Z,{className:\"header-item search-button\",type:\"primary\",onClick:this.handleSearchButtonClick,children:(0,R.jsx)(v.Z,{id:\"common.button.search\"})})]})]}),a&&(0,R.jsx)(\"div\",{className:\"toolbar nco-aiboost-dispersion-history-toolbar\",children:(0,R.jsxs)(\"div\",{className:\"left-area\",children:[(0,R.jsxs)(\"label\",{className:\"label toolbar-item\",children:[\" \",i.formatMessage({id:\"ncoAddSubjectReportForm.form.siteName\"}),\" \"]}),(0,R.jsx)(Z,{className:\"toolbar-item\",options:r,maxCount:1,maxTagCount:1,contentStyle:{minWidth:\"20rem\"},showArrow:!0,allowClear:!0,onChange:e=>this.setState({stationDn:e.map((e=>e.value))[0]}),defaultValue:o})]})}),(0,R.jsxs)(\"div\",{className:\"nco-dispersion-dispersion-history-chart-area\",children:[(0,R.jsx)(\"div\",{className:\"history-bar-chart-area\",children:(0,h.isEmptyObject)(e)?(0,R.jsx)(s.Z,{className:\"nco-chart-loading\",size:\"middle\"}):(0,R.jsx)(f.Z,{notMerge:!0,style:{width:\"100%\"},options:(()=>{const e=(e=>{let{xAxis:t,yData:n,intl:r,getWhichStation:i,splitArea:o,...a}=e;const s=(e,t)=>t===P||t===I?C[M].color:C[A(e,1)].color;let c=n.map(((e,t)=>{var n;return{name:null===(n=e[0])||void 0===n?void 0:n.name,type:\"bar\",barWidth:\"14%\",barMaxWidth:32,barMinHeight:4,data:e,yAxisIndex:0,tooltip:{valueFormatter:e=>\"-\"!==e?Number(e)+\"%\":e},itemStyle:{color:e=>e.data.type===I||e.data.type===P?\"transparent\":s(Number(e.value),e.data.type),barBorderRadius:[2,2,0,0]}}}));return(!c||c.length<=0)&&(c=[{data:[]}]),{tooltip:{trigger:\"axis\",borderRadius:8,formatter:e=>(e=>{let t=\"\";const n=(0,l.mf)(i)?i():null;if(null!==n){const{axisValue:i,data:o}=e[n];if(0===o.type)return\"\";t=`\\n        <div class=\"dispersion-rate-chart-tooltip single\">\\n          <p class=\"size-small\">${i.replaceAll(\"-\",\"/\")}</p>\\n          <p ><span>${o.name}</span>\\n          <span \\n            style=\"color:${s(Number(o.value),o.type)}\"\\n          >${0===o.value?\"0%\":o.value.toFixed(2)+\"%\"}</span>\\n          </p>\\n          <p class=\"size-small\" style=\"color:#111A2C66\">${r.formatMessage({id:\"neteco.pvms.dispersionRate.deviationStatistics\"})}</p>\\n      `,o.summary&&o.summary.forEach((e=>{\"undefined\"!==e.type?t+=`<p>\\n              <span class=\"color-gray\">${e.type}</span>\\n              <span class=\"color-white\">${e.count}${\"zh-CN\"===r.locale||\"zh-TW\"===r.locale?\"台\":\"\"}</span>\\n              </p>`:t+=`<p>\\n              <span class=\"color-gray\">${r.formatMessage({id:\"neteco.pvms.dispersionRate.titp.21\"})}</span>\\n              <span class=\"color-white\">${e.count}${\"zh-CN\"===r.locale||\"zh-TW\"===r.locale?\"台\":\"\"}</span>\\n              </p>`})),t+=\"</div>\"}else{let n=\"\";e.forEach((e=>{const{name:t,value:r,type:i}=e.data;n+=i===D?`<p>\\n            <span>${t}</span>\\n            <span style=\"color:${s(Number(r),i)}\">${(0,O.af)(r.toFixed(2))+\"%\"}\\n            </span>\\n            </p>`:`<p><span>${t}</span><span style=\"color:${s(Number(r),i)}\">${E.lH}</span></p>`})),t=`\\n        <div class=\"dispersion-rate-chart-tooltip all\">\\n          <p class=\"size-small color-gray\">${e[0].axisValue.replaceAll(\"-\",\"/\")}</p>\\n          ${n}\\n        </div>\\n      `}return t})(e),position:e=>{const[t,n]=e,r=window.innerWidth-t;return n<145?r<=280?{right:r,top:n}:{left:t,top:n}:r<=280?{right:r}:void 0}},legend:{show:!1},grid:{left:0,right:0,bottom:\"10%\",containLabel:!0},xAxis:[{data:t,axisLabel:{formatter:(e,t)=>g()(e).format(\"MM/DD\")},splitArea:o}],dataZoom:[{show:!1}],series:c,emphasis:{focus:\"series\"}}})(m);return this.chartData.options=e,e})(),onInit:e=>this.handleChartInit(e),leftYaxis:i.formatMessage({id:\"neteco.pvms.dispersionRate.equipmentDailyDispersionRate\"})})}),(0,R.jsx)(\"div\",{className:\"nco-dispersion-dispersion-history-chart-area-style\",children:this.dispersionHistoryChartLegendShow()})]})]})}}const z=(0,o.ZP)(F);var V=n(52883),H=n(39986),U=n(44851),G=n(33734);class Y extends i.Component{constructor(){var e;super(...arguments),e=this,this.state={allChecked:!1,indeterminate:!1},this.preventMouseDown=e=>{e.preventDefault(),e.stopPropagation()},this.chartSearchSelectTagRender=e=>{const{valueMap:t}=this.props,{label:n,value:r,closable:i,onClose:o}=e;return(0,R.jsx)(H.Z,{onMouseDown:this.preventMouseDown,closable:i,className:\"search-select-tag\",onClose:o,children:t[r]})},this.disabledOptions=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const{options:n=[],disabledInfo:r}=e.props,i={};return t.forEach((e=>i[e]=!0)),n.forEach((e=>{i[e.value]||(e.disabled=!0,e.originLabel||(e.originLabel=e.label),e.label=(0,R.jsx)(c.Z,{trigger:\"hover\",title:r,children:e.originLabel}))})),n},this.releaseOptions=()=>{const{options:e=[]}=this.props;return e.forEach((e=>{e.disabled=!1,e.originLabel&&(e.label=e.originLabel)})),e},this.renderOptions=()=>{const{value:e=[],maxCount:t=1/0,options:n=[]}=this.props;return e.length>=t?this.disabledOptions(e):e.length===t-1?this.releaseOptions():n},this.onchange=e=>{const{onChange:t,options:n}=this.props;e.length===n.length?this.setState({allChecked:!0,indeterminate:!1}):e.length>0&&e.length<n.length?this.setState({indeterminate:!0}):this.setState({indeterminate:!1,allChecked:!1}),t&&t(e)},this.handleAllCheck=e=>{if(e.stopPropagation(),\"SPAN\"===e.target.nodeName)return;const{options:t,value:n}=this.props,r=t.map((e=>e.value));n.length<r.length?this.onchange(r):this.onchange([])},this.displayMenu=e=>{const{allCheck:t=!1,intl:n}=this.props,{allChecked:r,indeterminate:i}=this.state;return t?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(\"div\",{className:\"allcheck-checkbox-wrapper\",onMouseEnter:e=>{var t;const n=null===(t=e.target.parentNode)||void 0===t?void 0:t.querySelectorAll(\".dpdesign-select-item.dpdesign-select-item-option\");if(n)for(let t=0;t<n.length;t++){const r=n[t];if(r.classList.contains(\"dpdesign-select-item-option-active\")){e.target.selectedIndex=t,r.classList.remove(\"dpdesign-select-item-option-active\");break}}},onMouseLeave:e=>{var t;const n=null===(t=e.target.parentNode)||void 0===t?void 0:t.querySelectorAll(\".dpdesign-select-item.dpdesign-select-item-option\"),r=e.target.selectedIndex;\"number\"==typeof r&&n&&n[r].classList.add(\"dpdesign-select-item-option-active\")},onClick:this.handleAllCheck,children:(0,R.jsx)(_.Z,{checked:r,indeterminate:i,children:n.formatMessage({id:\"neteco.pvms.common.selectAll\"})})}),e]}):e}}componentDidMount(){const{getRef:e}=this.props;\"function\"==typeof e&&e(this)}reset(){this.setState({indeterminate:!1,allChecked:!1})}render(){const{mode:e,style:t,maxTagCount:n=1/0,className:r,valueMap:i,value:o=[],showArrow:a=!0,allowClear:s=!1,showSearch:l=!1}=this.props,c=this.renderOptions();return(0,R.jsx)(j.Z,{allowClear:s,showSearch:l,showArrow:a,className:`special-select ${r}`,mode:e,style:t,options:c,maxTagCount:n,tagRender:i?this.chartSearchSelectTagRender:null,onChange:this.onchange,value:o,dropdownRender:this.displayMenu})}}const W=(0,o.ZP)(Y);var K=n(55751),q=n(51523),Q=n.n(q),X=n(59005);const{LEVEL_UNKNOWN:J}=x,{NOT_ANALYZED:$,VALID_DATA:ee,NO_DATA:te}=S,{LEVEL_TERRIBLE:ne,LEVEL_BAD:re,LEVEL_NORMAL:ie,LEVEL_GOOD:oe,LEVEL_EXCELLENT:ae,LEVEL_UNKNOWN:se}=x,{TIP_RANGE:le,TIP_DESC:ce,TIP_STRING_RANGE:ue}=w;class de extends i.Component{constructor(e){super(e),this.type=0}render(){const{intl:e}=this.props;this.type=this.props.type;const t=t=>0===this.type?`${le[t]} ${e.formatMessage({id:ce[t]})}`:t===se?e.formatMessage({id:ue[se]}):ue[t];return(0,R.jsx)(\"span\",{className:\"nco-dispersion-tooltip\",children:(0,R.jsx)(c.Z,{placement:\"bottom\",overlayClassName:\"nco-inverter-dispersion-tooltip\",overlayStyle:{minWidth:\"10rem\"},overlayInnerStyle:{color:\"#191919\"},color:\"#ffffff\",title:(0,R.jsx)(X.Z,{bordered:!1,className:\"nco-dispersion-tooltip-card\",children:0===this.type?Object.keys(le).map((e=>(0,R.jsxs)(\"div\",{className:\"column-tip-line\",children:[(0,R.jsx)(\"span\",{className:`status-circle ${e}`}),(0,R.jsx)(\"span\",{className:\"tip-content\",children:t(e)})]}))):Object.keys(ue).map((e=>(0,R.jsxs)(\"div\",{className:\"column-tip-line\",children:[(0,R.jsx)(\"span\",{className:`status-circle ${e}`}),(0,R.jsx)(\"span\",{className:\"tip-content\",children:t(e)})]})))}),children:(0,R.jsx)(\"i\",{className:\"icon-pv-status-unrecognized\"})})})}}const pe=(0,o.ZP)(de),{LEVEL_TERRIBLE:fe,LEVEL_BAD:he,LEVEL_NORMAL:me,LEVEL_GOOD:ge,LEVEL_EXCELLENT:ve,LEVEL_UNKNOWN:ye}=x,{TIP_RANGE:be,TIP_DESC:Se}=w;class xe extends i.Component{constructor(e){var t;super(e),t=this,this.buttonGroupActiveId=0,this.initDeviationHistory=async()=>{const e=await this.updateInverterInfos();this.getDiagDetail({invDn:e.inverterDn,startDay:e.statDay,endDay:e.statDay,stationDn:e.stationDn})},this.updateInverterInfos=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{inverterDn:r,updateInverterInfo:i,stationDn:o}=t.props,{deviationHistoryList:a}=t.state;let s={};if(e<0||!a[e]){const e=await t.getDeviationHistory({...n,invDn:r,stationDn:o});e.length>0&&t.setState({deviationHistoryList:e},(()=>{s=e[e.length-1],i(s)}))}else s=a[e];return t.setState({selectedDeviationData:s}),s},this.getDeviationHistory=async e=>{const t={startDay:g()().format(\"YYYY-MM-DD\"),endDay:g()().format(\"YYYY-MM-DD\"),...e},n=await(0,N.jw)(t);return this.resetChart(),n},this.getDiagDetail=async e=>{this.setState({showTableLoading:!0});const t=await(0,N.NL)({...e});t&&this.setState({stringDiagDetail:t,pvDeviationData:{page:1,pageSize:5,total:t.length,list:t}}),this.setState({showTableLoading:!1})},this.loadPvDeviationData=e=>{let{current:t=1,pageSize:n=5}=e;const{stringDiagDetail:r}=this.state;this.setState({pvDeviationData:{page:t,pageSize:n,total:r.length,list:r}})},this.changeOccurTime=e=>{e?this.setState({customSearchTimeRange:[e[0].format(\"YYYY-MM-DD\"),e[1].format(\"YYYY-MM-DD\")],dateRange:[e[0],e[1]]}):this.setState({customSearchTimeRange:null,dateRange:[]})},this.getRangeTime=e=>{this.setState({dateRange:e})},this.disabledOccurTime=e=>{var t;if(!this.state.dateRange)return!1;const n=this.state.dateRange[0]&&(null==e?void 0:e.diff(this.state.dateRange[0],\"days\"))>=7;return this.state.dateRange[1]&&(null===(t=this.state.dateRange[1])||void 0===t?void 0:t.diff(e,\"days\"))>=7||n},this.handleButtonGroupOnClick=e=>{const{earliestDate:t}=this.props;if(\"today\"===e){const e=g()();this.buttonGroupActiveId=0,this.updateInverterInfos(),e.isBefore(t)?this.setState({dateRange:[g()(t),g()()]}):this.setState({dateRange:[e,g()()]})}else if(\"sevenDaysAgo\"===e){const e=g()().subtract(6,\"days\");this.buttonGroupActiveId=1,this.updateInverterInfos(-1,{startDay:e.format(\"YYYY-MM-DD\"),endDay:g()().format(\"YYYY-MM-DD\")}),e.isBefore(t)?this.setState({dateRange:[g()(t),g()()]}):this.setState({dateRange:[e,g()()]}),this.setState({showDatePicker:!1})}else this.buttonGroupActiveId=2,this.setState({showDatePicker:!0})},this.handleSearchButtonClick=()=>{const{customSearchTimeRange:e}=this.state;e&&2===this.buttonGroupActiveId?this.updateInverterInfos(-1,{startDay:e[0],endDay:e[1]}):0===this.buttonGroupActiveId?this.updateInverterInfos():this.updateInverterInfos(-1,{startDay:g()().subtract(6,\"days\").format(\"YYYY-MM-DD\"),endDay:g()().format(\"YYYY-MM-DD\")})},this.handleBarChartInit=e=>{e.on(\"click\",(async e=>{const t=await this.updateInverterInfos(e.dataIndex);this.setState({selectedDataIndex:e.dataIndex}),this.getDiagDetail({invDn:t.inverterDn,startDay:t.statDay,endDay:t.statDay,stationDn:t.stationDn})}))},this.resetChart=()=>{this.setState({selectedDataIndex:null})},this.commonRender=e=>(0,O.s)(e)||(0,l.xb)(e)?E.lH:(0,O.af)(e),this.state={moDn:\"\",userCompany:\"\",showTableLoading:!0,tableHeight:280,showDatePicker:!1,modalExists:!1,deviationHistoryList:[],selectedDeviationData:{},stringDiagDetail:{inverterPvsInfo:[]},pvDeviationData:{page:1,pageSize:5,total:0,list:[]},dateRange:[],customSearchTimeRange:null,selectedDataIndex:null}}componentDidMount(){this.initDeviationHistory()}pvStringDeviationTableColumn(e){return[{title:e.formatMessage({id:\"neteco.pvms.partials.main.configuration.name\"}),dataIndex:\"pvName\",key:\"pvName\"},{title:e.formatMessage({id:\"neteco.pvms.license.syncInfo.totalCapacity\"})+\"(Wp)\",dataIndex:\"installPower\",key:\"installPower\",render:e=>this.commonRender(e)},{title:e.formatMessage({id:\"neteco.pvms.dispersionRate.stringDetail.averageInputVoltage\"})+\"(V)\",dataIndex:\"averageVoltage\",key:\"averageVoltage\",render:e=>this.commonRender(e)},{title:e.formatMessage({id:\"neteco.pvms.dispersionRate.stringDetail.averageInputCurrent\"})+\"(A)\",dataIndex:\"averageCurrent\",key:\"averageCurrent\",render:e=>this.commonRender(e)},{title:(0,R.jsxs)(\"span\",{children:[this.props.intl.formatMessage({id:\"neteco.pvms.dispersionRate.table.deviationRatio\"}),(0,R.jsx)(pe,{type:0})]}),dataIndex:\"deviationVal\",key:\"deviationVal\",render:e=>(0,O.s)(e)||(0,l.xb)(e)?E.lH:(0,R.jsx)(H.Z,{className:`dispersion-rate-tag ${A(Number(e))}`,style:{borderRadius:\"4px\"},children:(0,O.af)(Number(e).toFixed(2))})}]}chartDataShow(e,t,n){return{xAxis:e.map((e=>e.statDay)),yAxis:e.map((e=>{const t=Number(e.deviationValStr);return(0,O.s)(t)||(0,l.xb)(t)?0:t>0?Math.min(50,t):Math.max(-50,t)})),intl:t,selectedDataIndex:n}}tabPaneSwitch(e){return(0,R.jsxs)(u.Z,{type:\"capsule\",style:{width:\"auto\"},onTabClick:this.handleButtonGroupOnClick,children:[(0,R.jsx)(u.Z.TabPane,{tab:e.formatMessage({id:\"neteco.pvms.map.stationInfoWin.currentDay\"})},\"today\"),(0,R.jsx)(u.Z.TabPane,{tab:e.formatMessage({id:\"neteco.pvms.station.overview.select3\"})},\"sevenDaysAgo\"),(0,R.jsx)(u.Z.TabPane,{tab:e.formatMessage({id:\"neteco.pvms.partials.main.dm.devStringDetail.selfDefine\"})},\"customDays\")]})}deviationCarsdDataShow(e,t,n){return(0,R.jsxs)(\"div\",{className:\"statistic-data\",children:[(0,R.jsxs)(\"span\",{className:\"value\",style:{color:C[e].color},children:[isNaN(Number(t))?E.lH:(0,O.af)(t),(0,R.jsx)(\"span\",{className:\"suffix\",children:`${e===ye?\"\":\"%\"}(${n.formatMessage({id:Se[e]})})`})]}),(0,R.jsxs)(\"span\",{className:\"title\",children:[\" \",n.formatMessage({id:\"neteco.pvms.dispersionRate.table.deviationRatio\"}),\" \"]})]})}stringDetailCurrentDateCardShow(e,t){return(0,R.jsxs)(\"div\",{className:\"statistic-data\",children:[(0,R.jsx)(\"span\",{className:\"value\",children:e.replaceAll(\"-\",\"/\")||\"--\"}),(0,R.jsxs)(\"span\",{className:\"title\",children:[\"  \",t.formatMessage({id:\"neteco.pvms.dispersionRate.stringDetail.currentDate\"}),\" \"]})]})}dispersionHistoryChartLegendShow(e){return Object.values(x).slice(0,4).map((t=>(0,R.jsxs)(\"div\",{className:\"dispersion-rate-chart-bottom-tip\",children:[(0,R.jsx)(\"span\",{className:`sign ${t}`}),(0,R.jsxs)(\"span\",{children:[\" \",be[t],\" \",e.formatMessage({id:Se[t]}),\" \"]})]})))}render(){const{intl:e}=this.props,{selectedDeviationData:t,deviationHistoryList:n,pvDeviationData:r,showDatePicker:i,showTableLoading:o,dateRange:a,selectedDataIndex:l}=this.state,c=this.chartDataShow(n,e,l),u=this.pvStringDeviationTableColumn(e),{statDay:m=\"\",deviationValStr:y}=t,b=A(Number(y));return(0,R.jsxs)(\"div\",{className:\"nco-dispersion-deviation-detail-view\",children:[(0,R.jsxs)(\"div\",{className:\"nco-dispersion-deviation-detail-history\",children:[(0,R.jsxs)(\"div\",{className:\"header\",children:[(0,R.jsxs)(\"div\",{className:\"left-area\",children:[(0,R.jsx)(\"span\",{className:\"header-item title\",children:e.formatMessage({id:\"neteco.pvms.dispersionRate.deviationRatioTrend\"})}),(0,R.jsx)(pe,{type:0})]}),(0,R.jsxs)(\"div\",{className:\"right-area\",children:[this.tabPaneSwitch(e),i&&(0,R.jsx)(d.Z.RangePicker,{className:\"header-item header-item-flex range-picker\",disabledDate:this.disabledOccurTime,suffixIcon:(0,R.jsx)(\"span\",{className:\"range-date icon-calendar-lined\"}),onChange:e=>this.changeOccurTime(e),onCalendarChange:e=>this.getRangeTime(e),locale:e.locale,value:a}),(0,R.jsx)(p.Z,{className:\"header-item search-button\",type:\"primary\",onClick:this.handleSearchButtonClick,children:(0,R.jsx)(v.Z,{id:\"common.button.search\"})})]})]}),(0,R.jsxs)(\"div\",{className:\"statistic-area\",children:[(0,R.jsx)(X.Z,{bordered:!1,className:\"statistic-card\",children:this.stringDetailCurrentDateCardShow(m,e)}),(0,R.jsx)(X.Z,{bordered:!1,className:\"statistic-card\",children:this.deviationCarsdDataShow(b,y,e)})]}),(0,R.jsxs)(\"div\",{className:\"nco-dispersion-dispersion-history-chart-area\",children:[(0,R.jsx)(\"div\",{className:\"history-bar-chart-area\",children:(0,h.isEmptyObject)(n)?(0,R.jsx)(s.Z,{className:\"nco-chart-loading\",size:\"middle\"}):(0,R.jsx)(f.Z,{notMerge:!0,style:{width:\"100%\",height:\"18rem\"},options:(()=>{const e=(e=>{let{xAxis:t,yAxis:n,intl:r,selectedDataIndex:i,...o}=e;return{tooltip:!1,legend:{show:!1},grid:{left:0,right:\"1%\",bottom:\"10%\",containLabel:!0},xAxis:[{data:t,axisLabel:{formatter:(e,t)=>g()(e).format(\"MM/DD\")}}],dataZoom:[{show:!1}],series:{name:\"deviation\",type:\"bar\",barWidth:\"14%\",barMinHeight:4,barMaxWidth:32,data:n.map(((e,t)=>t===i?{value:e,itemStyle:{borderColor:\"#000000\"}}:e)),itemStyle:{color:e=>{return e.data.type===te||e.data.type===$?\"transparent\":(t=Number(e.value),(n=e.data.type)===$||n===te?C[J].color:C[A(t)].color);var t,n},barBorderRadius:[2,2,2,2]}}}})(c);return this.chartOptions=e,e})(),onInit:this.handleBarChartInit,leftYaxis:e.formatMessage({id:\"neteco.pvms.dispersionRate.table.deviationRatio\"})})}),(0,R.jsx)(\"div\",{className:\"nco-dispersion-dispersion-history-chart-area-style\",children:this.dispersionHistoryChartLegendShow(e)})]})]}),(0,R.jsxs)(\"div\",{className:\"nco-dispersion-deviation-table nco-dispersion-deviation-detail-table\",children:[(0,R.jsx)(\"div\",{className:\"header\",style:{marginBottom:\"20px\"},children:(0,R.jsxs)(\"div\",{className:\"left-area\",children:[(0,R.jsxs)(\"span\",{className:\"header-item title\",children:[\" \",e.formatMessage({id:\"neteco.pvms.partials.main.dm.stringDetail\"}),\" \"]}),(0,R.jsxs)(\"span\",{className:\"header-item info\",children:[(0,R.jsxs)(\"span\",{children:[e.formatMessage({id:\"neteco.pvms.aifc.statisticTime.fie\"}),\":\"]}),(0,R.jsx)(\"span\",{className:\"valueDate\",children:m.replaceAll(\"-\",\"/\")||\"--\"})]})]})}),(0,R.jsx)(G.Z,{rowClassName:\"deviation-table-row\",columns:u,dataSource:r.list,pagination:{current:r.page,pageSize:r.pageSize,total:r.total,pageSizeOptions:[5,10,20,30],totalFixedLeft:!0,size:\"default\",showQuickJumper:!0,showSizeChanger:!0,showTotal:t=>e.formatMessage({id:\"neteco.pvms.station.subarray.pagination.total\"},{total:r.total})},onChange:this.loadPvDeviationData,loading:o,locale:{emptyText:o?\" \":\"\"},scroll:{y:230}})]})]})}}const we=(0,o.ZP)(xe);var Ce=n(36329),Te=n(12674),Ae=n(36513),Ee=n(41779);class Oe extends i.Component{render(){const{inverterInfo:e,intl:t}=this.props;return(0,R.jsx)(Ce.ZP,{dataSource:[{title:e.inverterName,logo:\"/pvmswebsite/assets/build/twaver/images/svg/dp_Inverter_filled.svg\",power:e.ratedPowerStr,capacity:e.installPowerStr}],renderItem:e=>(0,R.jsx)(Ce.ZP.Item,{children:(0,R.jsx)(Ce.ZP.Item.Meta,{title:e.title,description:(0,R.jsxs)(\"span\",{className:\"description-label\",children:[(0,R.jsx)(\"span\",{style:{color:\"#111A2C99\"},children:t.formatMessage({id:\"neteco.pvms.ncomonitor.station.ratedPower\"})}),(0,R.jsxs)(\"span\",{style:{color:\"#111A2CE5\"},children:[isNaN(Number(e.power))?E.lH:(0,O.af)(e.power),\" \",t.formatMessage({id:\"neteco.pvms.unit.kWUnit\"})]}),(0,R.jsx)(Ee.Z,{type:\"vertical\"}),(0,R.jsx)(\"span\",{style:{color:\"#111A2C99\"},children:t.formatMessage({id:\"ncoHomeSiteList.columns.siteCapacity\"})}),(0,R.jsxs)(\"span\",{style:{color:\"#111A2CE5\"},children:[isNaN(Number(e.capacity))?E.lH:(0,O.af)(e.capacity),\" \",t.formatMessage({id:\"neteco.pvms.unit.kWpUnit\"})]})]}),avatar:(0,R.jsx)(Te.C,{style:{background:\"#111A2C0C\",display:\"flex\",alignItems:\"center\",justifyContent:\"center\"},size:48,src:(0,R.jsx)(Ae.Z,{preview:!1,src:e.logo,style:{size:32}})})})})})}}const Me=(0,o.ZP)(Oe),{LEVEL_TERRIBLE:Pe,LEVEL_BAD:De,LEVEL_NORMAL:Ie,LEVEL_GOOD:Ne,LEVEL_EXCELLENT:_e,LEVEL_UNKNOWN:je}=x,{TIP_RANGE:ke,TIP_DESC:Le}=w;class Re extends i.Component{constructor(e){var t;super(e),t=this,this.ivAppointmentRef=i.createRef(),this.specialSelect=null,this.deviationTableSelectOptions=[{value:Pe,label:`${ke[Pe]} ${this.props.intl.formatMessage({id:Le[Pe]})}`,key:Pe},{value:De,label:`${ke[De]} ${this.props.intl.formatMessage({id:Le[De]})}`,key:De},{value:Ie,label:`${ke[Ie]} ${this.props.intl.formatMessage({id:Le[Ie]})}`,key:Ie},{value:Ne,label:`${ke[Ne]} ${this.props.intl.formatMessage({id:Le[Ne]})}`,key:Ne},{value:_e,label:`${ke[_e]} ${this.props.intl.formatMessage({id:Le[_e]})}`,key:_e},{value:je,label:this.props.intl.formatMessage({id:Le[je]}),key:je}],this.selectOptionsMap=(()=>{const e={};return this.deviationTableSelectOptions.forEach((t=>t.value!==je?e[t.value]=ke[t.value]:e[t.value]=this.props.intl.formatMessage({id:Le[je]}))),e})(),this.dispersionRateDetailTableConfigItems={deviationTableColumns:[{title:this.props.intl.formatMessage({id:\"neteco.pvms.dispersionRate.DeviceName\"}),dataIndex:\"inverterName\",key:\"inverterName\"},{title:this.props.intl.formatMessage({id:\"ncoInverterTable.column.site\"}),dataIndex:\"stationName\",key:\"stationName\"},{title:this.props.intl.formatMessage({id:\"neteco.pvms.dispersionRate.table.ratedPower\"}),dataIndex:\"ratedPower\",key:\"ratedPower\",render:(e,t)=>(0,O.s)(t.installPower)||(0,l.xb)(t.installPower)?E.lH+\"/\"+(0,O.af)(t.ratedPower):(0,O.af)(t.installPower)+\"/\"+(0,O.af)(t.ratedPower)},{title:this.props.intl.formatMessage({id:\"neteco.pvms.dispersionRate.table.dailyAveragePower\"}),dataIndex:\"dayAveragePower\",key:\"dayAveragePower\",render:(e,t)=>(0,O.s)(t.dayAveragePower)||(0,l.xb)(t.dayAveragePower)?E.lH:(0,O.af)(t.dayAveragePower)},{title:(0,R.jsxs)(\"span\",{children:[this.props.intl.formatMessage({id:\"neteco.pvms.dispersionRate.table.deviationRatio\"}),(0,R.jsx)(pe,{type:0})]}),dataIndex:\"deviationVal\",key:\"deviationVal\",sorter:!0,render:e=>(0,O.s)(e)||(0,l.xb)(e)?E.lH:(0,R.jsx)(H.Z,{className:`dispersion-rate-tag ${A(Number(e))}`,style:{borderRadius:\"4px\"},children:(0,O.af)(Number(e).toFixed(2))})},{title:(0,R.jsxs)(\"span\",{children:[this.props.intl.formatMessage({id:\"neteco.pvms.dispersionRate.table.stringdispersionRatio\"}),(0,R.jsx)(pe,{type:1})]}),dataIndex:\"pvDispersionVal\",key:\"pvDispersionVal\",sorter:!0,render:e=>(0,O.s)(e)||(0,l.xb)(e)?E.lH:(0,R.jsx)(\"span\",{style:{color:C[A(Number(e),1)].color},children:(0,O.af)(Number(e).toFixed(2))})},{title:this.props.intl.formatMessage({id:\"common.label.action\"}),dataIndex:\"action\",key:\"action\",render:(e,t)=>this.recordDetailAction(t)}]},this.setTableDeviationHeight=Q()((()=>{const e=(0,K.h)(\".left-content\",660);this.setState({tableHeight:e})}),300),this.getFormatIntervals=function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce(((e,t)=>e+(ke[t]||\"undefined\")+\",\"),\"\");return e.substring(0,e.length-1)},this.loadDeviationTableData=async(e,t,n)=>{e=e||{},n=n||{},t=t||{};const{currPage:r=1,pageSize:i=10}=t;this.setState({showTableLoading:!0});const{deviationTableSearchStatDay:o,deviationTableSearchDnArray:a}=this.state,{statDay:s=o,dnArray:c=a}=e,u=T,d={currPage:r,pageSize:i,statDay:s,stationDn:c};e[u]&&(d.intervals=this.getFormatIntervals(e[u])),\"deviationVal\"===n.orderBy&&n.sortOrder&&(d.orderBy=\"deviation\",d.sortOrder=(0,l.kk)(n.sortOrder)),\"pvDispersionVal\"===n.orderBy&&n.sortOrder&&(d.orderBy=\"pvDispersion\",d.sortOrder=(0,l.kk)(n.sortOrder));let p={data:{}};try{if(p=await(0,N.XT)(d),!p)return void this.setState({showTableLoading:!1})}catch(e){return void this.setState({showTableLoading:!1,deviationTableData:{currPage:1,pageSize:10,total:0,list:[]}})}const f=[];p.inverterDeviationList.map((e=>{f.push({deviationVal:e.deviationValStr,pvDispersionVal:e.pvDispersionValStr,inverterDn:e.inverterDn,inverterName:e.inverterName,ratedPower:e.ratedPowerStr,stationName:e.stationName,installPower:e.installPowerStr,dayAveragePower:e.dayAveragePowerStr})})),this.setState({deviationTableData:{currPage:r||1,pageSize:i||10,total:p.total,list:f,orderBy:d.orderBy,sortOrder:d.sortOrder,[u]:e[u]},showTableLoading:!1})},this.handleTableConfigChange=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t.loadDeviationTableData({},{currPage:e.current,pageSize:e.pageSize},{orderBy:n.field,sortOrder:n.order})},this.openNotification=(e,t)=>{t?V.Z[t](e):V.Z.open(e)},this.exportDeviationData=()=>{const{deviationTableData:e,deviationTableSearchStatDay:t,deviationTableSearchDnArray:n}=this.state;(0,N.j6)({currPage:e.currPage,pageSize:e.pageSize,statDay:t,stationDn:n,orderBy:e.orderBy,sortOrder:e.sortOrder,intervals:this.getFormatIntervals(e[T])})},this.showDeviationRateDetailModal=e=>{this.setState({modalExists:!0,selectedInverterInfo:e.info})},this.hideViewModal=()=>{this.setState({modalExists:!1})},this.state={showTableLoading:!1,deviationTableSearchStatDay:null,earliestMoment:null,deviationTableData:{currPage:1,pageSize:10,total:0,list:[],intervals:[]},deviationTableSearchStatDay:\"\",deviationTableSearchDnArray:\"\",selectedInverterInfo:{},searchIntervals:[],tableHeight:268}}recordDetailAction(e){return(0,R.jsx)(c.Z,{title:this.props.intl.formatMessage({id:\"neteco.pvms.partials.main.io.dm.op.detail\"}),overlayClassName:\"nco-inverter-dispersion-tooltip\",overlayInnerStyle:{color:\"#191919\"},color:\"#ffffff\",children:(0,R.jsx)(p.Z,{type:\"text\",icon:(0,R.jsx)(\"i\",{className:\"icon-detail-lined\"}),onClick:()=>this.showDeviationRateDetailModal({info:e})})})}componentDidMount(){this.setTableDeviationHeight(),window.addEventListener(\"resize\",this.setTableDeviationHeight)}componentWillUnmount(){window.removeEventListener(\"resize\",this.setTableDeviationHeight)}componentDidUpdate(e){const{searchConditions:t}=this.props,{deviationTableData:n,searchIntervals:r}=this.state;if(t!==e.searchConditions){const{statDay:e,dnArray:i}=t,{currPage:o,pageSize:a}=n;this.setState({deviationTableSearchStatDay:e,deviationTableSearchDnArray:i},(()=>{this.loadDeviationTableData({statDay:e,dnArray:i,[T]:r},{currPage:o,pageSize:a})}))}}specialSelectOptions(){return this.deviationTableSelectOptions.map((e=>({key:e.value,value:e.value,label:(0,R.jsxs)(\"span\",{className:\"special-select-options-label\",children:[\" \",e.label,\" \"]})})))}NcoDeviationDetailModal(e,t,n){return(0,R.jsx)(U.Z,{className:\"deviation-detail-modal\",title:(0,R.jsx)(Me,{inverterInfo:e}),width:\"87.5rem\",visible:t,onCancel:this.hideViewModal,destroyOnClose:!0,footer:null,maskClosable:!1,centered:!0,getContainer:!1,children:(0,R.jsx)(we,{earliestDate:n,inverterDn:e.inverterDn,updateInverterInfo:e=>this.setState({selectedInverterInfo:e}),stationDn:this.state.deviationTableSearchDnArray})})}render(){const{showTableLoading:e,deviationTableData:t,deviationTableSearchStatDay:n,selectedInverterInfo:r={},earliestMoment:i,modalExists:o,searchIntervals:a,tableHeight:s}=this.state,{intl:l}=this.props,{deviationTableColumns:u}=this.dispersionRateDetailTableConfigItems;return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)(\"div\",{className:\"nco-dispersion-deviation-table\",children:[(0,R.jsx)(\"div\",{className:\"header\",children:(0,R.jsxs)(\"div\",{className:\"left-area\",children:[(0,R.jsxs)(\"span\",{className:\"header-item title\",children:[l.formatMessage({id:\"neteco.pvms.dispersionRate.inverterOffsetDetail\"}),\" \"]}),(0,R.jsx)(c.Z,{placement:\"top\",overlayClassName:\"nco-inverter-dispersion-tooltip\",title:l.formatMessage({id:\"neteco.pvms.dispersionRate.tip3\"}),children:(0,R.jsx)(\"i\",{className:\"icon-pv-status-unrecognized\"})}),(0,R.jsxs)(\"span\",{className:\"header-item info\",children:[(0,R.jsxs)(\"span\",{children:[l.formatMessage({id:\"neteco.pvms.aifc.statisticTime.fie\"}),\":\"]}),(0,R.jsx)(\"span\",{className:\"valueDate\",children:null==n?void 0:n.replaceAll(\"-\",\"/\")})]})]})}),(0,R.jsxs)(\"div\",{className:\"toolbar nco-dispersion-deviation-table-toolbar\",children:[(0,R.jsxs)(\"div\",{className:\"left-area\",children:[(0,R.jsx)(\"label\",{className:\"label toolbar-item\",children:l.formatMessage({id:\"neteco.pvms.dispersionRate.offsetRange\"})}),(0,R.jsx)(W,{allCheck:!0,showSearch:!1,onChange:e=>this.setState({searchIntervals:e}),className:\"toolbar-item\",mode:\"multiple\",allowClear:!0,showArrow:!0,maxTagCount:2,style:{minWidth:\"20rem\"},getRef:e=>this.specialSelect=e,options:this.specialSelectOptions(),valueMap:this.selectOptionsMap,value:a}),(0,R.jsx)(p.Z,{type:\"primary\",className:\"toolbar-item\",onClick:e=>this.loadDeviationTableData({[T]:a}),children:l.formatMessage({id:\"common.button.search\"})}),(0,R.jsx)(p.Z,{className:\"toolbar-item\",onClick:e=>{this.setState({searchIntervals:[]}),this.specialSelect.reset(),this.loadDeviationTableData()},children:l.formatMessage({id:\"common.button.reset\"})})]}),(0,R.jsx)(\"div\",{className:\"right-area\",children:(0,R.jsx)(p.Z,{onClick:this.exportDeviationData,className:\"toolbar-item\",children:l.formatMessage({id:\"common.button.export\"})})})]}),(0,R.jsx)(G.Z,{rowClassName:\"deviation-table-row\",columns:u,dataSource:t.list,pagination:{current:t.currPage,pageSize:t.pageSize,total:t.total,pageSizeOptions:[5,10,20,30],totalFixedLeft:!0,size:\"default\",showQuickJumper:!0,showSizeChanger:!0,showTotal:e=>l.formatMessage({id:\"neteco.pvms.station.subarray.pagination.total\"},{total:t.total})},onChange:this.handleTableConfigChange,loading:e,locale:{emptyText:e?\" \":\"\"},scroll:{y:s}})]}),this.NcoDeviationDetailModal(r,o,i)]})}}const Ze=(0,o.ZP)(Re);var Be=n(65835);const{accessId:Fe,leaveId:ze,pageName:Ve}=a.e.inverterVariationPage;class He extends i.Component{constructor(e){var t;super(e),t=this,this.updateDeviationTableData=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"\",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:\"\";t.setState({deviationTableSearchConditions:{statDay:e,dnArray:n}})},this.getStationListData=async()=>{const e=await(0,N.jz)()||{};if(0===e.length)return[];const t={},n=e,r=n.map((e=>(t[e.stationDn]=e.stationName,{value:e.stationDn,label:e.stationName})));return this.setState({stationNameMap:t,stationOptions:r}),n},this.initOperationRateAnalysisInfo=async()=>{const e=g()(new Date).format(\"YYYY-MM-DD\"),t=await this.getStationListData();if(t){const n=t.slice(0,1).map((e=>e.stationDn));this.setState({defaultSelectStations:n.map((e=>({value:e,label:this.state.stationNameMap[e]}))),deviationTableSearchConditions:{statDay:e,dnArray:n[0]},dispersionEarliestMoment:e})}},this.initDispersionRateAnalysisInfo=async()=>{const{stationDn:e}=this.props,t=g()(new Date).format(\"YYYY-MM-DD\"),n=await(0,N.vP)(e);[].push(e);const r={};r[e]=n.stationName;const i=[{value:e,label:n.stationName}];this.setState({defaultSelectStations:e,deviationTableSearchConditions:{statDay:t,dnArray:e},dispersionEarliestMoment:t,stationNameMap:r,stationOptions:i})},this.state={dispersionEarliestMoment:null,stationNameMap:{},stationOptions:[],defaultSelectStations:this.props.stationDn,deviationTableSearchConditions:{dnArray:\"\",statDay:g()(new Date).format(\"YYYY-MM-DD\")}},this.startTime=Be.$.pageAccess(Fe,{pageName:Ve})}componentDidMount(){const{isOperation:e}=this.props;e?this.initOperationRateAnalysisInfo():this.initDispersionRateAnalysisInfo()}componentWillUnmount(){Be.$.pageLeave(this.startTime,ze,{pageName:Ve})}render(){const{stationOptions:e,dispersionEarliestMoment:t,deviationTableSearchConditions:n,defaultSelectStations:r,stationNameMap:i}=this.state;return(0,R.jsxs)(\"div\",{className:\"nco-aiboost-inverter-dispersion-rate-view\",children:[(0,R.jsx)(z,{onChartStickClick:this.updateDeviationTableData,onChartChunkClick:this.updateDeviationTableData,stationOptions:e,stationNameMap:i,earliestMoment:t,defaultSelectStations:r,isOperation:this.props.isOperation}),(0,R.jsx)(Ze,{earliestMoment:t,searchConditions:n})]})}}const Ue=(0,o.ZP)(He);var Ge=n(53309),Ye=n(33792),We=n(57350),Ke=n(15694),qe=n(41541),Qe=n(83862),Xe=n(29266),Je=n(90701),$e=n(45258),et=n(771),tt=n(4071),nt=n(39812),rt=n.n(nt),it=n(5807),ot=n(32402),at=n(20928),st=n(49453);const lt=async e=>(await(0,st.v_)(\"/rest/pvms/web/ivcurve/v1/device/query\",{dnList:[e],name:\"dispersion\",deviceType:\"inveter\"})).data;var ct=n(83621);const{neteco:ut}=window,dt=20800,{accessId:pt,leaveId:ft,pageName:ht}=a.e.stringVariationPage;class mt extends i.Component{constructor(e){super(e),this.formRef=i.createRef(),this.setTableHeight=Q()((()=>{const e=(0,K.h)(\".left-content\",550);this.setState({tableHeight:e})}),300),this.dnOver30Tips=()=>{this.setState({showTableLoading:!1}),$e.Z.destroyAll(),$e.Z.info({content:this.props.intl.formatMessage({id:\"neteco.pvms.dispersionRate.number.30\"})})},this.getTableDataHandle=e=>{var t;const n=[],r=[];var i;(null==e||null===(t=e.dnArray)||void 0===t?void 0:t.length)>30?this.dnOver30Tips():(i=e,(0,st.v_)(\"/rest/pvms/web/dispersion/v1/dev/ratio\",i)).then((e=>{if(e.success){const{scales:t}=e.data,{list:i,total:o}=e.data.pagedResults;this.setState({totally:o,scales:t,isShowEchart:!0,showTableLoading:!1}),i.forEach(((e,t)=>{const{pvCalcList:i}=e,o={};if(o.key=t,o.stationName=ut.util.iUnescape(e.stationName),o.deviceSn=e.deviceSn,o.deviceName=ut.util.iUnescape(e.deviceName),o.dispersion=(100*e.dispersion).toFixed(2),0===i.length)for(let e=1;e<=i.length;e++)o[`pv${e}`]=\"--\";else{const t=i.map((t=>(t.powerRateThreshold=e.powerRateThreshold,t)));for(let e=1;e<=i.length;e++)o[`pv${e}`]=t.map((t=>t.pvIndex===e?t:\"--\"))}n.push(o),r.push(i.length)}));const a=rt()(r);this.setState({tableData:n,maxPvNum:a,searchLoading:!1})}else this.setState({searchLoading:!1,showTableLoading:!1})}))},this.getTableDataRes=()=>{this.setState({intervalScale:null,currPage:1,searchStation:!0,searchLoading:!0});const{intl:e}=this.props,{currPage:t,pageSize:n,checkedDns:r,time:i,sort:o,Exceedlimit:a}=this.state;if(!a&&this.setState({showTableLoading:!0}),a)this.setState({showTableLoading:!1}),$e.Z.info({content:e.formatMessage({id:\"neteco.pvms.dispersionRate.number.30\"})});else{const e={currPage:t,pageSize:n,dnArray:r,statDay:i,order:o};this.getTableDataHandle(e)}},this.getTableDataPage=(e,t)=>{const{checkedDns:n,time:r,currPage:i,sort:o,Exceedlimit:a,searchStation:s}=this.state,l={currPage:0===e?i:e,pageSize:t,dnArray:n,statDay:r,order:o};!a&&this.setState({showTableLoading:!0}),this.state.intervalScale&&(l.intervalScale=this.state.intervalScale),this.setState({currPage:e,pageSize:t},(()=>{s&&this.getTableDataHandle(l),this.setState({showTableLoading:!1})}))},this.handleOption=(e,t)=>((e,t)=>({grid:{top:\"5%\",left:\"0%\",right:\"0%\",bottom:\"13%\",containLabel:!0},xAxis:{triggerEvent:!0,data:[t.formatMessage({id:\"neteco.pvms.dispersionRate.titp.20\"}),\"10%-20%\",\"5%-10%\",\"0%-5%\",t.formatMessage({id:\"neteco.pvms.dispersionRate.titp.21\"})],axisLabel:{color:\"#212121\",fontSize:\"14px\"}},yAxis:{type:\"value\",max:\"dataMax\",minInterval:1,barCategoryGap:\"40%\",axisLabel:{color:\"#666666\",fontSize:\"12px\"}},tooltip:{show:!0,trigger:\"axis\",formatter:e=>{let t=\"\";return e.forEach((e=>{t=`<div style=\"margin-top:10px\"><span style=\"margin-left:5px;dispaly:inline-block\">${e.name}</span> : ${e.value}</div>`})),t}},series:[{type:\"bar\",data:[{value:e[4]||0,itemStyle:{color:\"#EC6F1A\",barBorderRadius:[4,4,0,0]}},{value:e[3]||0,itemStyle:{color:\"#EEBA18\",shadowColor:\"#91cc75\",borderType:\"dashed\",barBorderRadius:[4,4,0,0]}},{value:e[2]||0,itemStyle:{color:\"#5990FD\",shadowColor:\"#91cc75\",borderType:\"dashed\",barBorderRadius:[4,4,0,0]}},{value:e[1]||0,itemStyle:{color:\"#2DA769\",shadowColor:\"#91cc75\",borderType:\"dashed\",barBorderRadius:[4,4,0,0]}},{value:e[0]||0,itemStyle:{color:\"#939393\",shadowColor:\"#91cc75\",borderType:\"dashed\",barBorderRadius:[4,4,0,0]}}],barWidth:\"8%\"}],itemStyle:{barBorderRadius:5}}))(e,t),this.renderResultColor=e=>{const{intl:t}=this.props;if(\"--\"===e||void 0===e||\"-\"===e)return\"--\";const n=e.avgVol;let r=`${(0,O.af)(e.avgVol)}/${(0,O.af)(e.avgCurrent)}`,i=\"\",o=\"\",a=!1;return 0!==e.capacity?n<=\"0.5\"?o=\"#F43146\":e.powerRate<e.powerRateThreshold&&(i=\"#5990FD\"):e.allDayCurZero?r=E.lH:n>\"0.5\"&&(a=!0),(0,R.jsxs)(\"div\",{children:[(0,R.jsx)(\"span\",{style:{backgroundColor:o,color:i},children:r},r),a&&(0,R.jsx)(Je.Z,{placement:\"rightTop\",title:t.formatMessage({id:\"neteco.pvms.dispersionRate.titp.1\"}),children:(0,R.jsx)(et.Z,{style:{fontSize:\"0.9rem\",marginLeft:\"0.5rem\"}})})]})},this.onChange=async e=>{const{intl:t}=this.props,n=[];let r=[];r=e.filter((e=>e)),await this.SelectingStation(e,n),n.length>30?($e.Z.info({content:t.formatMessage({id:\"neteco.pvms.dispersionRate.number.30\"})}),this.setState({Exceedlimit:!0})):this.setState({selectedNodes:e},(()=>{this.setState({checkedDns:n,Exceedlimit:!1})})),this.formRef.current.setFieldsValue({plants:n}),0===e.length&&0===r.length?this.setState({canSearchStation:!1,searchLoading:!1}):this.setState({canSearchStation:!0})},this.changeTime=e=>{null===e?this.setState({canSearchTime:!1}):this.setState({time:g()(e).format(\"YYYY-MM-DD\"),canSearchTime:!0})},this.exportExcelHandle=()=>{const{checkedDns:e,time:t}=this.state,{intl:n}=this.state,r=this.chart.getDataURL({type:\"jpg\",backgroundColor:\"#fff\"}),i=String(r).indexOf(\",\");var o;(o=String(r).substring(i+1),(0,st.v_)(\"/rest/pvms/dispersion/v1/upload\",o)).then((r=>{r.success?(e=>{(0,at.Z)(\"/rest/pvms/dispersion/v1/export\",null,e)})({dnArray:e,statDay:t,pictureName:r.data}):$e.Z.error({content:n.formatMessage({id:\"common.message.failure\"})})}))},this.onclick=e=>{const{intl:t}=this.props,{pageSize:n,checkedDns:r,time:i,Exceedlimit:o,sort:a}=this.state;!o&&this.setState({showTableLoading:!0});let s={};if(e.dataIndex||0===e.dataIndex)switch(e.dataIndex){case 0:s={lowRatio:20,highRatio:-1};break;case 1:s={lowRatio:10,highRatio:20};break;case 2:s={lowRatio:5,highRatio:10};break;case 3:s={lowRatio:0,highRatio:5};break;case 4:s={lowRatio:-1,highRatio:0}}else switch(e.value){case t.formatMessage({id:\"neteco.pvms.dispersionRate.titp.20\"}):s={lowRatio:20,highRatio:-1};break;case\"10%-20%\":s={lowRatio:10,highRatio:20};break;case\"5%-10%\":s={lowRatio:5,highRatio:10};break;case\"0%-5%\":s={lowRatio:0,highRatio:5};break;case t.formatMessage({id:\"neteco.pvms.dispersionRate.titp.21\"}):s={lowRatio:-1,highRatio:0}}this.setState({intervalScale:s,currPage:1});const l={currPage:1,pageSize:n,dnArray:r,statDay:i,order:a,intervalScale:s};this.getTableDataHandle(l)},this.handleChange=(e,t,n)=>{this.setState({sort:\"descend\"===n.order?\"desc\":\"asc\"});const{currPage:r,pageSize:i,checkedDns:o,time:a,intervalScale:s}=this.state,l={currPage:r,pageSize:i,dnArray:o,statDay:a,intervalScale:s,order:\"descend\"===n.order?\"desc\":\"asc\"};this.getTableDataHandle(l)},this.tableMaxWidth=()=>{const{maxPvNum:e}=this.state;return 450+150*e},this.childrenList=()=>{const{intl:e}=this.props,{maxPvNum:t}=this.state,n=[];for(let r=1;r<=t;r++){const t=`pv${r}`;n.push({title:e.formatMessage({id:\"neteco.pvms.dispersionRate.pv\"},{0:r}),dataIndex:t,width:140,align:\"left\",render:e=>e?this.renderResultColor(e[r-1]):\"--\"})}return n},this.getCurrentColumn=()=>{const{intl:e}=this.props;return{width:\"75%\",align:\"left\",title:(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(\"span\",{children:e.formatMessage({id:\"neteco.pvms.dispersionRate.current\"})}),(0,R.jsx)(Je.Z,{placement:\"right\",title:(0,R.jsxs)(\"div\",{children:[(0,R.jsxs)(\"li\",{children:[(0,R.jsx)(\"span\",{style:{color:\"#F43146\"},children:e.formatMessage({id:\"neteco.pvms.dispersionRate.red\"})}),\"  \",(0,R.jsx)(\"span\",{children:e.formatMessage({id:\"neteco.pvms.dispersionRate.pvError\"})})]}),(0,R.jsxs)(\"li\",{children:[(0,R.jsx)(\"span\",{style:{color:\"#5990FD\"},children:e.formatMessage({id:\"neteco.pvms.dispersionRate.blue\"})}),\"  \",(0,R.jsx)(\"span\",{children:e.formatMessage({id:\"neteco.pvms.dispersionRate.powerLow\"})})]})]}),children:(0,R.jsx)(tt.Z,{style:{fontSize:\"1rem\",marginLeft:\"0.5rem\"}})})]}),children:this.childrenList()}},this.getDispersionColumn=()=>{const{intl:e}=this.props;return{title:e.formatMessage({id:\"neteco.pvms.dispersionRate.dispersion\"}),dataIndex:\"dispersion\",fixed:\"left\",width:150,ellipsis:!1,align:\"center\",sorter:!0,sortDirections:[\"descend\",\"ascend\",\"descend\"],defaultSortOrder:\"descend\",render:e=>{let t=\"\";return e>=20?t=\"#EC6F1A\":e>=10?t=\"#EEBA18\":e>=5?t=\"#5990FD\":e>=0?t=\"#2DA769\":(t=\"#939393\",e=\"- -\"),(0,R.jsx)(\"div\",{className:\"dispersionStyle\",style:{backgroundColor:t},children:(0,O.af)(e)})}}},this.getColumns=()=>{const{intl:e}=this.props;return[{title:e.formatMessage({id:\"neteco.pvms.dispersionRate.stationName\"}),dataIndex:\"stationName\",fixed:\"left\",width:\"15%\",align:\"left\",ellipsis:!0},{title:e.formatMessage({id:\"neteco.pvms.dispersionRate.DeviceName\"}),dataIndex:\"deviceName\",fixed:\"left\",width:\"20%\",align:\"left\",ellipsis:!0},{title:e.formatMessage({id:\"neteco.pvms.systemSetting.devLicense.colums.devSN\"}),dataIndex:\"deviceSn\",fixed:\"left\",width:\"18%\",align:\"left\",ellipsis:!0},this.getDispersionColumn(),this.getCurrentColumn()]},this.getselectedNodes=e=>{const{stationDn:t}=this.props,n=this.state.userCompany.moDn;0===e.length&&(e=t?[{moType:20801,moString:t}]:[{moType:dt,moString:n}]),this.setState({selectedNodesList:e}),this.formRef.current.setFieldsValue({plants:this.state.moDn})},this.disabledNodeFunc=e=>{var t;return(null==e||null===(t=e.nodeIcon)||void 0===t?void 0:t.indexOf(\"disconnected\"))>0},this.state={tableData:[],time:\"\",checkedDns:[],currPage:1,pageSize:10,totally:0,scales:[],isShowEchart:!1,canSearchStation:!1,canSearchTime:!1,legendStatus:\"\",moDn:\"\",userCompany:\"\",sort:\"desc\",Exceedlimit:!1,maxPvNum:28,searchLoading:!1,showTableLoading:!1,intervalScale:null,searchStation:!1,tableHeight:280,selectedNodesList:[{moType:dt,moString:this.props.stationDn}]},this.startTime=Be.$.pageAccess(pt,{pageName:ht})}componentDidMount(){it.Z.getCurrentCompany().then((e=>{(0,l.xb)(e)||this.setState({selectedNodesList:[{moType:dt,moString:e.moDn}],moDn:e.moDn,userCompany:e})})),this.setTableHeight(),window.addEventListener(\"resize\",this.setTableHeight)}componentWillUnmount(){window.removeEventListener(\"resize\",this.setTableHeight),Be.$.pageLeave(this.startTime,ft,{pageName:ht})}async SelectingStation(e,t){for(let n=0;n<e.length;n++){const r=e[n];r.mocId&&r.mocId!==ct.o.STRING_INVERTER?(await lt(r.elementDn)).forEach(((e,n)=>{t.push(e.dn)})):t.push(r.elementDn),(t.length>30||t.length>0)&&this.setState({canSearchStation:!0,searchLoading:!1})}}render(){const{intl:e,stationDn:t,isOperation:n}=this.props,{tableData:r,totally:i,scales:o,isShowEchart:a,canSearchTime:s,canSearchStation:l,userCompany:c,currPage:u,pageSize:d,searchLoading:p,showTableLoading:f,moDn:h}=this.state,m=!(a&&l&&s),g=e.formatMessage({id:\"ncoAddSubjectReportForm.form.deviceName.message\"}),y=n?{selectorConfigs:{width:\"11rem\",height:\"2rem\",displayLevel:\"DEVICE\",placeHolderText:g,clearPlaceHolder:!1,parentDn:h||c.moDn,disableRoot:!0,disabledNodeFunc:this.disabledNodeFunc},commonConfig:{customizedFilterCondition:{MOC_ID_INCLUDE:\"20822\"}},forbidEvent:!1,forbidEmptyArray:!0,getselectedNodes:()=>{}}:{selectorConfigs:{displayLevel:\"DEVICE\",width:\"10rem\",useExternalRootElementDn:!t,parentDn:t||c.moDn,placeHolderText:g},getselectedNodes:this.getselectedNodes};return(0,R.jsx)(\"div\",{className:\"dispersion-rate-container\",children:(0,R.jsxs)(\"div\",{className:\"nco-DispersionRate\",children:[(0,R.jsxs)(\"div\",{className:\"nco-DispersionRate-operation\",children:[(0,R.jsx)(\"div\",{className:\"nco-dispersionRate-operation-search\",children:(0,R.jsxs)(Xe.Z,{layout:\"inline\",ref:this.formRef,children:[(0,R.jsx)(Xe.Z.Item,{label:e.formatMessage({id:\"ncoInverterReportSearchForm.label.device\"}),name:\"plants\",children:(t||h)&&(0,R.jsx)(ot.Z,{domain:\"nco-pushSetting-treeselect\",...y,onChange:this.onChange})}),(0,R.jsx)(Xe.Z.Item,{label:e.formatMessage({id:\"pvms.electric.diagram.panel.chart.statisticType.label\"}),name:\"sitess\",children:(0,R.jsx)(Qe.Z,{onChange:this.changeTime})}),(0,R.jsx)(Je.Z,{title:e.formatMessage({id:\"neteco.pvms.dispersionRate.searchTitp\"}),children:(0,R.jsx)(tt.Z,{style:{fontSize:\"1rem\",marginTop:\"0.5rem\"}})}),(0,R.jsx)(Xe.Z.Item,{children:(0,R.jsx)(qe.Z,{type:\"primary\",onClick:this.getTableDataRes,disabled:!(l&&s),loading:p,style:{margin:\"0 1.5rem\",padding:\"0 1.5rem\"},children:(0,R.jsx)(v.Z,{id:\"common.button.search\"})})})]})}),(0,R.jsx)(qe.Z,{disabled:m,onClick:this.exportExcelHandle,style:{padding:\"0 1.5rem\"},children:(0,R.jsx)(v.Z,{id:\"common.button.export\"})})]}),(0,R.jsxs)(\"div\",{className:\"nco-DispersionRate-view\",children:[(0,R.jsxs)(\"span\",{className:\"span\",children:[\" \",e.formatMessage({id:\"neteco.pvms.dispersionRate.dispersionRate\"}),\" \"]}),(0,R.jsx)(Je.Z,{placement:\"rightTop\",overlayStyle:{maxWidth:400},title:(0,R.jsxs)(\"div\",{children:[(0,R.jsxs)(\"div\",{children:[(0,R.jsx)(\"span\",{style:{fontWeight:\"bold\"},children:e.formatMessage({id:\"neteco.pvms.dispersionRate.titp.2\"})}),e.formatMessage({id:\"neteco.pvms.dispersionRate.titp.3\"})]}),(0,R.jsxs)(\"div\",{children:[(0,R.jsx)(\"span\",{style:{fontWeight:\"bold\"},children:e.formatMessage({id:\"neteco.pvms.dispersionRate.titp.4\"})}),e.formatMessage({id:\"neteco.pvms.dispersionRate.titp.5\"})]})]}),children:(0,R.jsx)(tt.Z,{style:{fontSize:\"1rem\",marginLeft:\"0.5rem\"}})}),this.ncoDispersionRateViewStyle(e),this.ShowEchartJudge(a,e,o)]}),(0,R.jsxs)(\"div\",{className:\"nco-DispersionRate-table\",children:[(0,R.jsx)(Ke.Z,{size:\"small\",loading:f,dataSource:r,columns:this.getColumns(),scroll:{x:this.tableMaxWidth(),y:this.state.tableHeight},pagination:!1,showSorterTooltip:!1,onChange:this.handleChange,locale:{emptyText:f?\" \":\"\"}}),(0,R.jsx)(We.Z,{size:\"small\",total:i,current:u,pageSize:d,showSizeChanger:!0,showTotal:t=>e.formatMessage({id:\"neteco.pvms.station.subarray.pagination.total\"},{total:t}),pageSizeOptions:[\"10\",\"20\",\"30\"],onChange:this.getTableDataPage})]})]})})}ShowEchartJudge(e,t,n){return e?(0,R.jsxs)(\"div\",{className:\"echart-img\",children:[(0,R.jsx)(\"div\",{className:\"yAxis-name-area\",children:(0,R.jsx)(\"span\",{className:\"yAxis-name-left\",children:t.formatMessage({id:\"neteco.pvms.dispersionRate.Number\"})})}),(0,R.jsx)(Ye.Z,{style:{width:\"100%\",height:\"15rem\"},option:this.handleOption(n,t),afterCreated:e=>{this.chart=e,e.on(\"click\",this.onclick)}})]}):(0,R.jsx)(\"div\",{className:\"echartBox\",children:(0,R.jsx)(Ge.Z,{image:Ge.Z.PRESENTED_IMAGE_SIMPLE})})}ncoDispersionRateViewStyle(e){return(0,R.jsxs)(\"div\",{className:\"nco-DispersionRate-view-style\",children:[(0,R.jsx)(\"div\",{className:\"DispersionRate-GreaterThan20\"}),(0,R.jsxs)(\"span\",{children:[\" \",e.formatMessage({id:\"neteco.pvms.dispersionRate.titp.20\"}),\" \"]}),(0,R.jsx)(\"div\",{className:\"DispersionRate-Between10And20\"}),(0,R.jsx)(\"span\",{children:\"10%-20%\"}),(0,R.jsx)(\"div\",{className:\"DispersionRate-Between5And10\"}),(0,R.jsx)(\"span\",{children:\"5%-10%\"}),(0,R.jsx)(\"div\",{className:\"DispersionRate-Between0And5\"}),(0,R.jsx)(\"span\",{children:\"0%-5%\"}),(0,R.jsx)(Je.Z,{placement:\"bottomLeft\",overlayStyle:{maxWidth:400},title:(0,R.jsxs)(\"div\",{children:[(0,R.jsxs)(\"span\",{style:{color:\"black\",fontWeight:\"bold\"},children:[\" \",e.formatMessage({id:\"neteco.pvms.dispersionRate.titp.4\"}),\" \"]}),e.formatMessage({id:\"neteco.pvms.dispersionRate.titp.5\"})]}),children:(0,R.jsxs)(\"div\",{style:{display:\"flex\"},children:[(0,R.jsx)(\"div\",{className:\"DispersionRate-NotAnalyzed\"}),(0,R.jsxs)(\"span\",{children:[\" \",e.formatMessage({id:\"neteco.pvms.dispersionRate.titp.21\"}),\" \"]})]})})]})}}const gt=(0,o.ZP)(mt),{TabPane:vt}=r.Z;class yt extends i.Component{render(){const{intl:e,deviceDn:t,isOperation:n}=this.props;return(0,R.jsx)(\"div\",{className:`nco-${n?\"operation-\":\"\"}dispersion-rate-analysis-container tab-content`,children:(0,R.jsx)(\"div\",{className:\"content\",children:(0,R.jsx)(\"div\",{className:\"left-content\",children:(0,R.jsxs)(r.Z,{tabPosition:\"top\",defaultActiveKey:\"dispersionRateAnalysis\",className:\"aui-tabs\",children:[(0,R.jsx)(vt,{tab:e.formatMessage({id:\"neteco.pvms.dispersionRate.inverterDispersionRate\"}),children:(0,R.jsx)(Ue,{stationDn:t,isOperation:n})},\"inverterDispersion\"),(0,R.jsx)(vt,{tab:e.formatMessage({id:\"neteco.pvms.dispersionRate.stringDispersionRate\"}),children:(0,R.jsx)(gt,{stationDn:t,isOperation:n})},\"pvDispersion\")]})})})})}}const bt=(0,o.ZP)(yt)},13388:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>D});var r=n(88391),i=n(37920),o=n.n(i),a=n(99073),s=n(44184),l=n(13528),c=n(70250),u=n.n(c),d=n(96519),p=n(54568),f=n(41541),h=n(49453);function m(e){return new Promise(((t,n)=>{!function(e){const n=new Image;n.crossOrigin=\"Anonymous\",n.onload=function(){let e=document.createElement(\"canvas\");const r=e.getContext(\"2d\");e.height=n.height,e.width=n.width,r.drawImage(n,0,0);const i=e.toDataURL(\"image/png\");t(i),e=null},n.src=e}(e)}))}function g(){return new Worker(n.p+\"static/js/pdf.worker.41218d9b.worker.js\")}var v=n(23712);const y=function(e){let{intl:t,PDFContent:n,titleBackground:i,contentBackground:a,disabled:s,fileName:l}=e,c=(0,r.useRef)(null);const[u,d]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{c.current=new g,c.current.addEventListener(\"message\",(e=>{d(!1);const t=`${e.data.fileName||\"sample\"}_${o()().format(\"YYYY-MM-DD HH:mm:ss\")}.pdf`;!function(e,t){const n=new Blob([e]),r=window.URL.createObjectURL(n),i=document.createElement(\"a\");i.style.display=\"none\",i.href=r,i.download=t||\"file.pdf\",document.body.appendChild(i),i.click(),URL.revokeObjectURL(i.href),document.body.removeChild(i)}(e.data.resBolb,t)}))}),[]),(0,v.jsx)(f.Z,{className:\"device-set-config-button\",loading:u,onClick:async()=>{var e;d(!0);const r=t.locale||\"en-US\",{doc:o,background:s}=await function(e,t,n,r){const i=\"th-TH\"===r;return new Promise(((r,o)=>{Promise.all([m(t),m(n)]).then((t=>{r({doc:{pageSize:\"A4\",pageMargins:[40,65,40,50],content:e,styles:{paramHeader:{fontSize:18,bold:!0,margin:[0,5,0,10]},subHeader:{fontSize:14,bold:!0,margin:[0,5,0,5]},paramTable:{margin:[0,5,0,15],fontSize:8},paramList:{margin:[0,5,0,15],fontSize:8},tableHeader:{color:\"#6d737d\"},tableLabel:{color:\"#6d737d\"},coverPageTitle:{bold:!0,fontSize:i?30:32,margin:[87,458,0,100]},coverPageSubTitle:{fontSize:14,margin:[87,0,0,0]}},defaultStyle:{font:i?\"Thai\":\"Roboto\"},patterns:{stripe45d:{boundingBox:[1,1,4,4],xStep:3,yStep:3,pattern:\"1 w 0 1 m 4 5 l s 2 0 m 5 3 l s\"}}},background:{title:t[0],bg:t[1]}})}))}))}(n,i,a,r),u={...o,...s,fileName:l};null===(e=c.current)||void 0===e||e.postMessage(JSON.stringify(u))},disabled:s,children:t.formatMessage({id:\"common.button.export\"})})},b=n.p+\"static/media/PDF_title_background.5e3a3ed305d28fdfbd02.png\";var S=n(97382);const{iUnescape:x}=neteco.util,w=[{text:a.lH,style:\"tableLabel\"},{text:a.lH}],C=[a.lH,a.lH,a.lH,a.lH],T=[230320283,230190101,230200061,230700059],A=[230700179,230200219],E=[50018,50013,50017,50019,50020],O=[230700176,230190116,230190136,230102787,230102792,230223895,230223903],M=[21013],P={1:\"neteco.pvms.weather.day.monday\",2:\"neteco.pvms.weather.day.tuesday\",3:\"neteco.pvms.weather.day.wednesday\",4:\"neteco.pvms.weather.day.thursday\",5:\"neteco.pvms.weather.day.friday\",6:\"neteco.pvms.weather.day.saturday\",7:\"neteco.pvms.weather.day.sunday\"},D=e=>{let{intl:t,unprocessedData:n,disabled:i,deviceDnId:c}=e;const[f,m]=(0,r.useState)([]),[g,D]=(0,r.useState)(null),I=(()=>{let e;if(!(0,s.kJ)(n))return a.lH;const t=n[0];for(let n=0;n<(null==t||null===(r=t.signals)||void 0===r?void 0:r.length);n++){var r,i;if(33595393===(null==t||null===(i=t.signals[n])||void 0===i?void 0:i.id)){e=(null==t?void 0:t.signals[n].value)||a.lH;break}}return e||a.lH})(),N=e=>{let t;return t=(0,p.No)(e)?(0,s.Kn)(null==e?void 0:e.enumList)?null==e?void 0:e.enumList[null==e?void 0:e.value]:a.lH:isNaN(Number(null==e?void 0:e.value))?null==e?void 0:e.value:(0,l.eD)(null==e?void 0:e.value),t||a.lH},_=e=>(0,p.L6)(e)||-1!==E.indexOf(null==e?void 0:e.id),j=e=>{const n=[[{text:t.formatMessage({id:\"neteco.pvms.pdf.option\"}),style:\"tableHeader\"},{text:t.formatMessage({id:\"neteco.pvms.pdf.range\"}),style:\"tableHeader\"},{text:t.formatMessage({id:\"neteco.pvms.pdf.value\"}),style:\"tableHeader\"},{text:t.formatMessage({id:\"neteco.pvms.pdf.unit\"}),style:\"tableHeader\"}]];return(0,s.kJ)(e)?(e.forEach((e=>{if(!_(e)){var t;if(!e.mocId)return;const r=(null==e?void 0:e.name)||a.lH,i=N(e);let o=(0,l.eD)(null==e||null===(t=e.valueRange)||void 0===t?void 0:t.displayRange,!0)||a.lH;-1!==M.indexOf(null==e?void 0:e.id)&&(o=(0,l.eD)(decodeURIComponent(null==e?void 0:e.tips),!0)||a.lH);const s=(null==e?void 0:e.unit)||a.lH;n.push([r,o,i,s])}})),n):(n.push(C),n)},k=(e,t)=>{e.push({style:\"paramTable\",table:{headerRows:1,widths:[\"25%\",\"25%\",\"25%\",\"25%\"],body:t}})},L=e=>1===e?t.formatMessage({id:\"neteco.pvms.device.di.scheduling.closed\"}):0===e?t.formatMessage({id:\"neteco.pvms.device.di.scheduling.disconnect\"}):a.lH,R=(e,t,n,r)=>{const i=1===r?[\"*\",\"*\",\"*\",\"*\",\"*\",\"*\"]:[\"10%\",\"10%\",\"10%\",\"10%\",\"10%\",\"*\"];t.length>1&&(e.push({text:n,style:\"subHeader\"}),e.push({style:\"paramTable\",table:{headerRows:1,widths:i,body:t}}))},Z=e=>{var n,r;const i=(null==e?void 0:e.name)||a.lH,o=[];o.push({text:i,style:\"paramHeader\"});let c=[];const p=null==e||null===(n=e.signals)||void 0===n?void 0:n.some((e=>T.includes(e.id)||A.includes(e.id))),f=null==e||null===(r=e.signals)||void 0===r?void 0:r.some((e=>O.includes(e.id)));let h=[];var m;if(p)null==e||null===(m=e.signals)||void 0===m||m.forEach((e=>{if(T.includes(null==e?void 0:e.id)||A.includes(e.id)){const n=T.includes(null==e?void 0:e.id)?\"TOU\":\"Peak\";((e,n,r,i,o)=>{n=j(r),k(e,n);const l=\"TOU\"===o?t.formatMessage({id:\"neteco.pvms.device.jstou.charging.or.discharge\"}):t.formatMessage({id:\"neteco.pvms.device.max.peakShaving\"}),c=[[{text:t.formatMessage({id:\"neteco.pvms.station.availability.ECO.columns.startTime\"}),style:\"tableHeader\"},{text:t.formatMessage({id:\"neteco.pvms.station.availability.ECO.columns.endTime\"}),style:\"tableHeader\"},{text:l,style:\"tableHeader\"},{text:t.formatMessage({id:\"neteco.pvms.device.jstou.repeat\"}),style:\"tableHeader\"}]];(0,s.pM)(x(null==i?void 0:i.value))?JSON.parse(x(null==i?void 0:i.value)).forEach((e=>{const n=(null==e?void 0:e.startTime)||a.lH,r=(null==e?void 0:e.endTime)||a.lH,i=\"TOU\"===o?0===(l=null==e?void 0:e.onOff)?t.formatMessage({id:\"neteco.pvms.device.jstou.charging\"}):1===l?t.formatMessage({id:\"neteco.pvms.device.jstou.discharge\"}):a.lH:null==e?void 0:e.maxPeakPower;var l;const u=(e=>{if(!(0,s.kJ)(e))return a.lH;let n=\"\";return e.forEach(((e,r)=>{0!==r&&(n+=t.formatMessage({id:\"neteco.pvms.rule.separator.label\"})),n+=t.formatMessage({id:P[e]})})),n})(null==e?void 0:e.repeatPeriod);c.push([n,r,i,u])})):c.push(C),k(e,c)})(o,c,h,e,n),h=[]}else h.push(e)})),0!==h.length&&(c=j(h),k(o,c));else if(f){var g;null==e||null===(g=e.signals)||void 0===g||g.forEach((e=>{O.includes(e.id)?(((e,n,r,i)=>{n=j(r),k(e,n);const o=t.formatMessage({id:\"neteco.pvms.device.di.scheduling.di.activePowerDispatch\"}),c=t.formatMessage({id:\"neteco.pvms.device.di.scheduling.di.reactivePowerDispatch\"}),p=t.formatMessage({id:\"neteco.pvms.device.di.scheduling.percentage\"})+`[${(0,l.af)(d.KE)}~${(0,l.af)(d.g)}]`,f=t.formatMessage({id:\"neteco.pvms.basicUnifSignal.invCenter.power_factor\"})+`(${(0,l.af)(d.tj)}~${(0,l.af)(d.$K)}]U[${(0,l.af)(d.XS)}~${(0,l.af)(d.Wg)}]`,h=[[{text:t.formatMessage({id:\"neteco.pvms.device.di.scheduling.no\"}),style:\"tableHeader\"},{text:\"DI1\",style:\"tableHeader\"},{text:\"DI2\",style:\"tableHeader\"},{text:\"DI3\",style:\"tableHeader\"},{text:\"DI4\",style:\"tableHeader\"},{text:p,style:\"tableHeader\"}]],m=u()(h);m[0][5].text=f,(0,s.pM)(x(null==i?void 0:i.value))&&JSON.parse(x(null==i?void 0:i.value)).forEach((e=>{const t=null==e?void 0:e.dispatchType,n=1===t?h.length:m.length,r=L(null==e?void 0:e.di1),i=L(null==e?void 0:e.di2),o=L(null==e?void 0:e.di3),s=L(null==e?void 0:e.di4),l=(null==e?void 0:e.value)||a.lH;1===t&&h.push([n,r,i,o,s,l+\"%\"]),2===t&&m.push([n,r,i,o,s,l+\"%\"])})),R(e,h,o,1),R(e,m,c,2)})(o,c,h,e),h=[]):h.push(e)}))}else c=j(null==e?void 0:e.signals),k(o,c);return o};return(0,r.useEffect)((()=>{if((0,s.le)(g))return;const e=[];e.push({text:t.formatMessage({id:\"neteco.pvms.pdf.title\"}),style:\"coverPageTitle\"},{style:\"coverPageSubTitle\",table:{headerRows:1,widths:[\"auto\",\"auto\"],body:[[{text:t.formatMessage({id:\"ncoNewDeviceManagement.label.deviceName\"})},{text:I}],[{text:t.formatMessage({id:\"neteco.pvms.device.config.upStation.fie\"})},{text:g}],[{text:t.formatMessage({id:\"neteco.pvms.setting.data.repair.export.time\"})},{text:`${o()(new Date).format(\"YYYY-MM-DD\")}`}]]},layout:\"noBorders\"}),null==n||n.forEach(((t,n)=>{0!==n?e.push(...Z(t)):e.push(...(e=>[{text:(null==e?void 0:e.name)||a.lH,style:\"paramHeader\",headlineLevel:1},{style:\"paramList\",table:{headerRows:1,widths:[\"30%\",\"70%\"],body:(e=>{const t=[];return(0,s.kJ)(e)?(e.forEach((e=>{if(!_(e)){const n=N(e);t.push([{text:null==e?void 0:e.name,style:\"tableLabel\"},{text:n}])}})),t):w})(null==e?void 0:e.signals)}}])(t))})),m(e)}),[i,g,c]),(0,r.useEffect)((()=>{(async function(e){const t={deviceDnIds:[e],pageNo:1,pageSize:1e3},[n,r]=await(0,s.AM)((0,h.v_)(\"/rest/dp/pvms/device/v1/web/devices/info\",t));return n||r})(c).then((e=>{var t;null!==(t=e[0])&&void 0!==t&&t.stationDn&&(0,S.vP)(e[0].stationDn).then((e=>D((null==e?void 0:e.stationName)||\"\"))).catch((()=>D(\"\")))})).catch((()=>D(\"\")))}),[c]),(0,v.jsx)(y,{intl:t,disabled:i||(0,s.le)(g),PDFContent:f,titleBackground:b,contentBackground:\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAyAAAARgCAYAAAARjzKKAAAABHNCSVQICAgIfAhkiAAAIABJREFUeJzs3X+s1nX9//HnBYdfHbTwR0JEA8sRCAgKQ1QU2mJiszE1Vk1bNs3cLHCtWNLyx2pt9UfOcmHLsZkRrIwfWyobBtHaBE1nDZRKdJUIpaQCYXkO5/vH+ZxLzuFAMPXhl+Pttp1xrvd5X+/zvi7+ue7n9X693o2Ojo6OAgAACOj3dp8AAADwziFAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADHviADZ8EzV7KVv91kAAADviADpzS3rO8PkYD0fAwAAb653RIDMGnNoXNy6vnN7F6MkAADw1uuTAbLhmc4RjoOtv/rIj2/dUHXz7Lf0tAAA4B2v5e0+gbfCrDFVG57tDJGuUY7eRkG6bHim6qLRVbcIEAAAeEs1Ojo6Ot7uk3gzHBwbvf1sw7OHbr91feeoR2/hcaTjHWz79u31r3/965DtgwcPrvHjx1ej0fjfB/kfHn300brrrrtqxIgR9fnPf77e//73v+Fj9mbnzp31wgsv1H/+859qaWmpAQMG1Pjx44/pGPPnz69Go1Ht7e31i1/84i05TwAAjl99ZgTk1g2dkdEzJmYvrbp5Vuf2npdldV1y1fjG6yGy4ZnOY100+ugC5Pbbb+/1g/aQIUNqy5YtNXjw4GN/MT2sWrWqfvWrX1VV1aWXXvqWBMj9999f3/3ud2vbtm3NbaeffnpdeumltWjRoqM+zoABA2r9+vV10UUXvennCADA8a/PBMj6qzsDY/bS1+d33LK+Mz6q/m9EY/TrkXLL+tcf3zy76jfPdm7rCpijiY+DjRw5sk4//fTq379/VVXt37+/BgwY8IZfV1XV3Llza/v27XXSSSfVyJEj35RjHmzjxo31jW98o3bs2FFjx46t0047rf773//Wk08++aaM4AAAQJc+EyBV3Uc/Dp7vcXBMdH3fc0Tk5ln/N4pylJde9TRs2LD62c9+Vv36dZ/X39HRUW1tbdXS0tLtw3xbW1t1dHQcsr29vb0OHDhQjUajWlo6/3vOO++8mjJlSg0cOLC5rcuBAwfqwIEDVVXVv3//bsfq+t1dx+ro6Gju269fv+a+v/vd72rHjh01YsSIWr58eZ122mnV0dFR27Ztqz/96U+HvNauc+zXr18zuP6Xjo6Oam9vP+J5dr22rmOLHwCAvqfProJV1TnCcaSYuGV25z63zO7cr2vkZMMzva+kdSSH+8D8sY99rCZMmFDz589vbnvppZdqypQpNWHChNq8eXNVVT333HN122231cyZM2vSpEk1ffr0Wrx4cVVVLVy4sKZMmVKzZ79eWO3t7XXPPffUlVdeWZMnT64pU6bUtddeW7/85S/rtddeq6rOuSMTJkyoyZMn1yOPPFJf+tKXavLkyTV16tT6zne+U21tbVVVzX8bjUa98MILze8//OEP18c//vHm73zyySfrpptuqhkzZtSkSZNq5syZtXjx4nr22WeP+N6sWLGirrvuupo6dWqdddZZdc0119RvfvOb5s8XLlxYEyZMqPPOO6+WLFlS55xzTn31q1896vceAIDjR58YAemaZN41AtLbXJDentPllvWdl2D1XCXrWJbl3b9/f+3atav5V/whQ4ZUa2trtba21p49e+pd73pXc9/XXnutdu/eXR0dHbV///5qb2+vb37zm7V69eoaOnRonXnmmbV79+7m6MPAgQNrz549zbkf7e3ttWDBglq1alX179+/Wltbq62tre6///5au3Zt7d69u6655prav39/7dmzp6qqvv3tb9ff/va32rdvX7366qt1xx131BlnnFGXXXZZTZ8+ve69997asWNH3XTTTXXllVfW3Llza+jQoc1z3rp1ay1YsKC2bNlSAwYMqBNPPLF27NhRS5curQceeKDuu+++GjOm99pbsmRJvfTSSzVq1Kh66qmn6oEHHqinnnqqVq9eXaecckrz9e3bt69+8pOf1L59++qVV145+jcfAIDjRp8YAela4epo7mQ+e2nnpPPZSzu/NjzbuRrWG70L+p///Oc655xzavLkyTV58uS6/fbbj/q5bW1ttW7duqqq+uIXv1jLly+vX//61/XDH/6w1/3XrVtXq1atqsGDB9dtt91WTzzxRG3atKmuvfbaam9vryVLltRf//rXbs+ZNm1aPfjgg7V27doaPnx4dXR01Nq1a6uqas6cObVo0aJ6z3veU4888kgtWLCgrrrqqlq5cmXz+XfeeWdt2bKlxo0bV8uWLavHHnus7rnnnho7dmzt3LmzlixZctjXd8UVV9TmzZtr2bJldeONN1ZV1TPPPFN/+MMfuu03cODAuv766+vxxx+vT37yk0f9/gEAcPzoEyMgPUc7Zo0+zH7rDz83pKfDLc97OO9+97vrpJNOaj7ummtxNFpaWmrcuHH16KOP1t13311bt26tefPm1bnnntvr/r/97W/rwIEDNWrUqPrMZz5TjUajhg0bVldffXX9+Mc/rh07dtRf/vKXbvNFPv3pT9fJJ59cJ598co0fP7527txZL774YvPnn/vc52r69Om1atWqWrFiRW3atKl+//vf1yuvvFLz589vXjL1iU98os4///yqqrrwwgtrzpw5tW3bttqwYcNhX/MHP/jBWrhwYe3atatefvnl5vZ9+/Z122/EiBH1qU99qlpaWrpdbgYAQN/RJ0ZAejpcWNzaY07HRaPfvN85cuTI2rhxY/Pr61//+lE/t3///vW1r32tpkyZUv/85z9r9erVdfXVV9fNN9/c7QN7l67LqgYPHtxt3smJJ57YfHxwDDQajRoyZEjz8eFW5zrzzDNr8eLFde+999aFF15YbW1ttXLlympra6t///vfVVV18sknd3vOCSecUFVVr776aq/HXLlyZS1evLhWrlxZL774Yo0aNar5s563oBk0aNAhk+wBAOhb+kyAHDyy0dvlVIebUN4zSpr7H+Mf4FtaWqp///7Nr64Q6LoPyJ49e2r37t1VVfX4448f8uH73HPPreXLl9eDDz5Y8+bNq6qqn//854eMElRVcy7Iyy+/XE8//XRz+8aNG+vAgQM1bNiwam1tPepzf/jhh5sT0auqJk2aVB/5yEeqquqpp56qRqNRZ511VlVVt8umulbKqqo6++yze52Ev3r16nr++edrxowZtWrVqrrgggsOex5WvQIA6PuO+z83z17a/fGsMb2PgHSteHXIvqMP3ffNNHbs2HrooYfq4Ycfrh/96Ef1gQ98oJYvX95tn7a2tvrsZz9bV1xxRQ0aNKjGjh1bVZ0jFT2X9a3qnFOxZs2aevrpp+vWW2+tSy65pPbv319Ll3a+GdOmTasZM2bUxo0bj+ocV6xYUV/5ylfq4osvrve+9731j3/8o5YtW1ZVVTNnzqzW1tY6//zza9OmTfXTn/60hgwZUh/60Idq69attWrVqho0aFDNnTu314DoCq29e/fW5s2ba82aNUf/5gEA0Occ9wHStXTukXStctXlotGdQdIzXo7lmEfr8ssvr4ceeqi2bdtWd9xxR51wwgl11VVX1aOPPtrc58CBA/XYY4/V+vXrq9FoNO+D8YUvfKFOPfXUQ445ZsyY+vKXv1zf//73a926dc0J7I1Go2bNmlXf+ta3jukcW1tba/v27XXnnXc2tzUajZo+fXrdeOON1Wg06vrrr6+///3vtXLlyvrBD37Q7bnXXHNNt2WGD3bZZZfVunXr6o9//GNdd911dfHFF1e/fv2OaY4MAAB9x3EfIEejt7kfPSekdzmWpXerqs4666waPnx4t0uYDjZu3LhasWJF3XfffbV3794aO3ZsTZs2rRqNRjUajTr11FNr4MCBdffdd9djjz1We/furaFDh9bEiRPrggsuqH79+tXEiRPrhhtuaN7Ir6pq3rx5NWvWrFqzZk3t2rWrBg4cWGPGjKmPfvSjzfkep5xySt1www3V0dHRbRngs88+u84444zmTQQXLVpUkydPrueee6727dtXQ4YMqdGjR9ecOXOal3K1trbW9773vbr88svriSeeqH379tWwYcNqxowZNXHixOaxp06dWmeeeWYNGjSoqqouueSSuuuuu2rr1q01fPjwmjNnTo0cObIajUa9733vq6rq9fUBANA3NTp6TkY4zs1e2nlX8+Ydz9cfGiAdt3Uuxdubjtve0tMDAIB3tD4zCb2qMzYuGt19DkjP+Lh59uEnpB/r6AcAAHBs+twISE9dsdF1p/MjjX6sv/rI9wYBAADemD4fIL05eASka4TkWG88CAAAHLt3ZIAAAABvjz41BwQAAPj/mwABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQEzL230Cb9Tzzz9fbuYOAMA7QaPRqBEjRrzdp/GGNDp8egcAAEJcggUAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIu2kP/AAADgElEQVQEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAAAECMAAEAAGIECAAAECNAAACAGAECAADECBAAACBGgAAAADECBAAAiBEgAABAjAABAABiBAgAABAjQAAAgBgBAgAAxAgQAAAgRoAAAAAxAgQAAIgRIAAAQIwAAQAAYgQIAAAQI0AAAIAYAQIAAMQIEAAAIEaAAAAAMQIEAACIESAA/L/261gAAAAAYJC/9Sx2lUUAsBEQAABgIyAAAMBGQAAAgI2AAAAAGwEBAAA2AgIAAGwEBAAA2AgIAACwERAAAGAjIAAAwEZAAACAjYAAAAAbAQEAADYCAgAAbAQEAADYCAgAALAREAAAYCMgAADARkAAAICNgAAAABsBAQAANgICAABsBAQAANgICAAAsBEQAABgIyAAAMBGQAAAgI2AAAAAGwEBAAA2AgIAAGwEBAAA2AgIAACwERAAAGAjIAAAwEZAAACAjYAAAAAbAQEAADYCAgAAbAQEAADYCAgAALAREAAAYCMgAADARkAAAIBN6P0OX+xCvZsAAAAASUVORK5CYII=\",fileName:I})}},97382:(e,t,n)=>{\"use strict\";n.d(t,{NL:()=>u,Pc:()=>a,XT:()=>s,j6:()=>l,jw:()=>c,jz:()=>o,vP:()=>d});var r=n(49453),i=n(20928);const o=()=>(0,r.U2)(\"/rest/dp/pvms/web/v1/dispersion/inverter/station-list\"),a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,r.v_)(\"/rest/dp/pvms/web/v1/dispersion/inverter/dispersion-ratio\",{...e})},s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,r.v_)(\"/rest/dp/pvms/web/v1/dispersion/inverter/deviation\",e)},l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.Z)(\"/rest/dp/pvms/web/v1/dispersion/inverter/deviation/export\",null,e)},c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,r.v_)(\"/rest/dp/pvms/web/v1/dispersion/inverter/deviation/history\",e)},u=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,r.v_)(\"/rest/dp/pvms/web/v1/dispersion/inverter/pv-detail\",e)},d=async e=>(0,r.U2)(`/rest/pvms/web/station/v1/overview/station-detail?stationDn=${e}`).then((e=>{if(e.success)return{stationName:e.data.name}}))},46771:(e,t,n)=>{\"use strict\";n.d(t,{l:()=>ui});var r=n(23774),i=n(93706),o=n(74794),a=n(37825),s=n(64218),l=n(31519),c=n(68718),u=n(51523),d=n.n(u),p=n(88391),f=n(2326),h=n(56017),m=n(10749),g=n(59516),v=n(16910),y=n(5807),b=n(44184),S=n(98298),x=n(55751),w=n(60503),C=n(83862),T=n(62073),A=n(21499),E=n(92252),O=n(90701),M=n(4342),P=n(45338),D=n(83621),I=n(56687),N=n(23712);class _ extends p.Component{constructor(e){super(e),this.getOptions=e=>{e&&this.state.prevParentDn!==this.props.parentDn&&!this.state.hadData&&(this.setState({deviceTypeOptions:[],hadData:!1}),this.props.loadDeviceTypeList(this.props.parentDn,this.props.isSharedStation),this.setState({hadData:!0}))},this.getConnectStatusLabel=()=>(0,N.jsxs)(\"span\",{children:[this.i18n.status,(0,N.jsx)(O.Z,{title:this.i18n.statusTip,placement:\"bottom\",children:(0,N.jsx)(I.Z,{className:\"device-connect-status-tip\"})})]}),this.getDefaultOptions=e=>{let{isSystemDeviceManagement:t,hasInverter:n,intl:r}=e;return t&&n?[{key:a.Y,value:a.Y,label:r.formatMessage({id:\"common.deviceTypes.0\"})},{key:D.o.STRING_INVERTER,value:D.o.STRING_INVERTER,label:r.formatMessage({id:\"neteco.pvms.devTypeLangKey.inverter\"})}]:[{key:a.Y,value:a.Y,label:r.formatMessage({id:\"common.deviceTypes.0\"})}]},this.getForm=e=>{this.formRef=e},this.submitSearchForm=e=>{const{onSubmit:t}=this.props;(0,c.uB)(e);const n=\"Disconnected\"===e.status?\"Disconnected;Initialized;UnAvailable;Deleted\":e.status;t(e={...e,status:n})},this.getDevTypeOptions=e=>{const t=e.map((e=>({value:e.mocId,key:e.mocId,label:e.mocTypeName})));t.unshift({key:a.Y,value:a.Y,label:this.i18n.deviceTypes0}),this.setState({deviceTypeOptions:t})},this.getCommonOptions=e=>e.map((e=>({value:e.value,key:e.value,label:e.label}))),this.getCountryRegionOptions=e=>e.map((e=>({value:e.areaId,key:e.areaId,label:window.neteco.util.iUnescape(e.areaName)})));const{intl:t,isSystemDeviceManagement:n,hasInverter:r}=this.props;this.formRef=void 0,this.state={deviceTypeOptions:this.getDefaultOptions({isSystemDeviceManagement:n,hasInverter:r,intl:t}),prevParentDn:void 0,hadData:!1,userSelect:!1},this.i18n={deviceType:t.formatMessage({id:\"ncoPvSearchBar.label.deviceType\"}),deviceTypes0:t.formatMessage({id:\"common.deviceTypes.0\"}),deviceName:t.formatMessage({id:\"neteco.pvms.devEms.heads.devName\"}),sn:t.formatMessage({id:\"ncoPvSearchBar.label.sn\"}),model:t.formatMessage({id:\"ncoPvSearchBar.label.model\"}),status:t.formatMessage({id:\"neteco.pvms.tableDetail.abnormalType.comState\"}),ALL:t.formatMessage({id:\"neteco.pvms.all\"}),countryAndRegion:t.formatMessage({id:\"neteco.pvms.register.area\"}),stationGridTime:t.formatMessage({id:\"ncoHomeSearchBarView.label.stationGridTime\"}),stationType:t.formatMessage({id:\"neteco.pvms.stationInfo.addStation.stationType\"}),softwareVersion:t.formatMessage({id:\"ncoNewDeviceManagement.label.softwareVersion\"}),statusTip:t.formatMessage({id:\"neteco.pvms.pvSearchBar.tip.status\"})},this.deviceStatus=[{value:a.Y,label:this.i18n.ALL},{value:\"Connected\",label:t.formatMessage({id:\"neteco.pvms.partials.main.dm.devConnected\"})},{value:\"Disconnected\",label:t.formatMessage({id:\"neteco.pvms.partials.main.dm.devDisconnected\"})}],this.baseSearchItems=()=>[{itemProps:{name:\"deviceType\",label:this.i18n.deviceType},component:E.Z,cmpProps:{options:this.state.deviceTypeOptions,defaultValue:n?void 0:a.Y,style:{width:\"11rem\"},onDropdownVisibleChange:e=>this.getOptions(e),notFoundContent:this.props.loading?(0,N.jsx)(A.Z,{size:\"small\"}):null,onSelect:()=>this.setState({userSelect:!0})}},{itemProps:{name:\"deviceName\",label:this.i18n.deviceName},component:T.Z,cmpProps:{style:{width:\"11rem\"}}},{itemProps:{name:\"sn\",label:this.i18n.sn},component:T.Z,cmpProps:{style:{width:\"11rem\"}}}],this.expandedSearchItems=()=>[{itemProps:{name:\"model\",label:this.i18n.model},component:T.Z,cmpProps:{style:{width:\"12rem\"}}},{itemProps:{name:\"status\",label:this.getConnectStatusLabel()},component:E.Z,cmpProps:{options:this.getCommonOptions(this.deviceStatus),defaultValue:this.i18n.ALL,style:{width:\"12rem\"}}}],this.expandedHuaweiUserItems=(e,t)=>[{itemProps:{name:\"softwareVersion\",label:this.i18n.softwareVersion},component:T.Z,cmpProps:{style:{width:\"12rem\"}}},{itemProps:{name:\"stationType\",label:this.i18n.stationType},component:E.Z,cmpProps:{options:this.getCommonOptions(t),defaultValue:this.i18n.ALL,style:{width:\"12rem\"}}},{itemProps:{name:\"areaIds\",label:this.i18n.countryAndRegion},component:E.Z,cmpProps:{options:this.getCountryRegionOptions(e),isMultipleSelect:!0,style:{width:\"12rem\"}}},{itemProps:{name:\"stationGridTime\",label:this.i18n.stationGridTime},component:C.Z.RangePicker,cmpProps:{style:{width:\"15rem\"}}}]}componentDidMount(){const{initDeviceTypeList:e}=this.props;e()}componentDidUpdate(e){const{parentDn:t,deviceTypeList:n,isSystemDeviceManagement:r,intl:i,hasInverter:o,initDeviceTypeList:s}=this.props;t!==e.parentDn&&(s(),this.setState({prevParentDn:e.parentDn,deviceTypeOptions:this.getDefaultOptions({isSystemDeviceManagement:r,hasInverter:o,intl:i}),hadData:!1,userSelect:!1},(()=>{if(this.formRef){let e=r?void 0:a.Y;r&&o&&(e=D.o.STRING_INVERTER),r&&!1===o&&(e=a.Y),r&&void 0===o&&(e=void 0),this.formRef.setFieldsValue({deviceType:e})}}))),o!==e.hasInverter&&this.setState({deviceTypeOptions:(null==n?void 0:n.length)>0?this.state.deviceTypeOptions:this.getDefaultOptions({isSystemDeviceManagement:r,hasInverter:o,intl:i})},(()=>{if(this.formRef&&!this.state.userSelect){let e=r?void 0:a.Y;r&&o&&(e=D.o.STRING_INVERTER),r&&!1===o&&(e=a.Y),r&&void 0===o&&(e=void 0),this.formRef.setFieldsValue({deviceType:e})}})),n!==e.deviceTypeList&&this.getDevTypeOptions(n)}render(){const{deviceTypeList:e,areaList:t,setTableHeight:n,stationTypeList:r}=this.props,i={status:a.Y,deviceType:a.Y};return(0,N.jsx)(\"div\",{className:\"nco-pv-search-bar\",children:(0,N.jsx)(P.Z,{useDefaultSpan:!1,baseSearch:this.baseSearchItems(),expandedSearch:(0,M.ux)()?[...this.expandedSearchItems(),...this.expandedHuaweiUserItems(t,r)]:this.expandedSearchItems(),expandCallback:n,updateSearchCondition:this.submitSearchForm,form:this.formRef,getForm:this.getForm,initValues:i})})}}const j=_;var k=n(61686),L=n(49453);const R=(0,r.$j)((e=>({deviceTypeList:e.ncoMonitorPvSearchBar.deviceTypeList,loading:e.ncoMonitorPvSearchBar.loading})),(e=>({loadDeviceTypeList:(t,n)=>{(async(e,t,n)=>{e({type:k.Mb});let r,i=t||\"/\";(\"share-station-company-dn\"===t||n)&&(i=void 0,r=t);const o=await(0,L.U2)(\"/rest/neteco/web/config/device/v1/app/device-moc-type\",{parentDn:i,shareParentDn:r,filterPowerCube:!0});let a=[];0===o.code&&(a=o.data?o.data:[]),e({type:k.PT,payload:a}),e({type:k.T_,payload:void 0})})(e,t,n)},initDeviceTypeList:()=>{(e=>{e({type:k.Bq})})(e)}})))((0,i.ZP)(j));n(94852);var Z=n(57350),B=n(15694),F=n(47801),z=n(12682),V=n.n(z),H=n(18206),U=n(95899),G=n(53137),Y=n(95059),W=n(98919),K=n(45258),q=n(41006),Q=n(53309),X=n(70535),J=n(17489),$=n(32449),ee=n(29266),te=n(52709),ne=n(37920),re=n.n(ne),ie=n(41541),oe=n(57266),ae=n(64893);const se=async(e,t)=>{const n=await(0,L.Md)(\"/rest/neteco/pm/v1/pmdata/export/batch/delete\",{fileName:e});n&&n.result?t.okCallbacks&&t.okCallbacks.forEach((e=>e())):t.failCallbacks&&t.failCallbacks.forEach((e=>e()))},le=async(e,t)=>{(0,L.Sv)(\"/rest/neteco/pmdata/export/batch/download\",{taskName:e,fileName:t})},ce=async e=>{const t=window.top?window.top.neteco:window.neteco,n=[],r=await t.request.post({url:\"/rest/neteco/pm/v1/pmdata/export/batch/query\",headers:{\"X-QuerySignedUrl\":!0}});if(r){var i;if(\"data\"in r)null===(i=r.data)||void 0===i||i.forEach((e=>{n.push({taskId:e.taskName,taskName:e.taskName,createTime:re()(1e3*e.createTime).format(\"YYYY-MM-DD HH:mm:ss\"),status:e.status,url:e.url,finished:!0})}));else Object.entries(r).forEach((e=>{Object.entries(e[1]).forEach((t=>{const r=\"fail\"===e[0]?t[1].timeStamp:t[1];n.push({taskId:t[0],taskName:t[0],createTime:re()(1e3*r).format(\"YYYY-MM-DD HH:mm:ss\"),status:e[0],finished:!0})}))}));e({type:ae.iv,payload:n})}return n},ue=async e=>{const{code:t,data:n}=await(0,L.U2)(\"/rest/pvms/web/device/v1/basic-info-export/task\"),r=[],i={0:\"creating\",1:\"success\",2:\"fail\"};return 0===t&&n&&n.forEach((e=>r.push({taskId:e.taskId,taskName:e.taskName,createTime:re()(e.createTime).format(\"YYYY-MM-DD HH:mm:ss\"),status:i[e.state]}))),e({type:ae.FJ,payload:r}),r};function de(e,t){ce(e).then((e=>{-1===e.findIndex((e=>\"creating\"===e.status))&&clearInterval(t)})).catch((()=>{clearInterval(t)}))}const pe=async e=>{const t=await ce(e),n=setInterval((()=>{t?t.some((e=>\"creating\"===e.status))?de(e,n):clearInterval(n):de(e,n)}),2e3)},fe=async e=>{(0,L.Sv)(`/rest/pvms/web/device/v1/basic-info-export/download?taskId=${e}`)},he=async(e,t)=>{const{code:n,data:r}=await(0,L.IV)(`/rest/pvms/web/device/v1/basic-info-export/task?taskId=${e}`);0===n&&r?t.okCallbacks&&t.okCallbacks.forEach((e=>e())):t.failCallbacks&&t.failCallbacks.forEach((e=>e()))};async function me(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const[t,n]=await(0,b.AM)((0,L.v_)(\"/rest/pvms/web/device/v1/deviceExt/query-config-signal-tasks\",{...e}));if(t||null!=n&&n.code)return{};const{code:r}=n;return 0===r?{...n}:void 0}async function ge(e){const[t,n]=await(0,b.AM)((0,L.v_)(\"/rest/pvms/web/device/v1/deviceExt/get-config-signal-task\",{...e}));if(t||null!=n&&n.code)return{};const{code:r}=n;return 0===r?{...n,...e}:void 0}var ve=n(99073);const{TabPane:ye}=$.Z;class be extends p.Component{constructor(e){super(e),this.getParamDetailData=async()=>{const{parameterRecordData:e}=this.props,{taskId:t}=e,n={taskId:t},r=await ge(n);this.setState({detailSetParamData:r})},this.createBaseInfoModal=()=>{const{intl:e}=this.props,{detailSetParamData:t}=this.state,n=null==t?void 0:t.data,r=null==n?void 0:n.basic;return(0,N.jsxs)(\"div\",{children:[(0,N.jsxs)(X.Z,{className:\"base-info-device-modal\",children:[(0,N.jsx)(J.Z,{span:6,children:e.formatMessage({id:\"neteco.pvms.partials.main.column.deviceVersion\"})}),(0,N.jsx)(J.Z,{span:12,children:(null==r?void 0:r.deviceType)||ve.lH})]}),(0,N.jsxs)(X.Z,{className:\"base-info-device-modal\",children:[(0,N.jsx)(J.Z,{span:6,children:e.formatMessage({id:\"ncoPvSearchBar.label.model\"})}),(0,N.jsx)(J.Z,{span:12,children:(null==r?void 0:r.deviceModel)||ve.lH})]}),(0,N.jsxs)(X.Z,{className:\"base-info-device-modal\",children:[(0,N.jsx)(J.Z,{span:6,children:e.formatMessage({id:\"neteco.pvms.params.base.info.user.name\"})}),(0,N.jsx)(J.Z,{span:12,children:(null==r?void 0:r.user)||ve.lH})]}),(0,N.jsxs)(X.Z,{className:\"base-info-device-modal\",children:[(0,N.jsx)(J.Z,{span:6,children:e.formatMessage({id:\"neteco.pvms.inspect.task.startTime\"})}),(0,N.jsx)(J.Z,{span:12,children:null!=r&&r.startTime?re()(1e3*(null==r?void 0:r.startTime)).format(\"YYYY-MM-DD HH:mm:ss\"):ve.lH})]}),(0,N.jsxs)(X.Z,{className:\"base-info-device-modal\",children:[(0,N.jsx)(J.Z,{span:6,children:e.formatMessage({id:\"neteco.pvms.inspect.task.completTime\"})}),(0,N.jsx)(J.Z,{span:12,children:null!=r&&r.endTime?re()(1e3*(null==r?void 0:r.endTime)).format(\"YYYY-MM-DD HH:mm:ss\"):ve.lH})]}),(0,N.jsxs)(X.Z,{className:\"base-info-device-modal\",children:[(0,N.jsx)(J.Z,{span:6,children:e.formatMessage({id:\"neteco.pvms.devSupplement.status\"})}),(0,N.jsx)(J.Z,{span:12,children:this.dataStatusValue(null==r?void 0:r.status,r)})]})]})},this.dataStatusValue=(e,t)=>{const{intl:n}=this.props;return\"fail\"===e?(0,N.jsxs)(\"span\",{children:[(0,N.jsx)(\"i\",{className:\"icon-closed-filled\",style:{color:\"#F43146\",marginRight:\"0.4rem\",fontSize:\"16px\"}}),n.formatMessage({id:\"neteco.pvms.ivcurve.taskResultStatus.1\"})]}):\"success\"===e?(0,N.jsxs)(\"span\",{children:[(0,N.jsx)(\"i\",{className:\"icon-success-filled\",style:{color:\"#2DA769\",marginRight:\"0.4rem\",fontSize:\"16px\"}}),n.formatMessage({id:\"neteco.pvms.ivcurve.taskResultStatus.2\"})]}):\"partSuccess\"===e?(0,N.jsxs)(\"span\",{children:[(0,N.jsx)(\"i\",{className:\"icon-success-filled\",style:{color:\"#EEBA18\",marginRight:\"0.4rem\",fontSize:\"16px\"}}),n.formatMessage({id:\"nco.ui.upgrade.task.status_6\"})]}):\"running\"===e?(0,N.jsx)(\"span\",{children:(0,N.jsx)(oe.Z,{percent:t.progress})}):ve.lH},this.createChangeParamsModal=()=>{const{intl:e}=this.props,{detailParamPageCondition:t,detailSetParamData:n}=this.state,{page:r,pageSize:i}=t,o=null==n?void 0:n.data,a=null==o?void 0:o.parameter,s=null==o?void 0:o.parameterTotal;return(0,N.jsxs)(\"div\",{className:\"out-change-param-modal\",children:[(0,N.jsx)(B.Z,{className:\"change-param-modal\",columns:this.buildParametersColumn(e),dataSource:a,pagination:!1,onChange:this.onDetailChangeTable,scroll:{y:\"20rem\"}}),(0,N.jsx)(Z.Z,{size:\"small\",total:s,showSizeChanger:!0,showTotal:(0,H.Z)(e),current:r,pageSize:i,pageSizeOptions:[\"10\",\"20\",\"30\",\"50\",\"100\"],onChange:this.onDetailChangePage})]})},this.buildParametersColumn=e=>[{title:e.formatMessage({id:\"neteco.pvms.params.base.info.params.name\"}),dataIndex:\"parameter\",key:\"parameter\",sorter:!0,render:e=>e||ve.lH},{title:e.formatMessage({id:\"neteco.pvms.params.orignal.value\"}),dataIndex:\"originalValue\",key:\"originalValue\",render:e=>e||ve.lH},{title:e.formatMessage({id:\"neteco.pvms.params.target.value\"}),dataIndex:\"newValue\",key:\"newValue\",render:e=>e||ve.lH}],this.onDetailChangeTable=async(e,t,n)=>{const{taskId:r}=this.props.parameterRecordData,{field:i,order:o}=n,a={taskId:r,field:o?i:void 0,order:(0,b.kk)(o),parameterPage:1,parameterPageSize:10},s=await ge(a);this.setState({detailSetParamData:s,detailParamSortCondition:n,detailParamPageCondition:{page:1,pageSize:10}})},this.onDetailChangePage=async(e,t)=>{const{taskId:n}=this.props.parameterRecordData,{detailParamSortCondition:r}=this.state,i=e,o=t,{field:a,order:s}=r,l={taskId:n,parameterPage:i,parameterPageSize:o,field:s?a:void 0,order:(0,b.kk)(s)},c=await ge(l);this.setState({detailSetParamData:c,detailParamPageCondition:{page:i,pageSize:o}})},this.createChangeDeviceModal=()=>{const{intl:e}=this.props,{detailDevicePageCondition:t,detailSetParamData:n}=this.state,{page:r,pageSize:i}=t,o=null==n?void 0:n.data,a=null==o?void 0:o.device,s=null==o?void 0:o.deviceTotal;return(0,N.jsxs)(\"div\",{className:\"out-change-device-modal\",children:[(0,N.jsx)(B.Z,{className:\"change-device-modal\",columns:this.buildDeviceColumn(e),dataSource:a,pagination:!1,onChange:this.onDetailDeviceChangeTable,scroll:{y:\"20rem\"}}),(0,N.jsx)(Z.Z,{size:\"small\",total:s,showSizeChanger:!0,showTotal:(0,H.Z)(e),current:r,pageSize:i,pageSizeOptions:[\"10\",\"20\",\"30\",\"50\",\"100\"],onChange:this.onDetailDeviceChangePage})]})},this.buildDeviceColumn=e=>[{title:e.formatMessage({id:\"ncoEnergyStorageTable.column.device\"}),dataIndex:\"device\",key:\"device\",sorter:!0,render:e=>e||ve.lH},{title:e.formatMessage({id:\"ncoEnergyStorageTable.column.site\"}),dataIndex:\"station\",key:\"station\",render:e=>e||ve.lH},{title:e.formatMessage({id:\"neteco.pvms.devSupplement.status\"}),dataIndex:\"status\",key:\"status\",filters:[{text:e.formatMessage({id:\"neteco.pvms.ivcurve.taskResultStatus.1\"}),value:\"fail\"},{text:e.formatMessage({id:\"neteco.pvms.ivcurve.taskResultStatus.2\"}),value:\"success\"},{text:e.formatMessage({id:\"nco.ui.upgrade.task.status_6\"}),value:\"partSuccess\"},{text:e.formatMessage({id:\"neteco.pvms.stationMigrate.processing\"}),value:\"running\"}],render:(e,t)=>this.dataChangeDeviceStatusValue(e,t)}],this.dataChangeDeviceStatusValue=(e,t)=>{const{intl:n}=this.props;return\"fail\"===e?(0,N.jsxs)(\"span\",{children:[(0,N.jsx)(\"i\",{className:\"icon-closed-filled\",style:{color:\"#F43146\",marginRight:\"0.4rem\",fontSize:\"16px\"}}),n.formatMessage({id:\"neteco.pvms.ivcurve.taskResultStatus.1\"}),(0,N.jsx)(\"span\",{className:\"failed-tip\",children:(0,N.jsx)(O.Z,{title:n.formatMessage({id:t.failMsg}),children:(0,N.jsx)(\"i\",{className:\"icon-questionmark-circle-lined\",style:{marginLeft:\"0.4rem\",fontSize:\"16px\"}})})})]}):\"success\"===e?(0,N.jsxs)(\"span\",{children:[(0,N.jsx)(\"i\",{className:\"icon-success-filled\",style:{color:\"#2DA769\",marginRight:\"0.4rem\",fontSize:\"16px\"}}),n.formatMessage({id:\"neteco.pvms.ivcurve.taskResultStatus.2\"})]}):\"partSuccess\"===e?(0,N.jsxs)(\"span\",{children:[(0,N.jsx)(\"i\",{className:\"icon-success-filled\",style:{color:\"#EEBA18\",marginRight:\"0.4rem\",fontSize:\"16px\"}}),n.formatMessage({id:\"nco.ui.upgrade.task.status_6\"})]}):\"running\"===e?(0,N.jsxs)(\"span\",{children:[(0,N.jsx)(\"img\",{src:\"/pvmswebsite/assets/build/images/device/params-status-running.gif\",style:{color:\"#0067D1\",marginRight:\"0.4rem\",width:\"16px\"}}),n.formatMessage({id:\"neteco.pvms.stationMigrate.processing\"})]}):ve.lH},this.onDetailDeviceChangeTable=async(e,t,n)=>{const{taskId:r}=this.props.parameterRecordData,{field:i,order:o}=n,{status:a}=t,s={taskId:r,field:o?i:void 0,order:(0,b.kk)(o),status:a||void 0,devicePage:1,devicePageSize:10},l=await ge(s);this.setState({detailSetParamData:l,detailDeviceSortCondition:n,detailDevicePageCondition:{page:1,pageSize:10},detailParameterStatus:a||[]})},this.onDetailDeviceChangePage=async(e,t)=>{const{taskId:n}=this.props.parameterRecordData,{detailDeviceSortCondition:r,detailParameterStatus:i}=this.state,{field:o,order:a}=r,s=e,l=t,c={taskId:n,devicePage:s,devicePageSize:l,field:a?o:void 0,order:(0,b.kk)(a),status:i.length>0?i:void 0},u=await ge(c);this.setState({detailSetParamData:u,detailDevicePageCondition:{page:s,pageSize:l}})},this.refreshParamDetailData=async()=>{const{parameterRecordData:e}=this.props,{detailTabsKey:t,detailDevicePageCondition:n,detailDeviceSortCondition:r,detailParamSortCondition:i,detailParamPageCondition:o,detailParameterStatus:a}=this.state;this.setState({isRefresh:!0});const{taskId:s}=e;let l={taskId:s};if(\"changeParams\"===t){const{field:e,order:t}=i,{page:n,pageSize:r}=o;l.parameterPage=n,l.parameterPageSize=r,t&&(l.order=(0,b.kk)(t),l.field=e)}if(\"changeDevice\"===t){const{field:e,order:t}=r,{page:i,pageSize:o}=n;if(l.devicePage=i,l.devicePageSize=o,t&&(l.field=e,l.order=(0,b.kk)(t)),a.length>0){const e=a;l.status=e}}const c=await ge(l);this.setState({detailSetParamData:c,isRefresh:!1})},this.onChangeDetailTabs=e=>{this.setState({detailTabsKey:e})},this.state={detailSetParamData:{},detailParamPageCondition:{page:1,pageSize:10},detailDevicePageCondition:{page:1,pageSize:10},detailParamSortCondition:{},detailDeviceSortCondition:{},detailParameterStatus:[],detailTabsKey:void 0,isRefresh:!1}}componentDidMount(){this.getParamDetailData()}render(){const{intl:e,closeDetailParametersTaskList:t}=this.props,{isRefresh:n}=this.state;return(0,N.jsx)(K.Z,{className:\"nco-parameter-task-list-modal\",title:e.formatMessage({id:\"neteco.pvms.params.config.detail\"}),centered:!0,destroyOnClose:!0,visible:!0,onCancel:t(),footer:null,children:(0,N.jsxs)(\"div\",{children:[(0,N.jsx)(\"div\",{className:\"loading-mask\",style:{display:n?\"block\":\"none\"},children:(0,N.jsx)(\"span\",{children:(0,N.jsx)(\"img\",{src:\"/pvmswebsite/assets/build/images/device/params-status-running.gif\",className:\"params-status-running-img\"})})}),(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(\"div\",{className:\"right-fresh\",children:(0,N.jsxs)(ie.Z,{type:\"link\",onClick:this.refreshParamDetailData,disabled:n,children:[(0,N.jsx)(\"i\",{className:\"icon-refresh-clockwise-lined\"}),(0,N.jsx)(\"span\",{children:e.formatMessage({id:\"neteco.pvms.partials.main.dm.devParamMenu.refreshBtn\"})})]})}),(0,N.jsx)(\"div\",{className:\"left-tabs\",children:(0,N.jsxs)($.Z,{className:\"detail-info-tab\",onChange:this.onChangeDetailTabs,children:[(0,N.jsx)(ye,{tab:e.formatMessage({id:\"neteco.pvms.partials.main.io.dispersion_iv.basicInfo\"}),children:this.createBaseInfoModal()},\"basicInfo\"),(0,N.jsx)(ye,{tab:e.formatMessage({id:\"neteco.pvms.params.change.params\"}),children:this.createChangeParamsModal()},\"changeParams\"),(0,N.jsx)(ye,{tab:e.formatMessage({id:\"neteco.pvms.params.change.devices\"}),children:this.createChangeDeviceModal()},\"changeDevice\")]})})]})]})})}}const Se=(0,i.ZP)(be);var xe=n(69131);const{Item:we}=ee.Z,{RangePicker:Ce}=C.Z;class Te extends p.Component{constructor(e){super(e),this.getPollParamData=async()=>{const{setParameterTasks:e,parameterShowModal:t,queryParams:n}=this.state,r=null==e?void 0:e.data;0!==(null==r?void 0:r.filter((e=>\"running\"===e.status)).length)?t?b.B7.clearInterval():this.getPollData(n):b.B7.clearInterval()},this.refreshParamData=()=>{b.B7.setInterval(this.getPollParamData,xe.v.paramTaskList_getPollParamData)},this.getPollData=async e=>{const t=await me(e);this.setState({setParameterTasks:t})},this.getLoadSetParameterTasks=async()=>{const{queryParams:e}=this.state;this.getTaskData(e)},this.showParameterListModal=e=>{this.setState({parameterShowModal:!0,parameterRecordData:e})},this.closeParametersListModal=()=>{this.setState({parameterShowModal:!1})},this.buildColumns=e=>[{title:e.formatMessage({id:\"neteco.pvms.setting.data.repair.task.id\"}),dataIndex:\"id\",key:\"id\",sorter:!0,render:e=>e||ve.lH},{title:e.formatMessage({id:\"ncoHomeSearchBarView.label.stationDeviceTypes\"}),dataIndex:\"deviceType\",key:\"deviceType\",render:e=>e||ve.lH},{title:e.formatMessage({id:\"ncoPvSearchBar.label.model\"}),dataIndex:\"deviceModel\",key:\"deviceModel\",render:e=>e||ve.lH},{title:e.formatMessage({id:\"neteco.pvms.params.base.info.user.name\"}),dataIndex:\"user\",key:\"user\",render:e=>e||ve.lH},{title:e.formatMessage({id:\"neteco.pvms.inspect.task.startTime\"}),dataIndex:\"startTime\",key:\"startTime\",sorter:!0,render:e=>e?re()(1e3*e).format(\"YYYY-MM-DD HH:mm:ss\"):ve.lH},{title:e.formatMessage({id:\"neteco.pvms.upgrade.heads.completeTime\"}),dataIndex:\"endTime\",key:\"endTime\",sorter:!0,render:e=>e?re()(1e3*e).format(\"YYYY-MM-DD HH:mm:ss\"):ve.lH},{title:e.formatMessage({id:\"neteco.pvms.devSupplement.status\"}),dataIndex:\"status\",key:\"status\",filters:[{text:e.formatMessage({id:\"neteco.pvms.ivcurve.taskResultStatus.1\"}),value:\"fail\"},{text:e.formatMessage({id:\"neteco.pvms.ivcurve.taskResultStatus.2\"}),value:\"success\"},{text:e.formatMessage({id:\"nco.ui.upgrade.task.status_6\"}),value:\"partSuccess\"},{text:e.formatMessage({id:\"neteco.pvms.stationMigrate.processing\"}),value:\"running\"}],render:(e,t)=>this.dataStatusValue(e,t)},{title:e.formatMessage({id:\"common.label.action\"}),dataIndex:\"detail\",key:\"detail\",render:(e,t)=>this.getDetailRender(e,t)}],this.getDetailRender=(e,t)=>{const{intl:n}=this.props;return(0,N.jsx)(\"span\",{style:{cursor:\"pointer\"},title:n.formatMessage({id:\"neteco.pvms.inspect.view.taskDetail\"}),onClick:()=>this.showParameterListModal(t),children:(0,N.jsx)(\"i\",{className:\"icon-view-information-lined\"})})},this.dataStatusValue=(e,t)=>{const{intl:n}=this.props;return\"fail\"===e?(0,N.jsxs)(\"span\",{children:[(0,N.jsx)(\"i\",{className:\"icon-closed-filled\",style:{color:\"#F43146\",marginRight:\"0.4rem\",fontSize:\"16px\"}}),n.formatMessage({id:\"neteco.pvms.ivcurve.taskResultStatus.1\"})]}):\"success\"===e?(0,N.jsxs)(\"span\",{children:[(0,N.jsx)(\"i\",{className:\"icon-success-filled\",style:{color:\"#2DA769\",marginRight:\"0.4rem\",fontSize:\"16px\"}}),n.formatMessage({id:\"neteco.pvms.ivcurve.taskResultStatus.2\"})]}):\"partSuccess\"===e?(0,N.jsxs)(\"span\",{children:[(0,N.jsx)(\"i\",{className:\"icon-success-filled\",style:{color:\"#EEBA18\",marginRight:\"0.4rem\",fontSize:\"16px\"}}),n.formatMessage({id:\"nco.ui.upgrade.task.status_6\"})]}):\"running\"===e?(0,N.jsx)(\"span\",{children:(0,N.jsx)(oe.Z,{percent:t.progress})}):ve.lH},this.onChangePage=async(e,t)=>{const{queryParams:n}=this.state,r={...n,page:e,pageSize:t};this.getTaskData(r)},this.onChangeTable=async(e,t,n)=>{const{field:r,order:i}=n,{status:o}=t,{queryParams:a}=this.state,s={...a,order:(0,b.kk)(i),field:i?r:void 0,status:o||void 0,page:1,pageSize:10};this.getTaskData(s)},this.onSearch=async e=>{var t;const n=null==e||null===(t=e.searchName)||void 0===t?void 0:t.trim(),r=null!=e&&e.rangeTime?parseInt((null==e?void 0:e.rangeTime[0].valueOf())/1e3):void 0,i=null!=e&&e.rangeTime?parseInt((null==e?void 0:e.rangeTime[1].valueOf())/1e3):void 0,{queryParams:o}=this.state,a={...o,user:\"\"===n?void 0:n,startTime:r,endTime:i,page:1};this.getTaskData(a)},this.getTaskData=async e=>{const t=await me(e);this.setState({setParameterTasks:t,queryParams:e})},this.disabledDate=e=>e&&e>re()().endOf(\"day\"),this.state={setParameterTasks:{},parameterShowModal:!1,parameterRecordData:{},queryParams:{user:void 0,startTime:void 0,endTime:void 0,order:void 0,field:void 0,status:void 0,page:1,pageSize:10}}}componentDidMount(){this.getLoadSetParameterTasks(),this.refreshParamData()}componentWillUnmount(){b.B7.clearInterval()}render(){const{intl:e}=this.props,{setParameterTasks:t,parameterShowModal:n,parameterRecordData:r,queryParams:i}=this.state,{page:o,pageSize:a}=i,s=null==t?void 0:t.total,l=null==t?void 0:t.data;return(0,N.jsxs)(\"div\",{children:[(0,N.jsxs)(ee.Z,{className:\"task-form\",onFinish:this.onSearch,children:[(0,N.jsx)(we,{className:\"searchName\",name:\"searchName\",children:(0,N.jsx)(T.Z,{placeholder:e.formatMessage({id:\"neteco.pvms.params.input.user.name\"})})}),(0,N.jsx)(we,{className:\"rangeTime\",name:\"rangeTime\",label:e.formatMessage({id:\"ncoPatrolSearchBar.label.startTime\"}),children:(0,N.jsx)(Ce,{format:\"YYYY-MM-DD HH:mm:ss\",showTime:!0,disabledDate:this.disabledDate})}),(0,N.jsx)(we,{className:\"button-search\",children:(0,N.jsx)(ie.Z,{type:\"primary\",htmlType:\"submit\",children:e.formatMessage({id:\"common.button.search\"})})})]}),(0,N.jsx)(B.Z,{columns:this.buildColumns(e),dataSource:l,pagination:!1,onChange:this.onChangeTable,scroll:{y:\"25.625rem\"}}),(0,N.jsx)(Z.Z,{size:\"small\",total:s,showSizeChanger:!0,current:o,pageSize:a,pageSizeOptions:[\"10\",\"20\",\"30\",\"50\",\"100\"],showTotal:(0,H.Z)(e),onChange:this.onChangePage}),n&&(0,N.jsx)(Se,{parameterRecordData:r,closeDetailParametersTaskList:()=>this.closeParametersListModal})]})}}const Ae=(0,i.ZP)(Te);var Ee=n(80770),Oe=n(20178),Me=n(65227),Pe=n(34731),De=n(15075),Ie=n(88490),Ne=n(50606),_e=n(33734),je=n(9381),ke=n(61337),Le=n(49100),Re=n(5083);class Ze extends p.Component{constructor(e){super(e),this.loadEMMATasks=async e=>{const t=await(0,ke._2)(e);(0,b.xb)(t)||this.setState({total:(null==t?void 0:t.total)||0,allEMMATask:(null==t?void 0:t.data)||[]})},this.pollingTasks=async()=>{const{allEMMATask:e}=this.state;0!==e.filter((e=>\"RUNNING\"===e.status||\"WAITING\"===e.status)).length?this.loadEMMATasks({pageNo:this.state.pageNo,pageSize:this.state.pageSize}):b.B7.clearInterval()},this.refreshEMMATasks=()=>{b.B7.setInterval(this.pollingTasks,xe.v.emmaMigrateTaskRunningStatusRefresh)},this.buildColumns=()=>{const{intl:e}=this.props;return[{title:e.formatMessage({id:\"ncoEnergyStorageTable.column.site\"}),dataIndex:\"stationName\",key:\"stationName\",ellipsis:!0,width:\"25%\",render:e=>e||ve.lH},{title:e.formatMessage({id:\"neteco.pvms.stationMigrate.creator\"}),dataIndex:\"userName\",key:\"userName\",ellipsis:!0,width:\"20%\",render:e=>e||ve.lH},{title:e.formatMessage({id:\"neteco.pvms.device.management.emma.network.reconstruction.task.create.time.column\"}),dataIndex:\"createTime\",key:\"createTime\",ellipsis:!0,width:\"25%\",render:e=>e?re()(1e3*e).format(\"YYYY/MM/DD HH:mm:ss\"):ve.lH},{title:e.formatMessage({id:\"neteco.pvms.devSupplement.status\"}),dataIndex:\"status\",key:\"status\",width:\"20%\",render:(e,t)=>this.dataStatusValue(e,t)},{title:e.formatMessage({id:\"common.label.action\"}),dataIndex:\"detail\",key:\"detail\",width:\"10%\",render:(e,t)=>this.renderActionDom(e,t)}]},this.buildSubColumns=()=>{const{intl:e}=this.props;return[{title:e.formatMessage({id:\"neteco.pvms.device.management.emma.network.reconstruction.source.device.name.column\"}),dataIndex:\"srcDeviceName\",key:\"srcDeviceName\",ellipsis:!0,width:\"20%\",render:e=>e||ve.lH},{title:e.formatMessage({id:\"neteco.pvms.device.management.emma.network.reconstruction.target.device.last.device.name\"}),dataIndex:\"srcParentName\",key:\"srcParentName\",ellipsis:!0,width:\"20%\",render:e=>e||ve.lH},{title:e.formatMessage({id:\"neteco.pvms.device.management.emma.network.reconstruction.target.device.last.device.sn\"}),dataIndex:\"srcParentSn\",key:\"srcParentSn\",ellipsis:!0,width:\"20%\",render:e=>e||ve.lH},{title:e.formatMessage({id:\"neteco.pvms.device.management.emma.network.reconstruction.target.device\"}),dataIndex:\"dstDeviceName\",key:\"dstDeviceName\",width:\"40%\",ellipsis:!0,render:e=>e||ve.lH}]},this.renderActionDom=(e,t)=>{const{intl:n}=this.props;return\"FAILED\"===(null==t?void 0:t.status)?(0,N.jsxs)(\"div\",{children:[(0,N.jsx)(Le.Z,{operationId:[g.aOL],intl:n,title:n.formatMessage({id:\"neteco.pvms.upgrade.upgradeCencle.button.reset\"}),onClick:()=>this.secondaryAuthenticationOfRetryTask(t),targetId:[t.stationDn],targetType:\"plant\",type:\"icon\",children:(0,N.jsx)(Pe.Z,{})}),(0,N.jsx)(Le.Z,{targetId:[t.stationDn],targetType:\"plant\",type:\"icon\",operationId:[g.aOL],intl:n,title:n.formatMessage({id:\"neteco.pvms.configuration.delete\"}),onClick:()=>this.delTaskModal(t),className:\"emma-task-delete\",children:(0,N.jsx)(De.Z,{})})]}):(0,N.jsx)(N.Fragment,{})},this.delTaskModal=e=>{const{intl:t}=this.props;(0,Ee.ST)(t.formatMessage({id:\"neteco.pvms.partials.main.hp.poverty.confimeToDel\"}),(()=>this.deleteTask(e)))},this.secondaryAuthenticationOfRetryTask=e=>{const t={successCallback:t=>{this.retryTask(e,t.check)},errorCallback:()=>{}};(0,s.Nu)(\"use-verify-pass\",t)},this.retryTask=async(e,t)=>{const{intl:n}=this.props,r=await(0,ke.u7)(e.taskId,t);null!=r&&r.success?((0,Ee.Sb)(n.formatMessage({id:\"common.message.success\"})),this.loadEMMATasks({pageNo:this.state.pageNo,pageSize:this.state.pageSize})):r.status?(0,Ee.lU)(n.formatMessage({id:\"neteco.pvms.returned.partes.interface.err\"})):(0,Ee.lU)(r.failedMsg)},this.deleteTask=async e=>{const{intl:t}=this.props,n=await(0,ke.H)(e.taskId);null!=n&&n.success?((0,Ee.Sb)(t.formatMessage({id:\"neteco.pvms.alarmTemp.deleteSuccess\"})),this.loadEMMATasks({pageNo:this.state.pageNo,pageSize:this.state.pageSize})):n.status?(0,Ee.lU)(t.formatMessage({id:\"neteco.pvms.returned.partes.interface.err\"})):(0,Ee.lU)(n.failedMsg)},this.dataStatusValue=(e,t)=>{const{intl:n}=this.props;return\"FAILED\"===e?(0,N.jsxs)(\"span\",{children:[(0,N.jsx)(Ie.Z,{className:\"dp-failed-alert\"}),n.formatMessage({id:\"neteco.pvms.stationMigrate.stationStatus.143\"})]}):\"SUCCESS\"===e?(0,N.jsxs)(\"span\",{children:[(0,N.jsx)(Ne.Z,{className:\"dp-success-alert\"}),n.formatMessage({id:\"neteco.pvms.stationMigrate.stationStatus.255\"})]}):\"WAITING\"===e?(0,N.jsx)(\"span\",{children:n.formatMessage({id:\"neteco.pvms.device.management.emma.network.reconstruction.task.status.waiting\"})}):\"RUNNING\"===e?(0,N.jsx)(\"span\",{children:(0,N.jsx)(oe.Z,{percent:t.progress})}):ve.lH},this.onChangePage=async(e,t)=>{const n={pageNo:e,pageSize:t};this.loadEMMATasks(n),this.setState({pageNo:e,pageSize:t,expandedKeys:[],expandedChild:new Map})},this.expandedRowRender=e=>{const{expandedChild:t}=this.state,n=t.get(e.taskId);return(0,N.jsx)(_e.Z,{rowClassName:(e,t)=>t%2==0?\"odd-row\":\"even-row\",columns:this.buildSubColumns(),dataSource:n,pagination:!1})},this.onExpand=(e,t)=>{if(e)-1===this.state.expandedKeys.indexOf(t.taskId)&&(this.setState({expandedKeys:[...this.state.expandedKeys,t.taskId]}),this.loadSubTask(t.taskId));else{const{expandedKeys:e}=this.state;e.indexOf(t.taskId)>=0&&(e.splice(e.indexOf(t.taskId),1),this.setState({expandedKeys:e}))}},this.loadSubTask=async e=>{const t=await(0,ke.bJ)(e);if(!(0,b.xb)(t)){const{expandedChild:n}=this.state,r=n;r.set(e,t.data),this.setState({expandedChild:r})}},this.state={pageNo:1,pageSize:10,total:0,allEMMATask:[],expandedKeys:[],expandedChild:new Map}}componentDidMount(){const e={pageNo:this.state.pageNo,pageSize:this.state.pageSize};this.loadEMMATasks(e),this.refreshEMMATasks()}componentWillUnmount(){b.B7.clearInterval()}render(){const{intl:e}=this.props,{pageNo:t,pageSize:n,total:r,allEMMATask:i}=this.state;return(0,N.jsxs)(\"div\",{className:\"nco-emma-migrate-tasks\",children:[(0,N.jsx)(_e.Z,{columns:this.buildColumns(),dataSource:i,pagination:!1,scroll:{y:\"32.5rem\"},rowKey:\"taskId\",expandedRowRender:this.expandedRowRender,rowClassName:(e,t)=>t%2==0?\"odd-row\":\"even-row\",expandable:{expandedRowKeys:this.state.expandedKeys},onExpand:async(e,t)=>this.onExpand(e,t)}),(0,N.jsx)(je.Z,{className:\"nco-emma-migration-pagination\",total:r,showSizeChanger:!0,totalFixedLeft:!0,current:t,pageSize:n,pageSizeOptions:[\"10\",\"20\",\"30\",\"50\",\"100\"],showTotal:()=>e.formatMessage({id:\"neteco.pvms.station.subarray.pagination.total\"},{total:r}),onChange:this.onChangePage}),(0,N.jsx)(Re.Z,{})]})}}const Be=(0,i.ZP)(Ze);var Fe=n(24301),ze=n(29912),Ve=n(13450),He=n(64854),Ue=n(18801);const Ge={loading:1,success:2,partSuccess:3,failed:4},Ye=new Map([[Ge.loading,{msg:\"neteco.pvms.station.physical.import.smartDesign.syncing\",color:\"#5990FD\"}],[Ge.success,{msg:\"neteco.pvms.ivcurve.taskResultStatus.2\",color:\"#2DA769\"}],[Ge.partSuccess,{msg:\"nco.ui.upgrade.task.status_6\",color:\"#EC6F1A\"}],[Ge.failed,{msg:\"neteco.pvms.ivcurve.taskResultStatus.1\",color:\"#F43146\"}]]),We=e=>{const{intl:t}=e,[n,r]=(0,p.useState)([]),[i,o]=(0,p.useState)({totalSize:0,pageSize:10,pageIndex:1}),a=(0,f.k6)(),s=new Map([[D.o.STRING_INVERTER,{path:h.D.deviceInverterConfig.path,name:\"neteco.pvms.configuration.inverter\"}],[D.o.DONGLE,{path:h.D.deviceDongleConfig.path,name:\"neteco.pvms.devTypeLangKey.dongleCommunicateModel\"}],[D.o.HEMS,{path:h.D.deviceSubmatrixConfig.path,name:\"neteco.pvms.devTypeLangKey.EMMA\"}],[D.o.PCS,{path:h.D.devicePCSConfig.path,name:\"neteco.pvms.devTypeLangKey.PCS\"}]]);(0,p.useEffect)((()=>{l(i)}),[]);const l=async e=>{let t=[],n=0;try{const{records:r,totalCount:i}=await async function(e){const{pageSize:t,pageIndex:n}=e,[r,i]=await(0,b.AM)((0,L.U2)(`/rest/dp/pvms/device/v1/device-replace/sync-tasks?pageStart=${n}&pageSize=${t}`));return i||{}}(e);t=r,n=i}finally{r(t),o({...e,totalSize:n})}},c=e=>e?re()(e).format(\"YYYY-MM-DD HH:mm:ss\"):ve.lH,u=[{title:`${t.formatMessage({id:\"neteco.pvms.device.management.replace.device.stationName\"})}`,key:\"stationName\",dataIndex:\"stationName\",ellipsis:!0,width:150},{title:`${t.formatMessage({id:\"neteco.pvms.device.management.replace.device.deviceType\"})}`,dataIndex:\"mocId\",ellipsis:!0,width:100,key:\"mocId\",render:e=>{const n=s.has(e)?s.get(e).name:\"\";return n?t.formatMessage({id:n}):ve.lH}},{title:`${t.formatMessage({id:\"neteco.pvms.device.management.replace.device.fromSn\"})}`,dataIndex:\"fromSn\",ellipsis:!0,width:200,key:\"fromSn\"},{title:`${t.formatMessage({id:\"neteco.pvms.device.management.replace.device.toSn\"})}`,dataIndex:\"toSn\",ellipsis:!0,width:200,key:\"toSn\"},{title:`${t.formatMessage({id:\"neteco.pvms.device.management.replace.device.syncUser\"})}`,dataIndex:\"syncUser\",key:\"syncUser\",ellipsis:!0,width:200},{title:(0,N.jsxs)(\"div\",{className:\"nco-device-task-sync-status-table-title\",children:[(0,N.jsx)(\"div\",{className:\"nco-device-task-sync-status-table-msg\",title:`${t.formatMessage({id:\"neteco.pvms.device.management.replace.device.syncStatus\"})}`,children:`${t.formatMessage({id:\"neteco.pvms.device.management.replace.device.syncStatus\"})}`}),(0,N.jsx)(Fe.Z,{title:t.formatMessage({id:\"neteco.pvms.device.management.replace.device.status.tip\"}),children:(0,N.jsx)(I.Z,{className:\"icon-dp-alert-hints-lined\"})})]}),width:150,dataIndex:\"syncStatus\",key:\"syncStatus\",render:e=>{const n=Ye.has(e)?Ye.get(e):{};return(0,N.jsx)(ze.Z,{color:`${n.color}1A`,style:{color:n.color},title:t.formatMessage({id:n.msg}),children:t.formatMessage({id:n.msg})})}},{title:`${t.formatMessage({id:\"neteco.pvms.device.management.replace.device.startTime\"})}`,dataIndex:\"startTime\",key:\"startTime\",ellipsis:!0,width:200,render:c},{title:`${t.formatMessage({id:\"neteco.pvms.device.management.replace.device.endTime\"})}`,dataIndex:\"endTime\",key:\"endTime\",ellipsis:!0,width:200,render:c},{title:`${t.formatMessage({id:\"common.label.action\"})}`,key:\"operation\",fixed:\"right\",width:100,render:(e,n)=>(0,N.jsx)(N.Fragment,{children:n.syncStatus!==Ge.loading&&(0,N.jsxs)(\"div\",{children:[(0,N.jsx)(Fe.Z,{title:t.formatMessage({id:\"common.button.download\"}),children:(0,N.jsx)(Ve.Z,{className:\"icon-button\",type:\"text\",icon:(0,N.jsx)(He.Z,{}),onClick:()=>{(async function(e){return(0,L.Sv)(\"/rest/dp/pvms/device/v1/device-replace/sync-task-detail\",{taskId:e},{method:\"GET\"})})(n.taskId).catch((e=>{(0,Ee.A)(t.formatMessage({id:\"neteco.pvms.station.availability.download.failed\"}))}))}})}),[Ge.failed,Ge.partSuccess].includes(n.syncStatus)&&(0,N.jsx)(Fe.Z,{title:t.formatMessage({id:\"neteco.pvms.device.management.replace.device.config.tip\"}),children:(0,N.jsx)(Ve.Z,{className:\"icon-button\",type:\"text\",icon:(0,N.jsx)(Ue.Z,{}),onClick:()=>{const{mocId:e,dn:t}=n;s.has(e)&&a.push((0,h.n)(s.get(e).path,t))}})})]})})}],{totalSize:d,pageSize:m,pageIndex:g}=i;return(0,N.jsxs)(\"div\",{className:\"nco-device-task-sync-param-content\",children:[(0,N.jsx)(_e.Z,{dataSource:n,columns:u,pagination:!1,scroll:{x:1300,y:\"27rem\"}}),(0,N.jsx)(je.Z,{className:\"nco-device-task-sync-param-pagination\",total:d,showSizeChanger:!0,totalFixedLeft:!0,pageSize:m,current:g,onChange:async(e,t)=>{await l({pageIndex:e,pageSize:t})},pageSizeOptions:[\"10\",\"20\",\"50\",\"100\"],showTotal:(0,H.Z)(t)})]})};var Ke=n(44772);const{Item:qe}=ee.Z,{RangePicker:Qe}=C.Z,{TabPane:Xe}=$.Z,Je=\"byToday\",$e=\"byRecentOneWeek\",et=\"byRecentOneMonth\",tt=\"bySelfDefine\",nt=new Map([[Me.oc.PARAMTER_SETTING_TASK,\"neteco.pvms.params.saving.time\"],[Me.oc.REPLACE_DEVICE,\"neteco.pvms.device.management.replace.device.table.msg\"]]);class rt extends p.Component{constructor(e){super(e),this.resetDateRange=()=>{this.setDatesMoment([re()(),re()()]),this.setState({rangTimeDisabled:!0})},this.setDatesMoment=e=>{this.setState({dates:e})},this.handleStartExportTask=()=>{const{startExportTask:e,exportConfig:t,intl:n,startLithiumCellExportTask:r}=this.props,{hideAsyncTaskTaskModal:i,simpleInsts:o,isBatteryGroupModal:a=!1}=t,s=this.formRef.current;s.validateFields().then((t=>{const{operationFailed:s}=Y.Z,l=t.time[0],c=t.time[1],u=((e,t,n)=>{const r=[];return e.valueOf()>t.valueOf()&&r.push(n.formatMessage({id:\"neteco.pvms.stationInfo.addStation.priceSettingList.plInputCorrectDate\"})),{errors:r}})(l,c,n);if(u.errors.length>0)return void s(n,u.errors[0]);const d=new Date(l.valueOf()),p=new Date(c.valueOf()),f=[{taskName:t.taskName,startTime:parseInt(l.valueOf()/1e3)-60*d.getTimezoneOffset(),endTime:parseInt(c.valueOf()/1e3)-60*p.getTimezoneOffset(),keepUnfixedTime:!1,enableDisplayExp:!1,fileSplitMode:t.fileSplitMode,granularity:t.granularity,timezone:(new Intl.DateTimeFormat).resolvedOptions().timeZone,simpleInsts:o},{okCallbacks:[()=>this.showTaskListModal(\"Performance\"),()=>{i([this.resetDateRange])}],failCallbacks:[e=>{(0,Ee.jT)(null==e?void 0:e.extraInfo)}]}];a?r(...f):e(...f)})).catch((e=>{const{errorFields:t}=e;s.scrollToField(t[0].name)}))},this.showTaskListModal=async e=>{const{loadExportTasks:t,startLoadExportBasicTasks:n,startLoadExportPerformanceTasks:r}=this.props;n(),r();const i=await(0,ke._2)({pageNo:1,pageSize:10}),o=(null==i?void 0:i.total)>0;this.setState({taskListModalVisible:!0,basicTaskTabVisible:(\"Basic\"===e||\"All\"===e)&&(0,g.lVp)(g.OmA),performTaskTabVisible:(\"Performance\"===e||\"All\"===e)&&(0,g.lVp)(g.O7P),parameterSettingsVisible:(\"Parameter\"===e||\"All\"===e)&&(0,g.lVp)(g.qS6),emmaNetReconstructionTabVisible:(\"emmaNetworkReconstruction\"===e||\"All\"===e)&&(0,g.lVp)(g.tur)&&o,replaceDeviceTaskVisible:\"All\"===e||\"replaceDevice\"===e})},this.hideExportTaskListModal=()=>{this.setState({taskListModalVisible:!1});const{clearExportTasks:e,exportConfig:{hideTaskListModal:t=()=>{}}}=this.props;t(),e()},this.hideFileListModalVisible=()=>{this.showTaskListModal(\"All\"),this.setState({fileListModalVisible:!1})},this.openMultiFileModal=e=>{let{taskName:t,fileNames:n}=e;this.setState({fileListModalVisible:!0,taskListModalVisible:!1,taskName:t,fileNames:n})},this.disabledDate=e=>{const{dates:t}=this.state;if(!t||0===t.length)return!1;const{exportConfig:n={}}=this.props,{gap:r=\"DAY\"}=n,i=\"DAY\"===r?31:365,o=t[0]&&e.diff(t[0],\"days\",!0)>i,a=t[1]&&t[1].diff(e,\"days\",!0)>i;return o||a},this.onRangePickerChange=(e,t)=>{this.currentTime=e;const n=this.formRef.current,r=n.getFieldValue(\"time\");r&&!r[0]&&r[1]||n.setFieldsValue({time:this.currentTime})},this.onOpenChange=e=>{const t=this.formRef.current;e&&(t.setFieldsValue({time:[]}),this.setState({dates:[]}))},this.downloadPerformance=e=>{(0,L.Md)(\"/rest/neteco/pm/v1/pmdata/export/download/files\",{taskName:e}).then((t=>{const{fileNames:n,fileSize:r}=t;if(1!==r)r>0&&this.openMultiFileModal({taskName:e,fileNames:n});else{const[t]=n;this.props.downloadTaskFile(e,t)}})).catch()},this.downloadUrlPerformance=async e=>{var t;const{fetchExportTasks:n}=this.props,r=null===(t=(await n()).find((t=>t.taskName===e.taskName)))||void 0===t?void 0:t.url;if(r)try{const t=neteco.util.iUnescape(r),n=window.top.document.createElement(\"a\");n.href=t,n.download=e.taskName,n.style.display=\"none\",window.top.document.body.appendChild(n),n.click(),window.top.document.body.removeChild(n)}catch(e){}},this.onChangeRangTime=e=>{const t=this.formRef.current,n=e.target.value;if(n===tt)this.setState({rangTimeDisabled:!1});else{this.setState({rangTimeDisabled:!0});let e=[];n===Je?e=[re()().startOf(\"day\"),re()().endOf(\"day\")]:n===$e?e=[re()().subtract(1,\"week\").startOf(\"day\"),re()().endOf(\"day\")]:n===et&&(e=[re()().subtract(1,\"month\").startOf(\"day\"),re()().endOf(\"day\")]),this.setState({dates:e}),t.setFieldsValue({time:e})}},this.createTaskListModal=(e,t)=>{const{intl:n,loadExportTasks:r,loadExportBasicTasks:i,downloadBasicTaskFile:o,deleteTask:a,deleteBasicTask:s}=this.props,l=\"Basic\"===t?i:r,c=\"Basic\"===t?s:a;return(0,N.jsxs)(\"div\",{children:[(0,N.jsxs)(X.Z,{className:\"row-header\",children:[(0,N.jsx)(J.Z,{span:8,children:n.formatMessage({id:\"neteco.pvms.inspect.task.taskName\"})}),(0,N.jsx)(J.Z,{span:8,children:n.formatMessage({id:\"neteco.pvms.superviseSetting.weakCommandList.createTime\"})}),(0,N.jsxs)(J.Z,{span:8,children:[n.formatMessage({id:\"neteco.pvms.systemSetting.amendment.taskStatus\"}),\"/\",n.formatMessage({id:\"neteco.pvms.upgrade.devOperate\"})]})]}),(0,N.jsx)(\"div\",{className:\"task-list-wrapper\",children:0===e.length?(0,N.jsx)(Q.Z,{className:\"task-list-empty\",image:\"/pvmswebsite/assets/build/images/station/noData.png\",description:n.formatMessage({id:\"neteco.pvms.noData\"})}):e.sort(((e,t)=>t.createTime.localeCompare(e.createTime))).map((e=>(0,N.jsxs)(X.Z,{className:\"content-vertical-center row-body\",children:[(0,N.jsx)(J.Z,{span:8,children:(0,N.jsx)(\"div\",{className:\"task-name-div\",title:e.taskName,children:e.taskName})}),(0,N.jsx)(J.Z,{span:8,children:e.createTime}),(0,N.jsx)(J.Z,{span:8,children:(0,Oe.c)(e,n,{downloadFile:()=>{(0,Ee.ST)(n.formatMessage({id:\"neteco.download.confirm.tip\"}),\"Basic\"===t?()=>{o(e.taskId)}:()=>{e.url?this.downloadUrlPerformance(e):this.downloadPerformance(e.taskName)})},deleteTask:e=>{(0,Ee.ST)(n.formatMessage({id:\"neteco.pvms.partials.main.hp.poverty.confimeToDel\"}),(()=>{c(e,{okCallbacks:[l],failCallbacks:[()=>{}]})}))}})})]},e.taskId)))})]})},this.renderTaskName=()=>{const{intl:e}=this.props,t=e.formatMessage({id:\"neteco.pvms.regionname.invalidchar.new\"});return(0,N.jsx)(X.Z,{children:(0,N.jsx)(J.Z,{span:24,children:(0,N.jsx)(qe,{name:\"taskName\",rules:[{required:!0,message:e.formatMessage({id:\"neteco.pvms.input.required\"})},{pattern:/^[^'<>,|/&\"“”，()（）+{}%`~*?=;#\\\\.·‘’'\\\\{\\\\}\\\\[\\]]*$/,message:t},{validator:(t,n)=>n.length>32?Promise.reject(e.formatMessage({id:\"common.message.maxLength\"},{maxLength:\"32\"})):n.indexOf(\"null\")>=0?Promise.reject(e.formatMessage({id:\"neteco.pvms.systemSetting.enterprise.nameCheck\"})):Promise.resolve()},(0,Ke.MF)(t)],validateFirst:!0,label:e.formatMessage({id:\"neteco.pvms.systemSetting.amendment.taskName\"}),children:(0,N.jsx)(T.Z,{size:\"large\"})})})})},this.renderExportType=()=>{const{intl:e}=this.props;return(0,N.jsx)(X.Z,{children:(0,N.jsx)(J.Z,{span:24,children:(0,N.jsx)(qe,{name:\"fileSplitMode\",label:e.formatMessage({id:\"neteco.pvms.setting.data.repair.export.type\"}),rules:[{required:!0,message:e.formatMessage({id:\"neteco.pvms.input.required\"})}],children:(0,N.jsxs)(q.ZP.Group,{children:[(0,N.jsx)(q.ZP,{value:\"BY_DEVINST\",children:e.formatMessage({id:\"neteco.pvms.setting.data.repair.export.byDevice\"})}),(0,N.jsx)(q.ZP,{value:\"BY_DEVTYPE\",children:e.formatMessage({id:\"neteco.pvms.setting.data.repair.export.byDevinst\"})})]})})})})},this.renderExportTime=()=>{const{intl:e}=this.props;return(0,N.jsx)(X.Z,{children:(0,N.jsx)(J.Z,{span:24,children:(0,N.jsx)(qe,{name:\"granularity\",label:e.formatMessage({id:\"neteco.pvms.setting.data.repair.export.samplingInterval\"}),rules:[{required:!0,message:e.formatMessage({id:\"neteco.pvms.input.required\"})}],children:(0,N.jsxs)(q.ZP.Group,{children:[(0,N.jsx)(q.ZP,{value:300,children:e.formatMessage({id:\"neteco.pvms.setting.data.repair.export.timeRange\"},{minutes:5})}),(0,N.jsx)(q.ZP,{value:900,children:e.formatMessage({id:\"neteco.pvms.setting.data.repair.export.timeRange\"},{minutes:15})}),(0,N.jsx)(q.ZP,{value:1800,children:e.formatMessage({id:\"neteco.pvms.setting.data.repair.export.timeRange\"},{minutes:30})}),(0,N.jsx)(q.ZP,{value:3600,children:e.formatMessage({id:\"neteco.pvms.setting.data.repair.export.timeRange2\"})})]})})})})},this.renderRangTime=()=>{const{intl:e}=this.props;return(0,N.jsx)(X.Z,{children:(0,N.jsx)(J.Z,{span:24,children:(0,N.jsxs)(qe,{name:\"time\",label:e.formatMessage({id:\"neteco.pvms.setting.data.repair.rang.time\"}),rules:[{required:!0,message:e.formatMessage({id:\"neteco.pvms.input.required\"})}],children:[(0,N.jsxs)(q.ZP.Group,{onChange:this.onChangeRangTime,defaultValue:Je,className:\"rang-time-radio\",children:[(0,N.jsx)(q.ZP,{value:Je,children:e.formatMessage({id:\"neteco.pvms.upgrade.heads.upgradeTime.today\"})}),(0,N.jsx)(q.ZP,{value:$e,children:e.formatMessage({id:\"com.huawei.neteco.pm.ui.pmview.msg.time.range.select.week\"})}),(0,N.jsx)(q.ZP,{value:et,children:e.formatMessage({id:\"neteco.pvms.dispersionRate.recentOneMonth\"})}),(0,N.jsx)(q.ZP,{value:tt,children:e.formatMessage({id:\"neteco.pvms.partials.main.dm.devStringDetail.selfDefine\"})})]}),(0,N.jsxs)(\"div\",{className:\"export-range-time\",children:[(0,N.jsx)(Qe,{disabled:this.state.rangTimeDisabled,disabledDate:this.disabledDate,size:\"large\",onCalendarChange:e=>{this.setState({dates:[e[0]&&e[0].startOf(\"day\"),e[1]&&e[1].endOf(\"day\")]})},onChange:this.onRangePickerChange.bind(this),onOpenChange:this.onOpenChange.bind(this),value:this.state.dates}),(0,N.jsx)(\"div\",{className:\"export-range-time-tip\",children:(0,N.jsx)(O.Z,{title:e.formatMessage({id:\"neteco.pvms.save.time.hour.tip.new\"}),children:(0,N.jsx)(\"i\",{className:\"icon-questionmark-circle-lined\"})})})]})]})})})},this.renderCreateTask=()=>{const{exportConfig:e,intl:t}=this.props,{shouldShowCreateAsyncTaskModal:n,hideAsyncTaskTaskModal:r}=e;return(0,N.jsx)(\"div\",{className:\"nco-export-pm-data-create-export-task\",children:(0,N.jsx)(K.Z,{className:\"nco-export-pm-data-create-export-task-modal\",visible:n,onCancel:()=>r([this.resetDateRange]),title:t.formatMessage({id:\"neteco.pvms.systemSetting.logManage.export\"}),centered:!0,width:\"40rem\",onOk:()=>{this.handleStartExportTask()},destroyOnClose:!0,maskClosable:!1,children:(0,N.jsx)(\"div\",{children:(0,N.jsxs)(ee.Z,{ref:this.formRef,layout:\"vertical\",initialValues:{time:[re()().startOf(\"day\"),re()().endOf(\"day\")],fileSplitMode:\"BY_DEVINST\",granularity:300,taskName:re()().format(\"YYYYMMDDhhmmss\")},children:[this.renderTaskName(),this.renderRangTime(),this.renderExportTime(),this.renderExportType()]})})})})},this.renderFileList=()=>{const{intl:e}=this.props,{fileListModalVisible:t,taskName:n,fileNames:r=[]}=this.state;return(0,N.jsx)(\"div\",{className:\"nco-file-list-wrapper\",children:(0,N.jsx)(K.Z,{className:\"nco-file-list-modal\",visible:t,onCancel:this.hideFileListModalVisible,footer:(0,N.jsx)(\"div\",{style:{marginBottom:\"10px\",textAlign:\"left\"},children:e.formatMessage({id:\"neteco.pvms.device.data.pack.too.big\"})}),centered:!0,maskClosable:!1,destroyOnClose:!0,width:\"60rem\",title:e.formatMessage({id:\"neteco.pvms.documentManage.download\"}),children:(0,N.jsxs)(\"div\",{children:[(0,N.jsxs)(X.Z,{className:\"row-header\",children:[(0,N.jsx)(J.Z,{span:16,children:e.formatMessage({id:\"neteco.pvms.documentManage.column.fileName\"})}),(0,N.jsx)(J.Z,{span:8,children:e.formatMessage({id:\"neteco.pvms.documentManage.download\"})})]}),(0,N.jsx)(\"div\",{className:\"task-list-wrapper\",children:r.map((t=>(0,N.jsxs)(X.Z,{className:\"content-vertical-center row-body\",children:[(0,N.jsx)(J.Z,{span:16,children:t}),(0,N.jsx)(J.Z,{span:8,children:it(e,{downloadFile:()=>{this.props.downloadTaskFile(n,t)}})})]},t)))})]})})})},this.onchangeTabs=e=>{this.setState({defaultActiveKey:e})},this.renderTaskList=()=>{const{intl:e,ncoMonitorExportDeviceData:t={},exportConfig:n}=this.props,{exportTasks:r=[],exportBasicTasks:i=[]}=t,{taskListModalVisible:o,basicTaskTabVisible:a,performTaskTabVisible:s,parameterSettingsVisible:l,replaceDeviceTaskVisible:c,emmaNetReconstructionTabVisible:u,defaultActiveKey:d}=this.state,p=[a,s,l,u,c].filter((e=>e)).length>=2,f=nt.has(d)?nt.get(d):\"pvms.device.image.maximum.support.saving\",h=d===Me.oc.EMMA_MIGRATION?null:(0,N.jsx)(\"div\",{style:{marginBottom:\"10px\",textAlign:\"left\"},children:e.formatMessage({id:f})});return(0,N.jsx)(\"div\",{className:\"nco-async-tasks-list-wrapper\",children:(0,N.jsx)(K.Z,{className:p?\"nco-async-task-list-modal-data\":\"nco-async-task-list-modal\",title:p?e.formatMessage({id:\"neteco.pvms.partials.main.io.tabNames.3\"}):\"\",open:o,onCancel:this.hideExportTaskListModal,footer:h,centered:!0,maskClosable:!1,destroyOnClose:!0,width:a&&s?\"77rem\":\"60rem\",children:(0,N.jsxs)($.Z,{className:\"export-device-data-tab\",onChange:this.onchangeTabs,defaultActiveKey:d,destroyInactiveTabPane:!0,children:[a&&(0,N.jsx)(Xe,{tab:e.formatMessage({id:\"ncoPvToolbar.label.exportBasic\"}),children:this.createTaskListModal(i,\"Basic\")},Me.oc.BASIC_MESSAGE),s&&(0,N.jsx)(Xe,{tab:e.formatMessage({id:\"ncoPvToolbar.label.exportPerformanceData\"}),children:this.createTaskListModal(r,\"Performance\")},Me.oc.PERFORMANCE_DATA),l&&(0,N.jsx)(Xe,{tab:e.formatMessage({id:\"ncoPvToolbar.label.parameterSettings\"}),children:(0,N.jsx)(Ae,{})},Me.oc.PARAMTER_SETTING_TASK),u&&(0,N.jsx)(Xe,{tab:e.formatMessage({id:\"neteco.pvms.device.management.emma.network.reconstruction.button.new\"}),children:(0,N.jsx)(Be,{})},Me.oc.EMMA_MIGRATION),c&&(0,N.jsx)(Xe,{tab:e.formatMessage({id:\"neteco.pvms.device.management.replace.device.tab\"}),children:(0,N.jsx)(We,{intl:e})},Me.oc.REPLACE_DEVICE)]})})})},this.formRef=(0,p.createRef)(),this.currentTime=[],this.state={exportPmDataTaskModalVisible:!1,fileListModalVisible:!1,taskListModalVisible:!1,basicTaskTabVisible:!0,performTaskTabVisible:!0,parameterSettingsVisible:!0,replaceDeviceTaskVisible:!0,dates:[re()().startOf(\"day\"),re()().endOf(\"day\")],rangTimeDisabled:!0,emmaNetReconstructionTabVisible:!1,defaultActiveKey:Me.oc.BASIC_MESSAGE}}componentDidUpdate(e){this.props.exportConfig.activeKey&&this.props.exportConfig.activeKey!==e.exportConfig.activeKey&&([Me.oc.EMMA_MIGRATION,Me.oc.PARAMTER_SETTING_TASK,Me.oc.REPLACE_DEVICE].includes(this.props.exportConfig.activeKey)?(this.showTaskListModal(\"All\"),this.onchangeTabs(this.props.exportConfig.activeKey)):(this.showTaskListModal(\"Basic\"),this.onchangeTabs(this.props.exportConfig.activeKey)))}componentWillUnmount(){this.timer&&(clearInterval(this.timer),this.timer=void 0)}componentDidMount(){const{loadNcoExportDeviceData:e}=this.props;e()}render(){const{intl:e}=this.props,t=[g.OmA,g.O7P,g.qS6];return(0,N.jsxs)(\"div\",{className:\"nco-export-pm-data-task\",children:[this.renderCreateTask(),this.renderFileList(),this.renderTaskList(),(0,g.agq)(t)&&(0,N.jsx)(\"div\",{onClick:()=>this.showTaskListModal(\"All\"),className:\"task-list-short-cut\",draggable:!0,title:e.formatMessage({id:\"neteco.pvms.partials.main.io.tabNames.3\"})})]})}}const it=(e,t)=>{let{downloadFile:n}=t;return(0,N.jsx)(\"div\",{className:\"click-gap\",children:(0,N.jsx)(\"a\",{onClick:()=>n(),title:e.formatMessage({id:\"neteco.pvms.documentManage.download\"}),children:(0,N.jsx)(te.Z,{})})})},ot=(0,i.ZP)(rt),at=(0,r.$j)((e=>({ncoMonitorExportDeviceData:e.ncoMonitorExportDeviceData})),(e=>({loadNcoExportDeviceData:()=>{(async e=>{e({type:ae.Mb}),e({type:ae.T_,payload:void 0})})(e)},startExportTask:(t,n)=>{(async(e,t,n)=>{const r=await(0,L.Md)(\"/rest/neteco/pm/v1/pmdata/export/batch\",{batchExportConditionString:JSON.stringify(t)});r&&r.result?(n&&n.okCallbacks&&n.okCallbacks.forEach((e=>e())),pe(e)):n&&n.failCallbacks&&n.failCallbacks.forEach((e=>e(r)))})(e,t,n)},startLithiumCellExportTask:(t,n)=>{(async(e,t,n)=>{const r=await(0,L.Md)(\"/rest/neteco/bms/v1/energy-storage/battery/export/batch\",{batchExportConditionString:JSON.stringify(t)});r&&r.result?(n&&n.okCallbacks&&n.okCallbacks.forEach((e=>e())),pe(e)):n&&n.failCallbacks&&n.failCallbacks.forEach((e=>e()))})(e,t,n)},loadExportTasks:()=>{ce(e)},fetchExportTasks:async()=>ce(e),loadExportBasicTasks:()=>{ue(e)},startLoadExportBasicTasks:()=>{(e=>{ue(e);const t=setInterval((()=>{ue(e).then((e=>{-1===e.findIndex((e=>\"creating\"===e.status))&&clearInterval(t)})).catch((()=>{clearInterval(t)}))}),2e3)})(e)},startLoadExportPerformanceTasks:()=>{pe(e)},clearExportTasks:()=>{(e=>{e({type:ae.VE})})(e)},downloadTaskFile:le,deleteTask:se,downloadBasicTaskFile:fe,deleteBasicTask:he})))((0,i.ZP)(ot));n(16426);const st=e=>({width:{small:e,big:e},maxWidth:{small:e,big:e}}),lt=(e,t,n,r)=>({tableWidth:{small:e,big:t},tableHeight:{small:n,big:r}}),ct={devRunningState:{width:{small:130,big:130},maxWidth:{small:100,big:100}},devName:{width:{small:210,big:210},maxWidth:{small:200,big:200}},stationName:{width:{small:210,big:210},maxWidth:{small:200,big:200}},softwareVersion:st(180),upLevelDeviceName:st(200),esn:st(200),parentDeviceName:st(200),devTypeId:st(200),sim:st(180),bindUsers:st(180),warrantExpDeadlineDate:st(150),stationGridTime:st(150),stationType:st(120),location:st(120),company:st(120),action:{...st(100),fixed:\"right\"}},ut={...lt(1100,1100,300,550),columns:{...ct,devRunningState:st(30),devName:st((0,M.ux)()?30:40),stationName:st(30),mocTypeName:st(30),softwareVersion:st((0,M.ux)()?40:80),upLevelDeviceName:st((0,M.ux)()?30:60),esn:{width:{small:(0,M.ux)()?30:60,big:(0,M.ux)()?30:60},maxWidth:{small:30,big:30}},parentDeviceName:st(30),devTypeId:st(30),sim:st(30),bindUsers:st(30),stationGridTime:st(30),stationType:st(30),location:st(50),company:st(30),action:{...st(30),fixed:\"right\"}}},dt={...lt(1e3,1e3,300,550),columns:{...ct,mocTypeName:st(150)}},pt={...lt(1e3,1e3,300,550),columns:{...ct,devRunningState:st(170),mocTypeName:st(180)}},ft={...lt(1e3,1e3,300,550),columns:{...ct,devRunningState:st(140),mocTypeName:st(150),sim:st(150)}},ht={...lt(1e3,1e3,300,550),columns:{...ct,mocTypeName:st(280)}},mt={...lt(1e3,1e3,300,550),columns:{...ct,mocTypeName:st(200)}},gt={...lt(1e3,1e3,300,550),columns:{...ct,devRunningState:{width:{small:150,big:150},maxWidth:{small:100,big:100}},mocTypeName:st(180)}},vt={...lt(1e3,1e3,300,550),columns:{...ct,devRunningState:st(110),mocTypeName:st(180)}},yt={...lt(1e3,1e3,300,550),columns:{...ct,mocTypeName:st(200)}},bt={...lt(1e3,1e3,300,550),columns:{...ct,mocTypeName:st(180)}},St=e=>{switch(e){case\"de-de\":return pt;case\"en-us\":default:return dt;case\"zh-cn\":return ut;case\"es-es\":return ft;case\"fr-fr\":return ht;case\"it-it\":return mt;case\"pt-br\":return yt;case\"ja-jp\":return bt;case\"nl-nl\":return gt;case\"pl-pl\":return vt}},xt=(0,M.ej)(\"locale\")||\"zh-cn\",wt={devRunningState:{width:{small:96,big:96}},devName:{width:{small:190,big:200}},stationName:{width:{small:140,big:170}},mocTypeName:{width:{small:90,big:100}},softwareVersion:{width:{small:145,big:185}},upLevelDeviceName:{width:{small:190,big:200}},esn:{width:{small:160,big:186}},parentDeviceName:{width:{small:190,big:200}},devTypeId:{width:{small:150,big:170}},sim:{width:{small:120,big:120}},bindUsers:{width:{small:120,big:120}},warrantExpDeadlineDate:{width:{small:150,big:150}},stationGridTime:{width:{small:150,big:150}},stationType:{width:{small:120,big:120}},location:{width:{small:120,big:120}},company:{width:{small:120,big:120}},action:{width:{small:100,big:100},fixed:\"right\"}},Ct={tableHeight:{small:230,big:480},columns:{...wt,devRunningState:{width:{small:70,big:80}},mocTypeName:{width:{small:80,big:80}},sim:{width:{small:80,big:80}},bindUsers:{width:{small:80,big:90}},warrantExpDeadlineDate:{width:{small:100,big:100}},action:{width:{small:80,big:80},fixed:\"right\"}}},Tt={tableHeight:{small:230,big:480},columns:{...wt,devRunningState:{width:{small:66,big:66}},devName:{width:{small:140,big:170}},softwareVersion:{width:{small:210,big:250}},upLevelDeviceName:{width:{small:150,big:150}},warrantExpDeadlineDate:{width:{small:170,big:170}}}},At={tableHeight:{small:230,big:480},columns:{...wt,devRunningState:{width:{small:106,big:106}},devName:{width:{small:140,big:170}},softwareVersion:{width:{small:210,big:250}},upLevelDeviceName:{width:{small:150,big:150}},sim:{width:{small:150,big:150}},bindUsers:{width:{small:150,big:150}}}},Et={tableHeight:{small:230,big:480},columns:{...wt,mocTypeName:{width:{small:100,big:110}},sim:{width:{small:180,big:180}},bindUsers:{width:{small:180,big:180}},warrantExpDeadlineDate:{width:{small:180,big:180}}}},Ot={tableHeight:{small:230,big:480},columns:{...wt,mocTypeName:{width:{small:100,big:120}},sim:{width:{small:126,big:150}},bindUsers:{width:{small:126,big:150}}}},Mt={tableHeight:{small:230,big:480},columns:{...wt,mocTypeName:{width:{small:150,big:170}},sim:{width:{small:180,big:180}},bindUsers:{width:{small:180,big:180}}}},Pt={tableHeight:{small:230,big:480},columns:{...wt,devRunningState:{width:{small:86,big:86}},mocTypeName:{width:{small:96,big:116}},warrantExpDeadlineDate:{width:{small:136,big:136}}}},Dt={tableHeight:{small:230,big:480},columns:{...wt,devRunningState:{width:{small:126,big:126}},mocTypeName:{width:{small:120,big:120}},sim:{width:{small:170,big:170}},bindUsers:{width:{small:180,big:180}}}},It={tableHeight:{small:230,big:480},columns:{...wt,mocTypeName:{width:{small:120,big:150}},sim:{width:{small:150,big:170}},bindUsers:{width:{small:150,big:170}}}},Nt={tableHeight:{small:230,big:480},columns:{...wt,devRunningState:{width:{small:116,big:116}},mocTypeName:{width:{small:150,big:170}},sim:{width:{small:160,big:180}},bindUsers:{width:{small:160,big:180}},warrantExpDeadlineDate:{width:{small:160,big:180}}}},_t={tableHeight:{small:230,big:480},columns:{...wt,devName:{width:{small:140,big:170}},softwareVersion:{width:{small:210,big:250}},upLevelDeviceName:{width:{small:150,big:150}},warrantExpDeadlineDate:{width:{small:146,big:146}}}},jt={tableHeight:{small:230,big:480},columns:{...wt,devRunningState:{width:{small:86,big:86}},devName:{width:{small:140,big:170}},softwareVersion:{width:{small:210,big:250}},upLevelDeviceName:{width:{small:150,big:150}}}},kt={tableHeight:{small:230,big:480},columns:{...wt,mocTypeName:{width:{small:100,big:100}},bindUsers:{width:{small:166,big:166}},warrantExpDeadlineDate:{width:{small:170,big:170}}}},Lt={tableHeight:{small:230,big:480},columns:{...wt,devRunningState:{width:{small:80,big:80}},mocTypeName:{width:{small:80,big:80}},sim:{width:{small:106,big:106}},bindUsers:{width:{small:106,big:106}},warrantExpDeadlineDate:{width:{small:128,big:138}},action:{width:{small:80,big:80},fixed:\"right\"}}},Rt={tableHeight:{small:230,big:480},columns:{...wt,devRunningState:{width:{small:76,big:76}},mocTypeName:{width:{small:90,big:90}},softwareVersion:{width:{small:105,big:105}},esn:{width:{small:186,big:186}},devTypeId:{width:{small:170,big:170}},sim:{width:{small:122,big:122}},bindUsers:{width:{small:106,big:106}},warrantExpDeadlineDate:{width:{small:120,big:120}},action:{width:{small:70,big:70},fixed:\"right\"}}},Zt={tableHeight:{small:230,big:480},columns:{...wt,devRunningState:{width:{small:80,big:80}},mocTypeName:{width:{small:80,big:80}},sim:{width:{small:122,big:122}},bindUsers:{width:{small:106,big:106}},warrantExpDeadlineDate:{width:{small:116,big:116}},action:{width:{small:80,big:80},fixed:\"right\"}}},Bt=e=>{switch(e){case\"zh-cn\":return Ct;case\"en-us\":default:return Tt;case\"de-de\":return At;case\"es-es\":return Et;case\"fr-fr\":return Ot;case\"it-it\":return Mt;case\"hu-hu\":return Pt;case\"nl-nl\":return Dt;case\"pl-pl\":return It;case\"pt-br\":return Nt;case\"vi-vn\":return _t;case\"tr-tr\":return jt;case\"uk-ua\":return kt;case\"zh-tw\":return Lt;case\"ja-jp\":return Rt;case\"ko-kr\":return Zt}},Ft=e=>{let t=e?Bt(xt):St(xt),n=(0,v.ax)()?\"small\":\"big\";return{xScroll:Object.values(t.columns).reduce(((e,t)=>e+t.width[n]),0),yScroll:(0,v.ax)()?t.tableHeight.small:t.tableHeight.big}},zt=function(e){return((e,t)=>({fixed:e.columns[t].fixed,width:(0,v.ax)()?e.columns[t].width.small:e.columns[t].width.big,ellipsis:!0,render:n=>(0,v.QM)(n,(0,v.ax)()?e.columns[t].width.small:e.columns[t].width.big)}))(arguments.length>1&&void 0!==arguments[1]&&!arguments[1]?St(xt):Bt(xt),e)};var Vt=n(34428);const{sendLithiumCellExportData:Ht}=m.Z,Ut=\"LOAD_LITHIUM_CELL_DATA_LIST\",Gt=\"GET_CURRENT_BATTERY\",Yt=\"GET_CURRENT_SIGNALS\",Wt=\"INIT_CHECKED_LIST\",Kt=\"ON_CHECK_ALL_CHANGE\",qt=\"GET_SIGNALS_DATA\",Qt=(e,t)=>{const{payload:n}=t;switch(t.type){case Ut:return{...e,lithiumCellDataList:n};case Gt:return{...e,currentBattery:n};case Yt:return{...e,checkedList:n.list,indeterminate:n.indeterminate,checkAll:n.checkAll};case Wt:return{...e,checkedList:e.signalsData.idList,checkAll:!0,indeterminate:!1};case Kt:return{...e,checkedList:n.checkedList,checkAll:n.checkAll};case qt:return{...e,signalsData:n}}},Xt=e=>{let{visible:t,hide:n,batteryDataList:r,checkoutComponent:i,intl:o}=e;const a=o.formatMessage({id:\"neteco.pvms.devEport.selectSign\"}),s=o.formatMessage({id:\"neteco.device.type.battery.module\"}),l=o.formatMessage({id:\"neteco.pvms.devTypeLangKey.lithiumCell\"}),{data:c=[],options:u}=r,d={currentBattery:c[0],lithiumCellDataList:{},checkedList:[],checkAll:!0,indeterminate:!1,signalsData:{}},[f,h]=(0,p.useReducer)(Qt,d),{currentBattery:m,lithiumCellDataList:g,checkedList:v,checkAll:y,indeterminate:b,signalsData:S}=f,{dnList:x=[]}=g,{options:w=[],idList:C=[],dnIds:T,deviceType:A}=S,{dn:E}=m||{};return(0,p.useEffect)((()=>{h({type:Wt})}),[C.length,E]),(0,p.useEffect)((()=>{(async(e,t)=>{const{data:n}=await(0,L.U2)(\"/rest/neteco/web/config/device/v1/children-list\",{\"conditionParams.parentDn\":t.dn,\"conditionParams.curPage\":0,\"conditionParams.recordperpage\":500,\"conditionParams.mocTypes\":\"20843\"});n&&n.sort(((e,t)=>e.name.length===t.name.length?e.name.localeCompare(t.name):e.name.length-t.name.length)),e({type:Ut,payload:{data:n,dnList:n?n.map((e=>e.dn)):[]}})})(h,m)}),[E]),(0,p.useEffect)((()=>{(async(e,t)=>{const n={dns:t,filterKeyWords:[\"\",null]},r=new Set(t),i=JSON.stringify(n),o=await(0,L.Md)(\"/rest/pvms/web/pmdata/v1/instances/types\",{generalInsQueryCondString:i}),a=o.moTypes.concat(o.mocTypes).map((e=>{const t=e.deviceType||{};return e.simpleMOs.map((e=>({...e,...t})))})).flatMap((e=>e)).filter((e=>r.has(e.dn))).reduce(((e,t)=>(t.mocId in e?e[t.mocId].push(t):e[t.mocId]=[t],e)),{}),s=Object.entries(a).map((e=>({deviceType:{mocId:e[0],mocName:e[1][0].mocName},dns:e[1].map((e=>e.dn)),dnIds:e[1].map((e=>e.dnId)),enableDisplayExp:!1}))),l=JSON.stringify(s),c=(await(0,L.Md)(\"/rest/pvms/web/pmdata/v1/counters\",{queryCounterTypesString:l})).map((e=>({type:e.deviceType.mocId,typeNameAndDns:s.find((t=>String(t.deviceType.mocId)===String(e.deviceType.mocId))),counters:e.stdCountersByName.map((e=>e.counters)).flatMap((e=>e)).filter((e=>{let{moc:t}=e;return t})).map((e=>{let{counterId:t,counterName:n}=e;return{counterId:t,counterName:n}}))}))),u=[];c.forEach((e=>u.push(...e.typeNameAndDns.dnIds))),e({type:qt,payload:{options:c[0]&&c[0].counters.map((e=>({label:e.counterName,value:e.counterId}))),idList:c[0]&&c[0].counters.map((e=>e.counterId)),dnIds:u,deviceType:c[0]&&c[0].typeNameAndDns.deviceType}})})(h,x)}),[x.length]),(0,N.jsx)(K.Z,{width:\"60rem\",title:a,visible:t,onCancel:n,okButtonProps:{disabled:!(v&&v.length>0)},onOk:()=>{i(),(()=>{const e=[{deviceType:A,dnIdList:T,counterIds:v}];Ht.next(e)})()},children:!!u.length&&(0,N.jsxs)(p.Fragment,{children:[(0,N.jsx)(\"h3\",{style:{fontSize:\"1.2rem\"},children:s}),(0,N.jsx)(q.ZP.Group,{style:{width:\"100%\",marginBottom:\"0.5rem\"},onChange:e=>{h({type:Ut,payload:{dnList:[]}});const t=((e,t)=>t.filter((t=>{let{dnId:n}=t;return n===e.target.value}))[0])(e,c);((e,t)=>{e({type:Gt,payload:t})})(h,t)},defaultValue:u[0].value,children:(0,N.jsx)(X.Z,{children:u.map((e=>(0,N.jsx)(J.Z,{span:8,style:{marginBottom:\"0.5rem\"},children:(0,N.jsx)(q.ZP,{value:e.value,children:e.label})},e.value)))})}),!!w.length&&!!C.length&&(0,N.jsxs)(p.Fragment,{children:[(0,N.jsx)(\"br\",{}),(0,N.jsx)(\"h3\",{style:{fontSize:\"1.2rem\"},children:l}),(0,N.jsx)(Vt.Z,{style:{marginBottom:\"0.5rem\"},indeterminate:b,onChange:e=>{const t=e.target.checked?C:[];h({type:Kt,payload:{checkedList:t,checkAll:e.target.checked}})},checked:y,children:o.formatMessage({id:\"neteco.pvms.household.selectAll\"})}),(0,N.jsx)(\"br\",{}),(0,N.jsx)(Vt.Z.Group,{onChange:e=>{const t=!!e.length&&e.length<C.length,n=e.length===C.length;h({type:Yt,payload:{list:e,indeterminate:t,checkAll:n}})},defaultValue:C,value:v,style:{width:\"100%\"},children:(0,N.jsx)(X.Z,{children:w.map((e=>(0,N.jsx)(J.Z,{span:8,style:{marginBottom:\"0.5rem\"},children:(0,N.jsx)(Vt.Z,{value:e.value,children:e.label})},e.value)))})})]})]})})};var Jt=n(4071),$t=n(78939),en=n(50832);const{Option:tn}=E.Z,{operationSuccess:nn,operationFailed:rn}=Y.Z;class on extends p.Component{constructor(e){super(e),this.isSolarMeter=(e,t)=>(0,s.QL)(e)&&!(0,s.Ek)(e,t),this.handleSubmit=()=>{const{modifyDevice:e}=this.props,t=this.formRef.current,n=t.getFieldsValue([\"deviceName\"]),r=t.getFieldsValue([\"paramValues\"]);this.setState({btnLoading:!0}),e(t,{deviceName:n.deviceName,paramValues:r.paramValues},(()=>{this.setState({failMessageVisible:!0}),this.setState({btnLoading:!1})}))},this.closeFailMessage=()=>{this.setState({failMessageVisible:!1})},this.getDeviceBriefData=e=>{if(e){const{devName:t,esn:n,mocTypeName:r,mocId:i,paramValues:o,typeId:a}=e;return{devName:t,esn:n,type:r,mocId:i,softVersion:o[50010],paramValues:o,typeId:a}}return{}},this.meterDirectionModal=()=>{(0,Ee.CD)(this.props.intl.formatMessage({id:\"neteco.pvms.partials.main.dm.meterDirectionRevMsg\"}),this.setMeterDirectionModal)},this.setMeterDirectionModal=()=>{this.setState({btnLoading:!0});const{intl:e,deviceDn:t,meterDirectionValue:n,device:r}=this.props;let i=0;[\"0\",\"1\"].includes(n)&&(i=Number(!Number(n))),this.isMeter23023(r)&&(i=2);const o=[{id:\"20005\",value:i}];(0,L.Md)(\"/rest/neteco/config/device/v1/config/set-signal\",{dn:t,changeValues:JSON.stringify(o)}).then((t=>{this.setState({btnLoading:!1}),0===t.code?nn(e,e.formatMessage({id:\"neteco.pvms.superviseSetting.DomainnameManagerList.updateSuccess\"})):rn(e,e.formatMessage({id:\"neteco.pvms.superviseSetting.serviceCommandList.failed\"}))})).catch((()=>{this.setState({btnLoading:!1})}))},this.isMeter23023=e=>(0,M.jA)()&&23023===Number(null==e?void 0:e.typeId),this.getMeterLabelByLanguage=()=>{const{device:e,intl:t}=this.props;let n=t.formatMessage({id:\"neteco.pvms.partials.main.dm.meterDirectionChange\"});return this.isMeter23023(e)&&(n=t.formatMessage({id:\"neteco.pvms.meterDirectionChange.dataCorrection\"})),n},this.getLabelWrapperWidth=()=>{let e=12,t=8;const n=window.neteco.i18n.getLocale();return\"zh-cn\"!==n&&(t=10,\"it-it\"===n&&(t=13,e=11),\"es-es\"===n&&(t=12)),{lableWidth:t,wrapperWidth:e}},this.onDeviceNameBlur=e=>{this.formRef.current.setFieldsValue({deviceName:e.target.value.trim()})},this.formRef=(0,p.createRef)(),this.state={failMessageVisible:!1,meterDirectionVisible:!1,btnLoading:!1,isSharedStation:!1}}componentDidMount(){const{deviceDn:e}=this.props;(0,G.PW)(e).then((e=>{e.data&&(0,M.EV)()&&this.setState({isSharedStation:!0})}))}componentDidUpdate(e){const{meterUsageValue:t}=this.props;if(e.meterUsageValue!==t){const e=(0,W.r)(t)?t:\"\";this.formRef.current.setFieldsValue({paramValues:e})}}render(){const{device:e,deviceIp:t,visible:n,intl:r,hide:i,meterUsageEdit:o,meterDirectionEdit:a,meterUsageDisplay:l,meterUsageName:c,meterUsageEnumList:u,meterUsageValue:d,actionLoading:p}=this.props,{failMessageVisible:f,meterDirectionVisible:h,setMeterLoading:m,btnLoading:g,isSharedStation:y}=this.state,{devName:b,esn:S,type:x,softVersion:w,mocId:C,typeId:M}=this.getDeviceBriefData(e),{lableWidth:P,wrapperWidth:D}=this.getLabelWrapperWidth(),I={labelCol:{xs:{span:P},sm:{span:P}},wrapperCol:{xs:{span:D},sm:{span:D}}},_=this.isSolarMeter(C,M)&&c&&!(\"0\"===d&&!o)&&l,j=new RegExp(\"['<>,/&\\\"“”，‘’'|]\");return(0,N.jsx)(K.Z,{className:\"nco-device-modify-modal\",title:r.formatMessage({id:\"common.button.modify\"}),width:\"35rem\",visible:n,onCancel:i,footer:null,centered:!0,maskClosable:!1,children:(0,N.jsx)(A.Z,{spinning:p,children:(0,N.jsxs)(\"div\",{className:\"nco-pv-modify-device-form-wrapper\",children:[(0,N.jsxs)(ee.Z,{className:\"nco-pv-modify-device-form\",ref:this.formRef,children:[(0,N.jsx)(ee.Z.Item,{name:\"deviceName\",initialValue:window.neteco.util.iUnescape(b)||\"\",rules:[{required:!0,message:r.formatMessage({id:\"ncoPvModifyDeviceForm.message.deviceName.notEmpty\"})},{validator:(e,t,n)=>{t&&0===t.trim().length&&n(r.formatMessage({id:\"ncoPvModifyDeviceForm.message.deviceName.notEmpty\"})),t&&(t.indexOf(\"null\")>=0||j.test(t))&&n(r.formatMessage({id:\"neteco.pvms.stationInfo.addStation.devNameCheck\"}));const i=(new TextEncoder).encode(t).length;(0,s.zg)(C)?i>16&&t!==(window.neteco.util.iUnescape(b)||\"\")&&n(r.formatMessage({id:\"neteco.pvms.validator.maxlength\"},{0:16})):b!==t&&i>20&&n(r.formatMessage({id:\"neteco.pvms.validator.maxlength\"},{0:20})),n()}}],...I,label:r.formatMessage({id:\"neteco.pvms.devEms.heads.devName\"}),children:(0,N.jsx)(T.Z,{onBlur:this.onDeviceNameBlur,disabled:y})}),S&&(0,N.jsx)(ee.Z.Item,{...I,label:r.formatMessage({id:\"ncoPvModifyDeviceForm.label.sn\"}),children:S}),((0,v.hy)(C)||(0,v.lS)(C))&&(0,N.jsx)(ee.Z.Item,{...I,label:r.formatMessage({id:\"neteco.pvms.cascadedInverter.hostAddress\"}),children:t||ve.lH}),(0,N.jsx)(ee.Z.Item,{...I,label:r.formatMessage({id:\"ncoPvModifyDeviceForm.label.deviceType\"}),children:x||ve.lH}),_&&(0,N.jsx)(ee.Z.Item,{...I,name:\"paramValues\",initialValue:(0,W.r)(d)?d:\"\",label:c,rules:[{required:o}],children:(0,N.jsxs)(E.Z,{virtual:!1,disabled:!o,children:[(0,N.jsx)(tn,{value:\"usage\",disabled:!0,style:{color:\"#000\"},children:r.formatMessage({id:\"neteco.pvms.stationInfo.addStation.pleaseSelect\"})}),u.map(((e,t)=>{const n=Object.keys(e)[0];return\"NA\"===e[n]?(0,N.jsx)(N.Fragment,{}):(0,N.jsx)(tn,{value:n,children:e[n]},t)}))]})}),this.isSolarMeter(C,M)&&(0,N.jsxs)(ee.Z.Item,{...I,name:\"meterDirection\",label:r.formatMessage({id:\"neteco.pvms.partials.main.dm.meterDirection\"}),children:[(0,N.jsx)(ie.Z,{type:\"primary\",onClick:this.meterDirectionModal,children:this.getMeterLabelByLanguage()}),this.isMeter23023(e)&&(0,N.jsx)(O.Z,{title:\"该功能用于纠正数采下电表异常导致的数采数据错误，如数据上报正常请勿使用\",children:(0,N.jsx)(Jt.Z,{className:\"question-circle-icon\"})})]}),w&&a&&(0,N.jsx)(ee.Z.Item,{...I,label:r.formatMessage({id:\"ncoNewDeviceManagement.label.softwareVersion\"}),children:w}),(0,N.jsxs)(\"div\",{className:\"nco-pv-modify-device-form-buttons\",children:[(0,N.jsx)(ie.Z,{onClick:i,children:r.formatMessage({id:\"common.button.cancel\"})}),(0,N.jsx)(ie.Z,{type:\"primary\",onClick:this.handleSubmit,loading:g,children:r.formatMessage({id:\"common.button.ok\"})})]})]}),(0,N.jsx)(en.Z,{type:\"prompt\",centered:!0,visible:f,content:(0,N.jsx)(\"div\",{children:r.formatMessage({id:\"neteco.pvms.dataCollector.esnModbus.6\"})}),footer:(0,N.jsx)(ie.Z,{type:\"primary\",onClick:this.closeFailMessage,children:(0,N.jsx)($t.Z,{id:\"neteco.pvms.confirm\"})},\"confirm\"),cancelCallback:this.closeFailMessage})]})})})}}const an=(0,i.ZP)(on);var sn=n(70440),ln=n(31251),cn=n(3746);const{neteco:un}=window,{operationSuccess:dn,operationFailed:pn,operationInfo:fn}=Y.Z,{deviceMgtView:hn}=l.e,{pageName:mn,jumpToDeviceView:gn,jumpToStationView:vn,modifyDeviceInfo:yn}=hn,{jumpToDeviceViewActionName:bn,jumpToDeviceViewId:Sn}=gn,{jumpToStationViewActionName:xn,jumpToStationViewId:wn}=vn,{modifyDeviceInfoActionName:Cn,modifyDeviceInfoId:Tn}=yn,{clearSelectedRowSubject:An,clearSelectedRowKeysSubject:En,clearExpandRowKeysSubject:On,sendLithiumCellExportData:Mn,reloadPvTableDataSubject:Pn}=m.Z,Dn=new Set([20826,20829,20832,20833,-1,20834]),In=`${(new Date).getTime()}`,Nn=cn.UW;class _n extends p.Component{constructor(e){var t;super(e),t=this,this.updateColumnsWidthConfig=()=>{const e=0!==this.props.tableData.list.length;this.setState({tableScroll:Ft(e)})},this.clearExpandedRowKeys=()=>{this.setState({expandedRowKeys:[]})},this.handleTableChange=(e,t,n)=>{let{field:r,order:i}=n;const{updateSortCondition:o,searchCondition:a,tableData:s,loadNcoPvTable:l,sortCondition:c,expriationCondition:u}=this.props,{page:d,pageSize:p}=s;o({sortBy:r||c.sortBy,sortOrder:i||\"ascend\"}),l(a,{page:d,pageSize:p},{sortBy:r,sortOrder:i},u)},this.clearSelectedRowKeys=()=>{const{selectedRowKeysMap:e,selectedRowsMap:t}=this.state;e.clear(),t.clear(),An.next()},this.onChangePage=(e,t)=>{const{loadNcoPvTable:n,searchCondition:r,sortCondition:i,expriationCondition:o}=this.props;n(r,{page:e,pageSize:t},i,o)},this.selectionChangeHandler=()=>{const{onSelectionChange:e}=this.props,{selectedRowsMap:t}=this.state;let n=[];for(let[e,r]of t)n.push(r);e(n)},this.crossRegionIcon=(e,t)=>{const{intl:n}=this.props;let r=n.formatMessage({id:\"neteco.pvms.intelAlarm.crossRegion.selectTip.new\"});return t===n.formatMessage({id:\"neteco.pvms.configuration.inverter\"})&&(r=n.formatMessage({id:\"neteco.pvms.intelAlarm.crossRegion.message\"})),(0,N.jsx)(\"span\",{children:e&&(0,N.jsx)(O.Z,{title:r,children:(0,N.jsx)(F.Z,{className:\"nco-pv-table-device-transshipment-icon\"})})})},this.buildStatusIcon=e=>{const{intl:t}=this.props;return e&&(0,N.jsx)(\"div\",{children:(0,N.jsx)(\"span\",{title:t.formatMessage({id:Nn[e].title}),className:`nco-pv-table-device-status-icon ${Nn[e].color}`})})},this.checkMeterExtInfo=e=>{const{mocId:t,dn:n,communicationDn:r,communication:i}=e;if(!(0,s.QL)(t))return void this.setState({actionLoading:!1});const o={meterDn:n,comDeviceDn:r||i.dn};Promise.all([(0,L.U2)(`/rest/neteco/web/config/device/v1/config/query-moc-config-signal?dn=${n}&signals=20004`),(0,L.U2)(\"/rest/neteco/web/config/device/v1/can-switch-meter-direction\",o)]).then((e=>{let[t,n]=e;const r=(null==t?void 0:t.data)||[],i=(null==n?void 0:n.data)||[],a=r.find((e=>20004===e.mocId));V()(a)||(this.setState({meterUsageName:a.name,meterUsageEnumList:a.enumListEntry,meterUsageValue:a.value}),(0,L.U2)(\"/rest/neteco/web/config/device/v1/can-edit-meter-usage\",o).then((e=>{const{success:t,data:n}=e;t&&!(0,b.xb)(n)&&this.setState({meterUsageEdit:n.canEdit,meterUsageSigId:n.sigId,meterUsageDisplay:!0})}))),V()(i)||this.setState({meterDirectionValue:i.direction,meterDirectionEdit:i.canSwitch})})).finally((()=>{this.setState({actionLoading:!1})}))},this.showModifyModal=e=>{(0,c.WW)(Tn,{pageName:mn,actionName:Cn});const{intl:t,checkIsDeviceUpgrading:n}=this.props,{mocId:r,dn:i}=e;20814!==r?n(i,(async n=>{n.length>0?fn(t,t.formatMessage({id:\"neteco.pvms.device.delete.upgrading.information\"})):((0,L.U2)(`/rest/neteco/web/config/device/v1/config/query-moc-config-signal?dn=${i}&signals=50018`).then((e=>{(0,b.xb)(null==e?void 0:e.data)||this.setState({deviceIp:e.data[0].value})})),20816===r&&await(0,G.rJ)(i,In),this.setState({shouldShowModifyModal:!0,modifyModalVisible:!0,currentDevice:e,actionLoading:!0,deviceDn:e.dn},(()=>this.checkMeterExtInfo(e))))}),(()=>{fn(t,t.formatMessage({id:\"neteco.pvms.device.management.deviceMissing\"})),Pn.next()})):fn(t,t.formatMessage({id:\"neteco.pvms.partials.main.dm.optimizerCannotModify\"}))},this.showBatteryGroupModal=e=>{const{intl:t}=this.props;this.setState({batteryGroupModalVisible:!0,shouldShowBatteryGroupModal:!0,currentDevice:e}),this.props.getChildrenDataList(e,t)},this.hideBatteryGroupModal=()=>{this.props.clearBatteryDataList(),this.setState({batteryGroupModalVisible:!1,currentDevice:void 0}),setTimeout((()=>{this.setState({shouldShowBatteryGroupModal:!1})}),300)},this.showTaskCreateModal=()=>{this.setState({shouldShowCreateAsyncTaskModal:!0})},this.hideAsyncTaskTaskModal=e=>{this.setState({shouldShowCreateAsyncTaskModal:!1}),e&&e.forEach((e=>e()))},this.hideModifyModal=()=>{this.setState({modifyModalVisible:!1,currentDevice:void 0}),setTimeout((()=>{this.setState({shouldShowModifyModal:!1})}),300)},this.reload=()=>{this.clearExpandedRowKeys(),this.clearSelectedRowKeys();const{tableData:e,sortCondition:t,loadNcoPvTable:n,searchCondition:r,expriationCondition:i}=this.props,{pageSize:o,page:a}=e;n(r,{page:a,pageSize:o},t,i)},this.modifyDevice=async(e,t,n)=>{const{currentDevice:r,meterDirectionValue:i,deviceDn:o,meterUsageSigId:a}=this.state,{mocId:l}=r,c=[{id:\"33595393\",value:t.deviceName}],u=[{id:a,value:t.paramValues}],d=[{id:\"20005\",value:i}],{intl:p}=this.props;let f=[];20816===l?(t.deviceName!==r.devName&&(f=[...c]),r.paramValues[20005]&&i!==r.paramValues[20005]&&(f=[...d]),t.paramValues!==r.paramValues[20004]&&(f=[...u]),t.deviceName!==r.devName&&t.paramValues!==r.paramValues[20004]&&(f=[...c,...u]),r.paramValues[20005]&&t.deviceName!==r.devName&&i!==r.paramValues[20005]&&(f=[...c,...d])):t.deviceName!==r.devName&&(f=[...c]);const h=()=>{(0,L.Md)(\"/rest/neteco/config/device/v1/config/set-signal\",{dn:20816===l?o:r.dn,changeValues:JSON.stringify(f)}).then((e=>{const{code:t=null,data:n={}}=e||{};if(0===t){dn(p,p.formatMessage({id:\"neteco.pvms.superviseSetting.DomainnameManagerList.updateSuccess\"})),20816===l&&(0,G.rJ)(o,In);const e=f.findIndex((e=>\"33595393\"===e.id));if(e>=0){const t=20816===l?t:r.dn,n=f[e].value;t&&n&&(0,s.Nu)(\"rename_tree_node\",{elementDn:t,nodeName:n})}this.reload(),this.hideModifyModal()}else{this.hideModifyModal();const e=\"neteco.pvms.superviseSetting.serviceCommandList.failed\",t=Object.values(n),r=p.formatMessage({id:(0,b.xb)(t)?e:t[0]});pn(p,r,(()=>{this.reload()}))}}))};e.validateFields().then((()=>{t.deviceName!==r.devName&&(0,L.U2)(\"/rest/neteco/web/config/domain/v1/power-station/check-name\",{parentDn:r.parentDn||\"/\",name:t.deviceName}).then((e=>{e?n():f.length&&f.length>0?h():(this.hideModifyModal(),dn(p,p.formatMessage({id:\"neteco.pvms.superviseSetting.DomainnameManagerList.updateSuccess\"})),this.reload(),this.hideModifyModal())})),t.deviceName!==r.devName||i===r.paramValues[20005]&&t.paramValues===r.paramValues[20004]||(f.length&&f.length>0?h():(this.hideModifyModal(),dn(p,p.formatMessage({id:\"neteco.pvms.superviseSetting.DomainnameManagerList.updateSuccess\"})),this.reload(),this.hideModifyModal()))})).catch((()=>{this.hideModifyModal(),pn(p,p.formatMessage({id:\"neteco.pvms.superviseSetting.serviceCommandList.failed\"}))}))},this.createDeviceColumn=(e,t,n,r)=>{const{intl:i}=this.props,{paramValues:o}=r,a=\"string\"==typeof e;return o[50023],(0,N.jsxs)(\"span\",{title:a?e:void 0,children:[\"false\"===o[50023]&&(0,N.jsx)(O.Z,{title:i.formatMessage({id:\"neteco.bin.access.ack.mismatch\"}),placement:\"top\",children:(0,N.jsx)(\"i\",{className:\"icon-verification-lined\"})}),t]})},this.createColumn=(e,t,n)=>{const r=\"string\"==typeof e;return(0,N.jsx)(\"span\",{title:r?e:void 0,children:t})},this.commonRender=function(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ve.lH;return t.createColumn(e?un.util.iUnescape(e):r,(0,N.jsx)(\"span\",{title:e?un.util.iUnescape(e):r,children:e?un.util.iUnescape(e):r}),n.width)},this.maskTheBindName=e=>{if(e===ve.lH||!e)return e;if(e.length<3)return`${e.substr(0,1)}*`;let t=\"\";for(let n=0;n<e.length-2;n++)t+=\"*\";return e.substr(0,1)+t+e.substr(-1,1)},this.selectLeftTree=(e,t)=>{const{history:n,selectCommonLeftTree:r}=this.props,{ncoSystemType:i}=this.state;if(a.$b.indexOf(i)>-1&&r(e),(0,sn.KS)(t.mocId,t.typeId)){const r=`/view/device/:dn/storageBox/details?esmDn=${t.dn}`;n.push((0,h.n)(r,e))}else{const{path:t,redirectPage:r}=h.D.container;n.push((0,h.n)(t,r,e))}},this.jumpToTargetNode=e=>{(0,sn.yV)(e.mocId)&&(localStorage.setItem(\"selectedBatteryModuleDn\",e.dn),sessionStorage.setItem(\"is3DView\",\"no\"));const t=(0,sn.yV)(e.mocId)||(0,sn.KS)(e.mocId,e.typeId)?e.parentDn:e.dn;this.selectLeftTree(t,e)},this.getDeviceName=(e,t)=>{const{intl:n}=this.props;return 20816===e.mocId&&(0,W.r)(e.paramValues[20004])?`${t}(${(0,W.k)(e.paramValues[20004],n)})`:t},this.getLocationName=(e,t)=>{const{areaList:n}=this.props,r=e.location&&n.find((t=>(0,b.q8)(t.areaId,e.location)));return null==r?void 0:r.areaName},this.getStationTypeList=(e,t)=>{const{stationTypeList:n}=this.props,r=e.stationType&&n.find((t=>(0,b.q8)(t.value,e.stationType)));return null==r?void 0:r.label},this.buildColumns=e=>{const{tableData:{list:t},intl:n,history:r,isSmartPVMS:i}=this.props,o=0!==t.length,a=o?\"left\":\"center\",s=zt(\"devRunningState\",o),l=zt(\"devName\",o),u=zt(\"stationName\",o),d=zt(\"mocTypeName\",o),f=zt(\"softwareVersion\",o),m=zt(\"esn\",o),v=zt(\"upLevelDeviceName\",o),y=zt(\"parentDeviceName\",o),S=zt(\"devTypeId\",o),x=zt(\"sim\",o),w=zt(\"bindUsers\",o),C=zt(\"action\",o),T=zt(\"stationGridTime\",o),A=zt(\"stationType\",o),E=zt(\"location\",o),O=zt(\"company\",o),P=()=>{pn(n,n.formatMessage({id:\"neteco.pvms.device.management.not_exists\"}),(()=>{Pn.next()}))},D=[{title:n.formatMessage({id:\"ncoPvTable.column.status\"}),dataIndex:\"devRunningState\",key:\"devRunningState\",align:a,...s,render:e=>this.buildStatusIcon(e)},{title:n.formatMessage({id:\"ncoPvTable.column.deviceName\"}),dataIndex:\"devName\",key:\"devName\",align:a,...l,render:(e,t)=>{const r=(0,sn.yV)(t.mocId)||(0,sn.KS)(t.mocId,t.typeId)?t.parentDn:t.dn,{path:i,redirectPage:o}=h.D.container,a=`${window.location.pathname}#${(0,h.n)(i,o,r)}`,s=(u=t.mocId,!Dn.has(parseInt(u))&&(0,g.lVp)(g.F72)?(0,N.jsx)(\"a\",{rel:\"noopener noreferrer\",href:(0,b.Q2)(a),onClick:e=>{e.preventDefault(),(0,c.WW)(Sn,{actionName:bn,pageName:mn}),this.props.checkIfDeviceExists(t.dn,n,{okCallback:()=>{this.jumpToTargetNode(t)},failCallback:P})},children:un.util.iUnescape(e)}):un.util.iUnescape(e));var u;return this.createDeviceColumn(e,s,l.width,t)}},{title:n.formatMessage({id:\"ncoInverterTable.column.site\"}),dataIndex:\"stationName\",key:\"stationName\",align:a,...u,render:(e,t)=>{const{stationKey:r}=t,{path:i,redirectPage:o}=h.D.container,a=`${window.location.pathname}#${(0,h.n)(i,o,r)}`,s=(0,N.jsx)(\"a\",{rel:\"noopener noreferrer\",href:(0,b.Q2)(a),onClick:e=>{e.preventDefault(),(0,c.WW)(wn,{pageName:mn,actionName:xn}),this.props.checkIfDeviceExists(r,n,{okCallback:()=>{this.selectLeftTree(t.stationKey,t)},failCallback:P})},children:e?un.util.iUnescape(e):e});return this.createColumn(e,s,u.width)}},{title:n.formatMessage({id:\"ncoPvTable.column.deviceType\"}),dataIndex:\"mocTypeName\",key:\"mocTypeName\",align:a,...d,render:(e,t)=>this.createColumn(e?un.util.iUnescape(e):e,(0,N.jsx)(\"span\",{title:this.getDeviceName(t,e),children:this.getDeviceName(t,e)}),d.width)},{title:n.formatMessage({id:\"ncoPvTable.column.softwareVersion\"}),dataIndex:\"softwareVersion\",key:\"softwareVersion\",align:a,...f,render:e=>this.commonRender(e,f)},{title:n.formatMessage({id:\"ncoPvTable.column.sn\"}),dataIndex:\"esn\",key:\"esn\",align:a,className:\"device-sn-column\",...m,render:e=>this.commonRender(e,m)},{title:\" \",dataIndex:\"isTransshipment\",key:\"isTransshipment\",align:a,width:o?\"26px\":0,className:\"transshipment-column\",render:(e,t)=>this.crossRegionIcon(void 0!==e&&e,t.mocTypeName)}],I=[{title:n.formatMessage({id:\"neteco.device.list.column.uplevel.device\"}),dataIndex:\"upLevelDeviceName\",key:\"upLevelDeviceName\",align:a,...v,render:e=>this.commonRender(e,v)},{title:n.formatMessage({id:\"neteco.pvms.partials.main.dm.communicateDevName\"}),dataIndex:\"parentDeviceName\",key:\"parentDeviceName\",sorter:!1,align:a,...y,render:e=>this.commonRender(e,y)},{title:n.formatMessage({id:\"neteco.pvms.partials.main.configuration.model\"}),dataIndex:\"devTypeId\",key:\"devTypeId\",sorter:!1,align:a,...S,render:e=>this.commonRender(e,S)},{title:n.formatMessage({id:\"ncoPvTable.column.sim\"}),dataIndex:\"sim\",key:\"sim\",align:a,...x,render:e=>this.commonRender(e,x)},{title:n.formatMessage({id:\"nco.pvms.device.commissionedBy.user\"}),dataIndex:\"bindUsers\",key:\"bindUsers\",align:a,...w,render:e=>this.commonRender(this.maskTheBindName(e?un.util.iUnescape(e):e),w)}],_=[{title:n.formatMessage({id:\"ncoHomeSearchBarView.label.stationGridTime\"}),dataIndex:\"stationGridTime\",key:\"stationGridTime\",align:a,...T,render:e=>this.commonRender(e,T)},{title:n.formatMessage({id:\"neteco.pvms.stationInfo.addStation.stationType\"}),dataIndex:\"stationType\",key:\"stationType\",align:a,...A,render:(e,t)=>this.commonRender(this.getStationTypeList(t,e),A)},{title:n.formatMessage({id:\"neteco.pvms.register.area\"}),dataIndex:\"location\",key:\"location\",align:a,...E,render:(e,t)=>this.commonRender(this.getLocationName(t,e),E)},{title:n.formatMessage({id:\"neteco.pvms.common.company.name\"}),dataIndex:\"company\",key:\"company\",align:a,...O,render:e=>this.commonRender(e,O)}];D.push(...I),(0,M.ux)()&&D.push(..._);const{ncoSystemType:j}=this.state,k=\"smartpvms\"!==j,L={title:n.formatMessage({id:\"common.label.action\"}),key:\"action\",align:\"center\",...C,render:(e,t)=>{if(!(0,sn.kt)(t.mocId)&&!(0,sn.yV)(t.mocId))return this.createColumn(e,(0,N.jsx)(\"span\",{className:\"nco-pv-table-action-column\",children:(0,N.jsxs)(p.Fragment,{children:[(0,N.jsx)(Le.Z,{type:\"icon\",operationId:g.RcF,targetId:[t.stationKey],targetType:\"plant\",intl:this.props.intl,onClick:()=>this.showModifyModal(t),title:n.formatMessage({id:\"common.button.modify\"}),children:(0,N.jsx)(\"img\",{alt:\"\",src:U.My})}),k&&(0,g.lVp)(g.O7P)&&60014===t.mocId&&(0,N.jsx)(\"span\",{className:\"export-button\",title:n.formatMessage({id:\"ncoPvToolbar.label.exportPerformanceData\"}),onClick:()=>{this.showBatteryGroupModal(t,n)},children:(0,N.jsx)(\"img\",{src:U.aL,alt:\"\",style:{width:\"16px\"}})})]})}),C.width)}};return o&&(0,g.lVp)(g.RcF)&&D.push(L),D},this.getTableRowSelection=()=>{const{tableData:{list:e}}=this.props,{selectedRowKeysMap:t}=this.state;let n=[];for(let[e,r]of t)r&&n.push(e);if(e&&e.length)return{type:\"checkBox\",selectedRowKeys:n,onChange:(e,t)=>{this.setState({selectedRowKeys:n}),this.selectionChangeHandler()},onSelect:this.onSelectedRow,onSelectAll:this.selectedAllRows}},this.selectedAllRows=(e,t,n)=>{const{selectedRowKeysMap:r,selectedRowsMap:i}=this.state;n.forEach((t=>{let{dnId:n}=t;r.set(n,e),e?i.set(n,t):i.delete(n)}))},this.onSelectedRow=(e,t)=>{const{selectedRowKeysMap:n,selectedRowsMap:r}=this.state,{dnId:i}=e;n.set(i,t),t?r.set(i,e):r.delete(i)},this.onExpand=(e,t)=>{this.setState((n=>{const{expandedRowKeys:r}=n;return e?{expandedRowKeys:[...r,t.dnId]}:{expandedRowKeys:r.filter((e=>e!==t.dnId))}})),e&&this.props.lazyLoadSubDevs(t,this.props.intl)},this.buildTable=e=>{const{tableData:{list:t},loading:n,tableHeight:r}=this.props,{firstRenderDeviceList:i,expandedRowKeys:o}=this.state,a=this.getTableRowSelection(),{xScroll:s,yScroll:l}=Ft(t&&t.length);return(0,N.jsx)(B.Z,{className:\"nco-table-scroll\",size:\"small\",rowKey:\"dnId\",showSorterTooltip:!1,loading:n,dataSource:t,columns:this.buildColumns(e),pagination:!1,scroll:{x:s,y:r||l},onChange:this.handleTableChange,rowSelection:a,expandedRowKeys:o,onExpand:this.onExpand})};const{intl:n}=this.props,r=!localStorage.getItem(\"firstRenderDeviceList\");this.state={batteryGroupModalVisible:!1,shouldShowBatteryGroupModal:!1,shouldShowCreateAsyncTaskModal:!1,modifyModalVisible:!1,firstRenderDeviceList:r,shouldShowModifyModal:!1,currentDevice:null,selectedRowKeys:[],expandedRowKeys:[],deviceDn:\"\",meterUsageValue:\"0\",meterDirectionEdit:!1,meterUsageEdit:!1,meterUsageDisplay:!1,meterUsageSigId:\"20004\",meterUsageName:\"\",meterUsageEnumList:[],meterDirectionValue:\"\",actionLoading:!1,simpleInsts:[],selectedRowKeysMap:new Map,selectedRowsMap:new Map}}componentWillReceiveProps(e,t){const{tableData:n={}}=e,{total:r}=n,{firstRenderDeviceList:i}=this.state;r&&i&&(localStorage&&localStorage.setItem(\"firstRenderDeviceList\",\"occupied\"),this.setState({firstRenderDeviceList:!1}))}componentDidUpdate(e){const{replaceModalVisible:t}=this.props;t!==e.replaceModalVisible&&(t?clearInterval(this.refresh):this.refresh=setInterval((()=>{Pn.next()}),xe.v.pvTable_reloadPvTable))}componentDidMount(){const{expriationCondition:e,supportTradingAreaInfo:t,querySupportTradingArea:n,isSmartPVMS:r}=this.props;r&&!Object.keys(t).length&&(0,g.lVp)(g.kAD)&&n(),this.clearExpandRowKeysSub=On.subscribe((()=>{this.clearExpandedRowKeys()})),Pn&&(this.reloadPvTableData=Pn.subscribe((t=>{this.clearExpandedRowKeys();const{loadNcoPvTable:n,searchCondition:r,sortCondition:i,tableData:o}=this.props,{page:a,pageSize:s}=o;t?(n({...t},{page:1,pageSize:s},i,e),this.clearSelectedRowKeys()):n(r,{page:a,pageSize:s},i,e)}))),this.refresh=setInterval((()=>{Pn.next()}),xe.v.pvTable_reloadPvTable),this.clearSelectedRowKeysSub=En.subscribe((()=>{this.clearSelectedRowKeys()})),this.sendLithiumCellExportData=Mn.subscribe((e=>{this.setState({simpleInsts:e})})),this.setSystemType(),this.props.setTableHeight(),window.addEventListener(\"resize\",this.props.setTableHeight)}componentWillUnmount(){this.setState=a.mz,this.reloadPvTableData&&this.reloadPvTableData.unsubscribe(),this.hoverLeftMenuSub&&this.hoverLeftMenuSub.unsubscribe(),this.clearSelectedRowKeysSub&&this.clearSelectedRowKeysSub.unsubscribe(),this.clearExpandRowKeysSub&&this.clearExpandRowKeysSub.unsubscribe(),this.refresh&&clearInterval(this.refresh),this.sendLithiumCellExportData&&this.sendLithiumCellExportData.unsubscribe(),window.removeEventListener(\"resize\",this.props.setTableHeight)}setSystemType(){this.setState({ncoSystemType:(0,ln.rC)()})}render(){const{tableData:{total:e,page:t,pageSize:n},intl:r,supportTradingAreaInfo:i,batteryDataList:o,getTotal:a}=this.props,{shouldShowModifyModal:s,shouldShowBatteryGroupModal:l,batteryGroupModalVisible:c,shouldShowCreateAsyncTaskModal:u,currentDevice:d,modifyModalVisible:p,simpleInsts:f,deviceIp:h}=this.state;return a(e),(0,N.jsxs)(\"div\",{className:\"nco-pv-table\",children:[(0,N.jsx)(\"div\",{className:\"nco-pv-main-table-wrapper\",children:this.buildTable(i)}),(0,N.jsx)(Z.Z,{size:\"small\",total:e,showSizeChanger:!0,showTotal:(0,H.Z)(r),current:t,pageSize:n,pageSizeOptions:[\"10\",\"20\",\"30\",\"50\",\"100\",\"300\"],onChange:this.onChangePage}),l&&!!o.data.length&&(0,N.jsx)(Xt,{visible:c,hide:this.hideBatteryGroupModal,batteryDataList:o,checkoutComponent:()=>{this.hideBatteryGroupModal(),this.showTaskCreateModal()},intl:r}),(0,N.jsx)(at,{exportConfig:{shouldShowCreateAsyncTaskModal:u,hideAsyncTaskTaskModal:this.hideAsyncTaskTaskModal,simpleInsts:f,gap:\"YEAR\",isBatteryGroupModal:!0}}),s&&(0,N.jsx)(an,{visible:p,device:d,deviceIp:h,hide:this.hideModifyModal,modifyDevice:this.modifyDevice,deviceDn:this.state.deviceDn,meterUsageValue:this.state.meterUsageValue,meterDirectionEdit:this.state.meterDirectionEdit,meterDirectionValue:this.state.meterDirectionValue,meterUsageEdit:this.state.meterUsageEdit,meterUsageDisplay:this.state.meterUsageDisplay,meterUsageName:this.state.meterUsageName,meterUsageEnumList:this.state.meterUsageEnumList,actionLoading:this.state.actionLoading})]})}}const jn=(0,f.EN)(_n);var kn=n(99220);const Ln=new(function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return(0,kn.ZT)(t,e),Object.defineProperty(t.prototype,\"value\",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,r=e._value;if(t)throw n;return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(n(40401).x));var Rn=n(2955),Zn=n(7812),Bn=n(56125),Fn=n(73916);const{clearExpandRowKeysSubject:zn}=m.Z,{SOFTWARE_VERSION:Vn,ESN:Hn,DEVICE_NATION_NAME:Un,BIND_USERS:Gn}=Fn.LW.HOUSEHOLD_SIGNALS,Yn=e=>({type:Bn.T_,payload:e}),Wn=[10046,10047,21001,21002,21003,50001,50002,50003,50004,50005,50006,50007,50008,50009,50010,50011,50012,50013,50014,50015,50023,22049,21020,21009,50017,20004,19999,20029],Kn=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{paramValues:{}};const{paramValues:t,communication:n,dn:r}=e;return n&&n.dn!==r?ve.lH:(e=>{const{mocId:t}=e;return 20810===t||20822===t})(e)?t[22049]||ve.lH:(e=>{const{mocId:t}=e;return 20820===t||20821===t})(e)?t[21020]||ve.lH:(e=>20819===e.mocId)(e)&&t[21009]||ve.lH},qn=async(e,t,n,r,i)=>{let{page:o,pageSize:s}=n;const{parentDn:l,isLoadMaintenance:c=!0}=t;if(!l)return;e({type:Bn.Mb});let u,d=l||\"/\";\"share-station-company-dn\"===l&&(d=void 0),u=l;const p=Wn.join(\",\"),f=[D.o.SMART_SWITCH,D.o.SMART_LOAD].join(\",\"),{deviceType:h,sn:m,model:g,deviceName:v,status:y,mocId:b,areaIds:S,stationGridTime:x,stationType:w,softwareVersion:C}=t,T={\"conditionParams.checkShareStationDn\":u,\"conditionParams.parentDn\":d,\"conditionParams.curPage\":o>0?o:1,\"conditionParams.recordperpage\":s,\"conditionParams.signals\":p,\"conditionParams.mocTypes\":h!==a.Y?h:void 0,\"conditionParams.searchEsn\":m?String(m).trim():void 0,\"conditionParams.searchModel\":g?String(g).trim():void 0,\"conditionParams.searchName\":(null==v?void 0:v.trim())||void 0,\"conditionParams.status\":y!==a.Y?y:void 0,\"conditionParams.sortType\":(0,sn.jE)(b)?\"BY_DEVICE_NAME\":void 0,\"conditionParams.noIncludeMocIds\":f,\"conditionParams.areaIds\":null==S?void 0:S.join(\",\"),\"conditionParams.stationGridTimeStart\":x&&x[0]&&x[0].startOf(\"day\").valueOf(),\"conditionParams.stationGridTimeEnd\":x&&x[1]&&x[1].endOf(\"day\").valueOf(),\"conditionParams.stationType\":w!==a.Y?w:void 0,\"conditionParams.softWareVersion\":(null==C?void 0:C.trim())||void 0,\"conditionParams.maintenance\":c};i&&i.length&&(T[\"conditionParams.expriationInf\"]=i.join(\",\"));const A=await(0,L.Fe)((0,L.U2)(\"/rest/neteco/web/config/device/v1/device-list\",T));if(0===A.code){const t=A.data.map((e=>{const{hasChild:t}=e,{dn:n,communication:r={},stationName:i=ve.lH,stationKey:o=ve.lH}=e,{dn:a}=r,s=n===a?ve.lH:e.communication.name,l=e.stationName===e.parentName?ve.lH:e.parentName||ve.lH;return{...e,dn:e.dn,dnId:e.dnId,devRunningState:e.deviceStatus,stationName:i,devName:e.name,devTypeId:e.paramValues[Un]||ve.lH,softwareVersion:e.paramValues[Vn]||ve.lH,modelVersionCode:ve.lH,esn:e.paramValues[Hn]||ve.lH,sim:Kn(e),bindUsers:e.paramValues[Gn]||ve.lH,mocTypeName:e.mocTypeName||ve.lH,mocId:e.mocId,parentDeviceName:s,parentDn:e.parentDn,upLevelDeviceName:l,communication:r,hasChild:t,children:t?[]:void 0,location:e.location,company:e.company,stationGridTime:e.stationGridTime,stationType:e.stationType}}));zn.next();const{total:n}=A;return e(Yn({list:t,total:n,page:o,pageSize:s})),new Promise((e=>{e(n||0)}))}return e(Yn({list:[],total:0,page:1,pageSize:10})),new Promise((e=>{e(0)}))},Qn=async(e,t,n)=>{(0,L.v_)(\"/rest/neteco/web/imodbus/v1/upgrade-management/upgrading-device-list\",[e]).then((e=>{t(e)})).catch((()=>{n()}))},Xn=(0,r.$j)((e=>({loading:e.ncoMonitorPvTable.loading,tableData:e.ncoMonitorPvTable.tableData,sortCondition:e.ncoMonitorPvTable.sortCondition,shouldHideMenu:e.ncoSettingsContainer?e.ncoSettingsContainer.shouldHideMenu:void 0,supportTradingAreaInfo:e.ncoMonitorPvTable.supportTradingAreaInfo,batteryDataList:e.ncoMonitorPvTable.batteryDataList,lithiumCellDataList:e.ncoMonitorPvTable.lithiumCellDataList})),(e=>({loadNcoPvTable:(t,n,r,i)=>{qn(e,t,n,0,i)},updateSortCondition:t=>{((e,t)=>{e({type:Bn.MC,payload:t})})(e,t)},modifyDevice:(e,t,n)=>{(async(e,t,n)=>{0===(await(0,L.Fe)((0,L.Md)(\"/rest/neteco/config/device/v1/config/set-signal\",{dn:e.dn,changeValues:e.changeValues}))).code?((0,Zn.NB)(n),t()):(0,Zn.CT)(n)})(e,t,n)},lazyLoadSubDevs:(t,n)=>{(async(e,t,n)=>{const{dn:r}=t,i=await(0,L.Fe)((0,L.U2)(\"/rest/neteco/web/config/device/v1/children-list\",{\"conditionParams.parentDn\":r,\"conditionParams.curPage\":0,\"conditionParams.recordperpage\":500,\"conditionParams.signals\":\"20010,50012,10008,10007,10009,19999,10041,20004,50009,50010\",\"conditionParams.mocTypes\":\"20814,20815,20816,50017,60022,60066,60014,60015,23037,20868\"}));e({type:Bn.O1,payload:{...t,subDevs:0===i.code&&i.data?i.data:void 0,intl:n,communicationName:t.communication?t.communication.name:void 0,communicationDn:t.communication?t.communication.dn:void 0}})})(e,t,n)},checkIfDeviceExists:(e,t,n)=>{(async(e,t,n)=>{0!==(await(0,L.Fe)((0,L.U2)(\"/rest/pvms/web/sharestation/v1/config-signal\",{dn:e}))).code?n&&n.failCallback&&n.failCallback():n&&n.okCallback&&n.okCallback()})(e,0,n)},querySupportTradingArea:()=>{(async e=>{const t=await(0,L.Fe)((0,L.U2)(\"/rest/pvms/web/buyonline/v1/support-purchase-area\"));var n;0===t.failCode&&t.data&&e((n=JSON.parse(t.data),{type:Bn.w8,payload:n}))})(e)},getChildrenDataList:(t,n)=>{(async(e,t,n)=>{const{data:r}=await(0,L.U2)(\"/rest/neteco/web/config/device/v1/children-list\",{\"conditionParams.parentDn\":t.dn,\"conditionParams.curPage\":0,\"conditionParams.recordperpage\":500,\"conditionParams.mocTypes\":\"60015,20843\"});r&&(r.sort(((e,t)=>e.name.length===t.name.length?e.name.localeCompare(t.name):e.name.length-t.name.length)),r.forEach((e=>{e.name=e.name.replace(/\\[[0-9]*\\]/,\"\")})));const{mocId:i}=t;let o=null;if(60014===i){if(o=Bn.wE,!r.length)return void K.Z.error({content:n.formatMessage({id:\"neteco.pvms.bcu.empty.tip\"}),centered:!0})}else 60015===i&&(o=Bn.Md);e({type:o,payload:{data:r||[],options:r?r.map((e=>({label:e.name,value:e.dnId}))):[]}})})(e,t,n)},clearBatteryDataList:()=>{(e=>{e({type:Bn.wE,payload:{data:[],options:[]}})})(e)},selectCommonLeftTree:t=>{Ln.next(t),function(e,t){e({type:\"NCOSEARCHBAR/SELECT_NODE_AND_EXPAND\",payload:{dn:t,node:void 0}})}(e,t)},checkIsDeviceUpgrading:Qn})))((0,i.ZP)(jn));n(22339);var Jn=n(54236),$n=n(69896);const{operationInfo:er}=Y.Z,{neteco:tr}=window;class nr extends p.Component{constructor(e){super(e),this.onCheckAllChange=e=>{const t=e.target.checked?this.state.allSignals:[],n={indeterminate:!1,checkedList:t,checkAll:e.target.checked,checkedSet:new Set(t)};this.setState(n)},this.onChange=e=>{const t={checkedList:e,indeterminate:!!e.length&&e.length<this.state.allSignals.length,checkedSet:new Set(e),checkAll:e.length===this.state.allSignals.length};this.setState(t)},this.state={indeterminate:!0,checkedList:[],allSignals:[],checkAll:!1,typeWithPartialSignals:[],checkedSet:new Set([])}}componentWillReceiveProps(e,t){const{typesAndSignals:n}=e;if(n&&n.length>0){const e=n.map((e=>e.counters.map((t=>({...t,deviceMocId:e.type}))))).flatMap((e=>e)).map((e=>`${e.deviceMocId}-${e.counterId}`)),t={allSignals:e,indeterminate:!1,checkedList:e,checkAll:!0,checkedSet:new Set(e)};this.setState(t)}}render(){const{typesAndSignals:e,visible:t,intl:n,prepareTaskInsts:r,handleOk:i}=this.props,{indeterminate:o,checkedList:a,checkAll:s,checkedSet:l}=this.state;return(0,N.jsx)(K.Z,{title:n.formatMessage({id:\"neteco.pvms.devEport.selectSign\"}),visible:t,onCancel:this.props.cancel,width:\"60rem\",centered:!0,onOk:()=>{const t=e.map((e=>({deviceType:e.typeNameAndDns.deviceType,dnIdList:e.typeNameAndDns.dnIds,counterIds:e.counters.filter((t=>l.has(`${e.type}-${t.counterId}`))).map((e=>e.counterId))})));(t||[]).find((e=>!e.counterIds||0===e.counterIds.length))?er(n,n.formatMessage({id:\"neteco.pvms.device.export.type.counters.atLeastOne\"})):(r(t),i())},children:(0,N.jsxs)(\"div\",{className:\"nco-device-signal-content\",children:[(0,N.jsx)(Vt.Z,{indeterminate:o,onChange:this.onCheckAllChange,checked:s,children:n.formatMessage({id:\"neteco.pvms.household.selectAll\"})}),(0,N.jsx)(\"br\",{}),(0,N.jsx)(Vt.Z.Group,{onChange:this.onChange,value:a,children:(0,N.jsx)(X.Z,{children:e.map((e=>(0,N.jsxs)(\"div\",{children:[(0,N.jsx)(\"div\",{style:{fontSize:\"1.2rem\",padding:\".5rem 0\",fontWeight:\"400\",width:\"100%\"},children:e.typeNameAndDns.deviceType.mocName||ve.lH}),(0,N.jsx)(X.Z,{children:e.counters.map((t=>(0,N.jsx)(J.Z,{span:8,style:{minWidth:200,marginBottom:\".5rem\"},children:(0,N.jsx)(Vt.Z,{value:`${e.type}-${t.counterId}`,children:tr.util.iUnescape&&tr.util.iUnescape(t.counterName)})},`${e.type}-${t.counterId}`)))})]},e.type)))})})]})})}}const rr=(0,i.ZP)(nr);var ir=n(77577),or=n(98392),ar=n(59376);const sr=[D.o.STRING_INVERTER,D.o.HOUSEHOLD_INVERTER,D.o.STORAGE,D.o.EMI,D.o.OPTIMIZER,D.o.POWER_METER,D.o.METER,D.o.AIR_CONDITIONER,D.o.BATTERY_CLUSTER,D.o.PCS,D.o.ESS,D.o.DCDC,D.o.TCUE,D.o.NCU,D.o.PORTABLE_BATTERY,D.o.PID,D.o.SMART_LOGGER,D.o.ESM,D.o.HEMS,D.o.GENEARTOR,D.o.BACKUP_BOX,D.o.CHARGE_DC,D.o.GENEARTOR_SET,D.o.CHARGE_PILE_CI];var lr=n(86325);const{reloadPvTableDataSubject:cr}=m.Z,ur=(e,t,n)=>{const r=e.reduce(((e,t)=>(t.mocId in e?e[t.mocId].push(t):e[t.mocId]=[t],e)),{});return Object.entries(r).map((e=>{let r=e[1].map((e=>e.dnId));return\"20845\"===e[0]?r=(0,or.default)(e[1].map((e=>e.dnId)).concat(t)):\"60015\"===e[0]&&(r=(0,or.default)(e[1].map((e=>e.dnId)).concat(n))),{deviceType:{mocId:e[0],mocName:e[1][0].mocName},dns:e[1].map((e=>e.dn)),dnIds:r,enableDisplayExp:!1}}))},dr=e=>({type:ar.T_,payload:e}),pr=e=>{(0,L.v_)(\"/rest/pvms/web/station/v1/station/update-station-install-capacity\",e)};function fr(e,t,n){e.data||e.total?(0,Ee.Sb)(t.formatMessage({id:\"neteco.pvms.device.delete.async.information\"}),n):(0,Ee.CD)(t.formatMessage({id:\"neteco.pvms.device.management.not_exists\"}),n)}const hr=(e,t,n,r)=>{const i=()=>{cr.next(r)},o=t.filter((e=>20814===e.mocId)).map((e=>e.allOpts?e.allOpts:[])).flat(),a=[...new Set(o.map((e=>e.dnId)))],s=[...new Set(t.map((e=>e.dnId)).concat(a))];(0,L.v_)(\"/rest/neteco/web/imodbus/v1/ne-service/ne/batch-deletion?careResetPwdResult=true\",s).then((e=>{if(0===e.code)fr(e,n,i);else if(e.data&&e.data.resetPwdFailList){const r=(0,lr.M)(t,e.data.resetPwdFailList);(0,Ee.ST)(r+\" \"+n.formatMessage({id:\"neteco.deviceManagement.resetPassword.failed.tip\"}),(()=>{!function(e,t,n){(0,L.v_)(\"/rest/neteco/web/imodbus/v1/ne-service/ne/batch-deletion\",e).then((e=>{0===e.code?fr(e,t,n):-1===e.code?(0,Ee.CD)(t.formatMessage({id:\"neteco.pvms.device.management.deviceMissing\"}),n,null,t):(0,Ee.lU)(t.formatMessage({id:\"neteco.pvms.alarmTemp.deleteError\"}),n,t)}))}(s,n,i)}))}else(0,Ee.lU)(n.formatMessage({id:\"neteco.pvms.alarmTemp.deleteError\"}),null,n)}))},mr=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=e.map((e=>20814===e.mocId&&e.allOpts?e.allOpts.map((e=>e.dn)):[e.dn])).flatMap((e=>e)),i=0===r.length?n:{selectedDeviceDns:r.join(\",\")},{searchConditionMocId:o=\"\"}=n||{},a=(0,v.jE)(o)||(0,v.hy)(o)||(0,v.Ou)(o)||(0,v.lS)(o);return(0,L.v_)(\"/rest/pvms/web/device/v1/basic-info-export/task\",{...i,isStation:a}).then((e=>0===e.code||((0,Ee.lU)(e.description,null,t),!1)))},gr=async(e,t,n)=>{(0,L.v_)(\"/rest/neteco/web/imodbus/v1/upgrade-management/upgrading-device-list\",e).then((e=>{t(e)})).catch((()=>{n()}))},vr=(e,t,n)=>{(0,L.v_)(\"/rest/pvms/web/device/v1/release-device\",t).then((t=>{const{code:r,data:i=[]}=t;0===r?n(i):(0,Ee.CD)(e.formatMessage({id:\"neteco.pvms.releaseDevice.failCom.mes\"}),null,\"\",e)})).catch((()=>{(0,Ee.jT)(e.formatMessage({id:\"neteco.pvms.releaseDevice.failCom.mes\"}),e)}))};var yr=n(19988),br=n(74025),Sr=n(64351),xr=n(46759),wr=n(44907),Cr=n(34667);const{deviceMgtView:Tr}=l.e,{batchRenameDeviceInfo:Ar,pageName:Er}=Tr,{batchRenameDeviceInfoActionName:Or,batchRenameDeviceInfoId:Mr}=Ar,{reloadPvTableDataSubject:Pr}=m.Z,Dr=e=>{var t,n;let{intl:r,searchCondition:i}=e;const[o,a]=(0,p.useState)([]),[s,l]=(0,p.useState)(!1),[u,d]=(0,p.useState)(null);(0,p.useEffect)((()=>{(0,c.WW)(Mr,{pageName:Er,actionName:Or})}),[]);return(0,N.jsxs)(\"div\",{className:\"nco-pv-rename-modal-content\",children:[(0,N.jsxs)(\"div\",{className:\"nco-pv-rename-buttons\",children:[(0,N.jsxs)(\"div\",{className:\"nco-pv-rename-input\",children:[0===o.length&&(0,N.jsx)(\"div\",{className:\"nco-pv-rename-placeholder\",children:r.formatMessage({id:\"ncoPvToolbar.rename.placeholder\"})}),o.length>0&&(0,N.jsxs)(\"div\",{className:\"nco-pv-rename-filename\",children:[(0,N.jsx)(\"span\",{className:\"nco-pv-rename-filename-text\",children:(null===(t=o[0])||void 0===t?void 0:t.name)||\"\"}),\"(\",Math.ceil((null===(n=o[0])||void 0===n?void 0:n.size)/1024),\"K)\",(0,N.jsx)(wr.Z,{onClick:()=>{a([]),d(null),l(!1)}})]})]}),(0,N.jsx)(yr.Z,{accept:\".xlsx, .xls\",showUploadList:!1,fileList:o,disabled:s,beforeUpload:e=>{a([e])},children:(0,N.jsx)(ie.Z,{disabled:s,children:(0,N.jsx)($t.Z,{id:\"ncoPvToolbar.rename.uploadFile\"})})}),(0,N.jsx)(ie.Z,{disabled:s||0===o.length,onClick:async()=>{var e;d(null),l(!0);const t=(null==i?void 0:i.parentDn)||\"\",n=await async function(e,t){const n=new FormData;n.append(\"file\",e),n.append(\"stationDn\",t);const[r,i]=await(0,b.AM)((0,L.cd)(\"/rest/pvms/web/device/v1/basic-info-import\",n));return!r&&i}(o[0],t);d(n),l(!1),null!=n&&n.success&&Number(null==n||null===(e=n.data)||void 0===e?void 0:e.successCount)>0&&Pr.next()},children:(0,N.jsx)($t.Z,{id:\"ncoPvToolbar.rename.execute\"})})]}),!s&&null===u&&(0,N.jsxs)(\"div\",{className:\"nco-pv-rename-tips\",children:[(0,N.jsxs)(\"div\",{className:\"nco-pv-rename-executetips\",children:[(0,N.jsxs)(\"div\",{children:[\"* \",r.formatMessage({id:\"ncoPvToolbar.rename.executeTip\"})]}),(0,N.jsx)(\"div\",{children:r.formatMessage({id:\"ncoPvToolbar.rename.tooltip1\"})}),(0,N.jsx)(\"div\",{children:r.formatMessage({id:\"ncoPvToolbar.rename.tooltip2\"})}),(0,N.jsx)(\"div\",{children:r.formatMessage({id:\"ncoPvToolbar.rename.tooltip3\"})})]}),(0,N.jsxs)(\"div\",{className:\"nco-pv-rename-sizetips\",children:[\"* \",r.formatMessage({id:\"ncoPvToolbar.rename.sizeTip\"})]})]}),s&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(\"div\",{className:\"nco-pv-rename-executing\",children:[(0,N.jsx)($t.Z,{id:\"ncoPvToolbar.rename.executing\"}),(0,N.jsxs)(\"div\",{className:\"nco-pv-rename-loading\",children:[(0,N.jsx)(\"div\",{}),(0,N.jsx)(\"div\",{}),(0,N.jsx)(\"div\",{})]})]}),(0,N.jsxs)(\"div\",{className:\"nco-pv-rename-executeInfo\",children:[(0,N.jsx)(br.Z,{}),(0,N.jsx)(\"span\",{children:(0,N.jsx)($t.Z,{id:\"ncoPvToolbar.rename.executeInfo\"})})]})]}),!s&&(null==u?void 0:u.success)&&(0,N.jsxs)(\"div\",{className:\"nco-pv-rename-result\",children:[!(null==u||null===(f=u.data)||void 0===f||!f.successCount)&&(0,N.jsxs)(\"div\",{className:\"nco-pv-rename-success\",children:[(0,N.jsx)(Sr.Z,{}),r.formatMessage({id:\"ncoPvToolbar.rename.success\"},{0:null==u||null===(h=u.data)||void 0===h?void 0:h.successCount})]}),!!Number(null==u||null===(m=u.data)||void 0===m?void 0:m.failedCount)&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(\"div\",{className:\"nco-pv-rename-fail\",children:[(0,N.jsx)(xr.Z,{}),r.formatMessage({id:\"ncoPvToolbar.rename.fail\"},{0:null==u||null===(g=u.data)||void 0===g?void 0:g.failedCount})]}),(0,N.jsxs)(\"div\",{className:\"nco-pv-rename-failInfo\",onClick:()=>{var e;const t={fileId:null==u||null===(e=u.data)||void 0===e?void 0:e.errFileName};(0,Cr.$V)(t,r)},children:[(0,N.jsx)(\"span\",{children:(0,N.jsx)($t.Z,{id:\"ncoPvToolbar.rename.failInfo\"})}),(0,N.jsx)(te.Z,{})]})]})]}),(!1===u||u&&!(null!=u&&u.success))&&(0,N.jsx)(\"div\",{className:\"nco-pv-rename-result\",children:(0,N.jsxs)(\"div\",{className:\"nco-pv-rename-fail\",children:[(0,N.jsx)(xr.Z,{}),(0,N.jsx)($t.Z,{id:(()=>{let e=\"neteco.pvms.register.registerServerError\";var t;return!1===(null==u?void 0:u.success)&&(e=(null==u||null===(t=u.data)||void 0===t?void 0:t.retErrMes)||e),e})()})]})})]});var f,h,m,g};var Ir=n(98455),Nr=n(56729);class _r extends p.Component{constructor(e){super(e),this.state={}}render(){const{status:e}=this.props,t=(n=this.props.intl,{CONNECTED:{status:\"success\",description:n.formatMessage({id:\"neteco.pvms.hems.intelligent.switch.communication.online\"})},DISCONNECTED:{status:\"default\",description:n.formatMessage({id:\"neteco.pvms.hems.intelligent.switch.communication.unonline\"})}})[e];var n;return(0,N.jsx)(\"div\",{title:t.description,children:(0,N.jsx)(Nr.Z,{status:t.status,text:t.description})})}}const jr=(0,i.ZP)(_r);class kr extends p.Component{constructor(e){super(e),this.getEMMAMigrateData=async()=>{const{stationDnId:e}=this.props,t=await(0,ke.rd)(e);if(!(0,b.xb)(t)){const{srcDevices:e=[],dstDevices:n=[]}=t;this.setState({srcDevices:e,dstDevices:n})}},this.buildSourceColumns=()=>{const{intl:e}=this.props;return[{title:e.formatMessage({id:\"ncoEnergyStorageTable.column.device\"}),dataIndex:\"deviceName\",key:\"deviceName\",ellipsis:!0,render:e=>e||ve.lH},{title:e.formatMessage({id:\"neteco.pvms.device.management.emma.network.reconstruction.target.device.last.device.name\"}),dataIndex:\"parentName\",key:\"parentName\",ellipsis:!0,render:e=>e||ve.lH},{title:e.formatMessage({id:\"neteco.pvms.device.management.emma.network.reconstruction.target.device.last.device.sn\"}),dataIndex:\"parentSn\",key:\"parentSn\",ellipsis:!0,render:e=>e||ve.lH},{title:e.formatMessage({id:\"ncoPvTable.column.status\"}),dataIndex:\"deviceStatus\",key:\"deviceStatus\",render:e=>this.renderStatusColumn(e)}]},this.buildTargetColumns=()=>{const{intl:e}=this.props;return[{title:e.formatMessage({id:\"ncoEnergyStorageTable.column.device\"}),dataIndex:\"deviceName\",key:\"deviceName\",ellipsis:!0,render:e=>e||ve.lH},{title:e.formatMessage({id:\"ncoPvTable.column.sn\"}),dataIndex:\"deviceSn\",key:\"deviceSn\",ellipsis:!0,render:e=>e||ve.lH},{title:e.formatMessage({id:\"ncoPvTable.column.status\"}),dataIndex:\"deviceStatus\",key:\"deviceStatus\",render:e=>this.renderStatusColumn(e)}]},this.renderStatusColumn=e=>{const{intl:t}=this.props;return(0,N.jsx)(jr,{status:e})},this.createEMMAMigrateTask=()=>{const e={successCallback:e=>{(0,ke.vr)(this.props.stationDnId,e.check,this.props.intl,this.createTaskCallbackOnOk)},errorCallback:()=>{}};(0,s.Nu)(\"use-verify-pass\",e)},this.createTaskCallbackOnOk=()=>{const{hideCreateTaskModal:e,createEMMATaskSuccess:t}=this.props;e(),t()},this.state={srcDevices:[],dstDevices:[]}}componentDidMount(){this.getEMMAMigrateData()}render(){const{intl:e,hideCreateTaskModal:t}=this.props,{srcDevices:n,dstDevices:r}=this.state;return(0,N.jsx)(\"div\",{children:(0,N.jsxs)(K.Z,{title:e.formatMessage({id:\"neteco.pvms.device.management.emma.network.reconstruction.button.new\"}),onCancel:()=>t(),visible:!0,centered:!0,width:\"900px\",maskClosable:!1,className:\"nco-create-emma-net-reconstruction-modal\",onOk:()=>this.createEMMAMigrateTask(),okButtonProps:{className:\"nco-create-emma-net-reconstruction-model-btn\"},cancelButtonProps:{className:\"nco-create-emma-net-reconstruction-model-btn\"},children:[(0,N.jsx)(Ir.Z,{message:e.formatMessage({id:\"neteco.pvms.device.management.emma.network.reconstruction.create.task.new.tip\"}),showIcon:!0,type:\"info\"}),(0,N.jsx)(\"div\",{className:\"device-table-title\",children:e.formatMessage({id:\"neteco.pvms.device.management.emma.network.reconstruction.source.device\"})}),(0,N.jsx)(_e.Z,{dataSource:n,columns:this.buildSourceColumns(),pagination:!1,scroll:{y:\"15rem\"}}),(0,N.jsx)(\"div\",{className:\"device-table-title\",children:e.formatMessage({id:\"neteco.pvms.device.management.emma.network.reconstruction.target.device\"})}),(0,N.jsx)(_e.Z,{dataSource:r,columns:this.buildTargetColumns(),pagination:!1}),(0,N.jsx)(Re.Z,{})]})})}}const Lr=(0,i.ZP)(kr);var Rr=n(44331),Zr=n(8394);const{deviceMgtView:Br}=l.e,{deleteDevice:Fr,pageName:zr,exportBaseInfo:Vr,paramsSetting:Hr}=Br,{deleteDeviceId:Ur,deleteDeviceActionName:Gr}=Fr,{exportBaseInfoId:Yr,exportBaseInfoActionName:Wr}=Vr,{paramsSettingId:Kr,paramsSettingActionName:qr}=Hr,{reloadPvTableDataSubject:Qr}=m.Z,{operationConfirm:Xr}=Y.Z;class Jr extends p.Component{constructor(e){super(e),this.getSupportEmmaMigrateStatus=async()=>{const{selectedTreeNode:e}=this.props,{elementId:t}=e,n=await(0,ke.BT)(Number(t));this.setState({eMMAMigrateBtnDisplay:n.display,supportEMMAMigrateStatus:n.support})},this.getDeviceMaxNum=async()=>{const e=await(async()=>{const[e,t]=await(0,b.AM)((0,L.U2)(\"/rest/pvms/web/device/v1/get-system-config\"));if(e||null!=t&&t.code)return{};const{data:n,code:r}=t;return 0===r?n:void 0})();this.setState({selectDeviceMaxNum:null==e?void 0:e.BATCH_CONFIG_DEVICE_LIMIT})},this.setSharedStation=e=>{var t;(null!==(t=this.props.match.params)&&void 0!==t&&t.companyDn&&\"share-station-company-dn\"===e||this.props.isSharedStation)&&this.setState({isInSharedStation:!0})},this.setReleaseDeviceSwitch=async()=>{const e=await $n.Z.getSystemConfigs(),t=(null==e?void 0:e.releaseDeviceEnable)||!1;this.setState({releaseDeviceEnable:t})},this.showSettingModal=()=>{this.setState({initialSettingModalVisible:!0,shouldShowInitialSettingModal:!0})},this.containsShareStationDevice=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).some((e=>!0===e.isShareDevice))},this.supportedSet=new Set([D.o.STRING_INVERTER,D.o.HOUSEHOLD_INVERTER,D.o.STORAGE,D.o.BUSINESS_SMART_LOGGER,D.o.DONGLE,D.o.SMART_LOGGER,D.o.AIR_CONDITIONER,D.o.ESU,D.o.PCS,D.o.BATTERY_CLUSTER,D.o.DCDC,D.o.ESS,D.o.NCU,D.o.STS,D.o.PID,D.o.HEMS,D.o.GENEARTOR,D.o.GENEARTOR_SET]),this.showParamSettingsModal=()=>{const{selectedRows:e=[],selectedSubDevs:t=[],intl:n}=this.props,r=[...e,...t],{selectDeviceMaxNum:i}=this.state;if(0===r.length)return void(0,Ee.CD)(n.formatMessage({id:\"neteco.pvms.systemSetting.planManage.modifySelectTip\"}),null,\"\",n);if(new Set(r.map((e=>e.stationKey))).size>1&&(0,g.yav)(g.SZq))return(0,c.WW)(Kr,{pageName:zr,actionName:qr,processResult:Hr.processResult.failOfSelectMoreStation}),void(0,Ee.CD)(n.formatMessage({id:\"neteco.pvms.crossStation.onlyOneSelected\"}));const o=new Set(r.map((e=>e.devTypeId)));if(r.length>1&&o.size>1)return void(0,Ee.CD)(n.formatMessage({id:\"neteco.pvms.deviceManagement.selecttedSameType\"}),null,\"\",n);if(r.length>i)return(0,c.WW)(Kr,{pageName:zr,actionName:qr,processResult:Hr.processResult.failOfOutSystem}),void Xr(n,n.formatMessage({id:\"neteco.pvms.params.batch.config.device.limit.1\"}));if(r.findIndex((e=>\"Connected\"!==e.status))>=0)return void(0,Ee.xf)(n.formatMessage({id:\"neteco.pvms.device.status.down.information2\"}),n);let a=!0;for(let e=0;e<r.length;e++)if(!this.supportedSet.has(r[0].mocId)){a=!1;break}if(a)this.showSettingModal();else{const e=[\"neteco.pvms.devTypeLangKey.inverter\",\"neteco.pvms.devTypeLangKey.energy_store\",\"neteco.pvms.devTypeLangKey.smartLog\",\"neteco.pvms.devTypeLangKey.airConditioner\",\"neteco.pvms.devTypeLangKey.dongleCommunicateModel\",\"neteco.pvms.devTypeLangKey.CMU\",\"neteco.pvms.business.dcToDc.energyFlow.batteryCluster\",\"neteco.pvms.devTypeLangKey.PCS\",\"neteco.pvms.monitor.station.esc\",\"neteco.pvms.devTypeLangKey.BCU\",\"neteco.pvms.devTypeLangKey.EMMA\"].map((e=>n.formatMessage({id:e}))).join(\",\");(0,Ee.CD)(n.formatMessage({id:\"neteco.pvms.devEport.devScope\"},{0:e}),null,\"\",n)}},this.eliminateSettingModal=()=>{this.setState({shouldShowInitialSettingModal:!1})},this.hideSettingModal=()=>{this.setState({initialSettingModalVisible:!1,batchConfiguring:!1}),setTimeout((()=>this.eliminateSettingModal()),300)},this.getDeletedDevicePageData=e=>{const{currentDeletedPage:t,currentDeletedPageSize:n}=this.state,r=e.slice((t-1)*n,t*n);let i=[];return r.forEach((e=>{i.push({...e,children:void 0})})),i},this.onChangePage=(e,t)=>{this.setState({currentDeletedPage:e,currentDeletedPageSize:t})},this.closeDeletedDeviceModal=()=>{this.setState({deletedDeviceStatus:!1})},this.buildColumns=e=>[{title:e.formatMessage({id:\"ncoPvTable.column.deviceName\"}),dataIndex:\"devName\",key:\"devName\"},{title:e.formatMessage({id:\"ncoInverterTable.column.site\"}),dataIndex:\"stationName\",key:\"stationName\"},{title:e.formatMessage({id:\"ncoPvTable.column.deviceType\"}),dataIndex:\"mocTypeName\",key:\"mocTypeName\"}],this.deleteDeviceTable=e=>{const{intl:t}=this.props,{currentDeletedPage:n,currentDeletedPageSize:r,supportEMMAMigrateDelDeviceStatus:i}=this.state,o=i?t.formatMessage({id:\"neteco.pvms.device.management.emma.network.reconstruction.delete.device.new.tip\"},{service:\"EMMA\"}):t.formatMessage({id:\"neteco.deviceManagement.deleteDevice.resetPassword\"})+t.formatMessage({id:\"neteco.deviceManagement.deleteDeviceWarning\"});return(0,N.jsxs)(\"div\",{children:[(0,N.jsx)(B.Z,{pagination:!1,columns:this.buildColumns(t),dataSource:this.getDeletedDevicePageData(e),scroll:{y:\"20.75rem\"}}),(0,N.jsx)(Z.Z,{size:\"small\",total:e.length,showSizeChanger:!0,current:n,pageSize:r,onChange:this.onChangePage,pageSizeOptions:[\"10\",\"20\",\"30\",\"50\",\"100\",\"300\"],showTotal:(0,H.Z)(t),onShowSizeChange:this.onChangePage}),(0,N.jsx)(\"div\",{className:\"delete-device-tip\",children:o})]})},this.deleteDeviceModal=()=>{const{selectedRows:e=[],selectedSubDevs:t=[],intl:n,parentDn:r}=this.props,i=[...e,...t];return(0,N.jsx)(K.Z,{title:n.formatMessage({id:\"neteco.pvms.device.pv.delete.modal.title\"}),className:\"delete-device-modal\",centered:!0,visible:this.state.deletedDeviceStatus,onCancel:this.closeDeletedDeviceModal,onOk:this.deleteDeviceOk,children:this.deleteDeviceTable(i)})},this.deleteDeviceOk=()=>{const{selectedRows:e=[],selectedSubDevs:t=[],intl:n,searchCondition:r}=this.props,i=[...e,...t];this.props.deleteDevices(e,i,n,r),this.setState({deletedDeviceStatus:!1})},this.deleteDevice=()=>{const{selectedRows:e=[],selectedSubDevs:t=[],intl:n,parentDn:r}=this.props,i=[...e,...t],o=i.find((e=>20814===e.mocId&&\"Connected\"===e.devRunningState));if((0,c.WW)(Ur,{pageName:zr,actionName:Gr}),o)(0,Ee.CD)(n.formatMessage({id:\"neteco.pvms.deleteTip.delRunDev\"}),null,\"\",n);else{const t=[];e.forEach((e=>{t.push(e.dn)})),this.props.checkIsDevicesUpgrading(t,(e=>{if(e.length>0)return void(0,Ee.CD)(n.formatMessage({id:\"neteco.pvms.device.delete.upgrading.information\"}),null,\"\",n);this.setState({deletedDeviceStatus:!0});const t=i.filter((e=>(0,s.Ek)(e.mocId,e.typeId))),r=i.map((e=>e.dn));if(t.find((e=>!r.includes(e.communicationDn||e.parentDn))))(0,Ee.CD)(n.formatMessage({id:\"neteco.pvms.device.delete.onlychargeMeter.information\"}),null,\"\",n);else{const e=i.map((e=>e.dnId));(0,ke.nc)(e).then((e=>{this.setState({supportEMMAMigrateDelDeviceStatus:e},(()=>this.deleteDeviceModal()))})).catch((()=>{this.deleteDeviceModal()}))}}),(()=>{(0,Ee.CD)(n.formatMessage({id:\"neteco.pvms.device.management.deviceMissing\"}),null,\"\",n),Qr.next({parentDn:r})}))}},this.checkNotSelectedAnyRecord=()=>{const{selectedRows:e}=this.props;return!e||0===e.length},this.checkOnlySelectedOneRecord=()=>{const{selectedRows:e=[],selectedSubDevs:t=[]}=this.props;return 1!==[...e,...t].length},this.checkExportBasic=()=>{if((0,c.WW)(Yr,{pageName:zr,actionName:Wr}),this.checkNotSelectedAnyRecord()){if(0===this.props.total)return void(0,Ee.jT)(this.props.intl.formatMessage({id:\"ncoSiteToolbar.export.noData\"}),this.props.intl);(0,Ee.ST)(this.props.intl.formatMessage({id:\"ncoPvToolbar.label.exportBasic.Tip\"}),this.exportBasic,null,this.props.intl)}else this.exportBasic()},this.exportBasic=async()=>{const{exportBasic:e,selectedRows:t=[],selectedSubDevs:n=[],searchCondition:r,intl:i}=this.props;let{parentDn:o=\"/\",deviceType:s,deviceName:l,sn:c,model:u,status:d,mocId:p,areaIds:f,stationGridTime:h,stationType:m,softwareVersion:g}=r;const v=o;\"share-station-company-dn\"===o&&(o=void 0);const y={parentDn:o,shareStationDns:v,mocId:s!==a.Y?s:void 0,searchName:(null==l?void 0:l.trim())||void 0,searchEsn:c?String(c).trim():void 0,searchModel:u?String(u).trim():void 0,status:d!==a.Y?d:void 0,searchConditionMocId:p,areaIds:f,stationGridTimeStart:h&&h[0]&&h[0].startOf(\"day\").valueOf(),stationGridTimeEnd:h&&h[1]&&h[1].startOf(\"day\").valueOf(),stationType:m!==a.Y?m:void 0,softWareVersion:g};try{await e([...t,...n],this.props.intl,y)&&this.showTaskListModal()}catch(e){const t=i.formatMessage({id:\"neteco.pvms.partials.main.dm.detailInfo.curInfo.smartLogger.handleFailed\"});(0,Ee.jT)(t,i)}},this.hideSignalModal=()=>{this.setState({signalModalVisible:!1}),setTimeout((()=>this.setState({shouldShowSignalModal:!1})),600)},this.getBatteryData=async()=>{const[e,t]=await(0,b.AM)((0,Rn.U2)(\"/rest/neteco/web/config/device/v1/additional-moc-type?functionItem=DataExportable\")),{success:n,data:r}=t;!e&&n&&this.setState({eleBatteryData:r})},this.showSignalModal=()=>{const{selectedRows:e=[],selectedSubDevs:t=[],initSignalModal:n,intl:r}=this.props,{eleBatteryData:i}=this.state,o=[\"neteco.pvms.configuration.inverter\",\"ncoHomeSiteList.columns.siteEnergyStorage\",\"neteco.pvms.devTypeLangKey.emi\",\"neteco.pvms.smsrc.dm_optimizer\",\"neteco.pvms.devTypeLangKey.meter\",\"neteco.pvms.devTypeLangKey.PCS\",\"neteco.pvms.business.dcToDc.energyFlow.batteryCluster\",\"neteco.pvms.monitor.station.esc\",\"neteco.pvms.devTypeLangKey.smartLogV3\",\"neteco.pvms.devTypeLangKey.lithiumBattery\",\"neteco.pvms.devTypeLangeKey.dc.business\",\"neteco.pvms.pcs.station.energyflow.generatorSet\",\"neteco.pvms.devTypeLangeKey.ac.charger\"].map((e=>r.formatMessage({id:e}))).concat([\"ESS\",\"NCU\",\"EMMA\"]);o.push(...i.map((e=>e.mocTypeName)));const a=o.join(\", \"),s={okCallbacks:[()=>{this.setState({shouldShowSignalModal:!0,signalModalVisible:!0})}],initFailedCallbacks:[()=>(0,Ee.CD)(r.formatMessage({id:\"neteco.pvms.devEport.devScope\"},{0:a}),null,\"\",r)],hasForbidCallbacks:[()=>(0,Ee.xf)(r.formatMessage({id:\"ncoPvToolbar.label.exportPerformanceData.forbid\"}),r)],clearCallbacks:[this.hideSignalModal]};n([...e,...t].map((e=>(0,sn.kt)(e.mocId)?e.allOpts||[e]||0:[e])).flatMap((e=>e)),s)},this.hideAsyncTaskTaskModal=e=>{this.setState({shouldShowCreateAsyncTaskModal:!1}),e&&e.forEach((e=>e()))},this.showTaskCreateModal=()=>{this.setState({shouldShowCreateAsyncTaskModal:!0})},this.showTaskListModal=()=>{this.setState({activeKey:Me.oc.BASIC_MESSAGE})},this.showReplaceDeviceModal=()=>{this.setState({activeKey:Me.oc.REPLACE_DEVICE})},this.hideTaskListModal=e=>{this.setState({activeKey:\"\"}),e&&e.forEach((e=>e()))},this.releaseDevice=()=>{const{intl:e,selectedRows:t=[],releaseDevices:n,parentDn:r}=this.props,i=t.map((e=>e.name.trim())).join(\",\"),{releaseDevice:o}=Br,{releaseDeviceId:a,releaseDeviceActionName:s}=o;(0,c.WW)(a,{actionName:s});const l=t=>{(0,Ee.CD)((t=>(0,N.jsx)(\"div\",{children:t.map((t=>{if(0===t.code)return(0,N.jsx)(\"p\",{children:`${window.neteco.util.iUnescape(t.name)}: ${e.formatMessage({id:\"neteco.pvms.releaseDevice.success.mes\"})}`});const n=\"2\"===t.message?e.formatMessage({id:\"neteco.pvms.rule.separator.label\"})+e.formatMessage({id:\"neteco.pvms.releaseDevice.failReleased.mes\"}):e.formatMessage({id:\"neteco.pvms.batchmove.end\"});return(0,N.jsx)(\"p\",{style:{color:\"red\"},children:`${window.neteco.util.iUnescape(t.name)}: ${e.formatMessage({id:\"neteco.pvms.releaseDevice.failCom.mes\"})}${n}`})}))}))(t),null,e.formatMessage({id:\"neteco.pvms.partials.main.io.dm.heads.dealResult\"}),e),Qr.next({parentDn:r})};(0,Ee.ST)(e.formatMessage({id:\"neteco.pvms.releaseDevice.confirm.mes\"},{0:i}),(()=>n(e,t.map((e=>e.dn)),l)),null,this.props.intl)},this.showRenameModal=()=>{this.setState({renameModalVisible:!0})},this.hideRenameModal=()=>{this.setState({renameModalVisible:!1})},this.importDevice=()=>{this.showRenameModal()},this.checkAllDongle=()=>{const{selectedRows:e=[],selectedSubDevs:t=[]}=this.props;return 0===[...e,...t].filter((e=>!(0,v.Ou)(e.mocId))).length},this.checkReleased=()=>{var e;return(null!==(e=this.props.selectedRows)&&void 0!==e?e:[]).filter((e=>e.esn===ve.lH&&\"Disconnected\"===e.deviceStatus)).length},this.getReplaceTypesTip=e=>`${e.formatMessage({id:\"neteco.pvms.pleaseChoose\"})}${e.formatMessage({id:\"neteco.pvms.devTypeLangKey.inverter\"})}、${e.formatMessage({id:\"neteco.pvms.devTypeLangKey.PCS\"})}、${e.formatMessage({id:\"neteco.pvms.devTypeLangKey.smartLog\"})}、${e.formatMessage({id:\"neteco.pvms.partials.main.dm.communicateDevName\"})}、${e.formatMessage({id:\"neteco.pvms.devTypeLangKey.EMMA\"})}`,this.showDeviceChangeModal=()=>{const{selectedRows:e=[],selectedSubDevs:t=[],intl:n}=this.props,r=[...e,...t];(0,v.Zr)(r[0].mocId)||(0,v.Ou)(r[0].mocId)||(0,v.hy)(r[0].mocId)||(0,v.lS)(r[0].mocId)||(0,v.Z9)(r[0].mocId)?\"Disconnected\"===r[0].deviceStatus?(this.props.replaceModalVisible(!0),this.setState({deviceChangeModalVisible:!0})):(0,Ee.CD)(n.formatMessage({id:\"neteco.pvms.device.replace.status.fail\"}),null,\"\",n):(0,Ee.CD)(this.getReplaceTypesTip(n),null,\"\",n)},this.hideDeviceChange=()=>{const{replaceModalVisible:e}=this.props;e(!1),this.setState({deviceChangeModalVisible:!1})},this.deleteButtonDisable=()=>{const{selectedRows:e=[],selectedSubDevs:t=[]}=this.props,n=[...e,...t];return 0===n.length||n.filter((e=>(0,s.Ek)(e.mocId,e.typeId))).length===n.length},this.settingsBtnDisable=e=>{if(!e.length)return!0;for(const t of e)if(!this.supportedSet.has(t.mocId))return!0;return!1},this.swapDeviceBtnDisable=e=>{for(const t of e)if(t.mocId===D.o.BACKUP_BOX)return!0;return!1},this.showToolTip=()=>!this.state.isInSharedStation&&this.state.releaseDeviceEnable,this.showBatchRename=e=>(0,g.lVp)(g.RcF)&&((0,v.jE