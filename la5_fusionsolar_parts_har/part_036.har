)(e)||(0,v.hy)(e)||(0,v.Ou)(e)),this.checkListNoData=()=>{var e,t;return(0,b.xb)(null===(e=this.props)||void 0===e||null===(t=e.tableData)||void 0===t?void 0:t.list)},this.checkNotSelected=e=>!e||0===e.length,this.checkMultipleRecords=e=>1!==e.length,this.checkMultipleDeviceTypes=e=>e.length>1&&new Set(e.map((e=>e.devTypeId))).size>1,this.checkDisconnected=e=>e.findIndex((e=>\"Connected\"!==e.status))>=0,this.checkNotSupported=(e,t)=>{const n=Me.Bt[t].types;for(const t of e)if(!n.has(t.mocId))return!0;return!1},this.isHavNewLogger=e=>{let t=!1;return!(0,b.xb)(e)&&(e.forEach((e=>{(0,sn.fJ)(e.softwareVersion)&&(t=!0)})),t)},this.checkAllDongle=e=>0===e.filter((e=>!(0,v.Ou)(e.mocId))).length,this.checkReleased=e=>e.filter((e=>\"-\"===e.esn&&\"Disconnected\"===e.deviceStatus)).length,this.checkOnlySelectedVirtualMeter=e=>e.filter((e=>(0,s.Ek)(e.mocId,e.typeId))).length===e.length,this.checkSelectedConnectedOptimizer=e=>!!e.find((e=>20814===e.mocId&&\"Connected\"===e.devRunningState)),this.checkReleaseDeviceDisable=()=>{const{selectedRows:e=[],selectedSubDevs:t=[],intl:n}=this.props,r=[...e,...t];return this.checkNotSelected(r)?[!0,n.formatMessage({id:\"ncoPvToolbar.tip.selectDevice\"})]:this.checkMultipleRecords(e)||!this.checkAllDongle(r)||this.checkReleased(e)?[!0,n.formatMessage({id:\"ncoPvToolbar.label.releaseDevice.tooltip\"},{0:n.formatMessage({id:\"common.deviceTypes.62\"})})]:[!1,\"\"]},this.checkParameterSettingsDisable=()=>{const{selectedRows:e=[],selectedSubDevs:t=[],intl:n}=this.props,r=[...e,...t];if(this.checkNotSelected(r))return[!0,n.formatMessage({id:\"ncoPvToolbar.tip.selectDevice\"})];if(this.checkNotSupported(r,Me.Gn.parameterSettings)){const e=Me.Bt[Me.Gn.parameterSettings].names.map((e=>n.formatMessage({id:e}))).join(\"、\");return[!0,n.formatMessage({id:\"neteco.pvms.ncoPvToolbar.disableTip.supportedDeviceTypes\"},{deviceTypes:e})]}return this.checkDisconnected(r)?[!0,n.formatMessage({id:\"neteco.pvms.ncoPvToolbar.disableTip.parameterSettings.1\"})]:this.checkMultipleDeviceTypes(r)?[!0,n.formatMessage({id:\"neteco.pvms.ncoPvToolbar.disableTip.parameterSettings.2\"})]:[!1,\"\"]},this.checkSwapDeviceDisable=()=>{const{selectedRows:e=[],selectedSubDevs:t=[],intl:n}=this.props,r=[...e,...t];if(this.checkNotSelected(r))return[!0,n.formatMessage({id:\"ncoPvToolbar.tip.selectDevice\"})];const i=Me.Bt[Me.Gn.swapDevice].names.map((e=>n.formatMessage({id:e}))).join(\"、\");return this.checkNotSupported(r,Me.Gn.swapDevice)||this.isHavNewLogger(r)?[!0,n.formatMessage({id:\"neteco.pvms.ncoPvToolbar.disableTip.supportedDeviceTypes\"},{deviceTypes:i})]:this.checkMultipleRecords(r)||!this.checkDisconnected(r)?[!0,n.formatMessage({id:\"neteco.pvms.ncoPvToolbar.disableTip.swapDevice.1\"})]:[!1,\"\"]},this.checkExportPerformanceDataDisable=()=>{const{selectedRows:e=[],selectedSubDevs:t=[],intl:n}=this.props,r=[...e,...t],i=[...e,...t].map((e=>(0,sn.kt)(e.mocId)?e.allOpts||[e]||0:[e])).flatMap((e=>e));if(r.length>300)return[!0,n.formatMessage({id:\"ncoPvToolbar.tip.selectDevice.number.limit\"},{number:300})];if(this.checkNotSelected(r))return[!0,n.formatMessage({id:\"ncoPvToolbar.tip.selectDevice\"})];if(this.checkNotSupported(i,Me.Gn.exportPerformanceData)){const e=Me.Bt[Me.Gn.exportPerformanceData].names.map((e=>n.formatMessage({id:e}))).join(\"、\");return[!0,n.formatMessage({id:\"neteco.pvms.ncoPvToolbar.disableTip.supportedDeviceTypes\"},{deviceTypes:e})]}return[!1,\"\"]},this.checkDeleteDisable=()=>{const{selectedRows:e=[],selectedSubDevs:t=[],intl:n}=this.props,r=[...e,...t];if(this.checkNotSelected(r))return[!0,n.formatMessage({id:\"ncoPvToolbar.tip.selectDevice\"})];if((0,M.EV)()){var i;const e=null===(i=r[0])||void 0===i?void 0:i.stationKey;for(let t of r)if(t.stationKey!==e)return[!0,n.formatMessage({id:\"neteco.pvms.station.choose.onlyOne.station.message\"})]}return this.checkOnlySelectedVirtualMeter(r)||this.checkSelectedConnectedOptimizer(r)?[!0,n.formatMessage({id:\"neteco.pvms.ncoPvToolbar.disableTip.delete.1\"})]:[!1,\"\"]},this.checkImportDeviceNameDisable=()=>{const{intl:e}=this.props;return this.checkListNoData()?[!0,e.formatMessage({id:\"neteco.pvms.ncoPvToolbar.disableTip.importDeviceName.1\"})]:[!1,\"\"]},this.checkExportBasicDisable=()=>{const{selectedRows:e=[],selectedSubDevs:t=[],intl:n}=this.props,r=[...e,...t];return this.checkListNoData()?[!0,n.formatMessage({id:\"neteco.pvms.ncoPvToolbar.disableTip.exportBasic.1\"})]:this.checkNotSelected(r)?[!1,n.formatMessage({id:\"neteco.exportBasicAll.tip\"})]:[!1,\"\"]},this.checkEmmaTaskVisible=()=>{const{intl:e}=this.props,{supportEMMAMigrateStatus:t}=this.state;t?this.setShowCreateEmmaTaskModal(!0):Zr.Z.confirm({title:e.formatMessage({id:\"neteco.pvms.station.EMMA.modal.title\"}),message:e.formatMessage({id:\"neteco.pvms.station.EMMA.modal.content\"}),okText:e.formatMessage({id:\"neteco.pvms.station.EMMA.modal.btn.guide\"}),intl:e,isNewStyle:!0,onOk:()=>{const e=\"zh-cn\"===window.neteco.i18n.getLocale()?Rr.support_emma_help_url_zh:Rr.support_emma_help_url_en;window.open(e,\"_blank\",\"noopener=yes,noreferrer=yes\")}})},this.setShowCreateEmmaTaskModal=e=>{this.setState({showCreateEMMATaskModal:e})},this.state={settingModalVisible:!1,shouldShowSettingModal:!1,initialSettingModalVisible:!1,shouldShowInitialSettingModal:!1,batchConfiguring:!1,shouldShowCreateAsyncTaskModal:!1,shouldShowSignalModal:!1,signalModalVisible:!1,deviceChangeModalVisible:!1,isInSharedStation:!1,eleBatteryData:[],selectDeviceMaxNum:0,renameModalVisible:!1,releaseDeviceEnable:!1,deletedDeviceStatus:!1,currentDeletedPage:1,currentDeletedPageSize:10,showCreateEMMATaskModal:!1,eMMAMigrateBtnDisplay:!1,supportEMMAMigrateStatus:!1,supportEMMAMigrateDelDeviceStatus:!1,activeKey:\"\",service:this.props.intl.formatMessage({id:(0,b.Z4)(\"\",!1)})}}componentDidMount(){this.showEmptyWarning=m.Z.isEmptySignal.subscribe((()=>{(0,Ee.xf)(this.props.intl.formatMessage({id:\"neteco.pvms.exportPerformanceData.notSupport\"}),this.props.intl)})),this.setSharedStation(this.props.parentDn),this.getBatteryData(),this.getDeviceMaxNum(),this.setReleaseDeviceSwitch(),(0,g.lVp)(g.aOL)&&!this.props.isSystemDeviceManagement&&this.getSupportEmmaMigrateStatus()}componentDidUpdate(e){var t,n,r,i;e.selectedTreeNode!==this.props.selectedTreeNode&&(null!==(t=this.props)&&void 0!==t&&null!==(n=t.selectedTreeNode)&&void 0!==n&&n.elementDn&&\"share-station-company-dn\"===(null===(r=this.props)||void 0===r||null===(i=r.selectedTreeNode)||void 0===i?void 0:i.elementDn)||this.props.isSharedStation?this.setState({isInSharedStation:!0}):this.setState({isInSharedStation:!1}))}componentWillUnmount(){this.showEmptyWarning&&this.showEmptyWarning.unsubscribe()}toggleBatchConfiguration(e){this.setState({batchConfiguring:e})}setBatchConfiguration(e){this.setState({activeKey:e?Me.oc.PARAMTER_SETTING_TASK:\"\"})}setCreateEMMATaskSuccess(){this.setState({activeKey:Me.oc.EMMA_MIGRATION})}render(){const{selectedRows:e=[],selectedSubDevs:t=[],intl:n,searchCondition:r,selectedTreeNode:i}=this.props,{elementId:o,elementDn:a}=i,{renameModalVisible:s,eMMAMigrateBtnDisplay:l}=this.state,c=new Array(...new Set([...e,...t].map((e=>e.stationKey)))),[u,d]=this.checkReleaseDeviceDisable(),[p,f]=this.checkParameterSettingsDisable(),[h,m]=this.checkSwapDeviceDisable(),[v,y]=this.checkExportPerformanceDataDisable(),[b,S]=this.checkDeleteDisable(),[x,w]=this.checkImportDeviceNameDisable(),[C,T]=this.checkExportBasicDisable();return(0,N.jsxs)(\"div\",{className:\"nco-pv-toolbar\",children:[l&&(0,N.jsx)(O.Z,{title:n.formatMessage({id:\"neteco.pvms.device.management.emma.network.reconstruction.button.new.tip\"},{service:this.state.service}),overlayClassName:\"export-performance-data-tooltip\",children:(0,N.jsx)(Le.Z,{onClick:()=>this.checkEmmaTaskVisible(),operationId:[g.aOL],intl:n,targetId:[a],targetType:\"plant\",children:(0,N.jsx)($t.Z,{id:\"neteco.pvms.device.management.emma.network.reconstruction.button.new\"})})}),this.showToolTip()&&(0,N.jsx)(Le.Z,{intl:n,operationId:[g.gDF],targetId:c,targetType:\"plant\",onClick:this.releaseDevice,disabled:u,title:d,children:(0,N.jsx)($t.Z,{id:\"ncoPvToolbar.label.releaseDevice\"})}),!(0,M.jq)()&&(0,N.jsx)(Le.Z,{operationId:[g.SZq,g.qS6],intl:n,targetId:c,targetType:\"plant\",onClick:this.showParamSettingsModal,disabled:p,title:f,children:(0,N.jsx)($t.Z,{id:\"ncoPvToolbar.label.parameterSettings\"})}),!this.state.isInSharedStation&&(0,N.jsx)(Le.Z,{operationId:[g.gDF],intl:n,targetId:c,targetType:\"plant\",onClick:this.showDeviceChangeModal,disabled:h,title:m,children:(0,N.jsx)($t.Z,{id:\"ncoPvTable.toolbar.swapDevice\"})}),(0,g.lVp)(g.O7P)&&(0,N.jsx)(O.Z,{title:y,overlayClassName:\"export-performance-data-tooltip\",children:(0,N.jsx)(ie.Z,{onClick:this.showSignalModal,loading:this.props.loading,disabled:v,children:(0,N.jsx)($t.Z,{id:\"ncoPvToolbar.label.exportPerformanceData\"})})}),!this.state.isInSharedStation&&(0,N.jsx)(Le.Z,{title:S,operationId:g.ITW,intl:n,targetId:c,targetType:\"plant\",disabled:b,onClick:this.deleteDevice,children:(0,N.jsx)($t.Z,{id:\"common.button.delete\"})}),(0,g.lVp)(g.v_v)&&this.showBatchRename(null==r?void 0:r.mocId)&&(0,N.jsx)(O.Z,{title:w,children:(0,N.jsx)(ie.Z,{onClick:this.importDevice,disabled:x,children:(0,N.jsx)($t.Z,{id:\"ncoPvToolbar.label.importDeviceName\"})})}),(0,g.lVp)(g.OmA)&&(0,N.jsx)(O.Z,{title:T,children:(0,N.jsx)(ie.Z,{onClick:this.checkExportBasic,disabled:C,children:(0,N.jsx)($t.Z,{id:\"ncoPvToolbar.label.exportBasic\"})})}),this.state.shouldShowInitialSettingModal&&(0,N.jsx)(Jn.Z,{visible:this.state.initialSettingModalVisible,close:this.hideSettingModal,hide:this.eliminateSettingModal,show:this.showSettingModal,ok:this.hideSettingModal,parentDn:this.props.parentDn,selectedRows:[...t,...e],startBatchConfiguring:()=>this.toggleBatchConfiguration(!0),finishBatchConfiguring:()=>this.toggleBatchConfiguration(!1),batchConfiguringSucceed:()=>this.setBatchConfiguration(!0),batchConfiguringFailed:()=>this.setBatchConfiguration(!1),batchConfiguring:this.state.batchConfiguring,selectedTreeNode:this.props.selectedTreeNode}),this.state.shouldShowSignalModal&&(0,N.jsx)(rr,{typesAndSignals:this.props.typesAndSignals,visible:this.state.signalModalVisible,cancel:this.hideSignalModal,prepareTaskInsts:this.props.prepareTaskInsts,clearPrepareTaskInsts:this.props.clearPrepareTaskInsts,handleOk:()=>{this.hideSignalModal(),this.showTaskCreateModal()}}),(0,N.jsx)(ir.Z,{visible:this.state.deviceChangeModalVisible,cancelChange:this.hideDeviceChange,intl:n,selectedRows:[...t,...e],openTaskListModal:this.showReplaceDeviceModal}),(0,N.jsx)(at,{exportConfig:{shouldShowCreateAsyncTaskModal:this.state.shouldShowCreateAsyncTaskModal,hideAsyncTaskTaskModal:this.hideAsyncTaskTaskModal,hideTaskListModal:this.hideTaskListModal,simpleInsts:this.props.simpleInsts,activeKey:this.state.activeKey}}),(0,N.jsx)(K.Z,{title:n.formatMessage({id:\"ncoPvToolbar.label.importDeviceName\"}),width:600,visible:s,onCancel:this.hideRenameModal,maskClosable:!1,centered:!0,destroyOnClose:!0,footer:null,children:(0,N.jsx)(Dr,{intl:n,searchCondition:r})}),this.state.deletedDeviceStatus&&this.deleteDeviceModal(),this.state.showCreateEMMATaskModal&&(0,N.jsx)(Lr,{hideCreateTaskModal:()=>this.setShowCreateEmmaTaskModal(!1),stationDnId:Number(o),createEMMATaskSuccess:()=>this.setCreateEMMATaskSuccess()})]})}}const $r=(0,f.EN)(Jr),ei=(0,r.$j)((e=>({typesAndSignals:e.ncoPvToolbar.typesAndSignals,simpleInsts:e.ncoPvToolbar.simpleInsts,replaceModalVisible:e.ncoPvToolbar.replaceModalVisible,loading:e.ncoPvToolbar.loading,tableData:e.ncoMonitorPvTable.tableData})),(e=>({deleteDevices:hr,exportBasic:mr,updateStationPvCap:pr,exportPmData:e=>{(async()=>{})()},initSignalModal:(t,n)=>{(async(e,t,n)=>{const{initFailedCallbacks:r}=t;for(let t=0;t<e.length;t++)if(!sr.includes(e[t].mocId))return r.forEach((e=>e())),void(0,c.Kd)(l.e.deviceMgtView.processResult.overScope);n({type:ar.Mb});const i=async(e,t)=>{const{data:n}=await(0,L.U2)(\"/rest/neteco/web/config/device/v1/children-list\",{\"conditionParams.parentDn\":e.dn,\"conditionParams.curPage\":0,\"conditionParams.recordperpage\":500,\"conditionParams.mocTypes\":t,\"conditionParams.visible\":\"60015\"===t||void 0});return n&&n.sort(((e,t)=>e.name.length===t.name.length?e.name.localeCompare(t.name):e.name.length-t.name.length)),\"60015\"===t?(null==n?void 0:n.filter((e=>e.visible)))||[]:n||[]};let o=[];const a=[],s=[];for(let t=0;t<e.length;t++){if(60014===e[t].mocId){const n=await i(e[t],\"60015\");n.forEach((e=>{s.push(e.dnId)})),n.length&&o.push(n[0].dn)}if(20844===e[t].mocId){const n=await i(e[t],\"20845\");n.forEach((e=>{a.push(e.dnId)})),n.length&&o.push(n[0].dn)}}let u=e.map((e=>e.dn));u=[...u,...o];const d=new Set(u),p={dns:u,filterKeyWords:[\"\",null]},f=JSON.stringify(p),h=await(0,L.Md)(\"/rest/pvms/web/pmdata/v1/instances/types\",{generalInsQueryCondString:f}),{mocTypes:g}=h;if(!g.length)return m.Z.isEmptySignal.next(),void n(dr());const v=h.moTypes.concat(h.mocTypes).map((e=>{const t=e.deviceType||{};return e.simpleMOs.map((e=>({...e,...t})))})).flatMap((e=>e)).filter((e=>d.has(e.dn))),y=h.moTypes.concat(h.mocTypes).map((e=>{const t=e.deviceType||{};return(e=>{const t=new Set([]);return e.filter((e=>!(null==e||!e.typeId||t.has(null==e?void 0:e.typeId)||(t.add(null==e?void 0:e.typeId),0))))})(e.simpleMOs).map((e=>({...e,...t})))})).flatMap((e=>e)).filter((e=>d.has(e.dn))),b=JSON.stringify(ur(y,a,s)),S=await(0,L.Md)(\"/rest/pvms/web/pmdata/v1/counters\",{queryCounterTypesString:b}),x=[],w=S.map((e=>(e&&!x.includes(e.deviceType.mocId)&&x.push(e.deviceType.mocId),{type:e.deviceType.mocId,typeNameAndDns:ur(v,a,s).find((t=>String(t.deviceType.mocId)===String(e.deviceType.mocId))),counters:e.stdCountersByName.map((e=>e.counters)).flatMap((e=>e)).map((e=>{let{counterId:t,counterName:n}=e;return{counterId:t,counterName:n}}))})));let C=!1;for(let t=0;t<e;t++)if(!x.includes(e[t].mocId)){if(20844!==e[t].mocId||!x.includes(20845))return void(C=!0);C=!1}if(C)return(0,c.Kd)(l.e.deviceMgtView.processResult.success),t.hasForbidCallbacks.forEach((e=>e())),void n(dr());(0,c.Kd)(l.e.deviceMgtView.processResult.success),t.okCallbacks.forEach((e=>e())),n({type:ar.dS,payload:w}),n(dr())})(t,n,e)},prepareTaskInsts:t=>{((e,t)=>{e({type:ar.cd,payload:t})})(e,t)},clearPrepareTaskInsts:()=>{(e=>{e({type:ar.sM})})(e)},replaceModalVisible:t=>{((e,t)=>{e({type:ar.Lc,payload:t})})(e,t)},checkIsDevicesUpgrading:gr,releaseDevices:vr})))((0,i.ZP)($r));n(63042);var ti=n(65835);const{clearSelectedRowSubject:ni,clearSelectedRowKeysSubject:ri,reloadPvTableDataSubject:ii}=m.Z,{accessId:oi,leaveId:ai,pageName:si}=l.e.deviceMgtView;class li extends p.Component{constructor(e){var t,n;super(e),t=this,this.getExpriationCondition=()=>{const{match:{url:e},isHostMode:t}=this.props;if(!t)return[];const{path:n}=h.D.stationDevManage,r=[];return[\"/settings/device/pv\",n].indexOf(e)>-1&&r.push(1),r},this.selectionChangeHandler=e=>{this.setState({selectedRows:e})},this.addSelectedSubDevs=e=>{this.setState({selectedSubDevs:[...this.state.selectedSubDevs,...e]})},this.clearSelectedItems=()=>{this.setState({selectedSubDevs:[],selectedRows:[]})},this.removeSelectedSubDevs=e=>{const t=e.map((e=>e.dn)),n=this.state.selectedSubDevs.filter((e=>t.indexOf(e.dn)<0));this.setState({selectedSubDevs:n})},this.repeatDeviceList=async()=>{const{parentDn:e,loadNcoPvTable:t,selectedTreeNode:n={},isSystemDeviceManagement:r=!1}=this.props;this.setState({searchCondition:{...this.state.searchCondition,deviceType:r?void 0:a.Y}}),e&&t&&0===await this.updatePvTableData(e,t,n,r)&&r&&(await this.updatePvTableData(e,t,n),this.setState({searchCondition:{...this.state.searchCondition,deviceType:a.Y},hasInverter:!1}))},this.updatePvTableData=async function(e,n,r){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o={...t.state,searchCondition:{...t.state.searchCondition,deviceType:i?D.o.STRING_INVERTER:void 0,parentDn:e,mocId:null==r?void 0:r.mocId}},a=await n(o.searchCondition,{page:1,pageSize:10},null,t.state.expriationCondition);return 0!==a&&i&&t.setState({searchCondition:{...t.state.searchCondition,deviceType:D.o.STRING_INVERTER},hasInverter:!0}),ri.next(),a},this.headToStationPage=e=>{window.open(`/pvmswebsite/assets/build/index.html#/station/overview/${e}`)},this.searchHandler=e=>{var t;const{parentDn:n}=this.props,r={searchCondition:{...e,isLoadMaintenance:!1,mocId:null===(t=this.props.selectedTreeNode)||void 0===t?void 0:t.mocId}};this.setState({...r}),r.searchCondition.parentDn=n,ii.next(r.searchCondition)},this.getTotal=e=>{this.setState({total:e})},this.setTableHeight=d()((()=>{var e,t,n,r,i,o,a;const s=null!==(e=(null===(t=document.querySelector(\".collapse-form\"))||void 0===t||null===(n=t.getBoundingClientRect())||void 0===n?void 0:n.height)+110)&&void 0!==e?e:120,l=null===(r=document.querySelector(\".nco-pv-table .ant-table-thead\"))||void 0===r||null===(i=r.getBoundingClientRect())||void 0===i?void 0:i.height,c=null===(o=document.querySelector(\".nco-pv-toolbar\"))||void 0===o||null===(a=o.getBoundingClientRect())||void 0===a?void 0:a.height,u=(0,x.h)(\".nco-pv-container\",s+l+c);this.setState({tableHeight:u})}),500);const r=this.getExpriationCondition(),{selectedTreeNode:i={},intl:o}=e,{elementDn:s,parentDn:l,mocId:u}=i;this.state={searchCondition:{parentDn:e.parentDn||\"/\",mocId:null===(n=e.selectedTreeNode)||void 0===n?void 0:n.mocId,isLoadMaintenance:!1},selectedRows:[],selectedSubDevs:[],firstRender:!0,expriationCondition:r,total:0,areaList:[],tableHeight:\"\",hasInverter:void 0},this.stationTypeList=[{value:a.Y,label:o.formatMessage({id:\"neteco.pvms.all\"})},{value:1,label:o.formatMessage({id:\"neteco.pvms.stationInfo.addStation.stationType.1\"})},{value:2,label:o.formatMessage({id:\"neteco.pvms.stationInfo.addStation.stationType.2\"})},{value:3,label:o.formatMessage({id:\"neteco.pvms.stationInfo.addStation.stationType.3\"})}],this.startTime=ti.$.pageAccess(oi,{pageName:si,scope:(0,c.wE)(u,l,s)})}componentDidMount(){const{match:e,parentDn:t,loadNcoPvTable:n,selectedTreeNode:r}=this.props,{selectedStation:i}=e.params;(0,g.lVp)(g.sX$)&&(S.Z.loadTimeZoneList().then((e=>{this.setState({areaList:e})})),y.Z.getCurrentCompany().then((e=>{if(!(0,b.xb)(e)){this.setState({userCompany:e});const{moDn:t}=e;i?(0,v.Nu)(\"reload_device-management_left_tree\",{targetDn:i,pageId:1}):t&&(0,v.Nu)(\"reload_device-management_left_tree\",{targetDn:t,pageId:1})}})),this.clearSelectedRowSub=ni.subscribe((()=>{this.clearSelectedItems()})),this.repeatDeviceList())}componentDidUpdate(e){const{parentDn:t}=this.props;t!==e.parentDn&&(this.setState({hasInverter:void 0}),this.repeatDeviceList())}componentWillUpdate(e,t,n){const{userCompany:r={}}=t;if(r){const{moDn:e}=r;(0,v.Nu)(\"device-management-reload-entire-tree\",{rootElementDn:e})}}componentWillUnmount(){const{selectedTreeNode:e={}}=this.props,{elementDn:t,parentDn:n,mocId:r}=e;this.setState=a.mz,li.FIRST_RENDER=!0,this.clearSelectedRowSub&&this.clearSelectedRowSub.unsubscribe(),ti.$.pageLeave(this.startTime,ai,{pageName:si,scope:(0,c.wE)(r,n,t)})}render(){const{searchCondition:e,selectedRows:t,selectedSubDevs:n,expriationCondition:r,total:i,areaList:l}=this.state,{replaceModalVisible:c,selectedTreeNode:u,parentDn:d}=this.props;e.parentDn=d;const p=(0,s.PW)(u);return(0,g.lVp)(g.sX$)?(0,N.jsx)(\"div\",{className:\"nco-pv-container\",id:\"nco-pv-container\",children:(0,N.jsxs)(\"div\",{className:\"nco-device-information-main-content\",children:[(0,N.jsx)(R,{parentDn:d,isSharedStation:p,onSubmit:this.searchHandler,setTableHeight:this.setTableHeight,areaList:l,stationTypeList:this.stationTypeList,searchCondition:this.state.searchCondition,isSystemDeviceManagement:this.props.isSystemDeviceManagement,hasInverter:this.state.hasInverter}),(0,N.jsx)(ei,{searchCondition:e,selectedRows:t,parentDn:d,selectedSubDevs:n,selectedTreeNode:u,isSharedStation:p,total:i,isSystemDeviceManagement:this.props.isSystemDeviceManagement}),(0,N.jsx)(o.Bo,{children:t=>{let{type:n}=t;const i=n===a.M5.smartpvms;return(0,N.jsx)(Xn,{isSmartPVMS:i,searchCondition:e,onSelectionChange:this.selectionChangeHandler,headToStationPage:this.headToStationPage,addSelectedSubDevs:this.addSelectedSubDevs,removeSelectedSubDevs:this.removeSelectedSubDevs,replaceModalVisible:c,expriationCondition:r,getTotal:this.getTotal,setTableHeight:this.setTableHeight,tableHeight:this.state.tableHeight,areaList:l,stationTypeList:this.stationTypeList})}})]})}):(0,N.jsx)(w.Z,{})}}li.FIRST_RENDER=!0;const ci=(0,f.EN)(li),ui=(0,r.$j)((e=>({replaceModalVisible:e.ncoPvToolbar.replaceModalVisible})),(e=>({loadNcoPvContainer:(t,n)=>{(async e=>{e({type:\"NCOPVCONTAINER/START_LOADING\"}),e({type:\"NCOPVCONTAINER/FINISH_LOADING\",payload:undefined})})(e)},loadNcoPvTable:(t,n,r,i)=>{let{page:o,pageSize:a}=n;return qn(e,t,{page:o,pageSize:a},0,i)}})))((0,i.ZP)(ci))},61686:(e,t,n)=>{\"use strict\";n.d(t,{Bq:()=>a,Mb:()=>r,PT:()=>o,T_:()=>i});const r=\"NCOPVSEARCHBAR/START_LOADING\",i=\"NCOPVSEARCHBAR/FINISH_LOADING\",o=\"NCOPVSEARCHBAR/LOAD_DEVICE_TYPE_LIST\",a=\"NCOPVSEARCHBAR/INIT_DATA\"},94852:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>o});var r=n(61686);const i={loading:!1,amount:0,deviceTypeList:[]},o=(e,t)=>{const n=null!=e?e:i;switch(t.type){case r.Mb:return{...n,loading:!0};case r.T_:return{...n,loading:!1,amount:t.payload};case r.Bq:return{...n,deviceTypeList:[]};case r.PT:{const e=t.payload.map((e=>({mocId:e.mocId,mocTypeName:e.mocTypeName}))).filter((e=>60026!==e.mocId));return{...n,deviceTypeList:e}}default:return n}}},56125:(e,t,n)=>{\"use strict\";n.d(t,{MC:()=>o,Mb:()=>r,Md:()=>c,O1:()=>a,T_:()=>i,w8:()=>s,wE:()=>l});const r=\"NCOMONITORPVTABLE/START_LOADING\",i=\"NCOMONITORPVTABLE/FINISH_LOADING\",o=\"NCOMONITORPVTABLE/UPDATE_SORT_CONDITION\",a=\"NCOMONITORPVTABLE/LOAD_SUBDEVICES\",s=\"NCOMONITORPVTABLE/SUPPORT_TRADING_AREA_LOAD\",l=\"NCOMONITORPVTABLE/LOAD_BATTERY_DATA_LIST\",c=\"NCOMONITORPVTABLE/LOAD_LITHIUM_CELL_DATA_LIST\"},22339:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>l});var r=n(56125),i=n(99073);const o={loading:!1,sortCondition:{sortBy:\"column1\",sortOrder:\"ascend\"},tableData:{list:[],total:0,page:1,pageSize:10},supportTradingAreaInfo:{},batteryDataList:{data:[],options:[]},lithiumCellDataList:{}},a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{paramValues:{}};return 60066===e?t.paramValues[10007]||\"\":60022===e?t.paramValues[10041]||\"\":60014===e&&t.paramValues[50012]||\"\"},s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{paramValues:{}};return 60066===e?t.paramValues[10008]||\"\":60014===e&&t.paramValues[50010]||\"\"},l=(e,t)=>{const n=null!=e?e:o;switch(t.type){case r.Mb:return{...n,loading:!0};case r.T_:return{...n,loading:!1,tableData:t.payload};case r.MC:return{...n,sortCondition:t.payload};case r.O1:{const{dn:e,parentDn:r,communicationName:o,communicationDn:u}=t.payload,{list:d}=n.tableData,p=d.findIndex((t=>t.dn===e)),f=[...d],h={...f[p]},{subDevs:m}=t.payload;let g=[];if(m){const e=[],t=[];let n=\"Disconnected\";for(let d=0;d<m.length;d++){const p=m[d];if(20814===m[d].mocId)e.push(p),\"Connected\"===p.status&&(n=\"Connected\");else{const{mocId:e}=p;t.push({...p,status:p.status,devRunningState:p.deviceStatus,stationName:h.stationName,stationKey:h.stationKey,softwareVersion:s(e,p),esn:a(e,p),devTypeId:(l=e,c=p,60066===l?c.paramValues[10009]||\"\":60014===l&&c.paramValues[50009]||\"\"),devName:p.name,bindUsers:p.paramValues[50017]||i.lH,parentDeviceName:o||h.name,communicationDn:u||i.lH,upLevelDeviceName:p.parentName||i.lH,parentDn:r})}}if(g=g.concat(t),e.length>0){let t=e[0];e.forEach((e=>{t.dnId<=e.dnId&&(t=e)}));let a=i.lH;t.paramValues&&t.paramValues[20006]&&(a=t.paramValues[20006]);const s={...t,dn:t.dn,status:n,devRunningState:n,stationName:h.stationName,stationKey:h.stationKey||i.lH,name:`Optimizer(${e.length})`,devName:`Optimizer(${e.length})`,parentDeviceName:o||h.name,upLevelDeviceName:t.parentName||i.lH,parentDn:r,softwareVersion:a,allOpts:e};g.push(s)}}return h.children=m?g:void 0,h.hasLoadedSubDevices=!0,f[p]=h,{...n,tableData:{...n.tableData,list:f}}}case r.w8:return{...n,supportTradingAreaInfo:t.payload};case r.wE:return{...n,batteryDataList:t.payload};case r.Md:return{...n,lithiumCellDataList:t.payload};default:return n}var l,c}},59376:(e,t,n)=>{\"use strict\";n.d(t,{K6:()=>a,Lc:()=>c,Mb:()=>r,T_:()=>i,cd:()=>s,dS:()=>o,sM:()=>l});const r=\"NCOPVTOOLBAR/START_LOADING\",i=\"NCOPVTOOLBAR/FINISH_LOADING\",o=\"NCOPVTOOLBAR/FILL_TYPES_AND_SIGNALS\",a=\"NCOPVTOOLBAR/CLEAR_TYPES_AND_SIGNALS\",s=\"NCOPVTOOLBAR/PREPARE_TASK_INST\",l=\"NCOPVTOOLBAR/CLEAR_TASK_INST\",c=\"NCOPVTOOLBAR/ REPLACE_MODAL_VISIBLE\"},65227:(e,t,n)=>{\"use strict\";n.d(t,{Bt:()=>o,Gn:()=>i,oc:()=>a});var r=n(83621);const i={releaseDevice:\"releaseDevice\",parameterSettings:\"parameterSettings\",swapDevice:\"swapDevice\",exportPerformanceData:\"exportPerformanceData\",delete:\"delete\",importDeviceName:\"importDeviceName\",exportBasic:\"exportBasic\"},o={[i.parameterSettings]:{types:new Set([r.o.STRING_INVERTER,r.o.HOUSEHOLD_INVERTER,r.o.STORAGE,r.o.BUSINESS_SMART_LOGGER,r.o.DONGLE,r.o.SMART_LOGGER,r.o.AIR_CONDITIONER,r.o.ESU,r.o.PCS,r.o.BATTERY_CLUSTER,r.o.DCDC,r.o.ESS,r.o.NCU,r.o.STS,r.o.PID,r.o.HEMS,r.o.GENEARTOR]),names:[\"neteco.pvms.devTypeLangKey.smartLog\",\"neteco.pvms.devTypeLangKey.inverter\",\"neteco.pvms.devTypeLangKey.energy_store\",\"neteco.pvms.devTypeLangKey.PCS\",\"neteco.pvms.devTypeLangKey.BCU\",\"neteco.pvms.devTypeLangKey.CMU\",\"neteco.pvms.business.dcToDc.energyFlow.batteryCluster\",\"neteco.pvms.devTypeLangKey.boxTransformer\",\"neteco.pvms.devTypeLangKey.dongleCommunicateModel\",\"neteco.pvms.devTypeLangKey.DCDC\",\"neteco.pvms.devTypeLangKey.NCU\",\"neteco.pvms.devTypeLangKey.PID\",\"neteco.pvms.devTypeLangKey.EMMA\",\"neteco.pvms.devTypeLangKey.airConditioner\",\"neteco.pvms.devTypeLangKey.Generator\"]},[i.swapDevice]:{types:new Set([r.o.STRING_INVERTER,r.o.DONGLE,r.o.SMART_LOGGER,r.o.BUSINESS_SMART_LOGGER,r.o.HEMS,r.o.PCS]),names:[\"neteco.pvms.devTypeLangKey.smartLog\",\"neteco.pvms.devTypeLangKey.inverter\",\"neteco.pvms.devTypeLangKey.PCS\",\"neteco.pvms.devTypeLangKey.dongleCommunicateModel\",\"neteco.pvms.devTypeLangKey.EMMA\"]},[i.exportPerformanceData]:{types:new Set([r.o.STRING_INVERTER,r.o.HOUSEHOLD_INVERTER,r.o.STORAGE,r.o.EMI,r.o.OPTIMIZER,r.o.POWER_METER,r.o.METER,r.o.AIR_CONDITIONER,r.o.BATTERY_CLUSTER,r.o.PCS,r.o.ESS,r.o.DCDC,r.o.TCUE,r.o.NCU,r.o.PID,r.o.SMART_LOGGER,r.o.ESM,r.o.HEMS,r.o.GENEARTOR,r.o.BACKUP_BOX,r.o.CHARGE_DC,r.o.GENEARTOR_SET,r.o.CHARGE_PILE_CI]),names:[\"neteco.pvms.devTypeLangKey.smartLog\",\"neteco.pvms.devTypeLangKey.inverter\",\"neteco.pvms.devTypeLangKey.energy_store\",\"neteco.pvms.devTypeLangKey.PCS\",\"neteco.pvms.devTypeLangKey.BCU\",\"neteco.pvms.business.dcToDc.energyFlow.batteryCluster\",\"neteco.pvms.devTypeLangKey.optimizer\",\"neteco.pvms.devTypeLangKey.meter\",\"neteco.pvms.devTypeLangKey.TCUE\",\"neteco.pvms.devTypeLangKey.airConditioner\",\"neteco.pvms.devTypeLangKey.DCDC\",\"neteco.pvms.devTypeLangKey.NCU\",\"neteco.pvms.devTypeLangKey.PID\",\"neteco.pvms.devTypeLangKey.emi\",\"neteco.pvms.devTypeLangKey.lithiumBattery\",\"neteco.pvms.devTypeLangKey.EMMA\",\"neteco.pvms.devTypeLangKey.Generator\",\"neteco.pvms.devTypeLangKey.BackupBox\",\"neteco.pvms.devTypeLangeKey.dc.business\",\"neteco.pvms.pcs.station.energyflow.generatorSet\",\"neteco.pvms.devTypeLangeKey.ac.charger\"]}},a={BASIC_MESSAGE:\"basicTask\",PERFORMANCE_DATA:\"performanceTask\",PARAMTER_SETTING_TASK:\"parameterSettingsTask\",EMMA_MIGRATION:\"emmaNetworkReconstruction\",REPLACE_DEVICE:\"replaceDevice\"}},63042:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>o});var r=n(59376);const i={loading:!1,amount:0,typesAndSignals:[],simpleInsts:[],replaceModalVisible:!1},o=(e,t)=>{const n=null!=e?e:i;switch(t.type){case r.Mb:return{...n,loading:!0};case r.T_:return{...n,loading:!1,amount:t.payload};case r.dS:return{...n,typesAndSignals:t.payload};case r.K6:return{...n,typesAndSignals:[]};case r.cd:return{...n,simpleInsts:t.payload};case r.sM:return{...n,simpleInsts:[]};case r.Lc:return{...n,replaceModalVisible:t.payload};default:return n}}},77577:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>D});var r=n(33670),i=n(62073),o=n(41541),a=n(45258),s=n(88391),l=n(78939),c=n(15812),u=n(24301),d=n(56687),p=n(7399),f=n(33734),h=n(9381),m=n(49453),g=n(68718),v=n(31519),y=n(44184),b=n(18206),S=n(80770),x=n(70440),w=n(23712);const{deviceMgtView:C}=v.e,{swappingDevice:T,pageName:A}=C,{swappingDeviceId:E,swappingDeviceActionName:O,processResult:M}=T,P={},D=e=>{let{visible:t,cancelChange:n,intl:v,selectedRows:C,isOpt:T,loadDataSource:D,openTaskListModal:I}=e;const N=50010,_=50009,j=50012,k=20005,L=20006,R=20009,[Z,B]=(0,s.useState)(P),[F,z]=(0,s.useState)(P),[V,H]=(0,s.useState)(!1),[U,G]=(0,s.useState)(\"\"),[Y,W]=(0,s.useState)(!0),[K,q]=(0,s.useState)(!1),[Q,X]=(0,s.useState)(!1),[J,$]=(0,s.useState)([]),[ee,te]=(0,s.useState)({pageSize:10,pageIndex:1}),[ne,re]=(0,s.useState)([]),ie=(0,s.useRef)(null),oe=(0,s.useRef)(null),ae=(0,s.useRef)(null);(0,s.useEffect)((()=>(t&&me(),se)),[t]);const se=()=>{const e=(null==oe?void 0:oe.current)&&oe.current,t=(null==ae?void 0:ae.current)&&ae.current;e&&clearTimeout(e),t&&!ie.current&&t.destroy()},le=e=>{(0,g.WW)(E,{pageName:A,actionName:O,processResult:e})},ce=e=>{switch(e){case 1:return v.formatMessage({id:\"ncoPvModifyDeviceForm.label.sn\"});case 2:return v.formatMessage({id:\"ncoPvTable.column.softwareVersion\"});case 3:return v.formatMessage({id:\"neteco.pvms.partials.main.dm.inverterType\"});default:return\"\"}},ue=(e,t)=>{if((0,y.xb)(e))return[];const{pageSize:n,pageIndex:r}=t,i=(r-1)*n,o=(0,y.p$)(e.slice(i,i+n));if(0===o[0].rowSpan){const e=o.findIndex((e=>e.rowSpan>0));o[0].rowSpan=-1!==e?e:n}return o},de=()=>{G((()=>\"\")),W((()=>!0)),z((()=>({}))),X(!1),$([])},pe=(e,t)=>{var n,r;return null!==(n=null===(r=e[t])||void 0===r?void 0:r.value)&&void 0!==n?n:\"\"},fe=(e,t)=>{ie.current||([0,1].includes(e)?(le(M.success),(0,S.Sb)(he(t),ge)):[2,3,4].includes(e)?(le(M.fail),(0,S.CD)(he(t),ge)):(le(M.fail),(0,S.jT)(v.formatMessage({id:t}),v)))},he=e=>{const t=(0,w.jsx)(o.Z,{type:\"link\",className:\"nco-device-modal-sync-tip-link\",onClick:()=>{ge(),a.Z.destroyAll(),I()},children:v.formatMessage({id:\"neteco.pvms.device.replace.device.success.link\"})});return(0,w.jsxs)(\"div\",{children:[v.formatMessage({id:e}),Q&&(0,w.jsx)(\"div\",{children:v.formatMessage({id:\"neteco.pvms.device.replace.device.success.tip\"},{0:t})})]})},me=async()=>{if(C.length>0){const{dn:e}=C[0];if(e){const t=[N,_,j,k,L,R],{code:n,data:r,message:i}=await(0,m.v_)(`/rest/neteco/web/displacement/v1/device-property-query?dn=${escape(e)}`,t);if(0===n){const{ne:e,signalMap:t}=r;H((()=>e)),B((()=>t))}else(0,S.jT)(v.formatMessage({id:i}),v)}}},ge=()=>{W((()=>!0)),n(),de(),se(),D&&D()},ve=[{title:`${v.formatMessage({id:\"neteco.pvms.device.replace.sync.signals.table.group\"})}`,key:\"groupName\",dataIndex:\"groupName\",onCell:e=>({rowSpan:e.rowSpan})},{title:`${v.formatMessage({id:\"neteco.pvms.device.replace.sync.signals.table.name\"})}`,key:\"name\",dataIndex:\"name\",render:e=>window.neteco.util.iUnescape(e)}];return(0,w.jsx)(\"div\",{className:\"nco-device-management-change-modal-wrapper\",children:(0,w.jsxs)(r.Z,{width:\"960px\",visible:t,className:\"nco-device-change-modal\",title:v.formatMessage({id:\"ncoPvTable.toolbar.swapDevice\"}),footer:(0,w.jsxs)(\"div\",{children:[(0,w.jsx)(o.Z,{onClick:ge,children:(0,w.jsx)(l.Z,{id:\"common.button.cancel\"})}),(0,w.jsx)(o.Z,{type:\"primary\",onClick:async()=>{const{dn:e}=C[0];if(q(!0),W((()=>!0)),C.length>0){const t={dn:e,isNe:V,esn:U.trim(),needSyncSignal:Q};oe.current=setTimeout((()=>{se(),ie.current=!0,q(!1),le(M.failOfTimeOut),ae.current=a.Z.error({title:v.formatMessage({id:\"neteco.pvms.info\"}),content:v.formatMessage({id:\"neteco.pvms.device.replace.response.timeout\"}),okText:v.formatMessage({id:\"common.button.ok\"}),centered:!0,maskClosable:!1,onOk:ge})}),18e4);const{code:n,message:r}=await(0,m.v_)(\"/rest/neteco/web/displacement/v1/device-replace\",t);q(!1),se(),fe(n,r)}},disabled:Y,children:(0,w.jsx)(l.Z,{id:\"ncoPvSwapDevice.label.button.swap\"})})]}),closable:!K,onCancel:()=>{!K&&n()},centered:!0,children:[(0,w.jsx)(c.Z,{spinning:K,tip:`${v.formatMessage({id:\"neteco.pvms.systemSetting.replace.device.spin.msg\"})}`,children:(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(\"div\",{className:\"nco-device-change-modal-content\",children:[(0,w.jsxs)(\"div\",{className:\"nco-device-change-current\",children:[(0,w.jsx)(\"div\",{className:\"nco-device-change-current-row current-device-row\",children:v.formatMessage({id:\"neteco.pvms.device.replace.device.current\"})}),(0,w.jsx)(\"div\",{className:\"nco-device-change-current-row current-device-show-row\",children:(0,w.jsx)(\"div\",{className:\"nco-device-current-number\",children:(0,w.jsx)(\"div\",{className:\"nco-device-target-name \",children:T?null===(ye=C[0])||void 0===ye?void 0:ye.optName:null===(be=C[0])||void 0===be?void 0:be.name})})}),(0,w.jsxs)(\"div\",{className:\"nco-device-change-current-row\",children:[(0,w.jsx)(\"div\",{className:\"nco-device-change-label\",title:ce(1),children:ce(1)}),(0,w.jsx)(\"div\",{className:\"nco-device-change-value\",title:pe(Z,T?k:j),children:pe(Z,T?k:j)})]}),(0,w.jsxs)(\"div\",{className:\"nco-device-change-current-row\",children:[(0,w.jsx)(\"div\",{className:\"nco-device-change-label\",title:ce(2),children:ce(2)}),(0,w.jsx)(\"div\",{className:\"nco-device-change-value\",tile:pe(Z,T?L:N),children:pe(Z,T?L:N)})]}),(0,w.jsxs)(\"div\",{className:\"nco-device-change-current-row\",children:[(0,w.jsx)(\"div\",{className:\"nco-device-change-label\",title:ce(3),children:ce(3)}),(0,w.jsx)(\"div\",{className:\"nco-device-change-value\",title:pe(Z,_),children:pe(Z,T?R:_)})]})]}),(0,w.jsxs)(\"div\",{className:\"nco-device-change-target\",children:[(0,w.jsx)(\"div\",{className:\"nco-device-change-target-row target-device-row\",children:v.formatMessage({id:\"ncoPvSwapDevice.label.targbetDevice\"})}),(0,w.jsxs)(\"div\",{className:\"nco-device-change-target-row tartet-device-show-row\",children:[(0,w.jsx)(\"div\",{className:\"nco-device-change-number\",children:(0,w.jsx)(i.Z,{className:\"nco-device-change-number-input\",value:U,placeholder:v.formatMessage({id:\"neteco.pvms.device.replace.SN.input\"}),onChange:e=>{const t=e.target.value;G(t)}})}),(0,w.jsx)(\"div\",{className:\"nco-device-change-button\",children:(0,y.xb)(F)?(0,w.jsx)(u.Z,{title:v.formatMessage({id:\"neteco.pvms.systemSetting.planManage.view\"}),children:(0,w.jsx)(o.Z,{onClick:async()=>{if(C.length>0){const{code:t,data:n,message:r}=await(async()=>{const{dn:e}=C[0],t=T?[L,R,k]:[N,_,j],[n,r]=await(0,y.AM)((0,m.v_)(`/rest/neteco/web/displacement/v1/device-compare?dn=${escape(e)}&isNe=${V}&esn=${U.trim()}&showSyncSignal=true`,t));return r||{}})();if(0===t){if(!(0,y.xb)(n)){var e;const t=await(async e=>!(null!=e&&e.length)>0?[]:(await(async()=>{const[e,t]=await(0,y.AM)((0,m.U2)(\"/rest/pvms/web/device/v1/deviceExt/get-config-signals\",{dn:C[0].dn}));return(null==t?void 0:t.data)||[]})()).reduce(((t,n)=>{const r=n.configSignalDisplayList.filter((t=>e.includes(t.id)));return r.length>0&&r.forEach(((e,n)=>{t.push({groupName:e.displayGroup,name:e.name,id:e.id,rowSpan:0===n?r.length:0})})),t}),[]))(n.syncSignals),r=null===(e=n[50010])||void 0===e?void 0:e.value;W(!1),(0,x.fJ)(r)&&W(!0),z(n),$(t),re(ue(t,ee))}}else{const e=-2===t?\"neteco.pvms.stationInfo.addStation.crossRegion\":r;(0,S.jT)(v.formatMessage({id:e}),v)}}},children:(0,w.jsx)(l.Z,{id:\"neteco.pvms.systemSetting.planManage.view\"})})}):(0,w.jsx)(u.Z,{title:v.formatMessage({id:\"common.button.reset\"}),children:(0,w.jsx)(o.Z,{onClick:de,children:(0,w.jsx)(l.Z,{id:\"common.button.reset\"})})})})]}),(0,w.jsxs)(\"div\",{className:\"nco-device-change-target-row\",children:[(0,w.jsx)(\"div\",{className:\"nco-device-change-label\",title:ce(1),children:ce(1)}),(0,w.jsx)(\"div\",{className:\"nco-device-change-value\",title:pe(F,T?k:j),children:pe(F,T?k:j)})]}),(0,w.jsxs)(\"div\",{className:\"nco-device-change-target-row\",children:[(0,w.jsx)(\"div\",{className:\"nco-device-change-label\",title:ce(2),children:ce(2)}),(0,w.jsx)(\"div\",{className:\"nco-device-change-value\",title:pe(F,T?L:N),children:pe(F,T?L:N)})]}),(0,w.jsxs)(\"div\",{className:\"nco-device-change-target-row\",children:[(0,w.jsx)(\"div\",{className:\"nco-device-change-label\",title:ce(3),children:ce(3)}),(0,w.jsx)(\"div\",{className:\"nco-device-change-value\",title:pe(F,T?R:_),children:pe(F,T?R:_)})]})]})]}),J.length>0&&(0,w.jsxs)(\"div\",{className:\"nco-opt-replace-sync-signals-content\",children:[(0,w.jsxs)(\"div\",{className:\"nco-opt-replace-switch\",children:[(0,w.jsx)(\"span\",{children:v.formatMessage({id:\"neteco.pvms.device.replace.sync.signals.switch\"})}),(0,w.jsx)(u.Z,{title:v.formatMessage({id:\"neteco.pvms.device.replace.sync.signals.tip\"}),children:(0,w.jsx)(d.Z,{className:\"icon-dp-alert-hints-lined\"})}),(0,w.jsx)(p.Z,{checked:Q,onClick:e=>X(e)})]}),Q&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(f.Z,{className:\"nco-opt-replace-sync-signals-table\",columns:ve,dataSource:ne,pagination:!1,bordered:!0,scroll:{y:\"25rem\"}}),(0,w.jsx)(h.Z,{className:\"nco-opt-replace-sync-signals-table-pagination\",total:J.length,showSizeChanger:!0,totalFixedLeft:!0,pageSize:ee.pageSize,current:ee.pageIndex,onChange:(e,t)=>{const n={pageSize:t,pageIndex:e};te(n),re(ue(J,n))},pageSizeOptions:[\"10\",\"20\",\"50\",\"100\"],showTotal:(0,b.Z)(v)})]})]})]})}),T&&(0,w.jsxs)(\"p\",{className:\"nco-opt-replace-tip-p\",children:[(0,w.jsx)(\"img\",{class:\"nco-opt-replace-tip\",src:\"/pvmswebsite/assets/build/images/home/tipsIcon.png\"}),v.formatMessage({id:\"ncoPvTable.opt.replace.tip\"})]})]})});var ye,be}},31464:(e,t,n)=>{\"use strict\";n.d(t,{Zo:()=>o,i$:()=>c,qD:()=>a,s:()=>s,zC:()=>l});var r=n(44184),i=n(49453);const o=new class{constructor(){this.cyList=null,this.currencysCacheMap=new Map}async init(){const[e,t]=await(0,r.AM)((0,i.U2)(\"/rest/dp/elecpriceservice/v1/currency\"));return e?[]:(t.forEach((e=>{const{id:t}=e||{};this.currencysCacheMap.set(Number(t),e)})),t)}async getCurrencyList(){return(0,r.xb)(this.cyList)&&(this.cyList=await this.init()),this.cyList}getCurrencyById(e){return this.currencysCacheMap.get(Number(e))}},a={1:\"CNY\",2:\"USD\",3:\"JPY\",4:\"EUR\",5:\"GBP\",6:\"INR\",7:\"AUD\",8:\"AED\",9:\"ZAR\",10:\"EGP\",11:\"ARS\",12:\"TRL\",13:\"MXN\",14:\"BRL\",15:\"ESP\",16:\"CAD\",17:\"KRW\",18:\"MAD\",19:\"CLP\",20:\"PKR\",21:\"SAR\",22:\"THB\",23:\"MYR\",24:\"SGD\",25:\"VND\",26:\"PHP\",27:\"HKD\",28:\"PLN\",29:\"CHF\",30:\"TWD\",31:\"HUF\",32:\"TRY\",34:\"UAH\",35:\"NZD\",36:\"IDR\",37:\"GTQ\",38:\"HNL\",39:\"SVC\",40:\"PAB\",41:\"DOP\",42:\"VEF\",43:\"COP\",44:\"PEN\",45:\"BOB\"},s={\"de-de\":4,\"en-us\":2,\"es-es\":4,\"fr-fr\":4,\"it-it\":4,\"ja-jp\":3,\"nl-nl\":4,\"pl-pl\":4,\"pt-br\":4,\"zh-cn\":1,\"vi-vn\":25,\"hu-hu\":31,\"uk-ua\":34,\"ko-kr\":17,\"zh-tw\":30,\"tr-tr\":32},l=async e=>{const[t,n]=await(0,r.AM)((0,i.U2)(\"/rest/dp/pvms/pvmswebservice/v1/currency\",{dn:e}));return t?\"\":n.currencyId},c=e=>e.includes(\"元\")},80864:(e,t,n)=>{\"use strict\";n.d(t,{ZP:()=>a,m3:()=>o,u:()=>i});var r=n(49453);const i=()=>Intl.DateTimeFormat().resolvedOptions().timeZone,o=async()=>{const e=await(0,r.U2)(\"/rest/neteco/pvms/v1/timezone-management/timezone-info-list?mocId=20801&sigId=21023\"),{code:t,data:n={}}=e;let i=[],o={};return 0===t&&(i=n.enumListEntry||[],o=n.supportDlsTimezoneMap||{}),{timezones:i,supportMap:o}},a=e=>e?-1*new Date(e).getTimezoneOffset()/60:-1*(new Date).getTimezoneOffset()/60},91138:(e,t,n)=>{\"use strict\";n.d(t,{JQ:()=>s,VD:()=>c,XB:()=>l});var r=n(49453),i=n(4342);const o=(0,i.vW)(),a=(0,i.n5)(),s=e=>(0,r.U2)(\"/rest/pvms/web/viewsetting/v1/viewcfg\",{userName:o,userId:a,viewType:e}),l=(e,t)=>{const n=e.map((e=>e.dataIndex)).toString();return(0,r.v_)(\"/rest/pvms/web/viewsetting/v1/viewcfg\",{userName:o,listViewContent:n,userId:a,viewType:t})},c=e=>(0,r.IV)(\"/rest/pvms/web/viewsetting/v1/viewcfg\",{userName:o,userId:a,viewType:e})},16910:(e,t,n)=>{\"use strict\";n.d(t,{BH:()=>N,Cx:()=>I,IZ:()=>D,Nu:()=>m,Ou:()=>x,QM:()=>g,VP:()=>j,Z6:()=>v,Z9:()=>A,Zr:()=>C,_v:()=>O,aH:()=>M,ax:()=>y,hy:()=>b,jE:()=>w,kG:()=>E,kJ:()=>_,lS:()=>S,lW:()=>h,uY:()=>P});var r=n(17489),i=(n(88391),n(64120)),o=n(78939),a=n(31251),s=n(37825),l=n(13528),c=n(4342),u=n(44184),d=n(23712);const{neteco:p}=window,f=new Set([20011,20012]),h=(e,t)=>(C(t)&&(0,i.default)(e,(e=>f.has(Number(e.id)))),e),m=(e,t)=>{window.dispatchEvent(new CustomEvent(e,{detail:t}))},g=(e,t)=>{let n=!1;return\"string\"==typeof e&&(n=!0),(0,d.jsx)(\"div\",{title:n?e:e.title,className:\"wrapper-ellipsis\",style:t?{maxWidth:t-16+\"px\"}:{},children:n?e:e.component})},v=()=>(0,c.jq)(),y=()=>window.screen.width<1400,b=e=>20821===parseInt(e)||20820===parseInt(e),S=e=>20851===parseInt(e),x=e=>20819===parseInt(e),w=e=>20801===e,C=e=>T(e),T=e=>20822===parseInt(e),A=e=>20838===parseInt(e),E=(e,t,n)=>{const{useBorderAround:i,useBlueBackground:a,intl:s,titleWidth:c=12,valueWidth:u=12,isBasicInfo:f}=n,{useEmpty:h,useIntl:m=!0}=e,g=parseInt(t/3)%2==0,v=i?{borderRight:\"1px solid #e8e8e8\"}:{},{suffix:y,value:b}=e,S=b?f?b:p.util?(0,l.Y4)(p.util.iUnescape(b)):(0,l.af)(b):\"-\";return(0,d.jsxs)(r.Z,{span:e.span,className:g?\"odd-line\":\"even-line\",style:i&&t%3==0?{borderLeft:\"1px solid #e8e8e8\"}:{},children:[(0,d.jsxs)(r.Z,{span:c,className:\"has-padding has-padding-first\",title:e.title?m?`${s.formatMessage({id:e.title})} ${y||\"\"}`:`${e.title} ${y||\"\"}`:\"\",style:{...v,...a?{backgroundColor:\"#eaf6f9\"}:{}},children:[!h&&(0,d.jsx)(\"span\",{className:\"circle\"}),e.title?(0,d.jsxs)(\"span\",{children:[m?(0,d.jsx)(o.Z,{id:e.title}):(0,d.jsx)(\"span\",{children:e.title}),y?`(${y})`:\"\"]}):(0,d.jsx)(\"span\",{})]}),(0,d.jsx)(r.Z,{span:u,style:{...v,...a?{backgroundColor:\"#fff\"}:{}},className:\"has-padding\",children:(0,d.jsx)(\"div\",{title:S,style:{width:\"100%\",textOverflow:\"ellipsis\",overflow:\"hidden\",whiteSpace:\"nowrap\",textAlign:\"center\"},children:(()=>{if(\"s\"===e.unit){const{value:t}=e;if(!/^[0-9]+$/.test(String(t)))return\"\";const n=new Date(1e3*parseInt(t)),r=n.getFullYear();let i=n.getMonth();i=i>=10?i:`0${i}`;let o=n.getDate();o=o>=10?o:`0${o}`;let a=n.getHours();a=a>=10?a:`0${a}`;let s=n.getMinutes();s=s>=10?s:`0${s}`;let l=n.getSeconds();return l=l>=10?l:`0${l}`,`${r}-${i}-${o} ${a}:${s}:${l}`}return!h&&`${S||\"-\"}${\"%\"===e.unit||\"℃\"===e.unit?\"\":\" \"}${e.unit||\"\"}`})()})})]},e.title?m?`${s.formatMessage({id:e.title})} ${y||\"\"}`:`${e.title} ${y||\"\"}`:`null-${t}`)},O=e=>\"zh-cn\"===p.i18n.getLocale()&&\"kWh\"===e?\"度\":\"zh-cn\"===p.i18n.getLocale()&&\"min\"===e?(0,d.jsx)(o.Z,{id:\"neteco.pvms.userManagement.online.onlyUseInZh.time.minute\"}):e,M=e=>{const t=s.H0.includes((0,a.rC)());return\"zh-cn\"===p.i18n.getLocale()&&t?e.replace(/（kWh）/,\"（度）\").replace(/\\(kWh\\)/,\"(度)\").replace(/（s）/,\"（秒）\").replace(/\\(s\\)/,\"(秒)\"):e},P=e=>{let t=0;return e=e.split(\".\"),t=256*Number(e[0])*256*256+256*Number(e[1])*256+256*Number(e[2])+Number(e[3]),t>>>=0,t},D=e=>{const t=parseInt(e);let n,r=[];return r[0]=t>>>24>>>0,r[1]=t<<8>>>24>>>0,r[2]=t<<16>>>24,r[3]=t<<24>>>24,n=String(r[0])+\".\"+String(r[1])+\".\"+String(r[2])+\".\"+String(r[3]),n},I=e=>new Set([230190110,230190111,230190171]).has(parseInt(e)),N=e=>new Set([230700271]).has(parseInt(e)),_=(e,t)=>[230190116,230102787,230223895,230700176].includes(e)?\"\":t,j=()=>(0,u.zh)()},87937:(e,t,n)=>{\"use strict\";n.d(t,{HW:()=>i,Hw:()=>a,rJ:()=>o}),n(44184);var r=n(49453);const i=async(e,t,n)=>function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4;return new Promise((i=>{(0,r.Sg)(e,t,n).then((e=>i({success:!0,data:e}))).catch((e=>i({success:!1,data:e})))}))}(`/rest/pvms/web/device/v1/batch-device-history-data?showDst=true&${e.map((e=>`deviceDns=${e}`)).join(\"&\")}&${t.map((e=>`signalIds=${e}`)).join(\"&\")}&date=${n}`),o=async(e,t)=>(0,r.v_)(\"/rest/pvms/web/monitor/v1/refresh/signal/signal-refresh\",{dn:e,scenes:\"config\",operateSerial:t}),a=async e=>{const t=await(0,r.U2)(\"/rest/pvms/web/business/v1/container/right-information\",{deviceDn:e,signals:\"20002\"}),{success:n,data:i}=t;if(n){let e=\"-\";i[0]&&(e=i[0].value);const t=parseInt(e);return isNaN(t)?\"\":t>=512?\"cabinet\":\"container\"}}},41621:(e,t,n)=>{\"use strict\";n.d(t,{X:()=>o});var r=n(99073),i=n(13528);const o=function(e,t,n){let o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!e||0===(null==e?void 0:e.length))return r.lH;const a=e.find((e=>e.id===t));return a?n?!a[n]||(0,i.s)(a[n])?r.lH:o?(0,i.af)(a[n]):a[n]:null==a||!a.realValue||(0,i.s)(a.realValue)?r.lH:`${o?(0,i.af)(a.realValue):a.realValue}  ${a.unit}`:r.lH}},6916:(e,t,n)=>{\"use strict\";n.d(t,{Dw:()=>o,Mb:()=>r,R4:()=>a,T_:()=>i});const r=\"NCOMONITORADDSUBJECTREPORTFORM/START_LOADING\",i=\"NCOMONITORADDSUBJECTREPORTFORM/FINISH_LOADING\",o=\"NCOMONITORADDSUBJECTREPORTFORM/CHANGE_SAVE_LOAD_STATUS\",a=\"NCOMONITORADDSUBJECTREPORTFORM/RESET_REDUCER\"},98761:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>o});var r=n(6916);const i={loading:!1,amount:0,saveLoad:!1},o=(e,t)=>{const n=null!=e?e:i;switch(t.type){case r.Mb:return{...n,loading:!0};case r.T_:return{...n,loading:!1,amount:t.payload};case r.Dw:return{...n,saveLoad:t.payload};case r.R4:return{...i};default:return n}}},20950:(e,t,n)=>{\"use strict\";n.d(t,{MC:()=>a,Mb:()=>r,T_:()=>i,Z8:()=>l,bP:()=>s,lK:()=>c,mk:()=>o});const r=\"NCOMONITORENERGYSTORAGESEARCHBAR/START_LOADING\",i=\"NCOMONITORENERGYSTORAGESEARCHBAR/FINISH_LOADING\",o=\"NCOMONITORENERGYSTORAGESEARCHBAR/UPDATE_SEARCH_CONDITION\",a=\"NCOMONITORENERGYSTORAGESEARCHBAR/UPDATE_SORT_CONDITION\",s=\"NCOMONITORENERGYSTORAGESEARCHBAR/SUBJECT_CHECK\",l=\"NCOMONITORENERGYSTORAGESEARCHBAR/CLEAR_SEARCH_CONDITION\",c=\"NCOMONITORENERGYSTORAGESEARCHBAR/CHANGE_EXPORT_LOADING\"},7921:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>s});var r=n(37920),i=n.n(r),o=n(20950);const a={loading:!1,isShowModal:!1,exportLoading:!1,searchCondition:{devices:[],timeDimension:\"date\",statisticTime:i()().startOf(\"day\"),deviceDimension:\"STORAGE\"},sortCondition:{sortBy:\"chargeCap\",sortOrder:\"descend\"}},s=(e,t)=>{const n=null!=e?e:a;switch(t.type){case o.Mb:return{...n,loading:!0};case o.mk:return{...n,searchCondition:t.payload};case o.MC:return{...n,sortCondition:t.payload};case o.bP:return{...n,isShowModal:t.payload};case o.Z8:return{...n,searchCondition:{devices:[],timeDimension:\"date\",statisticTime:i()().startOf(\"day\"),deviceDimension:\"STORAGE\"}};case o.lK:return{...n,exportLoading:t.payload};case o.T_:return{...n,loading:!1};default:return n}}},9462:(e,t,n)=>{\"use strict\";n.d(t,{M:()=>r,T:()=>i});const r=\"NCOMONITORENERGYSTORAGETABLE/START_LOADING\",i=\"NCOMONITORENERGYSTORAGETABLE/FINISH_LOADING\"},57031:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>o});var r=n(9462);const i={loading:!1,tableData:{list:[],total:0,pageNo:1,pageSize:10,pageCount:0}},o=(e,t)=>{const n=null!=e?e:i;switch(t.type){case r.M:return{...n,loading:!0};case r.T:return{...n,loading:!1,tableData:t.payload};default:return n}}},50548:(e,t,n)=>{\"use strict\";n.d(t,{MC:()=>a,Mb:()=>r,T_:()=>i,Z8:()=>l,bP:()=>s,lK:()=>c,mk:()=>o});const r=\"NCOMONITORINVERTERSEARCHBAR/START_LOADING\",i=\"NCOMONITORINVERTERSEARCHBAR/FINISH_LOADING\",o=\"NCOMONITORINVERTERSEARCHBAR/UPDATE_SEARCH_CONDITION\",a=\"NCOMONITORINVERTERSEARCHBAR/UPDATE_SORT_CONDITION\",s=\"NCOMONITORINVERTERSEARCHBAR/SUBJECT_CHECK\",l=\"NCOMONITORINVERTERSEARCHBAR/CLEAR_SEARCH_CONDITION\",c=\"NCOMONITORINVERTERSEARCHBAR/CHANGE_EXPORT_LOADING\"},96187:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>s});var r=n(37920),i=n.n(r),o=n(50548);const a={loading:!1,isShowModal:!1,exportLoading:!1,searchCondition:{devices:[],timeDimension:\"date\",statisticTime:i()().startOf(\"day\")},sortCondition:{sortBy:\"productPower\",sortOrder:\"descend\"}},s=(e,t)=>{const n=null!=e?e:a;switch(t.type){case o.Mb:return{...n,loading:!0};case o.mk:return{...n,searchCondition:t.payload};case o.MC:return{...n,sortCondition:t.payload};case o.Z8:return{...n,searchCondition:{devices:[],timeDimension:\"date\",statisticTime:i()().startOf(\"day\")}};case o.bP:return{...n,isShowModal:t.payload};case o.lK:return{...n,exportLoading:t.payload};case o.T_:return{...n,loading:!1};default:return n}}},63043:(e,t,n)=>{\"use strict\";n.d(t,{M:()=>r,T:()=>i});const r=\"NCOMONITORINVERTERTABLE/START_LOADING\",i=\"NCOMONITORINVERTERTABLE/FINISH_LOADING\"},68116:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>o});var r=n(63043);const i={loading:!1,tableData:{list:[],pageNo:1,pageSize:10,pageCount:0,total:0}},o=(e,t)=>{const n=null!=e?e:i;switch(t.type){case r.M:return{...n,loading:!0};case r.T:return{...n,tableData:t.payload,loading:!1};default:return n}}},46933:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>Pn});var r=n(32449),i=n(88391),o=n(2326),a=n(93706),s=n(39121),l=n(56017),c=n(37920),u=n.n(c),d=n(23774),p=n(78939),f=n(13450),h=n(44851);const m=(e,t)=>{switch(e){case 2:return t.formatMessage({id:\"ncoSubjectReportTable.label.timeDimension.day\"});case 4:return t.formatMessage({id:\"ncoSubjectReportTable.label.timeDimension.month\"});case 5:return t.formatMessage({id:\"ncoSubjectReportTable.label.timeDimension.year\"});case 6:return t.formatMessage({id:\"ncoSubjectReportTable.label.timeDimension.lifetime\"});default:return e}};var g=n(56289),v=n(66915),y=n(46350),b=n(24301),S=n(91987),x=n(11946),w=n(56730),C=n(346),T=n(60762),A=n(16910),E=n(4342),O=n(68718),M=n(53137),P=n(99073),D=n(28976),I=n(64218),N=n(8394),_=n(23712);const{Option:j}=v.Z,k={sites:[],statisticMethod:(0,E.ux)()?\"bySite\":\"byTime\",timeDimension:\"date\",statisticTime:u()().startOf(\"day\"),refreshTime:u()(),checkHourDim:!1};class L extends i.Component{constructor(e){super(e),this.handleStatisticChange=e=>{const{configColumnsByStatistics:t,configColumnsByTime:n,configColumnsByDate:r}=this.props;t(e),this.setState({timeDimension:\"date\",statisticMethod:e}),this.formRef.current.setFieldsValue({statisticTime:(0,w.Z)(\"date\"),timeDimension:\"date\"}),n(\"date\"),r((0,w.Z)(\"date\")),(0,O.om)(\"SITE\",e,\"date\")},this.handleTimeDimensionChange=e=>{const t=(0,w.Z)(e);this.setState({timeDimension:e,dateRange:null,isCheckedHourDim:!1,currentTime:t});const{configColumnsByDate:n,configColumnsByTime:r}=this.props;this.formRef.current.setFieldsValue({statisticTime:t,timeDimension:e,checkHourDim:!1}),r(e),n(t);const i=this.formRef.current.getFieldsValue([\"statisticMethod\"]);(0,O.om)(\"SITE\",i,e)},this.timeOnchange=e=>{const{configColumnsByDate:t,updateSearchCondition:n,searchCondition:r}=this.props;if(this.setState({currentTime:e}),e&&2===e.length){const[t,n]=e;if(n.diff(t,\"day\")>=31)return this.setState({dateRange:[null,null],currentTime:[null,null]}),void this.formRef.current.setFieldsValue({statisticTime:null});this.formRef.current.setFieldsValue({statisticTime:e})}e&&t(e)},this.submitSearchForm=e=>{e.preventDefault();const{onSubmit:t}=this.props;this.formRef.current.validateFields().then((e=>{t(e),(0,O.om)(\"SITE\",e.statisticMethod,e.timeDimension)}))},this.isSelectedSingleStation=e=>{const t=e[0];return 1===e.length&&1===t.moString.split(\",\").length&&(0,I.jE)(t.moType)},this.handleTimeDimOption=(e,t)=>{const{intl:n}=this.props,r=[{value:\"date\",title:n.formatMessage({id:\"ncoInverterReportSearchForm.label.timeDimension.day\"})},{value:\"month\",title:n.formatMessage({id:\"ncoInverterReportSearchForm.label.timeDimension.month\"})},{value:\"year\",title:n.formatMessage({id:\"ncoInverterReportSearchForm.label.timeDimension.year\"})},{value:\"lifetime\",title:n.formatMessage({id:\"ncoSiteReportSearchForm.label.timeDimension.lifetime\"})},{value:\"timeRange\",title:n.formatMessage({id:\"ncoSiteReportSearchForm.label.statisticMethod.byTimeRange\"})}];return((0,I.jE)(e.mocId)||this.isSelectedSingleStation(t))&&\"bySite\"!==this.state.statisticMethod||r.pop(),r.map((e=>(0,_.jsx)(j,{value:e.value,title:e.title,children:e.title})))},this.handleTimeDimSelected=e=>{this.isSelectedSingleStation(e)||\"timeRange\"!==this.state.timeDimension||(this.handleTimeDimensionChange(\"date\"),N.Z.info({message:this.props.intl.formatMessage({id:\"ncoSiteReportSearchForm.tip.timeDimension.change\"}),isNewStyle:!0}))},this.disabledDate=e=>{if(!this.state.dateRange)return!1;const{dateRange:t}=this.state,n=u()(e.format(\"YYYY-MM-DD\")),r=t[0]&&u()(t[0].format(\"YYYY-MM-DD\")),i=t[1]&&u()(t[1].format(\"YYYY-MM-DD\")),o=r&&n.diff(r,\"day\")>=31;return i&&i.diff(n,\"day\")>=31||o||e>u()().endOf(\"day\")},this.checkHourDim=e=>{this.setState({isCheckedHourDim:e.target.checked}),this.formRef.current.setFieldsValue({checkHourDim:e.target.checked});const{onSubmit:t}=this.props;this.formRef.current.validateFields().then((e=>{t(e),(0,O.om)(\"SITE\",e.statisticMethod,e.timeDimension)}))},this.getDateRange=e=>{this.setState({dateRange:e})},this.onOpenChange=e=>{e?this.setState({dateRange:[null,null]}):this.setState({dateRange:null})},this.formRef=i.createRef(),this.state={timeDimension:\"date\",selectedRange:[],dateRange:null,currentTime:e.searchCondition.statisticTime,statisticMethod:(0,E.ux)()?\"bySite\":\"byTime\"}}componentDidMount(){const{userCompany:e,stationDn:t}=this.props;if(!t&&e.moDn){const{moDn:t}=e;(0,A.Nu)(\"site-report-reload-entire-tree\",{rootElementDn:t})}}componentWillUpdate(e){const{userCompany:t,stationDn:n}=e;if(!n&&t.moDn!==this.props.userCompany.moDn){const{moDn:e}=t;(0,A.Nu)(\"site-report-reload-entire-tree\",{rootElementDn:e})}}render(){const{searchCondition:e,intl:t,stationDn:n,getselectedNodes:r,userCompany:i={},selectedTreeNode:o,selectedNodesList:a}=this.props,{timeDimension:s,currentTime:l}=this.state,c=t.formatMessage({id:\"ncoInverterReportSearchForm.label.timeDimension\"}),u=t.formatMessage({id:\"ncoSiteReportSearchForm.label.statisticMethod.byTime\"}),d=t.formatMessage({id:\"ncoSiteReportSearchForm.label.statisticMethod.bySite\"});return(0,_.jsx)(\"div\",{className:\"nco-site-search-form\",children:(0,_.jsxs)(y.Z,{layout:\"inline\",onFinish:this.submitSearchForm,ref:this.formRef,initialValues:k,autoComplete:\"off\",children:[!n&&(0,_.jsx)(y.Z.Item,{label:t.formatMessage({id:\"ncoSiteReportSearchForm.label.site\"}),name:\"sites\",className:\"nco-site-select-input\",children:(0,_.jsx)(T.Z,{domain:\"site-report\",needStatus:!1,selectorConfigs:{displayLevel:\"STATION\",width:\"10rem\",useExternalRootElementDn:!0,parentDn:i.moDn,disableRoot:i.moDn===P.b_,disableTypeSet:this.props.isAreaAuth?new Set([D.o0,D.Uc]):new Set([])},getselectedNodes:e=>{r(e),this.handleTimeDimSelected(e)},searchTypeInclude:this.props.isAreaAuth?M.Nu:M.wU})}),!n&&(0,_.jsx)(y.Z.Item,{label:t.formatMessage({id:\"ncoSiteReportSearchForm.label.statisticMethod\"}),name:\"statisticMethod\",children:(0,_.jsxs)(v.Z,{virtual:!1,style:{width:\"10rem\"},onChange:this.handleStatisticChange,getPopupContainer:e=>e.parentNode||document.body,children:[!(0,E.ux)()&&(0,_.jsx)(j,{value:\"byTime\",title:u,children:u}),(0,_.jsx)(j,{value:\"bySite\",title:d,children:d})]})}),(0,_.jsx)(y.Z.Item,{label:c,title:c,name:\"timeDimension\",children:(0,_.jsx)(v.Z,{virtual:!1,style:{width:\"10rem\"},onChange:this.handleTimeDimensionChange,getPopupContainer:e=>e.parentNode||document.body,children:this.handleTimeDimOption(o,a)})}),(0,_.jsx)(y.Z.Item,{label:t.formatMessage({id:\"ncoSiteReportSearchForm.label.statisticTime\"}),name:\"statisticTime\",children:\"timeRange\"!==s?(0,_.jsx)(C.Z,{timeDimension:s,onChange:this.timeOnchange,isNewStyle:!0}):(0,_.jsx)(b.Z,{title:t.formatMessage({id:\"nco.report.timeRange.tip\"}),children:(0,_.jsx)(S.Z.RangePicker,{disabledDate:this.disabledDate,onOpenChange:this.onOpenChange,onCalendarChange:this.getDateRange,onChange:this.timeOnchange,value:l})})}),\"timeRange\"===s&&(0,_.jsx)(y.Z.Item,{name:\"checkHourDim\",children:(0,_.jsx)(x.Z,{onChange:this.checkHourDim,children:t.formatMessage({id:\"ncoSiteReportSearchForm.label.checkHourDim\"})})}),(0,_.jsx)(y.Z.Item,{children:(0,_.jsx)(f.Z,{type:\"primary\",disabled:!l,onClick:this.submitSearchForm,children:(0,_.jsx)(p.Z,{id:\"common.button.search\"})})})]})})}}const R=(0,a.ZP)(L);var Z=n(37592),B=n(59516),F=n(37825),z=n(30912),V=n(80770),H=n(27051),U=n(31251),G=n(44184),Y=n(29009),W=n(79790),K=n(15812),q=n(98455),Q=n(7812),X=n(10749),J=n(6916),$=n(49453),ee=n(98392);const{updateSubjectReportTable:te}=X.Z,ne={1:\"byTime\",2:\"bySite\"},re={2:\"day\",4:\"month\",5:\"year\",6:\"lifetime\"},ie=(0,E.n5)(),oe=e=>({type:J.Dw,payload:e}),{Option:ae}=v.Z,{TextArea:se}=W.Z,le={labelCol:{xs:{span:5},sm:{span:5}},wrapperCol:{xs:{span:19},sm:{span:19}}};class ce extends i.Component{constructor(e){super(e),this.getHalfSelectedNodes=async e=>{const t=await(async e=>{const[t,n]=await(0,G.AM)((0,$.v_)(\"/rest/pvms/web/report/v1/subscribe/parent-list\",e));return!t&&(null==n?void 0:n.SubcribeParentData.length)>0?n.SubcribeParentData:[]})(e),n=[];t.forEach((e=>{n.push(...e.parentList.filter((t=>t!==e.targetDN)))}));const r=new Set(n);this.setState({halfSelectedNodes:[...r]})},this.submitCreateForm=e=>{e.preventDefault();const{createConfig:t,addSubjectReport:n,onSubmit:r,isModified:i,modifyConfig:o,intl:a,record:s,resetRowSelection:l,deviceType:c}=this.props,{selectedNodes:u}=this.state,{objectType:d}=t;this.formRef.current.validateFields().then((e=>{const{stationName:d,deviceName:p,...f}=e;(0,O.Nj)(c,e.statType,e.timeType),n(i?o:t,{...f,deviceDns:p?u:p,stationDns:d?u:d},a,i,s,r,l)})).catch((e=>{const{errorFields:t}=e;t&&this.formRef.current.scrollToField(t[0].name)}))},this.cancelCreateForm=e=>{e.preventDefault();const{onCancel:t}=this.props;this.formRef.current.resetFields(),t&&t()},this.getselectedNodes=e=>{this.setState({selectedNodes:e})},this.createObjectSelection=()=>{const{createConfig:e,isModified:t,record:n,intl:r,stationDn:i,userCompany:o={},deviceType:a}=this.props,{objectType:s}=e,{halfSelectedNodes:l}=this.state;let c=[];if(t&&n&&n.dns&&(c=s===g.Ey||\"STORAGE\"===a?n.dns.map(((e,t)=>({elementDn:e,nodeName:n.stationName[t]}))):n.dns.map(((e,t)=>({elementDn:e,nodeName:n.esnName[t]})))),s===g.Ey){let e=null,a=this.props.isAreaAuth?M.Nu:M.wU;return i&&(e=[{elementDn:i}],a=[M.aG.station]),(0,_.jsx)(y.Z.Item,{...le,label:r.formatMessage({id:\"neteco.pvms.intelAlarm.stationName.selectStation\"}),name:\"stationName\",initialValue:t&&n?c:e,rules:[{required:!0,message:r.formatMessage({id:\"neteco.pvms.partials.main.dm.pleaseSelect\"})}],className:\"nco-site-subject-station-select\",children:(0,_.jsx)(T.Z,{domain:\"site-subject\",selectorConfigs:{displayLevel:\"STATION\",clearPlaceHolder:!0,parentDn:i||o.moDn,disableTypeSet:this.props.isAreaAuth?new Set([D.o0,D.Uc]):new Set([])},forbidEvent:!1,needSaveDefault:!1,getselectedNodes:this.getselectedNodes,isModified:t,forbidEmptyArray:!0,defaultChecked:t&&n?c:e,needStatus:!1,halfSelectedNodes:l,searchTypeInclude:a})})}if(s===g.Sv||s===g.$M){let e=this.props.isAreaAuth?M.qS:M.Ll;return i&&(e=M.h8),(0,_.jsx)(y.Z.Item,{...le,label:r.formatMessage({id:\"ncoAddSubjectReportForm.form.deviceName\"}),name:\"deviceName\",initialValue:t&&n?c:null,rules:[{required:!0,message:r.formatMessage({id:\"ncoAddSubjectReportForm.form.deviceName.message\"})}],className:\"nco-site-subject-station-select\",children:(0,_.jsx)(T.Z,{domain:s===g.Sv?\"site-subject\":\"storage-subject\",selectorConfigs:{displayLevel:s===g.Sv?\"DEVICE\":\"STORAGE\",clearPlaceHolder:!0,parentDn:i||o.moDn,disableTypeSet:this.props.isAreaAuth?new Set([D.o0,D.Uc]):new Set([])},needSaveDefault:!1,isModified:t,getselectedNodes:this.getselectedNodes,forbidEmptyArray:!0,defaultChecked:t&&n?c:null,deviceDimension:a,needStatus:!1,halfSelectedNodes:l,searchTypeInclude:e})})}return null},this.createFormInput=e=>{let{type:t,options:n,key:r}=e;const{stationDn:i,createConfig:o}=this.props,{objectType:a}=o;let s=!1;return i&&\"statType\"===r&&a===g.Ey&&(s=!0),\"select\"===t?(0,_.jsx)(v.Z,{virtual:!1,disabled:s,children:n.map((e=>{let{label:t,value:n}=e;return(0,_.jsx)(ae,{value:n,children:t},n)}))}):null},this.splitMoString=e=>{if(e.length>0){const t=e.length,n=[];for(let r=0;r<t;r++){const t=e[r].moString.split(\",\"),i=t.length;if(i>1)for(let o=0;o<i;o++)n.push({moType:e[r].moType,moString:t[o]});else n.push(e[r])}return n}return e},this.getMailTitleIdByDeviceDimension=e=>{switch(e){case\"STORAGE_SUBARRAY\":return\"ncoReportContainer.tabs.label.subarray\";case\"STORAGE_CLUSTER\":return\"ncoReportContainer.tabs.label.cluster\";case\"STORAGE_OLD\":return\"ncoReportContainer.tabs.label.energyStorage\";default:return\"ncoReportContainer.tabs.label.storage\"}},this.renderLanguage=()=>{const{intl:e}=this.props,{languageList:t}=this.state;return(0,_.jsx)(y.Z.Item,{...le,label:e.formatMessage({id:\"ncoSubjectReportToolbar.label.reportLanguage\"}).replace(/[:：]/,\"\"),name:\"language\",children:U.MJ?(0,_.jsx)(v.Z,{virtual:!1,options:t}):(0,_.jsxs)(v.Z,{virtual:!1,children:[(0,_.jsx)(ae,{value:\"de_DE\",children:\"Deutsch\"}),(0,_.jsx)(ae,{value:\"en_US\",children:\"English\"}),(0,_.jsx)(ae,{value:\"es_ES\",children:\"Español\"}),(0,_.jsx)(ae,{value:\"fr_FR\",children:\"Français\"}),(0,_.jsx)(ae,{value:\"it_IT\",children:\"Italiano\"}),(0,_.jsx)(ae,{value:\"nl_NL\",children:\"Nederlands\"}),(0,_.jsx)(ae,{value:\"pl_PL\",children:\"Polski\"}),(0,_.jsx)(ae,{value:\"pt_BR\",children:\"Português\"}),(0,_.jsx)(ae,{value:\"vi_VN\",children:\"Tiếng Việt\"}),(0,_.jsx)(ae,{value:\"zh_CN\",children:\"中文(简体)\"}),(0,_.jsx)(ae,{value:\"ja_JP\",children:\"日本語\"})]})})},this.isShowAddMailTip=e=>{const{record:t,isModified:n}=this.props;let r=\"\";n&&(r=(null==t?void 0:t.mailAddress)||\"\");const i=r.split(\";\").filter((e=>e)),o=e.split(\";\").filter((e=>e)),a=(0,G.Ws)(i,o);this.setState({showAddMailTip:a})},this.renderMailFormItem=e=>{const{intl:t}=this.props,n={validator:(e,n)=>{const r=/^[A-Za-z\\d]+([-_.][A-Za-z\\d]+)*@([A-Za-z\\d]+[-.])+[A-Za-z\\d]{2,14}$/,i=null==n?void 0:n.split(\";\");let o=\"\";return i.forEach((e=>{r.test(e)||\"\"===e||(o=`${o+e}, `)})),o?Promise.reject(t.formatMessage({id:\"neteco.pvms.systemSetting.notEmail\"})):(this.isShowAddMailTip(n),Promise.resolve())}};return(0,_.jsx)(y.Z.Item,{...le,label:t.formatMessage({id:\"neteco.pvms.partials.main.rm.dayCapPrpfit.recipientMails\"}),name:\"mailAddress\",rules:[e,{max:500,message:t.formatMessage({id:\"neteco.pvms.alarmPush.noMoreThan500\"})},n],validateFirst:!0,children:(0,_.jsx)(se,{style:{resize:\"none\"},rows:4,placeholder:t.formatMessage({id:\"neteco.pvms.partials.main.rm.dayCapPrpfit.mailTip\"})})})},this.getFormInitValue=()=>{const{createConfig:e,record:t,isModified:n,intl:r,deviceType:i}=this.props,{objectType:o}=e;return{ruleName:n&&t?t.ruleName:\"\",language:n&&t?t.language:(0,z.Z)(\"_\"),mailTitle:n&&t?t.mailTitle:(e=>{let t=null;return t=e===g.Ey?\"ncoReportContainer.tabs.label.site\":e===g.Sv?\"PCS\"===i?\"ncoReportContainer.tabs.label.pcs\":\"ncoReportContainer.tabs.label.inverter\":this.getMailTitleIdByDeviceDimension(i),r.formatMessage({id:t})})(o),mailAddress:n&&t?t.mailAddress:\"\"}},this.renderFormItemaArr=()=>{const{createConfig:e,record:t,isModified:n}=this.props,{formItems:r}=e;return r.map((e=>{let{key:r,type:o,label:a,initialValue:s,options:l}=e;return(0,i.createElement)(y.Z.Item,{...le,label:a,key:r,name:r,initialValue:n&&t?t[r]:s},this.createFormInput({type:o,options:l,key:r}))}))},this.renderMailTitle=(e,t,n)=>(0,_.jsx)(y.Z.Item,{...le,label:this.props.intl.formatMessage({id:\"neteco.pvms.partials.main.rm.dayCapPrpfit.subject.label\"}),name:\"mailTitle\",validateTrigger:\"onBlur\",rules:[e,t,n,{validator:(e,t)=>(0,G.q6)(\"mailTitle\",t,this.props.intl)}],validateFirst:!0,children:(0,_.jsx)(W.Z,{})}),this.getRequiredRule=()=>({required:!0,whitespace:!0,message:this.props.intl.formatMessage({id:\"common.message.notEmpty\"})}),this.getMaxLengthRule=()=>({max:128,message:this.props.intl.formatMessage({id:\"neteco.pvms.validator.maxlength\"},{0:128})}),this.getForbidenIllegalStr=()=>{const{intl:e}=this.props;return{validator(t,n,r){n.length===n.replace(/['|<|>|/|,|&|\\\"|{|}|\\\\||\\\\\\\\]/g,\"\").length&&\"null\"!==n?r():r(e.formatMessage({id:\"neteco.pvms.validator.specialChars\"}))}}},this.formRef=i.createRef(),this.state={selectedNodes:[],halfSelectedNodes:[],showAddMailTip:!1,languageList:[]}}componentDidMount(){const{loadNcoAddSubjectReportForm:e,isModified:t,createConfig:n,record:r}=this.props;if(e(),t&&r){const{objectType:e}=n,{dns:t}=r,i=t.join(\",\");this.getHalfSelectedNodes(t),e===g.Ey?this.setState({selectedNodes:[{moType:20801,moString:i}]}):e===g.Sv?this.setState({selectedNodes:[{moType:20822,moString:i}]}):this.setState({selectedNodes:[{moType:20815,moString:i}]})}H.Z.init().then((e=>this.setState({languageList:e})))}componentWillUnmount(){const{resetReducer:e}=this.props;e(),this.setState=()=>{}}render(){const{createConfig:e,intl:t,saveLoad:n}=this.props,{objectType:r}=e,i=this.getRequiredRule(),o=this.getMaxLengthRule(),a=this.getForbidenIllegalStr();return(0,_.jsx)(\"div\",{className:\"nco-add-subject-report-form\",children:(0,_.jsxs)(K.Z,{spinning:n,children:[(0,_.jsx)(q.Z,{className:\"nco-add-subject-report-form-tips\",type:\"info\",showIcon:!0,message:t.formatMessage({id:\"neteco.pvms.partials.main.rm.dayCapPrpfit.pushDevTip.new\"})}),(0,_.jsxs)(y.Z,{ref:this.formRef,initialValues:this.getFormInitValue(),children:[this.state.showAddMailTip&&(0,_.jsx)(Y.Z,{}),(0,_.jsx)(y.Z.Item,{...le,label:t.formatMessage({id:\"neteco.pvms.partials.main.rm.dayCapPrpfit.ruleName\"}),name:\"ruleName\",validateTrigger:\"onBlur\",rules:[i,o,a,{validator:(e,n)=>(0,G.q6)(\"mailTitle\",n,t)}],validateFirst:!0,children:(0,_.jsx)(W.Z,{})}),this.renderLanguage(),this.renderMailTitle(i,o,a),this.createObjectSelection(),this.renderFormItemaArr(),this.renderMailFormItem(i),(0,_.jsxs)(\"div\",{className:\"nco-add-subject-report-form-buttons\",children:[(0,_.jsx)(f.Z,{onClick:this.cancelCreateForm,children:(0,_.jsx)(p.Z,{id:\"common.button.cancel\"})}),(0,_.jsx)(f.Z,{type:\"primary\",onClick:this.submitCreateForm,children:(0,_.jsx)(p.Z,{id:\"common.button.ok\"})})]})]})]})})}}const ue=ce,de=(0,d.$j)((e=>({amount:e.ncoMonitorAddSubjectReportForm.amount,saveLoad:e.ncoMonitorAddSubjectReportForm.saveLoad})),(e=>({loadNcoAddSubjectReportForm:()=>{(async e=>{e({type:J.Mb}),e({type:J.T_,payload:100})})(e)},addSubjectReport:(t,n,r,i,o,a,s)=>{(async(e,t,n,r,i,o,a,s)=>{const{url:l,reportId:c}=t,{ruleName:d,language:p,mailTitle:f,stationDns:h,deviceDns:m,selectedMoList:g,statType:v,timeType:y,mailAddress:b}=n;let S=0,x=1;i&&(S=o.subid,x=o.state);const w=g||m||h;let C=20801;\"10001\"===c?C=20822:\"10004\"===c&&(C=20815);let T=\"\",A=\"\",E=\"\";w.forEach(((e,t)=>{let{moType:n,moString:r}=e;isNaN(n)&&(A=t,E=r),n===C&&(T=t),-1===n&&(w[t].moType=20800)})),\"\"!==A&&(\"\"===T?w[A].moType=C:(w[T].moString+=`,${E}`,w.splice(A,1))),e(oe(!0));const[O,M]=await(0,G.AM)((0,$.v_)(l,{reportId:c,subscribeBase:{subId:S,state:x,userId:ie,statType:ne[v],timeType:re[y],language:p,subStartTime:u()().format(\"YYYY-MM-DD\"),subEndTime:u()().add(25,\"year\").format(\"YYYY-MM-DD\"),ruleName:d,mailTitle:f,mailAddress:(0,ee.default)(b.split(\";\")).join(\";\")},subscribeDetail:{moList:w}}));e(oe(!1));let P=\"ncoSiteToolbar.selectTooManyMo.deviceTips\",D=\"neteco.pvms.devEms.esnSel\";if(h&&(P=\"ncoSiteToolbar.selectTooManyMo.stationTips\",D=\"ncoAddSubjectReportForm.form.chooseOneStation\"),O)return;const{success:I,data:N,failCode:_}=M;if(I){a();const e=i?\"neteco.pvms.modifySucceed\":\"neteco.pvms.report.add.subscribe.success\";(0,Q.NB)(r,e),s(),te.next()}else if(-1===_)(0,V.xf)(r.formatMessage({id:\"neteco.pvms.bingding.device.report.before.tips\"}),r);else if(N&&N.tip){const{systemLimit:e,selectedNum:t}=N;(0,V.xf)(r.formatMessage({id:P},{systemLimit:e,selectedNum:t}),r)}else\"NoMoWhenReportSubscribe\"===N?(0,V.xf)(r.formatMessage({id:D}),r):(0,V.xf)(r.formatMessage({id:N}),r)})(e,t,n,r,i,o,a,s)},resetReducer:()=>{(e=>{e({type:J.R4})})(e)}})))((0,a.ZP)(ue));n(98761);class pe extends i.Component{constructor(e){super(e),this.deleteHandler=()=>{const{deleteSubjectReports:e,selectedRows:t,deleteConfig:n,resetRowSelection:r,intl:i}=this.props;(0,V.ST)(i.formatMessage({id:\"neteco.pvms.systemSetting.amendment.delConfirm\"}),(()=>{e(n,t,i,r)}),void 0,i,void 0,!0)},this.changeStatusHandler=e=>{const{setSubjectReportStatus:t,selectedRows:n,changeStateConfig:r,resetRowSelection:i,intl:o}=this.props;t(r,n,e,o,i)},this.exportReportHandler=()=>{const{exportSubjectReports:e,selectedRows:t,exportConfig:n,resetRowSelection:r,subjectLength:i,intl:o}=this.props;i?(0,V.ST)(o.formatMessage({id:\"neteco.pvms.report.export.message.tip\"}),(()=>e(n,t,o,r)),void 0,o,void 0,!0):(0,V.CD)(o.formatMessage({id:\"ncoSiteToolbar.export.noData\"}),void 0,void 0,o,!0)},this.showAddSubjectReportModal=e=>{const{intl:t,selectedRows:n,loadSubjectReportForm:r,config:i,pageCondition:o,stationDn:a}=this.props;e&&1!==n.length?(0,V.CD)(t.formatMessage({id:\"neteco.pvms.selectOneRecord\"}),void 0,void 0,t,!0):e?r(o,i,n[0],a):this.setState({isModified:e,showAddSubjectReportModal:!0})},this.hideAddSubjectReportModal=()=>{this.setState({showAddSubjectReportModal:!1})},this.state={showAddSubjectReportModal:!1,isModified:!1}}componentDidUpdate(e){const{loading:t}=this.props;t!==e.loading&&!1===t&&this.setState({isModified:!0,showAddSubjectReportModal:!0})}render(){const{language:e,selectedRowKeys:t,createConfig:n,modifyConfig:r,resetRowSelection:i,stationDn:o,userCompany:a,record:s,deviceType:l,intl:c}=this.props,{showAddSubjectReportModal:u,isModified:d}=this.state;return(0,_.jsxs)(\"div\",{className:\"nco-subject-report-toolbar\",children:[(0,_.jsx)(\"div\",{className:\"nco-subject-report-toolbar-report-language\"}),(0,_.jsxs)(\"div\",{className:\"nco-subject-report-toolbar-buttons\",children:[(0,_.jsx)(f.Z,{type:\"primary\",onClick:()=>this.showAddSubjectReportModal(!1),children:(0,_.jsx)(p.Z,{id:\"common.button.create\"})}),(0,_.jsx)(f.Z,{onClick:()=>this.showAddSubjectReportModal(!0),disabled:0===t.length,children:(0,_.jsx)(p.Z,{id:\"common.button.modify\"})}),(0,_.jsx)(f.Z,{onClick:this.deleteHandler,disabled:0===t.length,children:(0,_.jsx)(p.Z,{id:\"common.button.delete\"})}),(0,_.jsx)(f.Z,{onClick:()=>this.changeStatusHandler(!0),disabled:0===t.length,children:(0,_.jsx)(p.Z,{id:\"neteco.pvms.communicatPoint.enable\"})}),(0,_.jsx)(f.Z,{onClick:()=>this.changeStatusHandler(!1),disabled:0===t.length,children:(0,_.jsx)(p.Z,{id:\"neteco.pvms.communicatPoint.forbidden\"})}),(0,_.jsx)(f.Z,{onClick:this.exportReportHandler,children:(0,_.jsx)(p.Z,{id:\"common.button.export\"})})]}),(0,_.jsx)(h.Z,{title:c.formatMessage({id:d?\"ncoSubjectReportToolbar.label.modifySubjectReport.title\":\"ncoSubjectReportToolbar.label.addSubjectReport.title\"}),footer:null,visible:u,onCancel:this.hideAddSubjectReportModal,maskClosable:!1,width:\"zh-CN\"===(0,z.Z)(\"-\")?\"520px\":\"1000px\",destroyOnClose:!0,children:(0,_.jsx)(de,{createConfig:{...n,language:e},modifyConfig:r,onSubmit:this.hideAddSubjectReportModal,onCancel:this.hideAddSubjectReportModal,resetRowSelection:i,stationDn:o,isModified:d,record:s,userCompany:a,deviceType:l,isAreaAuth:this.props.isAreaAuth})})]})}}const fe=pe;var he=n(20928),me=n(70336);const{neteco:ge}=window,ve=(0,E.n5)(),{updateSubjectReportTable:ye}=X.Z,be=()=>({type:me.Mb}),Se=(e,t)=>{e({type:me.SK,payload:t})},xe=(0,d.$j)((e=>({language:e.ncoMonitorSubjectReportToolbar.language,loading:e.ncoMonitorSubjectReportToolbar.loading,record:e.ncoMonitorSubjectReportToolbar.record})),(e=>({loadSubjectReportForm:(t,n,r,i)=>{let{subid:o}=r;(async(e,t,n,r,i)=>{let{page:o,pageSize:a}=t;e(be());const{url:s,reportId:l}=n,{success:c,data:u}=await(0,$.v_)(s,{page:o,pageSize:a,reportId:l,showOrUpdate:1,stationDn:i});c&&e((e=>({type:me.T_,payload:e}))(u.list.filter((e=>{let{subid:t}=e;return r===t}))[0]))})(e,t,n,o,i)},updateSubjectReportLanguage:(t,n,r)=>{(async(e,t,n,r)=>{e(be());const{success:i,data:o}=await(0,$.v_)(\"/rest/pvms/web/report/v1/subscribe/change-language\",{language:t,reportType:n});i?(0,Q.NB)(r):(0,Q.CT)(r),Se(e,t)})(e,t,n,r)},deleteSubjectReports:(e,t,n,r)=>{(async(e,t,n,r,i)=>{const{url:o,reportId:a}=t,s=n.map((e=>{let{subid:t,userid:n,...r}=e;return{...r,subId:t,userId:ve}})),{success:l}=await(0,$.v_)(o,{reportId:a,subscribeBase:s});l?((0,Q.NB)(r,\"neteco.pvms.alarmTemp.deleteSuccess\"),i()):((0,Q.CT)(r),i()),ye.next()})(0,e,t,n,r)},exportSubjectReports:(e,t,n,r)=>{(async(e,t,n,r,i)=>{const{url:o,reportId:a,stationDn:s}=t,l=n.map((e=>{let{subid:t}=e;return t}));(0,he.Z)(o,null,{reportId:a,subIds:l.join(\",\"),stationDn:s}),ye.next(),i()})(0,e,t,0,r)},setSubjectReportStatus:(e,t,n,r,i)=>{(async(e,t,n,r,i,o)=>{const{url:a,reportId:s}=t,l=(n.map((e=>{let{subid:t}=e;return t})),n.map((e=>{let{subid:t,userid:n,...r}=e;return{...r,subId:t,userId:ve}}))),{success:c}=await(0,$.v_)(a,{reportId:s,subscribeBase:l,state:r?1:0});if(c){const e=r?\"neteco.pvms.communicatPoint.enableOk\":\"neteco.pvms.communicatPoint.forbiddenOk\";(0,Q.NB)(i,e),o()}else(0,Q.CT)(i);ye.next()})(0,e,t,n,r,i)}})))((0,a.ZP)(fe));n(96624);var we=n(33734),Ce=n(9381),Te=n(18206);const{updateSubjectReportTable:Ae}=X.Z;class Ee extends i.Component{constructor(e){super(e),this.onChangePage=(e,t)=>{const{config:n,loadNcoSubjectReportTable:r,getPageCondition:i}=this.props;r(n,e,t),i({page:e,pageSize:t})},this.resetSelectedRowKeys=()=>{const{onRowSelectionChange:e}=this.props;e([],[]),this.setState({selectedRowKeys:[]})},this.state={selectedRowKeys:[]}}componentDidMount(){const{config:e,loadNcoSubjectReportTable:t,pageSize:n,getChildObj:r}=this.props;t(e,1,n),r&&r(this),this.subscription=Ae.subscribe((()=>{t(e,1,n)}))}componentDidUpdate(e){const{tableData:t,getSubjectLength:n}=this.props;t.length!==e.tableData.length&&n(t.length)}componentWillUnmount(){const{resetReducer:e}=this.props;this.subscription&&this.subscription.unsubscribe(),e(),this.setState=()=>{}}render(){const{config:e,tableData:t,total:n,pageNo:r,pageSize:i,onRowSelectionChange:o,intl:a}=this.props,{selectedRowKeys:s}=this.state,{columns:l,rowKey:c}=e,u={selectedRowKeys:s,onChange:(e,t)=>{o(e,t),this.setState({selectedRowKeys:e})}};return(0,_.jsxs)(\"div\",{className:\"nco-subject-report-table\",children:[(0,_.jsx)(we.Z,{dataSource:t,columns:l,rowKey:c,pagination:!1,size:\"small\",rowSelection:u,showSorterTooltip:!1,scroll:{y:t.length>10?\"20rem\":null}}),(0,_.jsx)(Ce.Z,{size:\"small\",total:n,showSizeChanger:!0,showTotal:(0,Te.Z)(a),current:r,pageSize:i,pageSizeOptions:[\"10\",\"20\",\"30\",\"50\",\"100\"],onChange:this.onChangePage,onShowSizeChange:this.onChangePage,totalFixedLeft:!0,className:\"table-pagination\"})]})}}const Oe=Ee;var Me=n(40737);const Pe=(0,d.$j)((e=>({tableData:e.ncoMonitorSubjectReportTable.tableData,total:e.ncoMonitorSubjectReportTable.total,pageNo:e.ncoMonitorSubjectReportTable.pageNo,pageSize:e.ncoMonitorSubjectReportTable.pageSize,pageCount:e.ncoMonitorSubjectReportTable.pageCount})),(e=>({loadNcoSubjectReportTable:(t,n,r)=>{(async(e,t,n,r)=>{var i;e({type:Me.Mb});const{url:o,reportId:a,stationDn:s}=t,{success:l,data:c}=await(0,$.v_)(o,{page:n,pageSize:r,reportId:a,stationDn:s,showOrUpdate:0});if((null===(i=c.list)||void 0===i?void 0:i.length)>0){const{language:t}=c.list[0];Se(e,t)}l&&e((e=>({type:Me.T_,payload:e}))(c))})(e,t,n,r)},resetReducer:()=>{(e=>{e({type:Me.R4})})(e)}})))((0,a.ZP)(Oe));n(69699);class De extends i.Component{constructor(e){super(e),this.onRowSelectionChange=(e,t)=>{this.setState({selectedRowKeys:e,selectedRows:t})},this.resetRowSelection=()=>{this.childObj.resetSelectedRowKeys()},this.getChildObj=e=>{this.childObj=e},this.getSubjectLength=e=>{this.setState({subjectLength:e})},this.getPageCondition=e=>{this.setState({pageCondition:e})},this.state={selectedRowKeys:[],selectedRows:[],subjectLength:0,pageCondition:{page:1,pageSize:10}}}render(){const{reportId:e,table:t,createConfig:n,modifyConfig:r,deleteConfig:i,exportConfig:o,changeStateConfig:a,stationDn:s,userCompany:l,deviceType:c}=this.props,{selectedRowKeys:u,selectedRows:d,subjectLength:p,pageCondition:f}=this.state;return(0,_.jsxs)(\"div\",{className:\"nco-subject-report\",children:[(0,_.jsx)(xe,{selectedRowKeys:u,selectedRows:d,stationDn:s,config:{...t,reportId:e},createConfig:{...n,reportId:e},deleteConfig:{...i,reportId:e},modifyConfig:{...r,reportId:e},exportConfig:{...o,reportId:e,stationDn:s},resetRowSelection:this.resetRowSelection,changeStateConfig:{...a,reportId:e},subjectLength:p,userCompany:l,pageCondition:f,deviceType:c,isAreaAuth:this.props.isAreaAuth}),(0,_.jsx)(Pe,{config:{...t,reportId:e,stationDn:s},selectedRowKeys:u,getChildObj:this.getChildObj,onRowSelectionChange:this.onRowSelectionChange,getSubjectLength:this.getSubjectLength,getPageCondition:this.getPageCondition})]})}}const Ie=De;class Ne extends i.Component{constructor(e){super(e),this.submitHandler=e=>{const{updateSearchCondition:t}=this.props,{selectedNodesList:n}=this.state;t({...e,sites:n,_timestamp:(new Date).getTime()})},this.exportHandler=()=>{const{exportReport:e,searchCondition:t,sortCondition:n,statisticalMethod:r,currentDate:i,dateType:o,stationDn:a,counterIDs:s,intl:l,currentcy:c}=this.props,{timeDimension:u,statisticTime:d,statisticMethod:p}=t,{sites:f}=t,h=o||u;(0,O.KS)(\"SITE\",h),e({...t,statisticTime:i||d,timeDimension:h,statisticMethod:r||p,sites:a?[a]:f,stationDn:a,currentcy:c,counterIDs:s},n,this.setExportListModal,l)},this.showSubjectModal=()=>{this.setState({showSubjectModal:!0})},this.hideSubjectModal=()=>{this.setState({showSubjectModal:!1})},this.getselectedNodes=e=>{const{userCompany:t}=this.props,n=[{moType:20800,moString:t.moDn}];e=0===e.length?n:e,this.setState({selectedNodesList:e})},this.checkCompanyMail=()=>{const{subjectCheck:e,intl:t}=this.props;e(t,(e=>{this.setState({showSubjectModal:e})}))},this.setExportListModal=e=>{this.setState({showExportListModal:e})};const{userCompany:t}=this.props,n=t.moDn;this.state={showSubjectModal:!1,selectedNodesList:[{moType:20800,moString:n}],showExportListModal:!1,rangePickerStatus:\"\"}}componentDidMount(){const{loadNcoSiteSearchBar:e,updateSearchCondition:t,clearSearchCondition:n,updateSortCondition:r}=this.props;e(),r({sortBy:(0,E.ux)()&&!this.props.stationDn?\"productPower\":\"fmtCollectTimeStr\",sortOrder:\"ascend\"}),t({sites:this.state.selectedNodesList,statisticMethod:(0,E.ux)()?\"bySite\":\"byTime\",timeDimension:\"date\",statisticTime:u()().startOf(\"day\"),refreshTime:u()()})}componentWillUnmount(){const{clearSearchCondition:e}=this.props;e(),this.setState=F.mz}render(){const{searchCondition:e,intl:t,configColumnsByStatistics:n,configColumnsByTime:r,configColumnsByDate:i,stationDn:o,exportLoading:a,userCompany:s,selectedTreeNode:l,updateSearchCondition:c,isEmptyTable:d}=this.props,{showSubjectModal:v,showExportListModal:y,selectedNodesList:b}=this.state,S=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:\"7rem\";return(0,_.jsx)(\"div\",{title:e,style:{width:t},className:\"nco-site-search-bar-wrapper-ellipsis\",children:e})},x=!e.statisticTime||d;return(0,_.jsxs)(\"div\",{className:\"nco-site-search-bar\",children:[(0,_.jsx)(\"div\",{className:\"nco-site-search-bar-form\",children:(0,_.jsx)(R,{searchCondition:e,configColumnsByStatistics:n,configColumnsByTime:r,configColumnsByDate:i,getselectedNodes:this.getselectedNodes,stationDn:o,onSubmit:this.submitHandler,userCompany:s,isAreaAuth:this.props.isAreaAuth,selectedTreeNode:l,selectedNodesList:b,updateSearchCondition:c})}),(0,_.jsxs)(\"div\",{className:\"nco-site-search-bar-buttons\",children:[(0,B.lVp)(B.gWq)&&(0,_.jsx)(f.Z,{onClick:this.checkCompanyMail,children:(0,_.jsx)(p.Z,{id:\"common.button.subject\"})}),(0,B.lVp)(B.vZ)&&!(0,I.sb)(l.elementDn)&&(0,_.jsx)(f.Z,{onClick:this.exportHandler,loading:a,disabled:x,children:(0,_.jsx)(p.Z,{id:\"common.button.export\"})})]}),(0,B.lVp)(B.vZ)&&(0,_.jsx)(Z.Z,{showExportListModal:y,setExportListModal:this.setExportListModal,reportId:1e4}),(0,_.jsx)(h.Z,{title:t.formatMessage({id:\"neteco.pvms.partials.main.rm.dayCapPrpfit.stationSub\"}),width:\"100rem\",footer:null,visible:v,onCancel:this.hideSubjectModal,destroyOnClose:!0,maskClosable:!1,children:(0,_.jsx)(Ie,{reportId:\"10000\",stationDn:o,userCompany:s,isAreaAuth:this.props.isAreaAuth,createConfig:{url:\"/rest/pvms/web/report/v1/subscribe/save-subscribe\",objectType:g.Ey,formItems:[{key:\"statType\",type:\"select\",label:t.formatMessage({id:\"ncoAddSubjectReportForm.form.statisticMethod\"}),initialValue:P.Xc.BY_TIME,options:[{label:t.formatMessage({id:\"ncoAddSubjectReportForm.form.statisticMethod.byTime\"}),value:P.Xc.BY_TIME},{label:t.formatMessage({id:\"ncoAddSubjectReportForm.form.statisticMethod.bySite\"}),value:P.Xc.BY_SITE}]},{key:\"timeType\",type:\"select\",label:t.formatMessage({id:\"ncoAddSubjectReportForm.form.timeDimension\"}),initialValue:2,options:[{label:t.formatMessage({id:\"ncoAddSubjectReportForm.form.timeDimension.day\"}),value:2},{label:t.formatMessage({id:\"ncoAddSubjectReportForm.form.timeDimension.month\"}),value:4},{label:t.formatMessage({id:\"ncoAddSubjectReportForm.form.timeDimension.year\"}),value:5},{label:t.formatMessage({id:\"ncoAddSubjectReportForm.form.timeDimension.lifetime\"}),value:6}]}]},modifyConfig:{url:\"/rest/pvms/web/report/v1/subscribe/update-subscribe\"},deleteConfig:{url:\"/rest/pvms/web/report/v1/subscribe/delete-subscribe\"},exportConfig:{url:\"/rest/pvms/web/report/v1/subscribe/export-subscribe\"},changeStateConfig:{url:\"/rest/pvms/web/report/v1/subscribe/change-state\"},table:{url:\"/rest/pvms/web/report/v1/subscribe/subscribe-list\",rowKey:\"subid\",columns:[{title:t.formatMessage({id:\"ncoHomeSiteList.columns.siteStatus\"}),dataIndex:\"state\",key:\"state\",width:\"6rem\",render:e=>e?(0,_.jsx)(\"div\",{style:{width:\"4rem\"},title:t.formatMessage({id:\"neteco.pvms.communicatPoint.enableState\"}),className:\"nco-site-search-bar-wrapper-ellipsis\",children:t.formatMessage({id:\"neteco.pvms.communicatPoint.enableState\"})}):(0,_.jsx)(\"div\",{style:{style:\"4rem\",color:\"#e54545\"},title:t.formatMessage({id:\"neteco.pvms.communicatPoint.forbiddenState\"}),className:\"nco-site-search-bar-wrapper-ellipsis\",children:t.formatMessage({id:\"neteco.pvms.communicatPoint.forbiddenState\"})})},{render:e=>S(window.neteco.util.iUnescape(e),\"10rem\"),title:t.formatMessage({id:\"neteco.pvms.alarmPush.configName\"}),dataIndex:\"ruleName\",key:\"ruleName\",width:\"10rem\"},{render:e=>S(window.neteco.util.iUnescape(e),\"10rem\"),title:t.formatMessage({id:\"neteco.pvms.partials.main.rm.dayCapPrpfit.subject\"}),dataIndex:\"mailTitle\",key:\"mailTitle\",width:\"10rem\"},{title:t.formatMessage({id:\"neteco.pvms.deviceDialog.stationName\"}),dataIndex:\"stationName\",key:\"stationName\",width:\"12rem\",render:e=>S(e?window.neteco.util.iUnescape(e.join(\",\")):e,\"12rem\")},{title:t.formatMessage({id:\"neteco.pvms.alarmPush.mail\"}),dataIndex:\"mailAddress\",key:\"mailAddress\",render:e=>S(e,\"12rem\"),width:\"12rem\"},{title:t.formatMessage({id:\"ncoSubjectReportTable.column.statisticMethod\"}),dataIndex:\"statType\",key:\"statType\",render:e=>S(((e,t)=>{switch(e){case 1:return t.formatMessage({id:\"ncoSubjectReportTable.label.statisticMethod.byTime\"});case 2:return t.formatMessage({id:\"ncoSubjectReportTable.label.statisticMethod.bySite\"});default:return e}})(e,t)),width:\"7rem\"},{render:e=>S(m(e,t)),title:t.formatMessage({id:\"ncoSubjectReportTable.column.timeDimension\"}),dataIndex:\"timeType\",key:\"timeType\",width:\"7rem\"},{title:t.formatMessage({id:\"ncoSubjectReportTable.column.subjectDate\"}),render:e=>S(u()(e).format(\"YYYY-MM-DD\")),dataIndex:\"subStartTime\",key:\"subStartTime\",width:\"7rem\"},{title:t.formatMessage({id:\"neteco.pvms.partials.main.rm.dayCapPrpfit.reportLanguage\"}),render:e=>S(H.Z.replaceIntlLang(e)),dataIndex:\"language\",key:\"language\",width:\"7rem\"}]}})})]})}}const _e=Ne;var je=n(8411),ke=n(19073),Le=n(80864),Re=n(95059),Ze=n(45258),Be=n(98937);const Fe=e=>({type:Be.T_,payload:e}),ze=(e,t)=>e?\"hour\":t,{operationError:Ve,operationInfo:He,operationWarn:Ue}=Re.Z,Ge=(e,t)=>{e({type:ke.MC,payload:t})},Ye=(0,d.$j)((e=>({loading:e.ncoMonitorSiteSearchBar.loading,searchCondition:e.ncoMonitorSiteSearchBar.searchCondition,isShowModal:e.ncoMonitorSiteSearchBar.isShowModal,sortCondition:e.ncoMonitorSiteSearchBar.sortCondition,exportLoading:e.ncoMonitorSiteSearchBar.exportLoading})),(e=>({loadNcoSiteSearchBar:()=>{(async e=>{e({type:ke.lK,payload:!1}),e({type:ke.Mb}),e({type:ke.T_,payload:void 0})})(e)},clearSearchCondition:()=>{(e=>{e({type:ke.Z8})})(e)},updateSearchCondition:t=>{((e,t)=>{e({type:ke.mk,payload:t})})(e,t)},updateSortCondition:t=>{Ge(e,t)},exportReport:(t,n,r,i)=>{(async(e,t,n,r,i)=>{const{stationDn:o,currentcy:a,counterIDs:s,statisticTime:l,checkHourDim:c,timeDimension:u}=t,{sortBy:d,sortOrder:p}=n;let f,h;const m=Intl.DateTimeFormat().resolvedOptions().timeZone;if((0,G.kJ)(l)&&2===l.length){const[e,t]=l;h=e.startOf(\"day\").valueOf(),f=t.startOf(\"day\").valueOf()}else h=null==l?void 0:l.valueOf();if(!h)return;e({type:ke.lK,payload:!0});const g=ze(c,u),{success:v,data:y,message:b}=await(0,$.v_)(\"/rest/pvms/web/report/v1/export/report-async\",{moList:o?[{moType:20801,moString:o}]:t.sites,reportId:1e4,counterIDs:s,station:o?\"1\":\"0\",statTime:h,statEndTime:f,statType:o||\"byTime\"===t.statisticMethod?\"1\":\"2\",statDim:(0,je.Z)(g),timeZone:(0,Le.ZP)(h),timeZoneStr:m,orderBy:d,sort:\"ascend\"===p?\"asc\":\"desc\",currencyUnit:a||\"¥\"});if(e({type:ke.lK,payload:!1}),v)r(!0);else if(y&&y.tip){const{systemLimit:e,selectedNum:t}=y;Ue(i,i.formatMessage({id:\"ncoSiteToolbar.selectTooManyMo.stationTips\"},{systemLimit:e,selectedNum:t}))}else\"NoMoWhenExportReport\"===y?He(i,i.formatMessage({id:\"ncoSiteToolbar.export.noData\"})):\"dataNumExceedLimit\"===y?He(i,i.formatMessage({id:\"neteco.pvms.report.export.number.limit\"},{num:P.VS})):b&&Ue(i,i.formatMessage({id:b}))})(e,t,n,r,i)},subjectCheck:(t,n)=>{(async(e,t,n)=>{const{success:r,data:i}=await(0,$.U2)(\"/rest/pvms/web/report/v1/subscribe/check-mail\",{reportId:\"10000\"});r||(0,V.xf)(t.formatMessage({id:i})),n(r),e({type:ke.bP,payload:r})})(e,t,n)}})))((0,a.ZP)(_e));n(19578);var We=n(56687),Ke=n(55534),qe=n.n(Ke),Qe=n(99752),Xe=n.n(Qe),Je=n(70250),$e=n.n(Je),et=n(51523),tt=n.n(et),nt=n(55751),rt=n(50832),it=n(34754),ot=n(13528),at=n(61141);const st={ellipsis:!0},lt=e=>\"byTime\"===e?[\"fmtCollectTimeStr\",\"radiationIntensity\",\"temperature\",\"theoryPower\",\"productPower\",\"inverterPower\",\"onGridPower\",\"buyPower\",\"chargeCap\",\"dischargeCap\",\"powerProfit\",\"powerCuts\",\"powerCutsProfit\"]:[\"stationName\",\"stationAddr\",\"installedCapacity\",\"radiationIntensity\",\"sunshineHours\",\"temperature\",\"theoryPower\",\"productPower\",\"inverterPower\",\"totalPower\",\"onGridPower\",\"perpowerRatio\",\"buyPower\",\"chargeCap\",\"dischargeCap\",\"powerCuts\",\"powerCutsProfit\",\"usePower\",\"selfUsePower\",\"selfUsePowerRatio\",\"acPeakPower\",\"performanceRatio\",\"reductionTotalCO2\",\"reductionTotalCoal\",\"powerProfit\"],ct=e=>\"byTime\"===e?[\"fmtCollectTimeStr\",\"installedCapacity\",\"radiationIntensity\",\"sunshineHours\",\"temperature\",\"theoryPower\",\"productPower\",\"inverterPower\",\"totalPower\",\"onGridPower\",\"perpowerRatio\",\"buyPower\",\"chargeCap\",\"dischargeCap\",\"powerCuts\",\"powerCutsProfit\",\"usePower\",\"selfUsePower\",\"selfUsePowerRatio\",\"acPeakPower\",\"performanceRatio\",\"reductionTotalCO2\",\"reductionTotalCoal\",\"powerProfit\"]:[\"stationName\",\"stationAddr\",\"installedCapacity\",\"radiationIntensity\",\"sunshineHours\",\"temperature\",\"theoryPower\",\"productPower\",\"inverterPower\",\"onGridPower\",\"perpowerRatio\",\"buyPower\",\"chargeCap\",\"dischargeCap\",\"powerCuts\",\"powerCutsProfit\",\"usePower\",\"selfUsePower\",\"selfUsePowerRatio\",\"acPeakPower\",\"performanceRatio\",\"reductionTotalCO2\",\"reductionTotalCoal\",\"powerProfit\",\"fulfilmentRatio\"],ut=[\"stationName\",\"stationAddr\",\"installedCapacity\",\"radiationIntensity\",\"sunshineHours\",\"temperature\",\"theoryPower\",\"productPower\",\"inverterPower\",\"onGridPower\",\"perpowerRatio\",\"buyPower\",\"chargeCap\",\"dischargeCap\",\"powerCuts\",\"powerCutsProfit\",\"usePower\",\"selfUsePower\",\"selfUsePowerRatio\",\"acPeakPower\",\"performanceRatio\",\"reductionTotalCO2\",\"reductionTotalCoal\",\"reductionTotalTree\",\"powerProfit\",\"fulfilmentRatio\"],dt=e=>\"byTime\"===e?[\"fmtCollectTimeStr\",\"installedCapacity\",\"radiationIntensity\",\"sunshineHours\",\"temperature\",\"theoryPower\",\"productPower\",\"inverterPower\",\"onGridPower\",\"perpowerRatio\",\"buyPower\",\"chargeCap\",\"dischargeCap\",\"powerCuts\",\"powerCutsProfit\",\"usePower\",\"selfUsePower\",\"selfUsePowerRatio\",\"acPeakPower\",\"performanceRatio\",\"reductionTotalCO2\",\"reductionTotalCoal\",\"powerProfit\",\"fulfilmentRatio\"]:ut,pt=e=>\"byTime\"===e?[\"fmtCollectTimeStr\",\"installedCapacity\",\"radiationIntensity\",\"temperature\",\"sunshineHours\",\"theoryPower\",\"productPower\",\"inverterPower\",\"onGridPower\",\"perpowerRatio\",\"buyPower\",\"chargeCap\",\"dischargeCap\",\"powerCuts\",\"powerCutsProfit\",\"usePower\",\"selfUsePower\",\"selfUsePowerRatio\",\"acPeakPower\",\"performanceRatio\",\"reductionTotalCO2\",\"reductionTotalCoal\",\"reductionTotalTree\",\"powerProfit\",\"fulfilmentRatio\"]:ut,ft=[\"fmtCollectTimeStr\",\"productPower\",\"inverterPower\",\"onGridPower\",\"perpowerRatio\",\"usePower\",\"selfUsePower\",\"powerProfit\"],ht=[\"stationName\",\"stationAddr\",\"productPower\",\"inverterPower\",\"onGridPower\",\"perpowerRatio\",\"usePower\",\"powerProfit\"],mt=e=>{let{intl:t,sortBy:n,sortOrder:r,currentcy:i,dateType:o}=e;return[{title:t.formatMessage({id:\"ncoSiteTable.column.statisticTime\"}),dataIndex:\"fmtCollectTimeStr\",key:\"fmtCollectTimeStr\",...st,width:\"13rem\",sortOrder:\"fmtCollectTimeStr\"===n&&r,sorter:!0,render:e=>{var t;return null!==(t=window.neteco.util.iUnescape(e))&&void 0!==t?t:P.lH}},{title:t.formatMessage({id:\"ncoSiteTable.column.site\"}),dataIndex:\"stationName\",...st,key:\"stationName\",width:\"13rem\",render:e=>{var t;return null!==(t=window.neteco.util.iUnescape(e))&&void 0!==t?t:P.lH}},{title:t.formatMessage({id:\"ncoSiteTable.column.address\"}),dataIndex:\"stationAddr\",...st,key:\"stationAddr\",width:\"13rem\",render:e=>{var t;return null!==(t=window.neteco.util.iUnescape(e))&&void 0!==t?t:P.lH}},{title:t.formatMessage({id:(0,it.k)()?\"neteco.pvms.inverter.DCCapacity\":\"neteco.pvms.inverter.stringCapacity\"}),dataIndex:\"installedCapacity\",...st,key:\"installedCapacity\",width:\"13rem\",sortOrder:\"installedCapacity\"===n&&r,sorter:!0,render:e=>{var t;return null!==(t=(0,ot.af)(e))&&void 0!==t?t:P.lH}},{title:(0,_.jsxs)(\"div\",{className:\"ncoSiteTable-column-income\",children:[t.formatMessage({id:\"ncoSiteTable.column.totalIrradiation\"}),(0,_.jsx)(b.Z,{placement:\"top\",title:t.formatMessage({id:\"ncoHomeSiteList.columns.siteRadiationIntensity.tips\"}),children:(0,_.jsx)(We.Z,{className:\"nco-column-hints-lined\"})})]}),dataIndex:\"radiationIntensity\",...st,key:\"radiationIntensity\",width:\"13rem\",sortOrder:\"radiationIntensity\"===n&&r,sorter:!0,render:e=>{var t;return null!==(t=(0,ot.af)(e))&&void 0!==t?t:P.lH}},{title:t.formatMessage({id:\"ncoSiteTable.column.sunshineLength\"}),dataIndex:\"sunshineHours\",...st,key:\"sunshineHours\",width:\"13rem\",sortOrder:\"sunshineHours\"===n&&r,sorter:!0,render:e=>{var t;return null!==(t=(0,ot.af)(e))&&void 0!==t?t:P.lH}},{title:t.formatMessage({id:\"ncoSiteTable.column.averageTemperature\"}),dataIndex:\"temperature\",...st,key:\"temperature\",width:\"13rem\",sortOrder:\"temperature\"===n&&r,sorter:!0,render:e=>{var t;return null!==(t=(0,ot.af)(e))&&void 0!==t?t:P.lH}},{title:t.formatMessage({id:\"ncoSiteTable.column.theoreticalPowerGeneration\"}),dataIndex:\"theoryPower\",...st,key:\"theoryPower\",width:\"13rem\",sortOrder:\"theoryPower\"===n&&r,sorter:!0,render:e=>{var t;return null!==(t=(0,ot.af)(e))&&void 0!==t?t:P.lH}},{title:t.formatMessage({id:\"ncoSiteTable.column.PVPowerGeneration\"}),dataIndex:\"productPower\",...st,key:\"productPower\",width:\"13rem\",sortOrder:\"productPower\"===n&&r,sorter:!0,render:e=>{var t;return null!==(t=(0,ot.af)(e))&&void 0!==t?t:P.lH}},{title:t.formatMessage({id:\"ncoSiteTable.column.inverterPowerGeneration\"}),dataIndex:\"inverterPower\",...st,key:\"inverterPower\",width:\"13rem\",sortOrder:\"inverterPower\"===n&&r,sorter:!0,render:e=>{var t;return null!==(t=(0,ot.af)(e))&&void 0!==t?t:P.lH}},{title:t.formatMessage({id:\"ncoInverterTable.column.accumulatedPowerGeneration\"}),dataIndex:\"totalPower\",...st,key:\"totalPower\",width:\"13rem\",sortOrder:\"totalPower\"===n&&r,sorter:!0,render:e=>{var t;return null!==(t=(0,ot.af)(e))&&void 0!==t?t:P.lH}},{title:t.formatMessage({id:\"ncoSiteTable.column.onGridPower\"}),dataIndex:\"onGridPower\",...st,key:\"onGridPower\",width:\"13rem\",sortOrder:\"onGridPower\"===n&&r,sorter:!0,render:e=>{var t;return null!==(t=(0,ot.af)(e))&&void 0!==t?t:P.lH}},{title:t.formatMessage({id:\"ncoSiteTable.column.feedPower\"}),dataIndex:\"buyPower\",...st,key:\"buyPower\",width:\"13rem\",sortOrder:\"buyPower\"===n&&r,sorter:!0,render:e=>{var t;return null!==(t=(0,ot.af)(e))&&void 0!==t?t:P.lH}},{title:t.formatMessage({id:\"ncoSiteTable.column.equivalentUtilizationHours\"}),dataIndex:\"perpowerRatio\",...st,key:\"perpowerRatio\",width:\"13rem\",sortOrder:\"perpowerRatio\"===n&&r,sorter:!0,render:e=>{var t;return null!==(t=(0,ot.af)(e))&&void 0!==t?t:P.lH}},{title:t.formatMessage({id:\"ncoSiteTable.column.lossPower\"}),dataIndex:\"powerCuts\",...st,key:\"powerCuts\",width:\"13rem\",sortOrder:\"powerCuts\"===n&&r,sorter:!0,render:e=>{var t;return null!==(t=(0,ot.af)(e))&&void 0!==t?t:P.lH}},{title:t.formatMessage({id:\"neteco.pvms.partials.main.rm.dayCapPrpfit.data.limitLossProfits\"},{0:i}),dataIndex:\"powerCutsProfit\",...st,key:\"powerCutsProfit\",width:\"13rem\",sortOrder:\"powerCutsProfit\"===n&&r,sorter:!0,render:e=>{var t;return null!==(t=(0,ot.af)(e))&&void 0!==t?t:P.lH}},{title:t.formatMessage({id:\"ncoSiteTable.column.powerUsed\"}),dataIndex:\"usePower\",...st,key:\"usePower\",width:\"13rem\",sortOrder:\"usePower\"===n&&r,sorter:!0,render:e=>{var t;return null!==(t=(0,ot.af)(e))&&void 0!==t?t:P.lH}},{title:t.formatMessage({id:\"ncoSiteTable.column.selfGenerationPowerUsed\"}),dataIndex:\"selfUsePower\",...st,key:\"selfUsePower\",width:\"13rem\",sortOrder:\"selfUsePower\"===n&&r,sorter:!0,render:e=>{var t;return null!==(t=(0,ot.af)(e))&&void 0!==t?t:P.lH}},{title:t.formatMessage({id:\"ncoSiteTable.column.selfGenerationPowerUsedRadio\"}),dataIndex:\"selfUsePowerRatio\",...st,key:\"selfUsePowerRatio\",width:\"13rem\",sortOrder:\"selfUsePowerRatio\"===n&&r,sorter:!0,render:e=>{var t;return null!==(t=(0,ot.af)(e))&&void 0!==t?t:P.lH}},{title:t.formatMessage({id:\"ncoSiteTable.column.peakPower\"}),dataIndex:\"acPeakPower\",...st,key:\"acPeakPower\",width:\"13rem\",sortOrder:\"acPeakPower\"===n&&r,sorter:!0,render:e=>{var t;return null!==(t=(0,ot.af)(e))&&void 0!==t?t:P.lH}},{title:t.formatMessage({id:\"ncoSiteTable.column.systemEfficiencyPR\"}),dataIndex:\"performanceRatio\",...st,key:\"performanceRatio\",width:\"13rem\",sortOrder:\"performanceRatio\"===n&&r,sorter:!0,render:e=>{var t;return null!==(t=(0,ot.af)(e))&&void 0!==t?t:P.lH}},{title:t.formatMessage({id:\"ncoSiteTable.column.co2Reduction\"}),dataIndex:\"reductionTotalCO2\",...st,key:\"reductionTotalCO2\",width:\"13rem\",sortOrder:\"reductionTotalCO2\"===n&&r,sorter:!0,render:e=>{var t;return null!==(t=(0,ot.af)(e))&&void 0!==t?t:P.lH}},{title:t.formatMessage({id:\"ncoSiteTable.column.savingStandardCoal\"}),dataIndex:\"reductionTotalCoal\",...st,key:\"reductionTotalCoal\",width:\"13rem\",sortOrder:\"reductionTotalCoal\"===n&&r,sorter:!0,render:e=>{var t;return null!==(t=(0,ot.af)(e))&&void 0!==t?t:P.lH}},{title:t.formatMessage({id:\"ncoSiteTable.column.equivalentTreePlanting.column\"}),dataIndex:\"reductionTotalTree\",...st,key:\"reductionTotalTree\",width:\"13rem\",sortOrder:\"reductionTotalTree\"===n&&r,sorter:!0,render:e=>{var t;return null!==(t=(0,ot.af)(e))&&void 0!==t?t:P.lH}},{title:t.formatMessage({id:\"ncoEnergyStorageTable.column.chargingCapacity\"}),dataIndex:\"chargeCap\",...st,key:\"chargeCap\",width:\"13rem\",sortOrder:\"chargeCap\"===n&&r,sorter:!0,render:e=>{var t;return null!==(t=(0,ot.af)(e))&&void 0!==t?t:P.lH}},{title:t.formatMessage({id:\"ncoEnergyStorageTable.column.dischargeDischarge\"}),dataIndex:\"dischargeCap\",...st,key:\"dischargeCap\",width:\"13rem\",sortOrder:\"dischargeCap\"===n&&r,sorter:!0,render:e=>{var t;return null!==(t=(0,ot.af)(e))&&void 0!==t?t:P.lH}},{title:(0,_.jsxs)(\"div\",{className:\"ncoSiteTable-column-income\",children:[t.formatMessage({id:\"ncoSiteTable.column.income\"},{0:i}),(\"date\"===o||\"month\"===o||\"timeRange\"===o)&&(0,_.jsx)(b.Z,{placement:\"top\",title:t.formatMessage({id:\"neteco.pvms.station.income.kpi.tip2\"}),children:(0,_.jsx)(We.Z,{className:\"nco-column-hints-lined\"})}),(\"year\"===o||\"lifetime\"===o)&&(0,_.jsx)(at.Z,{placement:\"bottomRight\"})]}),dataIndex:\"powerProfit\",...st,key:\"powerProfit\",width:\"13rem\",sortOrder:\"powerProfit\"===n&&r,sorter:!0,render:e=>{var t;return null!==(t=(0,ot.af)(e))&&void 0!==t?t:P.lH}}]};var gt=n(45398);const vt=x.Z.Group;class yt extends i.Component{constructor(e){super(e),this.handleVisibleChange=e=>{e||this.cancelTbaleSetting(),this.setState({visible:e})},this.sureFilterColums=(e,t)=>{let n=[];const{filterColums:r,allColumns:i}=this.props,{checkedList:o}=this.state;t?(n=[...i].filter((e=>t.includes(e.key))),this.setState({checkedList:[...t]})):n=[...i].filter((e=>o.includes(e.key))),r(n,e),n.length>0&&this.setState({currentChecked:n,visible:!1})},this.onSingleChange=(e,t)=>{e.target.checked?t.push(e.target.value):t.splice(t.indexOf(e.target.value),1),this.setState({checkedList:t})},this.cancelTbaleSetting=()=>{const{currentChecked:e}=this.state,t=e.map((e=>e.key));this.setState({visible:!1},(()=>this.setState({checkedList:[...t]})))},this.onCheckAllChange=(e,t)=>{const{mandatoryColumns:n}=this.props;this.setState({checkedList:e.target.checked?t:n||[]})},this.resetDefaultColumns=()=>{const{defaultCheckedList:e}=this.props;this.setState({checkedList:[...e]})},this.forceUpdateHandler=()=>{this.forceUpdate()},this.state={currentChecked:null,visible:!1,checkedList:e.defaultCheckedList}}componentDidUpdate(e){const{initCheckedList:t,defaultCheckedList:n}=this.props;qe()(e.defaultCheckedList,n)||this.setState({checkedList:[...n]},(()=>this.sureFilterColums())),t&&!qe()(e.initCheckedList,t)&&this.setState({checkedList:[...t]},(()=>this.sureFilterColums()))}componentDidMount(){this.sureFilterColums();const{onRef:e}=this.props;e&&e(this)}render(){const{intl:e,allColumns:t}=this.props,{checkedList:n,visible:r}=this.state,i=e.formatMessage({id:\"common.button.reset\"}),o=t&&t.map((e=>e.key)),a=(e.formatMessage({id:\"common.button.cancel\"}),e.formatMessage({id:\"common.button.ok\"}));return(0,_.jsx)(\"div\",{className:\"nco-table-firlter-columns report-table-filter\",children:(0,_.jsx)(gt.Z,{getPopupContainer:e=>e.parentElement||document.body,content:(0,_.jsxs)(\"div\",{className:\"nco-table-firlter-columns-container\",children:[(0,_.jsx)(\"div\",{className:\"nco-checked-all nco-home-site-list-setting-checked\",style:{display:\"flex\"},children:(0,_.jsx)(x.Z,{indeterminate:!!n.length&&n.length<t.length,onChange:e=>{this.onCheckAllChange(e,o)},checked:n.length===t.length,children:(0,_.jsx)(p.Z,{id:\"neteco.pvms.household.selectAll\"})})}),(0,_.jsx)(\"div\",{className:\"nco-site-table-firlter-columns-checked-item\",children:(0,_.jsx)(vt,{value:n,className:\"nco-checkbox-group\",children:t.map((e=>(0,_.jsx)(\"div\",{className:\"nco-home-site-list-setting-checked\",children:(0,_.jsx)(x.Z,{value:e.key,onChange:e=>this.onSingleChange(e,n,o),disabled:e.disabled,children:e.title})},e.key)))})}),(0,_.jsxs)(\"div\",{className:\"nco-site-table-firlter-columns-button-group\",children:[(0,_.jsx)(f.Z,{className:\"nco-table-filter-cloumns-reset\",type:\"text\",onClick:this.resetDefaultColumns,title:i,children:i}),(0,_.jsx)(f.Z,{type:\"primary\",className:\"nco-table-firlter-columns-button-margin\",onClick:()=>this.sureFilterColums(!0),title:a,children:a})]})]}),open:r,trigger:\"click\",onOpenChange:this.handleVisibleChange,placement:\"bottomRight\",overlayClassName:\"nco-popover-setting-column\",children:(0,_.jsx)(\"span\",{className:\"nco-column-setting-icon\",children:(0,_.jsx)(\"i\",{className:\"icon-setting-lined\",title:e.formatMessage({id:\"neteco.pvms.gridParam.columnFilter\"})})})})})}}const bt=yt;var St=n(91138);const xt=[\"productPower\",\"inverterPower\",\"onGridPower\",\"powerProfit\"],wt=[...xt,\"perpowerRatio\",\"usePower\"];class Ct extends i.Component{constructor(e){super(e),this.setTableHeight=tt()((()=>{const e=(0,nt.h)(\".nco-report-container\",307);this.setState({tableHeight:e})}),300),this.configColumns=(e,t,n)=>{let r=$e()(e),i=$e()(t);if(!this.hasMeter){const e=[\"usePower\",\"onGridPower\",\"buyPower\"];r=r.filter((t=>-1===e.indexOf(t))),i=i.filter((t=>-1===e.indexOf(t)))}this.setState({columnsData:this.allColumns.filter((e=>i.includes(e.key))),checkedList:r},(()=>{this.tableFilterChild.sureFilterColums(!1,!n&&r)}))},this.updateColumns=(e,t,n)=>{let r=[];switch(e){case\"date\":r=\"byTime\"===t?[\"fmtCollectTimeStr\",\"productPower\",\"inverterPower\",\"onGridPower\",\"powerProfit\"]:ht,this.configColumns(r,this.dateColumns,n);break;case\"month\":r=\"byTime\"===t?ft:ht,this.configColumns(r,this.monthColumns,n);break;case\"year\":r=\"byTime\"===t?ft:ht,this.configColumns(r,this.yearColumns,n);break;default:r=\"byTime\"===t?ft:ht,this.configColumns(r,this.lifetimeColumns,n)}},this.filterNoUseColumns=e=>e.filter((e=>![\"fmtCollectTimeStr\",\"stationName\",\"stationAddr\"].includes(e))),this.getColumnsKey=(e,t)=>{const{getCounterIDs:n}=this.props;if(\"byTime\"===t){const t=\"date\"===e?xt:this.filterNoUseColumns(ft);return this.setState({columnsKey:[...t]}),n(t),t}const r=this.filterNoUseColumns(ht);return this.setState({columnsKey:r}),n(r),r},this.handleTableChange=(e,t,n)=>{let{field:r,order:i}=n;const{updateSortCondition:o,searchCondition:a,tableData:s,loadNcoSiteTable:l,dateType:c,statisticalMethod:u,currentDate:d,sortCondition:p,stationDn:f,intl:h,currentcy:m}=this.props,{pageNo:g,pageSize:v}=s,{sites:y,statisticTime:b}=a,{columnsKey:S}=this.state;o({sortBy:r||p.sortBy,sortOrder:i||\"ascend\"}),this.allColumns=mt({intl:h,sortBy:r||p.sortBy,sortOrder:i||\"ascend\",currentcy:m,dateType:c}),this.updateColumns(c,u,!0),l({...a,stationDn:f,sites:f?[{moType:20801,moString:f}]:y,statisticMethod:u,timeDimension:c,statisticTime:d||b,columnsKey:S},{page:g,pageSize:v},{sortBy:r||p.sortBy,sortOrder:i||\"ascend\"},h)},this.onChangePage=(e,t)=>{const{loadNcoSiteTable:n,searchCondition:r,sortCondition:i,dateType:o,statisticalMethod:a,currentDate:s,stationDn:l,intl:c}=this.props,{sites:u,statisticTime:d}=r,{columnsKey:p}=this.state;n({...r,sites:l?[{moType:20801,moString:l}]:u,stationDn:l,statisticMethod:a,timeDimension:o,statisticTime:s||d,columnsKey:p},{page:e,pageSize:t},i,c)},this.buildTooltipContent=()=>{const{intl:e,dateType:t}=this.props;switch(t){case\"date\":return e.formatMessage({id:\"common.message.report.tip.daily\"})+e.formatMessage({id:\"neteco.pvms.save.time.hour.flex.tip\"},{lengthOfTime:e.formatMessage({id:\"neteco.pvms.stationManagement.share.periodMonth.opt\"},{0:\"15\"})});case\"month\":return e.formatMessage({id:\"common.message.report.tip.month.site\"});case\"year\":return e.formatMessage({id:\"common.message.report.tip.year\"});case\"lifetime\":return e.formatMessage({id:\"common.message.report.tip.life\"});default:return\"\"}},this.filterColums=(e,t)=>{if(e.length){if(this.setState({columns:e}),t){const{loadNcoSiteTable:t,searchCondition:n,sortCondition:r,dateType:i,statisticalMethod:o,currentDate:a,stationDn:s,tableData:l,getCounterIDs:c,intl:u}=this.props,{sites:d,statisticTime:p}=n,{pageNo:f,pageSize:h}=l,m=[];e.forEach((e=>{let{key:t}=e;[\"fmtCollectTimeStr\",\"stationName\",\"stationAddr\"].includes(t)||m.push(t)})),this.setState({columnsKey:m}),c(m),(0,O.bt)(e),t({...n,sites:s?[{moType:20801,moString:s}]:d,stationDn:s,statisticMethod:o,timeDimension:i,statisticTime:a||p,columnsKey:m},{page:1,pageSize:h},r,u),(0,St.XB)(e,2)}}else this.setState({visible:!0})},this.filterSiteTableOk=()=>{this.setState({visible:!1})},this.tableFilterCol=e=>{this.tableFilterChild=e},this.intlColumnWidth={\"uk-ua\":15,\"nl-nl\":14},this.handData=e=>e.map(((e,t)=>(e.index=e.stationDn+e.fmtCollectTimeStr+t,e)));const t=!localStorage.getItem(\"firstRenderSiteReportList\");this.state={firstRenderSiteReportList:t,columns:[],columnsData:[],columnsKey:\"byTime\"===this.props.statisticalMethod?[...xt]:[...wt],tableHeight:493},this.dateColumns=lt(e.statisticalMethod),this.monthColumns=ct(e.statisticalMethod),this.yearColumns=dt(e.statisticalMethod),this.lifetimeColumns=pt(e.statisticalMethod),this.hasMeter=!0}componentDidMount(){this.setTableHeight(),window.addEventListener(\"resize\",this.setTableHeight);const{tableData:e,setIsEmptyTable:t}=this.props,{total:n}=e;t(0===n)}componentDidUpdate(e){const{intl:t,searchCondition:n,dateType:r,statisticalMethod:i,currentDate:o,loadNcoSiteTable:a,tableData:s,sortCondition:l,stationDn:c,updateSortCondition:u,currentcy:d,setIsEmptyTable:p}=this.props,{columnsKey:f}=this.state,{pageNo:h,pageSize:m,hasMeter:g,total:v}=s,{sites:y}=n,b=\"byTime\"===i?\"fmtCollectTimeStr\":\"productPower\",S=\"byTime\"===i?\"ascend\":\"descend\";if((void 0!==g&&g!==e.tableData.hasMeter||this.hasMeter!==g)&&(this.hasMeter=g,u({sortBy:b,sortOrder:S}),this.allColumns=mt({intl:t,sortBy:b,sortOrder:S,currentcy:d,dateType:r}),this.updateColumns(r,i)),!qe()(e.currentcy,d)){this.allColumns=mt({intl:t,sortBy:l.sortBy,sortOrder:l.sortOrder,currentcy:d,dateType:r});const e=\"byTime\"===i?[\"fmtCollectTimeStr\",\"productPower\",\"inverterPower\",\"onGridPower\",\"powerProfit\"]:ht;this.configColumns(e,this.dateColumns)}qe()(n,e.searchCondition)||a({...n,sites:c?[{moType:20801,moString:c}]:y,stationDn:c,columnsKey:f},{page:1,pageSize:m},l,t);const{statisticTime:x}=n;if(e.statisticalMethod!==i||e.dateType!==r||e.currentDate!==o){let s=[];s=e.statisticalMethod===i&&e.dateType===r?f:this.getColumnsKey(r,i),a({...n,sites:c?[{moType:20801,moString:c}]:y,stationDn:c,statisticMethod:i,timeDimension:r,statisticTime:o||x,columnsKey:s},{page:1,pageSize:m},e.statisticalMethod!==i||e.dateType!==r?{sortBy:b,sortOrder:S,currentcy:d}:l,t)}e.statisticalMethod!==i&&(this.dateColumns=lt(i),this.monthColumns=ct(i),this.yearColumns=dt(i),this.lifetimeColumns=pt(i),u({sortBy:b,sortOrder:S}),this.allColumns=mt({intl:t,sortBy:b,sortOrder:S,currentcy:d,dateType:r}),this.updateColumns(r,i)),e.dateType!==r&&(u({sortBy:b,sortOrder:S}),this.allColumns=mt({intl:t,sortBy:b,sortOrder:S,currentcy:d,dateType:r}),this.updateColumns(r,i)),e.tableData!==s&&p(0===v)}componentWillUnmount(){const{clearTableList:e,stationDn:t}=this.props;t&&e(),this.setState=()=>{},window.removeEventListener(\"resize\",this.setTableHeight)}componentWillReceiveProps(e,t){const{tableData:n={},stationDn:r}=e,{total:i}=n,{firstRenderSiteReportList:o}=this.state;i&&o&&!r&&(localStorage&&localStorage.setItem(\"firstRenderSiteReportList\",\"occupied\"),this.setState({firstRenderSiteReportList:!1}))}render(){var e;const{tableData:t,intl:n,loading:r,stationDn:i}=this.props,{columns:o,checkedList:a,visible:s,firstRenderSiteReportList:l,tableHeight:c}=this.state,{columnsData:u}=this.state,{list:d,total:f,pageNo:h,pageSize:m}=t,g=null!==(e=o.length*this.intlColumnWidth[window.neteco.i18n.getLocale()])&&void 0!==e?e:13;d&&d.map((e=>{Object.keys(e).forEach((t=>{if(\"stationName\"!==t&&\"stationAddr\"!==t&&\"stationCobingType\"!==t&&\"stationDn\"!==t&&\"fmtCollectTimeStr\"!==t){const n=\"powerProfit\"===t?2:3;(e[t]||(0,G.q8)(e[t],0))&&(e[t]=Xe()(Number(e[t]),n).toFixed(n))}}))}));const v=this.buildTooltipContent();return(0,_.jsxs)(\"div\",{className:\"nco-site-table\",children:[(0,_.jsxs)(\"div\",{className:\"nco-site-table-title\",children:[(0,_.jsx)(p.Z,{id:\"ncoReportContainer.tabs.label.site\"}),v&&(0,_.jsx)(b.Z,{title:this.buildTooltipContent(),children:(0,_.jsx)(We.Z,{className:\"nco-hints-lined\"})})]}),Boolean(u.length)&&(0,_.jsx)(bt,{intl:n,onRef:this.tableFilterCol,allColumns:u,defaultCheckedList:a,mandatoryColumns:null,filterColums:(e,t)=>this.filterColums(e,t)}),(0,_.jsx)(we.Z,{dataSource:this.handData(d),showSorterTooltip:!1,columns:o,rowKey:e=>e.index,pagination:!1,onChange:this.handleTableChange,loading:r,scroll:{x:o.length>6?`${g}rem`:void 0,y:c},className:\"nco-site-table-custom\"}),(0,_.jsx)(Ce.Z,{totalFixedLeft:!0,total:f,showSizeChanger:!0,showTotal:(0,Te.Z)(n),current:h,pageSize:m,pageSizeOptions:[\"10\",\"20\",\"30\",\"50\",\"100\"],onChange:this.onChangePage}),(0,_.jsx)(rt.Z,{type:\"prompt\",visible:s,okCallback:this.filterSiteTableOk,cancelCallback:this.filterSiteTableOk,content:(0,_.jsx)(\"div\",{children:n.formatMessage({id:\"neteco.pvms.gridParam.selectOneLess\"})})})]})}}const Tt=Ct,At=(0,d.$j)((e=>({tableData:e.ncoMonitorSiteTable.tableData,loading:e.ncoMonitorSiteTable.loading,searchCondition:e.ncoMonitorSiteSearchBar.searchCondition,sortCondition:e.ncoMonitorSiteSearchBar.sortCondition})),(e=>({loadNcoSiteTable:(t,n,r,i)=>{(async(e,t,n,r,i)=>{let{page:o,pageSize:a}=n,{sortBy:s,sortOrder:l}=r;const{stationDn:c,columnsKey:u,timeDimension:d,checkHourDim:p}=t;t.sites&&(1!==t.sites.length||\"/\"!==t.sites[0].moString&&t.sites[0].moString)||(t.sites=[]);const f=Intl.DateTimeFormat().resolvedOptions().timeZone;let h,m;if((0,G.kJ)(t.statisticTime)&&2===t.statisticTime.length){const[e,n]=t.statisticTime;m=e.startOf(\"day\").valueOf(),h=n.startOf(\"day\").valueOf()}else{var g;m=null===(g=t.statisticTime)||void 0===g?void 0:g.valueOf()}if(!m)return;e({type:Be.Mb});const v=ze(p,d),{success:y,data:b}=await(0,$.v_)(\"/rest/pvms/web/report/v1/station/station-kpi-list\",{currencyUnit:\"¥\",orderBy:s,page:o,pageSize:a,moList:t.sites,counterIDs:u,sort:\"ascend\"===l?\"asc\":\"desc\",statDim:(0,je.Z)(v),statTime:m,statEndTime:h,statType:c||\"byTime\"===t.statisticMethod?\"1\":\"2\",station:c?\"1\":\"0\",timeZone:(0,Le.ZP)(m),timeZoneStr:f});if(y)e(Fe(b));else if(b&&b.list)e(Fe({list:[],hasMeter:!1,total:0,pageNo:1,pageSize:a,pageCount:0}));else if(b&&b.tip){const{systemLimit:e,tip:t,selectedNum:n}=b;Ze.Z.warning({title:i.formatMessage({id:\"neteco.pvms.info\"}),content:i.formatMessage({id:\"ncoSiteToolbar.selectTooManyMo.stationTips\"},{systemLimit:e,selectedNum:n})})}})(e,t,n,r,i)},updateSortCondition:t=>{Ge(e,t)},clearTableList:()=>{(e=>{e({type:Be.H_})})(e)}})))((0,a.ZP)(Tt));n(75006);var Et=n(31519),Ot=n(65055),Mt=n(31464),Pt=n(65835);class Dt extends i.Component{constructor(e){super(e),this.configColumnsByStatistics=e=>{this.setState({statisticalMethod:e})},this.configColumnsByTime=e=>{this.setState({dateType:e})},this.configColumnsByDate=e=>{this.setState({currentDate:e})},this.getCounterIDs=e=>{this.setState({counterIDs:e})},this.getEchartsBase64=()=>this.childObj.exchangeEchartsToBase64(),this.getChildObj=e=>{this.childObj=e},this.handleCurrency=async()=>{const{userCompany:e,stationDn:t}=this.props;let n=t||e.moDn;const r=await(0,Mt.zC)(n);let i=\"\";if(r){const e=await Mt.Zo.getCurrencyList();i=(0,Ot.Z)(r,e)}this.setState({currentcy:i})},this.state={dateType:\"date\",statisticalMethod:(0,E.ux)()&&!e.stationDn?\"bySite\":\"byTime\",currentDate:u()().startOf(\"day\"),counterIDs:[\"productPower\",\"onGridPower\",\"powerProfit\"],isEmptyTable:!0};const{stationDn:t,userCompany:n,parentDn:r}=e;this.startTime=Pt.$.pageAccess(Et.e.stationReport.accessId,{pageName:O.v2.SITE,scope:(0,O.a7)(t,n,r)})}componentWillUnmount(){const{stationDn:e,userCompany:t,parentDn:n}=this.props;Pt.$.pageLeave(this.startTime,Et.e.stationReport.leaveId,{pageName:O.v2.SITE,scope:(0,O.a7)(e,t,n)})}componentDidMount(){this.handleCurrency()}componentDidUpdate(e){qe()(e.userCompany,this.props.userCompany)||this.handleCurrency()}render(){const{dateType:e,statisticalMethod:t,currentDate:n,counterIDs:r,currentcy:i}=this.state,{stationDn:o,userCompany:a,selectedTreeNode:s}=this.props,l=a.moDn;return(0,_.jsxs)(\"div\",{className:\"nco-site-report\",children:[(0,_.jsx)(Ye,{configColumnsByStatistics:this.configColumnsByStatistics,configColumnsByTime:this.configColumnsByTime,configColumnsByDate:this.configColumnsByDate,statisticalMethod:t,currentDate:n,dateType:e,stationDn:o,getEchartsBase64:this.getEchartsBase64,counterIDs:r,userCompany:a,isAreaAuth:this.props.isAreaAuth,currentcy:i,selectedTreeNode:s,isEmptyTable:this.state.isEmptyTable}),(0,_.jsx)(At,{statisticalMethod:t,dateType:e,currentDate:n,stationDn:o,getCounterIDs:this.getCounterIDs,userCompany:l,currentcy:i,setIsEmptyTable:e=>{this.setState({isEmptyTable:e})}})]})}}const It=Dt,{Option:Nt}=v.Z;class _t extends i.Component{constructor(e){super(e),this.handleTimeDimensionChange=e=>{const{configByDateType:t,configByTime:n}=this.props;this.setState({timeDimension:e}),this.formRef.current.setFieldsValue({statisticTime:(0,w.Z)(e)}),t(e),n((0,w.Z)(e)),(0,O.om)(this.props.deviceType,null,e)},this.handleTimeChange=e=>{const{configByTime:t}=this.props;t(e)},this.submitSearchForm=e=>{e.preventDefault();const{onSubmit:t}=this.props;this.formRef.current.validateFields().then((e=>{t(e),(0,O.om)(this.props.deviceType,null,e.timeDimension)}))},this.formRef=i.createRef(),this.state={timeDimension:\"date\"}}componentDidMount(){const{userCompany:e,stationDn:t}=this.props;if(!t&&e.moDn){const{moDn:t}=e;(0,A.Nu)(\"inverter-report-reload-entire-tree\",{rootElementDn:t}),(0,A.Nu)(\"pcs-report-reload-entire-tree\",{rootElementDn:t})}}componentWillUpdate(e){const{userCompany:t,stationDn:n}=e;if(!n&&t.moDn!==this.props.userCompany.moDn){const{moDn:e}=t;(0,A.Nu)(\"inverter-report-reload-entire-tree\",{rootElementDn:e}),(0,A.Nu)(\"pcs-report-reload-entire-tree\",{rootElementDn:e})}}render(){const{searchCondition:e,intl:t,stationDn:n,getselectedNodes:r,userCompany:i={},deviceType:o}=this.props,{timeDimension:a}=this.state,s=n,l=n;let c=this.props.isAreaAuth?M.qS:M.Ll;n&&(c=M.h8);const d=t.formatMessage({id:\"ncoInverterReportSearchForm.label.timeDimension\"}),h=t.formatMessage({id:\"ncoInverterReportSearchForm.label.timeDimension.day\"}),m=t.formatMessage({id:\"ncoInverterReportSearchForm.label.timeDimension.month\"}),g=t.formatMessage({id:\"ncoInverterReportSearchForm.label.timeDimension.year\"});return(0,_.jsx)(\"div\",{className:\"nco-site-search-form\",children:(0,_.jsxs)(y.Z,{layout:\"inline\",onFinish:this.submitSearchForm,ref:this.formRef,initialValues:{devices:[],timeDimension:\"date\",statisticTime:u()()},autoComplete:\"off\",children:[(0,_.jsx)(y.Z.Item,{label:t.formatMessage({id:\"ncoInverterReportSearchForm.label.device\"}),name:\"devices\",children:(\"INVERTER\"===o||\"PCS\"===o)&&(0,_.jsx)(T.Z,{domain:\"INVERTER\"===o?\"inverter-report\":\"pcs-report\",selectorConfigs:{displayLevel:\"DEVICE\",parentDn:(\"INVERTER\"===o?s:l)||i.moDn,useExternalRootElementDn:\"INVERTER\"===o?!s:!l,width:\"10rem\",disableRoot:i.moDn===P.b_,disableTypeSet:this.props.isAreaAuth?new Set([D.o0,D.Uc]):new Set([])},getselectedNodes:r,needStatus:!1,deviceDimension:o,onChange:()=>{},searchTypeInclude:c})}),(0,_.jsx)(y.Z.Item,{label:d,title:d,name:\"timeDimension\",children:(0,_.jsxs)(v.Z,{virtual:!1,style:{width:\"10rem\"},onChange:this.handleTimeDimensionChange,getPopupContainer:e=>e.parentNode||document.body,children:[(0,_.jsx)(Nt,{value:\"date\",title:h,children:h}),(0,_.jsx)(Nt,{value:\"month\",title:m,children:m}),(0,_.jsx)(Nt,{value:\"year\",title:g,children:g})]})}),(0,_.jsx)(y.Z.Item,{label:t.formatMessage({id:\"ncoInverterReportSearchForm.label.statisticTime\"}),name:\"statisticTime\",children:(0,_.jsx)(C.Z,{isNewStyle:!0,timeDimension:a,onChange:this.handleTimeChange})}),(0,_.jsx)(y.Z.Item,{children:(0,_.jsx)(f.Z,{type:\"primary\",onClick:this.submitSearchForm,children:(0,_.jsx)(p.Z,{id:\"common.button.search\"})})})]})})}}const jt=(0,a.ZP)(_t);class kt extends i.Component{constructor(e){super(e),this.submitHandler=e=>{const{updateSearchCondition:t}=this.props,{selectedNodesList:n}=this.state;t({...e,devices:n,_timestamp:(new Date).getTime()})},this.exportHandler=()=>{const{exportReport:e,searchCondition:t,sortCondition:n,dateType:r,deviceType:i,currentTime:o,stationDn:a,intl:s}=this.props,{timeDimension:l,statisticTime:c}=t,u=r||l;(0,O.KS)(i,u),e({...t,timeDimension:u,deviceDimension:i,statisticTime:o||c,stationDns:a?[a]:[]},n,s,this.setExportListModal)},this.showSubjectModal=()=>{this.setState({showSubjectModal:!0})},this.hideSubjectModal=()=>{this.setState({showSubjectModal:!1})},this.getselectedNodes=e=>{const{userCompany:t,stationDn:n}=this.props,r=t.moDn;0===e.length&&(e=n?[{moType:20801,moString:n}]:[{moType:20800,moString:r}]),this.setState({selectedNodesList:e})},this.checkCompanyMail=()=>{const{subjectCheck:e,intl:t,deviceType:n}=this.props;e(n,t,(e=>{this.setState({showSubjectModal:e})}))},this.setExportListModal=e=>{this.setState({showExportListModal:e})},this.getReportIdByDeviceDimension=e=>\"INVERTER\"===e?10001:10005;const{userCompany:t,stationDn:n}=this.props,r=t.moDn;this.state={showSubjectModal:!1,selectedNodesList:n?[{moType:20801,moString:n}]:[{moType:20800,moString:r}],showExportListModal:!1}}componentDidMount(){const{loadNcoInverterSearchBar:e,clearSearchCondition:t,updateSearchCondition:n}=this.props;e(),t();const{selectedNodesList:r}=this.state,i=r;n({...this.props.searchCondition,timeDimension:\"date\",statisticTime:u()(),devices:i,_timestamp:(new Date).getTime()})}componentWillUnmount(){const{clearSearchCondition:e}=this.props;e()}render(){const{searchCondition:e,intl:t,configByDateType:n,configByTime:r,stationDn:i,userCompany:o,exportLoading:a,deviceType:s,selectedTreeNode:l,isEmptyTable:c}=this.props,{showSubjectModal:d,showExportListModal:v}=this.state,y=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:\"7rem\";return(0,_.jsx)(\"div\",{title:e,style:{width:t},className:\"nco-inverter-search-bar-wrapper-ellipsis\",children:e})};return(0,_.jsxs)(\"div\",{className:\"nco-inverter-search-bar\",children:[(0,_.jsx)(\"div\",{className:\"nco-inverter-search-bar-form\",children:(0,_.jsx)(jt,{searchCondition:e,configByDateType:n,configByTime:r,getselectedNodes:this.getselectedNodes,onSubmit:this.submitHandler,stationDn:i,userCompany:o,deviceType:s,isAreaAuth:this.props.isAreaAuth})}),(0,_.jsxs)(\"div\",{className:\"nco-inverter-search-bar-buttons\",children:[(0,B.agq)([B.zDz,B.VtU])&&(0,_.jsx)(f.Z,{onClick:this.checkCompanyMail,children:(0,_.jsx)(p.Z,{id:\"common.button.subject\"})}),(0,B.agq)([B.$$w,B.n_C])&&!(0,I.sb)(l.elementDn)&&(0,_.jsx)(f.Z,{onClick:this.exportHandler,loading:a,disabled:c,children:(0,_.jsx)(p.Z,{id:\"common.button.export\"})})]}),(0,B.agq)([B.$$w,B.n_C])&&(0,_.jsx)(Z.Z,{showExportListModal:v,setExportListModal:this.setExportListModal,reportId:\"PCS\"===s?10005:10001}),(0,_.jsx)(h.Z,{title:t.formatMessage({id:\"PCS\"===s?\"neteco.pvms.partials.main.rm.dayCapPrpfit.pcsSub\":\"neteco.pvms.partials.main.rm.dayCapPrpfit.inverterSub\"}),width:\"90rem\",footer:null,visible:d,onCancel:this.hideSubjectModal,destroyOnClose:!0,maskClosable:!1,children:(0,_.jsx)(Ie,{reportId:this.getReportIdByDeviceDimension(s),stationDn:i,userCompany:o,deviceType:s,isAreaAuth:this.props.isAreaAuth,createConfig:{url:\"/rest/pvms/web/report/v1/subscribe/save-subscribe\",objectType:g.Sv,formItems:[{key:\"timeType\",type:\"select\",label:t.formatMessage({id:\"ncoAddSubjectReportForm.form.timeDimension\"}),initialValue:2,options:[{label:t.formatMessage({id:\"ncoAddSubjectReportForm.form.timeDimension.day\"}),value:2},{label:t.formatMessage({id:\"ncoAddSubjectReportForm.form.timeDimension.month\"}),value:4},{label:t.formatMessage({id:\"ncoAddSubjectReportForm.form.timeDimension.year\"}),value:5}]}]},modifyConfig:{url:\"/rest/pvms/web/report/v1/subscribe/update-subscribe\"},deleteConfig:{url:\"/rest/pvms/web/report/v1/subscribe/delete-subscribe\"},exportConfig:{url:\"/rest/pvms/web/report/v1/subscribe/export-subscribe\"},changeStateConfig:{url:\"/rest/pvms/web/report/v1/subscribe/change-state\"},table:{url:\"/rest/pvms/web/report/v1/subscribe/subscribe-list\",rowKey:\"subid\",columns:[{title:t.formatMessage({id:\"ncoHomeSiteList.columns.siteStatus\"}),dataIndex:\"state\",key:\"state\",align:\"center\",render:e=>e?(0,_.jsx)(\"div\",{style:{width:\"4rem\"},title:t.formatMessage({id:\"neteco.pvms.communicatPoint.enableState\"}),className:\"nco-inverter-search-bar-wrapper-ellipsis\",children:t.formatMessage({id:\"neteco.pvms.communicatPoint.enableState\"})}):(0,_.jsx)(\"div\",{style:{style:\"4rem\",color:\"#e54545\"},title:t.formatMessage({id:\"neteco.pvms.communicatPoint.forbiddenState\"}),className:\"nco-inverter-search-bar-wrapper-ellipsis\",children:t.formatMessage({id:\"neteco.pvms.communicatPoint.forbiddenState\"})})},{title:t.formatMessage({id:\"neteco.pvms.alarmPush.configName\"}),dataIndex:\"ruleName\",key:\"ruleName\",align:\"center\",render:e=>y(window.neteco.util.iUnescape(e),\"10rem\")},{title:t.formatMessage({id:\"neteco.pvms.partials.main.rm.dayCapPrpfit.subject\"}),dataIndex:\"mailTitle\",key:\"mailTitle\",align:\"center\",render:e=>y(window.neteco.util.iUnescape(e),\"10rem\")},{title:t.formatMessage({id:\"ncoSubjectReportTable.column.deviceName\"}),dataIndex:\"esnName\",key:\"esnName\",align:\"center\",render:e=>y(e?window.neteco.util.iUnescape(e.join(\",\")):e,\"12rem\")},{title:t.formatMessage({id:\"neteco.pvms.alarmPush.mail\"}),dataIndex:\"mailAddress\",key:\"mailAddress\",align:\"center\",render:e=>y(e,\"12rem\")},{title:t.formatMessage({id:\"ncoSubjectReportTable.column.timeDimension\"}),dataIndex:\"timeType\",key:\"timeType\",align:\"center\",render:e=>y(m(e,t))},{title:t.formatMessage({id:\"ncoSubjectReportTable.column.subjectDate\"}),dataIndex:\"subStartTime\",key:\"subStartTime\",align:\"center\",render:e=>y(u()(e).format(\"YYYY-MM-DD\"))},{title:t.formatMessage({id:\"neteco.pvms.partials.main.rm.dayCapPrpfit.reportLanguage\"}),dataIndex:\"language\",key:\"language\",align:\"center\",render:e=>y(H.Z.replaceIntlLang(e))}]}})})]})}}const Lt=kt;var Rt=n(50548);const Zt=e=>\"INVERTER\"===e?10001:10005,Bt=(0,d.$j)((e=>({loading:e.ncoMonitorInverterSearchBar.loading,searchCondition:e.ncoMonitorInverterSearchBar.searchCondition,sortCondition:e.ncoMonitorInverterSearchBar.sortCondition,exportLoading:e.ncoMonitorInverterSearchBar.exportLoading})),(e=>({loadNcoInverterSearchBar:()=>{(async e=>{e({type:Rt.lK,payload:!1}),e({type:Rt.Mb}),e({type:Rt.T_,payload:void 0})})(e)},clearSearchCondition:()=>{(e=>{e({type:Rt.Z8})})(e)},updateSearchCondition:t=>{((e,t)=>{e({type:Rt.mk,payload:t})})(e,t)},exportReport:(t,n,r,i)=>{(async(e,t,n,r,i)=>{let{sortBy:o,sortOrder:a}=n;e({type:Rt.lK,payload:!0});const{stationDns:s}=t,l=Intl.DateTimeFormat().resolvedOptions().timeZone,c=u()(t.statisticTime).startOf(\"day\").valueOf(),{success:d,data:p,message:f}=await(0,$.v_)(\"/rest/pvms/web/report/v1/export/report-async\",{reportId:Zt(t.deviceDimension),moList:0!==s.length&&0===t.devices.length?[{moType:20801,moString:s.join(\",\")}]:t.devices,statTime:c,statDim:(0,je.Z)(t.timeDimension),timeZone:(0,Le.ZP)(c),timeZoneStr:l,orderBy:o,sort:\"ascend\"===a?\"asc\":\"desc\"});if(e({type:Rt.lK,payload:!1}),d)i(!0);else if(p&&p.tip){const{systemLimit:e,selectedNum:t}=p;(0,V.xf)(r.formatMessage({id:\"ncoSiteToolbar.selectTooManyMo.deviceTips\"},{systemLimit:e,selectedNum:t}),r)}else\"NoMoWhenExportReport\"===p?(0,V.CD)(r.formatMessage({id:\"ncoSiteToolbar.export.noData\"})):\"dataNumExceedLimit\"===p?(0,V.xf)(r.formatMessage({id:\"neteco.pvms.report.export.number.limit\"},{num:P.VS}),r):f&&(0,V.xf)(r.formatMessage({id:f}),r)})(e,t,n,r,i)},subjectCheck:(t,n,r)=>{(async(e,t,n,r)=>{const{success:i,data:o}=await(0,$.U2)(\"/rest/pvms/web/report/v1/subscribe/check-mail\",{reportId:Zt(t)});i||(0,V.xf)(n.formatMessage({id:o})),r(i),e({type:Rt.bP,payload:i})})(e,t,n,r)}})))((0,a.ZP)(Lt));n(96187);const Ft={stationName:190,deviceName:200,installedCapacity:160,productPower:150,totalPower:150,perpowerRatio:180,acPeakPower:170,startupTime:140,aocRatio:170,powerCuts:150,consumePower:170,totalConsumePower:170},zt={stationName:190,deviceName:200,installedCapacity:230,productPower:120,totalPower:160,perpowerRatio:230,acPeakPower:180,startupTime:245,aocRatio:170,powerCuts:295,consumePower:240,totalConsumePower:300},Vt={stationName:190,deviceName:200,installedCapacity:230,productPower:165,totalPower:185,perpowerRatio:230,acPeakPower:180,startupTime:245,aocRatio:170,powerCuts:295,consumePower:240,totalConsumePower:300},Ht={stationName:190,deviceName:200,installedCapacity:230,productPower:165,totalPower:185,perpowerRatio:230,acPeakPower:180,startupTime:245,aocRatio:170,powerCuts:295,consumePower:240,totalConsumePower:300},Ut={stationName:190,deviceName:200,installedCapacity:230,productPower:120,totalPower:160,perpowerRatio:230,acPeakPower:245,startupTime:245,aocRatio:170,powerCuts:295,consumePower:240,totalConsumePower:300},Gt={stationName:190,deviceName:200,installedCapacity:160,productPower:150,totalPower:150,perpowerRatio:180,acPeakPower:170,startupTime:140,aocRatio:170,powerCuts:150,consumePower:170,totalConsumePower:170},Yt=(()=>{switch(window.neteco.i18n.getLocale()||\"zh-cn\"){case\"zh-cn\":return Ft;case\"en-us\":default:return zt;case\"de-de\":return Vt;case\"es-es\":return Ht;case\"uk-ua\":return Ut;case\"zh-tw\":return Gt}})(),Wt=e=>({width:Yt[e],ellipsis:!0});class Kt extends i.Component{constructor(e){super(e),this.setTableHeight=tt()((()=>{const e=(0,nt.h)(\".nco-report-container\",310);this.setState({tableHeight:e})}),300),this.onChangePage=(e,t)=>{const{loadNcoInverterTable:n,searchCondition:r,sortCondition:i,dateType:o,deviceType:a,currentTime:s,stationDn:l,intl:c}=this.props,{statisticTime:u}=r;n({...r,stationDns:l?[l]:[],timeDimension:o,deviceDimension:a,statisticTime:s||u},{page:e,pageSize:t},i,c)},this.handleTableChange=(e,t,n)=>{let{field:r,order:i}=n;const{updateSortCondition:o,searchCondition:a,tableData:s,loadNcoInverterTable:l,sortCondition:c,dateType:u,deviceType:d,currentTime:p,stationDn:f,intl:h}=this.props,{pageNo:m,pageSize:g}=s,{statisticTime:v}=a;o({sortBy:r||c.sortBy,sortOrder:i?\"descend\":\"ascend\"}),l({...a,stationDns:f?[f]:[],timeDimension:u,deviceDimension:d,statisticTime:p||v},{page:m,pageSize:g},{sortBy:r||c.sortBy,sortOrder:i?\"descend\":\"ascend\"},h)},this.buildTooltipContent=()=>{const{intl:e,dateType:t}=this.props;switch(t){case\"date\":return e.formatMessage({id:\"common.message.report.tip.daily\"});case\"month\":return e.formatMessage({id:\"common.message.report.tip.month.device\"});case\"year\":return e.formatMessage({id:\"common.message.report.tip.year\"});default:return\"\"}};const t=!localStorage.getItem(\"firstRenderInventerList\");this.state={firstRenderInventerList:t,tableHeight:496,isEmptyTable:!0}}componentDidMount(){window.addEventListener(\"resize\",this.setTableHeight),this.setTableHeight();const{tableData:e,setIsEmptyTable:t}=this.props,{total:n}=e;t(0===n)}componentWillUnmount(){window.removeEventListener(\"resize\",this.setTableHeight)}componentDidUpdate(e){const{searchCondition:t,loadNcoInverterTable:n,tableData:r,sortCondition:i,dateType:o,deviceType:a,currentTime:s,stationDn:l,intl:c,setIsEmptyTable:u}=this.props,{pageNo:d,pageSize:p,total:f}=r;qe()(t,e.searchCondition)||n({...t,stationDns:l?[l]:[],deviceDimension:a},{page:1,pageSize:p},i,c),e.dateType===o&&e.currentTime===s&&e.deviceType===a||n({...t,stationDns:l?[l]:[],timeDimension:o,deviceDimension:a,statisticTime:s},{page:1,pageSize:p},i,c),qe()(r,e.tableData)||u(0===f)}componentWillReceiveProps(e,t){const{tableData:n={},stationDn:r}=e,{total:i}=n,{firstRenderInventerList:o}=this.state;i&&o&&!r&&(localStorage&&localStorage.setItem(\"firstRenderInventerList\",\"occupied\"),this.setState({firstRenderInventerList:!1}))}render(){const{searchCondition:e,tableData:t,sortCondition:n,intl:r,dateType:i,deviceType:o,loading:a,stationDn:s}=this.props,{list:l,total:c,pageNo:u,pageSize:d}=t,{sortBy:f,sortOrder:h}=n,{firstRenderInventerList:m,tableHeight:g}=this.state,v=(e,t)=>(0,_.jsx)(\"span\",{className:\"nco-inverter-table-ellipsis\",children:(0,ot.af)(e||(0,G.q8)(e,0)?Xe()(Number(e),3).toFixed(3):P.lH)}),y={stationName:{title:r.formatMessage({id:\"ncoInverterTable.column.site\"}),dataIndex:\"stationName\",key:\"stationName\",...Wt(\"stationName\"),render:e=>{var t;return(0,_.jsx)(\"div\",{className:\"nco-inverter-table-ellipsis\",children:null!==(t=window.neteco.util.iUnescape(e))&&void 0!==t?t:P.lH})}},deviceName:{title:r.formatMessage({id:\"ncoInverterTable.column.device\"}),dataIndex:\"deviceName\",key:\"deviceName\",...Wt(\"deviceName\"),render:e=>{var t;return(0,_.jsx)(\"div\",{className:\"nco-inverter-table-ellipsis\",children:null!==(t=window.neteco.util.iUnescape(e))&&void 0!==t?t:P.lH})}},installedCapacity:{title:r.formatMessage({id:(0,it.k)()?\"neteco.pvms.inverter.DCCapacity\":\"neteco.pvms.inverter.stringCapacity\"}),dataIndex:\"installedCapacity\",key:\"installedCapacity\",sorter:!0,sortOrder:\"installedCapacity\"===f&&h,...Wt(\"installedCapacity\"),render:e=>(0,_.jsx)(\"div\",{children:v(e)})},productPower:{title:r.formatMessage({id:\"INVERTER\"===o?\"ncoInverterTable.column.powerGeneration\":\"ncoEnergyStorageTable.column.dischargeDischarge\"}),dataIndex:\"productPower\",key:\"productPower\",sorter:!0,sortOrder:\"productPower\"===f&&h,...Wt(\"productPower\"),render:e=>(0,_.jsx)(\"div\",{children:v(e)})},perpowerRatio:{title:r.formatMessage({id:\"ncoInverterTable.column.equivalentUtilizationHours\"}),dataIndex:\"perpowerRatio\",key:\"perpowerRatio\",sorter:!0,sortOrder:\"perpowerRatio\"===f&&h,...Wt(\"perpowerRatio\"),render:e=>(0,_.jsx)(\"div\",{children:v(e)})},acPeakPower:{title:r.formatMessage({id:\"ncoInverterTable.column.peakAcPower\"}),dataIndex:\"acPeakPower\",key:\"acPeakPower\",sorter:!0,sortOrder:\"acPeakPower\"===f&&h,...Wt(\"acPeakPower\"),render:e=>(0,_.jsx)(\"div\",{children:v(e)})},totalPower:{title:r.formatMessage({id:\"ncoInverterTable.column.accumulatedPowerGeneration\"}),dataIndex:\"totalPower\",key:\"totalPower\",sorter:!0,sortOrder:\"totalPower\"===f&&h,...Wt(\"totalPower\"),render:e=>(0,_.jsx)(\"div\",{children:v(e)})},startupTime:{title:r.formatMessage({id:\"ncoInverterTable.column.gridConnectionTime\"}),dataIndex:\"startupTime\",key:\"startupTime\",sorter:!0,sortOrder:\"startupTime\"===f&&h,...Wt(\"startupTime\"),render:e=>(0,_.jsx)(\"div\",{children:v(e)})},consumePower:{title:r.formatMessage({id:\"ncoEnergyStorageTable.column.chargingCapacity\"}),dataIndex:\"consumePower\",key:\"consumePower\",sorter:!0,sortOrder:\"consumePower\"===f&&h,...Wt(\"consumePower\"),render:e=>(0,_.jsx)(\"div\",{children:v(e)})}};let S=[];\"INVERTER\"===o?(S=[y.stationName,y.deviceName,y.installedCapacity,y.productPower,y.perpowerRatio,y.acPeakPower,y.startupTime],\"date\"===i&&S.splice(4,0,y.totalPower)):S=\"date\"===i?[y.stationName,y.deviceName,y.productPower,y.totalPower,y.acPeakPower,y.consumePower]:[y.stationName,y.deviceName,y.productPower,y.acPeakPower,y.consumePower];const{xScroll:x}=(e=>({xScroll:e.reduce(((e,t)=>e+Wt(t.key).width),0)}))(S);return(0,_.jsxs)(\"div\",{className:\"nco-inverter-table\",children:[(0,_.jsxs)(\"div\",{className:\"nco-inverter-table-title\",children:[(0,_.jsx)(p.Z,{id:\"PCS\"===o?\"ncoReportContainer.tabs.label.pcs\":\"ncoReportContainer.tabs.label.inverter\"}),(0,_.jsx)(b.Z,{title:this.buildTooltipContent(),children:(0,_.jsx)(We.Z,{className:\"nco-hints-lined\"})})]}),(0,_.jsx)(we.Z,{dataSource:l,columns:S,pagination:!1,showSorterTooltip:!1,loading:a,onChange:this.handleTableChange,rowKey:\"dn\",scroll:{y:g,x}}),(0,_.jsx)(Ce.Z,{totalFixedLeft:!0,total:c,showSizeChanger:!0,showTotal:(0,Te.Z)(r),current:u,pageSize:d,pageSizeOptions:[\"10\",\"20\",\"30\",\"50\",\"100\"],onChange:this.onChangePage})]})}}const qt=Kt;var Qt=n(63043);const Xt=e=>({type:Qt.T,payload:e}),Jt=e=>\"INVERTER\"===e?20822:20838,$t=(0,d.$j)((e=>({tableData:e.ncoMonitorInverterTable.tableData,loading:e.ncoMonitorInverterTable.loading,searchCondition:e.ncoMonitorInverterSearchBar.searchCondition,sortCondition:e.ncoMonitorInverterSearchBar.sortCondition})),(e=>({loadNcoInverterTable:(t,n,r,i)=>{(async(e,t,n,r,i)=>{let{page:o,pageSize:a}=n,{sortBy:s,sortOrder:l}=r;e({type:Qt.M});const{stationDns:c}=t;t.devices&&(1!==t.devices.length||\"/\"!==t.devices[0].moString&&t.devices[0].moString)||(t.devices=[]);const u=t.statisticTime.valueOf(),{success:d,data:p}=await(0,$.v_)(\"/rest/pvms/web/report/v1/inverter/energy-generate-kpi-list\",{moList:0!==c.length&&0===t.devices.length?[]:t.devices,stationDn:c.join(\",\"),orderBy:s,page:o||1,pageSize:a,sort:\"ascend\"===l?\"asc\":\"desc\",statTime:u,statTimeDim:(0,je.Z)(t.timeDimension),timeZone:(0,Le.ZP)(u),mocId:Jt(t.deviceDimension)});if(d)e(Xt(p));else if(p&&p.list)e(Xt({list:[],total:0,pageNo:1,pageSize:a,pageCount:0}));else if(p&&p.tip){const{systemLimit:e,tip:t,selectedNum:n}=p;Ze.Z.warning({title:i.formatMessage({id:\"neteco.pvms.info\"}),content:i.formatMessage({id:\"ncoSiteToolbar.selectTooManyMo.deviceTips\"},{systemLimit:e,selectedNum:n})})}})(e,t,n,r,i)},updateSortCondition:t=>{((e,t)=>{e({type:Rt.MC,payload:t})})(e,t)}})))((0,a.ZP)(qt));n(68116);class en extends i.Component{constructor(e){super(e),this.configByDateType=e=>{this.setState({dateType:e})},this.configByTime=e=>{this.setState({currentTime:e})},this.state={dateType:\"date\",currentTime:u()().startOf(\"day\"),isEmptyTable:!0};const{stationDn:t,userCompany:n,parentDn:r,deviceType:i}=e;this.startTime=Pt.$.pageAccess(Et.e.stationReport.accessId,{pageName:O.v2[i],scope:(0,O.a7)(t,n,r)})}componentWillUnmount(){const{stationDn:e,userCompany:t,parentDn:n,deviceType:r}=this.props;Pt.$.pageLeave(this.startTime,Et.e.stationReport.leaveId,{pageName:O.v2[r],scope:(0,O.a7)(e,t,n)})}render(){var e,t;const{stationDn:n,userCompany:r,deviceType:i,match:o,selectedTreeNode:a}=this.props,{dateType:s,currentTime:l}=this.state,c=r.moDn,u=null===(e=o.params)||void 0===e||null===(t=e.activeTab)||void 0===t?void 0:t.toUpperCase(),d=i||(u&&!i?u:void 0);return(0,_.jsxs)(\"div\",{className:\"nco-inverter-report\",children:[(0,_.jsx)(Bt,{configByDateType:this.configByDateType,configByTime:this.configByTime,currentTime:l,dateType:s,deviceType:d,stationDn:n,userCompany:r,isAreaAuth:this.props.isAreaAuth,selectedTreeNode:a,isEmptyTable:this.state.isEmptyTable}),(0,_.jsx)($t,{currentTime:l,dateType:s,deviceType:d,stationDn:n,userCompany:c,isEmptyTable:this.state.isEmptyTable,setIsEmptyTable:e=>{this.setState({isEmptyTable:e})}})]})}}const tn=(0,o.EN)(en);n(7921);const{Option:nn}=v.Z;class rn extends i.Component{constructor(e){super(e),this.handleDeviceDimensionChange=e=>{const{configByDeviceType:t}=this.props;this.setState({deviceDimension:e}),t(e),(0,O.om)(\"STORAGE\",e,this.state.timeDimension)},this.handleTimeDimensionChange=e=>{const{configByDateType:t,configByTime:n}=this.props;this.setState({timeDimension:e}),this.formRef.current.setFieldsValue({statisticTime:(0,w.Z)(e)}),t(e),n((0,w.Z)(e)),(0,O.om)(\"STORAGE\",this.state.deviceDimension,e)},this.handleTimeChange=e=>{const{configByTime:t}=this.props;t(e)},this.submitSearchForm=e=>{e.preventDefault();const{onSubmit:t}=this.props;this.formRef.current.validateFields().then((e=>{t(e),(0,O.om)(\"STORAGE\",e.deviceDimension,e.timeDimension)}))},this.formRef=i.createRef(),this.state={timeDimension:\"date\",deviceDimension:\"STORAGE\"}}componentDidMount(){const{userCompany:e,stationDn:t}=this.props;if(!t&&e.moDn){const{moDn:t}=e;(0,A.Nu)(\"storage-report-reload-entire-tree\",{rootElementDn:t})}}componentWillUpdate(e){const{userCompany:t,stationDn:n}=e;if(!n&&t.moDn!==this.props.userCompany.moDn){const{moDn:e}=t;(0,A.Nu)(\"storage-report-reload-entire-tree\",{rootElementDn:e})}}render(){const{searchCondition:e,intl:t,stationDn:n,getselectedNodes:r,userCompany:i={}}=this.props,{timeDimension:o,deviceDimension:a}=this.state;let s=this.props.isAreaAuth?M.qS:M.Ll;n&&(s=M.h8);const l=t.formatMessage({id:\"ncoAddSubjectReportForm.form.timeDimension.day\"}),c=t.formatMessage({id:\"ncoAddSubjectReportForm.form.timeDimension.month\"}),d=t.formatMessage({id:\"ncoAddSubjectReportForm.form.timeDimension.year\"}),h=t.formatMessage({id:\"ncoEnergyStorageSearchForm.label.deviceDimension.site\"}),m=t.formatMessage({id:\"ncoEnergyStorageSearchForm.label.deviceDimension.subarray\"}),g=t.formatMessage({id:\"ncoEnergyStorageSearchForm.label.deviceDimension.cluster\"}),b=t.formatMessage({id:\"ncoEnergyStorageSearchForm.label.deviceDimension.oldVersion\"});return(0,_.jsx)(\"div\",{className:\"nco-site-search-form\",children:(0,_.jsxs)(y.Z,{layout:\"inline\",onFinish:this.submitSearchForm,ref:this.formRef,initialValues:{devices:[],timeDimension:o,statisticTime:u()(),deviceDimension:a},autoComplete:\"off\",children:[(0,_.jsx)(y.Z.Item,{label:t.formatMessage({id:\"ncoEnergyStorageSearchForm.label.statisticMethod\"}),name:\"deviceDimension\",children:(0,_.jsxs)(v.Z,{virtual:!1,style:{width:\"10rem\"},onChange:this.handleDeviceDimensionChange,getPopupContainer:e=>e.parentNode||document.body,children:[(0,_.jsx)(nn,{value:\"STORAGE\",title:h,children:h}),(0,_.jsx)(nn,{value:\"STORAGE_SUBARRAY\",title:m,children:m}),(0,_.jsx)(nn,{value:\"STORAGE_OLD\",title:b,children:b}),(0,_.jsx)(nn,{value:\"STORAGE_CLUSTER\",title:g,children:g})]})}),(0,_.jsx)(y.Z.Item,{label:t.formatMessage({id:\"ncoInverterReportSearchForm.label.device\"}),name:\"devices\",children:(0,_.jsx)(T.Z,{domain:\"storage-report\",selectorConfigs:{displayLevel:\"STORAGE\",parentDn:n||i.moDn,useExternalRootElementDn:!n,width:\"10rem\",disableRoot:i.moDn===P.b_,disableTypeSet:this.props.isAreaAuth?new Set([D.o0,D.Uc]):new Set([])},getselectedNodes:r,deviceDimension:a,needStatus:!1,searchTypeInclude:s})}),(0,_.jsx)(y.Z.Item,{label:t.formatMessage({id:\"ncoEnergyStorageSearchForm.label.timeDimension\"}),name:\"timeDimension\",children:(0,_.jsxs)(v.Z,{virtual:!1,style:{width:\"10rem\"},onChange:this.handleTimeDimensionChange,getPopupContainer:e=>e.parentNode||document.body,children:[(0,_.jsx)(nn,{value:\"date\",title:l,children:l}),(0,_.jsx)(nn,{value:\"month\",title:c,children:c}),(0,_.jsx)(nn,{value:\"year\",title:d,children:d})]})}),(0,_.jsx)(y.Z.Item,{label:t.formatMessage({id:\"ncoEnergyStorageSearchForm.label.statisticTime\"}),name:\"statisticTime\",children:(0,_.jsx)(C.Z,{isNewStyle:!0,timeDimension:o,onChange:this.handleTimeChange})}),(0,_.jsx)(y.Z.Item,{children:(0,_.jsx)(f.Z,{type:\"primary\",onClick:this.submitSearchForm,children:(0,_.jsx)(p.Z,{id:\"common.button.search\"})})})]})})}}const on=(0,a.ZP)(rn),an=20801,sn=20800;class ln extends i.Component{constructor(e){super(e),this.submitHandler=e=>{const{updateSearchCondition:t}=this.props,{selectedNodesList:n}=this.state;t({...e,devices:n,_timestamp:(new Date).getTime()})},this.exportHandler=()=>{const{exportReport:e,searchCondition:t,sortCondition:n,dateType:r,deviceType:i,currentTime:o,stationDn:a,intl:s}=this.props,{timeDimension:l,statisticTime:c}=t,u=r||l;(0,O.KS)(\"STORAGE\",u),e({...t,timeDimension:u,deviceDimension:i,statisticTime:o||c,stationDns:a?[a]:[]},n,s,this.setExportListModal)},this.showSubjectModal=()=>{this.setState({showSubjectModal:!0})},this.hideSubjectModal=()=>{this.setState({showSubjectModal:!1})},this.getselectedNodes=e=>{const{userCompany:t,stationDn:n}=this.props,r=t.moDn;0===e.length&&(e=n?[{moType:an,moString:n}]:[{moType:sn,moString:r}]),this.setState({selectedNodesList:e})},this.checkCompanyMail=()=>{const{subjectCheck:e,intl:t,deviceType:n}=this.props;e(n,t,(e=>{this.setState({showSubjectModal:e})}))},this.setExportListModal=e=>{this.setState({showExportListModal:e})},this.getReportIdByDeviceDimension=e=>{switch(e){case\"STORAGE_SUBARRAY\":return 10006;case\"STORAGE_CLUSTER\":return 10008;case\"STORAGE_OLD\":return 2e4;default:return 19999}},this.getModalTitleByDeviceDimension=e=>{switch(e){case\"STORAGE_SUBARRAY\":return\"neteco.pvms.partials.main.rm.dayCapPrpfit.subarraySub\";case\"STORAGE_CLUSTER\":return\"neteco.pvms.partials.main.rm.dayCapPrpfit.clusterSub\";case\"STORAGE_OLD\":return\"neteco.pvms.partials.main.rm.dayCapPrpfit.cnSub\";default:return\"neteco.pvms.partials.main.rm.dayCapPrpfit.storageSub\"}};const{userCompany:t,stationDn:n}=this.props,r=t.moDn;this.state={showSubjectModal:!1,selectedNodesList:n?[{moType:an,moString:n}]:[{moType:sn,moString:r}],showExportListModal:!1}}componentDidMount(){const{loadNcoEnergyStorageSearchBar:e,clearSearchCondition:t,updateSearchCondition:n}=this.props;e(),t();const{selectedNodesList:r}=this.state,i=r;n({timeDimension:\"date\",statisticTime:u()(),deviceDimension:\"STORAGE\",devices:i,_timestamp:(new Date).getTime()})}componentWillUnmount(){const{clearSearchCondition:e}=this.props;e()}render(){const{searchCondition:e,intl:t,configByDateType:n,configByTime:r,configByDeviceType:i,stationDn:o,userCompany:a,exportLoading:s,deviceType:l,selectedTreeNode:c,isEmptyTable:d}=this.props,{showSubjectModal:v,showExportListModal:y}=this.state,b=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:\"7rem\";return(0,_.jsx)(\"div\",{title:e,style:{width:t},className:\"nco-energy-storage-search-bar-wrapper-ellipsis\",children:e})},S=[{title:t.formatMessage({id:\"ncoHomeSiteList.columns.siteStatus\"}),dataIndex:\"state\",key:\"state\",align:\"center\",render:e=>e?(0,_.jsx)(\"div\",{style:{width:\"4rem\"},title:t.formatMessage({id:\"neteco.pvms.communicatPoint.enableState\"}),className:\"nco-energy-storage-search-bar-wrapper-ellipsis\",children:t.formatMessage({id:\"neteco.pvms.communicatPoint.enableState\"})}):(0,_.jsx)(\"div\",{style:{style:\"4rem\",color:\"#e54545\"},title:t.formatMessage({id:\"neteco.pvms.communicatPoint.forbiddenState\"}),className:\"nco-energy-storage-search-bar-wrapper-ellipsis\",children:t.formatMessage({id:\"neteco.pvms.communicatPoint.forbiddenState\"})})},{title:t.formatMessage({id:\"neteco.pvms.alarmPush.configName\"}),dataIndex:\"ruleName\",key:\"ruleName\",align:\"center\",render:e=>b(window.neteco.util.iUnescape(e),\"10rem\")},{title:t.formatMessage({id:\"neteco.pvms.partials.main.rm.dayCapPrpfit.subject\"}),dataIndex:\"mailTitle\",key:\"mailTitle\",align:\"center\",render:e=>b(window.neteco.util.iUnescape(e),\"10rem\")},{title:t.formatMessage({id:\"ncoSubjectReportTable.column.deviceName\"}),dataIndex:\"esnName\",key:\"esnName\",align:\"center\",render:e=>b(e?window.neteco.util.iUnescape(e.join(\",\")):e,\"12rem\")},{title:t.formatMessage({id:\"neteco.pvms.alarmPush.mail\"}),dataIndex:\"mailAddress\",key:\"mailAddress\",align:\"center\",render:e=>b(e,\"12rem\")},{title:t.formatMessage({id:\"ncoSubjectReportTable.column.timeDimension\"}),dataIndex:\"timeType\",key:\"timeType\",align:\"center\",render:e=>b(m(e,t))},{title:t.formatMessage({id:\"ncoSubjectReportTable.column.subjectDate\"}),dataIndex:\"subStartTime\",key:\"subStartTime\",align:\"center\",render:e=>b(u()(e).format(\"YYYY-MM-DD\"))},{title:t.formatMessage({id:\"neteco.pvms.partials.main.rm.dayCapPrpfit.reportLanguage\"}),dataIndex:\"language\",key:\"language\",align:\"center\",render:e=>b(H.Z.replaceIntlLang(e))}];return\"STORAGE\"===l&&S.splice(3,1,{title:t.formatMessage({id:\"neteco.pvms.deviceDialog.stationName\"}),dataIndex:\"stationName\",key:\"stationName\",align:\"center\",render:e=>b(e?window.neteco.util.iUnescape(e.join(\",\")):e,\"12rem\")}),(0,_.jsxs)(\"div\",{className:\"nco-energy-storage-search-bar\",children:[(0,_.jsx)(\"div\",{className:\"nco-energy-storage-search-bar-form\",children:(0,_.jsx)(on,{searchCondition:e,configByDateType:n,configByTime:r,configByDeviceType:e=>{const{userCompany:t,stationDn:n}=this.props,r=n?[{moType:an,moString:n}]:[{moType:sn,moString:t.moDn}];this.props.searchCondition.devices=r,i(e)},onSubmit:this.submitHandler,stationDn:o,getselectedNodes:this.getselectedNodes,userCompany:a,isAreaAuth:this.props.isAreaAuth})}),(0,_.jsxs)(\"div\",{className:\"nco-energy-storage-search-bar-buttons\",children:[(0,B.lVp)(B.IO6)&&(0,_.jsx)(f.Z,{onClick:this.checkCompanyMail,children:(0,_.jsx)(p.Z,{id:\"common.button.subject\"})}),(0,B.lVp)(B.kRj)&&!(0,I.sb)(c.elementDn)&&(0,_.jsx)(f.Z,{onClick:this.exportHandler,loading:s,disabled:d,children:(0,_.jsx)(p.Z,{id:\"common.button.export\"})})]}),(0,B.lVp)(B.kRj)&&(0,_.jsx)(Z.Z,{showExportListModal:y,setExportListModal:this.setExportListModal,reportId:(()=>{let e=19999;switch(l){case\"STORAGE\":e=19999;break;case\"STORAGE_SUBARRAY\":e=10006;break;case\"STORAGE_CLUSTER\":e=10008;break;case\"STORAGE_OLD\":e=2e4}return e})()}),(0,_.jsx)(h.Z,{title:t.formatMessage({id:this.getModalTitleByDeviceDimension(l)}),width:\"90rem\",footer:null,visible:v,onCancel:this.hideSubjectModal,destroyOnClose:!0,maskClosable:!1,children:(0,_.jsx)(Ie,{reportId:this.getReportIdByDeviceDimension(l),stationDn:o,isAreaAuth:this.props.isAreaAuth,userCompany:a,deviceType:l,createConfig:{url:\"/rest/pvms/web/report/v1/subscribe/save-subscribe\",objectType:g.$M,formItems:[{key:\"timeType\",type:\"select\",label:t.formatMessage({id:\"ncoAddSubjectReportForm.form.timeDimension\"}),initialValue:2,options:[{label:t.formatMessage({id:\"ncoAddSubjectReportForm.form.timeDimension.day\"}),value:2},{label:t.formatMessage({id:\"ncoAddSubjectReportForm.form.timeDimension.month\"}),value:4},{label:t.formatMessage({id:\"ncoAddSubjectReportForm.form.timeDimension.year\"}),value:5}]}]},modifyConfig:{url:\"/rest/pvms/web/report/v1/subscribe/update-subscribe\"},deleteConfig:{url:\"/rest/pvms/web/report/v1/subscribe/delete-subscribe\"},exportConfig:{url:\"/rest/pvms/web/report/v1/subscribe/export-subscribe\"},changeStateConfig:{url:\"/rest/pvms/web/report/v1/subscribe/change-state\"},table:{url:\"/rest/pvms/web/report/v1/subscribe/subscribe-list\",rowKey:\"subid\",columns:S}})})]})}}const cn=ln;var un=n(20950);const dn=e=>{switch(e){case\"STORAGE_SUBARRAY\":return 10006;case\"STORAGE_CLUSTER\":return 10008;case\"STORAGE_OLD\":return 2e4;default:return 19999}},pn=(0,d.$j)((e=>({loading:e.ncoMonitorEnergyStorageSearchBar.loading,searchCondition:e.ncoMonitorEnergyStorageSearchBar.searchCondition,sortCondition:e.ncoMonitorEnergyStorageSearchBar.sortCondition,isShowModal:e.ncoMonitorEnergyStorageSearchBar.isShowModal,exportLoading:e.ncoMonitorEnergyStorageSearchBar.exportLoading})),(e=>({loadNcoEnergyStorageSearchBar:()=>{(async e=>{e({type:un.lK,payload:!1}),e({type:un.Mb}),e({type:un.T_,payload:void 0})})(e)},clearSearchCondition:()=>{(e=>{e({type:un.Z8})})(e)},updateSearchCondition:t=>{((e,t)=>{e({type:un.mk,payload:t})})(e,t)},exportReport:(t,n,r,i)=>{(async(e,t,n,r,i)=>{let{sortBy:o,sortOrder:a}=n;e({type:un.lK,payload:!0});const{stationDns:s}=t,l=Intl.DateTimeFormat().resolvedOptions().timeZone,c=u()(t.statisticTime).startOf(\"day\").valueOf(),{success:d,data:p,message:f}=await(0,$.v_)(\"/rest/pvms/web/report/v1/export/report-async\",{reportId:dn(t.deviceDimension),moList:0!==s.length&&0===t.devices.length?[{moType:20801,moString:s.join(\",\")}]:t.devices,statTime:c,statDim:(0,je.Z)(t.timeDimension),timeZone:(0,Le.ZP)(c),timeZoneStr:l,orderBy:o,sort:\"ascend\"===a?\"asc\":\"desc\"});if(e({type:un.lK,payload:!1}),d)i(!0);else if(p&&p.tip){const{selectedNum:e,systemLimit:t}=p;(0,V.xf)(r.formatMessage({id:\"ncoSiteToolbar.selectTooManyMo.deviceTips\"},{systemLimit:t,selectedNum:e}),r)}else\"dataNumExceedLimit\"===p?(0,V.xf)(r.formatMessage({id:\"neteco.pvms.report.export.number.limit\"},{num:P.VS}),r):\"NoMoWhenExportReport\"===p?(0,V.CD)(r.formatMessage({id:\"ncoSiteToolbar.export.noData\"})):f&&(0,V.xf)(r.formatMessage({id:f}),r)})(e,t,n,r,i)},subjectCheck:(t,n,r)=>{(async(e,t,n,r)=>{const{success:i,data:o}=await(0,$.U2)(\"/rest/pvms/web/report/v1/subscribe/check-mail\",{reportId:dn(t)});i||(0,V.xf)(n.formatMessage({id:o})),r(i),e({type:un.bP,payload:i})})(e,t,n,r)}})))((0,a.ZP)(cn)),fn=((0,A.ax)(),\"15%\"),hn=\"13%\",mn=\"12%\",gn=\"10%\",vn=\"10%\";class yn extends i.Component{constructor(e){super(e),this.setTableHeight=tt()((()=>{const e=(0,nt.h)(\".nco-report-container\",277);this.setState({tableHeight:e})}),300),this.onChangePage=(e,t)=>{const{loadNcoEnergyStorageTable:n,searchCondition:r,sortCondition:i,dateType:o,deviceType:a,currentTime:s,stationDn:l,intl:c}=this.props,{statisticTime:u}=r;n({...r,stationDns:l?[l]:[],timeDimension:o,deviceDimension:a,statisticTime:s||u},{page:e,pageSize:t},i,c)},this.handleTableChange=(e,t,n)=>{let{field:r,order:i}=n;const{updateSortCondition:o,searchCondition:a,tableData:s,loadNcoEnergyStorageTable:l,sortCondition:c,dateType:u,deviceType:d,currentTime:p,stationDn:f,intl:h}=this.props,{pageNo:m,pageSize:g}=s,{statisticTime:v}=a;o({sortBy:r||c.sortBy,sortOrder:i?\"descend\":\"ascend\"}),l({...a,stationDns:f?[f]:[],timeDimension:u,deviceDimension:d,statisticTime:p||v},{page:m,pageSize:g},{sortBy:r||c.sortBy,sortOrder:i?\"descend\":\"ascend\"},h)},this.buildTooltipContent=()=>{const{dateType:e,intl:t}=this.props;switch(e){case\"date\":return t.formatMessage({id:\"common.message.report.tip.daily\"});case\"month\":return t.formatMessage({id:\"common.message.report.tip.month.device\"});case\"year\":return t.formatMessage({id:\"common.message.report.tip.year\"});default:return\"\"}},this.getTitleIdByDeviceType=e=>{switch(e){case\"STORAGE_SUBARRAY\":return\"ncoReportContainer.tabs.label.subarray\";case\"STORAGE_CLUSTER\":return\"ncoReportContainer.tabs.label.cluster\";case\"STORAGE_OLD\":return\"ncoReportContainer.tabs.label.energyStorage\";default:return\"ncoReportContainer.tabs.label.storage\"}};const t=!localStorage.getItem(\"firstRenderStorageList\");this.state={firstRenderStorageList:t,tableHeight:523}}componentDidMount(){this.setTableHeight(),window.addEventListener(\"resize\",this.setTableHeight);const{tableData:e,setIsEmptyTable:t}=this.props,{total:n}=e;t(0===n)}componentWillUnmount(){window.removeEventListener(\"resize\",this.setTableHeight)}componentDidUpdate(e){const{searchCondition:t,loadNcoEnergyStorageTable:n,tableData:r,sortCondition:i,dateType:o,deviceType:a,currentTime:s,stationDn:l,intl:c,setIsEmptyTable:u}=this.props,{pageNo:d,pageSize:p,total:f}=r;qe()(t,e.searchCondition)||n({...t,stationDns:l?[l]:[]},{page:1,pageSize:p},i,c),e.dateType===o&&e.currentTime===s&&e.deviceType===a||n({...t,stationDns:l?[l]:[],timeDimension:o,deviceDimension:a,statisticTime:s},{page:1,pageSize:p},i,c),qe()(r,e.tableData)||u(0===f)}componentWillReceiveProps(e,t){const{tableData:n={},stationDn:r}=e,{total:i}=n,{firstRenderStorageList:o}=this.state;i&&o&&!r&&(localStorage&&localStorage.setItem(\"firstRenderStorageList\",\"occupied\"),this.setState({firstRenderStorageList:!1}))}render(){const{tableData:e,sortCondition:t,intl:n,dateType:r,deviceType:i,loading:o,stationDn:a}=this.props,{list:s,total:l,pageNo:c,pageSize:u}=e,{sortBy:d,sortOrder:f}=t,{firstRenderStorageList:h,tableHeight:m}=this.state,g={ellipsis:!0},v=e=>{const t=e||(0,G.q8)(e,0)?Xe()(Number(e),3).toFixed(3):e;return(0,ot.af)(t)},y=[{title:n.formatMessage({id:\"ncoEnergyStorageTable.column.site\"}),dataIndex:\"stationName\",key:\"stationName\",width:fn,...g,render:e=>{var t;return null!==(t=window.neteco.util.iUnescape(e))&&void 0!==t?t:P.lH}},{title:n.formatMessage({id:\"ncoEnergyStorageTable.column.smartlogger\"}),dataIndex:\"owningLogger\",key:\"owningLogger\"===i,width:hn,...g,render:e=>{var t;return null!==(t=window.neteco.util.iUnescape(e))&&void 0!==t?t:P.lH}},{title:n.formatMessage({id:\"ncoEnergyStorageTable.column.energyStorageName\"}),dataIndex:\"owningEss\",key:\"owningEss\",width:mn,...g,render:e=>{var t;return null!==(t=window.neteco.util.iUnescape(e))&&void 0!==t?t:P.lH}},{title:n.formatMessage({id:\"ncoEnergyStorageTable.column.energyStorageRack\"}),dataIndex:\"deviceName\",key:\"deviceName\",width:mn,...g,render:e=>{var t;return null!==(t=window.neteco.util.iUnescape(e))&&void 0!==t?t:P.lH}},{title:n.formatMessage({id:\"ncoEnergyStorageTable.column.chargingCapacity\"}),dataIndex:\"chargeCap\",key:\"chargeCap\",sorter:!0,sortOrder:\"chargeCap\"===d&&f,width:gn,...g,render:e=>{var t;return null!==(t=v(e))&&void 0!==t?t:P.lH}},{title:n.formatMessage({id:\"ncoEnergyStorageTable.column.dischargeDischarge\"}),dataIndex:\"dischargeCap\",key:\"dischargeCap\",sorter:!0,sortOrder:\"dischargeCap\"===d&&f,width:vn,...g,render:e=>{var t;return null!==(t=v(e))&&void 0!==t?t:P.lH}}];return\"STORAGE\"===i&&y.splice(1,3),\"STORAGE_SUBARRAY\"===i&&(y.splice(2,2),y[1].title=n.formatMessage({id:\"ncoEnergyStorageTable.column.smartlogger\"}),y[1].key=\"deviceName\",y[1].dataIndex=\"deviceName\"),\"STORAGE_OLD\"===i&&(y.splice(3,1),y[1].title=n.formatMessage({id:\"neteco.pvms.partials.main.dm.communicateDevName\"}),y[1].key=\"owningLoggerOrDongle\",y[1].dataIndex=\"owningLoggerOrDongle\",y[2].key=\"deviceName\",y[2].dataIndex=\"deviceName\"),(0,_.jsxs)(\"div\",{className:\"nco-energy-storage-table\",children:[(0,_.jsxs)(\"div\",{className:\"nco-energy-storage-table-title\",children:[(0,_.jsx)(p.Z,{id:this.getTitleIdByDeviceType(i)}),(0,_.jsx)(b.Z,{title:this.buildTooltipContent(),children:(0,_.jsx)(We.Z,{className:\"nco-hints-lined\"})})]}),(0,_.jsx)(we.Z,{dataSource:s,columns:y,pagination:!1,loading:o,onChange:this.handleTableChange,rowKey:\"dn\",scroll:{y:m},showSorterTooltip:!1}),(0,_.jsx)(Ce.Z,{totalFixedLeft:!0,total:l,showSizeChanger:!0,showTotal:(0,Te.Z)(n),current:c,pageSize:u,pageSizeOptions:[\"10\",\"20\",\"30\",\"50\",\"100\"],onChange:this.onChangePage})]})}}const bn=yn;var Sn=n(9462);const xn=e=>({type:Sn.T,payload:e}),wn=e=>{switch(e){case\"STORAGE_SUBARRAY\":return 20821;case\"STORAGE_CLUSTER\":return 60014;case\"STORAGE_OLD\":return 20835;default:return 20801}},Cn=(0,d.$j)((e=>({loading:e.ncoMonitorEnergyStorageTable.loading,tableData:e.ncoMonitorEnergyStorageTable.tableData,searchCondition:e.ncoMonitorEnergyStorageSearchBar.searchCondition,sortCondition:e.ncoMonitorEnergyStorageSearchBar.sortCondition})),(e=>({loadNcoEnergyStorageTable:(t,n,r,i)=>{(async(e,t,n,r,i)=>{let{page:o,pageSize:a}=n,{sortBy:s,sortOrder:l}=r;e({type:Sn.M});const{stationDns:c}=t;t.devices&&(1!==t.devices.length||\"/\"!==t.devices[0].moString&&t.devices[0].moString)||(t.devices=[]);const u=t.statisticTime.valueOf(),d=await(0,$.v_)(\"/rest/pvms/web/report/v1/cn/energy-store-kpi-list\",{moList:0!==c.length&&0===t.devices.length?[]:t.devices,stationDn:c.join(\",\"),orderBy:s,page:o,pageSize:a,sort:\"ascend\"===l?\"asc\":\"desc\",statTime:u,statTimeDim:(0,je.Z)(t.timeDimension),timeZone:(0,Le.ZP)(u),mocId:wn(t.deviceDimension)}),{success:p,data:f}=d;if(p)e(xn(f));else if(f&&f.list)e(xn({list:[],total:0,pageNo:1,pageSize:a,pageCount:0}));else if(f&&f.tip){const{systemLimit:e,selectedNum:t}=f;Ze.Z.warning({title:i.formatMessage({id:\"neteco.pvms.info\"}),content:i.formatMessage({id:\"ncoSiteToolbar.selectTooManyMo.deviceTips\"},{systemLimit:e,selectedNum:t})})}})(e,t,n,r,i)},updateSortCondition:t=>{((e,t)=>{e({type:un.MC,payload:t})})(e,t)}})))((0,a.ZP)(bn));n(57031);class Tn extends i.Component{constructor(e){super(e),this.configByDateType=e=>{(0,O.om)(\"STORAGE\",this.state.deviceType,e),this.setState({dateType:e})},this.configByTime=e=>{this.setState({currentTime:e})},this.configByDeviceType=e=>{(0,O.om)(\"STORAGE\",e,this.state.dateType),this.setState({deviceType:e})},this.state={dateType:\"date\",currentTime:u()().startOf(\"day\"),deviceType:\"STORAGE\",isEmptyTable:!0};const{stationDn:t,userCompany:n,parentDn:r}=e;this.startTime=Pt.$.pageAccess(Et.e.stationReport.accessId,{pageName:O.v2.STORAGE,scope:(0,O.a7)(t,n,r)})}componentWillUnmount(){const{stationDn:e,userCompany:t,parentDn:n}=this.props;Pt.$.pageLeave(this.startTime,Et.e.stationReport.leaveId,{pageName:O.v2.STORAGE,scope:(0,O.a7)(e,t,n)})}render(){const{stationDn:e,userCompany:t,selectedTreeNode:n}=this.props,{dateType:r,deviceType:i,currentTime:o}=this.state,a=t.moDn;return(0,_.jsxs)(\"div\",{className:\"nco-energy-storage-report\",children:[(0,_.jsx)(pn,{configByDateType:this.configByDateType,configByTime:this.configByTime,configByDeviceType:this.configByDeviceType,currentTime:o,dateType:r,deviceType:i,stationDn:e,userCompany:t,isAreaAuth:this.props.isAreaAuth,selectedTreeNode:n,isEmptyTable:this.state.isEmptyTable}),(0,_.jsx)(Cn,{currentTime:o,dateType:r,deviceType:i,stationDn:e,userCompany:a,setIsEmptyTable:e=>{this.setState({isEmptyTable:e})}})]})}}const An=Tn;var En=n(5807);const{TabPane:On}=r.Z;class Mn extends i.Component{constructor(e){var t;super(e),this.changeTabHandler=e=>{this.props.onChildTabChange&&this.props.onChildTabChange(e),this.setState({activeTab:e,deviceType:e.toUpperCase()})};const{companyDn:n,match:r}=e;this.state={userCompany:{moDn:n},activeTab:null==r||null===(t=r.params)||void 0===t?void 0:t.activeTab,deviceType:\"\",isAreaAuth:!1}}componentDidMount(){En.Z.getCurrentCompany().then((e=>{var t;(0,G.xb)(e)||this.setState({isAreaAuth:(null==e||null===(t=e.areaList)||void 0===t?void 0:t.length)>0})}))}componentDidUpdate(e){const{urlParams:t={},companyDn:n,stationDn:r}=e,{urlParams:i={},companyDn:o,stationDn:a}=this.props;if(t.url!==i.url){const{params:e={}}=i;this.setState({activeTab:e.activeTab,deviceType:e.activeTab?e.activeTab.toUpperCase():\"\"})}n!==o&&this.setState({userCompany:{moDn:o}}),r!==a&&this.setState({reload:!1},(()=>{this.setState({reload:!0})}))}render(){const{tabKeys:e}=l.D.companyReport,{intl:t,stationDn:n,isFromSubmatrix:i,parentDn:o,selectedTreeNode:a}=this.props,{userCompany:c,activeTab:u,isAreaAuth:d}=this.state,p=u?{activeKey:u}:{};return(0,_.jsx)(\"div\",{className:(0,s.Z)(\"nco-report-container\",\"aui-tabs\"),children:(0,_.jsxs)(r.Z,{...p,onChange:this.changeTabHandler,destroyInactiveTabPane:!0,children:[(0,B.lVp)(B.nKO)&&!i&&(0,_.jsx)(On,{tab:t.formatMessage({id:\"ncoReportContainer.tabs.label.site\"}),children:(0,_.jsx)(\"div\",{className:\"nco-report-tab-container\",children:(0,_.jsx)(It,{userCompany:c,stationDn:n,parentDn:o,isAreaAuth:d,selectedTreeNode:a})})},e.site),(0,B.lVp)(B.n0c)&&(0,_.jsx)(On,{tab:t.formatMessage({id:\"ncoReportContainer.tabs.label.inverter\"}),children:(0,_.jsx)(\"div\",{className:\"nco-report-tab-container\",children:u===e.inverter&&(0,_.jsx)(tn,{deviceType:this.state.deviceType,userCompany:c,stationDn:n,parentDn:o,isAreaAuth:d,selectedTreeNode:a})})},e.inverter),(0,B.lVp)(B.PyK)&&(0,_.jsx)(On,{tab:t.formatMessage({id:\"ncoReportContainer.tabs.label.pcs\"}),children:(0,_.jsx)(\"div\",{className:\"nco-report-tab-container\",children:u===e.pcs&&(0,_.jsx)(tn,{deviceType:this.state.deviceType,userCompany:c,stationDn:n,parentDn:o,isAreaAuth:d,selectedTreeNode:a})})},e.pcs),(0,B.lVp)(B.IGc)&&(0,_.jsx)(On,{tab:t.formatMessage({id:\"ncoReportContainer.tabs.label.energyStorage\"}),children:(0,_.jsx)(\"div\",{className:\"nco-report-tab-container\",children:(0,_.jsx)(An,{userCompany:c,stationDn:n,parentDn:o,isAreaAuth:d,selectedTreeNode:a})})},e.storage)]})})}}const Pn=(0,o.EN)((0,a.ZP)(Mn))},19073:(e,t,n)=>{\"use strict\";n.d(t,{MC:()=>a,Mb:()=>r,T_:()=>i,Z8:()=>l,bP:()=>s,lK:()=>c,mk:()=>o});const r=\"NCOMONITORSITESEARCHBAR/START_LOADING\",i=\"NCOMONITORSITESEARCHBAR/FINISH_LOADING\",o=\"NCOMONITORSITESEARCHBAR/UPDATE_SEARCH_CONDITION\",a=\"NCOMONITORSITESEARCHBAR/UPDATE_SORT_CONDITION\",s=\"NCOMONITORSITESEARCHBAR/SUBJECT_CHECK\",l=\"NCOMONITORSITESEARCHBAR/CLEAR_SEARCH_CONDITION\",c=\"NCOMONITORSITESEARCHBAR/CHANGE_EXPORT_LOADING\"},19578:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>l});var r=n(37920),i=n.n(r),o=n(4342),a=n(19073);const s={loading:!1,exportLoading:!1,isShowModal:!1,searchCondition:{sites:[],statisticMethod:(0,o.ux)()?\"bySite\":\"byTime\",timeDimension:\"date\",statisticTime:i()().startOf(\"day\"),refreshTime:i()()},sortCondition:{sortBy:(0,o.ux)()?\"productPower\":\"fmtCollectTimeStr\",sortOrder:\"ascend\"}},l=(e,t)=>{const n=null!=e?e:s;switch(t.type){case a.Mb:return{...n,loading:!0};case a.mk:return{...n,searchCondition:t.payload};case a.MC:return{...n,sortCondition:t.payload};case a.bP:return{...n,isShowModal:t.payload};case a.Z8:return{...n,searchCondition:{sites:[],statisticMethod:(0,o.ux)()?\"bySite\":\"byTime\",timeDimension:\"date\",statisticTime:i()().startOf(\"day\")}};case a.lK:return{...n,exportLoading:t.payload};case a.T_:return{...n,loading:!0,amount:t.payload};default:return n}}},98937:(e,t,n)=>{\"use strict\";n.d(t,{H_:()=>o,Mb:()=>r,T_:()=>i});const r=\"NCOMONITORSITETABLE/START_LOADING\",i=\"NCOMONITORSITETABLE/FINISH_LOADING\",o=\"NCOMONITORSITETABLE/CLEAR_TABLE_LIST\"},75006:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>o});var r=n(98937);const i={loading:!1,tableData:{list:[],hasMeter:!0,total:0,pageNo:1,pageSize:10,pageCount:0}},o=(e,t)=>{const n=null!=e?e:i;switch(t.type){case r.Mb:return{...n,loading:!0};case r.H_:return{...i};case r.T_:return{...n,loading:!1,tableData:t.payload};default:return n}}},40737:(e,t,n)=>{\"use strict\";n.d(t,{Mb:()=>r,R4:()=>o,T_:()=>i});const r=\"NCOMONITORSUBJECTREPORTTABLE/START_LOADING\",i=\"NCOMONITORSUBJECTREPORTTABLE/FINISH_LOADING\",o=\"NCOMONITORSUBJECTREPORTTABLE/RESET_REDUCER\"},69699:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>o});var r=n(40737);const i={loading:!1,tableData:[],total:0,pageNo:1,pageSize:10,pageCount:0},o=(e,t)=>{const n=null!=e?e:i;switch(t.type){case r.Mb:return{...n,loading:!0};case r.T_:return{...n,loading:!1,tableData:t.payload.list||[],total:t.payload.total,pageNo:t.payload.pageNo,pageSize:t.payload.pageSize,pageCount:t.payload.pageCount};case r.R4:return{...n,tableData:[]};default:return n}}},70336:(e,t,n)=>{\"use strict\";n.d(t,{Mb:()=>r,SK:()=>o,T_:()=>i});const r=\"NCOMONITORSUBJECTREPORTTOOLBAR/START_LOADING\",i=\"NCOMONITORSUBJECTREPORTTOOLBAR/FINISH_LOADING\",o=\"NCOMONITORSUBJECTREPORTTOOLBAR/UPDATE_LANGUAGE\"},96624:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>o});var r=n(70336);const i={loading:!1,language:\"zh_CN\",record:{}},o=(e,t)=>{const n=null!=e?e:i;switch(t.type){case r.Mb:return{...n,loading:!0};case r.T_:return{...n,loading:!1,record:t.payload};case r.SK:return{...n,language:t.payload};default:return n}}},47603:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>f});var r=n(88391),i=n(93706),o=n(91987),a=n(11854),s=n(37920),l=n.n(s),c=n(26438),u=n(23712);const{RangePicker:d}=o.Z;class p extends r.Component{constructor(e){var t,n,r;super(e),this.getDateTabKey=e=>{const{onChangeTime:t}=this.props,n=e===c.NT.key?c.oP.key:e;t({period:e,startTime:l()().startOf(n).valueOf(),endTime:l()().endOf(n).valueOf()}),this.setState({period:e,startTime:l()(),dates:[l()(),l()()]})},this.getTimeValue=e=>{const{onChangeTime:t}=this.props,{period:n}=this.state,r=n===c.NT.key?c.oP.key:n,i={period:n,startTime:l()(e).startOf(r).valueOf(),endTime:l()(e).endOf(r).valueOf()};this.setState({startTime:e}),t(i)},this.getRangeTime=e=>{const{onChangeTime:t}=this.props;e&&t({startTime:l()(e[0]).valueOf(),endTime:l()(e[1]).valueOf(),period:this.state.period}),this.setState({dates:e})},this.disabledDate=e=>{const{dates:t}=this.state;if(!t||!this.props.timeFrame)return!1;const n=t[0]&&e.diff(t[0],\"days\")>this.props.timeFrame;return!!(t[1]&&t[1].diff(e,\"days\")>this.props.timeFrame)||!!n},this.state={period:(null===(t=this.props.time)||void 0===t?void 0:t.period)||c.x4.key,startTime:(null===(n=this.props.time)||void 0===n?void 0:n.startTime)||l()(),endTime:(null===(r=this.props.time)||void 0===r?void 0:r.endTime)||l()(),dates:[l()(),l()()]}}render(){const{dimStyle:e=[],intl:t,showDatePicker:n=!0,showTime:r=!1}=this.props,i=e.find((e=>e.key===this.state.period)).picker;return(0,u.jsxs)(\"div\",{className:\"nco-date-switch\",style:{display:\"flex\"},children:[(0,u.jsx)(\"div\",{className:\"nco-date-switch-tabs\",style:{marginRight:\"1rem\"},children:(0,u.jsx)(a.Z,{type:\"capsule\",items:e.map((e=>({label:t.formatMessage({id:e.label}),key:e.key,children:null}))),onChange:this.getDateTabKey})}),n&&(0,u.jsx)(\"div\",{className:\"nco-date-switch-date-picker\",children:this.state.period!==c.rx.key?(0,u.jsx)(o.Z,{picker:i,value:this.state.startTime,onChange:this.getTimeValue}):(0,u.jsx)(d,{onCalendarChange:this.getRangeTime,value:this.state.dates,disabledDate:this.disabledDate,showTime:r,picker:i})})]})}}const f=(0,i.ZP)(p)},4911:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>s});var r=n(88391),i=n(93706),o=n(23712);class a extends r.Component{render(){const{intl:e}=this.props;return(0,o.jsx)(\"div\",{className:\"nco-monitor-battery-cluster-container page-wrapper\",children:(0,o.jsx)(\"div\",{className:\"tab-content flex-wrapper\",children:(0,o.jsx)(\"div\",{className:\"content\",children:(0,o.jsx)(\"div\",{className:\"flex-wrapper\",style:{paddingRight:\"1rem\",flex:1},children:(0,o.jsxs)(\"div\",{style:{backgroundColor:\"#fff\",flex:1,alignContent:\"center\"},children:[(0,o.jsx)(\"img\",{src:\"data:image/png;base64,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\",alt:\"\"}),(0,o.jsx)(\"h1\",{children:e.formatMessage({id:\"neteco.pvms.ajax.noFound.1\"})})]})})})})})}}const s=(0,i.ZP)(a)},346:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>g});var r=n(83862),i=n(88391),o=n(91987),a=n(17249),s=n(92252),l=n(37920),c=n.n(l),u=n(66915),d=n(23712);const p=(e,t)=>{const n=[];for(let r=c()().get(\"year\")+e;r>=t;r-=1)n.push(r);return n};class f extends i.Component{constructor(e){super(e),this.changeYearHandler=e=>{const{onChange:t}=this.props;t&&t(c()().set(\"year\",e).startOf(\"year\"))},this.state={}}render(){const{futureNum:e,minYear:t,value:n,disabled:r,width:i,autoFocus:o=!0,isNewStyle:a}=this.props,l=a?u.Z:s.Z;return(0,d.jsx)(l,{value:n&&n.get(\"year\"),onChange:this.changeYearHandler,style:{width:i||\"7rem\"},disabled:r,virtual:!1,autoFocus:o,getPopupContainer:e=>e.parentNode||document.body,children:p(e,t).map((e=>(0,d.jsx)(l.Option,{value:e,children:(0,d.jsx)(\"div\",{title:e,children:e})},e)))})}}f.defaultProps={minYear:2010,futureNum:3};const h=f;class m extends i.Component{constructor(e){super(e),this.state={}}render(){const{timeDimension:e,isNewStyle:t}=this.props,n=\"lifetime\"===e?\"year\":e,i=t?o.Z:r.Z;return\"year\"===n||\"lifetime\"===n?(0,d.jsx)(h,{isNewStyle:t,...this.props}):\"month\"===n?(0,d.jsx)(i,{format:(0,a.Z)(\"FORMAT_YYYY_MM\"),...this.props,picker:\"month\",allowClear:!1,style:{width:this.props.width}}):(0,d.jsx)(i,{format:(0,a.Z)(\"FORMAT_YYYY_MM_DD\"),picker:\"date\",...this.props,allowClear:!1,style:{width:this.props.width}})}}const g=m},97809:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>a}),n(88391);var r=n(3746),i=n(23712);const o=[\"dcdc\",\"inverter\",\"pcs\"],a=e=>{let{title:t,form:n,deviceStatus:a,status:s}=e;const l=null!=a?a:s,c=(0,r.V_)(null==l?void 0:l.toLowerCase());return(0,i.jsx)(\"div\",{className:\"nco-status\",children:(0,i.jsx)(\"div\",{className:\"status-point \"+(o.includes(n)?\"small\":\"big\"),title:t,style:{backgroundColor:c}})})}},19330:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>u});var r=n(88391),i=n(43323),o=n(51523),a=n.n(o),s=n(10749),l=n(23712);const{updateSubmatrixCanvas:c}=s.Z,u=e=>{const t=(0,r.useRef)(null),n=new i.Z(new window.twaver.ElementBox),o=()=>{t&&t.current&&(n.adjustBounds({x:0,y:0,width:t.current.clientWidth,height:t.current.clientHeight}),n.resizeHandler&&n.resizeHandler(t,e))};return(0,r.useEffect)((()=>{n.setDataLoader(e.dataLoaderClass,e.intl,e.apiParams,e.subscriptionTime)}),[JSON.stringify(e.apiParams)]),(0,r.useEffect)((()=>{n._draw=!0,n.installEnhancers(e.enhancerClasses,e.intl,e.apiParams),e.handlers&&n.setInteractionhandlers(e.handlers),n._isCreateLink=!1,n.setRealtimeDataManager(e.realtimeDataManagerClass),t.current.appendChild(n.getView()),n.adjustBounds({x:0,y:0,width:t.current.clientWidth,height:t.current.clientHeight});const r=()=>{n.getView().style.cursor=\"default\"};return n.getView().addEventListener(\"mousedown\",r),window.addEventListener(\"resize\",o),c.subscribe((()=>{setTimeout((()=>{t&&t.current&&(o(),n._view.parentElement.style={width:t.current.clientWidth,height:t.current.clientHeight})}),10)})),window.testNetwork=n,setTimeout(o,500),()=>{n.getElementBox().clear(),n.getDataLoader().clearTimer(),window.removeEventListener(\"resize\",o),n.getView().removeEventListener(\"mousedown\",r),window.twaver.Util.getToolTipDiv().remove(),delete window.testNetwork}}),[]),(0,r.useEffect)((()=>{let e;return t.current&&(e=new ResizeObserver((e=>{const t=e[0];null!=t&&t.target&&a()(o,500)()})),e.observe(t.current,{box:\"content-box\"})),()=>{e=null}}),[t.current]),(0,l.jsx)(\"div\",{ref:t,className:\"tw-view\"})}},43346:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>u});var r=n(83862),i=(n(88391),n(12048)),o=n(97435),a=n(37920),s=n.n(a),l=n(3746),c=n(23712);const u=e=>{let{intl:t,loading:n=!1,currentTime:a,curPeriod:u=\"days\",clickEvent:d,datePickerOnchange:p,...f}=e;const h=e=>{if(n)return!1;let t=s()(a).add(e,u);d(t)};return(0,c.jsxs)(\"div\",{className:\"nco-DatePick-forwardOrNextDay\",children:[(0,c.jsx)(i.Z,{title:t.formatMessage({id:\"neteco.pvms.power.lastDay\"}),className:n?\"nco-power-and-profit-datetime-arrow-disabled\":\"nco-power-and-profit-datetime-arrow\",onClick:()=>h(l.qY.FORWARD)}),(0,c.jsx)(r.Z,{value:a,allowClear:!1,className:\"nco-DatePicker\",...f}),(0,c.jsx)(o.Z,{title:t.formatMessage({id:\"neteco.pvms.power.nextDay\"}),className:n?\"nco-power-and-profit-datetime-arrow-disabled\":\"nco-power-and-profit-datetime-arrow\",onClick:()=>h(l.qY.NEXT)})]})}},15285:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>re});var r=n(23774),i=n(93706),o=n(88391),a=n(34428),s=n(90701),l=n(29266),c=n(41541),u=n(41779),d=n(45258),p=n(54568),f=n(37825),h=n(10749),m=n(59516),g=n(31251),v=n(64218),y=n(16910),b=n(95059),S=n(49100),x=n(39121),w=n(78939),C=n(9490),T=n(53137),A=n(5083),E=n(49453),O=n(50832),M=n(17432),P=n(94173),D=n(44184),I=n(13051),N=n(69131),_=n(13388),j=n(23712);const{configAndRefresh:k,refreshTouParam:L,reloadPvTableDataSubject:R}=h.Z,{operationFailed:Z,operationSuccess:B,operationWarn:F,operationConfirm:z}=b.Z,{neteco:V}=window,H=[20822,20819,20821,20851],U=230700176,G=230190116;class Y extends o.Component{constructor(e){super(e),this.getselectedNodes=e=>{this.setState({selectedNodes:e})},this.showPasswordModal=()=>{this.setState({shouldShowPasswordModal:!0})},this.closePasswordModal=()=>{this.setState({shouldShowPasswordModal:!1})},this.setDiState=(e,t)=>{const{isDiState:n}=this.state;let r=[...n];r[e]=t,this.setState({isDiState:r})},this.touchForm=(e,t)=>{if(this.setState({isFormTouched:\"jpTou\"!==t}),!e)return;const{changedList:n}=this.state,{id:r,value:i}=e;return void 0!==r&&void 0!==i&&n.set(r,i),!0},this.updateCurrentSignalConfig=e=>{0===this.initSignalFieldMap.size&&e.forEach((e=>{let{id:t,value:n}=e;\"FLOAT\"===e.dataType&&(n=isNaN(Number(n))||\"\"===String(n).trim()||(0,D.le)(n)?n:String(Number(n))),this.initSignalFieldMap.set(Number(t),n)})),e.forEach((e=>{let{id:t,value:n}=e;\"FLOAT\"===e.dataType&&(n=isNaN(Number(n))||\"\"===String(n).trim()||(0,D.le)(n)?n:String(Number(n))),this.dynamicSignalFieldsMap.set(Number(t),n)}))},this.getMoDetail=e=>new Promise((t=>{(0,E.Sg)(\"/rest/pvms/web/device/v1/mo-details\",{dn:e},18e4).then((e=>{const{success:n,data:r}=e;if(n){const{mo:e}=r,{typeId:n,versionId:i}=e;t({typeId:n,versionId:i})}else t({})})).catch((()=>{t({})}))})),this.resetFields=()=>{this.formRef.current&&this.formRef.current.resetFields()},this.showBatchModal=async()=>{const{checkIsDisclaimer:e}=this.props;await e()?this.setState({shouldShowBatchModal:!0}):this.setState({disclaimerVisible:!0,disclaimerNext:\"showBatchModal\"})},this.onSingleSubmit=async()=>{const{selectedRows:e}=this.state,{checkIsDisclaimer:t}=this.props;await t()?this.onSubmit(e.map((e=>({dn:e.dn,name:e.name}))),this.finishConfiguring,this.startConfiguring):this.setState({disclaimerVisible:!0,disclaimerNext:\"onSingleSubmit\"})},this.startConfiguring=()=>{this.setState({isConfiguring:!0})},this.finishConfiguring=()=>{this.setState({isConfiguring:!1})},this.onBatchSubmit=()=>{const{intl:e,finishBatchConfiguring:t,startBatchConfiguring:n}=this.props,{selectedNodes:r,selectedRows:i,isBatchClick:o}=this.state;if(r.length<1)return F(e,e.formatMessage({id:\"neteco.pvms.devEms.esnSel\"}));if(i[0].mocId!==r[0].moType)return F(e,e.formatMessage({id:\"neteco.pvms.partials.main.dm.mustSameTypeDevice\"}));const a=r[0].moString;if(a.split(\",\").length>50)return F(e,e.formatMessage({id:\"neteco.pvms.setting.data.repair.seleted.device.more50\"}));this.closeBatchModal(),o&&(this.setState({isBatchClick:!1}),-1!==a.indexOf(i[0].dn)?this.onSubmit(r.map((e=>({dn:e.moString}))),t,n):this.onSubmit(r.map((e=>({dn:`${e.moString},${i[0].dn}`}))),t,n)),setTimeout((()=>{this.setState({isBatchClick:!0})}),1e3)},this.closeBatchModal=()=>{this.setState({shouldShowBatchModal:!1})},this.startConfiguring=()=>{this.setState({isConfiguring:!0})},this.finishConfiguring=()=>{this.setState({isConfiguring:!1})},this.getNeedAuthSignals=e=>e&&e.length?e.map((e=>e.signals)).flat().filter((e=>e.needAuth)):[],this.onSubmit=(e,t,n)=>{const{intl:r,configSignalGroups:i,deviceTypesWithConfigSignals:o}=this.props,a=this.formRef.current,{selectedRows:s,freshState:l}=this.state,c=this.getStationDn(),{reactChainValuesMap:u,errorIdList:d,changedList:f,groups:h}=this.state,m=[...u.entries()],g=Object.fromEntries(m);if(s.findIndex((e=>\"Connected\"!==e.status))>=0)return void F(r,r.formatMessage({id:\"neteco.pvms.device.status.down.information\"}));if(!l)return this.initSignalFieldMap=new Map,void B(r,r.formatMessage({id:\"neteco.pvms.partials.main.dm.devParamMenu.refreshBtn.tip\"}));if(d.size>0)return;const{validateFields:v,getFieldsValue:y}=a,b=[t,()=>{u.clear(),f.clear(),this.setState({isFormTouched:!1}),this.refresh(!0,!1,!1),B(r,r.formatMessage({id:\"neteco.pvms.device.config.noDataChange\"}))}];n&&n();const S=[],x=y();for(const e in x)Object.prototype.hasOwnProperty.call(x,e)&&a.isFieldTouched(e)&&!(0,p.mo)({id:e})&&S.push(e);const w=new Map;h.forEach((e=>{const{signals:t}=e;Array.isArray(t)&&t.forEach((e=>{f.has(e.id)&&w.set(e.id,f.get(e.id))}))})),v([...new Set([...w.keys(),...S])].filter((e=>void 0!==a.getFieldValue(e)))).then((n=>{const s={...n,...g,...Object.fromEntries([...f.entries()].filter((e=>void 0!==e[1])))},l=this.compareSignalValues(s);if((0,C.isEmptyObject)(l))return void b.forEach((e=>e()));let d=r.formatMessage({id:\"neteco.pvms.partials.main.dm.devControlDialog.doItSuc\"});[230222696,230102696,230680514,230390403].find((e=>e in l))&&(d=r.formatMessage({id:\"neteco.pvms.powerSettings.curve.adjustment\"})),i({rows:e,changeValues:l,callbacks:{okCallbacks:[t,()=>{this.initSignalFields(l),u.clear(),f.clear(),this.setState({isFormTouched:!1}),this.refresh(!0,!1,!1),B(r,d,null)}],batchCallbacks:[this.closeBatchModal,t,()=>{this.initSignalFields(l);const{reactChainValuesMap:e}=this.state;this.refresh(!0,!1,!1),e.clear(),f.clear(),this.setState({isFormTouched:!1})},e=>{e?this.dealResultDlgInfo(r,e):Z(r)}],failCallbacks:[t,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e){var n;const i=Object.entries((null===(n=e[0].data)||void 0===n?void 0:n.data)||{});if(i.length>0){const e=t.length,n=i.map((e=>`${e[1]}`)).find((e=>e)),o=r.formatMessage({id:n}),a=e>1?r.formatMessage({id:\"nco.pvms.device.configSignals.partial.failure\"},{0:o}):o;Z(r,a)}else Z(r)}else Z(r)}]},form:a,checkPwd:{intl:r,callback:t,needAuthSignals:this.getNeedAuthSignals(o[0].groups)},initSignalMap:this.initSignalFieldMap,plantDn:c})})).catch((()=>{const e=document.querySelector(\".ant-input-number-status-error\");e&&e.scrollIntoView({behavior:\"smooth\"}),t&&t()})),setTimeout((()=>{t()}),18e4)},this.compareSignalValues=e=>{const{hiddenDI4:t}=this.state,n={};let r=null;if(Object.keys(e).forEach((t=>{const r=e[t],i=isNaN(Number(t))?Number(t.replace(/[^\\d]/g,\"\")):Number(t),o=this.initSignalFieldMap.get(i);this.dynamicSignalFieldsMap.has(i)&&o!==r&&(n[i]=r)})),(this.dynamicSignalFieldsMap.has(U)||n[230700176])&&(r=U),(this.dynamicSignalFieldsMap.has(G)||n[230190116])&&(r=G),\"1\"===n[22109]&&!n[r]){const e=this.dynamicSignalFieldsMap.get(r);r&&e&&(n[r]=e)}if(t&&n[r]){const e=JSON.parse(n[r]).map((e=>({...e,di4:0})));n[r]=JSON.stringify(e)}return n},this.setCurrentTypeTab=e=>{this.setState({currentTypeTabKey:e})},this.dealResultDlgInfo=(e,t)=>d.Z.info({title:e.formatMessage({id:\"neteco.pvms.partials.main.io.dm.heads.dealResult\"}),content:this.dealResultContent(t,e),onOk:f.mz}),this.dealResultContent=(e,t)=>(0,j.jsx)(\"div\",{children:null==e?void 0:e.map((e=>{var n;if(0===e.code)return(0,j.jsx)(\"p\",{children:`${V.util.iUnescape(e.data.name)}:${t.formatMessage({id:\"neteco.pvms.partials.main.dm.devControlDialog.doItSuc\"})}`});const r=Object.entries((null==e||null===(n=e.data)||void 0===n?void 0:n.data)||{}),i=r.length>0?`:${t.formatMessage({id:r[0][1]})}  `:\"\";return(0,j.jsx)(\"p\",{style:{color:\"red\"},children:V.util.iUnescape(e.data.name)+i+t.formatMessage({id:\"neteco.pvms.partials.main.dm.devControlDialog.doItFail\"})})}))}),this.initSignalFields=e=>{Object.keys(e).forEach((t=>{this.dynamicSignalFieldsMap.set(Number(t),e[t])})),this.initSignalFieldMap=this.dynamicSignalFieldsMap},this.getStationDn=()=>{var e;let t=(null===(e=this.props)||void 0===e?void 0:e.selectedTreeNode)||{};for(;t;){const{mocId:e,elementDn:n}=t;if((0,v.jE)(e))return n;t=t.parentNode}},this.createLeftTabs=e=>{const{intl:t}=this.props,n=this.formRef.current,{selectedRows:r,hiddenDI4:i}=this.state,[o]=r,{mocId:a}=o,[s={}]=r,{dn:l}=s;this.setState({groups:e});const c={isFormTouched:this.state.isFormTouched,touchForm:this.touchForm,setDiState:this.setDiState},d=this.getStationDn();return e&&0!==e.length?(0,j.jsx)(\"div\",{className:\"form-items-wrapper\",children:e.map(((o,s)=>(0,j.jsxs)(\"div\",{children:[(0,j.jsx)(\"div\",{className:\"config-list-group-name\",children:V.util.iUnescape(o.name)}),(0,M.Z)({form:n,signals:o.signals,intl:t,formTouchConfig:c,mocId:a,dn:l,groups:e,stationDn:d,selectedRows:r,hiddenDI4:i}),s<o.length-1&&(0,j.jsx)(u.Z,{})]},s)))}):null},this.startRefresh=()=>{this.setState({isRefreshing:!0})},this.stopRefresh=()=>{this.setState({isRefreshing:!1})},this.refresh=(e,t,n)=>{const r=null!=e&&e,{loadNcoDevicePropConfigModal:i,intl:o}=this.props,{selectedRows:a,isFirstRefresh:s}=this.state;if(a.findIndex((e=>\"Connected\"!==e.status))>=0)return!s&&F(o,o.formatMessage({id:\"neteco.pvms.device.status.down.information\"})),void this.setState({isFirstRefresh:!1});const[l={}]=a,{dn:c,dnId:u}=l,d=u+`${(new Date).getTime()}`;r&&this.startRefresh();const p=()=>{const{reactChainValuesMap:e,changedList:n,isFirstRefresh:o,errorIdList:s}=this.state;r&&i(a,{},{failCallbacks:[()=>{this.stopRefresh(),this.setState({isFirstRefresh:!1})}],okCallbacks:[()=>{this.stopRefresh(),r&&(t&&L.next(),e.clear(),n.clear(),this.setState({isFormTouched:!1}),s.clear())},()=>{o&&this.setState({isFirstRefresh:!1})}]})};r&&this.props.refreshConfigSignal(c,d,n,(e=>{if(e){const{code:t,data:n}=e;0===t?(this.initSignalFieldMap=new Map,(0,y.Nu)(\"fresh_state\",{serialNumber:d,refreshCallback:p}),this.freshStateTimer=setTimeout((()=>{D.B7&&D.B7.clearInterval(),this.setState({freshState:!0,isFirstRefresh:!1})}),6e4),this.firstRefreshTimer=setTimeout((()=>{this.setState({isFirstRefresh:!1})}),1e4)):(this.stopRefresh(),this.setState({isFirstRefresh:!1}),Z(o,o.formatMessage({id:\"neteco.pvms.partials.main.dm.devParamMenu.refreshFail\"})))}else this.setState({isFirstRefresh:!1}),Z(o,o.formatMessage({id:\"NETECO_IMODBUS_FILE_TRANSING\"}))}))},this.getFreshStatus=async(e,t)=>{const n=await(0,I.ty)(e);n&&(t(),D.B7.clearInterval(),clearTimeout(this.freshStateTimer)),this.setState({freshState:n})},this.handleCancel=()=>{this.setState({disclaimerVisible:!1})},this.loadingSubmit=()=>{const{loading:e}=this.props;return e?this.loadConfigTimeOut&&this.loadingSubmitNumber>=40?(this.loadingSubmitNumber=0,void(this.loadConfigTimeOut=null)):(this.loadConfigTimeOut=setTimeout((()=>{this.loadingSubmit()}),200),void this.loadingSubmitNumber++):(this.onSingleSubmit(),this.loadingSubmitNumber=0,void(this.loadConfigTimeOut=null))},this.handleOk=async()=>{const{updateDisclaimer:e}=this.props,{success:t,data:n}=await e();if(t&&n){this.setState({disclaimerVisible:!1});const{disclaimerNext:e}=this.state;\"showBatchModal\"===e?this.showBatchModal():this.loadingSubmit()}},this.getDisclaimer=e=>{const t=f.H0.includes((0,g.rC)())?\"neteco.pvms.device.set.params.disclaimer\":\"neteco.pvms.device.set.params.disclaimer.park\";return e.formatMessage({id:t}).split(\"#\").map(((e,t)=>(0,j.jsx)(\"p\",{children:e},t)))},this.agreePrecautions=e=>{this.setState({confirmBtnDisabled:!e.target.checked})},this.formRef=(0,o.createRef)();const{selectedRows:t=[]}=this.props,n=[...t];this.state={currentTypeTabKey:void 0,groups:[],errorIdList:new Set([]),shouldShowPasswordModal:!1,reactChainValuesMap:new Map,changedList:new Map([]),selectedRows:n.length>0?n:[{}],isFirstRefresh:!0,shouldShowBatchModal:!1,selectedNodes:[],isBatchClick:!0,typeId:void 0,isDiState:[!0,!0],versionId:void 0,isInSharedStation:!1,disclaimerVisible:!1,confirmBtnDisabled:!0,disclaimerNext:\"\",isConfiguring:!1,freshState:!0,hiddenDI4:!1},this.loadingSubmitNumber=0,this.loadConfigTimeOut=null}refreshForm(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.dynamicSignalFieldsMap=new Map;const t=[],{selectedRows:n,changedList:r}=this.state,[i]=n,{mocId:o}=i;e.forEach((e=>{e.groups.map((e=>(0,y.lW)(e.signals,o))).forEach((e=>t.push(...e)))})),this.updateCurrentSignalConfig(t);const a=new Map([...r].filter((e=>{let[t,n]=e;return this.dynamicSignalFieldsMap.has(Number(t))})));this.setState({hiddenDI4:\"1\"===this.dynamicSignalFieldsMap.get(22109),changedList:a,formContent:e.map((e=>(0,j.jsx)(\"div\",{children:this.createLeftTabs(e.groups)},e.type)))})}componentDidMount(){const{loadNcoDevicePropConfigModal:e,hide:t,intl:n,selectedTreeNode:r={}}=this.props,{elementDn:i}=r,{selectedRows:o}=this.state;this.initSignalFieldMap=new Map,e(o,{},{okCallbacks:[()=>{this.refresh(!0,!1,!0)}],failCallbacks:[()=>{t&&t(),Z(n,n.formatMessage({id:\"neteco.pvms.device.management.not_exists\"}),(()=>{R.next()}))}]}),i&&((0,T.PW)(i).then((e=>{const{success:t,data:n}=e;t&&this.setState({isInSharedStation:n})})),this.getMoDetail(i).then((e=>{const{typeId:t,versionId:n}=e;this.setState({typeId:t,versionId:n})}))),this.reloadNcoDevicePropCallback=e=>{var t,n;let{detail:r}=e;r.dn===(null===(t=this.state.selectedRows[0])||void 0===t?void 0:t.dn)&&(this.refreshForm(r.deviceTypesWithConfigSignals),null===(n=this.formRef.current)||void 0===n||n.validateFields())},this.changeDevicePasswdCallback=()=>{z(n,n.formatMessage({id:\"neteco.pvms.deviceChangePwd.confirm\"}),(()=>{this.showPasswordModal()}))},this.addChainValueCallback=t=>{let{detail:n}=t;const{sig:r={},value:i,shouldReload:a=!1}=n,{id:s}=r,{reactChainValuesMap:l}=this.state;if(l.set(s,i),a){const t=new Map;[...l.entries()].forEach((e=>{t.set(String(e[0]),{id:e[0],value:e[1]})}));const{changedList:n=new Map([])}=this.state;[...n.keys()].forEach((e=>{n.get(e)&&\"null\"!==n.get(e)&&t.set(String(e),{id:e,value:n.get(e)})})),t.set(s,{id:s,value:i});const r=JSON.stringify([...t.values()]);e(o,{changeParam:r})}},this.refreshStashedValueCallback=e=>{let{detail:t}=e;const{signal:n={},newValue:r}=t,{id:i}=n,{reactChainValuesMap:o}=this.state;o.has(i)&&o.set(i,r)},this.freshStateStatusCallback=e=>{let{detail:t}=e;const{serialNumber:n,refreshCallback:r}=t;D.B7.setInterval((()=>this.getFreshStatus(n,r)),N.v.devicePropConfigModal_getFreshStatus)},this.changeFormUncontrolledError=e=>{let{detail:t}=e;const{signalId:n,remove:r=!1}=t;void 0!==n&&(r?this.state.errorIdList.delete(n):this.state.errorIdList.add(n))},window.addEventListener(\"change_form_uncontrolled_error\",this.changeFormUncontrolledError),window.addEventListener(\"reload_nco_device_prop\",this.reloadNcoDevicePropCallback),window.addEventListener(\"change_device_password\",this.changeDevicePasswdCallback),window.addEventListener(\"add_chain_value\",this.addChainValueCallback),window.addEventListener(\"refresh_stashed_value\",this.refreshStashedValueCallback),window.addEventListener(\"fresh_state\",this.freshStateStatusCallback),this.configAndRefreshSub=k.subscribe((async t=>{let{id:n,value:r}=t;this.resetFields();const i=JSON.stringify([{id:n,value:r}]);e(o,{changeParam:i})}))}componentWillUnmount(){d.Z.destroyAll(),this.configAndRefreshSub&&this.configAndRefreshSub.unsubscribe(),this.reloadNcoDevicePropCallback&&window.removeEventListener(\"reload_nco_device_prop\",this.reloadNcoDevicePropCallback),this.changeDevicePasswdCallback&&window.removeEventListener(\"change_device_password\",this.changeDevicePasswdCallback),this.addChainValueCallback&&window.removeEventListener(\"add_chain_value\",this.addChainValueCallback),this.refreshStashedValueCallback&&window.removeEventListener(\"refresh_stashed_value\",this.refreshStashedValueCallback),this.changeFormUncontrolledError&&window.removeEventListener(\"change_form_uncontrolled_error\",this.changeFormUncontrolledError),this.freshStateStatusCallback&&window.removeEventListener(\"fresh_state\",this.freshStateStatusCallback),this.state.errorIdList.clear(),this.setState=()=>{},clearTimeout(this.loadConfigTimeOut),clearTimeout(this.freshStateTimer),clearTimeout(this.firstRefreshTimer),D.B7.clearInterval(),this.loadConfigTimeOut=null,this.loadingSubmitNumber=0,this.freshStateTimer=null}componentWillReceiveProps(e,t){e.deviceTypesWithConfigSignals!==this.props.deviceTypesWithConfigSignals&&this.refreshForm(e.deviceTypesWithConfigSignals)}render(){var e,t;const{intl:n,isInModal:r,refreshLoading:i,loading:o,selectedTreeNode:u,deviceTypesWithConfigSignals:d}=this.props,{selectedRows:p,disclaimerVisible:f,isDiState:h,confirmBtnDisabled:g,isConfiguring:v,freshState:b,isFirstRefresh:C}=this.state,{mocId:T}=u,E=i||o,M={successCallbacks:[this.closePasswordModal],failCallbacks:[],intl:n,selected:p},D=h[0]&&h[1],I=this.props.deviceTypesWithConfigSignals&&this.props.deviceTypesWithConfigSignals.length<=0,N=[(0,j.jsx)(c.Z,{onClick:this.handleCancel,children:(0,j.jsx)(w.Z,{id:\"common.button.cancel\"})},\"cancel\"),(0,j.jsx)(c.Z,{onClick:this.handleOk,type:\"primary\",disabled:g,children:(0,j.jsx)(w.Z,{id:\"neteco.pvms.confirm\"})},\"confirm\")],k=!b&&!C,L=\"config-list-form-items-wrapper \"+((0,y.VP)()?\"config-list-form-items-wrapper-new\":\"\"),R={intl:n,unprocessedData:null===(e=d[0])||void 0===e?void 0:e.groups,disabled:E||!b,deviceDnId:Number(u.elementId)};return(0,j.jsxs)(\"div\",{className:\"nco-device-prop-config-modal\",children:[(0,j.jsxs)(\"div\",{className:\"nco-device-prop-config-modal-inner\",style:{position:\"relative\"},children:[(0,j.jsx)(\"div\",{className:(0,x.Z)(\"loading-mask\",{\"loading-mask-3d-limit\":r}),style:{display:E||C?\"block\":\"none\"},children:(0,j.jsx)(\"span\",{children:n.formatMessage({id:\"neteco.pvms.partials.main.dm.devParamMenu.inRefreshing\"})})}),(0,j.jsx)(\"div\",{className:(0,x.Z)({[L]:!r,\"config-list-form-items-3d-wrapper\":r}),children:(0,j.jsx)(l.Z,{ref:this.formRef,children:this.state.formContent})}),!I&&(0,j.jsxs)(\"div\",{className:(0,x.Z)({\"config-list-buttons-wrapper\":!r,\"config-list-buttons-3D-wrapper\":r}),children:[(0,m.lVp)(m.Z0j)&&H.includes(T)&&(0,j.jsx)(_.Z,{...R}),(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(A.Z,{}),(0,j.jsx)(S.Z,{className:\"device-set-config-button\",operationId:m.qS6,targetId:[null===(t=p[0])||void 0===t?void 0:t.dn],targetType:\"device\",intl:n,onClick:this.loadingSubmit,type:\"primary\",loading:v,disabled:!this.state.isFormTouched||0===this.state.groups.length||i&&!C||!D,children:n.formatMessage({id:\"neteco.pvms.systemSetting.save\"})})]}),(0,j.jsx)(s.Z,{placement:\"top\",title:n.formatMessage({id:\"neteco.pvms.partials.main.dm.devParamMenu.refreshBtn.tip\"}),visible:k,defaultVisible:k,overlayClassName:\"fresh-state-button-tooltip\",children:(0,j.jsx)(c.Z,{disabled:E||!b,onClick:()=>{this.refresh(!0,!0,!0)},children:n.formatMessage({id:\"neteco.pvms.partials.main.dm.devParamMenu.refreshBtn\"})})})]})]}),(0,j.jsx)(P.Z,{shouldShowPasswordModal:this.state.shouldShowPasswordModal,...M}),(0,j.jsx)(O.Z,{type:\"prompt\",title:n.formatMessage({id:\"neteco.pvms.device.set.params.disclaimer.title\"}),visible:f,footer:N,cancelCallback:this.handleCancel,contentCenter:\"top\",alignItems:\"flexStart\",content:(0,j.jsxs)(\"div\",{className:\"neteco-pvms-device-set-params-disclaimer\",children:[this.getDisclaimer(n),(0,j.jsx)(a.Z,{onChange:this.agreePrecautions,children:`${n.formatMessage({id:\"neteco.pvms.device.set.params.disclaimer.checkbox\"})} ${n.formatMessage({id:\"neteco.pvms.device.set.params.disclaimer.checkLabel\"})}`})]})})]})}}const W=Y,K=(0,r.$j)((e=>({loading:e.ncoMonitorDevicePropConfigModal.loading,refreshLoading:e.ncoMonitorDevicePropConfigModal.refreshLoading,deviceTypesWithConfigSignals:e.ncoMonitorDevicePropConfigModal.deviceTypesWithConfigSignals})),(e=>({loadNcoDevicePropConfigModal:function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,I.eZ)(e,t,n,r)},configSignalGroups:I.al,checkIsDisclaimer:I.Pn,updateDisclaimer:I._1,refreshConfigSignal:(t,n,r,i)=>{(0,I.rJ)(e,t,n,r,i)}})))((0,i.ZP)(W));var q=n(4911),Q=n(31519),X=n(65835);const{pageName:J,accessId:$,leaveId:ee}=Q.e.deviceParams;class te extends o.Component{constructor(e){super(e),this.finishBatchConfiguring=()=>{this.setState({batchConfiguring:!1})},this.startBatchConfiguring=()=>{this.setState({batchConfiguring:!0})};const{selectedTreeNode:t}=e;this.state={signalGroups:[],configuring:!1,batchConfiguring:!1,selectedRows:t?[{dn:t.elementDn,dnId:t.elementId,mocId:t.mocId,status:t.status}]:[]},this.startTime=X.$.pageAccess($,{pageName:J,deviceType:String(t.mocId)})}componentWillUnmount(){X.$.pageLeave(this.startTime,ee,{pageName:J,deviceType:String(this.props.selectedTreeNode.mocId)})}render(){const{finishBatchConfiguring:e,startBatchConfiguring:t}=this,{selectedRows:n,batchConfiguring:r}=this.state,{selectedTreeNode:i,isInModal:o}=this.props;return(0,j.jsx)(j.Fragment,{children:(0,m.agq)([m.qS6,m.SZq])?(0,j.jsx)(\"div\",{className:\"nco-device-config-page tab-content  \"+((0,y.VP)()?\"nco-device-config-page-new\":\"\"),children:o?(0,j.jsx)(K,{selectedRows:n,startBatchConfiguring:t,finishBatchConfiguring:e,batchConfiguring:r,selectedTreeNode:i,isInModal:o}):(0,j.jsx)(\"div\",{className:\"content\",children:(0,j.jsx)(\"div\",{className:\"left-content\",children:(0,j.jsx)(\"div\",{className:\"config-list-wrapper \"+((0,y.VP)()?\"config-list-wrapper-new\":\"\"),children:(0,j.jsx)(K,{selectedRows:n,startBatchConfiguring:t,finishBatchConfiguring:e,batchConfiguring:r,selectedTreeNode:i})})})})}):(0,j.jsx)(\"div\",{className:\"nco-app-container-empty nco-config-container-empty\",children:(0,j.jsx)(q.Z,{})})})}}const ne=te,re=(0,r.$j)((e=>({})),(e=>({})))((0,i.ZP)(ne))},84809:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>r});const r=n(15285).Z},57673:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>ne});var r=n(23774),i=n(93706),o=n(88391),a=n(12682),s=n.n(a),l=n(37920),c=n.n(l),u=n(2326),d=n(33792),p=n(41541),f=n(29266),h=n(1413);const m={icon:{tag:\"svg\",attrs:{viewBox:\"64 64 896 896\",focusable:\"false\"},children:[{tag:\"path\",attrs:{d:\"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z\"}}]},name:\"line-chart\",theme:\"outlined\"};var g=n(9345),v=function(e,t){return o.createElement(g.Z,(0,h.Z)((0,h.Z)({},e),{},{ref:t,icon:m}))};const y=o.forwardRef(v);var b=n(90701),S=n(48287),x=n(45258),w=n(10749),C=n(16910),T=n(3746),A=n(43346),E=n(23712);const{Item:O}=f.Z,{neteco:M}=window,{refreshHistorySignals:P}=w.Z;class D extends o.Component{static getDerivedStateFromProps(e){return\"value\"in e?{...e.value||{}}:null}constructor(e){super(e),this.handleDateChange=e=>{const{updateSearchBarStates:t,handleSubmit:n}=this.props;t(e?{hasDateSelected:!0}:{hasDateSelected:!1}),\"value\"in this.props||this.setState({date:e}),this.triggerChange({date:e}),n()},this.handleSignalsChange=e=>{const{updateSearchBarStates:t}=this.props;0===e.length?t({hasSignalSelected:!1}):t({hasSignalSelected:!0});const{intl:n,signalMap:r,shouldRenderOptsList:i}=this.props,o=r.map((e=>[e.id,{name:e.name,unit:e.unit}]));if(o.length>0){const t=Object.fromEntries(o),{size:r}=new Set(e.map((e=>t[e].unit)));let a=\"\";const s={title:n.formatMessage({id:\"neteco.pvms.info\"}),content:a,okText:n.formatMessage({id:\"common.button.ok\"}),cancelText:n.formatMessage({id:\"neteco.pvms.main.hhsrc.cancel\"}),centered:!0};if(i){if(e.length>2)return a=n.formatMessage({id:\"neteco.pvms.partials.main.io.intelligentDiagnose.MSTwoSignal\"}),void x.Z.info({...s,content:a})}else{if(r>2)return a=n.formatMessage({id:\"neteco.pvms.partials.main.io.intelligentDiagnose.MSTwoUnit\"}),x.Z.destroyAll(),void x.Z.info({...s,content:a});if(e.length>40)return a=n.formatMessage({id:\"neteco.pvms.partials.main.io.intelligentDiagnose.MAXNumUnit\"}),x.Z.destroyAll(),void x.Z.info({...s,content:a})}}\"value\"in this.props||this.setState({rawSignals:e}),this.triggerChange({rawSignals:e})},this.handleOptIdChange=e=>{const{updateSearchBarStates:t}=this.props;0===e.length?t({hasOptSelected:!1}):t({hasOptSelected:!0});const{intl:n}=this.props;if(e.length>20){let e=\"\";const t={title:n.formatMessage({id:\"neteco.pvms.info\"}),content:e,okText:n.formatMessage({id:\"common.button.ok\"}),cancelText:n.formatMessage({id:\"neteco.pvms.main.hhsrc.cancel\"}),centered:!0};return e=n.formatMessage({id:\"neteco.pvms.partials.main.dm.detailInfo.optHistoryInfo.plsSelectUnderTenOptimiser\"}),void x.Z.info({...t,content:e})}const r=e.map((e=>D.optMap.get(e)));this.setState({opts:r}),this.triggerChange({opts:r})},this.triggerChange=e=>{const{onChange:t}=this.props;t&&t({...this.state,...e})},this.clearSearchValue=()=>{this.setState({rawSignals:[],opts:[]})},this.forwardOrNextDate=e=>{const{handleSubmit:t}=this.props;this.setState({date:e},(()=>{this.triggerChange({date:e}),t()}))};const{defaultList:t=[],defaultSelectedOpt:n,optList:r=[],updateSearchBarStates:i}=e,o=e.value||{};r.forEach((e=>{D.optMap.set(e.dn,e)})),(t.length>0||o.rawSignals&&o.rawSignals.length>0)&&i({hasSignalSelected:!0}),n&&i({hasOptSelected:!0}),this.state={date:o.date||c()(),rawSignals:t.map((e=>String(e)))||o.rawSignals||[],opts:n?[n]:[],dropdownVisible:\"hidden\"}}componentDidMount(){this.triggerChange(this.state),this.refreshHistorySignalsSub=P.subscribe((()=>{this.handleSignalsChange([])}))}componentWillUnmount(){this.refreshHistorySignalsSub&&this.refreshHistorySignalsSub.unsubscribe(),this.setState=()=>{}}render(){const{date:e,rawSignals:t,opts:n}=this.state,{intl:r,signalMap:i,optList:o,shouldRenderOptsList:a,isLoadingHistoryData:s}=this.props,l=i.length>0?[{title:r.formatMessage({id:\"neteco.pvms.basicUnifSignalSet\"}),value:\"ALL\",key:\"ALL\",children:i.map((e=>({title:(0,C.aH)(M.util.iUnescape(e.name)),value:`${e.id}`,key:e.id})))}]:[],c=e=>r.formatMessage({id:\"neteco.pvms.organizationSelector.selected\"},{0:e.length});let u=[];o&&o.length>0&&(u=[{title:r.formatMessage({id:\"neteco.pvms.upgrade.types.1\"}),value:\"ALL\",key:\"ALL\",children:o.map((e=>({key:e.dn,title:M.util.iUnescape(e.optNumber),value:e.dn})))}]);const d=n.length>0?n.map((e=>e.dn)):[];return(0,E.jsxs)(\"div\",{style:{display:\"flex\",justifyContent:\"flex-start\"},children:[a&&(0,E.jsx)(O,{label:r.formatMessage({id:\"neteco.pvms.troubleInfo.optChoose\"}),children:(0,E.jsx)(S.Z,{className:\"nco-device-historical-input\",treeData:u,value:d,onChange:this.handleOptIdChange,treeCheckable:!0,style:{minWidth:\"13rem\"},dropdownStyle:{maxHeight:400,overflow:\"auto\",zIndex:\"900\"},treeDefaultExpandAll:!0,maxTagCount:0,maxTagPlaceholder:c,allowClear:!0,getPopupContainer:e=>e.parentNode||document.body})}),(0,E.jsx)(O,{label:r.formatMessage({id:\"neteco.pvms.dataLimit.queryTime\"}),children:(0,E.jsxs)(\"div\",{className:\"device-historical-datetime-wrap\",children:[(0,E.jsx)(\"div\",{className:\"device-historical-datetime\",children:(0,E.jsx)(A.Z,{intl:r,loading:s,currentTime:e,curPeriod:T._T.DAYS,clickEvent:this.forwardOrNextDate,onChange:this.handleDateChange})}),(0,E.jsx)(b.Z,{title:r.formatMessage({id:\"neteco.pvms.save.time.hour.tip.new\"}),children:(0,E.jsx)(\"i\",{className:\"icon-questionmark-circle-lined\"})})]})}),(0,E.jsx)(O,{label:r.formatMessage({id:\"neteco.pvms.dataLimit.signalName\"}),className:\"nco-device-history-data-dropdown\",children:(0,E.jsx)(S.Z,{className:\"nco-device-historical-input\",treeData:l,value:t,onChange:this.handleSignalsChange,treeCheckable:!0,style:{minWidth:\"16rem\"},dropdownStyle:{maxHeight:400,overflow:\"auto\",zIndex:\"900\"},treeDefaultExpandAll:!0,maxTagCount:0,maxTagPlaceholder:c,allowClear:!0,getPopupContainer:e=>e.parentNode||document.body})})]})}}D.optMap=new Map;const I=(0,i.ZP)(D);var N=n(13528),_=n(99073),j=n(33266),k=n(1544);const{redrawHistoryCanvas:L}=w.Z,{neteco:R}=window,Z=[\"#5ccbb1\",\"#4eaff5\",\"#ffbb33\",\"#f86cb5\",\"#e169e1\",\"#5C5FCC\",\"#FFBB33\",\"#94CC5C\",\"#FF8000\",\"#999999\"],B={id:30003,period:\"PERIOD_1_HOUR\"},F={id:30004,period:\"PERIOD_UNCERTAINTY\"},z=(e,t)=>{let n=!0;return Object.keys(t).map((r=>{(null==e?void 0:e[r])!==t[r]&&(n=!1)})),n},V=(e,t,n,r)=>{var i;const o=t.map((e=>[e.id,{id:e.id,name:e.name,unit:e.unit,precision:e.precision,period:e.period}])),a=Object.fromEntries(o);let l=[];if(n){const{rawSignals:e}=n;l=Array.from(new Set(e.map((e=>(0,C._v)(a[e].unit)))))}null===(i=e[0])||void 0===i||i.currentDate;const c=[\"\",\"\"],u=(e,t,n)=>s()(t)?e:[n,e],d=(e,t)=>e.map(((n,r)=>!(0,N.s)(n)&&(0===r&&(0,N.s)(e[r+1])||r===e.length-1&&(0,N.s)(e[r-1])||r>0&&r<e.length-1&&(0,N.s)(e[r-1])&&(0,N.s)(e[r+1]))?{value:n,symbol:\"none\"!==t?t:\"circle\"}:{value:n,symbol:t})),p=e.length>0?e.map(((e,t)=>{const n=a[e.signalId]||{},i=((e,t,n)=>{var r;return(s()(n)||!z(e,B)&&!z(e,F))&&(null==t||null===(r=t.signalsValues)||void 0===r?void 0:r.length)>1?\"none\":\"circle\"})(n,e,r),o=e.signalsValues.map(((t,i)=>(()=>{const o=e.startTimes[i],a=u(t,r,o);if(!n.precision||n.precision<0||n.precision>99)return a;let s=parseFloat(parseFloat(t).toFixed(n.precision));return s=isNaN(s)?_.lH:s,u(s,r,o)})()));return{name:(0,C.aH)(e.signalName),color:Z[t%Z.length],type:\"line\",symbolSize:5,barWidth:\"1px\",yAxisIndex:l.length>1&&l[0]!==(0,C._v)(e.unit)?1:0,emphasis:{itemStyle:{borderWidth:6,borderColor:Z[t%Z.length]}},data:d(o,i)}})):c.map(((e,t)=>({name:e,color:Z[t],type:\"line\",symbol:\"none\",barWidth:\"10px\",smooth:!0,yAxisIndex:0,data:[]}))),f={type:\"slider\",showDetail:!0};return s()(r)||(f.width=\"80%\",f.left=\"center\"),{legend:{itemWidth:12,itemHeight:12,y:\"top\",top:\"2%\",right:\"3.5%\",left:\"3.5%\",icon:j.qz,selectedMode:(null==e?void 0:e.length)>1,data:e.length>0?e.map((e=>(0,C.aH)(e.signalName))):c},tooltip:{show:!0,trigger:\"axis\",formatter:e=>{let t=`${e[0].axisValueLabel}<br/>`;for(let r=0;r<e.length;r++){var n;const i=`<span style=\"float:right;font-weight:bold;margin-left:20px;\" >${(0,N.s)(null===(n=e[r].data)||void 0===n?void 0:n.value)?_.lH:(0,N.af)(e[r].data.value)}</span>`;t+=`<div style=\"margin-top:8px\">${(0,j.SG)(e[r].color)}${e[r].seriesName}${i}</div>`}return t},textStyle:{fontSize:12},confine:!0},position:(e,t,n,r,i)=>{const o={};return e[0]>.8*i.viewSize[0]?o.right=i.viewSize[0]-e[0]:o.left=e[0]+10,e[1]>2/3*i.viewSize[1]?o.bottom=i.viewSize[1]-e[1]:o.top=e[1]+10,o},grid:{top:\"14%\",left:\"4%\",right:\"4%\",bottom:\"11%\",containLabel:!0},dataZoom:[f],xAxis:e.length>0?[{type:\"category\",axisTick:{show:!1},axisLine:{lineStyle:{show:!0,fontSize:12,color:\"#999\"}},axisPointer:{type:\"shadow\"},boundaryGap:!1,axisLabel:{formatter:e=>(0,k.BO)(e),showMaxLabel:!0},data:s()(r)?e[0].startTimes:null===(h=e[0])||void 0===h?void 0:h.originStartTimes}]:{type:\"category\",axisTick:{show:!1},axisLine:{lineStyle:{show:!0,fontSize:12,color:\"#999\"}},axisPointer:{type:\"shadow\"},boundaryGap:!1,data:[]},yAxis:e.length>0?l.map((e=>({type:\"value\",name:(0,C._v)(e),axisLabel:{normal:{fontSize:12,color:\"#999\"},formatter:e=>`${(0,N.af)(e)}`},axisLine:{lineStyle:{show:!0,fontSize:12,color:\"#999\"}},splitLine:{lineStyle:{type:\"dashed\"}},axisTick:{show:!1}}))):[\"\",\"\"].map((e=>({type:\"value\",name:e,axisLabel:{normal:{fontSize:12,color:\"#999\"},formatter:e=>`${(0,N.af)(e)}`},axisLine:{lineStyle:{show:!0,fontSize:12,color:\"#999\"}},splitLine:{lineStyle:{type:\"dashed\"}},axisTick:{show:!1},max:1,min:0}))),series:p};var h};class H extends o.Component{constructor(e){super(e),this.updateSearchBarStates=e=>{this.setState(e)},this.redrawHistoryCanvas=()=>{const{historyData:e}=this.props,t=String(new Date);this.getChartBuilder()(t)(e)},this.switchChart=e=>{this.setState({chart:e})},this.getChartBuilder=()=>{const{signalMap:e,dnId2Signals:t}=this.props,{queryString:n}=this.state;return r=>(r!==n&&this.setState({queryString:r}),n=>{const{condition:r}=this.formRef.current.getFieldsValue([\"condition\"]);this.resetCanvas(t),this.setState({chartOption:V(n,e,r,t)})})},this.resetCanvas=e=>{this.setState({chartOption:V([],[],void 0,e)});const t=document.querySelector(\".historical-chart-wrapper .echarts-for-react\");t&&t.removeAttribute(\"_echarts_instance_\")},this.handleSubmit=e=>{const{loadHistoricalInformation:t,loadHistoricalInformationBatch:n,shouldRenderOptsList:r,signalMap:i,intl:o,deviceDn:a,dnId2Signals:s}=this.props;e&&e.preventDefault();const l=this.formRef.current,{condition:c}=l.getFieldsValue([\"condition\"]),{date:u,rawSignals:d,opts:p}=c;l.validateFields().then((()=>{const{queryString:e}=this.state;if(c.date&&d.length>0){const e=u.valueOf(),l=e-60*new Date(parseInt(e.toString())).getTimezoneOffset()*1e3;r?n({intl:o,opts:p,date:l,signalKeys:d,chartBuilder:this.getChartBuilder(),signalMapObject:i}):t({intl:o,deviceDn:a,localTimeStamp:l,rawSignals:d,signalMap:i,dnId2Signals:s,utcTimeStamp:e},this.getChartBuilder())}else this.resetCanvas(s)})).catch((()=>{this.resetCanvas(s)}))},this.getQueryCondition=()=>{const e=this.formRef.current;if(e){const{condition:t={}}=e.getFieldsValue([\"condition\"]);return t}return{}},this.formRef=(0,o.createRef)(),this.state={chartOption:V([],[],void 0,e.dnId2Signals),queryString:null,hasDateSelected:!0,hasOptSelected:!1,hasSignalSelected:!1}}componentDidMount(){this.redrawSubject=L.subscribe((()=>{this.redrawHistoryCanvas()}));const{clearHistoryCanvas:e,intl:t}=this.props,{loadHistoricalInformation:n,loadHistoricalInformationBatch:r,signalMap:i,shouldRenderOptsList:o,deviceDn:a,dnId2Signals:s}=this.props,l=this.formRef.current,{condition:c}=l.getFieldsValue([\"condition\"]),{date:u,rawSignals:d,opts:p}=c;if(e(),d&&d.length>0){const e=u.valueOf(),l=e-60*new Date(parseInt(e.toString())).getTimezoneOffset()*1e3;if(!o)return void n({intl:t,deviceDn:a,localTimeStamp:l,utcTimeStamp:e,rawSignals:d,signalMap:i,dnId2Signals:s},this.getChartBuilder());r({intl:t,opts:p,date:l,signalKeys:d,utcTimeStamp:e,chartBuilder:this.getChartBuilder(),signalMapObject:i})}}componentWillUnmount(){this.refreshHistorySignalsSub&&this.refreshHistorySignalsSub.unsubscribe(),this.redrawSubject&&this.redrawSubject.unsubscribe(),this.setState=()=>{}}render(){const{intl:e,signalMap:t,defaultList:n,shouldRenderOptsList:r,optList:i,defaultSelectedOpt:o,deviceName:a=\"-\",isLoadingHistoryData:s}=this.props,l=new Set(t.map((e=>e.id))),c=n.filter((e=>l.has(e))),u=this.getQueryCondition();let h,m=a;if(r){if(u.date){const{rawSignals:e}=u,n=new Set(e);m=t.filter((e=>n.has(`${e.id}`))).map((e=>e.name)).join(\",\")}}else u.date&&(m=`[${u.date.format(\"YYYY-MM-DD\")}] ${a}`);const{hasDateSelected:g,hasOptSelected:v,hasSignalSelected:b}=this.state;h=r?!(i&&g&&v&&b):!g||!b;const{Item:S}=f.Z;return(0,E.jsxs)(\"div\",{className:\"nco-device-historical-info \"+((0,C.VP)()?\"nco-device-historical-info-new\":\"\"),children:[(0,E.jsx)(\"div\",{className:\"nco-device-historical-info-form\",children:(0,E.jsxs)(f.Z,{layout:\"inline\",ref:this.formRef,children:[(0,E.jsx)(S,{name:\"condition\",rules:[],children:(0,E.jsx)(I,{optList:i,updateSearchBarStates:this.updateSearchBarStates,signalMap:t,defaultSelectedOpt:o,defaultList:c,shouldRenderOptsList:r,handleSubmit:this.handleSubmit,isLoadingHistoryData:s})}),(0,E.jsx)(S,{children:(0,E.jsx)(p.Z,{type:\"primary\",htmlType:\"submit\",onClick:this.handleSubmit,disabled:h,children:e.formatMessage({id:\"ncoHomeSearchBarView.button.search\"})})})]})}),(0,E.jsx)(\"div\",{className:\"nco-device-historical-info-curve\",children:(0,E.jsxs)(\"div\",{className:\"history-data-outer-wrapper\",children:[(0,E.jsx)(\"div\",{className:\"history-data-outer-wrapper-title\",children:(0,E.jsxs)(\"div\",{style:{padding:\"0 0 0 1.2rem\"},children:[(0,E.jsx)(y,{}),R.util.iUnescape(m||\"\")]})}),(0,E.jsx)(\"div\",{className:\"historical-chart-wrapper\",children:(0,E.jsx)(d.Z,{style:{width:\"100%\",height:\"100%\",minHeight:\"35rem\"},option:this.state.chartOption})})]})})]})}}const U=(0,i.ZP)(H),G=(0,r.$j)((()=>({})),(()=>({})))((0,i.ZP)(U));var Y=n(87937),W=n(49453),K=(n(92915),n(31519)),q=n(44184),Q=n(65835);const{pageName:X,accessId:J,leaveId:$}=K.e.deviceHistoryData;class ee extends o.Component{constructor(e){super(e),this.clearHistoryCanvas=()=>{this.setState({historyData:[]})},this.loadHistoricalInformationBatch=async e=>{const{opts:t,date:n,signalKeys:r,chartBuilder:i,signalMapObject:o}=e,a=o.map((e=>[e.id,{name:e.name,unit:e.unit}])),s=Object.fromEntries(a),l=t.map((e=>[e.dn,e.optNumber])),u=await(0,Y.HW)(l.map((e=>e[0])),r,n),{success:d,data:p}=u;if(d){const{data:e}=p,o=[];for(let i=0;i<r.length;i++)for(let a=0;a<t.length;a++){const{dn:l,optNumber:u}=t[a],d=r[i],p=`${u}${s[d].name}`,{unit:f}=s[d],h=e[l][d],m=(0,q.LK)(h.pmDataList,\"YYYY-MM-DD HH:mm:ss\"),g=[1e3*c()(n).startOf(\"day\").unix(),1e3*c()(n).endOf(\"day\").unix()],v=h.pmDataList.map((e=>{const t=parseFloat(e.counterValue);return Math.abs(e.counterValue-17976931348623157e292)<=Number.EPSILON?\"-\":Math.round(1e3*t)/1e3}));o.push({signalId:d,signalName:p,signalsValues:v,unit:f,startTimes:m,currentDate:g})}i(`${t.map((e=>e.dn)).join(\",\")}-${r.map((e=>e.signalId))}`)(o),this.setState({historyData:o})}},this.buildChargeHistoryCondition=(e,t,n)=>{const r=[];return Object.keys(e).map((i=>{s()(e[i])||r.push({dnId:i,signalIds:e[i].filter((e=>t.includes(`${e.id}`))).map((e=>e.id)),date:n})})),r},this.buildHistoryData=(e,t,n,r)=>e.map((e=>{var i,o,a;return{signalId:e,signalName:t[e].name,signalsValues:n[e].pmDataList.map((e=>{const t=parseFloat(e.counterValue);return Math.abs(e.counterValue-17976931348623157e292)<=Number.EPSILON?\"-\":Math.round(1e3*t)/1e3})),startTimes:(0,q.LK)(null===(i=n[e])||void 0===i?void 0:i.pmDataList,\"YYYY-MM-DD HH:mm:ss\"),originStartTimes:(null===(o=n[e])||void 0===o?void 0:o.originPmDataList)&&(0,q.LK)(null===(a=n[e])||void 0===a?void 0:a.originPmDataList,\"YYYY-MM-DD HH:mm:ss\"),currentDate:[1e3*c()(r).startOf(\"day\").unix(),1e3*c()(r).endOf(\"day\").unix()],enumMap:t[e].enumMap,unit:t[e].unit}})),this.loadHistoricalInformation=async(e,t)=>{const{deviceDn:n,localTimeStamp:r,rawSignals:i,signalMap:o,dnId2Signals:a,utcTimeStamp:l}=e,c=o.map((e=>[e.id,{name:e.name,unit:e.unit,enumMap:e.enumMap}])),u=Object.fromEntries(c),d=i.map((e=>`signalIds=${e}`)).join(\"&\");if(this.startLoadingHistoryInfo(),s()(a)){const e=await(0,W.U2)(`/rest/pvms/web/device/v1/device-history-data?showDst=true&${d}`,{deviceDn:n,date:r});if(e.success){const{data:n}=e,r=this.buildHistoryData(i,u,n);t(d)(r),this.stopLoadingHistoryInfo(),this.setState({historyData:r})}}else try{const e=await(0,W.v_)(\"/rest/neteco/web/homemgr/v1/device/history/device-history-data\",this.buildChargeHistoryCondition(a,i,r));if(e){const n=[];Object.values(e).forEach((e=>{i.map((t=>{e[t].originPmDataList=e[t].pmDataList,e[t].pmDataList=e[t].pmDataList.filter((e=>e.dnId))})),n.push(...this.buildHistoryData(i,u,e,l))})),t(d)(n),this.stopLoadingHistoryInfo(),this.setState({historyData:n})}}catch(e){}},this.startLoadingHistoryInfo=()=>{this.setState({isLoadingHistoryData:!0})},this.stopLoadingHistoryInfo=()=>{this.setState({isLoadingHistoryData:!1})};const{selectedTreeNode:t={}}=e,{elementDn:n}=t;this.state={deviceDn:e.match.params.deviceDn||n,historyData:[],isLoadingHistoryData:!1},this.startTime=Q.$.pageAccess(J,{pageName:X,deviceType:String(t.mocId)})}componentWillUnmount(){Q.$.pageLeave(this.startTime,$,{pageName:X,deviceType:String(this.props.selectedTreeNode.mocId)})}render(){const{historyInitialData:e={},optList:t=[],selectedTreeNode:n,isInModal:r}=this.props,{signalMap:i=[],defaultList:o=[],dnId2Signals:a={}}=e;if(!i.length||!o.length)return null;const{loadHistoricalInformation:s,loadHistoricalInformationBatch:l,clearHistoryCanvas:c}=this,{historyData:u,isLoadingHistoryData:d,deviceDn:p}=this.state,f={loadHistoricalInformation:s,loadHistoricalInformationBatch:l,clearHistoryCanvas:c,signalMap:i,historyData:u,isLoadingHistoryData:d,defaultList:o,deviceDn:p,deviceName:n.nodeName,optList:t,dnId2Signals:a,shouldRenderOptsList:t.length>0,defaultSelectedOpt:t.length>0?t[0]:void 0};return(0,E.jsx)(\"div\",{className:\"nco-device-history-info-page tab-content\",children:r?(0,E.jsx)(G,{...f},p):(0,E.jsx)(\"div\",{className:\"content\",children:(0,E.jsx)(\"div\",{className:\"left-content\",children:(0,E.jsx)(\"div\",{className:\"history-info-wrapper\",children:(0,E.jsx)(G,{...f},p)})})})})}}const te=(0,u.EN)(ee),ne=(0,r.$j)((e=>({})),(e=>({})))((0,i.ZP)(te))},92873:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>r});const r=n(57673).Z},56828:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>Sn});var r=n(88391),i=n(93706),o=n(15694),a=n(70535),s=n(87650),l=n(55534),c=n.n(l),u=n(64218),d=n(13528),p=n(96182),f=n(88345),h=n(91650),m=n(84272),g=n(95059),v=n(27540),y=n(70440),b=n(83621),S=n(62995),x=n(99073),w=n(23712);const{operationSuccess:C,operationFailed:T,operationConfirm:A}=g.Z,{pvInputVSignals:E,pvStatusSignals:O}=h.ZP;class M extends r.Component{constructor(e){super(e),this.getRealtimeDataContent=()=>{const{decoupleData:e=[],intl:t,typeId:n,mocId:r}=this.props;if((0,y.Ne)(r)||(0,u.Zr)(r)){const t=e.findIndex((e=>15101===e.id)),n=e.findIndex((e=>15102===e.id));if(-1!==t){if(-1!==n){const{value:r=\"-\",unit:i=\"dBm\"}=e[n];e[t].signalDbm=`${r}${i}`}e[t].id=\"averageSignalFour\"}}return e.map((e=>{const{name:i,unit:o,value:a,realValue:s,signalDbm:l,id:c,id:u}=e,p={};let f=o;t.messages[o]&&(f=t.formatMessage({id:o})),(0,y.Po)(r,n)&&\"ENUM\"===(null==e?void 0:e.dataType)&&(p.isSts3rdEnum=!0,p.dotStatus=\"1\"===(null==e?void 0:e.value)?\"closed\":\"open\");let h=(0,d.af)((0,y.Po)(r,n)?s:a);return\"-\"===h&&(h=x.lH),{span:8,title:i,unit:f||\"\",value:h||x.lH,signalDbm:l,signalId:u,id:c,otherConfigs:p}}))},this.getPvInputTableProps=()=>{const{mocId:e,realtimeInformation:t={},pvAccess:n,intl:r,realtimeInfoMppt:i=!1}=this.props;let o,a=t[10051],s=t[10025];s&&(s=s.realValue),n&&(o=n.value),a&&(a=t[10051].value,a=parseInt(a),a=isNaN(a)?void 0:a,a=1&Number(a>>>13));const l=t[10047];let c=0;if(l&&l.value){const e=parseInt(l.value);isNaN(e)||(c=e)}if(((0,u.FU)(e)||(0,u.HD)(e))&&c&&c>0){const e=[];for(let n=0;n<c;n++){const r=E[n],o=O[n],a=t[o]&&t[o].realValue||\"-\",s=t[r]&&t[r].value||\"-\",l=t[r+1]&&t[r+1].value||\"-\";e.push({name:i?`MPPT${n+1}`:`PV${n+1}`,voltage:s,current:l,pvAccess:a})}const n=[{title:r.formatMessage({id:\"neteco.pvms.devTypeLangKey.string\"}),dataIndex:\"name\",render:e=>(0,w.jsx)(\"span\",{title:e,children:e})},{title:r.formatMessage({id:\"neteco.pvms.KPI.singlePlant.plantSurvey.energyFlowPerformanceData.inputU\"}),dataIndex:\"voltage\",render:e=>(0,w.jsx)(\"span\",{title:e,children:e})},{title:r.formatMessage({id:\"neteco.pvms.KPI.singlePlant.plantSurvey.energyFlowPerformanceData.inputI\"}),dataIndex:\"current\",render:e=>(0,w.jsx)(\"span\",{title:e,children:e})}];return\"1\"===o&&1===a&&n.push({title:r.formatMessage({id:\"neteco.pvms.partials.main.dm.detailInfo.curInfo.pvStatus\"}),dataIndex:\"pvAccess\",render:e=>(0,w.jsx)(\"span\",{title:e,children:e})}),{dotStatus:s,columns:n,size:\"small\",rowKey:\"name\",dataSource:e,pagination:!1}}return{dotStatus:s}},this.deviceSearch=e=>{const{mocId:t,deviceDn:n,intl:r}=this.props,i={};i[b.o.SMART_LOGGER]=\"21017\",i[b.o.BUSINESS_SMART_LOGGER]=\"21017\",i[b.o.DONGLE]=\"21007\",i[b.o.HEMS]=\"21007\";const o=(0,y.Ne)(t)?\"1\":\"0\",a=i[t]?[{id:i[t],value:o}]:[];(0,m.wb)(n,a).then((e=>{const{code:t,data:n}=e;return 0===t&&0===n[0].code?C(r,r.formatMessage({id:\"neteco.pvms.paramsSetting.unifiedSetting.devControl.deviceSearchSucceeded\"})):T(r,r.formatMessage({id:\"neteco.pvms.paramsSetting.unifiedSetting.devControl.deviceSearchFailed\"}))}))},this.state={typeId:\"\"}}componentDidMount(){const{deviceDn:e,selectedTreeNode:t={}}=this.props,{typeId:n}=t;n?this.setState({typeId:n}):(0,m.OW)(e).then((e=>{this.setState({typeId:e.typeId})}))}render(){const{shouldRenderChildList:e,shouldRenderOptsList:t,tableProps:n,mocId:r,intl:i,realtimeInfoStatus:l,isShowLeftTree:c,softwareVersion:d}=this.props,{getRealtimeDataContent:p}=this,{typeId:f}=this.state,h=this.getPvInputTableProps(),{dataSource:m=[],columns:g=[],dotStatus:b}=h,x=4===g.length,C=x?\"mppt-with-status\":\"mppt-without-status\",T=!e&&!t||(0,y.Ne)(r)||(0,y.fJ)(d),A=document.getElementById(\"setting-button-container\");return(0,w.jsx)(w.Fragment,{children:(0,w.jsxs)(\"div\",{className:\"nco-realtime-info-signal-wrapper\",ref:e=>this.realtimeInfo=e,children:[this.props.overflowSettingActions&&A?(0,s.createPortal)((0,w.jsx)(S.Z,{typeId:f,...this.props}),A):(0,w.jsx)(S.Z,{typeId:f,...this.props}),T&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(\"h3\",{className:\"part-title\",children:i.formatMessage({id:\"neteco.pvms.thirdInterface.src.devReal\"})}),((0,u.FU)(r)||(0,u.HD)(r))&&m.length>0&&(0,w.jsx)(\"div\",{className:C,children:(0,w.jsx)(\"div\",{className:\"device-pv-input-content bottom-gap\",children:(0,w.jsx)(v.Z,{data:m,isShowStatus:x,intl:i,isShowTreeWrapper:c})})}),(0,w.jsx)(\"div\",{className:\"realtime-content bottom-gap\",style:{overflow:\"auto\"},children:(0,w.jsxs)(a.Z,{style:{position:\"relative\"},children:[(()=>{const e=p();if((0,y.Ne)(r)||(0,u.Zr)(r)){const t=e.findIndex((e=>15102===e.signalId));-1!==t&&e.splice(t,1)}const t=3-e.length%3;let n=[];return t>0&&t<3&&(n=new Array(t).fill(0).map((()=>({useEmpty:!0,span:8})))),[...e,...n].map(((e,t)=>{const{otherConfigs:n={}}=e;return\"kWh\"===e.unit&&(e.unit=i.formatMessage({id:\"nco.unit.kWh\"})),(0,u.kG)(e,t,{...n,useDefaultStyle:!0,intl:i})}))})(),1!==l&&(0,w.jsx)(\"div\",{className:\"nco-realtime-empty-content\",children:i.formatMessage({id:\"neteco.pvms.realtimeinfo.loading\"})})]})})]}),(e||t||(0,u.ht)(r,f))&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(\"h3\",{className:\"part-title\",children:i.formatMessage({id:\"neteco.pvms.thirdInterface.src.subDevList\"})}),(0,w.jsx)(\"div\",{className:\"realtime-content bottom-gap\",style:{overflow:\"auto\"},children:n?(0,w.jsx)(o.Z,{...n}):(0,w.jsx)(\"div\",{})})]})]})})}}const P=M;var D=n(5083),I=n(49100),N=n(37825),_=n(80770),j=n(59516);const{operationConfirm:k}=g.Z;class L extends r.Component{constructor(e){super(e),this.intlMessage=(e,t)=>this.props.intl.formatMessage({id:e},t),this.deleteMeter=()=>{const{intl:e,selectedTreeNode:t}=this.props;return k(e,this.intlMessage(\"neteco.pvms.delete.meter.tips\"),(()=>{const e={successCallback:e=>{const{parentNode:n,elementId:r}=t,i={id:\"230100324\",value:\"0\"};23022===n.typeId&&(i.id=\"230220424\"),(0,m.Lc)(n.elementDn,[i],e).then((e=>{const{code:t}=e;if(0!==t)return(0,_.lU)(this.intlMessage(\"neteco.pvms.alarmTemp.deleteError\"));(0,m.tz)([r]).then((e=>{if(0===e.code){const e=()=>{(0,u.Nu)(\"reload_tree_node\",{targetDn:n.elementDn})};return(0,_.Sb)(this.intlMessage(\"neteco.pvms.deleteSucceed\"),e)}return(0,_.lU)(this.intlMessage(\"neteco.pvms.alarmTemp.deleteError\"))}))}))},errorCallback:N.mz};(0,u.Nu)(\"use-verify-pass\",e)}))},this.isConnected=e=>\"Connected\"===e,this.isDisableDelBtn=()=>{const{selectedTreeNode:e}=this.props;return!(e&&!this.isConnected(e.status)&&this.isConnected(e.parentNode.status))},this.isShowDelBtn=()=>{const{selectedTreeNode:e}=this.props;return this.state.isShowDelBtn&&e&&(0,u.Zr)(e.parentNode.mocId)},this.state={isShowDelBtn:!1}}componentDidMount(){(0,m.Jq)().then((e=>{e.success&&this.setState({isShowDelBtn:!0})}))}render(){const{intl:e,meterRealtimeInfo:t,deviceDn:n,selectedTreeNode:r}=this.props,{mocId:i,typeId:o}=r;return(0,w.jsx)(\"div\",{children:(0,w.jsxs)(\"div\",{className:\"nco-realtime-info-signal-wrapper\",children:[(0,w.jsx)(D.Z,{}),this.isShowDelBtn()&&(0,w.jsx)(\"div\",{className:\"meter-btn-box\",children:(0,w.jsx)(I.Z,{operationId:j.ITW,targetId:[n],targetType:\"device\",intl:this.props.intl,onClick:this.deleteMeter,disabled:this.isDisableDelBtn(),className:\"meter-del-btn\",children:e.formatMessage({id:\"common.button.delete\"})})}),(0,w.jsxs)(\"div\",{className:\"nco-realtime-info-signal-wrapper-title-content\",children:[(0,w.jsx)(\"h3\",{className:\"part-title\",children:e.formatMessage({id:\"neteco.pvms.thirdInterface.src.devReal\"})}),(0,w.jsxs)(\"div\",{className:\"nco-realtime-info-signal-wrapper-title-tips\",children:[(0,w.jsx)(\"img\",{src:\"/pvmswebsite/assets/build/images/home/tipsIcon.png\",className:\"nco-realtime-info-signal-wrapper-title-tips-icon\"}),(0,w.jsx)(\"span\",{children:e.formatMessage({id:(0,u.Bl)(i,o)?\"neteco.pvms.realtimeinfo.meter.tips.contrary\":\"neteco.pvms.realtimeinfo.meter.tips\"})})]})]}),(t&&t.length)>0&&(0,w.jsx)(\"div\",{className:\"realtime-content bottom-gap\",children:(0,w.jsx)(a.Z,{style:{position:\"relative\"},children:t.map(((t,n)=>(0,u.kG)(t,n,{intl:e})))})})]})})}}const R=L;var Z=n(90701),B=n(37920),F=n.n(B),z=n(53137),V=n(4342);const H=e=>{switch(String(e)){case\"1\":return\"neteco.pvms.partials.main.dm.devStringDetail.moduleTyps.1\";case\"2\":return\"neteco.pvms.partials.main.dm.devStringDetail.moduleTyps.2\";case\"3\":return\"neteco.pvms.partials.main.dm.devStringDetail.moduleTyps.3\";case\"4\":return\"neteco.pvms.partials.main.dm.devStringDetail.moduleTyps.4\";case\"notDevId\":return\"-\";default:return\"neteco.pvms.partials.main.dm.devStringDetail.moduleTyps.5\"}};class U extends r.Component{constructor(e){super(e),this.intlMessage=(e,t)=>this.props.intl.formatMessage({id:e},t),this.getCapacity=e=>{let t=\"\";return t=0===e.fixedPower||e.fixedPower?0===e.fixedPower?String(parseFloat(e.standardPower*e.modulesNumPerString).toFixed(2)):String(parseFloat(e.fixedPower).toFixed(2)):\"-\",(0,d.af)(t)},this.renderSubContent=e=>{const{intl:t}=this.props,{standardPower:n,maxPowerPointVoltage:r,maxPowerPointCurrent:i,componentsNominalVoltage:o,nominalCurrentComponent:a,maxPowerTempCoef:s,voltageTempCoef:l,currentTempCoef:c,stringType:u,manufacturer:d,cellsNumPerModule:p,moduleProductionDate:f,firstDegradationDrate:h,secondDegradationDrate:m,moduleVersion:g,fillFactor:v,moduleRatio:y}=e;return[{value:n||\"-\",title:\"neteco.pvms.partials.main.dm.devStringDetail.standardPower_unit\",span:8},{value:r||\"-\",title:\"neteco.pvms.partials.main.dm.devStringDetail.vm\",span:8},{value:i||\"-\",title:\"neteco.pvms.partials.main.dm.devStringDetail.im\",span:8},{value:o||\"-\",title:\"neteco.pvms.partials.main.dm.devStringDetail.stringVenderVoc\",span:8},{value:a||\"-\",title:\"neteco.pvms.partials.main.dm.devStringDetail.stringVenderIsc\",span:8},{value:s||\"-\",title:\"neteco.pvms.partials.main.dm.devStringDetail.topPowerTepmRatio\",span:8},{value:l||\"-\",title:\"neteco.pvms.partials.main.dm.devStringDetail.vTempcoParam\",span:8},{value:c||\"-\",title:\"neteco.pvms.partials.main.dm.devStringDetail.iTempcoParam\",span:8},{value:t.formatMessage({id:H(u)})||\"-\",title:\"neteco.pvms.partials.main.dm.devStringDetail.moduleType\",span:8},{value:d||\"-\",title:\"neteco.pvms.partials.main.dm.devStringDetail.manufacturer\",span:8},{value:p||\"-\",title:\"neteco.pvms.partials.main.dm.devStringDetail.numberCellSheets\",span:8},{value:f&