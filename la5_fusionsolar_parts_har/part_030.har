emsShow&&t.parentNode==i._view&&i._showMenuItem(n,t)},!1),t.addEventListener(\"touchend\",function(n){if(t.style.background=i._background,t.style.color=i._color,this!==n.relatedTarget&&!this.contains(n.relatedTarget)&&e.items&&t.parentNode===i._view){var s=n.clientX,o=n.clientY,r=e.childrenDiv,a=i._getPosition(r);(s<a.left+2||s>a.left+r.offsetWidth-2||o<a.top+2||o>a.top+r.offsetHeight-2)&&i._hideMenuItem(t)}},!1)),t.addEventListener(\"mouseenter\",function(n){t.style.background=i._focusBackground,t.style.color=i._focusColor,this===n.relatedTarget||this.contains(n.relatedTarget)||e.items&&!this._itemsShow&&this.parentNode&&i._showMenuItem(n,this)},!1),t.addEventListener(\"mouseleave\",function(t){if(this.style.background=i._background,this.style.color=i._color,this!==t.relatedTarget&&!this.contains(t.relatedTarget)&&e.items&&this.parentNode){var n=t.clientX,s=t.clientY,o=e.childrenDiv,r=i._getPosition(o);(n<r.left+2||n>r.left+o.offsetWidth-2||s<r.top+2||s>r.top+o.offsetHeight-2)&&i._hideMenuItem(this)}},!1)},_getPosition:function(t){for(var e=0,i=0;t;)i+=t.offsetLeft,e+=t.offsetTop,t=t.offsetParent;return{left:i,top:e}},_removeContextmenuListener:function(){var t=this._contextView;t&&(t=t.getView?t.getView():t,V.isTouchable?(t.removeEventListener(\"touchstart\",this._getTouchStartListener(),!1),t.removeEventListener(\"touchmove\",this._getTouchMoveListener(),!1),t.removeEventListener(\"touchend\",this._getTouchEndListener(),!1),X.removeEventListener(\"contextmenu\",t,this)):X.removeEventListener(\"contextmenu\",t,this))},_handleContextmenu:function(t){!0===this.onMenuShowing(t)&&this.show(t),t.preventDefault()},_handleBodyClicked:function(t){if(V.isTouchable){for(var e=t.target;e&&e!==this._view;)e=e.parentElement;e!==this._view&&this.hide()}else this._mouseOver||this.hide()},_handleClick:function(t){if(0===t.button){for(var e=t.target;!e.menuItem&&e.parentElement;)e=e.parentElement;var i=e?e.menuItem:null;i&&this.isEnabled(i)&&(\"check\"===i.type&&(i.selected=!i.selected),\"radio\"===i.type&&(i.groupName?(i.selected=!0,this._items.forEach(function(t){i!==t&&t.groupName===i.groupName&&(t.selected=!1),t.items&&t.items.forEach(function(t){i!==t&&t.groupName===i.groupName&&(t.selected=!1)})})):i.selected=!i.selected),i.action&&i.action(i),this.onAction(i),i.items&&i.items.length>0||this.hide())}},_getTouchStartListener:function(){if(!this._touchStartListener){var t=this;this._touchStartListener=function(e){t._touchMoved=!1,t._lastTouch=new Date}}return this._touchStartListener},_getTouchMoveListener:function(){if(!this._touchMoveListener){var t=this;this._touchMoveListener=function(e){t._touchMoved=!0}}return this._touchMoveListener},_getTouchEndListener:function(){if(!this._touchEndListener){var t=this;this._touchEndListener=function(e){!t._touchMoved&&(new Date).getTime()-t._lastTouch.getTime()>1e3&&t._handleContextmenu(e)}}return this._touchEndListener},getWidth:function(){return this._width},setWidth:function(t){this._width=t},getMenuItemHeight:function(){return this._menuItemHeight},setMenuItemHeight:function(t){this._menuItemHeight=t},getBackground:function(){return this._background},setBackground:function(t){this._background=t},getBorder:function(){return this._border},setBorder:function(t){this._border=t},getDisabledColor:function(){return this._disabledColor},setDisabledColor:function(t){this._disabledColor=t},getFocusColor:function(){return this._focusColor},setFocusColor:function(t){this._focusColor=t},getFocusBackground:function(){return this._focusBackground},setFocusBackground:function(t){this._focusBackground=t},getColor:function(){return this._color},setColor:function(t){this._color=t},getSubMenuEnableIcon:function(){return this._subMenuEnableIcon},setSubMenuEnableIcon:function(t){this._subMenuEnableIcon=t},getSubMenuDisableIcon:function(){return this._subMenuDisableIcon},setSubMenuDisableIcon:function(t){this._subMenuDisableIcon=t},getCheckboxSelectedIcon:function(){return this._checkboxSelectedIcon},setCheckboxSelectedIcon:function(t){this._checkboxSelectedIcon=t},getCheckboxUnselectedIcon:function(){return this._checkboxUnselectedIcon},setCheckboxUnselectedIcon:function(t){this._checkboxUnselectedIcon=t},getRadiobuttonSelectedIcon:function(){return this._radiobuttonSelectedIcon},setRadiobuttonSelectedIcon:function(t){this._radiobuttonSelectedIcon=t},getRadiobuttonUnselectedIcon:function(){return this._radiobuttonUnselectedIcon},setRadiobuttonUnselectedIcon:function(t){this._radiobuttonUnselectedIcon=t},getXOffset:function(){return this._xOffset},setXOffset:function(t){this._xOffset=t},getYOffset:function(){return this._yOffset},setYOffset:function(t){this._yOffset=t}}),R.charts.IS_INVALIDATE_PROPERTY={xZoom:1,xTranslate:1,yZoom:1,yTranslate:1},R.charts.ChartBase=function(t){R.charts.ChartBase.superClass.constructor.apply(this,arguments),this._uniqueColors={},this._nonDataColors={},this._publishedDatas=new oe,this._view=X.createView(\"hidden\"),this._canvas=X.createCanvas(),this._view.appendChild(this._canvas),this.setDataBox(t||new R.ElementBox),this.invalidate(),V.isTouchable?V.isMSTouchable?new R.charts.ChartMSTouchInteraction(this):(new R.charts.ChartTouchInteraction(this),new R.charts.ChartInteraction(this)):new R.charts.ChartInteraction(this),this.setToolTipEnabled(xe.CHART_TOOLTIP_ENABLED)},D.ext(\"twaver.charts.ChartBase\",R.controls.ViewBase,{__accessor:[\"xGap\",\"yGap\",\"xTranslate\",\"yTranslate\",\"valueVisible\",\"sortFunction\",\"visibleFunction\",\"xTranslateEnabled\",\"yTranslateEnabled\",\"xZoomEnabled\",\"yZoomEnabled\",\"selectTolerance\",\"backgroundVisible\",\"backgroundFill\",\"backgroundFillColor\",\"backgroundOutlineWidth\",\"backgroundOutlineColor\",\"backgroundGradient\",\"backgroundGradientColor\",\"outerZoom\"],__bool:[\"doubleClickToReset\",\"focusOnClick\"],_backgroundVisible:xe.CHART_BACKGROUND_VISIBLE,_backgroundFill:xe.CHART_BACKGROUND_FILL,_backgroundFillColor:xe.CHART_BACKGROUND_FILL_COLOR,_backgroundOutlineWidth:xe.CHART_BACKGROUND_OUTLINE_WIDTH,_backgroundOutlineColor:xe.CHART_BACKGROUND_OUTLINE_COLOR,_backgroundGradient:xe.CHART_BACKGROUND_GRADIENT,_backgroundGradientColor:xe.CHART_BACKGROUND_GRADIENT_COLOR,_selectTolerance:xe.CHART_SELECT_TOLERANCE,_doubleClickToReset:xe.CHART_DOUBLE_CLICK_TO_RESET,_focusOnClick:xe.FOCUS_ON_CLICK,_sortFunction:null,_visibleFunction:null,_canvasWidth:0,_canvasHeight:0,_outerZoomL:1,_xGap:xe.CHART_XGAP,_yGap:xe.CHART_YGAP,_xTranslate:0,_yTranslate:0,_xTranslateEnabled:xe.CHART_XTRANSLATE_ENABLED,_yTranslateEnabled:xe.CHART_YTRANSLATE_ENABLED,_xZoom:1,_yZoom:1,_maxZoom:xe.ZOOM_MAX,_minZoom:xe.ZOOM_MIN,_xZoomEnabled:xe.CHART_XZOOM_ENABLED,_yZoomEnabled:xe.CHART_YZOOM_ENABLED,_valueVisible:xe.CHART_VALUE_VISIBLE,_valueFont:xe.CHART_VALUE_FONT,isToolTipEnabled:function(){return!!this._toolTipListener},setToolTipEnabled:function(t){if(t){if(!this._toolTipListener){var e=this;this._toolTipListener=function(t){xt.showToolTip(t,e.getToolTip(t))},this._canvas.addEventListener(\"mousemove\",this._toolTipListener,!0),this.firePropertyChange(\"toolTipEnabled\",!1,!0)}}else this._toolTipListener&&(xt.hideToolTip(),this._canvas.removeEventListener(\"mousemove\",this._toolTipListener,!0),delete this._toolTipListener,this.firePropertyChange(\"toolTipEnabled\",!0,!1))},getToolTip:function(t){if(this._toolTipInfos){var e=this.getLogicalPoint(t);e.x-=this._xTranslate,e.y-=this._yTranslate;for(var i=this._toolTipInfos.size()-1;i>=0;i--){var n=this._toolTipInfos.get(i);if(n.rect&&W.containsPoint(n.rect,e))return this.getToolTipByData(n.data,n)}}else{var s=this.tryGetDataAt(t);if(s)return this.getToolTipByData(s,{value:this.getValue(s)})}return null},getToolTipByData:function(t,e){return void 0!==e.value?this.formatValueText(e.value,t):null},addToolTipInfo:function(t,e,i,n,s,o,r){this._toolTipInfos&&this._toolTipInfos.add({data:o,rect:{x:t,y:e,width:i,height:n},value:s,index:r})},getLogicalPoint:function(t){return X.getLogicalPoint(this._canvas,t,this._outerZoom)},getTextSize:function(t,e){var i=Y.getTextSize(t,e);return i.width&&(i.width+=4),i},getUniqueColor:function(t,e){if(null==t)return null;var i;if(!e&&(i=this._nonDataColors[t]))return i;var n=Y.getColorArray(t);if(!e)return i=255!=n[3]?t:\"rgba(\"+n[0]+\",\"+n[1]+\",\"+n[2]+\",0.99)\",this._nonDataColors[t]=i,i;var s=\"rgb(\"+n[0]+\",\"+n[1]+\",\"+n[2]+\")\";if(void 0===this._uniqueColors[s]||this._uniqueColors[s]===e);else{var o=1,r=-1,a=1;for(V.isOpera&&(n=[n[0],n[1],n[2]]);n[0]+=o,n[0]>=255?(n[0]=255,o=-1):n[0]<=0&&(n[0]=0,o=1),s=\"rgb(\"+n[0]+\",\"+n[1]+\",\"+n[2]+\")\",void 0!==this._uniqueColors[s]&&this._uniqueColors[s]!==e&&(n[1]+=r,n[1]>=255?(n[1]=255,r=-1):n[1]<=0&&(n[1]=0,r=1),s=\"rgb(\"+n[0]+\",\"+n[1]+\",\"+n[2]+\")\",void 0!==this._uniqueColors[s]&&this._uniqueColors[s]!==e)&&(n[2]+=a,n[2]>=255?(n[2]=255,a=-1):n[2]<=0&&(n[2]=0,a=1),s=\"rgb(\"+n[0]+\",\"+n[1]+\",\"+n[2]+\")\",void 0!==this._uniqueColors[s]&&this._uniqueColors[s]!==e););}return this._uniqueColors[s]=e,s},tryGetDataAt:function(t,e){if((null==e||e<0)&&(e=this._selectTolerance),t.target&&(t=X.getLogicalPoint(this._canvas,arguments[0],this._outerZoom)),!t)return null;var i=t.x-e,n=t.y-e,s=2*e+1,o=2*e+1;try{for(var r=this._canvas.getContext(\"2d\").getImageData(i,n,s,o).data,a=0,h=r.length;a<h;a+=4)if(255===r[a+3]){var l=\"rgb(\"+r[a]+\",\"+r[a+1]+\",\"+r[a+2]+\")\",c=this._uniqueColors[l];if(c)return c}}catch(t){}return null},_getPoint:function(){var t,e;if(2===arguments.length)t=arguments[0],e=arguments[1];else if(arguments[0].target){var i=X.getLogicalPoint(this._canvas,arguments[0],this._outerZoom);if(!i)return null;t=i.x,e=i.y}else t=arguments[0].x,e=arguments[0].y;return{x:t,y:e}},getDataAt:function(){var t=this._getPoint.apply(this,arguments),e=t.x,i=t.y;if(e<0||i<0||e>this._canvasWidth||i>this._canvasHeight)return null;try{var n=this._canvas.getContext(\"2d\").getImageData(e,i,1,1).data;if(255===n[3]){var s=\"rgb(\"+n[0]+\",\"+n[1]+\",\"+n[2]+\")\",o=this._uniqueColors[s];if(o)return o}}catch(t){}return null},getBackgroundRect:function(){return this._backgroundRect},drawBackground:function(t,e){this._backgroundRect=D.clone(e),null!=e&&e.width>0&&e.height>0&&this._backgroundVisible&&(this._backgroundFill&&Y.fill(t,this.getUniqueColor(this._backgroundFillColor),this._backgroundGradient,this.getUniqueColor(this._backgroundGradientColor),e),this._backgroundOutlineWidth>0&&(t.lineWidth=this._backgroundOutlineWidth,t.strokeStyle=this._backgroundOutlineColor),t.beginPath(),t.rect(e.x,e.y,e.width,e.height),t.closePath(),this._backgroundFill&&t.fill(),this._backgroundOutlineWidth>0&&t.stroke())},getName:function(t){return t.getName()},getColor:function(t){return t.getStyle?t.getStyle(\"chart.color\"):t.getClient(\"chart.color\")},getValue:function(t){return t.getStyle?t.getStyle(\"chart.value\"):0},getValueColor:function(t){return t.getStyle?t.getStyle(\"chart.value.color\"):R.Styles.getStyle(\"chart.value.color\")},setValueFont:function(t){if(t!==this._valueFont){var e=t;this._valueFont=t,this.firePropertyChange(\"valueFont\",e,t)}},getValueFont:function(t){if(t){var e=t.getStyle?t.getStyle(\"chart.value.font\"):R.Styles.getStyle(\"chart.value.font\");if(e)return e}return this._valueFont},formatValueText:function(t,e){return t},getCanvasWidth:function(){return this._canvasWidth},getCanvasHeight:function(){return this.canvasHeight},getCanvas:function(){return this._canvas},isVisible:function(t){return!(this._internalVisibleFunction&&!this._internalVisibleFunction(t))&&(!this._visibleFunction||this._visibleFunction(t))},onPropertyChanged:function(t){R.charts.IS_INVALIDATE_PROPERTY[t.property]?this.invalidate():this.invalidateModel()},getDataBox:function(){return this._box},setDataBox:function(t){if(!t)throw\"DataBox can not be null\";if(this._box!==t){var e=this._box;e&&(e.removeDataBoxChangeListener(this.handleDataBoxChange,this),e.removeDataPropertyChangeListener(this.handlePropertyChange,this),e.removeHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel||e.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=t,this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._box.addHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel?this._selectionModel._setDataBox(t):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidateModel(),this.firePropertyChange(\"dataBox\",e,this._box)}},handleDataBoxChange:function(t){this.invalidateModel()},handlePropertyChange:function(t){this.invalidateModel()},handleHierarchyChange:function(t){this.invalidateModel()},handleSelectionChange:function(t){this.invalidateModel()},getUnfilteredDatas:function(){return this._unfilteredDatas?this._unfilteredDatas:this._publishedDatas},getPublishedDatas:function(){return this._publishedDatas},createPublishedDatas:function(){return this._unfilteredDatas=new oe,this._buildChildren(this._box.getRoots(),this._unfilteredDatas),this._sortFunction&&this._unfilteredDatas.sort(this._sortFunction),this._unfilteredDatas.toList(this.isVisible,this)},_buildChildren:function(t,e){t.forEach(function(t){e.add(t),this._buildChildren(t.getChildren(),e)},this)},invalidateModel:function(){this._invalidateModel||(this._invalidateModel=!0,this.invalidate())},validateImpl:function(){this._invalidateModel&&(this._invalidateModel=!1,this._uniqueColors={},this._nonDataColors={},this._publishedDatas=this.createPublishedDatas(),this._publishedDatas.forEach(function(t){t.IStyle?t.getStyle(\"chart.color\")||t.setStyle(\"chart.color\",D.nextColor()):t.getClient(\"chart.color\")||t.setClient(\"chart.color\",D.nextColor())}),this.validateModel());var t=this._canvas.getContext(\"2d\");this._canvasWidth=this._view.clientWidth,this._canvasHeight=this._view.clientHeight,this._canvas.setAttribute(\"width\",this._canvasWidth),this._canvas.setAttribute(\"height\",this._canvasHeight),t.clearRect(0,0,this._canvasWidth,this._canvasHeight),R.Util.makeHighRes(this._canvas),this._canvasWidth>0&&this._canvasHeight>0&&(t.translate(this._xTranslate,this._yTranslate),this._valueTexts=this._valueVisible?new oe:null,this.validateDisplay(t,this._canvasWidth*this._xZoom,this._canvasHeight*this._yZoom),delete this._valueTexts,t.translate(-this._xTranslate,-this._yTranslate))},adjustBounds:function(t){R.charts.ChartBase.superClass.adjustBounds.apply(this,arguments)},validateModel:function(){},validateDisplay:function(t,e,i){},drawLine:function(t,e,i,n,s,o,r){i>0&&(t.lineWidth=i,t.strokeStyle=this.getUniqueColor(e),t.beginPath(),t.moveTo(n,s),t.lineTo(o,r),t.stroke())},drawValueTexts:function(t){this._valueTexts&&this._valueTexts.forEach(function(e){Y.drawText(t,e.text,e,e.font,e.color)})},drawVerticalText:function(t,e,i,n,s){s=this.getUniqueColor(s),t.translate(i.x,i.y),t.rotate(-Math.PI/2),Y.drawText(t,e,null,n,s),t.rotate(Math.PI/2),t.translate(-i.x,-i.y)},_getValueTextInfo:function(t,e){if(this._valueTexts){var i=this.formatValueText(e,t);if(i&&\"\"!==i){var n=this.getValueColor(t),s={text:i,font:this.getValueFont(t),color:this.getUniqueColor(n,t)};return this._valueTexts.add(s),s}}return null},getMaxZoom:function(){return this._maxZoom},setMaxZoom:function(t){if(!(t<0)){var e=this._maxZoom;this._maxZoom=t,this.firePropertyChange(\"maxZoom\",e,t),this.getXZoom()>t&&this.setXZoom(t,!1),this.getYZoom()>t&&this.setYZoom(t,!1)}},getMinZoom:function(){return this._minZoom},setMinZoom:function(t){if(!(t<0)){var e=this._minZoom;this._minZoom=t,this.firePropertyChange(\"minZoom\",e,t),this.getXZoom()<t&&this.setXZoom(t),this.getYZoom()<t&&this.setYZoom(t)}},zoomIn:function(t){null==t&&(t=xe.ZOOM_ANIMATE),t?R.animate.AnimateManager.start(new R.animate.AnimateXYZoom(this,this._xZoom*xe.ZOOM_INCREMENT,this._yZoom*xe.ZOOM_INCREMENT)):(this.xZoomIn(!1),this.yZoomIn(!1))},zoomOut:function(t){null==t&&(t=xe.ZOOM_ANIMATE),t?R.animate.AnimateManager.start(new R.animate.AnimateXYZoom(this,this._xZoom/xe.ZOOM_INCREMENT,this._yZoom/xe.ZOOM_INCREMENT)):(this.xZoomOut(!1),this.yZoomOut(!1))},zoomReset:function(t){null==t&&(t=xe.ZOOM_ANIMATE),t?R.animate.AnimateManager.start(new R.animate.AnimateXYZoom(this,1,1)):(this.xZoomReset(!1),this.yZoomReset(!1))},getXZoom:function(){return this._xZoom},onXZoomChanged:function(t,e){},xZoomIn:function(t){this.setXZoom(this._xZoom*xe.ZOOM_INCREMENT,t)},xZoomOut:function(t){this.setXZoom(this._xZoom/xe.ZOOM_INCREMENT,t)},xZoomReset:function(t){this.setXZoom(1,t)},setXZoom:function(t,e){if(D.num(t)&&!(t<=0)&&(t<this._minZoom&&(t=this._minZoom),t>this._maxZoom&&(t=this._maxZoom),t!==this.xZoom))if(null==e&&(e=xe.ZOOM_ANIMATE),e)R.animate.AnimateManager.start(new R.animate.AnimateXZoom(this,t));else{var i=this._xZoom,n=this._xTranslate-(this._canvasWidth/2-this._xTranslate)/i*(t-i);this._xZoom=t,this.firePropertyChange(\"xZoom\",i,t),this.onXZoomChanged(i,t),this.setXTranslate(n)}},getYZoom:function(){return this._yZoom},onYZoomChanged:function(t,e){},yZoomIn:function(t){this.setYZoom(this._yZoom*xe.ZOOM_INCREMENT,t)},yZoomOut:function(t){this.setYZoom(this._yZoom/xe.ZOOM_INCREMENT,t)},yZoomReset:function(t){this.setYZoom(1,t)},setYZoom:function(t,e){if(D.num(t)&&!(t<=0)&&(t<this._minZoom&&(t=this._minZoom),t>this._maxZoom&&(t=this._maxZoom),t!==this.YZoom))if(null==e&&(e=xe.ZOOM_ANIMATE),e)R.animate.AnimateManager.start(new R.animate.AnimateYZoom(this,t));else{var i=this._yZoom,n=this._yTranslate-(this._canvasHeight/2-this._yTranslate)/i*(t-i);this._yZoom=t,this.firePropertyChange(\"yZoom\",i,t),this.onYZoomChanged(i,t),this.setYTranslate(n)}}}),R.charts.ScaleChart=function(t){R.charts.ScaleChart.superClass.constructor.apply(this,arguments)},D.ext(\"twaver.charts.ScaleChart\",R.charts.ChartBase,{__accessor:[\"upperLimit\",\"lowerLimit\",\"xAxisText\",\"xAxisLineColor\",\"xAxisLineWidth\",\"xAxisTextColor\",\"xAxisTextFont\",\"yAxisText\",\"yAxisLineColor\",\"yAxisLineWidth\",\"yAxisTextColor\",\"yAxisTextFont\",\"xScaleTexts\",\"xScaleTextFont\",\"xScaleTextColor\",\"xScaleTextOrientation\",\"yScaleTextVisible\",\"yScaleTextColor\",\"yScaleTextFont\",\"yScaleLineColor\",\"yScaleLineWidth\",\"yScaleValueGap\",\"yScalePixelGap\",\"yScaleMinTextVisible\",\"valueSpanCount\"],_reset:function(){this._map={},this._max=0,this._min=0,this._columnCount=this._xScaleTexts?this._xScaleTexts.size():0,null!=this._upperLimit&&(this._max=this._upperLimit),null!=this._lowerLimit&&(this._min=this._lowerLimit)},getMin:function(){return this._min},getMax:function(){return this._max},getRange:function(){return this._range},getColumnCount:function(){return this._columnCount},getColumnWidth:function(){return this._columnWidth},getValues:function(t){return t.getStyle?t.getStyle(\"chart.values\"):null},formatYScaleText:function(t){return t.toFixed(2)},_initRange:function(){null==this._lowerLimit&&(this._min>=this._max&&(this._min=this._max-.1*Math.abs(this._max)),this._min=this._min-.1*(this._max-this._min)),this._range=this._max-this._min},_initValuesProportion:function(){this._publishedDatas.forEach(function(t){var e=this._map[t.getId()];e.values.forEach(function(t){null==t?e.proportions.add(null):e.proportions.add(0==this._range?0:t/this._range)},this)},this)},_commonValidateModel:function(){this._publishedDatas.forEach(function(t){var e=new oe(this.getValues(t));e.size()>this._columnCount&&(this._columnCount=e.size());var i={data:t,values:e,proportions:new oe,color:this.getUniqueColor(this.getColor(t),t)};this._initInfo&&this._initInfo(t,i),this._map[t.getId()]=i,null!=this._upperLimit&&null!=this._lowerLimit||e.forEach(function(t){null!=t&&(null==this._upperLimit&&t>this._max&&(this._max=t),null==this._lowerLimit&&t<this._min&&(this._min=t))},this)},this),this._initRange(),this._initValuesProportion()},validateDisplay:function(t,e,i){var n=0;this._xAxisText&&(n=this.getTextSize(this._xAxisTextFont,this._xAxisText).height);var s=0;this._xScaleTexts&&this._xScaleTexts.forEach(function(t){var e=this.getTextSize(this._xScaleTextFont,t),i=\"vertical\"===this._xScaleTextOrientation?e.width:e.height;i>s&&(s=i)},this);var o=i-this._yGap-n-s,r=o-this._yGap,a=null==this._upperLimit?.9*r:r,h=0;this._yAxisText&&(h=this.getTextSize(this._yAxisTextFont,this._yAxisText).height);var l,c;this._yScaleValueGap>0?(l=Math.max(this._yScaleValueGap/this._range*a,1),c=this._yScaleValueGap):(l=Math.max(this._yScalePixelGap,1),c=this._range*(l/a));var d,u,_=0,g=new oe;if(this._yScaleTextVisible){d=this._yScaleMinTextVisible?0:l;for(var f=this._min+(this._yScaleMinTextVisible?0:c);d<=r+1;){if(u=this.formatYScaleText(f)){var v=this.getTextSize(this._yScaleTextFont,u);v.width>_&&(_=v.width),g.add({text:u,size:v,cursor:d})}d+=l,f+=c}}var m={x:this._xGap+h+_,y:this._yGap,width:e-this._xGap-h-_-this._xGap,height:i-this._yGap-s-n-this._yGap};if(this.drawBackground(t,m),this._columnCount>0?this._columnWidth=m.width/(3*this._columnCount+1)*2:this._columnWidth=m.width/2,0===this._columnWidth&&(this._columnWidth=1),this._yScaleLineWidth>0)for(d=0;d<=r+1;)this.drawLine(t,this._yScaleLineColor,this._yScaleLineWidth,m.x,o-d,m.x+m.width,o-d),d+=l;this._xAxisText&&Y.drawText(t,this._xAxisText,{x:m.x+m.width/2,y:o+s+n/2},this._xAxisTextFont,this.getUniqueColor(this._xAxisTextColor)),this._yAxisText&&this.drawVerticalText(t,this._yAxisText,{x:this._xGap+h/2,y:r/2+this._yGap},this._yAxisTextFont,this.getUniqueColor(this._yAxisTextColor)),this.drawLine(t,this._yAxisLineColor,this._yAxisLineWidth,m.x,m.y+m.height,m.x,m.y);var p=this.getUniqueColor(this._yScaleTextColor);g.forEach(function(e){var i={x:this._xGap+h+_-e.size.width/2,y:o-e.cursor};Y.drawText(t,e.text,i,this._yScaleTextFont,p)},this);var w=m.y+m.height+s/2;p=this.getUniqueColor(this._xScaleTextColor);for(var y=this._xScaleLineWidth>0?this.getUniqueColor(this._xScaleLineColor):null,A=0;A<this._columnCount;A++){var x=m.x+this._columnWidth*(1+1.5*A);if(this._xScaleTexts&&A<this._xScaleTexts.size()&&(u=this._xScaleTexts.get(A))){var C={x:x,y:w};\"vertical\"===this._xScaleTextOrientation?this.drawVerticalText(t,u,C,this._yScaleTextFont,p):this._valueSpanCount?A%this._valueSpanCount==0&&Y.drawText(t,u,C,this._xScaleTextFont,p):Y.drawText(t,u,C,this._xScaleTextFont,p)}\"default\"!==this._type&&y&&(this._valueSpanCount?A%this._valueSpanCount==0&&this.drawLine(t,y,this._xScaleLineWidth,x,m.y+m.height,x,m.y):this.drawLine(t,y,this._xScaleLineWidth,x,m.y+m.height,x,m.y))}var E=o+this._min/c*l;this._publishedDatas.size()>0&&this._columnCount>0&&this.drawContent(t,m,a,E),this.drawLine(t,this._xAxisLineColor,this._xAxisLineWidth,m.x,m.y+m.height,m.x+m.width,m.y+m.height)}}),R.charts.PieChart=function(t){this._sum=0,this._map={},R.charts.PieChart.superClass.constructor.apply(this,arguments)},D.ext(\"twaver.charts.PieChart\",R.charts.ChartBase,{__accessor:[\"type\",\"selectOffset\",\"startAngle\",\"shadowColor\",\"shadowOffset\",\"lineRate\",\"donutRate\",\"valuePosition\"],_type:xe.PIECHART_TYPE,_lineRate:xe.PIECHART_LINE_RATE,_donutRate:xe.PIECHART_DONUT_RATE,_startAngle:xe.PIECHART_START_ANGLE,_shadowColor:xe.PIECHART_SHADOW_COLOR,_shadowOffset:xe.PIECHART_SHADOW_OFFSET,_selectOffset:xe.PIECHART_SELECT_OFFSET,_valuePosition:xe.PIECHART_VALUE_POSITION,getSum:function(){return this._sum},validateModel:function(){this._sum=0,this._map={},this._publishedDatas.forEach(function(t){var e=this.getValue(t);this._map[t.getId()]={data:t,value:e,color:this.getUniqueColor(this.getColor(t),t)},this._sum+=e},this);var t=this._startAngle;this._publishedDatas.forEach(function(e){var i=this._map[e.getId()];i.proportion=0===this._sum?0:i.value/this._sum,\"line\"!==this._type&&(i.startAngle=t,i.arc=i.proportion*Math.PI*2,t+=i.arc)},this)},validateDisplay:function(t,e,i){var n={x:this._xGap,y:this._yGap,width:e-2*this._xGap,height:i-2*this._yGap};if(this.drawBackground(t,n),W.grow(n,-4,-4),!(n.width<=0||n.height<=0)){var s=this._shadowOffset;if(s>0&&(t.shadowOffsetX=s,t.shadowOffsetY=s,t.shadowBlur=1.5*s,t.shadowColor=this._shadowColor),\"oval\"===this._type||\"circle\"===this._type){var o=n.x+n.width/2,r=n.y+n.height/2,a=n.width/2,h=n.height/2;\"circle\"===this._type&&(a=h=Math.min(a,h)),this._publishedDatas.forEach(function(e){var i=this._map[e.getId()];if(0!==i.arc){var n=0,s=0;if(this.isSelected(e)){var l=i.startAngle+i.arc/2;n=Math.cos(l)*this._selectOffset,s=Math.sin(l)*this._selectOffset*h/a}t.fillStyle=i.color,t.beginPath(),t.moveTo(o+n,r-s),Y.drawArc(t,o+n,r-s,i.startAngle,i.arc,a,h,!0),t.closePath(),t.fill();var c=this._getValueTextInfo(e,i.value);if(c){l=i.startAngle+i.arc/2;c.x=o+n+Math.cos(l)*a*this._valuePosition,c.y=r-s-Math.sin(l)*h*this._valuePosition}}},this)}else if(\"donut\"===this._type||\"ovalDonut\"===this._type){o=n.x+n.width/2,r=n.y+n.height/2,a=n.width/2,h=n.height/2;\"donut\"===this._type&&(a=h=Math.min(a,h)),this._publishedDatas.forEach(function(e){var i=this._map[e.getId()];if(0!==i.arc){var n=0,s=0;if(this.isSelected(e)){var l=i.startAngle+i.arc/2;n=Math.cos(l)*this._selectOffset,s=Math.sin(l)*this._selectOffset*h/a}var c=o+Math.cos(i.startAngle)*a*this._donutRate,d=r-Math.sin(i.startAngle)*h*this._donutRate,u=o+Math.cos(i.startAngle+i.arc)*a*this._donutRate,_=r-Math.sin(i.startAngle+i.arc)*h*this._donutRate;t.fillStyle=i.color,t.beginPath(),t.moveTo(c+n,d-s),Y.drawArc(t,o+n,r-s,i.startAngle,i.arc,a,h,!0),t.lineTo(u+n,_-s),Y.drawArc(t,o+n,r-s,i.startAngle+i.arc,-i.arc,a*this._donutRate,h*this._donutRate,!0),t.closePath(),t.fill();var g=this._getValueTextInfo(e,i.value);if(g){l=i.startAngle+i.arc/2;var f=this._donutRate+(1-this._donutRate)*this._valuePosition;g.x=o+n+Math.cos(l)*a*f,g.y=r-s-Math.sin(l)*h*f}}},this)}else if(\"line\"===this._type){var l=n.height*this._lineRate;n.y=n.y+n.height/2-l/2,n.height=l;var c=n.x;this._publishedDatas.forEach(function(e){var i=this._map[e.getId()],s=n.width*i.proportion;if(0!==s){t.beginPath(),t.fillStyle=i.color;var o=this.isSelected(e)?-this._selectOffset:0;t.rect(c,n.y+o,s,n.height),t.closePath(),t.fill();var r=this._getValueTextInfo(e,i.value);r&&(r.x=c+s/2,r.y=n.y+n.height+o-n.height*this._valuePosition),c+=s}},this)}this._shadowOffset>0&&(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0),this.drawValueTexts(t)}}}),R.charts.BarChart=function(t){R.charts.BarChart.superClass.constructor.apply(this,arguments)},D.ext(\"twaver.charts.BarChart\",R.charts.ScaleChart,{__accessor:[\"type\"],_upperLimit:xe.BARCHART_UPPER_LIMIT,_lowerLimit:xe.BARCHART_LOWER_LIMIT,_type:xe.BARCHART_TYPE,_xAxisText:null,_xAxisTextColor:xe.BARCHART_XAXIS_TEXT_COLOR,_xAxisTextFont:xe.BARCHART_XAXIS_TEXT_FONT,_xAxisLineColor:xe.BARCHART_XAXIS_LINE_COLOR,_xAxisLineWidth:xe.BARCHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:xe.BARCHART_YAXIS_TEXT_COLOR,_yAxisTextFont:xe.BARCHART_YAXIS_TEXT_FONT,_yAxisLineColor:xe.BARCHART_YAXIS_LINE_COLOR,_yAxisLineWidth:xe.BARCHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:xe.BARCHART_XSCALE_TEXT_FONT,_xScaleTextColor:xe.BARCHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:xe.BARCHART_XSCALE_TEXT_ORIENTATION,_yScaleTextVisible:xe.BARCHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:xe.BARCHART_YSCALE_TEXT_COLOR,_yScaleTextFont:xe.BARCHART_YSCALE_TEXT_FONT,_yScaleLineColor:xe.BARCHART_YSCALE_LINE_COLOR,_yScaleLineWidth:xe.BARCHART_YSCALE_LINE_WIDTH,_yScaleValueGap:xe.BARCHART_YSCALE_VALUE_GAP,_yScalePixelGap:xe.BARCHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:xe.BARCHART_YSCALE_MIN_TEXT_VISIBLE,validateModel:function(){var t=this._type+\"ValidateModel\";this[t]&&(this._reset(),this[t]())},defaultValidateModel:function(){this._columnCount=this._publishedDatas.size(),this._publishedDatas.forEach(function(t){var e=this.getValue(t);null==this._upperLimit&&e>this._max&&(this._max=e),null==this._lowerLimit&&e<this._min&&(this._min=e),this._map[t.getId()]={data:t,value:e,color:this.getUniqueColor(this.getColor(t),t)}},this),this._initRange(),this._publishedDatas.forEach(function(t){var e=this._map[t.getId()];e.proportion=0==this._range?0:e.value/this._range},this)},layerValidateModel:function(){this._commonValidateModel()},groupValidateModel:function(){this._commonValidateModel()},stackValidateModel:function(){if(this._publishedDatas.forEach(function(t){var e=new oe(this.getValues(t));e.size()>this._columnCount&&(this._columnCount=e.size());var i={data:t,values:e,proportions:new oe,color:this.getUniqueColor(this.getColor(t),t)};this._map[t.getId()]=i},this),null==this._upperLimit||null==this._lowerLimit)for(var t=0;t<this._columnCount;t++){var e=0,i=0;this._publishedDatas.forEach(function(n){var s=this._map[n.getId()];if(s.values.size()>t){var o=s.values.get(t);null!=o&&(o>=0?e+=o:i+=o)}},this),null==this._upperLimit&&e>this._max&&(this._max=e),null==this._lowerLimit&&i<this._min&&(this._min=i)}this._initRange(),this._initValuesProportion()},percentValidateModel:function(){this._publishedDatas.forEach(function(t){var e=new oe(this.getValues(t));e.size()>this._columnCount&&(this._columnCount=e.size());var i={data:t,values:e,proportions:new oe,color:this.getUniqueColor(this.getColor(t),t)};this._map[t.getId()]=i},this);for(var t=new oe,e=0;e<this._columnCount;e++){var i=0;this._publishedDatas.forEach(function(t){var n=this._map[t.getId()];if(n.values.size()>e){var s=n.values.get(e);null!=s&&(i+=s)}},this),t.add(i)}for(e=0;e<this._columnCount;e++)this._publishedDatas.forEach(function(i){var n=this._map[i.getId()],s=t.get(e);if(0!==s&&n.values.size()>e){var o=n.values.get(e);if(null!=o)return void n.proportions.add(o/s)}n.proportions.add(null)},this);this._min=0,this._max=1,this._range=1},drawRect:function(t,e,i,n,s,o,r){t.fillStyle=e,i&&this._selectInfos.add({x:n,y:s,w:o,h:r,color:this.getUniqueColor(Y.darker(e))}),t.beginPath(),t.rect(n,s,o,r),t.closePath(),t.fill()},drawContent:function(t,e,i,n){this._selectInfos=new oe,this._toolTipInfos=this.isToolTipEnabled()?new oe:null,\"default\"===this._type?this.drawDefaultContent(t,e,i,n):\"group\"===this._type?this.drawGroupContent(t,e,i,n):\"percent\"===this._type?this.drawPercentContent(t,e,i,n):\"stack\"===this._type?this.drawStackContent(t,e,i,n):\"layer\"===this._type&&this.drawLayerContent(t,e,i,n),this.drawValueTexts(t),this._selectInfos.forEach(function(e){t.lineWidth=2,t.strokeStyle=e.color,t.beginPath(),t.rect(e.x,e.y,e.w,e.h),t.closePath(),t.stroke()},this),delete this._selectInfos},drawDefaultContent:function(t,e,i,n){for(var s=this._publishedDatas.size(),o=this._columnWidth,r=0;r<s;r++){var a=this._publishedDatas.get(r),h=this._map[a.getId()],l=e.x+o*(.5+1.5*r),c=Math.abs(i*h.proportion),d=h.proportion>0?n-c:n;this.drawRect(t,h.color,this.isSelected(a),l,d,o,c),this.addToolTipInfo(l,d,o,c,h.value,a);var u=this._getValueTextInfo(a,h.value);if(u){var _=this.getTextSize(u.font,u.text);u.x=l+o/2,u.y=d-_.height/2+1}}},drawPercentContent:function(t,e,i,n){this.drawStackContent(t,e,i,n)},drawStackContent:function(t,e,i,n){for(var s=this._columnCount,o=this._columnWidth,r=0;r<s;r++){var a=n,h=e.x+o*(.5+1.5*r);this._publishedDatas.forEach(function(e){var n=this._map[e.getId()];if(r<n.proportions.size()){var s=n.proportions.get(r);if(null!=s){var l=i*s;a-=l,this.drawRect(t,n.color,this.isSelected(e),h,a,o,l),this.addToolTipInfo(h,a,o,l,n.values.get(r),e);var c=this._getValueTextInfo(e,n.values.get(r));c&&(c.x=h+o/2,c.y=a+l/2)}}},this)}},drawLayerContent:function(t,e,i,n){for(var s=this._publishedDatas.size(),o=this._columnCount,r=this._columnWidth,a=3*r/8/s,h=0;h<o;h++){var l=e.x+r*(.5+1.5*h),c=0;this._publishedDatas.forEach(function(e){var o=this._map[e.getId()];if(h<o.proportions.size()){var d=o.proportions.get(h);if(null!=d){var u=i*d,_=n-u,g=l+r/2-r/8-a*(s-c),f=2*(r/8+a*(s-c));this.drawRect(t,o.color,this.isSelected(e),g,_,f,u),this.addToolTipInfo(g,_,f,u,o.values.get(h),e);var v=this._getValueTextInfo(e,o.values.get(h));if(v){var m=this.getTextSize(v.font,v.text);v.x=g+f/2,v.y=_-m.height/2+1}}}c++},this)}},drawGroupContent:function(t,e,i,n){for(var s=this._publishedDatas.size(),o=this._columnCount,r=this._columnWidth,a=r/s,h=0;h<o;h++){var l=e.x+r*(.5+1.5*h),c=0;this._publishedDatas.forEach(function(e){var s=this._map[e.getId()];if(h<s.proportions.size()){var o=s.proportions.get(h);if(null!=o){var r=i*o,d=n-r;this.drawRect(t,s.color,this.isSelected(e),l+a*c,d,a,r),this.addToolTipInfo(l+a*c,d,a,r,s.values.get(h),e);var u=this._getValueTextInfo(e,s.values.get(h));if(u){var _=this.getTextSize(u.font,u.text);u.x=l+a*c+a/2,u.y=d-_.height/2+1}}}c++},this)}}}),R.charts.LineChart=function(t){R.charts.LineChart.superClass.constructor.apply(this,arguments),this._selectTolerance=2},D.ext(\"twaver.charts.LineChart\",R.charts.ScaleChart,{__accessor:[\"xScaleLineColor\",\"xScaleLineWidth\",\"interruptable\"],_interruptable:xe.LINECHART_INTERRUPTABLE,_upperLimit:xe.LINECHART_UPPER_LIMIT,_lowerLimit:xe.LINECHART_LOWER_LIMIT,_xAxisText:null,_xAxisTextColor:xe.LINECHART_XAXIS_TEXT_COLOR,_xAxisTextFont:xe.LINECHART_XAXIS_TEXT_FONT,_xAxisLineColor:xe.LINECHART_XAXIS_LINE_COLOR,_xAxisLineWidth:xe.LINECHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:xe.LINECHART_YAXIS_TEXT_COLOR,_yAxisTextFont:xe.LINECHART_YAXIS_TEXT_FONT,_yAxisLineColor:xe.LINECHART_YAXIS_LINE_COLOR,_yAxisLineWidth:xe.LINECHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:xe.LINECHART_XSCALE_TEXT_FONT,_xScaleTextColor:xe.LINECHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:xe.LINECHART_XSCALE_TEXT_ORIENTATION,_xScaleLineColor:xe.LINECHART_XSCALE_LINE_COLOR,_xScaleLineWidth:xe.LINECHART_XSCALE_LINE_WIDTH,_valueSpanCount:xe.LINECHART_VALUESPANCOUNT,_yScaleTextVisible:xe.LINECHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:xe.LINECHART_YSCALE_TEXT_COLOR,_yScaleTextFont:xe.LINECHART_YSCALE_TEXT_FONT,_yScaleLineColor:xe.LINECHART_YSCALE_LINE_COLOR,_yScaleLineWidth:xe.LINECHART_YSCALE_LINE_WIDTH,_yScaleValueGap:xe.LINECHART_YSCALE_VALUE_GAP,_yScalePixelGap:xe.LINECHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:xe.LINECHART_YSCALE_MIN_TEXT_VISIBLE,getLineWidth:function(t){return t.getStyle?t.getStyle(\"chart.line.width\"):R.Styles.getStyle(\"chart.line.width\")},getMarkerShape:function(t){return t.getStyle?t.getStyle(\"chart.marker.shape\"):R.Styles.getStyle(\"chart.marker.shape\")},getMarkerSize:function(t){return t.getStyle?t.getStyle(\"chart.marker.size\"):R.Styles.getStyle(\"chart.marker.size\")},_initInfo:function(t,e){e.markerShape=this.getMarkerShape(t),e.markerSize=this.getMarkerSize(t),e.lineWidth=this.getLineWidth(t),this.isSelected(t)&&(e.lineWidth+=2)},validateModel:function(){this._reset(),this._commonValidateModel()},getPointIndexAt:function(){var t=this._getPoint.apply(this,arguments),e=this.tryGetDataAt(t);if(!e)return-1;for(var i,n=this._map[e.getId()],s=n.points,o=n.markerSize,r=0,a=s.size();r<a;r++)if((i=s.get(r))&&W.getDistance(t,i)<=o)return r;return-1},drawContent:function(t,e,i,n){this._toolTipInfos=this.isToolTipEnabled()?new oe:null,this._publishedDatas.forEach(function(s){var o=this._map[s.getId()],r=o.markerSize>0?new oe:null;t.strokeStyle=o.color,t.lineWidth=o.lineWidth,t.beginPath();var a=o.proportions,h=null,l=a.size(),c=new oe;o.points=c;for(var d=0;d<l;d++){var u=a.get(d);if(null!=u){var _={x:e.x+this._columnWidth*(1+1.5*d),y:n-i*u};c.add(_),null==h?t.moveTo(_.x,_.y):t.lineTo(_.x,_.y);var g=o.values.get(d),f=this._getValueTextInfo(s,g);if(f){var v=this.getTextSize(f.font,f.text);f.x=_.x,f.y=_.y-v.height/2+2}r&&r.add({point:_,value:g,data:s,index:d}),h=_}else this._interruptable&&(h=null,c.add(null))}if(t.stroke(),r){var m=o.markerSize/2;r.forEach(function(e){t.fillStyle=o.color;var i=e.point.x-m,n=e.point.y-m,s=o.markerSize,r=o.markerSize;Y.drawVector(t,o.markerShape,null,i,n,s,r),t.fill(),this.addToolTipInfo(i,n,s,r,e.value,e.data,e.index)},this)}},this),this.drawValueTexts(t)}}),R.charts.BubbleChart=function(t){R.charts.BubbleChart.superClass.constructor.apply(this,arguments)},D.ext(\"twaver.charts.BubbleChart\",R.charts.ScaleChart,{__accessor:[\"xAxisUpperLimit\",\"xAxisLowerLimit\",\"xScaleLineColor\",\"xScaleLineWidth\",\"selectShadowColor\",\"selectShadowOffset\"],_upperLimit:xe.BUBBLECHART_UPPER_LIMIT,_lowerLimit:xe.BUBBLECHART_LOWER_LIMIT,_xAxisUpperLimit:xe.BUBBLECHART_XAXIS_UPPER_LIMIT,_xAxisLowerLimit:xe.BUBBLECHART_XAXIS_LOWER_LIMIT,_xAxisText:null,_xAxisTextColor:xe.BUBBLECHART_XAXIS_TEXT_COLOR,_xAxisTextFont:xe.BUBBLECHART_XAXIS_TEXT_FONT,_xAxisLineColor:xe.BUBBLECHART_XAXIS_LINE_COLOR,_xAxisLineWidth:xe.BUBBLECHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:xe.BUBBLECHART_YAXIS_TEXT_COLOR,_yAxisTextFont:xe.BUBBLECHART_YAXIS_TEXT_FONT,_yAxisLineColor:xe.BUBBLECHART_YAXIS_LINE_COLOR,_yAxisLineWidth:xe.BUBBLECHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:xe.BUBBLECHART_XSCALE_TEXT_FONT,_xScaleTextColor:xe.BUBBLECHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:xe.BUBBLECHART_XSCALE_TEXT_ORIENTATION,_xScaleLineColor:xe.BUBBLECHART_XSCALE_LINE_COLOR,_xScaleLineWidth:xe.BUBBLECHART_XSCALE_LINE_WIDTH,_yScaleTextVisible:xe.BUBBLECHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:xe.BUBBLECHART_YSCALE_TEXT_COLOR,_yScaleTextFont:xe.BUBBLECHART_YSCALE_TEXT_FONT,_yScaleLineColor:xe.BUBBLECHART_YSCALE_LINE_COLOR,_yScaleLineWidth:xe.BUBBLECHART_YSCALE_LINE_WIDTH,_yScaleValueGap:xe.BUBBLECHART_YSCALE_VALUE_GAP,_yScalePixelGap:xe.BUBBLECHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:xe.BUBBLECHART_YSCALE_MIN_TEXT_VISIBLE,_selectShadowColor:xe.BUBBLECHART_SELECT_SHADOW_COLOR,_selectShadowOffset:xe.BUBBLECHART_SELECT_SHADOW_OFFSET,_resetX:function(){this._xMax=0,this._xMin=0,null!=this._xAxisUpperLimit&&(this._xMax=this._xAxisUpperLimit),null!=this._xAxisLowerLimit&&(this._xMin=this._xAxisLowerLimit)},getXMin:function(){return this._xMin},getXMax:function(){return this._xMax},getXRange:function(){return this._xRange},getShape:function(t){return t.getStyle?t.getStyle(\"chart.bubble.shape\"):R.Styles.getStyle(\"chart.bubble.shape\")},getSize:function(t,e){return e},getNames:function(t){return t.getStyle?t.getStyle(\"chart.names\"):R.Styles.getStyle(\"chart.names\")},getXAxisValues:function(t){return t.getStyle?t.getStyle(\"chart.xaxis.values\"):R.Styles.getStyle(\"chart.xaxis.values\")},getYAxisValues:function(t){return t.getStyle?t.getStyle(\"chart.yaxis.values\"):R.Styles.getStyle(\"chart.yaxis.values\")},_initXRange:function(){null==this._xAxisLowerLimit&&(this._xMin>=this._xMax&&(this._xMin=this._xMax-.1*Math.abs(this._xMax)),this._xMin=this._xMin-.1*(this._xMax-this._xMin)),this._xRange=this._xMax-this._xMin},_initXYValuesProportion:function(){this._publishedDatas.forEach(function(t){var e=this._map[t.getId()];e.xAxisValues.forEach(function(t){null==t?e.xAxisProportions.add(null):e.xAxisProportions.add(0==this._xRange?0:t/this._xRange)},this),e.yAxisValues.forEach(function(t){null==t?e.yAxisProportions.add(null):e.yAxisProportions.add(0==this._range?0:t/this._range)},this)},this)},validateModel:function(){this._reset(),this._resetX(),this._columnCount=null==this._xScaleTexts?0:this._xScaleTexts.size(),this._publishedDatas.forEach(function(t){var e=new oe(this.getYAxisValues(t)),i=new oe(this.getXAxisValues(t)),n=new oe(this.getValues(t));n.size()>this._columnCount&&(this._columnCount=n.size());var s={data:t,values:n,yAxisValues:e,xAxisValues:i,yAxisProportions:new oe,xAxisProportions:new oe,color:this.getUniqueColor(this.getColor(t),t),anchorShape:this.getShape(t)};this._map[t.getId()]=s,null!=this._upperLimit&&null!=this._lowerLimit||e.forEach(function(t){null!=t&&(null==this._upperLimit&&t>this._max&&(this._max=t),null==this._lowerLimit&&t<this._min&&(this._min=t))},this),null!=this._upperLimit&&null!=this._lowerLimit||i.forEach(function(t){null!=t&&(null==this._xAxisUpperLimit&&t>this._xMax&&(this._xMax=t),null==this._xAxisLowerLimit&&t<this._xMin&&(this._xMin=t))},this)},this),this._initRange(),this._initXRange(),this._initXYValuesProportion()},drawContent:function(t,e,i,n){this._toolTipInfos=this.isToolTipEnabled()?new oe:null,this._publishedDatas.forEach(function(s){var o=this._map[s.getId()],r=o.yAxisProportions,a=o.xAxisProportions,h=o.values,l=o.yAxisProportions.size(),c=this._selectShadowOffset;this.isSelected(s)&&c>0?(t.shadowOffsetX=c,t.shadowOffsetY=c,t.shadowBlur=2*c,t.shadowColor=this._selectShadowColor):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0,t.shadowColor=o.color),t.fillStyle=o.color;for(var d=0;d<l;d++){var u=r.get(d),_=a.get(d);if(null!=u){var g={x:e.x+e.width*_,y:n-i*u},f=h.get(d),v=this.getSize(s,f),m=g.x-(c=v/2),p=g.y-c,w=v,y=v;Y.drawVector(t,o.anchorShape,null,m,p,w,y),t.fill(),this.addToolTipInfo(m,p,w,y,f,s,d);var A=this._getValueTextInfo(s,f);if(A){v=this.getTextSize(A.font,A.text);A.x=g.x,A.y=g.y}}}},this),this.drawValueTexts(t)}}),R.charts.DialChart=function(t){R.charts.DialChart.superClass.constructor.apply(this,arguments)},D.ext(\"twaver.charts.DialChart\",R.charts.ChartBase,{__accessor:[\"upperLimit\",\"lowerLimit\",\"startAngle\",\"endAngle\",\"innerRadius\",\"colorRangeFillColor\",\"outlineWidth\",\"outlineColor\",\"majorScaleCount\",\"majorScaleLineWidth\",\"majorScaleLineLength\",\"majorScaleLineColor\",\"minorScaleCount\",\"minorScaleLineWidth\",\"minorScaleLineLength\",\"minorScaleLineColor\",\"scaleTextVisible\",\"scaleUpperLimitTextVisible\",\"scaleLowerLimitTextVisible\",\"scaleTextFont\",\"scaleTextColor\",\"pivotRadius\",\"pivotFillColor\",\"pivotOutlineWidth\",\"pivotOutlineColor\",\"pivotGradient\",\"pivotGradientColor\",\"valuePosition\",\"colorRangeList\",\"innerDarkerRadius\",\"outerBrighterRadius\",\"selectShadowColor\",\"selectShadowOffset\"],__bool:[\"scaleInside\",\"pivotFill\"],_upperLimit:xe.DIALCHART_UPPER_LIMIT,_lowerLimit:xe.DIALCHART_LOWER_LIMIT,_startAngle:xe.DIALCHART_START_ANGLE,_endAngle:xe.DIALCHART_END_ANGLE,_innerRadius:xe.DIALCHART_INNER_RADIUS,_colorRangeFillColor:xe.DIALCHART_COLOR_RANGE_FILL_COLOR,_outlineWidth:xe.DIALCHART_OUTLINE_WIDTH,_outlineColor:xe.DIALCHART_OUTLINE_COLOR,_scaleInside:xe.DIALCHART_SCALE_INSIDE,_majorScaleCount:xe.DIALCHART_MAJOR_SCALE_COUNT,_majorScaleLineWidth:xe.DIALCHART_MAJOR_SCALE_LINE_WIDTH,_majorScaleLineLength:xe.DIALCHART_MAJOR_SCALE_LINE_LENGTH,_majorScaleLineColor:xe.DIALCHART_MAJOR_SCALE_LINE_COLOR,_minorScaleCount:xe.DIALCHART_MINOR_SCALE_COUNT,_minorScaleLineWidth:xe.DIALCHART_MINOR_SCALE_LINE_WIDTH,_minorScaleLineLength:xe.DIALCHART_MINOR_SCALE_LINE_LENGTH,_minorScaleLineColor:xe.DIALCHART_MINOR_SCALE_LINE_COLOR,_scaleTextVisible:xe.DIALCHART_SCALE_TEXT_VISIBLE,_scaleUpperLimitTextVisible:xe.DIALCHART_SCALE_UPPER_LIMIT_TEXT_VISIBLE,_scaleLowerLimitTextVisible:xe.DIALCHART_SCALE_LOWER_LIMIT_TEXT_VISIBLE,_scaleTextFont:xe.DIALCHART_SCALE_TEXT_FONT,_scaleTextColor:xe.DIALCHART_SCALE_TEXT_COLOR,_pivotRadius:xe.DIALCHART_PIVOT_RADIUS,_pivotFill:xe.DIALCHART_PIVOT_FILL,_pivotFillColor:xe.DIALCHART_PIVOT_FILL_COLOR,_pivotOutlineWidth:xe.DIALCHART_PIVOT_OUTLINE_WIDTH,_pivotOutlineColor:xe.DIALCHART_PIVOT_OUTLINE_COLOR,_pivotGradient:xe.DIALCHART_PIVOT_GRADIENT,_pivotGradientColor:xe.DIALCHART_PIVOT_GRADIENT_COLOR,_valuePosition:xe.DIALCHART_VALUE_POSITION,_innerDarkerRadius:xe.DIALCHART_INNER_DARKER_RADIUS,_outerBrighterRadius:xe.DIALCHART_OUTER_BRIGHTER_RADIUS,_selectShadowColor:xe.DIALCHART_SELECT_SHADOW_COLOR,_selectShadowOffset:xe.DIALCHART_SELECT_SHADOW_OFFSET,formatScaleText:function(t){return t.toFixed(2)},validateModel:function(){this._map={},this._valueRange=this._upperLimit-this._lowerLimit;var t=this._startAngle;0!=t&&0==(t=(t%360+360)%360)&&(t=360),this._positiveStartAngle=t;var e=this._endAngle;0!=e&&0==(e=(e%360+360)%360)&&(e=360),this._positiveEndAngle=e,this._whole=360==Math.abs(t-e),this._startAngleByRadian=t*Math.PI/180,this._endAngleByRadian=e*Math.PI/180,this._clockwise=this._startAngleByRadian>this._endAngleByRadian,this._angleRange=Math.abs(this._startAngleByRadian-this._endAngleByRadian),this._publishedDatas.forEach(function(t){var e=this.getValue(t);this._map[t.getId()]={data:t,value:e,color:this.getUniqueColor(this.getColor(t),t),angle:this._startAngleByRadian+(this._clockwise?-1:1)*e/this._valueRange*this._angleRange}},this)},validateDisplay:function(t,e,i){var n={x:this._xGap,y:this._yGap,width:e-2*this._xGap,height:i-2*this._yGap};if(this.drawBackground(t,n),this._startAngleByRadian!=this._endAngleByRadian){var s,o,r=this._lowerLimit,a=this._majorScaleCount>1?this._valueRange/(this._majorScaleCount-1):0,h=0,l=0,c=null,d=null;if(this._scaleTextVisible)for(c=new oe,s=0;s<this._majorScaleCount;s++)0==s&&!this._scaleLowerLimitTextVisible||s==this._majorScaleCount-1&&!this._scaleUpperLimitTextVisible?(o=null,c.add({text:\"\",size:{width:0,height:0}})):(d=this.formatScaleText(r),o=this.getTextSize(this._scaleTextFont,d),c.add({text:d,size:o})),this._scaleInside||null==o||(o.width>h&&(h=o.width),o.height>l&&(l=o.height)),r+=a;if(this._angleRange<=Math.PI&&(h=Math.max(h,this._pivotRadius),l=Math.max(l,this._pivotRadius)),W.grow(n,-h,-l),this._calcluateCenterAndRadius(n),t.lineWidth=0,null==this._colorRangeList||0==this._colorRangeList.size())this._drawArcGroup(t,this._startAngleByRadian,this._endAngleByRadian,this.getUniqueColor(this._colorRangeFillColor)),this._drawArcOutLine(t,this._startAngleByRadian,this._endAngleByRadian,!0,!0);else{var u=this._angleRange/this._colorRangeList.size(),_=this._startAngleByRadian;for(s=0;s<this._colorRangeList.size();s++){var g=this.getUniqueColor(this._colorRangeList.get(s)),f=_+(this._clockwise?-1:1)*u;this._drawArcGroup(t,_,f,g),this._drawArcOutLine(t,_,_+(this._clockwise?-1:1)*u,0==s,s==this._colorRangeList.size()-1),_+=(this._clockwise?-1:1)*u}}var v,m,p,w,y,A,x,C,E=this._startAngleByRadian,T=this._majorScaleCount>1?this._angleRange/(this._majorScaleCount-1):0;for(x=(A=this._scaleInside?this._innerRadiusByPixel:this._outerRadius)+this._majorScaleLineLength*(this._scaleInside?1:-1),C=A+this._minorScaleLineLength*(this._scaleInside?1:-1),s=0;s<this._majorScaleCount;s++){if(m=this._center.x+Math.cos(E)*A,p=this._center.y+Math.sin(-E)*A,w=this._center.x+Math.cos(E)*x,y=this._center.y+Math.sin(-E)*x,t.lineWidth=this._majorScaleLineWidth,t.strokeStyle=this.getUniqueColor(this._majorScaleLineColor),t.beginPath(),t.moveTo(m,p),t.lineTo(w,y),t.closePath(),t.stroke(),this._scaleTextVisible)if(0==s&&!this._scaleLowerLimitTextVisible||s==this._majorScaleCount-1&&!this._scaleUpperLimitTextVisible);else{var k=c.get(s);if(k){var b=this.getScaleTextPosition(E/Math.PI*180,m,p,k.size.width,k.size.height);k.x=b.x,k.y=b.y}}if(this._whole||!this._whole&&s<this._majorScaleCount-1){var S=E,L=this._minorScaleCount>0?T/(this._minorScaleCount+1):0;for(v=0;v<this._minorScaleCount;v++)S+=(this._clockwise?-1:1)*L,m=this._center.x+Math.cos(S)*A,p=this._center.y+Math.sin(-S)*A,w=this._center.x+Math.cos(S)*C,y=this._center.y+Math.sin(-S)*C,t.lineWidth=this._minorScaleLineWidth,t.strokeStyle=this.getUniqueColor(this._minorScaleLineColor),t.beginPath(),t.moveTo(m,p),t.lineTo(w,y),t.closePath(),t.stroke()}E+=(this._clockwise?-1:1)*T}this._pivotFill&&Y.fill(t,this.getUniqueColor(this._pivotFillColor),this._pivotGradient,this._pivotGradientColor,this._center.x-this._pivotRadius,this._center.y-this._pivotRadius,2*this._pivotRadius,2*this._pivotRadius),t.lineWidth=this._pivotOutlineWidth,t.strokeStyle=this.getUniqueColor(this._pivotOutlineColor),t.beginPath(),t.arc(this._center.x,this._center.y,this._pivotRadius,0,2*Math.PI,!0),t.closePath(),this._pivotFill&&t.fill(),c&&c.forEach(function(e){e&&Y.drawText(t,e.text,e,this._scaleTextFont,this._scaleTextColor)},this),this._publishedDatas.forEach(function(e){var i=this._map[e.getId()],n=this._getDataStyle(\"dialchart.rear.extension\",e),s=this._getDataStyle(\"dialchart.base.width\",e),o=this._getDataStyle(\"dialchart.top.width\",e),r=this._getDataStyle(\"dialchart.radius\",e);r>=-1&&r<=1&&(r*=this._innerRadiusByPixel),t.fillStyle=i.color,t.lineWidth=0;var a=W.createMatrix(-i.angle,this._center.x,this._center.y),h=a.transform(this._center.x+r,this._center.y+o/2),l=a.transform(this._center.x+r,this._center.y-o/2),c=a.transform(this._center.x-n,this._center.y-s/2),d=a.transform(this._center.x-n,this._center.y+s/2),u=this._selectShadowOffset;this.isSelected(e)&&u>0?(t.shadowOffsetX=u,t.shadowOffsetY=u,t.shadowBlur=2*u,t.shadowColor=this._selectShadowColor):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0,t.shadowColor=i.color),t.beginPath(),t.moveTo(h.x,h.y),t.lineTo(l.x,l.y),t.lineTo(c.x,c.y),t.lineTo(d.x,d.y),t.lineTo(h.x,h.y),t.closePath(),t.fill();var _=this._getValueTextInfo(e,i.value);if(_){var g=a.transform(this._center.x+r*this._valuePosition,this._center.y);_.x=g.x,_.y=g.y}},this),this.drawValueTexts(t)}},_getDataStyle:function(t,e){return e.getStyle?e.getStyle(t):e.getClient(t)},_calcluateCenterAndRadius:function(t){var e=this._clockwise?this._positiveEndAngle:this._positiveStartAngle,i=this._clockwise?this._positiveStartAngle:this._positiveEndAngle;Math.abs(this._positiveEndAngle-this._positiveStartAngle);0<=e&&e<90?0<=i&&i<=90?(this._outerRadius=Math.min(t.width,t.height),this._center={x:t.x+(t.width-this._outerRadius)/2,y:t.y+(t.height+this._outerRadius)/2}):90<i&&i<=180?(this._outerRadius=Math.min(t.width/2,t.height),this._center={x:t.x+t.width/2,y:t.y+(t.height+this._outerRadius)/2}):(this._center={x:t.x+t.width/2,y:t.y+t.height/2},this._outerRadius=Math.min(t.width,t.height)/2):90<=e&&e<180?90<=i&&i<=180?(this._outerRadius=Math.min(t.width,t.height),this._center={x:t.x+(t.width+this._outerRadius)/2,y:t.y+(t.height+this._outerRadius)/2}):180<i&&i<=270?(this._outerRadius=Math.min(t.width,t.height/2),this._center={x:t.x+(t.width+this._outerRadius)/2,y:t.y+t.height/2}):(this._center={x:t.x+t.width/2,y:t.y+t.height/2},this._outerRadius=Math.min(t.width,t.height)/2):180<=e&&e<270?180<=i&&i<=270?(this._outerRadius=Math.min(t.width,t.height),this._center={x:t.x+(t.width+this._outerRadius)/2,y:t.y+(t.height-this._outerRadius)/2}):(this._outerRadius=Math.min(t.width/2,t.height),this._center={x:t.x+t.width/2,y:t.y+(t.height-this._outerRadius)/2}):(this._outerRadius=Math.min(t.width,t.height),this._center={x:t.x+(t.width-this._outerRadius)/2,y:t.y+(t.height-this._outerRadius)/2}),this._innerRadiusByPixel=this._innerRadius>1?this._innerRadius:this._outerRadius*this._innerRadius,this._innerDarkerRadiusByPixel=this._innerDarkerRadius>1?this._innerDarkerRadius:this._outerRadius*this._innerDarkerRadius,this._outerBrighterRadiusByPixel=this._outerBrighterRadius>1?this._outerBrighterRadius:this._outerRadius*this._outerBrighterRadius},_drawArcOutLine:function(t,e,i,n,s){if(!(this._outlineWidth<=0)){var o=Math.abs(e-i),r=this._center.x+Math.cos(e)*this._innerRadiusByPixel,a=this._center.y+Math.sin(-e)*this._innerRadiusByPixel,h=this._center.x+Math.cos(e)*this._outerRadius,l=this._center.y+Math.sin(-e)*this._outerRadius,c=this._center.x+Math.cos(i)*this._innerRadiusByPixel,d=this._center.y+Math.sin(-i)*this._innerRadiusByPixel,u=this._center.x+Math.cos(i)*this._outerRadius,_=this._center.y+Math.sin(-i)*this._outerRadius;this._clockwise?(t.lineWidth=this._outlineWidth,t.strokeStyle=this.getUniqueColor(this._outlineColor),t.beginPath(),t.moveTo(this._center.x,this._center.y),Y.drawArc(t,this._center.x,this._center.y,i,o,this._outerRadius,this._outerRadius,!1),t.stroke(),!this._whole&&n?(t.lineWidth=this._outlineWidth,t.strokeStyle=this.getUniqueColor(this._outlineColor)):t.lineWidth=0,t.lineTo(r,a),t.stroke(),t.beginPath(),t.lineWidth=this._outlineWidth,t.strokeStyle=this.getUniqueColor(this._outlineColor),t.moveTo(this._center.x,this._center.y),Y.drawArc(t,this._center.x,this._center.y,e,-o,this._innerRadiusByPixel,this._innerRadiusByPixel,!1),t.stroke(),!this._whole&&s?(t.lineWidth=this._outlineWidth,t.strokeStyle=this.getUniqueColor(this._outlineColor)):t.lineWidth=0,t.lineTo(u,_),t.stroke()):(t.lineWidth=this._outlineWidth,t.strokeStyle=this.getUniqueColor(this._outlineColor),t.beginPath(),t.moveTo(this._center.x,this._center.y),Y.drawArc(t,this._center.x,this._center.y,e,o,this._outerRadius,this._outerRadius,!1),t.stroke(),!this._whole&&s?(t.lineWidth=this._outlineWidth,t.strokeStyle=this.getUniqueColor(this._outlineColor)):t.lineWidth=0,t.lineTo(c,d),t.stroke(),t.lineWidth=this._outlineWidth,t.strokeStyle=this.getUniqueColor(this._outlineColor),t.beginPath(),t.moveTo(this._center.x,this._center.y),Y.drawArc(t,this._center.x,this._center.y,i,-o,this._innerRadiusByPixel,this._innerRadiusByPixel,!1),t.stroke(),!this._whole&&n?(t.lineWidth=this._outlineWidth,t.strokeStyle=this.getUniqueColor(this._outlineColor)):t.lineWidth=0,t.lineTo(h,l),t.stroke())}},_drawArcGroup:function(t,e,i,n){0!=this._outerBrighterRadiusByPixel&&this._drawArc(t,e,i,this._outerRadius-this._outerBrighterRadiusByPixel,this._outerRadius,Y.brighter(n)),this._drawArc(t,e,i,this._innerRadiusByPixel+this._innerDarkerRadiusByPixel,this._outerRadius-this._outerBrighterRadiusByPixel,n),0!=this._innerDarkerRadiusByPixel&&this._drawArc(t,e,i,this._innerRadiusByPixel,this._innerRadiusByPixel+this._innerDarkerRadiusByPixel,Y.darker(n,20))},_drawArc:function(t,e,i,n,s,o){var r=Math.abs(e-i);t.lineWidth=0,t.fillStyle=o;var a=this._center.x+Math.cos(e)*n,h=this._center.y+Math.sin(-e)*n,l=(this._center.x,Math.cos(e),this._center.y,Math.sin(-e),this._center.x+Math.cos(i)*n),c=this._center.y+Math.sin(-i)*n;this._center.x,Math.cos(i),this._center.y,Math.sin(-i);t.beginPath(),this._clockwise?(t.moveTo(l,c),Y.drawArc(t,this._center.x,this._center.y,i,r,s,s,!0),t.lineTo(a,h),Y.drawArc(t,this._center.x,this._center.y,e,-r,n,n,!0),t.closePath()):(t.moveTo(a,h),Y.drawArc(t,this._center.x,this._center.y,e,r,s,s,!0),t.lineTo(l,c),Y.drawArc(t,this._center.x,this._center.y,i,-r,n,n,!0),t.closePath()),t.fill()},getScaleTextPosition:function(t,e,i,n,s){var o={x:e,y:i};return 0==(t=(t%360+360)%360)&&(o=this._scaleInside?{x:e-n/2,y:i}:{x:e+n/2,y:i}),180==t&&(o=this._scaleInside?{x:e+n/2,y:i}:{x:e-n/2,y:i}),90==t&&(o=this._scaleInside?{x:e,y:i+s/2}:{x:e,y:i-s/2}),270==t&&(o=this._scaleInside?{x:e,y:i-s/2}:{x:e,y:i+s/2}),t>270&&t<360&&(o=this._scaleInside?{x:e-n/2,y:i-s/2}:{x:e+n/2,y:i+s/2}),t>180&&t<270&&(o=this._scaleInside?{x:e+n/2,y:i-s/2}:{x:e-n/2,y:i+s/2}),t>90&&t<180&&(o=this._scaleInside?{x:e+n/2,y:i+s/2}:{x:e-n/2,y:i-s/2}),t>0&&t<90&&(o=this._scaleInside?{x:e-n/2,y:i+s/2}:{x:e+n/2,y:i-s/2}),o}}),R.charts.RadarChart=function(t){R.charts.RadarChart.superClass.constructor.apply(this,arguments),this._selectTolerance=2},D.ext(\"twaver.charts.RadarChart\",R.charts.ChartBase,{__accessor:[\"axisTextVisible\",\"axisTextFont\",\"axisTextColor\",\"scaleTextVisible\",\"scaleTextFont\",\"scaleTextColor\",\"axisVisible\",\"axisLineColor\",\"axisLineWidth\",\"axisStartAngle\",\"ringVisible\",\"ringType\",\"ringLineColor\",\"ringLineWidth\",\"scaleCount\",\"scaleMaxValue\",\"scaleMinValue\",\"anchorVisible\",\"areaFillAlpha\",\"areaSelectFillAlpha\",\"axisList\"],__bool:[\"areaFill\"],_axisTextVisible:xe.RADARCHART_AXIS_TEXT_VISIBLE,_axisTextFont:xe.RADARCHART_AXIS_TEXT_FONT,_axisTextColor:xe.RADARCHART_AXIS_TEXT_COLOR,_scaleTextVisible:xe.RADARCHART_SCALE_TEXT_VISIBLE,_scaleTextFont:xe.RADARCHART_SCALE_TEXT_FONT,_scaleTextColor:xe.RADARCHART_SCALE_TEXT_COLOR,_axisVisible:xe.RADARCHART_AXIS_VISIBLE,_axisLineColor:xe.RADARCHART_AXIS_LINE_COLOR,_axisLineWidth:xe.RADARCHART_AXIS_LINE_WIDTH,_axisStartAngle:xe.RADARCHART_AXIS_START_ANGLE,_ringVisible:xe.RADARCHART_RING_VISIBLE,_ringType:xe.RADARCHART_RING_TYPE,_ringLineColor:xe.RADARCHART_RING_LINE_COLOR,_ringLineWidth:xe.RADARCHART_RING_LINE_WIDTH,_scaleCount:xe.RADARCHART_SCALE_COUNT,_scaleMaxValue:xe.RADARCHART_SCALE_MAXVALUE,_scaleMinValue:xe.RADARCHART_SCALE_MINVALUE,_anchorVisible:xe.RADARCHART_ANCHOR_VISIBLE,_areaFill:xe.RADARCHART_AREA_FILL,_areaFillAlpha:xe.RADARCHART_AREA_FILL_ALPHA,_areaSelectFillAlpha:xe.RADARCHART_AREA_SELECT_FILL_ALPHA,getAxisCount:function(){return this._axisCount},formatScaleText:function(t,e){return t.toFixed(2)},getAnchorSize:function(t){return t.getStyle?t.getStyle(\"chart.marker.size\"):R.Styles.getStyle(\"chart.marker.size\")},getAnchorShape:function(t){return t.getStyle?t.getStyle(\"chart.marker.shape\"):R.Styles.getStyle(\"chart.marker.shape\")},getLineWidth:function(t){return t.getStyle?t.getStyle(\"chart.line.width\"):R.Styles.getStyle(\"chart.line.width\")},getValues:function(t){return t.getStyle?t.getStyle(\"chart.values\"):null},tryGetDataAt:function(t,e){if((null==e||e<0)&&(e=this._selectTolerance),t.target&&(t=X.getLogicalPoint(this._canvas,arguments[0],1)),!t)return null;if(!this._areaFill){var i=t.x-e,n=t.y-e,s=2*e+1,o=2*e+1;try{for(var r=this._canvas.getContext(\"2d\").getImageData(i,n,s,o).data,a=0,h=r.length;a<h;a+=4)if(255===r[a+3]){var l=\"rgb(\"+r[a]+\",\"+r[a+1]+\",\"+r[a+2]+\")\";if(c=this._uniqueColors[l])return c}}catch(t){}return null}if(!this._center)return null;t={x:t.x-this._xTranslate,y:t.y-this._yTranslate};for(a=this._publishedDatas.size()-1;a>=0;a--){var c=this._publishedDatas.get(a),d=this._map[c.getId()];if(W.isPointInPolygon(d.points,t))return c}return null},getDataAt:function(){var t,e;if(2===arguments.length)t=arguments[0],e=arguments[1];else if(arguments[0].target){var i=X.getLogicalPoint(this._canvas,arguments[0],1);if(!i)return;t=i.x,e=i.y}else t=arguments[0].x,e=arguments[0].y;if(t<0||e<0||t>this._canvasWidth||e>this._canvasHeight)return null;if(!this._areaFill){try{var n=this._canvas.getContext(\"2d\").getImageData(t,e,1,1).data;if(255===n[3]){var s=\"rgb(\"+n[0]+\",\"+n[1]+\",\"+n[2]+\")\";if(r=this._uniqueColors[s])return r}}catch(t){}return null}for(var o=this._publishedDatas.size()-1;o>=0;o--){var r=this._publishedDatas.get(o),a=this._map[r.getId()];if(W.isPointInPolygon(a.points,{x:t-this._xTranslate,y:e-this._yTranslate}))return r}return null},validateModel:function(){if(this._map={},this._axisTexts=new oe,this._axisMaxValues=new oe,this._axisMinValues=new oe,this._axisRangeValues=new oe,this._axisCount=null==this._axisList?0:this._axisList.size(),0!=this._axisCount){this._averageAngleByRadian=2*Math.PI/this._axisCount,this._averageAngle=360/this._axisCount,this._axisList.forEach(function(t){if(\"string\"==typeof t)this._axisTexts.add(t),this._axisMaxValues.add(this._scaleMaxValue),this._axisMinValues.add(this._scaleMinValue),this._axisRangeValues.add(this._scaleMaxValue-this._scaleMinValue);else{this._axisTexts.add(t.text);var e=isNaN(t.max)?this._scaleMaxValue:t.max,i=isNaN(t.min)?this._scaleMinValue:t.min;this._axisMaxValues.add(e),this._axisMinValues.add(i),this._axisRangeValues.add(e-i)}},this),this._publishedDatas.forEach(function(t){var e={data:t,values:new oe(this.getValues(t)),proportions:new oe,color:this.getUniqueColor(this.getColor(t),t),anchorShape:this.getAnchorShape(t),anchorSize:this.getAnchorSize(t),lineWidth:this.getLineWidth(t),points:new oe};this.isSelected(t)&&(e.lineWidth+=2),this._map[t.getId()]=e},this);for(var t=0;t<this._axisCount;t++)this._publishedDatas.forEach(function(e){var i=this._map[e.getId()],n=0;if(i.values.size()>t){var s=i.values.get(t),o=this._axisMinValues.get(t),r=this._axisRangeValues.get(t);r>0&&(n=(s-o)/r)}i.proportions.add(n)},this)}},validateDisplay:function(t,e,i){var n={x:this._xGap,y:this._yGap,width:e-2*this._xGap,height:i-2*this._yGap};if(this.drawBackground(t,n),!(n.width<=0||n.height<=0||this._axisCount<3)){var s=0,o=0,r=0,a=null,h=null,l=null,c=null;if(this._axisTextVisible)for(c=new oe,r=0;r<this._axisCount;r++)l=this._axisTexts.get(r),a=this.getTextSize(this._axisTextFont,l),c.add({text:l,size:a}),a.width>s&&(s=a.width),a.height>o&&(o=a.height);var d=n.width/2-s>n.height/2-o?n.height/2-2*o:n.width/2-s,u={x:n.x+n.width/2,y:n.y+n.height/2};this._center={x:u.x+this._xTranslate,y:u.y+this._yTranslate};var _=null;this._scaleTextVisible&&(_=new oe);var g=this._axisStartAngle/180*Math.PI;for(r=0;r<this._axisCount;r++){var f=180*g/Math.PI,v=u.x+Math.cos(g)*d,m=u.y+Math.sin(-g)*d,p=null;_&&(p=new oe,_.add(p)),this._ringVisible&&this._ringLineWidth>0&&(t.lineWidth=this._ringLineWidth,t.strokeStyle=this._ringLineColor);for(var w=1;w<=this._scaleCount;w++){var y=w/this._scaleCount,A=d*y,x=u.x+Math.cos(g)*A,C=u.y+Math.sin(-g)*A;if(this._ringVisible&&this._ringLineWidth>0){var E=u.x+Math.cos(g+this._averageAngleByRadian)*A,T=u.y+Math.sin(-g-this._averageAngleByRadian)*A;\"line\"==this._ringType?this.drawLine(t,this._ringLineColor,this._ringLineWidth,x,C,E,T):\"arc\"==this._ringType&&(t.beginPath(),t.moveTo(u.x,u.y),Y.drawArc(t,u.x,u.y,g,this._averageAngleByRadian,A,A,!0),t.closePath(),t.stroke())}p&&(l=this.formatScaleText(this._axisMinValues.get(r)+this._axisRangeValues.get(r)*y,r),a=this.getTextSize(this._scaleTextFont,l),h=this.getScaleTextPosition(f,x,C,a.width,a.height),p.add({text:l,x:h.x,y:h.y}))}if(this._axisVisible&&this.drawLine(t,this._axisLineColor,this._axisLineWidth,u.x,u.y,v,m),c){var k=c.get(r);h=this.getAxisTextPosition(f,v,m,k.size.width,k.size.height),k.x=h.x,k.y=h.y}g+=this._averageAngleByRadian}this._publishedDatas.forEach(function(e){var i=this._map[e.getId()];i.points.clear();var n=i.anchorSize>0?new oe:null,s=i.proportions;if(t.lineWidth=0,t.globalAlpha=this.isSelected(e)?this._areaSelectFillAlpha:this._areaFillAlpha,this._areaFill&&(t.fillStyle=i.color),this._drawItem(t,s,u,d,n,i),this._areaFill&&t.fill(),t.lineWidth=i.lineWidth,t.strokeStyle=i.color,t.globalAlpha=1,this._drawItem(t,s,u,d),t.lineWidth=0,null!=n&&n.size()>0){var o=i.anchorSize/2;n.forEach(function(e){t.fillStyle=i.color,Y.drawVector(t,i.anchorShape,null,e.x-o,e.y-o,i.anchorSize,i.anchorSize),t.fill()})}},this),_&&_.forEach(function(e){e.forEach(function(e){Y.drawText(t,e.text,e,this._scaleTextFont,this._scaleTextColor)},this)},this),c&&c.forEach(function(e){Y.drawText(t,e.text,e,this._axisTextFont,this._axisTextColor)},this)}},_drawItem:function(t,e,i,n,s,o){var r=this._axisStartAngle/180*Math.PI,a=null;t.beginPath();for(var h=0;h<this._axisCount;h++){var l=e.get(h),c={x:i.x+Math.cos(r)*n*l,y:i.y+Math.sin(-r)*n*l};null==a?t.moveTo(c.x,c.y):t.lineTo(c.x,c.y),null!=s&&this._anchorVisible&&s.add(c),o&&o.points.add(c),0==h&&(a=c),r+=this._averageAngleByRadian}null!=a&&t.lineTo(a.x,a.y),t.closePath(),t.stroke()},getAxisTextPosition:function(t,e,i,n,s){var o={x:e,y:i};return 0==(t=(t%360+360)%360)&&(o={x:e+n/2,y:i}),180==t&&(o={x:e-n/2,y:i}),90==t&&(o={x:e,y:i-s/2}),270==t&&(o={x:e,y:i+s/2}),t>270&&t<360&&(o={x:e+n/2,y:i+s/2}),t>180&&t<270&&(o={x:e-n/2,y:i+s/2}),t>90&&t<180&&(o={x:e-n/2,y:i-s/2}),t>0&&t<90&&(o={x:e+n/2,y:i-s/2}),o},getScaleTextPosition:function(t,e,i,n,s){var o={x:e,y:i};return 0==(t=(t%360+360)%360)&&(o={x:e,y:i+s/2}),180==t&&(o={x:e-n/2,y:i+s/2}),90==t&&(o={x:e+n/2,y:i}),270==t&&(o={x:e+n/2,y:i}),t>270&&t<360&&(o={x:e+n/2,y:i-s/2}),t>180&&t<270&&(o={x:e-n/2,y:i-s/2}),t>90&&t<180&&(o={x:e-n/2,y:i+s/2}),t>0&&t<90&&(o={x:e+n/2,y:i+s/2}),o}}),R.charts.LegendPane=function(t){R.charts.LegendPane.superClass.constructor.apply(this,arguments),this._divPool=new R.Pool(\"div\"),this._iconPool=new R.Pool(\"div\"),this._textPool=new R.Pool(\"span\"),this._pools.add(this._divPool),this._pools.add(this._iconPool),this._pools.add(this._textPool),this._chart=t,this._chart.addViewListener(this.handleViewChange,this),this._view=X.createView(\"hidden\"),this._view.style.verticalAlign=\"middle\",this._legendDiv=X.createDiv(),this._legendDiv.style.whiteSpace=\"nowrap\",this._legendDiv.style.verticalAlign=\"middle\",this._legendDiv.style.position=\"\",this._view.appendChild(this._legendDiv),this._hiddenMap={};var e=this;this._chart._internalVisibleFunction=function(t){return!e.isHidden(t)},V.isTouchable&&new R.charts.LegendPaneTouchInteraction(this),new R.charts.LegendPaneInteraction(this)},D.ext(\"twaver.charts.LegendPane\",R.controls.ControlBase,{__accessor:[\"iconWidth\",\"iconHeight\",\"iconRadius\",\"rowHeight\",\"orientation\",\"hiddenColor\",\"selectBackgroundColor\",\"selectForegroundColor\"],_iconWidth:xe.LEGENDPANE_ICON_WIDTH,_iconHeight:xe.LEGENDPANE_ICON_HEIGHT,_iconRadius:xe.LEGENDPANE_ICON_RADIUS,_rowHeight:xe.LEGENDPANE_ROW_HEIGHT,_orientation:xe.LEGENDPANE_ORIENTATION,_hiddenColor:xe.LEGENDPANE_HIDDEN_COLOR,_selectBackgroundColor:xe.LEGENDPANE_SELECT_BACKGROUND_COLOR,_selectForegroundColor:xe.LEGENDPANE_SELECT_FOREGROUND_COLOR,onPropertyChanged:function(t){this.invalidate()},getChart:function(){return this._chart},isHidden:function(t){return null!=this._hiddenMap[t.getId()]},handleViewChange:function(t){\"validateEnd\"===t.kind&&(this._invalidate=!0,this.validate())},validate:function(){if(this._invalidate){this._invalidate=!1,X.release(this._legendDiv),D.keys(this._hiddenMap).forEach(function(t){this._chart.getDataBox().containsById(t)||delete this._hiddenMap[t]},this);for(var t=new oe(this._chart.getUnfilteredDatas()),e=0;e<t.size();e++){var i=t.get(e);this._chart.isVisible(i)||this.isHidden(i)||(t.removeAt(e),e--)}var n=t.size(),s=this._view.style,o=\"horizontal\"===this._orientation;for(o?(s.textAlign=\"center\",s.height=this._rowHeight+\"px\"):(s.textAlign=\"\",s.height=this._rowHeight*n+\"px\"),s.lineHeight=this._rowHeight-2+\"px\",e=0;e<n;e++){i=t.get(e);var r=this._divPool.get();r._data=i,r.style.cursor=\"pointer\",r.style.height=this._rowHeight+\"px\",r.style.display=o?\"inline-block\":\"block\",this._legendDiv.appendChild(r),this.renderLegend(r,i),this.onLegendRendered(r,i)}this._pools.forEach(function(t){t.clear()})}},renderLegend:function(t,e){var i=!this.isHidden(e),n=this._chart.isSelected(e),s=this._iconPool.get(),o=s.style;o.display=\"inline-block\",o.verticalAlign=\"middle\",o.marginLeft=\"4px\",o.width=this.getIconWidth()+\"px\",o.height=this.getIconHeight()+\"px\",o.backgroundColor=i?this._chart.getColor(e):this.getHiddenColor(),t.appendChild(s);var r=this._textPool.get();(o=r.style).paddingLeft=\"2px\",o.paddingRight=\"4px\",o.display=\"inline-block\",o.verticalAlign=\"middle\",o.color=i?n?this._selectForegroundColor:\"\":this.getHiddenColor(),r.innerHTML=this._chart.getName(e),t.appendChild(r),t.style.backgroundColor=i&&n?this._selectBackgroundColor:\"\"},onLegendRendered:function(t,e){}}),R.charts.ChartPane=function(t,e,i,n){R.charts.ChartPane.superClass.constructor.apply(this,arguments),this.invalidate(),this._chart=t,this._legendPane=new R.charts.LegendPane(t),this._titleDiv=X.createDiv(),this._titleDiv.style.verticalAlign=\"middle\",this._titleDiv.style.whiteSpace=\"nowrap\",this._view=X.createView(\"hidden\"),this._view.appendChild(this._titleDiv),this._view.appendChild(this._legendPane.getView()),this._view.appendChild(this._chart.getView());var s=this;this._legendPane.addPropertyChangeListener(function(t){\"rowHeight\"!==t.property&&\"orientation\"!==t.porperty||s.invalidate()}),arguments.length>1&&this.setTitle(e),arguments.length>2&&this.setLegendOrientation(i),arguments.length>3&&this.setLegendWidth(n)},D.ext(\"twaver.charts.ChartPane\",R.controls.ControlBase,{__accessor:[\"title\",\"titleHorizontalAlign\",\"titleHeight\",\"legendWidth\"],_title:null,_titleHeight:xe.CHARTPANE_TITLE_HEIGHT,_titleHorizontalAlign:xe.CHARTPANE_TITLE_HORIZONTAL_ALIGN,_legendOrientation:xe.CHARTPANE_LEGEND_ORIENTATION,_legendWidth:xe.CHARTPANE_LEGEND_WIDTH,getLegendOrientation:function(){return this._legendOrientation},setLegendOrientation:function(t){if(this._legendOrientation!==t){var e=this._legendOrientation;this._legendOrientation=t,this.firePropertyChange(\"orientation\",e,t),this._adjustLegendOrientation()}},_adjustLegendOrientation:function(){\"left\"===this._legendOrientation||\"right\"===this._legendOrientation?this._legendPane.setOrientation(\"vertical\"):this._legendPane.setOrientation(\"horizontal\")},onPropertyChanged:function(t){this.invalidate()},getTitleDiv:function(){return this._titleDiv},getChart:function(){return this._chart},getLegendPane:function(){return this._legendPane},validateImpl:function(){this._adjustLegendOrientation();var t,e=this._view.offsetWidth,i=this._view.offsetHeight,n=this._legendPane.getRowHeight();this._title&&\"\"!==this._title?(t=this._titleHeight,this._titleDiv.innerHTML=this._title):(t=0,this._titleDiv.innerHTML=\"\"),this._titleDiv.innerHTML=this._title?this._title:\"\",this._titleDiv.style.textAlign=this._titleHorizontalAlign,this._titleDiv.style.lineHeight=this._titleHeight-2+\"px\";var s=this._titleDiv.style;s.left=\"0px\",s.top=\"0px\",s.width=e+\"px\",s.height=t+\"px\";var o,r;\"bottom\"===this._legendOrientation?(o={x:0,y:t,width:e,height:Math.max(i-t-n,0)},r={x:0,y:Math.max(i-n,0),width:e,height:n}):\"right\"===this._legendOrientation?(o={x:0,y:t,width:Math.max(e-this._legendWidth,0),height:Math.max(i-t,0)},r={x:Math.max(e-this._legendWidth,0),y:t,width:this._legendWidth,height:Math.max(i-t,0)}):\"top\"===this._legendOrientation?(o={x:0,y:t+n,width:e,height:Math.max(i-t-n,0)},r={x:0,y:t,width:e,height:n}):\"left\"===this._legendOrientation&&(o={x:this._legendWidth,y:t,width:Math.max(e-this._legendWidth,0),height:Math.max(i-t,0)},r={x:0,y:t,width:this._legendWidth,height:Math.max(i-t,0)}),o&&this._chart.adjustBounds(o),r&&this._legendPane.adjustBounds(r)}}),R.charts.ChartInteraction=function(t){this.chart=t,this.canvas=t._canvas;var e=this;this.canvas.addEventListener(\"mousedown\",function(t){0===t.button&&e.handleMouseDown(t),t.preventDefault()},!1);var i=V.isFirefox?\"DOMMouseScroll\":\"mousewheel\";this.canvas.addEventListener(i,function(t){e.handleMouseWheel(t)},!1)},D.ext(\"twaver.charts.ChartInteraction\",Object,{handleMouseDown:function(t){this.chart.isFocusOnClick()&&R.Util.setFocus(this.canvas),this.lastPoint=this.chart.getLogicalPoint(t);var e=this.chart.tryGetDataAt(t);2===t.detail&&null==e?this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0)):(this._startLogical=this.lastPoint,this._startClient=X.getClientPoint(t),X.handle_mousedown(this,t))},handleMouseMove:function(t){if(this.lastPoint){var e={x:this._startLogical.x+t.clientX-this._startClient.x,y:this._startLogical.y+t.clientY-this._startClient.y};!this.startPan&&W.getDistance(this.lastPoint,e)>3&&(this.startPan=!0,this.lastPoint=e),this.startPan&&(this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+e.x-this.lastPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+e.y-this.lastPoint.y),this.lastPoint=e)}},handleMouseUp:function(t){if(!this.startPan&&1===t.detail){var e=this.chart.tryGetDataAt(t),i=this.chart.getSelectionModel();e?D.isCtrlDown(t)?i.contains(e)?i.removeSelection(e):i.appendSelection(e):i.contains(e)||i.setSelection(e):D.isCtrlDown(t)||i.clearSelection()}delete this.lastPoint,delete this.startPan,delete this._startClient,delete this._startLogical},handleMouseWheel:function(t){X.preventDefault(t);var e=V.isFirefox?-t.detail:t.wheelDelta;e>0?(this.chart.isXZoomEnabled()&&this.chart.setXZoom(1.1*this.chart.getXZoom(),!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(1.1*this.chart.getYZoom(),!1)):e<0&&(this.chart.isXZoomEnabled()&&this.chart.setXZoom(this.chart.getXZoom()/1.1,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(this.chart.getYZoom()/1.1,!1))}}),R.charts.ChartTouchInteraction=function(t){this.chart=t,this.canvas=t._canvas,X.addEventListener(\"touchstart\",\"handleTouchstart\",this.canvas,this)},D.ext(\"twaver.charts.ChartTouchInteraction\",Object,{handleTouchstart:function(t){X.preventDefault(t),this.chart.isFocusOnClick()&&R.Util.setFocus(this.canvas),this.endPoint=this.chart.getLogicalPoint(t),yt.isMultiTouch(t)&&(this.distance=yt.getDistance(t),this.xZoom=this.chart.getXZoom(),this.yZoom=this.chart.getYZoom()),X.addEventListener(\"touchmove\",\"handleTouchmove\",this.canvas,this),X.addEventListener(\"touchend\",\"handleTouchend\",this.canvas,this)},handleTouchmove:function(t){if(X.preventDefault(t),this.endPoint){var e=this.chart.getLogicalPoint(t);if(!this.moved&&W.getDistance(this.endPoint,e)>10&&(this.moved=!0,this.lastPoint=e),this.moved)if(yt.isSingleTouch(t))this.endPoint&&(this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+e.x-this.endPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+e.y-this.endPoint.y),this.endPoint=e);else if(this.distance){var i=yt.getDistance(t)/this.distance,n=this.xZoom*i,s=this.yZoom*i;this.chart.isXZoomEnabled()&&this.chart.setXZoom(n,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(s,!1)}}},handleTouchend:function(t){if(X.preventDefault(t),!this.moved){this.endPoint=this.chart.getLogicalPoint(t);var e=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;e?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date);var i=this.chart.tryGetDataAt(t);if(e&&null==i)this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0));else{var n=this.chart.getSelectionModel();i?n.contains(i)||n.setSelection(i):n.clearSelection()}}delete this.endPoint,delete this.distance,delete this.xZoom,delete this.yZoom,delete this.moved,X.removeEventListener(\"touchmove\",this.canvas,this),X.removeEventListener(\"touchend\",this.canvas,this)}}),R.charts.ChartMSTouchInteraction=function(t){this.chart=t,this.canvas=t._canvas,this._pointerMap={},this._pointerIdArray=[],X.addEventListener(\"MSPointerDown\",\"handleTouchstart\",this.canvas,this),X.addEventListener(\"MSPointerMove\",\"handleTouchmove\",this.canvas,this),X.addEventListener(\"MSPointerUp\",\"handleTouchend\",this.canvas,this),X.addEventListener(\"MSPointerCancel\",\"handleTouchend\",this.canvas,this);var e=V.isFirefox?\"DOMMouseScroll\":\"mousewheel\";this.canvas.addEventListener(e,function(t){self.handleMouseWheel(t)},!1)},D.ext(\"twaver.charts.ChartMSTouchInteraction\",Object,{handleTouchstart:function(t){this.chart.isFocusOnClick()&&R.Util.setFocus(this.canvas);var e=this.chart.getLogicalPoint(t);t.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[t.pointerId]&&e&&(this._pointerIdArray.push(t.pointerId),this._pointerMap[t.pointerId]=t);var i=this.chart.tryGetDataAt(t);if(1==this._pointerIdArray.length&&e){this._startTouchPoint&&this._startTouchTime&&(new Date).getTime()-this._startTouchTime.getTime()<=500&&W.getDistance(this._startTouchPoint,e)<=10&&null==i?this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0),this._startTouchPoint=null,this._startTouchTime=null,this._startClientPoint=null):(this._startTouchPoint=e,this._startTouchTime=new Date,this._startClientPoint={x:t.clientX,y:t.clientY},X.handle_mousedown(this,t))}else 2==this._pointerIdArray.length&&(this.xZoom=this.chart.getXZoom(),this.yZoom=this.chart.getYZoom(),this._distance=this._getDistance())},handleTouchmove:function(t){if(0!=this._pointerIdArray.length&&this._pointerMap[t.pointerId]&&!(W.getDistance({x:this._pointerMap[t.pointerId].pageX,y:this._pointerMap[t.pointerId].pageY},{x:t.pageX,y:t.pageY})<=3)&&(this._pointerMap[t.pointerId]=t,2==this._pointerIdArray.length)){var e=this._getDistance()/this._distance,i=this.xZoom*e,n=this.yZoom*e;this.chart.isXZoomEnabled()&&this.chart.setXZoom(i,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(n,!1)}},handleTouchend:function(t){var e=this.chart.getLogicalPoint(t);if(1==this._pointerIdArray.length&&e&&!this.moved){var i=this.chart.tryGetDataAt(t),n=this._startTouchPoint&&this._startTouchTime&&(new Date).getTime()-this._startTouchTime.getTime()<=500&&W.getDistance(this._startTouchPoint,e)<=10,s=this.chart.getSelectionModel();i&&n?D.isCtrlDown(t)?s.contains(i)?s.removeSelection(i):s.appendSelection(i):s.contains(i)||s.setSelection(i):D.isCtrlDown(t)||s.clearSelection()}this.moved=!1,this._pointerMap={},this._pointerIdArray=[]},handleMouseWheel:function(t){X.preventDefault(t);var e=V.isFirefox?-t.detail:t.wheelDelta;e>0?(this.chart.isXZoomEnabled()&&this.chart.setXZoom(1.1*this.chart.getXZoom(),!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(1.1*this.chart.getYZoom(),!1)):e<0&&(this.chart.isXZoomEnabled()&&this.chart.setXZoom(this.chart.getXZoom()/1.1,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(this.chart.getYZoom()/1.1,!1))},handle_mousemove:function(t){if(1==this._pointerIdArray.length&&this._startTouchPoint&&this._startClientPoint){var e={x:this._startTouchPoint.x+(t.clientX-this._startClientPoint.x)/this.chart.getXZoom(),y:this._startTouchPoint.y+(t.clientY-this._startClientPoint.y)/this.chart.getYZoom()};W.getDistance(this._startTouchPoint,e)>3&&(this.moved=!0,this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+e.x-this._startTouchPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+e.y-this._startTouchPoint.y),this._startClientPoint.x=t.clientX,this._startClientPoint.y=t.clientY)}},handle_mouseup:function(t){this.handleTouchend(t)},_getDistance:function(){return W.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),R.charts.LegendPaneInteraction=function(t){this.legendPane=t;var e=this;this.legendPane._legendDiv.addEventListener(\"mousedown\",function(t){e.handleMouseDown(t)},!1)},D.ext(\"twaver.charts.LegendPaneInteraction\",Object,{handleMouseDown:function(t){if(0===t.button){var e=t.target._data;e||(e=t.target.parentNode._data),e&&(this.legendPane._hiddenMap[e.getId()]?delete this.legendPane._hiddenMap[e.getId()]:this.legendPane._hiddenMap[e.getId()]=e,this.legendPane._chart.invalidateModel())}}}),R.charts.LegendPaneTouchInteraction=function(t){this.legendPane=t,X.addEventListener(\"touchstart\",\"handleTouchstart\",this.legendPane._legendDiv,this)},D.ext(\"twaver.charts.LegendPaneTouchInteraction\",Object,{handleTouchstart:function(t){X.preventDefault(t);var e=t.target._data;e||(e=t.target.parentNode._data),e&&(this.legendPane._hiddenMap[e.getId()]?delete this.legendPane._hiddenMap[e.getId()]:this.legendPane._hiddenMap[e.getId()]=e,this.legendPane._chart.invalidateModel())}}),R.network.Network=function(t){R.network.Network.superClass.constructor.apply(this,arguments),this._elementUIMap={},this._layerMap={},this._layerList=new oe,this._view=X.createView(\"auto\"),this._rootDiv=X.createDiv(),this._topDiv=X.createDiv(),this._attachmentDiv=X.createDiv(),this._layersDiv=X.createDiv(),this._bottomDiv=X.createDiv(),this._rootDiv.appendChild(this._bottomDiv),this._rootDiv.appendChild(this._layersDiv),this._rootDiv.appendChild(this._attachmentDiv),this._rootDiv.appendChild(this._topDiv),this._view.appendChild(this._rootDiv),this.setElementBox(t||new R.ElementBox),V.isTouchable?V.isMSTouchable?this.setMSTouchInteractions():this.setTouchInteractions():this.setDefaultInteractions(!1);var e=this;this._flowLink=function(){if(!(e.isMovingElement()||e.isSelectingElement()||e.isEditingElement()||e._box._layoutMovingElements)){e._flowLinkQuickFinder||(e._flowLinkQuickFinder=new R.QuickFinder(e._box,\"link.flow\",\"style\"));e._flowLinkQuickFinder.find(!0).forEach(function(t){t._styleMap[\"link.flow.offset\"]=e.getLinkFlowOffset(t);e.getElementUI(t).drawBody()})}},this.setToolTipEnabled(xe.NETWORK_TOOLTIP_ENABLED),this._view.addEventListener(\"scroll\",function(t){ct.twm(e)}),this.addPropertyChangeListener(function(t){\"zoom\"===t.property&&ct.twm(e)}),R.imageUtil.addEventListener(this.invalidateElementUIs,this)},D.ext(\"twaver.network.Network\",R.controls.View,{__accessor:[\"selectMode\",\"makeVisibleOnSelected\",\"movableFunction\",\"editPointSize\",\"editPointFillColor\",\"editPointOutlineWidth\",\"editPointOutlineColor\",\"editLineColor\",\"editLineWidth\",\"resizePointSize\",\"resizePointFillColor\",\"resizePointOutlineWidth\",\"resizePointOutlineColor\",\"resizeLineColor\",\"resizeLineWidth\",\"rotatePointSize\",\"rotatePointFillColor\",\"rotatePointOffset\",\"rotatePointOutlineWidth\",\"rotatePointOutlineColor\",\"rotateScaleFillColor\",\"rotateScaleFontColor\",\"rotateScaleWidth\",\"rotateScaleHeight\",\"selectOutlineColor\",\"selectOutlineWidth\",\"selectFillColor\",\"lazyMoveOutlineColor\",\"lazyMoveOutlineWidth\",\"lazyMoveFillColor\",\"rectSelectFilter\",\"selectionTolerance\"],__bool:[\"doubleClickToUpSubNetwork\",\"doubleClickToSubNetwork\",\"doubleClickToEmptySubNetwork\",\"doubleClickToLinkBundle\",\"doubleClickToGroupExpand\",\"subNetworkAnimate\",\"lazyMoveAnimate\",\"resizeAnimate\",\"noAgentLinkVisible\",\"keyboardRemoveEnabled\",\"keyboardSelectEnabled\",\"sendToTopOnSelected\",\"lazyMoveFill\",\"editingElement\",\"rotatingElement\",\"movingElement\",\"selectingElement\",\"rectSelectEnabled\",\"limitElementInPositiveLocation\",\"showRotateScale\",\"transparentSelectionEnable\"],_viewRect:{x:0,y:0,width:0,height:0},_currentSubNetwork:null,_selectMode:xe.NETWORK_SELECT_MODE,_noAgentLinkVisible:xe.NETWORK_NO_AGENT_LINK_VISIBLE,_makeVisibleOnSelected:xe.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:xe.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:xe.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:xe.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_subNetworkAnimate:xe.NETWORK_SUBNETWORK_ANIMATE,_transparentSelectable:xe.NETWORK_TRANSPARENT_SELECTABLE,_removeElementUIOnInvisible:xe.NETWORK_REMOVE_ELEMENTUI_ON_INVISIBLE,_elementUIFunction:xe.ELEMENTUI_FUNCTION,_doubleClickToUpSubNetwork:xe.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:xe.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:xe.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:xe.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:xe.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_sendToTopOnSelected:xe.NETWORK_SENDTOTOP_ON_SELECTED,_selectOutlineColor:xe.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:xe.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:xe.NETWORK_SELECT_FILL_COLOR,_lazyMoveOutlineColor:xe.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:xe.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:xe.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:xe.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:xe.NETWORK_LAZYMOVE_ANIMATE,_editPointSize:xe.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:xe.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:xe.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:xe.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:xe.NETWORK_EDIT_LINE_COLOR,_editLineWidth:xe.NETWORK_EDIT_LINE_WIDTH,_resizePointSize:xe.NETWORK_RESIZE_POINT_SIZE,_resizePointFillColor:xe.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:xe.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:xe.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:xe.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:xe.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:xe.NETWORK_RESIZE_ANIMATE,_rotatePointSize:xe.NETWORK_ROTATE_POINT_SIZE,_rotatePointFillColor:xe.NETWORK_ROTATE_POINT_FILL_COLOR,_rotatePointOffset:xe.NETWORK_ROTATE_POINT_OFFSET,_rotatePointOutlineWidth:xe.NETWORK_ROTATE_POINT_OUTLINE_WIDTH,_rotatePointOutlineColor:xe.NETWORK_ROTATE_POINT_OUTLINE_COLOR,_rotateScaleWidth:xe.NETWORK_ROTATE_SCALE_WIDTH,_rotateScaleHeight:xe.NETWORK_ROTATE_SCALE_HEIGHT,_rotateScaleFillColor:xe.NETWORK_ROTATE_SCALE_FILL_COLOR,_rotateScaleFontColor:xe.NETWORK_ROTATE_SCALE_FONT_COLOR,_limitElementInPositiveLocation:xe.NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION,_linkFlowInterval:xe.NETWORK_LINK_FLOW_INTERVAL,_selectionTolerance:xe.NETWORK_SELECTION_TOLERANCE,_invalidate:!1,_invalidateElementVisibility:!1,_invalidateElementIndex:!1,_isEditingElement:!1,_isRotatingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,_showRotateScale:!0,_transparentSelectionEnable:R.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE,getLabel:function(t){return t.getStyle(\"network.label\")||t.getName()},isToolTipEnabled:function(){return!!this._toolTipEnabled},setToolTipEnabled:function(t){if(this._toolTipEnabled=t,t){if(!this._toolTipListener){var e=this;this._toolTipListener=function(t){var i=e.getElementAt(t);if(e._preElement!==i)if(e._preElement=i,i){var n=e.getToolTip(i);xt.showToolTip({x:t.pageX,y:t.pageY},n);var s=xt.getToolTipDiv();if(s.children.length>0){var o=e._view.getBoundingClientRect(),r=s.getBoundingClientRect();r.width+r.left>o.width+o.left&&(s.style.left=o.width+o.left-r.width+(z.documentElement.scrollLeft||z.body.scrollLeft)+\"px\"),r.height+r.top>o.height+o.top&&(s.style.top=o.height+o.top-r.height+(z.documentElement.scrollTop||z.body.scrollTop)+\"px\")}}else xt.hideToolTip()},this._view.addEventListener(\"mousemove\",this._toolTipListener,!0),this.firePropertyChange(\"toolTipEnabled\",!1,!0)}}else this._toolTipListener&&(xt.hideToolTip(),this._view.removeEventListener(\"mousemove\",this._toolTipListener,!0),delete this._toolTipListener,this.firePropertyChange(\"toolTipEnabled\",!0,!1))},isLinkFlowEnabled:function(){return!!this._linkFlowEnabled},setLinkFlowEnabled:function(t){t?(this._linkFlowEnabled||(this._linkFlowEnabled=!0,this.firePropertyChange(\"linkFlowEnabled\",!1,!0)),clearInterval(this._linkFlowTimerId),this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval)):(this._linkFlowEnabled&&(this._linkFlowEnabled=!1,this.firePropertyChange(\"linkFlowEnabled\",!0,!1)),clearInterval(this._linkFlowTimerId),delete this._linkFlowTimerId)},getLinkFlowInterval:function(){return this._linkFlowInterval},setLinkFlowInterval:function(t){var e=this._linkFlowInterval;this._linkFlowInterval=t,this.firePropertyChange(\"linkFlowInterval\",e,t),clearInterval(this._linkFlowTimerId),this.isLinkFlowEnabled()&&(this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval))},getTopDiv:function(){return this._topDiv},getAttachmentDiv:function(){return this._attachmentDiv},getLayersDiv:function(){return this._layersDiv},getBottomDiv:function(){return this._bottomDiv},validateImpl:function(){if(ct.twm(this),this.__lics__){var t=0,e=null,i=null,n=null,s=this._invalidateElementVisibility;if(this._invalidateElementVisibility&&(this._invalidateElementVisibility=!1,this._removeElementUIOnInvisible&&(this._invalidateElementIndex=!0),this.forEachElementUI(function(s){s.validate();var o=s.getElement();if(s.setVisible(this.isVisible(o)),this._removeElementUIOnInvisible){if(e=this.getLayerDivByElement(o),s.isVisible()){if(s.getView().parentNode!==e)for(e.appendChild(s.getView()),i=s.getAttachments(),t=0;t<i.size();t++)(n=i.get(t)).isShowInAttachmentDiv()&&this._attachmentDiv.appendChild(n.getView())}else if(s.getView().parentNode===e)for(e.removeChild(s.getView()),i=s.getAttachments(),t=0;t<i.size();t++)(n=i.get(t)).isShowInAttachmentDiv()&&this._attachmentDiv.removeChild(n.getView())}else if(!s.getView().parentNode)for((e=this.getLayerDivByElement(o)).appendChild(s.getView()),i=s.getAttachments(),t=0;t<i.size();t++)(n=i.get(t)).isShowInAttachmentDiv()&&this._attachmentDiv.appendChild(n.getView())},null,this)),this._invalidateElementIndex){this._invalidateElementIndex=!1;var o,r=this;this._box.getLayerBox().forEachByDepthFirst(function(t){var e,i=r._layerMap[t.getId()];r._box.forEachByLayer(function(t){var n=r._elementUIMap[t.getId()];if(n&&n.getView().parentNode===i){e=X.insertAfter(n.getView(),e);for(var s=n.getAttachments(),a=0;a<s.size();a++){var h=s.get(a);h.getView().parentNode===r._attachmentDiv&&(o=X.insertAfter(h.getView(),o))}}},t)})}if(s&&!this._invalidateElementVisibility){var a;for(var h in this._elementUIMap){var l=this._elementUIMap[h];l.isVisible()&&(a=W.unionRect(a,l.getViewRect()))}if((a=a?{x:0,y:0,width:a.x+a.width,height:a.y+a.height}:{x:0,y:0,width:0,height:0}).x!==this._viewRect.x||a.y!==this._viewRect.y||a.width!==this._viewRect.width||a.height!==this._viewRect.height){var c=this._viewRect;this._viewRect=a,this._rootDiv.style.left=\"0px\",this._rootDiv.style.top=\"0px\",this._rootDiv.style.width=a.width+\"px\",this._rootDiv.style.height=a.height+\"px\",this.firePropertyChange(\"viewRect\",c,a)}}}},setInteractions:function(t){var e=this._interactions;e&&e.forEach(function(t){t.tearDown()}),this._interactions=t,t&&t.forEach(function(t){t.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange(\"interactions\",e,t)},getInteractions:function(){return this._interactions},upSubNetwork:function(t,e){this._currentSubNetwork&&this.setCurrentSubNetwork(vt.getSubNetwork(this._currentSubNetwork),t,e)},sendToTop:function(t){if(this.isVisible(t)){for(var e=t;this.isVisible(e.getParent())&&(e=e.getParent()););e!==t&&this._box.adjustElementIndex(e),this._box.adjustElementIndex(t)}},invalidateElementIndex:function(){this._invalidateElementIndex||(this._invalidateElementIndex=!0,this.invalidate())},invalidateElementVisibility:function(){this._invalidateElementVisibility||(this._invalidateElementVisibility=!0,this.invalidate())},updateLayers:function(){X.clear(this._layersDiv),X.clear(this._attachmentDiv),this._layerMap={},this._layerList.clear();var t=this;this._box.getLayerBox().forEachByDepthFirst(function(e){var i=X.createDiv();X.setVisible(i,e.isVisible()),t._layerMap[e.getId()]=i,t._layersDiv.appendChild(i),t._layerList.add(e)}),this._box.forEach(this.createElementUI,this)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(t,e,i){var n=R.animate.AnimateManager;if(n.endAnimate(),e){if(this._currentSubNetwork===t)return;if(t&&!this._box.contains(t))throw t+\" is not contained in this network's elementBox\";n.start(new R.animate.AnimateSubNetwork(this,t,i))}else this._setCurrentSubNetwork(t),i&&i()},_setCurrentSubNetwork:function(t){if(this._currentSubNetwork!==t){if(t&&!this._box.contains(t))throw t+\" is not contained in this network's elementBox\";var e=this._currentSubNetwork;this._currentSubNetwork=t,this.firePropertyChange(\"currentSubNetwork\",e,t),this.invalidateElementVisibility()}},isVisible:function(t){if(!this._box.contains(t))return!1;if(!t.isVisible())return!1;if(this._visibleFunction&&!this._visibleFunction(t))return!1;if(!this._box.getLayerBox().getLayerByElement(t).isVisible())return!1;if(vt.getSubNetwork(t)!==this._currentSubNetwork)return!1;if(t instanceof R.Link){if(!this.isNoAgentLinkVisible()){if(!t.getFromAgent()||!t.getToAgent())return!1;if(!this.isVisible(t.getFromAgent())||!this.isVisible(t.getToAgent()))return!1}if(t.getBundleIndex()>0&&t.getBundleCount()>1&&!t.getStyle(\"link.bundle.expanded\"))return!1}else for(var e=t.getParent();e&&!e.ISubNetwork;){if(e instanceof De&&(!e.isExpanded()||!this.isVisible(e)))return!1;e=e.getParent()}return!t.IDummy},isMovable:function(t){return!!this._box.contains(t)&&(!(t instanceof R.Link)&&(!(this._movableFunction&&!this._movableFunction(t))&&this._box.getLayerBox().getLayerByElement(t).isMovable()))},isEditable:function(t){return!!this._box.contains(t)&&(!(this._editableFunction&&!this._editableFunction(t))&&this._box.getLayerBox().getLayerByElement(t).isEditable())},isRotatable:function(t){return!(this._rotatableFunction&&!this._rotatableFunction(t))},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(t){var e=this._visibleFunction;this._visibleFunction=t,this.firePropertyChange(\"visibleFunction\",e,t),this.invalidateElementVisibility()},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(t){var e=this._editableFunction;this._editableFunction=t,this.firePropertyChange(\"editableFunction\",e,t),this.invalidateSelectedElementUIs(!0)},getRotatableFunction:function(){return this._rotatableFunction},setRotatableFunction:function(t){var e=this._rotatableFunction;this._rotatableFunction=t,this.firePropertyChange(\"rotatableFunction\",e,t),this.invalidateSelectedElementUIs(!0)},isLinkable:function(t){return null==this._linkableFunction||this._linkableFunction(t)},getLinkableFunction:function(){return this._linkableFunction},setLinkableFunction:function(t){var e=this._linkableFunction;this._linkableFunction=t,this.firePropertyChange(\"linkableFunction\",e,t),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getElementBox:function(){return this._box},setElementBox:function(t){if(!t)throw\"ElementBox can not be null\";if(this._box!==t){var e=this._box;e&&(e.removeDataBoxChangeListener(this.handleElementBoxChange,this),e.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),e.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),e.removeIndexChangeListener(this.handleIndexChange,this),e.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),e.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),e.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||e.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=t,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._flowLinkQuickFinder&&(this._flowLinkQuickFinder.dispose(),this._flowLinkQuickFinder=new R.QuickFinder(this._box,\"link.flow\",\"style\")),this._selectionModel?this._selectionModel._setDataBox(t):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this.updateLayers(),this.invalidateElementVisibility(),this.firePropertyChange(\"elementBox\",e,this._box)}},invalidateElementUI:function(t,e){var i=this.getElementUI(t);i&&i.invalidate(e)},invalidateElementUIs:function(t){for(var e in this._elementUIMap){this._elementUIMap[e].invalidate(t)}},invalidateSelectedElementUIs:function(t){this.getSelectionModel().getSelection().forEach(function(e){this.invalidateElementUI(e,t)},this)},getElementUI:function(t){return t?this._elementUIMap[t.getId()]:null},getLayerDivByElement:function(t){var e=this._box.getLayerBox().getLayerByElement(t);return e?this._layerMap[e.getId()]:null},createElementUI:function(t){var e=this._elementUIMap[t.getId()];if(e||(e=this._elementUIFunction(this,t))&&(this._elementUIMap[t.getId()]=e),e){var i=this.getLayerDivByElement(t);e.getView().parentNode!==i&&(i.appendChild(e.getView()),e.getAttachments().forEach(function(t){t.isShowInAttachmentDiv()&&t.getView().parentNode!==this._attachmentDiv&&this._attachmentDiv.appendChild(t.getView())},this)),this.invalidateElementIndex()}},invalidateBundleLink:function(t){if(t instanceof R.Link&&t._bundleLinks){var e=this._elementUIMap;t._bundleLinks.forEachSiblingLink(function(i){if(i!==t){var n=e[i._id];n&&n.invalidate(!1)}},this)}},handleLayerBoxChange:function(t){this.updateLayers(),this.invalidateElementVisibility()},handleLayerPropertyChange:function(t){var e=t.source;if(\"visible\"===t.property){var i=this._layerMap[e.getId()];X.setVisible(i,e.isVisible())}else\"editable\"===t.property&&this.invalidateSelectedElementUIs(!0);this.invalidateElementVisibility()},handleLayerHierarchyChange:function(t){var e;this._layerList.clear(),this._box.getLayerBox().forEachByDepthFirst(function(t){var i=this._layerMap[t.getId()];e=X.insertAfter(i,e),this._layerList.add(t)},null,this),this.invalidateElementVisibility()},handleSelectionChange:function(t){t.datas.forEach(function(e){var i=this.getElementUI(e);i&&i.handleSelectionChange(t)},this),this.invalidateElementVisibility();var e=this.getSelectionModel().getLastData();e&&(\"append\"!==t.kind&&\"set\"!==t.kind||(this.isMakeVisibleOnSelected()&&this.makeVisible(e),this.isSendToTopOnSelected()&&this.sendToTop(e)))},makeVisible:function(t){var e=this.getElementUI(t);if(e){var i=vt.getSubNetwork(t);if(i===this._currentSubNetwork){for(var n=t;(n=n.getParent())&&n!==i;)n instanceof De&&n.setExpanded(!0);var s=e.getUnionBodyBounds();if(s){var o={x:this._view.scrollLeft/this._zoom,y:this._view.scrollTop/this._zoom,width:this._view.clientWidth/this._zoom,height:this._view.clientHeight/this._zoom};W.intersects(o,s)||this.isVisible(t)&&D.callLater(this.centerByLogicalPoint,this,[s.x+s.width/2,s.y+s.height/2])}}else{var r=this;this.setCurrentSubNetwork(i,this.isSubNetworkAnimate(),function(){D.callLater(r.makeVisible,r,[t])})}}},handleElementBoxChange:function(t){var e=t.data;if(\"add\"===t.kind)this.createElementUI(e),this.invalidateBundleLink(e);else if(\"remove\"===t.kind){var i=this.getElementUI(e);if(i){var n=this._box.getLayerBox().getLayerByElement(e),s=this._layerMap[n.getId()];i.getView().parentNode===s&&s.removeChild(i.getView()),i.dispose(),delete this._elementUIMap[e.getId()]}e===this._currentSubNetwork&&null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null)}else\"clear\"===t.kind&&(this.forEachElementUI(function(t){t.dispose()}),this._elementUIMap={},this.updateLayers(),null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null));this.invalidateElementVisibility()},handleElementPropertyChange:function(t){var e=t.source,i=this.getElementUI(e);if(i&&(i.handlePropertyChange(t),\"layerId\"===t.property)){var n=this._box.getLayerBox().getLayerByElement(e),s=this._layerMap[n.getId()];i.getView().parentNode!==s&&(s.appendChild(i.getView()),this.invalidateElementIndex())}this.invalidateBundleLink(e),this.invalidateElementVisibility()},handleElementBoxPropertyChange:function(t){this.invalidateElementVisibility()},handleIndexChange:function(t){this.invalidateElementIndex()},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(t){if(!t)throw\"ElementUIFunction can not be null\";if(this._elementUIFunction!==t){var e=this._elementUIFunction;this._elementUIFunction=t,this.firePropertyChange(\"elementUIFunction\",e,t),this._box.isEmpty()||this.updateLayers()}},getIconsNames:function(t){return t.getStyle(\"icons.names\")},getIconsColors:function(t){return t.getStyle(\"icons.colors\")},getLinkHandlerLabel:function(t){return t.isBundleAgent()?\"+(\"+t.getBundleCount()+\")\":null},getSelectColor:function(t){return t.getStyle(\"select.color\")},getShadowColor:function(t){var e=t.getStyle(\"shadow.color\");return!e&&this.isSelected(t)&&\"shadow\"===t.getStyle(\"select.style\")?t.getStyle(\"select.color\"):e},getAlarmLabel:function(t){var e=t.getAlarmState().getHighestNewAlarmSeverity();if(e){var i=t.getAlarmState().getNewAlarmCount(e)+e.nickName;return t.getAlarmState().hasLessSevereNewAlarms()&&(i+=\"+\"),i}return null},isRemoveElementUIOnInvisible:function(){return this._removeElementUIOnInvisible},setRemoveElementUIOnInvisible:function(t){var e=this._removeElementUIOnInvisible;this._removeElementUIOnInvisible=t,this.firePropertyChange(\"removeElementUIOnInvisible\",e,t),this.invalidateElementVisibility()},setDefaultInteractions:function(t,e){var i=[new R.network.interaction.SelectInteraction(this),new R.network.interaction.MoveInteraction(this,t),new R.network.interaction.DefaultInteraction(this)];e&&i.push(new R.network.interaction.MoveLinkInteraction(this,t)),this.setInteractions(i)},setPanInteractions:function(){this.setInteractions([new R.network.interaction.PanInteraction(this),new R.network.interaction.DefaultInteraction(this)])},setEditInteractions:function(t,e){var i=[new R.network.interaction.SelectInteraction(this),new R.network.interaction.EditInteraction(this,t),new R.network.interaction.MoveInteraction(this,t),new R.network.interaction.DefaultInteraction(this)];e&&i.push(new R.network.interaction.MoveLinkInteraction(this,t)),this.setInteractions(i)},setCreateElementInteractions:function(t){this.setInteractions([new R.network.interaction.CreateElementInteraction(this,t),new R.network.interaction.DefaultInteraction(this)])},setCreateLinkInteractions:function(t){this.setInteractions([new R.network.interaction.CreateLinkInteraction(this,t),new R.network.interaction.DefaultInteraction(this)])},setCreateShapeLinkInteractions:function(t){this.setInteractions([new R.network.interaction.CreateShapeLinkInteraction(this,t),new R.network.interaction.DefaultInteraction(this)])},setCreateShapeNodeInteractions:function(t){this.setInteractions([new R.network.interaction.CreateShapeNodeInteraction(this,t),new R.network.interaction.DefaultInteraction(this)])},setTouchInteractions:function(){var t=[new R.network.interaction.SelectInteraction(this),new R.network.interaction.MoveInteraction(this,!1),new R.network.interaction.DefaultInteraction(this),new R.network.interaction.TouchInteraction(this)];this.setInteractions(t)},setMSTouchInteractions:function(){this.setInteractions([new R.network.interaction.MSTouchInteraction(this)])},setMagnifyInteractions:function(){this.setInteractions([new R.network.interaction.SelectInteraction(this),new R.network.interaction.MoveInteraction(this),new R.network.interaction.DefaultInteraction(this),new R.network.interaction.MagnifyInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(t){var e=this._hasEditInteraction;this._hasEditInteraction=t,this.firePropertyChange(\"hasEditInteraction\",e,t)},moveSelectedElements:function(t,e,i,n){if(0!==t||0!==e){var s=this.getMovableSelectedElementsRect();null!=s&&(this._limitElementInPositiveLocation&&(s.x+t<0&&(t=-s.x),s.y+e<0&&(e=-s.y)),R.Util.moveElements(this.getMovableSelectedElements(),t,e,i,n,this))}},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(t){return this.isMovable(t)},this)},hasMovableSelectedElements:function(){for(var t=this.getSelectionModel().getSelection(),e=0;e<t.size();e++){var i=t.get(e);if(this.isMovable(i))return!0}return!1},getMovableSelectedElementsRect:function(){var t=this.getMovableSelectedElements();if(0===t.size())return null;for(var e=null,i=0,n=t.size();i<n;i++){var s=t.get(i);if(s instanceof Pe){var o=this.getElementUI(s);o&&(e=W.unionRect(e,o.getViewRect()))}}return e},getLayerByElement:function(t){return this._box.getLayerBox().getLayerByElement(t)},getPosition:function(t,e,i,n,s){var o,r=e instanceof R.network.ElementUI?e:this.getElementUI(e);if(r)if(\"from\"===t||\"to\"===t){if(r.getFromPosition&&(o=\"from\"===t?r.getFromPosition(n,s):r.getToPosition(n,s)))return{x:o.x-i.width/2,y:o.y-i.height/2}}else o=\"hotspot\"===t?r.getHotSpot():G.get(t,r.getBodyRect(),i);if(!o&&e.getRect&&(o=G.get(t,e.getRect(),i)),o)return{x:o.x+n,y:o.y+s};throw\"position '\"+t+\"' object '\"+e+\"'\"},getViewRect:function(){return this._viewRect?D.clone(this._viewRect):{x:0,y:0,width:0,height:0}},forEachElementUI:function(t,e,i){e?this._box.forEachReverse(function(n){if(this.getLayerByElement(n)===e){var s=this.getElementUI(n);s&&(i?t.call(i,s):t(s))}},this):this._layerList.forEachReverse(function(e){this.forEachElementUI(t,e,i)},this)},findFirstElement:function(t,e){for(var i=this._layerList.size()-1,n=this._box.size()-1,s=i;s>=0;s--)for(var o=this._layerList.get(s),r=n;r>=0;r--){var a=this._box.getDataAt(r);if(this.getLayerByElement(a)===o)if(e){if(!0===t.call(e,a))return a}else if(!0===t(a))return a}return null},getElementAt:function(t,e){if(1===arguments.length&&(e=!0),!this.isValidEvent(t))return null;(t=this._getPoint(t))||console.log(\"null\");var i=t.x,n=t.y,s=this._selectionTolerance;if(s&&s>0){var o={x:i,y:n,width:0,height:0};W.grow(o,s,s)}return this.findFirstElement(function(t){if(e&&!this.isSelectable(t))return!1;var s=this.getElementUI(t);return!!s&&(o?!!s.intersectsTest(o):!!s.hitTest(i,n))},this)},_getPoint:function(t){return t?t.target?this.getLogicalPoint(t):t:null},getElementsAtRect:function(t,e,i,n){var s=new oe;return n=void 0===n||n,this.forEachElementUI(function(o){o.isVisible()&&(!i||i(o._element))&&(n&&this.isSelectable(o._element)||!n)&&(e?o.intersectsTest(t)&&s.add(o._element):W.contains(t,o.getViewRect())&&s.add(o._element))},null,this),s},hitTest:function(t){var e=this.getElementAt(t);if(!e)return null;var i=this.getElementUI(e);return i?(t=this._getPoint(t),i.hitTest(t.x,t.y)):null},addElementByInteraction:function(t){t.getParent()||t.setParent(this._currentSubNetwork),this._box.add(t),this.getSelectionModel().setSelection(t),this.fireInteractionEvent({kind:\"createElement\",element:t})},getLinkFlowStepping:function(t){var e=parseInt(t.getStyle(\"link.flow.stepping\"));return e||(e=xe.NETWORK_LINK_FLOW_STEPPING),e},getLinkFlowOffset:function(t){var e=t.getStyle(\"link.flow.offset\");return isNaN(e)&&(e=0),e+this.getLinkFlowStepping(t)},toCanvas:function(t,e,i){i||(i=X.createCanvas()),i.setAttribute(\"width\",t),i.setAttribute(\"height\",e),i._viewRect?(i._viewRect.width=t,i._viewRect.height=e):i._viewRect={x:0,y:0,width:t,height:e};var n=i.getContext(\"2d\");if(n.clearRect(0,0,t,e),0===this._view.clientWidth||0===this._view.clientHeight)return i;var s=t/this._view.scrollWidth*this._zoom,o=e/this._view.scrollHeight*this._zoom;return n.scale(s,o),X.forEach(this._view,function(t){if((\"CANVAS\"===t.tagName||\"IMG\"===t.tagName)&&!t._isIgnored){var e=t._viewRect;if(e)try{n.drawImage(t,e.x,e.y,e.width,e.height)}catch(t){}}}),i},toCanvasByRegion:function(t,e,i){i||(i=X.createCanvas());var n=t.width*e,s=t.height*e;i.setAttribute(\"width\",n),i.setAttribute(\"height\",s);var o=i.getContext(\"2d\");return o.clearRect(0,0,n,s),0===this._view.clientWidth||0===this._view.clientHeight?i:(o.save(),o.scale(e,e),X.forEach(this._view,function(e){if((\"CANVAS\"===e.tagName||\"IMG\"===e.tagName)&&!e._isIgnored){var i=e._viewRect;if(i&&W.intersects(i,t))try{o.drawImage(e,i.x-t.x,i.y-t.y,i.width,i.height)}catch(e){}}}),o.restore(),i)},getGroupChildrenRects:function(t){var e=new oe;return t.getChildren().forEach(function(t){if(t instanceof Pe){var i=this.getElementUI(t);if(i){var n=i.getViewRect();n&&e.add(n)}}},this),e},getLinkPathFunction:function(){return this._linkPathFunction},setLinkPathFunction:function(t){var e=this._linkPathFunction;this._linkPathFunction=t,this.firePropertyChange(\"linkPathFunction\",e,t),this.invalidateElementUIs()},onClickElement:function(t,e){},onClickBackground:function(t){},onDoubleClickElement:function(t,e){},onDoubleClickBackground:function(t){},onLongClickElement:function(t,e){},onLongClickBackground:function(t){},onMouseMove:function(t,e){},onMouseEnter:function(t,e){},onMouseLeave:function(t,e){},setMovingElement:function(t){if(t!=this._movingElement){var e=this._movingElement;this._movingElement=t,this.firePropertyChange(\"movingElement\",e,t),this._box._undoManager._enabled&&(t?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}},setEditingElement:function(t){if(t!=this._editingElement){var e=this._editingElement;this._editingElement=t,this.firePropertyChange(\"editingElement\",e,t),this._box._undoManager._enabled&&(t?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}},dispose:function(){R.imageUtil.removeEventListener(this.invalidateElementUIs,this)}}),R.network.Overview=function(t){R.network.Overview.superClass.constructor.apply(this,arguments),this._view=X.createView(),this._rootDiv=X.createDiv(),this._imageCanvas=X.createCanvas(),this._imageDiv=X.createDiv(),this._maskCanvas=X.createCanvas(),this._selectDiv=X.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,X.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this.setNetwork(t),V.isTouchable?V.isMSTouchable?new R.network.OverviewMSTouchInteraction(this):(new R.network.OverviewTouchInteraction(this),new R.network.OverviewInteraction(this)):new R.network.OverviewInteraction(this)},D.ext(\"twaver.network.Overview\",R.controls.ControlBase,{__accessor:[\"fillColor\",\"outlineColor\",\"outlineWidth\",\"selectColor\",\"selectWidth\",\"padding\",\"maxPackingWidth\",\"maxPackingHeight\"],__bool:[\"animate\"],_fillColor:xe.OVERVIEW_FILL_COLOR,_outlineColor:xe.OVERVIEW_OUTLINE_COLOR,_outlineWidth:xe.OVERVIEW_OUTLINE_WIDTH,_selectColor:xe.OVERVIEW_SELECT_COLOR,_selectWidth:xe.OVERVIEW_SELECT_WIDTH,_padding:xe.OVERVIEW_PADDING,_animate:xe.OVERVIEW_ANIMATE,_maxPackingWidth:xe.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:xe.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(t){this._invalidateMask()},setNetwork:function(t){t!==this._network&&(this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),X.removeEventListener(\"scroll\",\"_handleScrollChange\",this._network.getView(),this)),this._network=t,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),X.addEventListener(\"scroll\",\"_handleScrollChange\",this._network.getView(),this)),this.invalidate())},_handleNetworkPropertyChange:function(t){\"zoom\"!==t.property&&\"currentSubNetwork\"!==t.property&&\"elementBox\"!==t.property&&\"dataBox\"!==t.property||this.invalidate()},_handleNetworkViewChange:function(t){\"validateEnd\"===t.kind&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(t){this._isNetworkDirty&&this._isMaskDirty||(this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),D.callLater(this.validate,this,null,t))},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,D.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&0!==this._network._view.clientWidth&&0!==this._network._view.clientHeight){var t,e=this._maxPackingWidth>0&&this._maxPackingHeight>0;t=e?{x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:{x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},W.grow(t,-this._padding,-this._padding);var i=Math.min(t.width/this._network._view.scrollWidth,t.height/this._network._view.scrollHeight);e&&(X.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),t.width=this._imageDiv._viewRect.width,t.height=this._imageDiv._viewRect.height);var n=this._network._view.scrollWidth*i,s=this._network._view.scrollHeight*i,o=t.x+(t.width-n)/2,r=t.y+(t.height-s)/2;if(this._isNetworkDirty){var a={x:o,y:r,width:n,height:s};this._network.toCanvas(a.width,a.height,this._imageCanvas),X.setDiv(this._imageDiv,a,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle(\"background.color\")||\"\"),this._isNetworkDirty=!1}if(this._isMaskDirty){var h={x:this._network._view.scrollLeft*i,y:this._network._view.scrollTop*i,width:n*this._network._view.clientWidth/this._network._view.scrollWidth,height:s*this._network._view.clientHeight/this._network._view.scrollHeight},l=X.setCanvas(this._maskCanvas,o,r,n,s);l.lineWidth=0,l.fillStyle=this._fillColor,l.beginPath(),Y.drawVector(l,\"rectangle\",null,o,r,n,s),l.fill(),l.clearRect(o+h.x,r+h.y,h.width,h.height);var c=this._outlineWidth<0?0:this._outlineWidth;l.lineWidth=c,l.strokeStyle=this._outlineColor,l.beginPath(),Y.drawVector(l,\"rectangle\",null,o+h.x+c,r+h.y+c,h.width-2*c,h.height-2*c),c>=0&&l.stroke(),this._isMaskDirty=!1}}else this._isNetworkDirty=!1,this._isMaskDirty=!1},getLogicalPoint:function(t){return X.getLogicalPoint(this._view,t,1,this._rootDiv)},centerNetwork:function(t,e){var i=this._imageDiv._viewRect;W.containsPoint(i,t)&&(this._network.centerByLogicalPoint((t.x-i.x)/i.width*this._network._view.scrollWidth/this._network.getZoom(),(t.y-i.y)/i.height*this._network._view.scrollHeight/this._network.getZoom(),e),this._invalidateMask())}}),R.network.OverviewTouchInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,X.addEventListener(\"touchstart\",\"handleTouchstart\",this.view,this)},D.ext(\"twaver.network.OverviewTouchInteraction\",Object,{handleTouchstart:function(t){X.preventDefault(t),this.clear(),this.endPoint=this.overview.getLogicalPoint(t),yt.isMultiTouch(t)&&(this.distance=yt.getDistance(t),this.zoom=this.network.getZoom()),X.addEventListener(\"touchmove\",\"handleTouchmove\",this.view,this),X.addEventListener(\"touchend\",\"handleTouchend\",this.view,this)},handleTouchmove:function(t){if(X.preventDefault(t),this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(t),yt.isSingleTouch(t))this.overview.centerNetwork(this.endPoint,!1);else if(this.distance){var e=yt.getDistance(t)/this.distance;this.network.setZoom(this.zoom*e,!1)}},handleTouchend:function(t){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(t);var e=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;e?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),e?D.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,X.removeEventListener(\"touchmove\",this.view,this),X.removeEventListener(\"touchend\",this.view,this)),this.moved=!1}}),R.network.OverviewInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,X.addEventListener(\"mousedown\",\"handleMousedown\",this.view,this)},D.ext(\"twaver.network.OverviewInteraction\",Object,{handleMousedown:function(t){0===t.button&&(this.clear(),this.endPoint=this.overview.getLogicalPoint(t),D.isCtrlDown(t)&&(this.startPoint=this.endPoint,X.setVisible(this.overview._selectDiv,!0)),X.addEventListener(\"mousemove\",\"handleMousemove\",this.view,this),X.addEventListener(\"mouseup\",\"handleMouseup\",z,this))},handleMouseup:function(t){if(this.endPoint=this.overview.getLogicalPoint(t),\"detail\"in t&&2===t.detail)D.callLater(this.network.zoomReset,this.network,[this.overview._animate]);else if(X.isVisible(this.overview._selectDiv)&&this.startPoint){var e=this.overview._imageDiv._viewRect,i=this.overview._selectDiv._viewRect.x,n=this.overview._selectDiv._viewRect.y,s=e.width/this.overview._selectDiv._viewRect.width,o=e.height/this.overview._selectDiv._viewRect.height,r=Math.min(s,o),a=this.network._view.scrollWidth/this.network.getZoom()*((i-e.x+this.overview._selectDiv._viewRect.width/2)/e.width),h=this.network._view.scrollHeight/this.network.getZoom()*((n-e.y+this.overview._selectDiv._viewRect.height/2)/e.height);this.network.setZoom(r*Math.min(this.network._view.clientWidth/this.network._view.scrollWidth,this.network._view.clientHeight/this.network._view.scrollHeight)*this.network.getZoom(),!1),D.callLater(this.network.centerByLogicalPoint,this.network,[a,h,this.overview._animate]),X.setVisible(this.overview._selectDiv,!1),X.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else this.overview.centerNetwork(this.endPoint,this.overview._animate);this.clear()},handleMousemove:function(t){var e=this.overview.getLogicalPoint(t);if(this.endPoint=e,X.isVisible(this.overview._selectDiv)&&this.startPoint){var i=e.x>this.startPoint.x?this.startPoint.x:e.x,n=e.x>this.startPoint.x?this.startPoint.y:e.y;e.x>this.startPoint.x&&e.y<this.startPoint.y&&(n=e.y),e.x<this.startPoint.x&&e.y>this.startPoint.y&&(n=this.startPoint.y);var s=this.overview._imageDiv._viewRect;i<s.x&&(i=s.x),i>s.x+s.width&&(i=s.x+s.width),n<s.y&&(n=s.y),n>s.y+s.height&&(n=s.y+s.height);var o=Math.abs(e.x-this.startPoint.x),r=Math.abs(e.y-this.startPoint.y);i+o>s.x+s.width&&(o=s.x+s.width-i),n+r>s.y+s.height&&(r=s.y+s.height-n),X.setDiv(this.overview._selectDiv,{x:i,y:n,width:o,height:r},null,this.overview._selectWidth,this.overview._selectColor)}else this.overview.centerNetwork(e,!1)},clear:function(){this.endPoint&&(this.endPoint=null,X.removeEventListener(\"mousemove\",this.view,this),X.removeEventListener(\"mouseup\",z,this))}}),R.network.OverviewMSTouchInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,this._pointerMap={},this._pointerIdArray=[],X.addEventListener(\"MSPointerDown\",\"handleTouchstart\",this.view,this),X.addEventListener(\"MSPointerMove\",\"handleTouchmove\",this.view,this),X.addEventListener(\"MSPointerUp\",\"handleTouchend\",this.view,this),X.addEventListener(\"MSPointerCancel\",\"handleTouchend\",this.view,this)},D.ext(\"twaver.network.OverviewMSTouchInteraction\",Object,{handleTouchstart:function(t){X.preventDefault(t),t.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[t.pointerId]&&this.overview.getLogicalPoint(t)&&(this._pointerIdArray.push(t.pointerId),this._pointerMap[t.pointerId]=t),1==this._pointerIdArray.length?(this._startTouchPoint=this.overview.getLogicalPoint(t),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(t){if(0!=this._pointerIdArray.length&&this._pointerMap[t.pointerId]&&!(W.getDistance({x:this._pointerMap[t.pointerId].pageX,y:this._pointerMap[t.pointerId].pageY},{x:t.pageX,y:t.pageY})<=10))if(this._pointerMap[t.pointerId]=t,2==this._pointerIdArray.length){var e=this._getDistance()/this._distance;this.network.setZoom(this._zoom*e,!1)}else if(1==this._pointerIdArray.length&&this._startTouchPoint){var i=this.overview.getLogicalPoint(t);if(null==i)return;this._startTouchPoint=i,this.overview.centerNetwork(this._startTouchPoint,!1)}},handleTouchend:function(t){var e=this.overview.getLogicalPoint(t);if(1==this._pointerIdArray.length&&e){var i=this._endTouchPoint&&this._endTouchTime&&(new Date).getTime()-this._endTouchTime.getTime()<=500&&W.getDistance(this._endTouchPoint,e)<=10;i?(this._endTouchPoint=null,this._endTouchTime=null):(this._endTouchPoint=e,this._endTouchTime=new Date),i?D.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this._endTouchPoint,this.overview._animate)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return W.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),R.network.ElementUI=function(t,e){this._view=X.createDiv(),this._bodyView=X.createDiv(),this._view.appendChild(this._bodyView),this._network=t,this._element=e,this._attachments=new oe,this._bodyBounds=new oe,this.invalidate(!0)},D.ext(\"twaver.network.ElementUI\",Object,{_invalidateFlag:!1,_invalidateAttachmentsFlag:!1,getElement:function(){return this._element},getNetwork:function(){return this._network},getAttachments:function(){return this._attachments},getStyle:function(t){return this._element.getStyle(t)},getFont:function(t){var e=this._element.getStyle(t);return e||xe.FONT},getDyeColor:function(t){return this._innerColor?this._innerColor:this.getStyle(t)},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},getHotSpot:function(){return this._hotSpot?D.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(t){this._hotSpot=t},getUnionBodyBounds:function(){return D.clone(this._unionBodyBounds)},getBodyRect:function(){return this._bodyRect||(this._bodyRect=this.createBodyRect()),D.clone(this._bodyRect)},invalidate:function(t){void 0===t&&(t=!0),t&&(this._invalidateAttachmentsFlag=!0),this._invalidateFlag||(this._bodyRect=null,this._invalidateFlag=!0,this._network.invalidateElementVisibility())},updateMeasure:function(){},validate:function(){if(this._invalidateFlag){this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this._bodyBounds.clear(),X.clear(this._bodyView),this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle(\"shadow.xoffset\"),this._shadowYOffset=this._element.getStyle(\"shadow.yoffset\"),this._shadowBlur=this._element.getStyle(\"shadow.blur\"),this.updateMeasure();var t=this._element.getStyle(\"whole.alpha\");this._view.style.opacity=t,this._attachments.forEach(function(e){e.updateMeasure();var i=e.getAlpha();e.isShowInAttachmentDiv()?e._view.style.opacity=i*t:e._view.style.opacity=i});var e;this._bodyBounds.forEach(function(t){e=W.unionRect(e,t)}),this._unionBodyBounds=D.clone(e),this._attachments.forEach(function(t){e=W.unionRect(e,t.getViewRect())}),this._viewRect=e}},cleanUp:function(t){for(var e=t.length,i=0;i<e;i++){var n=t[i],s=this[n];s&&!s.parentNode&&(this[n]=null)}},setVisible:function(t){this.isVisible()!==t&&(X.setVisible(this._view,t),this._attachments.forEach(function(e){e.isShowInAttachmentDiv()&&X.setVisible(e._view,t)}),this.invalidate(!0))},isVisible:function(){return X.isVisible(this._view)},checkAttachments:function(){this.checkLabelAttachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var t=this._network.getLabel(this._element);null!=t&&\"\"!==t?this._labelAttachment||(this._labelAttachment=new R.network.LabelAttachment(this,xe.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var t=this._network.getAlarmLabel(this._element);null!=t&&\"\"!==t?this._alarmAttachment||(this._alarmAttachment=new R.network.AlarmAttachment(this,xe.SHOW_ALARM_IN_ATTACHMENT_DIV),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var t=this._network.getIconsNames(this._element);t&&t.length>0?this._iconsAttachment||(this._iconsAttachment=new R.network.IconsAttachment(this),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this.isEditable()&&this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)?this._editAttachment||(this._editAttachment=new R.network.EditAttachment(this),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},isEditable:function(){return!0},handlePropertyChange:function(t){this.invalidate(!0)},handleSelectionChange:function(t){this.invalidate(!0)},dispose:function(){this._attachments.forEach(function(t){t.getView().parentNode&&t.getView().parentNode.removeChild(t.getView()),t.dispose()}),this._attachments.clear()},addAttachment:function(t){this._attachments.add(t),t.isShowInAttachmentDiv()?this._network.getAttachmentDiv().appendChild(t.getView()):this._view.appendChild(t.getView()),this.invalidate(!1)},removeAttachment:function(t){this._attachments.remove(t),t.getView().parentNode&&t.getView().parentNode.removeChild(t.getView()),t.dispose(),this.invalidate(!1)},addBodyBounds:function(t){t&&this._bodyBounds.add(t)},addComponent:function(t){this._bodyView.appendChild(t)},getBodyView:function(){return this._bodyView},getView:function(){return this._view},getViewRect:function(){return D.clone(this._viewRect)},setShadow:function(t,e,i){var n=t.isShadowable()&&this._shadowColor&&!this._editAttachment;n&&(this._shadowXOffset>0?i.width+=this._shadowXOffset:(i.x+=this._shadowXOffset,i.width+=-this._shadowXOffset),this._shadowYOffset>0?i.height+=this._shadowYOffset:(i.y+=this._shadowYOffset,i.height+=-this._shadowYOffset),W.grow(i,this._shadowBlur,this._shadowBlur));var s=X.setCanvas(e,i);return n&&(s.shadowOffsetX=this._shadowXOffset,s.shadowOffsetY=this._shadowYOffset,s.shadowBlur=this._shadowBlur,s.shadowColor=this._shadowColor),s},isShadowable:function(){return!(!this._shadowColor||!this._network.isSelected(this._element)||\"shadow\"!==this._element.getStyle(\"select.style\"))},hit:function(t,e){return!1},hitCanvas:function(t,e,i){for(var n=i.length,s=0;s<n;s++){var o=this[i[s]];if(Y.hit(o,t,e,this._network.getSelectionTolerance()))return!0}return!1},hitComponent:function(t,e,i){for(var n=i.length,s=0;s<n;s++){var o=this[i[s]];if(o&&W.containsPoint(o._viewRect,t,e))return!0}return!1},hitTest:function(t,e){if(!this.isVisible()||!W.containsPoint(this._viewRect,t,e))return null;var i,n,s=this._attachments.size();for(i=s-1;i>=0;i--)if((n=this._attachments.get(i)).isShowInAttachmentDiv()&&n.hit(t,e))return n;for(i=s-1;i>=0;i--)if(!(n=this._attachments.get(i)).isShowInAttachmentDiv()&&n.hit(t,e))return n;return W.containsPoint(this._unionBodyBounds,t,e)&&this.hit(t,e)?this:null},intersects:function(t){return!1},intersectsComponent:function(t,e){for(var i=e.length,n=0;n<i;n++){var s=this[e[n]];if(s&&W.intersects(s._viewRect,t))return!0}return!1},intersectsCanvas:function(t,e){for(var i=e.length,n=0;n<i;n++){var s=this[e[n]];if(Y.intersects(s,t))return!0}return!1},intersectsTest:function(t){if(!this.isVisible()||!W.intersects(this._viewRect,t))return null;var e,i,n=this._attachments.size();for(e=n-1;e>=0;e--)if((i=this._attachments.get(e)).isShowInAttachmentDiv()&&i.intersects(t))return i;for(e=n-1;e>=0;e--)if(!(i=this._attachments.get(e)).isShowInAttachmentDiv()&&i.intersects(t))return i;return W.intersects(this._unionBodyBounds,t)&&this.intersects(t)?this:null}}),R.network.Attachment=function(t,e){this._view=X.createDiv(),this._ui=t,this._element=this._ui.getElement(),this._network=t.getNetwork(),this._isShowInAttachmentDiv=!0===e,this._isShowInAttachmentDiv&&X.setVisible(this._view,t.isVisible())},D.ext(\"twaver.network.Attachment\",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},getStyle:function(t){return this._ui.getStyle(t)},getFont:function(t){return this._ui.getFont(t)},isShowInAttachmentDiv:function(){return this._isShowInAttachmentDiv},getView:function(){return this._view},getViewRect:function(){return D.clone(this._viewRect)},getAlpha:function(){return 1},updateMeasure:function(){},dispose:function(){},hit:function(t,e){return W.containsPoint(this._viewRect,t,e)},intersects:function(t){return W.intersects(this._viewRect,t)}}),R.network.BasicAttachment=function(t,e){R.network.BasicAttachment.superClass.constructor.call(this,t,e),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0},this._attachmentCanvas=X.createCanvas(),this._view.insertBefore(this._attachmentCanvas,this._view.firstChild)},D.ext(\"twaver.network.BasicAttachment\",R.network.Attachment,{calculateMeasure:function(){var t=this.getContentWidth(),e=this.getContentHeight(),i=this.getCornerRadius(),n=this.getPointerLength(),s=this.getPointerWidth(),o=this.getPosition(),r=this.getXOffset(),a=this.getYOffset(),h=this._roundRect;h.width=t+2*i,h.height=e;var l;if(n>0){var c=this.getDirection();l=this._network.getPosition(o,this._ui,null,r,a);var d;if(\"aboveleft\"===c)h.y=l.y-n-h.height,h.x=l.x-(h.width-i),d=Math.max(l.x-s,h.x+i/2),this._pointers=[l,{x:l.x,y:l.y-n},{x:d,y:l.y-n}];else if(\"aboveright\"===c)h.y=l.y-n-h.height,h.x=l.x-i,d=Math.min(l.x+s,h.x+h.width-i/2),this._pointers=[l,{x:l.x,y:l.y-n},{x:d,y:l.y-n}];else if(\"belowleft\"===c)h.y=l.y+n,h.x=l.x-(h.width-i),d=Math.max(l.x-s,h.x+i/2),this._pointers=[l,{x:l.x,y:l.y+n},{x:d,y:l.y+n}];else if(\"belowright\"===c)h.y=l.y+n,h.x=l.x-i,d=Math.min(l.x+s,h.x+h.width-i/2),this._pointers=[l,{x:l.x,y:l.y+n},{x:d,y:l.y+n}];else if(\"leftabove\"===c)h.y=l.y+i-h.height,h.x=l.x-n-h.width,d=Math.max(l.y-s,h.y+i/2),this._pointers=[l,{x:l.x-n,y:l.y},{x:l.x-n,y:d}];else if(\"leftbelow\"===c)h.y=l.y-i,h.x=l.x-n-h.width,d=Math.min(l.y+s,h.y+h.height-i/2),this._pointers=[l,{x:l.x-n,y:l.y},{x:l.x-n,y:d}];else if(\"rightabove\"===c)h.y=l.y+i-h.height,h.x=l.x+n,d=Math.max(l.y-s,h.y+i/2),this._pointers=[l,{x:l.x+n,y:l.y},{x:l.x+n,y:d}];else if(\"rightbelow\"===c)h.y=l.y-i,h.x=l.x+n,d=Math.min(l.y+s,h.y+h.height-i/2),this._pointers=[l,{x:l.x+n,y:l.y},{x:l.x+n,y:d}];else if(\"above\"===c)h.y=l.y-n-h.height,h.x=l.x-h.width/2,d=Math.min(t/2,s/2),this._pointers=[l,{x:l.x-d,y:l.y-n},{x:l.x+d,y:l.y-n}];else if(\"below\"===c)h.y=l.y+n,h.x=l.x-h.width/2,d=Math.min(t/2,s/2),this._pointers=[l,{x:l.x-d,y:l.y+n},{x:l.x+d,y:l.y+n}];else if(\"left\"===c)h.y=l.y-h.height/2,h.x=l.x-n-h.width,d=Math.min(e/2,s/2),this._pointers=[l,{x:l.x-n,y:l.y+d},{x:l.x-n,y:l.y-d}];else{if(\"right\"!==c)throw\"Can not resolve '\"+c+\"' attachment direction\";h.y=l.y-h.height/2,h.x=l.x+n,d=Math.min(e/2,s/2),this._pointers=[l,{x:l.x+n,y:l.y+d},{x:l.x+n,y:l.y-d}]}}else l=this._network.getPosition(o,this._ui,{width:h.width,height:h.height},r,a),h.x=l.x,h.y=l.y,this._pointers=null;this._contentRect.x=h.x+(h.width-t)/2,this._contentRect.y=h.y+(h.height-e)/2,this._contentRect.width=t,this._contentRect.height=e;var u=this.getPadding();0!=u&&W.grow(h,u,u),0!=(u=this.getPaddingLeft())&&(h.x-=u,h.width+=u),0!=(u=this.getPaddingRight())&&(h.width+=u),0!=(u=this.getPaddingTop())&&(h.y-=u,h.height+=u),0!=(u=this.getPaddingBottom())&&(h.height+=u),h.width<0&&(h.width=h.width,h.x-=h.width),h.height<0&&(h.height=-h.height,h.y-=h.height)},updateMeasure:function(){R.network.BasicAttachment.superClass.updateMeasure.call(this),this.calculateMeasure();var t=this.isFill(),e=this.getOutlineWidth();this._viewRect=W.getRect(this._pointers),this._viewRect=W.unionRect(this._viewRect,this._roundRect),e>0&&W.grow(this._viewRect,e/2,e/2);var i=this._ui.setShadow(this,this._attachmentCanvas,this._viewRect);if((e>0||t)&&(i.beginPath(),Y.drawRoundRect(i,this._roundRect.x,this._roundRect.y,this._roundRect.width,this._roundRect.height,this.getCornerRadius()),this._pointers&&(i.moveTo(this._pointers[0].x,this._pointers[0].y),i.lineTo(this._pointers[1].x,this._pointers[1].y),i.lineTo(this._pointers[2].x,this._pointers[2].y)),i.closePath(),e>0&&(i.lineWidth=e,i.strokeStyle=this.getOutlineColor(),i.lineCap=this.getCap(),i.lineJoin=this.getJoin(),i.stroke()),t)){var n=this.getFillColor(),s=this.getGradient();s?Y.fill(i,n,s,this.getGradientColor(),this._viewRect):i.fillStyle=n,i.fill()}return i},getRoundRect:function(){return D.clone(this._roundRect)},getContentRect:function(){return D.clone(this._contentRect)},getContent:function(){return this._content},setContent:function(t){this._content!==t&&(this._content&&this._view.removeChild(this._content),this._content=t,t&&this._view.appendChild(t))},getContentWidth:function(){return xe.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return xe.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return xe.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return xe.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return xe.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return xe.ATTACHMENT_POSITION},getXOffset:function(){return xe.ATTACHMENT_XOFFSET},getYOffset:function(){return xe.ATTACHMENT_YOFFSET},getPadding:function(){return xe.ATTACHMENT_PADDING},getPaddingLeft:function(){return xe.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return xe.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return xe.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return xe.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return xe.ATTACHMENT_DIRECTION},isFill:function(){return xe.ATTACHMENT_FILL},getFillColor:function(){return xe.ATTACHMENT_FILL_COLOR},getGradient:function(){return xe.ATTACHMENT_GRADIENT},getGradientColor:function(){return xe.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return xe.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return xe.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return xe.ATTACHMENT_CAP},getJoin:function(){return xe.ATTACHMENT_JOIN},isShadowable:function(){return xe.ATTACHMENT_SHADOWABLE},hit:function(t,e){return!!W.containsPoint(this._viewRect,t,e)&&(!!W.containsPoint(this._contentRect,t,e)||Y.hit(this._attachmentCanvas,t,e))},intersects:function(t){return!!W.intersects(this._viewRect,t)&&(!!W.intersects(this._contentRect,t)||Y.intersects(this._attachmentCanvas,t))}}),R.network.LabelAttachment=function(t,e){R.network.LabelAttachment.superClass.constructor.call(this,t,e)},D.ext(\"twaver.network.LabelAttachment\",R.network.BasicAttachment,{updateMeasure:function(){var t,e=this.getFont(\"label.font\"),i=this.getLabel(),n=D.g.getTextSize(e,i),s=this.getMaxLength();0!==s&&n.width>s?(t=D.g.getCollapseTextInLength(e,i,s),this._textSize=D.g.getTextSize(e,t)):(t=i,this._textSize=n);var o=R.network.LabelAttachment.superClass.updateMeasure.call(this),r=this._element.getStyle(\"label.align\");Y.drawText(o,t,this._contentRect,e,this.getStyle(\"label.color\"),r,this.getStyle(\"label.linespacing\"))},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle(\"label.corner.radius\")},getPointerLength:function(){return this.getStyle(\"label.pointer.length\")},getPointerWidth:function(){return this.getStyle(\"label.pointer.width\")},getPosition:function(){return this.getStyle(\"label.position\")},getXOffset:function(){return this.getStyle(\"label.xoffset\")},getYOffset:function(){return this.getStyle(\"label.yoffset\")},getPadding:function(){return this.getStyle(\"label.padding\")},getPaddingLeft:function(){return this.getStyle(\"label.padding.left\")},getPaddingRight:function(){return this.getStyle(\"label.padding.right\")},getPaddingTop:function(){return this.getStyle(\"label.padding.top\")},getPaddingBottom:function(){return this.getStyle(\"label.padding.bottom\")},getDirection:function(){return this.getStyle(\"label.direction\")},isFill:function(){return this.getStyle(\"label.fill\")},getFillColor:function(){return this.getStyle(\"label.fill.color\")},getGradient:function(){return this.getStyle(\"label.gradient\")},getGradientColor:function(){return this.getStyle(\"label.gradient.color\")},getOutlineWidth:function(){return this.getStyle(\"label.outline.width\")},getOutlineColor:function(){return this.getStyle(\"label.outline.color\")},getCap:function(){return this.getStyle(\"label.cap\")},getJoin:function(){return this.getStyle(\"label.join\")},getAlpha:function(){return this.getStyle(\"label.alpha\")},getMaxLength:function(){return this.getStyle(\"label.maxlength\")},isShadowable:function(){return this.getStyle(\"label.shadowable\")}}),R.network.AlarmAttachment=function(t,e){R.network.AlarmAttachment.superClass.constructor.call(this,t,e)},D.ext(\"twaver.network.AlarmAttachment\",R.network.BasicAttachment,{updateMeasure:function(){var t=this.getFont(\"alarm.font\"),e=this._network.getAlarmLabel(this._element);this._textSize=Y.getTextSize(t,e),this._fillColor=this._network.getAlarmFillColor(this._element);var i=R.network.AlarmAttachment.superClass.updateMeasure.call(this);Y.drawText(i,e,this._contentRect,t,this.getStyle(\"alarm.color\"))},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle(\"alarm.corner.radius\")},getPointerLength:function(){return this.getStyle(\"alarm.pointer.length\")},getPointerWidth:function(){return this.getStyle(\"alarm.pointer.width\")},getPosition:function(){return this.getStyle(\"alarm.position\")},getXOffset:function(){return this.getStyle(\"alarm.xoffset\")},getYOffset:function(){return this.getStyle(\"alarm.yoffset\")},getPadding:function(){return this.getStyle(\"alarm.padding\")},getPaddingLeft:function(){return this.getStyle(\"alarm.padding.left\")},getPaddingRight:function(){return this.getStyle(\"alarm.padding.right\")},getPaddingTop:function(){return this.getStyle(\"alarm.padding.top\")},getPaddingBottom:function(){return this.getStyle(\"alarm.padding.bottom\")},getDirection:function(){return this.getStyle(\"alarm.direction\")},isFill:function(){return null!=this._fillColor},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle(\"alarm.gradient\")},getGradientColor:function(){return this.getStyle(\"alarm.gradient.color\")},getOutlineWidth:function(){return this.getStyle(\"alarm.outline.width\")},getOutlineColor:function(){return this.getStyle(\"alarm.outline.color\")},getCap:function(){return this.getStyle(\"alarm.cap\")},getJoin:function(){return this.getStyle(\"alarm.join\")},getAlpha:function(){return this.getStyle(\"alarm.alpha\")},isShadowable:function(){return this.getStyle(\"alarm.shadowable\")}}),R.network.LinkHandlerAttachment=function(t,e){R.network.LinkHandlerAttachment.superClass.constructor.call(this,t,e)},D.ext(\"twaver.network.LinkHandlerAttachment\",R.network.BasicAttachment,{updateMeasure:function(){var t=this.getFont(\"link.handler.font\"),e=this._network.getLinkHandlerLabel(this._element);this._textSize=Y.getTextSize(t,e);var i=R.network.LabelAttachment.superClass.updateMeasure.call(this);Y.drawText(i,e,this._contentRect,t,this.getStyle(\"link.handler.color\"))},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle(\"link.handler.corner.radius\")},getPointerLength:function(){return this.getStyle(\"link.handler.pointer.length\")},getPointerWidth:function(){return this.getStyle(\"link.handler.pointer.width\")},getPosition:function(){return this.getStyle(\"link.handler.position\")},getXOffset:function(){return this.getStyle(\"link.handler.xoffset\")},getYOffset:function(){return this.getStyle(\"link.handler.yoffset\")},getPadding:function(){return this.getStyle(\"link.handler.padding\")},getPaddingLeft:function(){return this.getStyle(\"link.handler.padding.left\")},getPaddingRight:function(){return this.getStyle(\"link.handler.padding.right\")},getPaddingTop:function(){return this.getStyle(\"link.handler.padding.top\")},getPaddingBottom:function(){return this.getStyle(\"link.handler.padding.bottom\")},getDirection:function(){return this.getStyle(\"link.handler.direction\")},isFill:function(){return this.getStyle(\"link.handler.fill\")},getFillColor:function(){return this.getStyle(\"link.handler.fill.color\")},getGradient:function(){return this.getStyle(\"link.handler.gradient\")},getGradientColor:function(){return this.getStyle(\"link.handler.gradient.color\")},getOutlineWidth:function(){return this.getStyle(\"link.handler.outline.width\")},getOutlineColor:function(){return this.getStyle(\"link.handler.outline.color\")},getCap:function(){return this.getStyle(\"link.handler.cap\")},getJoin:function(){return this.getStyle(\"link.handler.join\")},getAlpha:function(){return this.getStyle(\"link.handler.alpha\")},isShadowable:function(){return this.getStyle(\"link.handler.shadowable\")}}),R.network.EditAttachment=function(t,e){R.network.EditAttachment.superClass.constructor.call(this,t,e),this._attachmentDiv=X.createDiv(),this._view.appendChild(this._attachmentDiv)},D.ext(\"twaver.network.EditAttachment\",R.network.Attachment,{updateMeasure:function(){R.network.EditAttachment.superClass.updateMeasure.call(this),this._viewRect=null,this._element instanceof Pe&&this._addResizingPoint(this._element),!(this._network.isRotatable(this._element)&&this._element instanceof Pe)||this._element instanceof R.ShapeNode||this._element instanceof R.Grid||this._element instanceof R.Group||this._addRotatePoint(this._element),this._element instanceof R.ShapeNode&&(this._addResizingPoint(this._element),this._addShapeNodePoint(this._element)),this._ui instanceof R.network.ShapeLinkUI&&this._addShapeLinkPoints(this._ui),this._ui instanceof R.network.LinkUI&&this._addLinkControlPoint(this._ui)},_addRotatePoint:function(t){if(!((n=this._network.getRotatePointSize())<=0)){var e=t.getOriginalRect();if(!this._rotateDiv){var i=X.createDiv();this._attachmentDiv.appendChild(i),this._rotateDiv=i}var n,s,o=this._network.getRotatePointOutlineWidth(),r=this._network.getRotatePointOutlineColor(),a=this._network.getRotatePointFillColor(),h=(n=this._network.getRotatePointSize(),2*n),l={x:e.x+e.width/2-n,y:e.y-this._network.getRotatePointOffset()-h,width:h,height:h};s=0==t.angle?l:this._getRotateRect(l,t.getAngle(),{x:e.x+e.width/2,y:e.y+e.height/2});var c=W.unionRect(t.getRect(),s);this._viewRect=W.unionRect(c,this._viewRect),X.setDiv(this._rotateDiv,l,a,o,r),this._rotateDiv._viewRect=s,X.setBorderRaidus(this._rotateDiv,h+\"px\"),this._rotateAttachments(this._rotateDiv,h/2,o)}},_addResizingPoint:function(t){var e=this._network.getResizePointSize();if(!(e<=0)){var i=t.getOriginalRect(),n=new oe([{x:i.x,y:i.y},{x:i.x+i.width/2,y:i.y},{x:i.x+i.width,y:i.y},{x:i.x,y:i.y+i.height/2},{x:i.x+i.width,y:i.y+i.height/2},{x:i.x,y:i.y+i.height},{x:i.x+i.width/2,y:i.y+i.height},{x:i.x+i.width,y:i.y+i.height}]);if(!this._resizeDivs){this._resizeDivs=new Array;for(var s=0;s<8;s++){var o=X.createDiv();this._attachmentDiv.appendChild(o),this._resizeDivs[s]=o}}if(this._resizeDivs){this._resizeRects=new Array;for(s=0;s<8;s++){var r,a=n.get(s),h={x:a.x-e,y:a.y-e,width:2*e,height:2*e};r=0==t.getAngle()?h:this._getRotateRect(h,t.getAngle(),{x:i.x+i.width/2,y:i.y+i.height/2}),this._resizeRects[s]=r}}var l=this._network.getResizePointOutlineWidth(),c=this._network.getResizePointOutlineColor(),d=this._network.getResizePointFillColor();this._addPoints(t.getRect(),n,l,c,d,!0)}},_addPoints:function(t,e,i,n,s,o){var r=o?this._network.getResizePointSize():this._network.getEditPointSize();if(!(r<=0)){var a=r+i;W.grow(t,a,a),this._viewRect=W.unionRect(t,this._viewRect);var h,l,c,d,u=2*r,_=new oe;for(h=0,l=e.size();h<l;h++)d={x:(c=e.get(h)).x-r,y:c.y-r,width:u,height:u},_.add(d);var g;if(o)g=this._resizeDivs;else{if(this._controlDivs||(this._controlDivs=new Array),this._controlDivs.length<l)for(h=this._controlDivs.length;h<l;h++){var f=X.createDiv();this._attachmentDiv.appendChild(f),this._controlDivs[h]=f}else if(this._controlDivs.length>l){for(h=l;h<this._controlDivs.length;h++)this._attachmentDiv.removeChild(this._controlDivs[h]);this._controlDivs.splice(l)}g=this._controlDivs}for(h=0,l=_.size();h<l;h++)d=_.get(h),X.setDiv(g[h],d,s,i,n),X.setBorderRaidus(g[h],(o?\"0\":u)+\"px\"),this._rotateAttachments(g[h],u/2,i,e.get(h))}},_rotateAttachments:function(t,e,i,n){if(this._element instanceof Pe){var s=this._element.getAngle();if(0==s)return;var o=this._element.getOriginalRect(),r=t.style.left.split(\"px\")[0],a=t.style.top.split(\"px\")[0];o.x,o.width,o.y,o.height;n||(n={x:parseFloat(r)+e+i,y:parseFloat(a)+e+i});var h=W.createMatrix(s*Math.PI/180,o.x+o.width/2,o.y+o.height/2).transform(n);t.style.webkitTransform=\"rotate(\"+s+\"deg)\",t.style.mozTransform=\"rotate(\"+s+\"deg)\",t.style.OTransform=\"rotate(\"+s+\"deg)\",t.style.msTransform=\"rotate(\"+s+\"deg)\",t.style.transform=\"rotate(\"+s+\"deg)\",t.style.left=h.x-e-i+\"px\",t.style.top=h.y-e-i+\"px\"}},_addShapeLinkPoints:function(t){this._addEditPoints(t._element.getPoints())},_addShapeNodePoint:function(t){this._addEditPoints(t.getPoints())},_addLinkControlPoint:function(t){if(pt.isOrthogonalLink(t._element)){var e=t.getControlPoint();if(e){var i=new oe;i.add(e),this._addEditPoints(i)}}},_addEditPoints:function(t){var e=W.getRect(t);if(e){var i=this._network.getEditPointOutlineWidth(),n=this._network.getEditPointOutlineColor(),s=this._network.getEditPointFillColor();this._addPoints(e,t,i,n,s,!1)}},hit:function(t,e){if(!W.containsPoint(this._viewRect,t,e))return!1;var i;if(this._resizeDivs)for(i=this._resizeDivs.length-1;i>=0;i--)if(W.containsPoint(this._resizeRects[i],t,e))return!0;if(this._rotateDiv&&W.containsPoint(this._rotateDiv._viewRect,t,e))return!0;if(this._controlDivs)for(i=this._controlDivs.length-1;i>=0;i--)if(W.containsPoint(this._controlDivs[i]._viewRect,t,e))return!0;return!1},intersects:function(t){if(!W.intersects(this._viewRect,t))return!1;var e;if(this._resizeDivs)for(e=this._resizeDivs.length-1;e>=0;e--)if(W.intersects(this._resizeRects[e],t))return!0;if(this._rotateDiv&&W.containsPoint(this._rotateDiv._viewRect,t))return!0;if(this._controlDivs)for(e=this._controlDivs.length-1;e>=0;e--)if(W.intersects(this._controlDivs[e]._viewRect,t))return!0;return W.intersects(this._viewRect,t),!1},_getRotateRect:function(t,e,i){var n=W.createMatrix(e*Math.PI/180,i.x,i.y),s={x:t.x+t.width/2,y:t.y+t.height/2},o=n.transform(s),r=new R.List([{x:o.x-t.width/2,y:o.y-t.height/2},{x:o.x+t.width/2,y:o.y-t.height/2},{x:o.x+t.width/2,y:o.y+t.height/2},{x:o.x-t.width/2,y:o.y+t.height/2}]);return W.getRect(r)}}),R.network.IconsAttachment=function(t,e){R.network.IconsAttachment.superClass.constructor.call(this,t,e),this._iconsCanvas=null},D.ext(\"twaver.network.IconsAttachment\",R.network.Attachment,{isShadowable:function(){return xe.ATTACHMENT_SHADOWABLE},updateMeasure:function(){R.network.IconsAttachment.superClass.updateMeasure.call(this);var t=this._network.getIconsNames(this._element);if(t&&0!=t.length){var e=this._network.getIconsColors(this._element),i=this._element.getStyle(\"icons.orientation\"),n=this._element.getStyle(\"icons.position\"),s=this._element.getStyle(\"icons.xoffset\");s=s instanceof Array?s[0]:s;var o=this._element.getStyle(\"icons.yoffset\");o=o instanceof Array?o[0]:o;var r=this._element.getStyle(\"icons.xgap\");r=r instanceof Array?r[0]:r;var a=this._element.getStyle(\"icons.ygap\");a=a instanceof Array?a[0]:a;var h=this._getIconsSize(t,i,r,a);if(h){var l=this._network.getPosition(n,this._ui,h,s,o);this._viewRect={x:l.x,y:l.y,width:h.width,height:h.height},\"top\"===i?l.y+=h.height:\"left\"===i&&(l.x+=h.width),this._iconsCanvas||(this._iconsCanvas=X.createCanvas(),this._view.appendChild(this._iconsCanvas));var c=this._ui.setShadow(this,this._iconsCanvas,D.clone(this._viewRect)),d=l.x,u=l.y,_=0;for(var g in t){var f=null,v=null;e&&e.length>_&&(v=e[_++]);var m=D.getImageAsset(t[g]);if(null!=m){if(\"right\"===i)d+=(f={x:d,y:u,width:m.getWidth(),height:m.getHeight()}).width+r;else if(\"left\"===i)d-=(f={x:d-m.getWidth(),y:u,width:m.getWidth(),height:m.getHeight()}).width+r;else if(\"top\"===i)u-=(f={x:d,y:u-m.getHeight(),width:m.getWidth(),height:m.getHeight()}).height+a;else{if(\"bottom\"!==i)throw\"Can not resolve '\"+i+\"' orientation\";u+=(f={x:d,y:u,width:m.getWidth(),height:m.getHeight()}).height+a}Dt(c,m.getImage(v,f.width,f.height),v,f,this._element,this._network)}}}}},_getIconsSize:function(t,e,i,n){var s=0,o=0,r=null,a=null,h=null;for(var l in t)if(a=D.getImageAsset(t[l])){if(\"right\"===e)s+=(r={x:s,y:o,width:a.getWidth(),height:a.getHeight()}).width+i;else if(\"left\"===e)s-=(r={x:s-a.getWidth(),y:o,width:a.getWidth(),height:a.getHeight()}).width+i;else if(\"top\"===e)o-=(r={x:s,y:o-a.getHeight(),width:a.getWidth(),height:a.getHeight()}).height+n;else{if(\"bottom\"!==e)throw\"Can not resolve '\"+e+\"' orientation\";o+=(r={x:s,y:o,width:a.getWidth(),height:a.getHeight()}).height+n}h=null==h?D.clone(r):W.unionRect(h,r)}return h?{width:Math.abs(h.width),height:Math.abs(h.height)}:null}}),R.network.HTMLBasicAttachment=function(t,e){function i(t,e,i,n,s,o,r){i||(i=this._origin.x),n||(n=this._origin.y),s||(s=this._location.x),o||(o=this._location.y),t=t-i-s,e=e-n-o;return R.Util.transformPoint({x:i+s,y:n+o},r?this._radian:-this._radian,t,e).point}R.network.HTMLBasicAttachment.superClass.constructor.call(this,t,e),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0},this._triangleDiv=R.Util.createDiv(),this._roundDiv=R.Util.createDiv(),this._contentDiv=R.Util.createDiv(),R.Util.setCSSStyle(this._triangleDiv,\"border-style\",\"solid\"),R.Util.setCSSStyle(this._contentDiv,\"white-space\",\"nowrap\");var n=this;this.hit=function(t,e){if(this._radian&&this._origin){var s=i.call(n,t,e);t=s.x,e=s.y}return R.Util.containsPoint(this._roundRect,t,e)||R.Util.containsPoint(this._pointerRect,t,e)},this.intersects=function(t){var e={x:t.x,y:t.y},s={x:t.x+t.width,y:t.y},o={x:t.x,y:t.y+t.height},r={x:t.x+t.width,y:t.y+t.height};if(this._radian&&this._origin){if(t.width*t.height>50)return!1;e=i.call(n,e.x,e.y),s=i.call(n,s.x,s.y),o=i.call(n,o.x,o.y),r=i.call(n,r.x,r.y)}return t=R.Util.getRect([e,s,o,r]),R.Util.intersects(this._roundRect,t)||R.Util.intersects(this._pointerRect,t)},this.getContentWidth=function(){return this._contentDiv.scrollWidth||parseInt(R.Util.getCSSStyle(this._contentDiv.firstChild,\"width\"))},this.getContentHeight=function(){return this._contentDiv.scrollHeight||parseInt(R.Util.getCSSStyle(this._contentDiv.firstChild,\"height\"))},this._view.appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},R.Util.ext(\"twaver.network.HTMLBasicAttachment\",R.network.BasicAttachment,{calculateMeasure:function(){var t=this.getContentWidth(),e=this.getContentHeight(),i=Math.min(this.getCornerRadius(),e/2),n=this.getPointerLength(),s=this.getPointerWidth(),o=this.getPosition(),r=this.getXOffset(),a=this.getYOffset();this._contentRect.width=t,this._contentRect.height=e,this._contentRect.x=i;var h=this._roundRect;h.width=t+2*i,h.height=e;var l;if(n>0){var c=this.getDirection();l=this._network.getPosition(o,this._ui,null,r,a);if(\"aboveleft\"===c){h.y=l.y-n-h.height,h.x=l.x-(h.width-i),this._pointers=[l,{x:l.x,y:l.y-n},{x:l.x-Math.min(s,t),y:l.y-n}];var d=n/2,u=Math.min(s,t)/2,_=this.getFillColor();this._triangleBorderWidthStyle=d+\"px \"+u+\"px \"+d+\"px \"+u+\"px\",this._triangleBorderColorStyle=_+\" \"+_+\" transparent transparent\",this._triangleDivLocation=this._pointers[2]}else if(\"aboveright\"===c){h.y=l.y-n-h.height,h.x=l.x-i,this._pointers=[l,{x:l.x,y:l.y-n},{x:l.x+Math.min(s,t),y:l.y-n}];d=n/2,u=Math.min(s,t)/2,_=this.getFillColor();this._triangleBorderWidthStyle=d+\"px \"+u+\"px \"+d+\"px \"+u+\"px\",this._triangleBorderColorStyle=_+\" transparent transparent \"+_,this._triangleDivLocation=this._pointers[1]}else if(\"belowleft\"===c){h.y=l.y+n,h.x=l.x-(h.width-i),this._pointers=[l,{x:l.x,y:l.y+n},{x:l.x-Math.min(s,t),y:l.y+n}];d=n/2,u=Math.min(s,t)/2,_=this.getFillColor();this._triangleBorderWidthStyle=d+\"px \"+u+\"px \"+d+\"px \"+u+\"px\",this._triangleBorderColorStyle=\" transparent \"+_+\" \"+_+\" transparent\",this._triangleDivLocation={x:this._pointers[2].x,y:l.y}}else if(\"belowright\"===c){h.y=l.y+n,h.x=l.x-i,this._pointers=[l,{x:l.x,y:l.y+n},{x:l.x+Math.min(s,t),y:l.y+n}];d=n/2,u=Math.min(s,t)/2,_=this.getFillColor();this._triangleBorderWidthStyle=d+\"px \"+u+\"px \"+d+\"px \"+u+\"px\",this._triangleBorderColorStyle=\"transparent transparent \"+_+\" \"+_,this._triangleDivLocation=this._pointers[0]}else if(\"above\"===c){h.y=l.y-n-h.height,h.x=l.x-h.width/2,this._pointers=[l,{x:l.x-Math.min(s,t)/2,y:l.y-n},{x:l.x+Math.min(s,t)/2,y:l.y-n}];d=n,u=Math.min(s,t)/2,_=this.getFillColor();this._triangleBorderWidthStyle=d+\"px \"+u+\"px 0px \"+u+\"px\",this._triangleBorderColorStyle=_+\" transparent transparent transparent\",this._triangleDivLocation=this._pointers[1]}else if(\"below\"===c){h.y=l.y+n,h.x=l.x-h.width/2,this._pointers=[l,{x:l.x-Math.min(s,t)/2,y:l.y+n},{x:l.x+Math.min(s,t)/2,y:l.y+n}];d=n,u=Math.min(s,t)/2,_=this.getFillColor();this._triangleBorderWidthStyle=\"0px \"+u+\"px \"+d+\"px \"+u+\"px\",this._triangleBorderColorStyle=\"transparent transparent \"+_+\" transparent \",this._triangleDivLocation={x:this._pointers[1].x,y:l.y}}else if(\"left\"===c){h.y=l.y-h.height/2,h.x=l.x-h.width-n,this._pointers=[l,{x:l.x-n,y:l.y-Math.min(s,e)/2},{x:l.x-n,y:l.y+Math.min(s,e)/2}];d=Math.min(s,e)/2,u=n,_=this.getFillColor();this._triangleBorderWidthStyle=d+\"px 0px \"+d+\"px \"+u+\"px\",this._triangleBorderColorStyle=\"transparent transparent  transparent \"+_,this._triangleDivLocation=this._pointers[1]}else{if(\"right\"!==c)throw\"Can not resolve '\"+c+\"' attachment direction\";h.y=l.y-h.height/2,h.x=l.x+n,this._pointers=[l,{x:l.x+n,y:l.y-Math.min(s,e)/2},{x:l.x+n,y:l.y+Math.min(s,e)/2}];d=Math.min(s,e)/2,u=n,_=this.getFillColor();this._triangleBorderWidthStyle=d+\"px \"+u+\"px \"+d+\"px 0px\",this._triangleBorderColorStyle=\"transparent \"+_+\" transparent  transparent \",this._triangleDivLocation={x:l.x,y:this._pointers[1].y}}}else l=this._network.getPosition(o,this._ui,{width:h.width,height:h.height},r,a),h.x=l.x,h.y=l.y,this._pointers=null;this._location=l},updateMeasure:function(){if(this.calculateMeasure(),this._ui.isShadowable()&&this.isShadowable()?R.Util.setCSSStyle(this._roundDiv,\"text-shadow\",this._ui._shadowXOffset+\"px \"+this._ui._shadowYOffset+\"px \"+this._ui._shadowBlur+\"px \"+this._ui._shadowColor):R.Util.removeCSSStyle(this._roundDiv,\"text-shadow\"),this._pointerRect=R.Util.getRect(this._pointers),this._viewRect=R.Util.unionRect(this._pointerRect,this._roundRect),R.Util.setCSSStyle(this._contentDiv,\"left\",this._contentRect.x+\"px\"),R.Util.setCSSStyle(this._contentDiv,\"top\",this._contentRect.y+\"px\"),R.Util.setCSSStyle(this._roundDiv,\"left\",this._roundRect.x+\"px\"),R.Util.setCSSStyle(this._roundDiv,\"top\",this._roundRect.y+\"px\"),R.Util.setCSSStyle(this._roundDiv,\"width\",this._roundRect.width+\"px\"),R.Util.setCSSStyle(this._roundDiv,\"height\",this._roundRect.height+\"px\"),R.Util.setCSSStyle(this._roundDiv,\"background\",this.isFill()?this.getFillColor():null),R.Util.setCSSStyle(this._roundDiv,\"-webkit-border-radius\",this.getCornerRadius()+\"px\"),R.Util.setCSSStyle(this._roundDiv,\"-moz-border-radius\",this.getCornerRadius()+\"px\"),R.Util.setCSSStyle(this._roundDiv,\"border-radius\",this.getCornerRadius()+\"px\"),this._pointers?(R.Util.setCSSStyle(this._triangleDiv,\"left\",this._triangleDivLocation.x+\"px\"),R.Util.setCSSStyle(this._triangleDiv,\"top\",this._triangleDivLocation.y+\"px\"),R.Util.setCSSStyle(this._triangleDiv,\"border-width\",this._triangleBorderWidthStyle),R.Util.setCSSStyle(this._triangleDiv,\"border-color\",this._triangleBorderColorStyle),this._view.appendChild(this._triangleDiv)):this._triangleDiv.parentNode==this._view&&this._view.removeChild(this._triangleDiv),this._element.getStyle(\"label.rotatable\")&&this.label){var t=this._ui.getFromPoint(),e=this._ui.getToPoint(),i=this._ui.getLinkPoints();i.size()%2==0&&(t=i.get(i.size()/2-1),e=i.get(i.size()/2)),t.x>e.x?this._radian=R.Util.getRadiansBetweenLines(e,t):this._radian=R.Util.getRadiansBetweenLines(t,e),this._origin={x:this._contentRect.width/2,y:0};var n=\"rotate(\"+R.Util.toDegrees(this._radian)+\"deg)\",s=this._origin.x+\"px \"+this._origin.y+\"px\";R.Util.isChrome||R.Util.isSafari?(R.Util.setCSSStyle(this._roundDiv,\"-webkit-transform\",n),R.Util.setCSSStyle(this._roundDiv,\"-webkit-transform-origin\",s)):R.Util.isIE?(R.Util.setCSSStyle(this._roundDiv,\"-ms-transform\",n),R.Util.setCSSStyle(this._roundDiv,\"-ms-transform-origin\",s)):(R.Util.setCSSStyle(this._roundDiv,\"transform\",n),R.Util.setCSSStyle(this._roundDiv,\"transform-origin\",s))}else R.Util.removeCSSStyle(this._roundDiv,\"-webkit-transform\"),R.Util.removeCSSStyle(this._roundDiv,\"-webkit-transform-origin\"),R.Util.removeCSSStyle(this._roundDiv,\"-ms-transform\"),R.Util.removeCSSStyle(this._roundDiv,\"-ms-transform-origin\"),R.Util.removeCSSStyle(this._roundDiv,\"transform\"),R.Util.removeCSSStyle(this._roundDiv,\"transform-origin\"),delete this._origin,delete this._radian}}),R.network.HTMLLabelAttachment=function(t,e){R.network.HTMLBasicAttachment.call(this,t,e),this.label=!0},R.Util.ext(\"twaver.network.HTMLLabelAttachment\",R.network.LabelAttachment,{updateMeasure:function(){var t=this.getFont(\"label.font\"),e=this.getLabel();this._contentDiv.innerHTML=e,R.Util.setCSSStyle(this._contentDiv,\"font\",t),R.network.HTMLBasicAttachment.prototype.updateMeasure.call(this),R.Util.removeCSSStyle(this._contentDiv,\"font\")},calculateMeasure:R.network.HTMLBasicAttachment.prototype.calculateMeasure}),R.network.HTMLAlarmAttachment=function(t,e){R.network.HTMLBasicAttachment.call(this,t,e),this.alarm=!0},R.Util.ext(\"twaver.network.HTMLAlarmAttachment\",R.network.AlarmAttachment,{updateMeasure:function(){var t=this.getFont(\"alarm.font\");this._contentDiv.innerHTML=this._network.getAlarmLabel(this._element),R.Util.setCSSStyle(this._contentDiv,\"font\",t),this._fillColor=this._network.getAlarmFillColor(this._element),R.network.HTMLBasicAttachment.prototype.updateMeasure.call(this),R.Util.removeCSSStyle(this._contentDiv,\"font\")},calculateMeasure:R.network.HTMLBasicAttachment.prototype.calculateMeasure}),R.network.NodeUI=function(t,e){R.network.NodeUI.superClass.constructor.call(this,t,e)},D.ext(\"twaver.network.NodeUI\",R.network.ElementUI,{createBodyRect:function(){return this._element.getRect()},invalidate:function(t){R.network.NodeUI.superClass.invalidate.call(this,t);var e=this._element.getAgentLinks();e&&e.forEach(function(t){this._network.invalidateElementUI(t,!1)},this)},updateMeasure:function(){R.network.NodeUI.superClass.updateMeasure.call(this);var t=this.getStyle(\"vector.shape\"),e=this.getBodyRect();this._hotSpot=W.getHotSpot(e.x,e.y,e.width,e.height,t),this.drawBody(),this._outerColor&&this.drawOuterBorder(),!this._editAttachment&&\"border\"===this.getStyle(\"select.style\")&&this._network.isSelected(this._element)&&this.drawSelectBorder(),this.cleanUp([\"_selectCanvas\",\"_nodeCanvas\",\"_nodeImage\",\"_nodeComponent\",\"_vectorCanvas\",\"_outerCanvas\"]);var i=this._element.getParent();i instanceof De&&this._network.invalidateElementUI(i,!1)},drawBody:function(){var t=this.getStyle(\"body.type\");\"default\"===t?this.drawDefaultBody():\"vector\"===t?this.drawVectorBody():\"default.vector\"===t?(this.drawVectorBody(),this.drawDefaultBody()):\"vector.default\"===t?(this.drawDefaultBody(),this.drawVectorBody()):this.addBodyBounds({x:this._element.getX(),y:this._element.getY(),width:0,height:0})},drawOuterBorder:function(){var t=this._element,e=t.getStyle(\"outer.width\");if(e>0){var i=this.getBodyRect();W.addPadding(i,t,\"outer.padding\",1),this._outerCanvas||(this._outerCanvas=X.createCanvas());var n=D.clone(i);W.grow(n,e/2,e/2);var s=X.setCanvas(this._outerCanvas,n);s.lineWidth=e,s.lineCap=t.getStyle(\"outer.cap\"),s.lineJoin=t.getStyle(\"outer.join\"),s.strokeStyle=this._outerColor,Y.drawVector(s,t.getStyle(\"outer.shape\"),null,i),s.stroke(),this.addComponent(this._outerCanvas),this.addBodyBounds(n)}},drawSelectBorder:function(){var t=this._element,e=t.getStyle(\"select.width\");if(e>0){var i=this.getBodyRect();i=D.clone(i);var n=t.getStyle(\"select.physicalZoom\")?1:this._network.getGraphicsZoom();W.addPadding(i,t,\"select.padding\",1/n),this._selectCanvas||(this._selectCanvas=X.createCanvas()),W.grow(i,e/2/n,e/2/n);var s=X.setCanvas(this._selectCanvas,bounds);s.lineWidth=e/n,s.lineCap=t.getStyle(\"select.cap\"),s.lineJoin=t.getStyle(\"select.join\"),s.strokeStyle=t.getStyle(\"select.color\"),Y.drawVector(s,t.getStyle(\"select.shape\"),null,i),s.stroke(),this.addComponent(this._selectCanvas),this.addBodyBounds(bounds)}},drawDefaultBody:function(){var t=this._element,e=D.getImageAsset(t.getImage()),i=this.getBodyRect();if(!e)return this.addBodyBounds(i),void(this._currentImageAsset=null);if(W.addPadding(i,this._element,\"image.padding\",1),e.getImage()){this._nodeCanvas||(this._nodeCanvas=X.createCanvas());var n=D.clone(i),s=this.setShadow(this,this._nodeCanvas,n);0!=t.getAngle()&&(i=t.getOriginalRect(),R.Util.rotateCanvas(s,i,t.getAngle())),Dt(s,t.getImage(),this.getInnerColor(),i,t,this._network),i=n,this.addComponent(this._nodeCanvas)}else if(e.getSrc())this._nodeImage||(this._nodeImage=X.createImg()),X.setImg(this._nodeImage,e.getSrc(),i),this.addComponent(this._nodeImage);else{if(!e.getFunction())throw\"ImageAsset '\"+t.getImage()+\" ' is empty\";this._currentImageAsset!==e?this._nodeComponent=e.getFunction()(this,i):this._nodeComponent=e.getFunction()(this,i,this._nodeComponent),this.addComponent(this._nodeComponent),this._nodeComponent._viewRect=D.clone(i)}this.addBodyBounds(i),this._currentImageAsset=e},hit:function(t,e){if(this._network._transparentSelectionEnable){var i=this.getBodyRect();if(D.math.containsPoint(i,t,e))return!0}return!!this.hitCanvas(t,e,[\"_nodeCanvas\",\"_outerCanvas\",\"_vectorCanvas\"])||this.hitComponent(t,e,[\"_nodeImage\",\"_nodeComponent\"])},intersects:function(t){if(this._network._transparentSelectionEnable){var e=this.getBodyRect();if(D.math.intersects(e,t))return!0}return!!this.intersectsCanvas(t,[\"_nodeCanvas\",\"_outerCanvas\",\"_vectorCanvas\"])||this.intersectsComponent(t,[\"_nodeImage\",\"_nodeComponent\"])},drawVectorBody:function(){this._vectorCanvas||(this._vectorCanvas=X.createCanvas());var t=Y.drawPath(this,this._vectorCanvas,\"vector\",!0,this._element.getStyle(\"vector.outline.pattern\")),e=this.getStyle(\"vector.deep\"),i=this._vectorCanvas.getContext(\"2d\"),n=this.getBodyRect(),s=this.getStyle(\"vector.fill.color\");if(0!==e&&s){var o=this._element.getAngle();0!=o&&(n=this._element.getOriginalRect(),R.Util.rotateCanvas(i,n,-o),R.Util.rotateCanvas(i,n,o)),\"rectangle\"===this.getStyle(\"vector.shape\")&&Y.draw3DRect(i,s,e,n)}this.addBodyBounds(t),this.addComponent(this._vectorCanvas)}}),R.network.LinkUI=function(t,e){R.network.LinkUI.superClass.constructor.call(this,t,e),this._linkCanvas=X.createCanvas()},D.ext(\"twaver.network.LinkUI\",R.network.ElementUI,{isEditable:function(){return!(!pt.isOrthogonalLink(this._element)||!this.getControlPoint())},createBodyRect:function(){var t=this.getHotSpot();return t?{x:t.x-1,y:t.y-1,width:2,height:2}:null},hit:function(t,e){return this.hitCanvas(t,e,[\"_linkCanvas\"])},intersects:function(t){return this.intersectsCanvas(t,[\"_linkCanvas\"])},checkAttachments:function(){R.network.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var t=this._network.getLinkHandlerLabel(this._element);null!=t&&\"\"!==t?this._linkHandlerAttachment||(this._linkHandlerAttachment=new R.network.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=W.calculateLineLength(this._linkPoints)),this._linkPoints},invalidate:function(t){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,R.network.LinkUI.superClass.invalidate.call(this,t)},getFromPosition:function(t,e){var i=this.getFromPoint();return i?{x:i.x+t,y:i.y+e}:null},getToPosition:function(t,e){var i=this.getToPoint();return i?{x:i.x+t,y:i.y+e}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=pt.createFromPoint(this)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=pt.createToPoint(this)),this._toPoint},updateMeasure:function(){R.network.LinkUI.superClass.updateMeasure.call(this),this.drawBody()},createLinkPoints:function(){var t=this.getFromPoint(),e=this.getToPoint(),i=this.getStyle(\"link.type\"),n=new oe;if(pt.isOrthogonalOrFlexionalLink(this._element))n=pt.orthogonalAndFlexional(this,i);else if(this._element.isLooped()){var s=this._network.getElementUI(this._element.getFromAgent());null!=s&&(this._hotSpot=pt.fillLoopedPoints(this,s.getBodyRect(),n))}else{if(\"arc\"!==i&&\"triangle\"!==i&&\"parallel\"!==i)throw\"Can not resolve link type '\"+i+\"'\";this._hotSpot=pt.fillBundlePoints(this,i,t,e,n)}if(this._network._linkPathFunction){var o=this._network._linkPathFunction(this,n);o&&(n=o)}return n},drawLinePoints:function(t,e,i,n,s){if(t.lineWidth=i,t.strokeStyle=n,!0===this._element.getStyle(\"link.flow\")&&s&&s.length>1){var o=new ft(t,s[0],s[1]),r=this._element.getStyle(\"link.flow.offset\");this._element.getStyle(\"link.flow.converse\")?r<s[0]?o.overflow=s[0]-r:r>=s[0]&&r<=s[0]+s[1]?(o.overflow=s[1]-(r-s[0]),o.overflow&&(o.isLine=!1)):(r-=s[0]+s[1],o.overflow=s[0]-r):r<=s[1]?(o.overflow=r,r&&(o.isLine=!1)):r>s[1]&&r<=s[0]+s[1]?o.overflow=r-s[1]:((r-=s[0]+s[1])&&(o.isLine=!1),o.overflow=r),this._element._styleMap[\"link.flow.offset\"]=r,t.beginPath(),Y._drawLine(e,t),t.stroke(),t.shadowColor=\"transparent\",t.beginPath();var a=this._element.getStyle(\"link.flow.color\");a=a||xe.NETWORK_LINK_FLOW_COLOR,t.strokeStyle=a,Y._drawLine(e,o),t.stroke(),t.shadowColor=this._shadowColor}else t.beginPath(),Y.drawLinePoints(t,e,s),t.stroke()},drawBody:function(){var t=this.getLinkPoints();if(t&&!(t.size()<2)){var e=this._element,i=W.getLineRect(t),n=e.getStyle(\"link.width\"),s=n;if(this._outerColor){var o=e.getStyle(\"outer.width\");s+=2*o}var r=!this._editAttachment&&\"border\"===e.getStyle(\"select.style\")&&this._network.isSelected(this._element);if(r){s+=2*e.getStyle(\"select.width\")}W.grow(i,s/2,s/2),e.getStyle(\"arrow.from\")&&(i=W.unionRect(i,re.getArrowRect(t,!0,e.getStyle(\"arrow.from.shape\"),e.getStyle(\"arrow.from.width\"),e.getStyle(\"arrow.from.height\"),e.getStyle(\"arrow.from.xoffset\"),e.getStyle(\"arrow.from.yoffset\")))),e.getStyle(\"arrow.to\")&&(i=W.unionRect(i,re.getArrowRect(t,!1,e.getStyle(\"arrow.to.shape\"),e.getStyle(\"arrow.to.width\"),e.getStyle(\"arrow.to.height\"),e.getStyle(\"arrow.to.xoffset\"),e.getStyle(\"arrow.to.yoffset\"))));var a=this.setShadow(this,this._linkCanvas,i);a.lineCap=e.getStyle(\"link.cap\"),a.lineJoin=e.getStyle(\"link.join\");var h=e.getStyle(\"link.pattern\");r&&this.drawLinePoints(a,t,s,e.getStyle(\"select.color\"),h),this._outerColor&&this.drawLinePoints(a,t,n+2*o,this._outerColor,h),this.drawLinePoints(a,t,n,this._innerColor||e.getStyle(\"link.color\"),h),this.addBodyBounds(i),this.addComponent(this._linkCanvas),re.drawLinkArrow(this,a,t)}},getControlPoint:function(){return pt.getControlPoint(this._element,this)},setControlPoint:function(t){if(t){var e=this.getStyle(\"link.type\");if(pt.hasControlPoint(e)){var i=pt.getLinkSourceBounds(this),n=pt.getLinkTargetBounds(this);pt.setParamsByControlPoint(t,i,n,e,this._element)}}},getLineLength:function(){return this._lineLength}}),R.network.HTMLLinkUI=function(t,e){R.network.HTMLLinkUI.superClass.constructor.call(this,t,e)},D.ext(\"twaver.network.HTMLLinkUI\",R.network.LinkUI,{checkAttachments:function(){R.network.LinkUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var t=this._element.getStyle(\"attachment.label.style\");if(t&&\"none\"===t)R.network.HTMLLinkUI.superClass.checkLabelAttachment.call(this);else{var e=this._network.getLabel(this._element);null!=e&&\"\"!==e?this._labelAttachment||(this._labelAttachment=new R.network.HTMLLabelAttachment(this),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)}},checkAlarmAttachment:function(){var t=this._element.getStyle(\"attachment.alarm.style\");if(t&&\"none\"===t)R.network.HTMLLinkUI.superClass.checkAlarmAttachment.call(this);else{var e=this._network.getAlarmLabel(this._element);null!=e&&\"\"!==e?this._alarmAttachment||(this._alarmAttachment=new R.network.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)}}}),R.network.GroupUI=function(t,e){R.network.GroupUI.superClass.constructor.call(this,t,e)},D.ext(\"twaver.network.GroupUI\",R.network.NodeUI,{isEditable:function(){return!this._element.isExpanded()},drawBody:function(){this.getBodyRect();this._shapeRect?this.drawExpandedGroup():R.network.GroupUI.superClass.drawBody.call(this)},drawExpandedGroup:function(){this._nodeCanvas||(this._nodeCanvas=X.createCanvas());var t=Y.drawPath(this,this._nodeCanvas,\"group\",!1,this._element.getStyle(\"vector.outline.pattern\")),e=this.getStyle(\"group.deep\"),i=this.getStyle(\"group.fill.color\");0!==e&&i&&\"rectangle\"===this.getStyle(\"group.shape\")&&Y.draw3DRect(this._nodeCanvas.getContext(\"2d\"),i,e,this._bodyRect),this.addBodyBounds(t),this.addComponent(this._nodeCanvas)},getChildrenRects:function(){return this._network.getGroupChildrenRects(this._element)},createBodyRect:function(){this._shapeRect=null;var t=this._element;if(t.isExpanded()){var e=this.getChildrenRects();if(!e.isEmpty()){var i=t.getStyle(\"group.shape\"),n=Z[i];if(!n)throw\"Can not resolve group shape '\"+i+\"'\";this._shapeRect=n(e)}}return this._shapeRect?(W.addPadding(this._shapeRect,t,\"group.padding\",1),this._shapeRect):R.network.GroupUI.superClass.createBodyRect.call(this)}}),R.network.GridUI=function(t,e){R.network.GridUI.superClass.constructor.call(this,t,e)},D.ext(\"twaver.network.GridUI\",R.network.NodeUI,{drawDefaultBody:function(){this._element.getImage()?R.network.GridUI.superClass.drawDefaultBody.call(this):this.drawGridBody()},drawGridBody:function(){var t=this.getStyle(\"grid.fill\"),e=this.getStyle(\"grid.deep\"),i=this.getStyle(\"grid.cell.deep\");if(t||0!==e||0!==i){var n=this.getBodyRect(),s=this.getDyeColor(\"grid.fill.color\");this._nodeCanvas||(this._nodeCanvas=X.createCanvas());var o=D.clone(n),r=this.setShadow(this,this._nodeCanvas,o);if(r.rect(n.x,n.y,n.width,n.height),this.addComponent(this._nodeCanvas),t&&(r.fillStyle=s,r.fill()),0!=e&&Y.draw3DRect(r,s,e,n.x,n.y,n.width,n.height),0!=i)for(var a=this.getStyle(\"grid.row.count\"),h=this.getStyle(\"grid.column.count\"),l=0;l<a;l++)for(var c=0;c<h;c++){var d=this._element.getCellRect(l,c);null!=d&&Y.draw3DRect(r,s,i,d.x,d.y,d.width,d.height)}this.addBodyBounds(o)}}}),R.network.ShapeNodeUI=function(t,e){R.network.ShapeNodeUI.superClass.constructor.call(this,t,e)},D.ext(\"twaver.network.ShapeNodeUI\",R.network.NodeUI,{drawDefaultBody:function(){if(this._element._points.size()<2)this.addBodyBounds({x:this._element.getX(),y:this._element.getY(),width:0,height:0});else{this._nodeCanvas||(this._nodeCanvas=X.createCanvas());var t=Y.drawPath(this,this._nodeCanvas,\"vector\",!0,this._element.getStyle(\"vector.outline.pattern\"),this._element._points,this._element._segments,this._element.getStyle(\"shapenode.closed\"));this.addBodyBounds(t),this.addComponent(this._nodeCanvas),re.drawLinkArrow(this,this._nodeCanvas.getContext(\"2d\"),W.getPointObject(this._element._points,this._element._segments))}},drawSelectBorder:function(){var t=this._element,e=t.getStyle(\"select.width\");if(e>0){var i=this.getBodyRect();i=D.clone(i);var n=t.getStyle(\"select.physicalZoom\")?1:this._network.getGraphicsZoom();W.addPadding(i,t,\"select.padding\",1/n);var s=t.getStyle(\"vector.outline.width\");s>0&&W.grow(i,s/2,s/2),this._selectCanvas||(this._selectCanvas=X.createCanvas()),W.grow(i,e/2/n,e/2/n);var o=X.setCanvas(this._selectCanvas,i);o.lineWidth=e/n,o.lineCap=t.getStyle(\"select.cap\"),o.lineJoin=t.getStyle(\"select.join\"),o.strokeStyle=t.getStyle(\"select.color\"),Y.drawVector(o,t.getStyle(\"select.shape\"),null,i),o.stroke(),this.addComponent(this._selectCanvas),this.addBodyBounds(bounds)}}}),R.network.ShapeLinkUI=function(t,e){R.network.ShapeLinkUI.superClass.constructor.call(this,t,e)},D.ext(\"twaver.network.ShapeLinkUI\",R.network.LinkUI,{isEditable:function(){return!0},createLinkPoints:function(){var t=this.getFromPoint(),e=this.getToPoint(),i=new oe,n=this.getStyle(\"shapelink.type\");i.add(t),null!=this._element._points&&i.addAll(this._element._points),i.add(e);var s=i.size(),o=Math.floor(s/2);if(s%2==0){var r=i.get(o),a=i.get(o-1);this._hotSpot={x:(r.x+a.x)/2,y:(r.y+a.y)/2}}else this._hotSpot=D.clone(i.get(o));var h,l,c;if(\"lineto\"===n);else if(\"quadto\"===n){for(h=new oe(i.get(0)),l=1,s=i.size();l<s;l++)l<s-1?h.add(new oe([i.get(l++),i.get(l)])):h.add(i.get(l));i=h}else if(\"cubicto\"===n){for(h=new oe(i.get(0)),l=1,s=i.size();l<s;l++)l<s-2?h.add(new oe([i.get(l++),i.get(l++),i.get(l)])):l<s-1?h.add(new oe([i.get(l++),i.get(l)])):h.add(i.get(l));i=h}else{if(\"orthogonalto\"!==n)throw\"Can not resolve shapelink type '\"+n+\"'\";for(c=i.get(0),h=new oe(c),l=1,s=i.size();l<s;l++)if(l<s-1){var d=D.clone(i.get(l)),u=d.x,_=d.y,g=u-c.x,f=_-c.y;Math.abs(g)>Math.abs(f)?(d.x=u,d.y=c.y):(d.x=c.x,d.y=_),c=d,h.add(c)}else h.add(i.get(l));i=h}return i}}),R.network.RotatableNodeUI=function(t,e){R.network.RotatableNodeUI.superClass.constructor.call(this,t,e)},D.ext(\"twaver.network.RotatableNodeUI\",R.network.NodeUI,{isEditable:function(){return!1},drawDefaultBody:function(){var t=this._element,e=D.getImageAsset(t.getImage()),i=this.getBodyRect();if(!e)return this.addBodyBounds(i),void(this._currentImageAsset=null);if(W.addPadding(i,this._element,\"image.padding\",1),e.getImage()){this._nodeCanvas||(this._nodeCanvas=X.createCanvas());var n=D.clone(i),s=this.setShadow(this,this._nodeCanvas,n),o=this._element._getOrignalWidth(),r=this._element._getOrignalHeight(),a=this._element._getRotateRect();s.save(),s.translate(i.x-a.x+o/2,i.y-a.y+r/2),s.rotate(this._element._angle*Math.PI/180);i={x:-o/2,y:-r/2,width:o,height:r};Dt(s,e.getImage(this._innerColor,i.width,i.height),this._innerColor,i,t,this._network),s.restore(),this.addComponent(this._nodeCanvas)}else if(e.getSrc());else if(!e.getFunction())throw\"ImageAsset '\"+t.getImage()+\" ' is empty\";this.addBodyBounds(i),this._currentImageAsset=e}}),R.network.HTMLNodeUI=function(t,e){R.network.HTMLNodeUI.superClass.constructor.call(this,t,e)},R.Util.ext(\"twaver.network.HTMLNodeUI\",R.network.NodeUI,{checkAttachments:function(){R.network.NodeUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var t=this._element.getStyle(\"attachment.label.style\");if(t&&\"none\"===t)R.network.HTMLNodeUI.superClass.checkLabelAttachment.call(this);else{var e=this._network.getLabel(this._element);null!=e&&\"\"!==e?this._labelAttachment||(this._labelAttachment=new R.network.HTMLLabelAttachment(this,xe.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)}},checkAlarmAttachment:function(){var t=this._element.getStyle(\"attachment.alarm.style\");if(t&&\"none\"===t)R.network.HTMLNodeUI.superClass.checkAlarmAttachment.call(this);else{var e=this._network.getAlarmLabel(this._element);null!=e&&\"\"!==e?this._alarmAttachment||(this._alarmAttachment=new R.network.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)}}}),R.network.interaction.BaseInteraction=function(t){this.network=t},D.ext(\"twaver.network.interaction.BaseInteraction\",Object,{setUp:function(){},tearDown:function(){},addListener:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];X.addEventListener(e,\"handle_\"+e,this.network.getView(),this)}},removeListener:function(){for(var t=0;t<arguments.length;t++)X.removeEventListener(arguments[t],this.network.getView(),this)},_handle_mousedown:function(t){0===t.button&&(this._startLogical=this.network.getLogicalPoint(t),this._startClient=X.getClientPoint(t),this._startLogical&&X.handle_mousedown(this,t))},_handle_mousemove:function(t){this._endLogical={x:this._startLogical.x+(t.clientX-this._startClient.x)/this.network.getZoom(),y:this._startLogical.y+(t.clientY-this._startClient.y)/this.network.getZoom()}},_handle_mouseup:function(t){delete this._startClient,delete this._startLogical,delete this._endLogical}}),R.network.interaction.SelectInteraction=function(t){R.network.interaction.SelectInteraction.superClass.constructor.call(this,t)},D.ext(\"twaver.network.interaction.SelectInteraction\",R.network.interaction.BaseInteraction,{setUp:function(){this.addListener(\"mousedown\")},tearDown:function(){this.removeListener(\"mousedown\"),this.end()},handle_mousedown:function(t){if(this._button=t.button,this.network.isValidEvent(t)&&!this.network.isMovingElement()&&!this.network.isEditingElement()&&!t.shiftKey){var e=this.network.getElementAt(t),i=this.network.getSelectionModel();e?D.isCtrlDown(t)?i.contains(e)?i.removeSelection(e):i.appendSelection(e):i.contains(e)||i.setSelection(e):(D.isCtrlDown(t)||i.clearSelection(),this.end(t),this.network.getLogicalPoint(t)&&this.network.isRectSelectEnabled()&&this._handle_mousedown(t))}},handle_mouseup:function(t){this.end(t)},handle_mousemove:function(t){if(0!==this._button||this.network.isMovingElement()||this.network.isEditingElement())this.end(t);else{this._handle_mousemove(t),this.mark?this.network.fireInteractionEvent({kind:\"selectBetween\",event:t}):(this.mark=X.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:\"selectStart\",event:t}));var e=W.getRect([this._startLogical,this._endLogical]);X.setDiv(this.mark,e,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())}},end:function(t){if(this._startLogical){if(this.mark){if(this._endLogical&&this._startLogical.x!==this._endLogical.x&&this._startLogical.y!==this._endLogical.y){var e=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(e&&e.size()>0){var i=this.network.getSelectionModel(),n=i.toSelection();e.forEach(function(t){i.contains(t)?n.remove(t):n.add(t)},this),i.setSelection(n)}this.network.fireInteractionEvent({kind:\"selectEnd\",event:t})}var s=this;setTimeout(function(){s.mark&&(s.network.getTopDiv().removeChild(s.mark),s.mark=null)},0),this.network.setSelectingElement(!1)}this._handle_mouseup(t)}},getIntersectMode:function(){return\"intersect\"===this.network.getSelectMode()||\"contain\"!==this.network.getSelectMode()&&(this._startLogical.x>this._endLogical.x&&this._startLogical.y>this._endLogical.y)}}),R.network.interaction.MoveInteraction=function(t,e){this.lazyMode=e,this.xoffset=0,this.yoffset=0,R.network.interaction.MoveInteraction.superClass.constructor.call(this,t),this.currentKeyEvent=null},D.ext(\"twaver.network.interaction.MoveInteraction\",R.network.interaction.BaseInteraction,{setUp:function(){this.addListener(\"mousedown\",\"keydown\",\"mouseleave\")},tearDown:function(){this.removeListener(\"mousedown\",\"keydown\",\"mouseleave\"),this.end()},handle_keydown:function(t){this.currentKeyEvent=t,this.addListener(\"keyup\")},handle_keyup:function(t){this.currentKeyEvent=null,this.removeListener(\"keyup\")},handle_mouseleave:function(t){this.end(t)},isParenting:function(){return this._startLogical&&null!=this.currentKeyEvent&&80===this.currentKeyEvent.keyCode},parentProcess:function(t,e){var i=null;null!=this.parent&&(i=this.network.getElementUI(this.parent).getViewRect(),this.parent=null);if(t=this.network.getLogicalPoint(t),!e&&this.isParenting()){var n={};n.x=t.x-1,n.y=t.y-1,n.width=2,n.height=2;var s=this.network.getElementsAtRect(n,!0);if(s&&s.size()>0)for(var o=s.size(),r=0;r<o;r++){var a=s.get(r);if(!this.network.getElementBox().getSelectionModel().contains(a)){this.parent=a;break}}}null!=this.parent&&(i=this.network.getElementUI(this.parent).getViewRect()),null==i||e?this.parentMark&&(this.network.getTopDiv().removeChild(this.parentMark),this.parentMark=null):(this.parentMark||(this.parentMark=D.html.createDiv(),this.network.getTopDiv().appendChild(this.parentMark)),D.html.setDiv(this.parentMark,i,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()))},handle_mousedown:function(t){if(0===t.button&&!this.network.isSelectingElement()&&!this.network.isEditingElement()){var e=this.network.getElementAt(t);this.network.isMovable(e)&&(this.end(t),this._handle_mousedown(t))}},handle_mouseup:function(t){this.end(t)},handle_mousemove:function(t){if(!this.network.isSelectingElement()&&!this.network.isEditingElement()&&this.network.hasMovableSelectedElements()&&this._startLogical){if(this._handle_mousemove(t),this.xoffset=this._endLogical.x-this._startLogical.x,this.yoffset=this._endLogical.y-this._startLogical.y,this.lazyMode){if(this.mark)this.network.fireInteractionEvent({kind:\"lazyMoveBetween\",event:t});else{this.mark=X.createDiv();var e;this.network.getMovableSelectedElements().forEach(function(t){var i=this.getElementUI(t);i&&(e=W.unionRect(e,i.getViewRect()))},this.network),this.network.getTopDiv().appendChild(this.mark),this.network.setMovingElement(!0),X.setDiv(this.mark,e,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()),this.network.fireInteractionEvent({kind:\"lazyMoveStart\",event:t})}this.mark.style.left=this.xoffset+this.mark._viewRect.x+\"px\",this.mark.style.top=this.yoffset+this.mark._viewRect.y+\"px\"}else this._startLogical=this._endLogical,this._startClient=X.getClientPoint(t),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:\"liveMoveBetween\",event:t}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:\"liveMoveStart\",event:t})),this.network.moveSelectedElements(this.xoffset,this.yoffset);this.parentProcess(t,!1)}else this.end(t)},end:function(t){if(this._startLogical){if(this.lazyMode){if(this.mark){var e=this;this.network.moveSelectedElements(this.xoffset,this.yoffset,this.network.isLazyMoveAnimate(),function(){e.network.fireInteractionEvent({kind:\"lazyMoveEnd\",event:t}),e.mark&&(e.network.getTopDiv().removeChild(e.mark),e.mark=null,e.network.setMovingElement(!1))})}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:\"liveMoveEnd\",event:t}));if(this.isParenting()){null==this.parent&&(this.parent=this.network.getCurrentSubNetwork());e=this;this.network.getMovableSelectedElements().forEach(function(t){t.setParent(e.parent)},this.network)}this.parentProcess(t,!0),this._handle_mouseup(t)}}}),R.network.interaction.DefaultInteraction=function(t){R.network.interaction.DefaultInteraction.superClass.constructor.call(this,t)},D.ext(\"twaver.network.interaction.DefaultInteraction\",R.network.interaction.BaseInteraction,{setUp:function(){this.addListener(\"mousedown\",\"mousemove\",\"keydown\")},tearDown:function(){this.removeListener(\"mousedown\",\"mousemove\",\"keydown\")},handle_mousedown:function(t){if(this.network.isValidEvent(t)){this.network.isFocusOnClick()&&R.Util.setFocus(this.network.getView());var e=this.network.getElementAt(t);2===t.detail?this.handleDoubleClicked(t,e):this.handleClicked(t,e)}},handleClicked:function(t,e){Ct.handleClicked(this.network,t,e)},handleDoubleClicked:function(t,e){Ct.handleDoubleClicked(this.network,t,e)},handle_keydown:function(t){Ct.handleKeyDown(this.network,t)},handle_mousemove:function(t){var e=this.network.getElementAt(t),i=this._preElement,n=Et(i),s=Et(e);i!==e&&(i&&(n&&n.onMouseLeave&&n.onMouseLeave(i,this.network),this.network.onMouseLeave(i,t)),e&&(s&&s.onMouseEnter&&s.onMouseEnter(e,this.network),this.network.onMouseEnter(e,t))),e&&s&&s.onMouseMove&&s.onMouseMove(e,this.network),this.network.onMouseMove(e,t),this._preElement=e}}),R.network.interaction.PanInteraction=function(t){R.network.interaction.PanInteraction.superClass.constructor.call(this,t)},D.ext(\"twaver.network.interaction.PanInteraction\",R.network.interaction.BaseInteraction,{setUp:function(){this.addListener(\"mousedown\"),this._oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener(\"mousedown\")},handle_mousedown:function(t){this._startLogical=this.network.getLogicalPoint(t),this._startLogical&&(this._handle_mousedown(t),this.network.getView().style.cursor=\"pointer\")},handle_mouseup:function(t){this._clear()},handle_mousemove:function(t){if(this._startLogical){this._handle_mousemove(t);var e=this._startLogical.x-this._endLogical.x,i=this._startLogical.y-this._endLogical.y;this.network.panByOffset(e,i);this._startLogical=this._endLogical,this._startClient=X.getClientPoint(t)}},_clear:function(t){this._startLogical&&(this._handle_mouseup(t),this.network.getView().style.cursor=this._oldCursor)}}),R.network.interaction.EditInteraction=function(t,e){this.lazyMode=e,this.pointIndex=-1,R.network.interaction.EditInteraction.superClass.constructor.call(this,t)},D.ext(\"twaver.network.interaction.EditInteraction\",R.network.interaction.BaseInteraction,{setUp:function(){this.addListener(\"mousedown\",\"mousemove\"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0)},tearDown:function(){this.removeListener(\"mousedown\",\"mousemove\"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear()},clear:function(){this.network.setEditingElement(!1),this.network.setRotatingElement(!1),this.isStart=!1,this.isStartRotate=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null,this.mouseMoved=!1,this.horizontal=!1,this.vertical=!1,this.mark&&(this.network.getTopDiv().removeChild(this.mark),this.mark=null),this.rotateScale&&this.network.getTopDiv().contains(this.rotateScale)&&(this.network.getTopDiv().removeChild(this.rotateScale),this.rotateScale=null)},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||\"default\",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor(\"crosshair\"),this.isCrossCursor=!0)},_setCursor:function(t){this.cursorID=t,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},handle_mousedown:function(t){if(0===t.button)if(!D.isAltDown(t)||this.network.isEditingElement())!this.network.isEditingElement()||this.isStart||this.isStartRotate||(this.node&&this.resizeDirection?(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:this.lazyMode?\"lazyResizeStart\":\"liveResizeStart\",event:t,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?D.isAltDown(t)?(this.shapeNode.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:\"removePoint\",event:t,element:this.shapeNode})):(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:this.lazyMode?\"lazyMovePointStart\":\"liveMovePointStart\",event:t,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0?D.isAltDown(t)?(this.shapeLink.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:\"removePoint\",event:t,element:this.shapeLink})):(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:this.lazyMode?\"lazyMovePointStart\":\"liveMovePointStart\",event:t,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI?(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:this.lazyMode?\"lazyMovePointStart\":\"liveMovePointStart\",event:t,element:this.linkUI._element})):this.node&&(this.isStartRotate=!0,this._handle_mousedown(t)));else{var e=this.network.getElementAt(t),i=this.network.getLogicalPoint(t);if(e instanceof R.ShapeNode){(o=this.getPointIndex(e.getPoints(),i,!0))>0&&(this._handle_mousedown(t),this.pointIndex=o,this.shapeNode=e,e.addPoint(i,o),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:\"addPoint\",event:t,element:e,pointIndex:o}),this.network.fireInteractionEvent({kind:\"liveMovePointStart\",event:t,element:e,pointIndex:o}))}if(e instanceof R.ShapeLink){var n=new R.List(e.getPoints()),s=this.network.getElementUI(e);n.add(s.getFromPoint(),0),n.add(s.getToPoint());var o;(o=this.getPointIndex(n,i)-1)>0&&(this._handle_mousedown(t),this.pointIndex=o,this.shapeLink=e,e.addPoint(i,o),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:\"addPoint\",event:t,element:e,pointIndex:o}),this.network.fireInteractionEvent({kind:this.lazyMode?\"lazeMovePointStart\":\"liveMovePointStart\",event:t,element:e,pointIndex:o}))}}},handle_mouseup:function(t){if(this.isStart){var e=D.clone(this._endLogical);if(this.resizingRect)if(this.lazyMode)if(this.network.isResizeAnimate()){var i=this,n=new R.animate.AnimateBounds(this.node,this.resizingRect,function(){i.network.fireInteractionEvent({kind:\"lazyResizeEnd\",event:t,element:i.node,resizeDirection:i.resizeDirection}),i.clear()});R.animate.AnimateManager.start(n)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:\"lazyResizeEnd\",event:t,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:\"liveResizeEnd\",event:t,element:this.node,resizeDirection:this.resizeDirection});else if(this.shapeNode&&this.pointIndex>=0&&e){var s=this.shapeNode.getPoints().get(this.pointIndex);this.horizontal&&(e.y=s.y),this.vertical&&(e.x=s.x),this.shapeNode.setPoint(this.pointIndex,e),this.network.fireInteractionEvent({kind:\"liveMovePointEnd\",event:t,element:this.shapeNode,pointIndex:this.pointIndex})}else if(this.shapeLink&&this.pointIndex>=0&&e){s=this.shapeLink.getPoints().get(this.pointIndex);this.horizontal&&(e.y=s.y),this.vertical&&(e.x=s.x),this.shapeLink.setPoint(this.pointIndex,e),this.network.fireInteractionEvent({kind:\"liveMovePointEnd\",event:t,element:this.shapeLink,pointIndex:this.pointIndex})}else this.linkUI&&e&&(this.linkUI.setControlPoint(e),this.network.fireInteractionEvent({kind:\"liveMovePointEnd\",event:t,element:this.linkUI._element}))}this._handle_mouseup(t),this.clear()},handle_mousemove:function(t){if(this.isStartRotate&&this.node)return this._handleRotateElement(t,this.node),void(this.network.isShowRotateScale()&&this.showRotateScale());if(this.isStart){if(this.shapeNode&&this.pointIndex>=0)return void this._handleMovingShapeNodePoint(t);if(this.shapeLink&&this.pointIndex>=0)return void this._handleMovingShapeLinkPoint(t);if(this.node&&this.resizeDirection)return void this._handleResizing(t);if(this.linkUI)return void this._handleMovingLinkControlPoint(t)}else if(this.network.isValidEvent(t))if(this.network.isSelectingElement()||this.network.isMovingElement()||0===this.network.getSelectionModel().size())this.clear();else{var e=this.network.getElementAt(t),i=this.network.getElementUI(e);if(i&&i.getEditAttachment()){var n=this.network.getLogicalPoint(t);if(e instanceof Pe){if(this.node=e,this._isEditingShapeNode(n)||this._isResizingNode(n))return void this.network.setEditingElement(!0);if(this._isRotatingElement(n))return this.network.setRotatingElement(!0),void this.network.setEditingElement(!0)}else if(e instanceof R.ShapeLink){if(this.shapeLink=e,this._isEditingShapeLink(n))return void this.network.setEditingElement(!0)}else if(i instanceof R.network.LinkUI){var s=this.network.getEditPointSize();if(pt.isOrthogonalLink(i._element)){this.linkUI=i;var o=this.linkUI.getControlPoint();return void(o&&this._contains(n,o,s)&&(this._setCrossCursor(),this.network.setEditingElement(!0)))}}this.clear()}else this.clear()}},_isRotatingElement:function(t){if(this.network.getRotatePointSize()<=0)return!1;var e=this.node.getOriginalRect(),i=this.node.getAngle();return this._isRotating(t,\"crosshair\",e,i)},_isRotating:function(t,e,i,n){var s=this.network.getRotatePointSize(),o={x:i.x+i.width/2,y:i.y-this.network.getRotatePointOffset()-s},r=this._rotatePoint(o,n,i),a={x:r.x-s,y:r.y-s,width:2*s,height:2*s};return!!W.containsPoint(a,t)&&(this._removeCursor(),this._setCursor(e),!0)},_handleRotateElement:function(t,e){this._handle_mousemove(t);var i=this._calculateAngle(this.network.getLogicalPoint(t),e);e.setAngle(i)},_calculateAngle:function(t,e){var i=e.getCenterLocation();return Math.round(180*Math.atan2(i.x-t.x,t.y-i.y)/Math.PI+180)},_handleMovingShapeNodePoint:function(t){if(this._handle_mousemove(t),!this.mouseMoved&&D.isCtrlDown(t)){var e=this._endLogical.x-this._startLogical.x,i=this._endLogical.y-this._startLogical.y;this.horizontal=Math.abs(e)>=Math.abs(i),this.vertical=!this.horizontal,this.mouseMoved=!0}var n=this.shapeNode.getPoints().get(this.pointIndex),s=D.clone(this._endLogical);this.horizontal&&(s.y=n.y),this.vertical&&(s.x=n.x),this.shapeNode.setPoint(this.pointIndex,s),this.network.fireInteractionEvent({kind:\"liveMovePointBetween\",e:t,element:this.shapeNode,pointIndex:this.pointIndex})},_handleMovingShapeLinkPoint:function(t){if(this._handle_mousemove(t),!this.mouseMoved&&D.isCtrlDown(t)){var e=this._endLogical.x-this._startLogical.x,i=this._endLogical.y-this._startLogical.y;this.horizontal=Math.abs(e)>=Math.abs(i),this.vertical=!this.horizontal,this.mouseMoved=!0}var n=this.shapeLink.getPoints().get(this.pointIndex),s=D.clone(this._endLogical);this.horizontal&&(s.y=n.y),this.vertical&&(s.x=n.x),this.shapeLink.setPoint(this.pointIndex,s),this.network.fireInteractionEvent({kind:\"liveMovePointBetween\",e:t,element:this.shapeLink,pointIndex:this.pointIndex})},_handleMovingLinkControlPoint:function(t){this._handle_mousemove(t),this.linkUI.setControlPoint(D.clone(this._endLogical)),this.network.fireInteractionEvent({kind:\"liveMovePointBetween\",e:t,element:this.linkUI._element})},_handleResizing:function(t){this._handle_mousemove(t);var e=this.node.getAngle(),i=this.node.getLocation(),n=this.node.getWidth()/2,s=this.node.getHeight()/2,o={x:i.x+n,y:i.y+s},r={x:-n,y:-s},a={x:-n,y:s},h={x:n,y:s},l={x:n,y:-s},c={x:0,y:-s},d={x:n,y:0},u={x:0,y:s},_={x:-n,y:0};if(\"northwest\"===this.resizeDirection&&(this._transformPoint(h,o,e),r.x=this._endLogical.x,r.y=this._endLogical.y,o.x=(r.x+h.x)/2,o.y=(r.y+h.y)/2,this._reversPoint(r,o,e),this._reversPoint(h,o,e),this.resizingRect={x:r.x,y:r.y,width:h.x-r.x,height:h.y-r.y}),\"north\"===this.resizeDirection){var g={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(g,o,e),c.y=g.y-o.y,this._transformPoint(c,o,e),this._transformPoint(u,o,e),o.x=(c.x+u.x)/2,o.y=(c.y+u.y)/2,this._reversPoint(c,o,e),this._reversPoint(u,o,e),this.resizingRect={x:o.x-this.node.getWidth()/2,y:o.y-(u.y-c.y)/2,width:this.node.getWidth(),height:u.y-c.y}}if(\"northeast\"===this.resizeDirection&&(this._transformPoint(a,o,e),l.x=this._endLogical.x,l.y=this._endLogical.y,o.x=(a.x+l.x)/2,o.y=(a.y+l.y)/2,this._reversPoint(a,o,e),this._reversPoint(l,o,e),this.resizingRect={x:a.x,y:l.y,width:l.x-a.x,height:a.y-l.y}),\"west\"===this.resizeDirection){g={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(g,o,e),_.x=g.x-o.x,this._transformPoint(d,o,e),this._transformPoint(_,o,e),o.x=(d.x+_.x)/2,o.y=(d.y+_.y)/2,this._reversPoint(d,o,e),this._reversPoint(_,o,e),this.resizingRect={x:o.x-(d.x-_.x)/2,y:o.y-this.node.getHeight()/2,width:d.x-_.x,height:this.node.getHeight()}}if(\"east\"===this.resizeDirection){g={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(g,o,e),d.x=g.x-o.x,this._transformPoint(d,o,e),this._transformPoint(_,o,e),o.x=(d.x+_.x)/2,o.y=(d.y+_.y)/2,this._reversPoint(d,o,e),this._reversPoint(_,o,e),this.resizingRect={x:o.x-(d.x-_.x)/2,y:o.y-this.node.getHeight()/2,width:d.x-_.x,height:this.node.getHeight()}}if(\"southwest\"===this.resizeDirection&&(this._transformPoint(l,o,e),a.x=this._endLogical.x,a.y=this._endLogical.y,o.x=(a.x+l.x)/2,o.y=(a.y+l.y)/2,this._reversPoint(a,o,e),this._reversPoint(l,o,e),this.resizingRect={x:a.x,y:l.y,width:l.x-a.x,height:a.y-l.y}),\"south\"===this.resizeDirection){g={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(g,o,e),u.y=g.y-o.y,this._transformPoint(c,o,e),this._transformPoint(u,o,e),o.x=(c.x+u.x)/2,o.y=(c.y+u.y)/2,this._reversPoint(c,o,e),this._reversPoint(u,o,e),this.resizingRect={x:o.x-this.node.getWidth()/2,y:o.y-(u.y-c.y)/2,width:this.node.getWidth(),height:u.y-c.y}}\"southeast\"===this.resizeDirection&&(this._transformPoint(r,o,e),h.x=this._endLogical.x,h.y=this._endLogical.y,o.x=(r.x+h.x)/2,o.y=(r.y+h.y)/2,this._reversPoint(r,o,e),this._reversPoint(h,o,e),this.resizingRect={x:r.x,y:r.y,width:h.x-r.x,height:h.y-r.y}),this.lazyMode?(this.mark||(this.mark=X.createDiv(),this.mark.style.webkitTransform=\"rotate(\"+e+\"deg)\",this.mark.style.mozTransform=\"rotate(\"+e+\"deg)\",this.mark.style.OTransform=\"rotate(\"+e+\"deg)\",this.mark.style.msTransform=\"rotate(\"+e+\"deg)\",this.mark.style.transform=\"rotate(\"+e+\"deg)\",this.network.getTopDiv().appendChild(this.mark)),X.setDiv(this.mark,this.resizingRect,null,this.network.getResizeLineWidth(),this.network.getResizeLineColor()),this.network.fireInteractionEvent({kind:\"lazyResizeBetween\",event:t,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.network.fireInteractionEvent({kind:\"liveResizeBetween\",event:t,element:this.node,resizeDirection:this.resizeDirection}))},_isEditingShapeNode:function(t){var e=this.network.getEditPointSize();if(this.node instanceof R.ShapeNode){this.shapeNode=this.node;for(var i=this.shapeNode.getPoints(),n=0,s=i.size();n<s;n++){var o=i.get(n);if(this._contains(t,o,e))return this._setCrossCursor(),this.pointIndex=n,!0}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(t){for(var e=this.shapeLink.getPoints(),i=this.network.getEditPointSize(),n=0,s=e.size();n<s;n++){var o=e.get(n);if(this._contains(t,o,i))return this._setCrossCursor(),this.pointIndex=n,!0}return this.pointIndex=-1,!1},_isResizingNode:function(t){if(this.network.getResizePointSize()<=0)return!1;var e=this.node.getOriginalRect(),i=this.node.getAngle(),n={x:e.x,y:e.y},s=this._rotatePoint(n,i,e);return!!this._isResizing(t,s.x,s.y,\"northwest\",\"nwse-resize\")||(n={x:e.x+e.width/2,y:e.y},s=this._rotatePoint(n,i,e),!!this._isResizing(t,s.x,s.y,\"north\",\"ns-resize\")||(n={x:e.x+e.width,y:e.y},s=this._rotatePoint(n,i,e),!!this._isResizing(t,s.x,s.y,\"northeast\",\"nesw-resize\")||(n={x:e.x,y:e.y+e.height/2},s=this._rotatePoint(n,i,e),!!this._isResizing(t,s.x,s.y,\"west\",\"ew-resize\")||(n={x:e.x+e.width,y:e.y+e.height/2},s=this._rotatePoint(n,i,e),!!this._isResizing(t,s.x,s.y,\"east\",\"ew-resize\")||(n={x:e.x,y:e.y+e.height},s=this._rotatePoint(n,i,e),!!this._isResizing(t,s.x,s.y,\"southwest\",\"nesw-resize\")||(n={x:e.x+e.width/2,y:e.y+e.height},s=this._rotatePoint(n,i,e),!!this._isResizing(t,s.x,s.y,\"south\",\"ns-resize\")||(n={x:e.x+e.width,y:e.y+e.height},s=this._rotatePoint(n,i,e),!!this._isResizing(t,s.x,s.y,\"southeast\",\"nwse-resize\"))))))))},_rotatePoint:function(t,e,i){return W.createMatrix(e*Math.PI/180,i.x+i.width/2,i.y+i.height/2).transform(t)},_isResizing:function(t,e,i,n,s){var o=this.network.getResizePointSize();return!!this._contains(t,{x:e,y:i},o)&&(this.resizeDirection!==n&&(this._removeCursor(),s=this._changeCursorWithAngle(n,this.node.getAngle()),this._setCursor(s),this.resizeDirection=n),!0)},_getRect:function(t,e,i,n){return{x:t<i?t:i,y:e<n?e:n,width:Math.abs(t-i),height:Math.abs(e-n)}},_contains:function(t,e,i){var n={x:e.x-i,y:e.y-i,width:2*i,height:2*i};return W.containsPoint(n,t)},getPointIndex:function(t,e,i){if(t.size()<2)return 0;for(var n,s=t.get(0),o=1;o<t.size();o++){if(n=t.get(o),this.isPointOnLine(e,s,n,6))return o;s=n}return s=t.get(0),i&&this.isPointOnLine(e,s,n,6)?t.size():0},showRotateScale:function(){this.rotateScale||(this.rotateScale=D.html.createCanvas());new R.List;var t,e,i,n,s=this.network.getRotateScaleWidth(),o=this.network.getRotateScaleHeight(),r=this.network.getRotatePointSize(),a=this.node.getAngle(),h=this.node.getOriginalRect(),l={x:h.x+h.width/2,y:h.y-this.network.getRotatePointOffset()-r},c=this._rotatePoint(l,a,h),d=a+\"\";this.node.getAngle()>=0&&this.node.getAngle()<=180?(i={x:(e={x:(t={x:c.x+r,y:c.y}).x+s,y:t.y}).x,y:e.y-o},n={x:t.x,y:i.y}):this.node.getAngle()>180&&this.node.getAngle()<=360&&(i={x:(e={x:(t={x:c.x-r,y:c.y}).x-s,y:t.y}).x,y:e.y-o},n={x:t.x,y:i.y});var u=new R.List([t,e,i,n]),_=D.math.getRect(u),g=D.html.setCanvas(this.rotateScale,_);g.fillStyle=this.network.getRotateScaleFillColor(),g.fillRect(_.x,_.y,_.width,_.height),g.fillStyle=this.network.getRotateScaleFontColor(),g.textBaseline=\"middle\",g.textAlign=\"center\",g.font=\"13px Arial\",g.fillText(d,_.x+_.width/2,_.y+_.height/2),this.network.getTopDiv().appendChild(this.rotateScale)},isPointOnLine:function(t,e,i,n){n<0&&(n=0);return this.getDistanceFromPointToLine(t,e,i)<=n&&t.x>=Math.min(e.x,i.x)-n&&t.x<=Math.max(e.x,i.x)+n&&t.y>=Math.min(e.y,i.y)-n&&t.y<=Math.max(e.y,i.y)+n},getDistanceFromPointToLine:function(t,e,i){if(e.x===i.x)return Math.abs(t.x-e.x);var n=(i.y-e.y)/(i.x-e.x),s=(i.x*e.y-e.x*i.y)/(i.x-e.x);return Math.abs(n*t.x-t.y+s)/Math.sqrt(n*n+1)},_transformPoint:function(t,e,i){var n=Math.cos(i*Math.PI/180),s=Math.sin(i*Math.PI/180),o=t.x,r=t.y,a=o*n-r*s,h=o*s+r*n;t.x=a+e.x,t.y=h+e.y},_reversPoint:function(t,e,i){i*=-1;var n=Math.cos(i*Math.PI/180),s=Math.sin(i*Math.PI/180),o=t.x-e.x,r=t.y-e.y,a=o*n-r*s,h=o*s+r*n;t.x=a+e.x,t.y=h+e.y},_changeCursorWithAngle:function(t,e){var i;switch(t){case\"northwest\":i=1;break;case\"north\":i=2;break;case\"northeast\":i=3;break;case\"east\":i=4;break;case\"southeast\":i=5;break;case\"south\":i=6;break;case\"southwest\":i=7;break;case\"west\":i=8;break;default:i=0}return(e>=360||e<=-360)&&(e%=360),e>22.5&&e<=67.5&&(i+=1),e<-22.5&&e>=-67.5&&(i-=1),e>67.5&&e<=112.5&&(i+=2),e<-67.5&&e>=-112.5&&(i-=2),e>112.5&&e<=157.5&&(i+=3),e<-112.5&&e>=-157.5&&(i-=3),e>157.5&&e<=202.5&&(i+=4),e<-157.5&&e>=-202.5&&(i-=4),e>202.5&&e<=247.5&&(i+=5),e<-202.5&&e>=-247.5&&(i-=5),e>247.5&&e<=292.5&&(i+=6),e<-247.5&&e>=-292.5&&(i-=6),e>292.5&&e<=337.5&&(i+=7),e<-292.5&&e>=-337.5&&(i-=7),i>8&&(i-=8),i<=0&&(i+=8),[\"auto\",\"nwse-resize\",\"ns-resize\",\"nesw-resize\",\"ew-resize\",\"nwse-resize\",\"ns-resize\",\"nesw-resize\",\"ew-resize\"][i]}}),R.network.interaction.MoveLinkInteraction=function(t,e){R.network.interaction.MoveLinkInteraction.superClass.constructor.call(this,t),this.xoffset=0,this.yoffset=0},D.ext(\"twaver.network.interaction.MoveLinkInteraction\",R.network.interaction.BaseInteraction,{setUp:function(){this.addListener(\"mousedown\"),this.oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener(\"mousedown\"),this.network.getView().style.cursor=this.oldCursor,this.end()},handle_mousedown:function(t){if(0===t.button&&!this.network.isSelectingElement()&&!this.network.isEditingElement()){var e=this.network.getElementAt(t);e instanceof R.Link&&(this.element=e,this.end(t),this._handle_mousedown(t))}},handle_mouseup:function(t){this.end(t)},handle_mousemove:function(t){if(!this._startLogical||this.network.isSelectingElement()||this.network.isEditingElement())this.end(t);else if(this._handle_mousemove(t),this.xoffset=this._endLogical.x-this._startLogical.x,this.yoffset=this._endLogical.y-this._startLogical.y,this.lazyMode){if(this.mark)this.network.fireInteractionEvent({kind:\"lazyMoveBetween\",event:t,element:this.element});else{this.mark=X.createCanvas();var e;this.network.getMovableSelectedElements().forEach(function(t){var i=this.getElementUI(t);i&&(e=W.unionRect(e,i.getViewRect()))},this.network),this.network.getTopDiv().appendChild(this.mark),this.network.setMovingElement(!0),X.setDiv(this.mark,e,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()),this.network.fireInteractionEvent({kind:\"lazyMoveStart\",event:t,element:this.element})}this.mark.style.left=this.xoffset+this.mark._viewRect.x+\"px\",this.mark.style.top=this.yoffset+this.mark._viewRect.y+\"px\"}else{var i=new R.List([this.element.getFromNode(),this.element.getToNode()]);R.Util.moveElements(i,this.xoffset,this.yoffset),this._startLogical=this._endLogical,this._startClient=X.getClientPoint(t),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:\"liveMoveBetween\",event:t,element:this.element}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:\"liveMoveStart\",event:t,element:this.element}))}},end:function(t){if(this._startLogical){if(this.lazyMode){if(this.mark){var e=this,i=new R.List([this.element.getFromNode(),this.element.getToNode()]);R.Util.moveElements(i,this.xoffset,this.yoffset,this.network.isLazyMoveAnimate(),function(){e.network.fireInteractionEvent({kind:\"lazyMoveEnd\",event:t,element:this.element}),e.mark&&(e.network.getTopDiv().removeChild(e.mark),e.mark=null,e.network.setMovingElement(!1))})}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:\"liveMoveEnd\",event:t,element:this.element}));this._handle_mouseup(t),delete this.element}}}),R.network.interaction.CreateElementInteraction=function(t,e){e||(e=Pe),R.Util.isTypeOf(e,Pe)?this.elementFunction=function(t){var i=new e;return i instanceof Pe&&i.setCenterLocation(t),i}:this.elementFunction=e,R.network.interaction.CreateElementInteraction.superClass.constructor.call(this,t)},D.ext(\"twaver.network.interaction.CreateElementInteraction\",R.network.interaction.BaseInteraction,{setUp:function(){this.addListener(\"mousedown\")},tearDown:function(){this.removeListener(\"mousedown\")},handle_mousedown:function(t){var e=this.network.getLogicalPoint(t);if(e){var i=this.elementFunction(e);i&&this.network.addElementByInteraction(i)}}}),R.network.interaction.CreateLinkInteraction=function(t,e){e||(e=R.Link),R.Util.isTypeOf(e,R.Link)?this.linkFunction=function(t,i){var n=new e;return n instanceof R.Link&&(n.setFromNode(t),n.setToNode(i)),n}:this.linkFunction=e,R.network.interaction.CreateLinkInteraction.superClass.constructor.call(this,t)},D.ext(\"twaver.network.interaction.CreateLinkInteraction\",R.network.interaction.BaseInteraction,{setUp:function(){this.addListener(\"mousedown\",\"mousemove\")},tearDown:function(){this.removeListener(\"mousedown\",\"mousemove\"),this.clear()},clear:function(){var t=this;setTimeout(function(){t._fromRectangle&&(t.network.getTopDiv().removeChild(t._fromRectangle),t._fromRectangle=null),t._currentRectangle&&(t.network.getTopDiv().removeChild(t._currentRectangle),t._currentRectangle=null),t._line&&(t.network.getTopDiv().removeChild(t._line),t._line=null)}),this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(t){if(this.network.isValidEvent(t))if(this.fromNode){if(this.toNode=this.currentNode,this.toNode){var e=this.createLink();e&&this.network.addElementByInteraction(e)}this.clear()}else this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.updateMark()},handle_mousemove:function(t){var e=this.network.getLogicalPoint(t);if(e)if(this.network.isMovingElement()||this.network.isEditingElement())this.clear();else{var i=null;this.fromNode?(this.currentNode=this.getToNode(t),this.currentPoint=e,this.updateMark()):(i=this.getFromNode(t),this.currentNode!==i&&(this.currentNode=i,this.updateMark()))}},getFromNode:function(t){return this.getNode(t)},getToNode:function(t){return this.getNode(t)},getNode:function(t){var e=this.network.getElementAt(t);return e instanceof Pe&&this.network.isLinkable(e)?e:null},updateMark:function(){var t;this.fromNode&&!this._fromRectangle&&this._currentRectangle&&(this._fromRectangle=this._currentRectangle,this._currentRectangle=null),!this.fromNode&&this._fromRectangle&&(this.network.getTopDiv().removeChild(this._fromRectangle),this._fromRectangle=null),this.currentNode&&!this._currentRectangle&&(t=this.network.getElementUI(this.currentNode),this._currentRectangle=X.createDiv(),this.network.getTopDiv().appendChild(this._currentRectangle),X.setDiv(this._currentRectangle,t._viewRect,null,this.network.getEditLineWidth(),this.network.getEditLineColor())),!this.currentNode&&this._currentRectangle&&(this.network.getTopDiv().removeChild(this._currentRectangle),this._currentRectangle=null),this.updateLine()},updateLine:function(){if(this.currentPoint){var t=this.fromNode.getCenterLocation(),e=t.x,i=t.y,n=this.currentPoint.x,s=this.currentPoint.y;this._line||(this._line=X.createCanvas(),this.network.getTopDiv().appendChild(this._line));var o=X.setCanvas(this._line,Math.min(e,n),Math.min(i,s),Math.abs(e-n),Math.abs(i-s));o.lineWidth=this.network.getEditLineWidth(),o.strokeStyle=this.network.getEditLineColor(),o.beginPath(),o.moveTo(e,i),o.lineTo(n,s),o.stroke()}else this._line&&(this.network.getTopDiv().removeChild(this._line),this._line=null)}}),R.network.interaction.CreateShapeNodeInteraction=function(t,e){e||(e=R.ShapeNode),R.Util.isTypeOf(e,R.ShapeNode)?this.shapeNodeFunction=function(t){var i=new e;return i instanceof R.ShapeNode&&t&&i.setPoints(t),i}:this.shapeNodeFunction=e,R.network.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,t),this.timeStamp=-1},D.ext(\"twaver.network.interaction.CreateShapeNodeInteraction\",R.network.interaction.BaseInteraction,{setUp:function(){this.addListener(\"mousedown\",\"mousemove\")},tearDown:function(){this.removeListener(\"mousedown\",\"mousemove\"),this.clear()},clear:function(){this.network.setEditingElement(!1),this.points=null,this.currentPoint=null,this.lastPoint=null,this.horizontal=!1,this.vertical=!1,this.mark&&(this.network.getTopDiv().removeChild(this.mark),this.mark=null)},handle_mousedown:function(t){if(0===t.button){var e=this.network.getLogicalPoint(t);if(e){if(2===t.detail||t.timeStamp-this.timeStamp<300){if(this.points){var i=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(i),this.clear();var n=this;setTimeout(function(){n.network.setEditingElement(!1)},0)}}else{if(this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new oe),this.points.size()>0){var s=this.points.get(this.points.size()-1);if(s.x===e.x&&s.y===e.y)return}this._handle_mousedown(t),this.points.size()>0&&D.isCtrlDown(t)&&(this.horizontal&&(e.y=s.y),this.vertical&&(e.x=s.x),this.horizontal=!1,this.vertical=!1),this.lastPoint=e,this.points.add(e),this.updateMark()}this.timeStamp=t.timeStamp}}},handle_mousemove:function(t){if(this.points){if(this.currentPoint=this.network.getLogicalPoint(t),D.isCtrlDown(t)){var e=this.currentPoint.x-this.lastPoint.x,i=this.currentPoint.y-this.lastPoint.y;this.horizontal=Math.abs(e)>=Math.abs(i),this.vertical=!this.horizontal}else this.horizontal=!1,this.vertical=!1;this.horizontal&&(this.currentPoint.y=this.lastPoint.y),this.vertical&&(this.currentPoint.x=this.lastPoint.x),this.updateMark()}},updateMark:function(t){if(this.points&&this.points.size()>0&&this.currentPoint){this.mark||(this.mark=X.createCanvas(),this.network.getTopDiv().appendChild(this.mark));var e=new oe(this.points);e.add(this.currentPoint);var i=W.getRect(e),n=this.network.getEditLineWidth();D.math.grow(i,n,n);var s=X.setCanvas(this.mark,i);s.lineWidth=n,s.strokeStyle=this.network.getEditLineColor(),s.beginPath(),Y.drawLinePoints(s,e),s.stroke()}}}),R.network.interaction.CreateShapeLinkInteraction=function(t,e){R.network.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,t),e||(e=R.ShapeLink),R.Util.isTypeOf(e,R.ShapeLink)?this.linkFunction=function(t,i,n){var s=new e;return s instanceof R.ShapeLink&&(s.setFromNode(t),s.setToNode(i),n&&s.setPoints(n)),s}:this.linkFunction=e},D.ext(\"twaver.network.interaction.CreateShapeLinkInteraction\",R.network.interaction.CreateLinkInteraction,{clear:function(){this.network.setEditingElement(!1),this.points=null,this.polyline&&(this.network.getTopDiv().removeChild(this.polyline),this.polyline=null),R.network.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(t){if(0===t.button){var e=this.network.getLogicalPoint(t);if(e)if(this.fromNode)if(this.toNode=this.currentNode,this.toNode){var i=this.createLink();i&&this.network.addElementByInteraction(i),this.clear()}else{if(this.points||(this.points=new oe),this.points.size()>0){var n=this.points.get(this.points.size()-1);if(n.x===e.x&&n.y===e.y)return}this.points.add(e),this.updateMark()}else this.fromNode=this.currentNode,this.fromNode&&(this.polyline||(this.polyline=X.createCanvas(),this.network.getTopDiv().appendChild(this.polyline))),this.points=null,this.currentNode=null,this.currentPoint=null,this.updateMark()}},updateLine:function(){if(this.currentPoint&&this.polyline){var t=new oe(this.points);t.add(this.fromNode.getCenterLocation(),0),t.add(this.currentPoint);var e=W.getRect(t),i=X.setCanvas(this.polyline,e);i.lineWidth=this.network.getEditLineWidth(),i.strokeStyle=this.network.getEditLineColor(),i.beginPath(),Y.drawLinePoints(i,t),i.stroke()}}}),R.network.interaction.CreateOrthogonalLinkInteraction=function(t,e,i,n,s,o){R.network.interaction.CreateOrthogonalLinkInteraction.superClass.constructor.call(this,t,e),this.linkType=i||\"orthogonal\",this.isByControlPoint=n,this.splitPercent=s,this.isSplitByPercent=o,this.link=new R.Link,this.link.setStyle(\"link.type\",this.linkType),this.link.setStyle(\"link.split.by.percent\",this.isSplitByPercent),pt.isFlexionalTypeLink(this.linkType)||pt.isExtendTypeLink(this.linkType)?(this.splitPercent<0&&(this.splitPercent=R.Styles.getStyle(\"link.extend\")),this.link.setStyle(\"link.extend\",this.splitPercent)):pt.isSplitTypeLink(this.linkType)&&(this.splitPercent<0&&(this.splitPercent=R.Styles.getStyle(this.isSplitByPercent?\"link.split.percent\":\"link.split.value\")),this.isSplitByPercent?this.link.setStyle(\"link.split.percent\",this.splitPercent):this.link.setStyle(\"link.split.value\",this.splitPercent))},D.ext(\"twaver.network.interaction.CreateOrthogonalLinkInteraction\",R.network.interaction.CreateLinkInteraction,{clear:function(){this.path&&(this.network.getTopDiv().removeChild(this.path),this.path=null),R.network.interaction.CreateOrthogonalLinkInteraction.superClass.clear.call(this)},createLink:function(){var t=R.network.interaction.CreateOrthogonalLinkInteraction.superClass.createLink.call(this);if(t.setStyle(\"link.type\",this.linkType),t.setStyle(\"link.split.by.percent\",this.isSplitByPercent),this.isByControlPoint){var e=pt.getControlPoint(t);if(e)return t.SetStyle(\"link.control.point\",e),t}else pt.isFlexionalTypeLink(this.linkType)||pt.isExtendTypeLink(this.linkType)?(this.splitPercent<0&&(this.splitPercent=R.Styles.getStyle(\"link.extend\")),t.setStyle(\"link.extend\",this.splitPercent)):pt.isSplitTypeLink(this.linkType)&&(this.splitPercent<0&&(this.splitPercent=R.Styles.getStyle(this.isSplitByPercent?\"link.split.percent\":\"link.split.value\")),this.isSplitByPercent?t.setStyle(\"link.split.percent\",this.splitPercent):t.setStyle(\"link.split.value\",this.splitPercent));return t},updateLine:function(){if(this.currentPoint){if(!this.fromNode||this.currentNode===this.fromNode)return;var t,e=this.network.getElementUI(this.fromNode);if(!e)return;if(null==(t=e.getBodyRect()))return;var i;if(this.currentNode&&this.currentNode!==this.fromNode){var n=this.network.getElementUI(this.currentNode);if(!n)return;i=n.getBodyRect()}else i={x:this.currentPoint.x,y:this.currentPoint.y,width:1,height:1};if(!i)return;var s=pt.calculateOrthogonalAndFlexionalLinkPoints(this.linkType,t,i,this.link);if(pt.drawCorner(s,this.link),s.size()<2)return;this.line||(this.line=X.createCanvas(),this.network.getTopDiv().appendChild(this.line));var o=X.setCanvas(this.line,W.getLineRect(s));o.lineWidth=this.network.getEditLineWidth(),o.strokeStyle=this.network.getEditLineColor(),o.beginPath(),Y.drawLinePoints(o,s),o.stroke()}else this.line&&(this.network.getTopDiv().removeChild(this.line),this.line=null)}}),R.network.interaction.MagnifyInteraction=function(t,e,i,n,s){R.network.interaction.MagnifyInteraction.superClass.constructor.call(this,t),this.zoom=e||2,this.xRadius=i||100,this.yRadius=n||100,this.shape=s||\"circle\",this.borderColor=\"black\",this.borderWidth=1,this.backgroundColor=\"white\",this.markCanvas=X.createCanvas(),this.markCanvas._isIgnored=!0},D.ext(\"twaver.network.interaction.MagnifyInteraction\",R.network.interaction.BaseInteraction,{setUp:function(){this.addListener(\"mousemove\")},tearDown:function(){this.removeListener(\"mousemove\"),this._clear()},handle_mousemove:function(t){var e=this.network.getLogicalPoint(t);e&&(this.lastPoint||this.network.getView().appendChild(this.markCanvas),this.lastPoint=e,this.updateMark())},updateMark:function(){var t,e=this.network._zoom,i=this.zoom*e,n=this.lastPoint.x*e-this.xRadius,s=this.lastPoint.y*e-this.yRadius,o=2*this.xRadius,r=2*this.yRadius,a={x:this.lastPoint.x-this.xRadius/i,y:this.lastPoint.y-this.yRadius/i,width:o/i,height:r/i},h=this.borderWidth,l=X.createCanvas();l.width=o,l.height=r,this.network.toCanvasByRegion(a,i,l),X.setCanvas(this.markCanvas,n,s,o,r),(t=this.markCanvas.getContext(\"2d\")).save(),t.beginPath(),Y.drawVector(t,this.shape,null,n,s,o,r),t.clip(),t.fillStyle=this.backgroundColor,t.beginPath(),t.rect(n,s,o,r),t.fill(),t.drawImage(l,n,s),t.restore(),t.beginPath(),t.lineWidth=h,Y.drawVector(t,this.shape,null,n+h/2,s+h/2,o-h,r-h),t.strokeStyle=this.borderColor,t.stroke()},_clear:function(t){this.lastPoint&&(this.network.getView().removeChild(this.markCanvas),this.lastPoint=null)},getZoom:function(){return this.zoom},setZoom:function(t){this.zoom=t,this.updateMark()},getShape:function(){return this.shape},setShape:function(t){this.shape=t,this.updateMark()},getXRadius:function(){return this.xRadius},setXRadius:function(t){this.xRadius=t,this.updateMark()},getYRadius:function(){return this.yRadius},setYRadius:function(t){this.yRadius=t,this.updateMark()},getBorderColor:function(){return this.borderColor},setBorderColor:function(t){this.borderColor=t,this.updateMark()},getBorderWidth:function(){return this.borderWidth},setBorderWidth:function(t){this.borderWidth=t,this.updateMark()},getBackgroundColor:function(){return this.backgroundColor},setBackgroundColor:function(t){this.backgroundColor=t,this.updateMark()}}),R.network.interaction.TouchInteraction=function(t){R.network.interaction.TouchInteraction.superClass.constructor.call(this,t)},D.ext(\"twaver.network.interaction.TouchInteraction\",R.network.interaction.BaseInteraction,{setUp:function(){var t=this.network.getView();X.addEventListener(\"touchstart\",\"handleTouchstart\",t,this),X.addEventListener(\"touchmove\",\"handleTouchmove\",t,this),X.addEventListener(\"touchend\",\"handleTouchend\",t,this),X.addEventListener(\"touchcancel\",\"handleTouchend\",t,this)},tearDown:function(){var t=this.network.getView();X.removeEventListener(\"touchstart\",t,this),X.removeEventListener(\"touchmove\",t,this),X.removeEventListener(\"touchend\",t,this),X.removeEventListener(\"touchcancel\",t,this)},handleTouchstart:function(t){if(X.preventDefault(t),t.touches&&1==t.touches.length){var e=this.network.getLogicalPoint(t),i=this.network.getElementAt(e);this._startTouchTime=new Date,this._startTouchPoint=e;var n=this;i?(this._haveElementUnderTouch=!0,this._startTouchElement=i):(this._haveElementUnderTouch=!1,this._startTouchElement=null),this.timer=setTimeout(function(){Ct.handleLongClicked(n.network,t,i)},1e3)}else t.touches&&2==t.touches.length&&(this._distance=yt.getDistance(t),this._zoom=this.network.getZoom(),this._startTouchPoint={x:t.touches[0].clientX,y:t.touches[0].clientY});this._touchCount=t.touches.length},handleTouchmove:function(t){if(X.preventDefault(t),2==this._touchCount&&t.touches&&2==t.touches.length)if(this.timer&&clearTimeout(this.timer),Math.abs(this._distance-yt.getDistance(t))>=xe.TOUCH_ZOOM_THRESHOLD||this._zoomFlag){this._zoomFlag=!0;var e=yt.getDistance(t)/this._distance;this.network.setTouchZoom(this._zoom*e,!1)}else{var i=t.touches[0],n=this._startTouchPoint.x-i.clientX,s=this._startTouchPoint.y-i.clientY,o=this.network.panByOffset(n,s);this._startTouchPoint.x-=n-o.x,this._startTouchPoint.y-=s-o.y}else if(1==this._touchCount&&t.touches&&1==t.touches.length)if(this._haveElementUnderTouch||!this.network.isRectSelectEnabled()){var r=this.network.getLogicalPoint(t),a=this.network.getElementAt(r);if(this.network.isMovingElement()||null!=this._startTouchElement&&this._startTouchElement==a&&this.network.getMovableSelectedElements().contains(a)){n=r.x-this._startTouchPoint.x,s=r.y-this._startTouchPoint.y;(Math.abs(n)>=xe.TOUCH_MOVE_THRESHOLD||Math.abs(s)>=xe.TOUCH_MOVE_THRESHOLD)&&(this._startTouchPoint=r,this.network.moveSelectedElements(n,s),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:\"liveMoveBetween\",event:t}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:\"liveMoveStart\",event:t}),this.timer&&clearTimeout(this.timer)))}else{n=r.x-this._startTouchPoint.x,s=r.y-this._startTouchPoint.y;(Math.abs(n)>=xe.TOUCH_MOVE_THRESHOLD||Math.abs(s)>=xe.TOUCH_MOVE_THRESHOLD)&&this.timer&&clearTimeout(this.timer)}}else{this._moveTouchPoint=this.network.getLogicalPoint(t);n=this._moveTouchPoint.x-this._startTouchPoint.x,s=this._moveTouchPoint.y-this._startTouchPoint.y;if(Math.abs(n)>=xe.TOUCH_RECT_SELECT_THRESHOLD&&Math.abs(s)>=xe.TOUCH_RECT_SELECT_THRESHOLD){this.mark?this.network.fireInteractionEvent({kind:\"selectBetween\",event:t}):(this.mark=X.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:\"selectStart\",event:t}),this.timer&&clearTimeout(this.timer));var h=W.getRect([this._startTouchPoint,this._moveTouchPoint]);X.setDiv(this.mark,h,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())}}},handleTouchend:function(t){if(X.preventDefault(t),this.network.isMovingElement())this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:\"liveMoveEnd\",event:t});else if(this.network.isSelectingElement()){var e=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(e&&e.size()>0){var i=this.network.getSelectionModel(),n=i.toSelection();e.forEach(function(t){i.contains(t)?n.remove(t):n.add(t)},this),i.setSelection(n)}this.network.fireInteractionEvent({kind:\"selectEnd\",event:t}),this.network.getTopDiv().removeChild(this.mark),this.mark=null,this.network.setSelectingElement(!1),this.timer&&clearTimeout(this.timer)}else if(this._startTouchPoint){this._zoomFlag=!1;var s=new Date,o=this.network.getLogicalPoint(t),r=this.network.getElementAt(this._startTouchPoint);this._startTouchPoint&&o&&s.getTime()-this._startTouchTime.getTime()<=500&&W.getDistance(this._startTouchPoint,o)<=20&&(r?this.network.getSelectionModel().contains(r)||this.network.getSelectionModel().setSelection(r):this.network.getSelectionModel().clearSelection(),Ct.handleClicked(this.network,t,r),this.timer&&clearTimeout(this.timer),this._endTouchTime&&s.getTime()-this._endTouchTime.getTime()<=500&&W.getDistance(this._endTouchPoint,o)<=20?(delete this._endTouchTime,delete this._endTouchPoint,Ct.handleDoubleClicked(this.network,t,r),this.timer&&clearTimeout(this.timer)):(this._endTouchTime=s,this._endTouchPoint=o))}},getIntersectMode:function(){return\"intersect\"===this.network.getSelectMode()||\"contain\"!==this.network.getSelectMode()&&(this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y)}}),R.network.interaction.MSTouchInteraction=function(t){R.network.interaction.MSTouchInteraction.superClass.constructor.call(this,t),this._pointerMap={},this._pointerIdArray=[]},D.ext(\"twaver.network.interaction.MSTouchInteraction\",R.network.interaction.BaseInteraction,{setUp:function(){var t=this.network.getView();X.addEventListener(\"MSPointerDown\",\"handleTouchstart\",t,this),X.addEventListener(\"MSPointerMove\",\"handleTouchmove\",t,this),X.addEventListener(\"MSPointerUp\",\"handleTouchend\",t,this),X.addEventListener(\"MSPointerCancel\",\"handleTouchend\",t,this)},tearDown:function(){var t=this.network.getView();X.removeEventListener(\"MSPointerDown\",t,this),X.removeEventListener(\"MSPointerMove\",t,this),X.removeEventListener(\"MSPointerUp\",t,this),X.removeEventListener(\"MSPointerCancel\",t,this)},handleTouchstart:function(t){if(this.network.isFocusOnClick()&&R.Util.setFocus(this.network._view),!this.network.isSelectingElement()||t.pointerType!=t.MSPOINTER_TYPE_MOUSE){var e=this.network.getLogicalPoint(t),i=new Date;if(t.isPrimary&&this._pointerIdArray.length>0&&this.handle_mouseup(t),this._pointerMap[t.pointerId]||(this._pointerIdArray.push(t.pointerId),this._pointerMap[t.pointerId]=t),1==this._pointerIdArray.length){var n=this.network.getElementAt(e);this._startTouchElement=n,this._startClientPoint={x:t.clientX,y:t.clientY},Ct.handleClicked(this.network,t,n),this._startTouchTime&&this._startTouchPoint&&i.getTime()-this._startTouchTime.getTime()<=500&&W.getDistance(this._startTouchPoint,e)<=20?(Ct.handleDoubleClicked(this.network,t,n),this._doubleClick=!0):(X.handle_mousedown(this,t),this._startTouchPoint=e,this._startTouchTime=i);var s=this.network.getSelectionModel();n?D.isCtrlDown(t)?s.contains(n)?s.removeSelection(n):s.appendSelection(n):s.contains(n)||s.setSelection(n):D.isCtrlDown(t)||s.clearSelection()}else 2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())}},handleTouchmove:function(t){if(null!=this._startTouchPoint&&0!=this._pointerIdArray.length&&this._pointerMap[t.pointerId]&&!(W.getDistance({x:this._pointerMap[t.pointerId].pageX,y:this._pointerMap[t.pointerId].pageY},{x:t.pageX,y:t.pageY})<=10)&&(this._pointerMap[t.pointerId]=t,2==this._pointerIdArray.length)){var e=this._getDistance()/this._distance;this.network.setZoom(this._zoom*e,!1)}},handleTouchend:function(t){if(this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:\"liveMoveEnd\",event:t})),this.network.isSelectingElement()){var e=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(e&&e.size()>0){var i=this.network.getSelectionModel(),n=i.toSelection();e.forEach(function(t){i.contains(t)?n.remove(t):n.add(t)},this),i.setSelection(n)}this.network.fireInteractionEvent({kind:\"selectEnd\",event:t}),this.network.getTopDiv().removeChild(this.mark),this.mark=null,this.network.setSelectingElement(!1)}this._doubleClick&&(delete this._doubleClick,delete this._startTouchPoint,delete this._startTouchTime);for(var s=-1,o=0;o<this._pointerIdArray.length;o++)if(this._pointerIdArray[o]==t.pointerId){s=o;break}s>=0&&this._pointerIdArray.splice(s,1),delete this._pointerMap[t.pointerId]},_getDistance:function(){return W.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})},getIntersectMode:function(){return\"intersect\"===this.network.getSelectMode()||\"contain\"!==this.network.getSelectMode()&&(this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y)},handle_mousemove:function(t){if(this._startTouchPoint&&1==this._pointerIdArray.length){if(this._moveTouchPoint={x:this._startTouchPoint.x+(t.clientX-this._startClientPoint.x)/this.network.getZoom(),y:this._startTouchPoint.y+(t.clientY-this._startClientPoint.y)/this.network.getZoom()},W.getDistance(this._startTouchPoint,this._moveTouchPoint)<3)return;if(null==this._startTouchElement&&this.network.isRectSelectEnabled()){this.mark?this.network.fireInteractionEvent({kind:\"selectBetween\",event:t}):(this.mark=X.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:\"selectStart\",event:t}));var e=W.getRect([this._startTouchPoint,this._moveTouchPoint]);X.setDiv(this.mark,e,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())}else{var i=this.network.getElementAt(this._moveTouchPoint),n=this._moveTouchPoint.x-this._startTouchPoint.x,s=this._moveTouchPoint.y-this._startTouchPoint.y;if(null!=this._startTouchElement||this.network.isRectSelectEnabled())(this.network.isMovingElement()||null!=this._startTouchElement&&i==this._startTouchElement&&this.network.getMovableSelectedElements().contains(i))&&(this.network.moveSelectedElements(n,s),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:\"liveMoveBetween\",event:t}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:\"liveMoveStart\",event:t})));else this.network.panByOffset(-n,-s);this._startClientPoint.x=t.clientX,this._startClientPoint.y=t.clientY}}},handle_mouseup:function(t){this.handleTouchend(t),this._pointerIdArray=[],this._pointerMap={}}});var Me={_hitCanvas:null,getHitCanvas:function(t,e){null==this._hitCanvas&&(this._hitCanvas=X.createCanvas()),0==arguments.length&&(t=2,e=2),this._hitCanvas.setAttribute(\"width\",\"\"+t-1),this._hitCanvas.setAttribute(\"height\",\"\"+e-1),this._hitCanvas.setAttribute(\"width\",\"\"+t),this._hitCanvas.setAttribute(\"height\",\"\"+e);return this.getCtx(this._hitCanvas).clearRect(0,0,t,e),this._hitCanvas},disposeHitCanvas:function(){this._hitCanvas=null},getCtx:function(t){return t.getContext(\"2d\")},render:function(t,e,i){void 0!=e&&(t.fillStyle=e,t.fill()),void 0!=i&&(t.strokeStyle=i,t.stroke())},text:function(t,e,i,n,s,o){t.textAlign=\"center\",t.textBaseline=\"middle\",null!=s&&(t.fillStyle=s,t.fillText(e,i,n)),o&&(t.strokeStyle=o,t.strokeText(e,i,n))},circle:function(t,e,i,n,s,o){t.arc(e,i,n,0,2*Math.PI,!0),t.closePath(),this.render(t,s,o)},rect:function(t,e,i,n,s,o,r){t.rect(e,i,n,s),t.closePath(),this.render(t,o,r)},OUT_LEFT:1,OUT_TOP:2,OUT_RIGHT:4,OUT_BOTTOM:8,outcode:function(t,e,i,n,s,o){var r=0;return s<=0?r|=this.OUT_LEFT|this.OUT_RIGHT:t<i?r|=this.OUT_LEFT:t>i+s&&(r|=this.OUT_RIGHT),o<=0?r|=this.OUT_TOP|this.OUT_BOTTOM:e<n?r|=this.OUT_TOP:e>n+o&&(r|=this.OUT_BOTTOM),r},intersectsLine:function(t,e,i,n,s,o,r,a){var h,l;if(0==(l=this.outcode(i,n,s,o,r,a)))return!0;for(;0!=(h=this.outcode(t,e,s,o,r,a));){if(0!=(h&l))return!1;if(0!=(h&(this.OUT_LEFT|this.OUT_RIGHT))){var c=s;0!=(h&this.OUT_RIGHT)&&(c+=r),e+=(c-t)*(n-e)/(i-t),t=c}else{var d=o;0!=(h&this.OUT_BOTTOM)&&(d+=a),t+=(d-e)*(i-t)/(n-e),e=d}}return!0}};R.canvas={},R.canvas.interaction={},R.canvas.Network=function(t){R.canvas.Network.superClass.constructor.apply(this,arguments),this._rootCanvas=X.createCanvas(),this._topCanvas=X.createCanvas(),this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0},this._zoom=1,this._elementUIMap={},this._visibleMap={},this.viewRect={x:0,y:0,width:0,height:0},this.hScrollBarVisible=!1,this.vScrollBarVisible=!1,this.markerList=new R.List,this._topAttachmentList=new R.List,this.setElementBox(t||new R.ElementBox),B||(this._view=X.createView(\"hidden\"),this._view.appendChild(this._rootCanvas),this._view.appendChild(this._topCanvas),V.isTouchable?V.isMSTouchable?this.setMSTouchInteractions():this.setTouchInteractions():this.setDefaultInteractions(!1),this.setToolTipEnabled(R.Defaults.NETWORK_TOOLTIP_ENABLED));var e=this;this._flowLink=function(){if(!(e.isMovingElement()||e.isSelectingElement()||e.isEditingElement()||e._box._layoutMovingElements)){e._flowLinkQuickFinder||(e._flowLinkQuickFinder=new R.QuickFinder(e._box,\"link.flow\",\"style\"));e._flowLinkQuickFinder.find(!0).forEach(function(t){t._styleMap[\"link.flow.offset\"]=e.getLinkFlowOffset(t);e.getElementUI(t).invalidate(!1)})}},R.imageUtil.addEventListener(this.invalidateElementUIs,this)},D.ext(\"twaver.canvas.Network\",R.controls.View,{__accessor:[\"selectMode\",\"makeVisibleOnSelected\",\"movableFunction\",\"editPointSize\",\"editPointFillColor\",\"scrollBarWidth\",\"editPointOutlineWidth\",\"editPointOutlineColor\",\"editLineColor\",\"editLineWidth\",\"resizePointSize\",\"resizePointFillColor\",\"resizePointOutlineWidth\",\"resizePointOutlineColor\",\"resizeLineColor\",\"resizeLineWidth\",\"rotatePointSize\",\"rotatePointFillColor\",\"rotatePointOffset\",\"rotatePointOutlineWidth\",\"rotatePointOutlineColor\",\"rotateScaleFillColor\",\"rotateScaleFontColor\",\"rotateScaleWidth\",\"rotateScaleHeight\",\"selectOutlineColor\",\"selectOutlineWidth\",\"selectFillColor\",\"lazyMoveOutlineColor\",\"lazyMoveOutlineWidth\",\"lazyMoveFillColor\",\"rectSelectFilter\",\"paddingRight\",\"paddingBottom\",\"selectionTolerance\"],__bool:[\"doubleClickToUpSubNetwork\",\"doubleClickToSubNetwork\",\"doubleClickToEmptySubNetwork\",\"doubleClickToLinkBundle\",\"doubleClickToGroupExpand\",\"scrollBarVisible\",\"limitViewInCanvas\",\"autoValidateCanvasSize\",\"subNetworkAnimate\",\"lazyMoveAnimate\",\"resizeAnimate\",\"noAgentLinkVisible\",\"keyboardRemoveEnabled\",\"keyboardSelectEnabled\",\"sendToTopOnSelected\",\"lazyMoveFill\",\"editingElement\",\"rotatingElement\",\"movingElement\",\"selectingElement\",\"rectSelectEnabled\",\"limitElementInPositiveLocation\",\"showRotateScale\",\"transparentSelectionEnable\",\"debug\",\"showShadowInEdit\"],_currentSubNetwork:null,_subNetworkAnimate:R.Defaults.NETWORK_SUBNETWORK_ANIMATE,_scrollBarWidth:10,_scrollBarVisible:!0,_limitViewInCanvas:!0,_autoValidateCanvasSize:!0,_makeVisibleOnSelected:R.Defaults.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:R.Defaults.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:R.Defaults.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:xe.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_elementUIFunction:R.Defaults.CANVASUI_FUNCTION,_doubleClickToUpSubNetwork:R.Defaults.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:R.Defaults.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:R.Defaults.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:R.Defaults.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:R.Defaults.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_selectOutlineColor:R.Defaults.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:R.Defaults.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:R.Defaults.NETWORK_SELECT_FILL_COLOR,_sendToTopOnSelected:R.Defaults.NETWORK_SENDTOTOP_ON_SELECTED,_lazyMoveOutlineColor:R.Defaults.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:R.Defaults.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:R.Defaults.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:R.Defaults.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:R.Defaults.NETWORK_LAZYMOVE_ANIMATE,_resizePointSize:R.Defaults.NETWORK_RESIZE_POINT_SIZE,_resizePointFillColor:R.Defaults.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:R.Defaults.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:R.Defaults.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:R.Defaults.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:R.Defaults.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:R.Defaults.NETWORK_RESIZE_ANIMATE,_editPointSize:R.Defaults.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:R.Defaults.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:R.Defaults.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:R.Defaults.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:R.Defaults.NETWORK_EDIT_LINE_COLOR,_editLineWidth:R.Defaults.NETWORK_EDIT_LINE_WIDTH,_rotatePointSize:R.Defaults.NETWORK_ROTATE_POINT_SIZE,_rotatePointFillColor:R.Defaults.NETWORK_ROTATE_POINT_FILL_COLOR,_rotatePointOffset:R.Defaults.NETWORK_ROTATE_POINT_OFFSET,_rotatePointOutlineWidth:R.Defaults.NETWORK_ROTATE_POINT_OUTLINE_WIDTH,_rotatePointOutlineColor:R.Defaults.NETWORK_ROTATE_POINT_OUTLINE_COLOR,_rotateScaleWidth:xe.NETWORK_ROTATE_SCALE_WIDTH,_rotateScaleHeight:xe.NETWORK_ROTATE_SCALE_HEIGHT,_rotateScaleFillColor:xe.NETWORK_ROTATE_SCALE_FILL_COLOR,_rotateScaleFontColor:xe.NETWORK_ROTATE_SCALE_FONT_COLOR,_limitElementInPositiveLocation:xe.NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION,_linkFlowInterval:xe.NETWORK_LINK_FLOW_INTERVAL,_selectionTolerance:xe.NETWORK_SELECTION_TOLERANCE,_invalidateElementVisibility:!1,_invalidateViewRectFlag:!1,_repaintTopFlag:!1,_invalidateCanvasSizeFlag:!1,_isEditingElement:!1,_isRotatingElement:!1,_isMovingElement:!