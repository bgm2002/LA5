nvvAg4DgFd0yPqZNXvqmN6WATEWoBnflp9VZuhPq38Vc17F0RALAU Q+PfNOeqjijPqm8YsOQbEWsDPHUUGfOZv3X+LgFgKyOqvfASfebq9UA7CsRSQ3lOqTpgEML+oSVXFw81qSQTEpgQ1TPSrrxsyH5PAPNNVLAJi1Q Xx9oeWvx4TUDjcIAJiOQ/4rin7Efyf2grkGBBrAV/WpoWPAWnGvEAExFDAwqJXfVz5izqBrPX0ShcUawH9s+PG6P+jrzyh5gH4cnALvqr/iesFN E0OqG+b/jT2hEQQgG/2+QsLC6vxC6HZc+fOPeV6AV7cTszPxP3paILHVx95IUAvGOQjnz+u34cl1ecB+Eql/8aNG9UAv4BRX4KLebyacpyRLAJc Bz5ZBOA3BtuuBJ/oAq5evRrA64YAfZE1HgJeTnFjYES8jp+qTuCbbeuJIADtZBDXpWt1PXgdSqknsLGnucH4YXMpRPjiUQBaSt3VLMUF+MgIX1M tgyJ4hSkrEW4UQPDYXvfW+MMU4SYB6GwSC7wdEW4QkPDgdxMBKOW4YonvOAQkHXgnIo5SAFrKbVzLYixpwe8iYgVdRxVFHJGAHYAfx5VcBLwdEf g5q+8wBKCz8aOP7+ZJMgF/QBFOBBB8Utf4oxBhR4CAP0IRAFuFH3n7rASgpfRj5i3gYyWCewQFCPgYB0C/hHMzWYC9hGu6tYQPrnlxd64mQfaIz zDiXxQaEhISEhISEhISEhISEhISEgeK/wCkcAJ7xzdLfgAAAABJRU5ErkJggg==\"})},73802:(e,t,n)=>{\"use strict\";n.d(t,{Dm:()=>o,Mb:()=>r,T_:()=>i,Y2:()=>s,eq:()=>a});const r=\"NCOSINGLEENERGY/START_LOADING\",i=\"NCOSINGLEENERGY/FINISH_LOADING\",o=\"NCOSINGLEENERGY/ASYNC_ADD_ENERGY\",a=\"NCOSINGLEENERGY/PURE_FINISH_LOAD\",s=\"NCOSINGLEENERGY/SET_TARGET_TIME\"},35564:(e,t,n)=>{\"use strict\";n.d(t,{Fg:()=>a});var r=n(37920),i=n.n(r),o=n(61832);const a=o.Z;i()().startOf(\"day\"),o.Z.SOLUTION_SIX},74385:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>s});var r=n(37920),i=n.n(r),o=n(73802);const a={loading:!0,timeDimension:\"day\",statisticTime:i()().startOf(\"day\"),energyData:{},currentTime:0},s=(e,t)=>{const n=null!=e?e:a;switch(t.type){case o.Mb:return{...n,loading:!0};case o.eq:return{...n,loading:!1};case o.T_:return n.timeDimension!==t.payload.timeDimension||n.currentTime!==t.payload.currentTime?{...n}:{...n,statisticTime:i()().startOf(\"day\"),loading:t.payload.loading,energyData:t.payload.energydata};case o.Dm:{if(n.timeDimension!==t.payload.timeDimension||n.currentTime!==t.payload.currentTime)return{...n};const e=n.energyData,{chargePileChargePower:r,totalChargePower:o,existCharge:a,existMultipleChargePile:s,chargePilePowerResults:l,xAxis:c}=t.payload.energyData;return{...n,statisticTime:i()().startOf(\"day\"),energyData:{...e,chargePileChargePower:r,totalChargePower:o,existMultipleChargePile:s,chargePilePowerResults:l,existCharge:a,xAxis:(null==e?void 0:e.xAxis)||c}}}case o.Y2:return{...n,currentTime:t.payload.currentTime,timeDimension:t.payload.timeDimension};default:return n}}},61832:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>r});const r={UNKNOWN:0,SOLUTION_SIX:1,PURE_LIGHT:2,PURE_STORAGE:3,LIGHT_STORAGE:4,MIX:5,SOL8_AC:6,SOL8_PV_AC:7,SOL8_ES_AC:8,SOL8_PV_ES_AC:9,POWER_M:10}},15910:(e,t,n)=>{\"use strict\";n.d(t,{IS:()=>g,JM:()=>b,KE:()=>y,KR:()=>w,LN:()=>T,Lm:()=>x,MX:()=>h,W:()=>u,eq:()=>P,hv:()=>f,hz:()=>C,i0:()=>A,jU:()=>S,kg:()=>v,m1:()=>N,o3:()=>p,rG:()=>I,re:()=>m,tg:()=>M,v2:()=>d,yn:()=>O,z:()=>E,zZ:()=>D});var r=n(37920),i=n.n(r),o=n(99073),a=n(33266),s=n(13528),l=n(51523),c=n.n(l);const u={trigger:\"axis\",confine:!0,axisPointer:{type:\"shadow\",shadowStyle:{color:\"#111A2C0C\"}}},d={backgroundColor:\"#263E58\",trigger:\"axis\",axisPointer:{type:\"line\",lineStyle:{width:2,color:\"#0F233B\",type:\"solid\"}},enterable:!0,confine:!0},p={top:\"5%\",left:\"0%\",right:\"1%\",bottom:\"20%\",containLabel:!0},f={itemWidth:8,itemHeight:8,top:\"83%\",textStyle:{lineHeight:14}},h={type:\"bar\",barGap:\"50%\",barMaxWidth:30,zlevel:100,emphasis:{itemStyle:{color:\"inherit\"}}},m={show:!0,onZero:!1,lineStyle:{fontSize:12}},g={nameGap:0,nameLocation:\"end\",nameTextStyle:{fontSize:12,color:\"#707070\",align:\"right\",verticalAlign:\"top\",padding:[8,0,0,0]}},v=e=>{const t=e.flat().filter((e=>!String(e).includes(o.Nw)));return t.length>0?Math.max(...t):1},y=e=>{const t=e.flat().filter((e=>![o.Nw,o.lH].includes(e))),n=t.length>0?Math.min(...t):0;return n>0?0:n},b=function(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const r=new Array(null===(t=e[0])||void 0===t?void 0:t.length).fill(o.lH);for(let t=0;t<(null===(i=e[0])||void 0===i?void 0:i.length);t++){var i;let a=0,l=!0;for(let n=0;n<e.length;n++)(0,s.s)(e[n][t])||(a+=isNaN(e[n][t])?0:Number(e[n][t]),l=!1);r[t]=l?o.lH:a.toFixed(n)}return r},S=e=>{let t=!0;const n=e.reduce(((e,n)=>{const r=isNaN(n)?0:Number(n);return isNaN(n)||(t=!1),e+r}),0);return t?o.lH:n.toFixed(2)},x=(e,t)=>{const n=i()(t,\"YYYY-MM\",!0).isValid();return\"year\"===e&&n?(0,a.Yb)(e,t+\"-01\"):(0,a.Yb)(e,t)};function w(e,t,n){let r=!1;e.on(\"legendselectchanged\",(i=>{const{name:o,selected:a}=i;let s;const l=o.lastIndexOf(\"-\"),c=[o.slice(0,l),o.slice(l)];t&&t(a,n);for(const e in a)if(Object.prototype.hasOwnProperty.call(a,e)){const t=e.lastIndexOf(\"-\"),n=[e.slice(0,t),e.slice(t)];n[0]===c[0]&&n[1]!==c[1]&&(s=e)}!r&&s?(r=!0,e.dispatchAction({type:\"legendToggleSelect\",name:s})):r=!1}))}function C(e,t){e.on(\"dataZoom\",c()((e=>{const{start:n,end:r}=e;t&&t({start:n,end:r})}),300))}function T(e,t){return isNaN(e)?\"\":t}const A=1,E=2;function O(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:\"\",n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:E)===A?`${isNaN(e)?\"\":t}${n&&!isNaN(e)?\" \":\"\"}${(0,s.af)(e)}`:`${(0,s.af)(e)}${n&&!isNaN(e)?\" \":\"\"}${isNaN(e)?\"\":t}`}const M=e=>e.map((e=>Math.abs(e)>=0&&Math.abs(e)<=100?e:o.lH)),P=e=>e.map((e=>Math.abs(e))),D=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).filter((e=>\"string\"==typeof e?e&&e!==o.lH:e.value&&e.value!==o.lH)).length},I=e=>{const t=[];for(let[n,r]of Object.entries(e))r&&t.push(n);return t},N=e=>{const{selectedLegend:t,leftOriginLegend:n,rightOriginLegend:r,legendAndDataMap:i,leftOriginData:o,rightOriginData:a}=e,s=[],l=[];if(t){const e=I(t);for(let t=0;t<e.length;t++)n.includes(e[t])&&s.push(e[t]),r.includes(e[t])&&l.push(e[t])}let c={},u={};for(let e=0;e<s.length;e++)c={...c,...i[s[e]]};for(let e=0;e<l.length;e++)u={...u,...i[l[e]]};const d=t?c:o,p=t?u:a;return{lastLeftBigintMap:d,lastLeftDataArray:Object.values(d),lastRightBigintMap:p,lastRightDataArray:Object.values(p)}}},44910:(e,t,n)=>{\"use strict\";n.d(t,{CP:()=>D,Th:()=>g,Zc:()=>S,kR:()=>O,pv:()=>w,q3:()=>T});var r=n(37920),i=n.n(r),o=n(15910),a=n(70250),s=n.n(a),l=n(44184),c=n(33266),u=n(13528),d=n(99073),p=n(4905),f=n(26438),h=n(61832);const m=e=>({generationPowerTip:e(\"neteco.pvms.power.pv.inverterPower\"),gridPowerTip:e(\"neteco.pvms.grid.power\"),chargeAndDischargePowerTip:e(\"neteco.pvms.ncoMonitor.station.batteryChargeDischargePower\"),loadPowerTip:e(\"neteco.pvms.load.power\"),radiationDosePowerTip:e(\"neteco.pvms.basicUnifSignal.envir.radiant_line\"),businessChargePowerTip:e(\"neteco.pvms.charge.station.power\"),totalLoadPowerTip:e(\"ncoSiteKpiCard.label.totalLoadPower\"),businessGeneratorPowerTip:e(\"neteco.pvms.echart.power.generatorSet\"),maxDemandTip:e(\"neteco.pvms.maxDemand.Threshold\")});function g(e,t,n){const{generationPowerTip:r,gridPowerTip:i,chargeAndDischargePowerTip:a,loadPowerTip:s,radiationDosePowerTip:l,businessChargePowerTip:u,totalLoadPowerTip:p,businessGeneratorPowerTip:f,maxDemandTip:h}=m(t),g={[r]:n.productPower,[i]:n.meterActivePower,[a]:n.chargeAndDisChargePower,[s]:n.usePower,[l]:n.radiationDosePower,[u]:n.businessChargePower,[p]:n.usePower,[f]:n.businessGeneratorPower,[h]:n.maxDemand},v=[],y=[],b=[],S=[],x=[],w=e.length-1,C=t(\"neteco.pvms.unit.KW\"),T=e[0].axisValueLabel?e[0].axisValueLabel:d.lH;for(let m=0;m<=w;m++){const w=e[m].seriesName,T=e[m].dataIndex;if(w===r){v.push(`${(0,c.hH)(e[m].color)} ${w}`);const t=Math.abs(g[w][T]).toFixed(3);isNaN(t)?y.push(d.lH):y.push((0,o.yn)(t,C))}if(w===i||w===a)if(w===i?v.push(`${(0,c.hH)(e[m].color)} ${t(\"neteco.pvms.grid.power.buyPower\")}`):v.push(`${(0,c.hH)(e[m].color)} ${t(\"neteco.pvms.storage.power.discharge\")}`),w===i?b.push(`${(0,c.hH)(e[m].color)} ${t(\"neteco.pvms.grid.power.sellPower\")}`):b.push(`${(0,c.hH)(e[m].color)} ${t(\"neteco.pvms.storage.power.charge\")}`),g[w][T]>=0){const e=Math.abs(g[w][T]).toFixed(3);isNaN(e)?y.push(d.lH):y.push((0,o.yn)(e,C)),S.push(d.lH)}else{const e=Math.abs(g[w][T]).toFixed(3);isNaN(e)?S.push(d.lH):S.push((0,o.yn)(e,C)),x.push(!1),y.push(d.lH)}if(w===u){b.push(`${(0,c.hH)(e[m].color)} ${w}`);const t=Math.abs(g[w][T]).toFixed(3);isNaN(t)?S.push(d.lH):S.push((0,o.yn)(t,C)),x.push(Number(g[w][T])<0)}if(w===(n.existBusinessCharge?p:s)){b.push(`${(0,c.hH)(e[m].color)} ${w}`);const t=Math.abs(g[w][T]).toFixed(3);isNaN(t)?S.push(d.lH):S.push((0,o.yn)(t,C)),x.push(Number(g[w][T])<0)}if(w===l){v.push(`${(0,c.hH)(e[m].color)} ${w}`);const n=Math.abs(g[w][T]).toFixed(3),r=t(\"neteco.pvms.unit.radiantUnit\");isNaN(n)?y.push(d.lH):y.push((0,o.yn)(n,r))}if(w===f){v.push(`${(0,c.hH)(e[m].color)} ${w}`);const t=Math.abs(g[w][T]).toFixed(3);isNaN(t)?y.push(d.lH):y.push((0,o.yn)(t,C))}if(w===h){v.push(`${(0,c.hH)(e[m].color)} ${w}`);const t=Math.abs(g[w][T]).toFixed(3);isNaN(t)?y.push(d.lH):y.push((0,o.yn)(t,C))}}const A=`<span style=\"width: 50%; margin-right: 24px;\">${t(\"neteco.pvms.production\")}</span>`,E=`<span style=\"width: 50%;\">${t(\"neteco.pvms.spending\")}</span>`,O=`<div style=\"display: flex;justify-content: space-between;\"}>\\n    ${y.length?A:\"\"}\\n    ${S.length?E:\"\"}\\n  </div>`;return(0,c.OA)(T+O,v,y,b,S,x)}const v=e=>[{type:\"category\",axisTick:{show:!1},boundaryGap:!0,axisLine:{lineStyle:{show:!0,fontSize:12,color:\"#111A2C\",opacity:\"0.4\"}},axisLabel:{formatter:e=>e.substring(11,16),color:\"#111A2C\",opacity:\"0.4\"},data:e}],y=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"\",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return{type:\"value\",axisLabel:{normal:{fontSize:12,color:\"#111A2C\",opacity:\"0.4\"},formatter:function(r){const i=r<0?-1:1;if(0===r||1===t||!n)return`${(0,u.af)(Math.abs(r)/t*i)}${e}`;const o=0===r||1===t||!n||n/t>=1?0:1,a=(0,u.TR)(Math.abs(r)/t,o)*i;return`${(0,u.af)(a)}${e}`},color:\"#111A2C\",opacity:\"0.4\"},axisLine:{show:!1},axisTick:{show:!1},nameRotate:-.1,nameTextStyle:{color:\"#111A2C\",opacity:\"0.4\"},max:function(e){if(isNaN(e.max))return 1},min:function(e){if(isNaN(e.min))return-1}}},b=(e,t,n)=>{var r,i,o,a,s,l;const{generationPowerTip:c,gridPowerTip:d,chargeAndDischargePowerTip:p,loadPowerTip:f,totalLoadPowerTip:g,businessChargePowerTip:v,businessGeneratorPowerTip:y,maxDemandTip:b}=m(t),S={name:c,type:\"line\",areaStyle:{},color:\"#6ACA94\",data:e.productPower,isShow:e.productPower&&(null===(r=e.productPower)||void 0===r?void 0:r.length)>0},x={name:null!=e&&e.existBusinessCharge?g:f,type:\"line\",areaStyle:{},color:\"#FF8400\",data:(0,u.Vo)(e.usePower),isShow:e.usePower&&(null===(i=e.usePower)||void 0===i?void 0:i.length)>0},w={name:b,type:\"line\",color:\"#87e0e8\",data:e.maxDemand,isShow:e.maxDemand&&(null==e||null===(o=e.maxDemand)||void 0===o?void 0:o.length)>0},C={name:d,type:\"line\",areaStyle:{},color:\"#111A2C66\",data:e.meterActivePower,isShow:e.meterActivePower&&(null===(a=e.meterActivePower)||void 0===a?void 0:a.length)>0},T={name:p,type:\"line\",areaStyle:{},color:\"#2162D3\",data:e.chargeAndDisChargePower,isShow:e.chargeAndDisChargePower&&(null===(s=e.chargeAndDisChargePower)||void 0===s?void 0:s.length)>0},A={name:v,type:\"line\",areaStyle:{},color:\"#BD72F0FF\",data:e.businessChargePower,isShow:(null==e?void 0:e.businessChargePower)&&e.businessChargePower.length>0},E={name:y,type:\"line\",areaStyle:{},color:\"#EE8FD8\",data:e.businessGeneratorPower,isShow:(null==e?void 0:e.businessGeneratorPower)&&(null===(l=e.businessGeneratorPower)||void 0===l?void 0:l.length)>0},O={PURE_LIGHT_SERIES:[S,x,C,A,E,w],PURE_STORAGE_SERIES:[x,C,T,A,E,w],DEFAULT_SERIES:[S,x,C,T,A,E,w]};return n===h.Z.PURE_STORAGE?O.PURE_STORAGE_SERIES:n===h.Z.PURE_LIGHT?O.PURE_LIGHT_SERIES:O.DEFAULT_SERIES},S=(e,t,n)=>{const{xAxis:r=[],productPower:i=[],usePower:a=[],chargeAndDisChargePower:l=[],meterActivePower:u=[],businessChargePower:d=[],existBusinessCharge:f,businessGeneratorPower:S=[],maxDemand:x=[]}=t,w=(()=>{for(let e=0;e<a.length;e++)if(Number(a[e])<0)return!0;return!1})(),C=0===i.length&&0===a.length&&0===l.length&&0===u.length;if(r.length<=0||C)return{series:[{data:[]}]};const T={productPower:i,meterActivePower:u,chargeAndDisChargePower:l,usePower:a,businessChargePower:d,businessGeneratorPower:S,maxDemand:x},A=s()({...T,existBusinessCharge:f}),E=((e,t,n,r)=>{const{generationPowerTip:i,gridPowerTip:o,chargeAndDischargePowerTip:a,loadPowerTip:s,totalLoadPowerTip:l,businessChargePowerTip:c,businessGeneratorPowerTip:u,maxDemandTip:d}=m(e),{productPower:p,meterActivePower:f,chargeAndDisChargePower:g,usePower:v,businessChargePower:y,businessGeneratorPower:b,maxDemand:S}=n,x={name:i,itemStyle:{color:\"#6ACA94\"},isShow:p&&(null==p?void 0:p.length)>0},w={name:a,itemStyle:{color:\"#2162D3\"},isShow:g&&(null==g?void 0:g.length)>0},C={name:o,itemStyle:{color:\"#111A2C\",opacity:\"0.4\"},isShow:f&&(null==f?void 0:f.length)>0},T={name:r?l:s,itemStyle:{color:\"#FF8400\"},isShow:v&&(null==v?void 0:v.length)>0},A={name:c,itemStyle:{color:\"#BD72F0FF\"},isShow:y&&(null==y?void 0:y.length)>0},E={name:u,itemStyle:{color:\"#EE8FD8\"},isShow:b&&(null==b?void 0:b.length)>0},O={name:d,itemStyle:{color:\"#87e0e8\"},isShow:S&&(null==S?void 0:S.length)>0},M={PURE_LIGHT_LEGEND:[x,C,T,A,E,O],PURE_STORAGE_LEGEND:[C,w,T,A,E,O],DEFAULT_LEGEND:[x,C,w,T,A,E,O]};return t===h.Z.PURE_STORAGE?M.PURE_STORAGE_LEGEND:t===h.Z.PURE_LIGHT?M.PURE_LIGHT_LEGEND:M.DEFAULT_LEGEND})(e,n,T,f).filter((e=>e.isShow)),O=[...b(A,e,n)].filter((e=>e.isShow)),{leftYProps:{min:M,max:P,interval:D}}=(0,c.vg)({leftOriginData:O.map((e=>e.data)),rightOriginData:[]}),{multiple:I,unit:N}=(0,c.dN)([M,P],p.js,e(\"neteco.pvms.unit.KW\"));return{tooltip:{trigger:\"axis\",confine:!0,enterable:!0,formatter:t=>g(t,e,A)},dataZoom:[{show:!1}],legend:{...o.hv,data:E,type:\"scroll\",textStyle:{rich:{b:{backgroundColor:{image:\"/pvmswebsite/assets/build/images/groupIcon/tip_icon.png\"},width:14,height:14}}},formatter:t=>t===e(\"neteco.pvms.load.power\")&&w?[`${t}`,\"{b|}\"].join(\" \"):t,tooltip:{show:!0,trigger:\"item\",position:\"top\",formatter:t=>t.name===e(\"neteco.pvms.load.power\")&&w?e(\"neteco.pvms.station.energyflow.loadPowerErrorTips\"):null}},xAxis:v(r),yAxis:[{...y(\"\",I),max:P,min:M,interval:D}],backgroundColor:\"transparent\",series:O,grid:{...o.o3},leftYaxis:N}};function x(e){return{priceTip:e(\"neteco.pvms.aifc.price.fie\"),SOCTip:e(\"neteco.pvms.aifc.SOC.fie\")}}const w=(e,t,n)=>{const{priceTip:r,SOCTip:i}=x(e),{measureUnit:a,xAxis:s=[],priceData:u=[],socData:f=[]}=t,m=0===u.length&&0===f.length;if(s.length<=0||m)return{series:[{data:[]}]};const{leftYProps:g,rightYProps:y}=(0,c.vg)({leftOriginData:u,rightOriginData:f,splitNumber:5,percentIsLeft:!1}),{min:b,max:S}=g,{multiple:w,unit:C}=(0,c.dN)([S,b],p.qG,a),T=n!==h.Z.PURE_LIGHT?e(\"neteco.pvms.unit.powerRate\"):null;return{dataZoom:[{show:!1}],tooltip:{trigger:\"axis\",confine:!0,formatter:t=>function(e,t,n,r){const{priceTip:i}=x(r),a=[],s=[],l=e.length-1;for(let r=0;r<=l;r++){a.push(`${(0,c.hH)(e[r].color)} ${e[r].seriesName}`);const l=e[r].seriesName===i?n:t,u=e[r].value===d.lH?e[r].value:(0,o.yn)(e[r].value,l);s.push(u)}return(0,c.OA)(e[0].axisValueLabel,a,s)}(t,T,a,e)},legend:{...o.hv,type:\"scroll\",data:[{name:r,itemStyle:{color:\"#F59869\"}},n!==h.Z.PURE_LIGHT&&{name:i,itemStyle:{color:\"#5990FD\"}}]},grid:{...o.o3},xAxis:v(s),yAxis:[{...(0,c.j2)((0,l.lF)(a)?\"\":C,w),...g},n!==h.Z.PURE_LIGHT&&{type:\"value\",axisLabel:{normal:{fontSize:12,color:\"#111A2C\",opacity:\"0.4\"},color:\"#111A2C\",opacity:\"0.4\"},axisLine:{show:!1},axisTick:{show:!1},nameRotate:-.1,nameTextStyle:{color:\"#111A2C\",opacity:\"0.4\"},...y}],series:[{name:r,type:\"line\",step:\"middle\",data:(0,c.sD)(u),yAxisIndex:0,color:\"#F59869\"},n!==h.Z.PURE_LIGHT&&{name:i,type:\"line\",data:(0,c.sD)(f),yAxisIndex:1,color:\"#5990FD\",areaStyle:{}}],leftYaxis:a,rightYaxis:T}};function C(e){return{buyPowerTip:e(\"neteco.pvms.buy.electricity.byGrid.new\"),batteryDischargeElectricityTip:e(\"neteco.pvms.battery.discharge.electricity\"),PVPowerGenerationTip:e(\"neteco.pvms.station.overview.chartLegend3\"),ongridPowerTip:e(\"neteco.pvms.sell.electricity.byGrid\"),chargeElectricityTip:e(\"neteco.pvms.battery.charge.electricity\"),loadElectricityTip:e(\"neteco.pvms.load.use.electricity\"),radiationDosePowerTip:e(\"neteco.pvms.power.radiationDosePower\"),chargeUseEnergyTip:e(\"neteco.pvms.charge.pile.energy.consumption\"),totalLoadElectricityTip:e(\"neteco.pvms.total.load.energy.consumption\"),generatorSetElectricityYieldTip:e(\"neteco.pvms.echart.electricity.yield.generatorSet\")}}function T(e,t,n,r){const{buyPowerTip:a,batteryDischargeElectricityTip:s,PVPowerGenerationTip:l,ongridPowerTip:u,chargeElectricityTip:p,loadElectricityTip:h,radiationDosePowerTip:m,chargeUseEnergyTip:g,totalLoadElectricityTip:v,generatorSetElectricityYieldTip:y}=C(t),b={[a]:n.disGridPower,[s]:n.dischargePower,[l]:n.productPower,[u]:n.onGridPower,[p]:n.chargePower,[h]:n.usePower,[m]:n.radiationDosePower,[v]:n.usePower,[g]:n.businessChargePower,[y]:n.businessGeneratorPower},S=[a,s,l,m,y],x=[u,p,h,g,v];let w=t(\"neteco.pvms.systemSetting.planManage.planType.PGPlan.PGUnit\");const T=[t(\"neteco.pvms.production\")],A=[t(\"neteco.pvms.spending\")],E=[],O=[];let M=0,P=0,D=!1,I=!1;for(let t=0;t<e.length;t++){const n=e[t].dataIndex,r=e[t].seriesName;S.includes(r)&&!isNaN(b[r][n])&&r!==m&&(M+=Math.abs(b[r][n]),D=!0),x.includes(r)&&!isNaN(b[r][n])&&(P+=Math.abs(b[r][n]),I=!0)}M=D?M.toFixed(2):d.lH,P=I?P.toFixed(2):d.lH,E.push((0,o.yn)(M,w)),O.push((0,o.yn)(P,w));for(let n=0;n<e.length;n++){const r=e[n].dataIndex,i=e[n].seriesName;S.includes(i)?(T.push(`${e[n].marker} ${i}`),i===m&&(w=t(\"neteco.pvms.unit.radiationUnit\")),isNaN(b[i][r])?E.push(d.lH):E.push((0,o.yn)(Math.abs(b[i][r]),w))):(A.push(`${e[n].marker} ${i}`),isNaN(b[i][r])?O.push(d.lH):O.push((0,o.yn)(Math.abs(b[i][r]),w)))}let N=e[0].axisValueLabel;return r.period===f.vc.key&&(N=`${i()(r.startTime).format(\"YYYY-MM\")}-${e[0].axisValueLabel}`),r.period===f.oP.key&&(N=`${i()(r.startTime).format(\"YYYY\")}-${e[0].axisValueLabel}`),(0,c.OA)(N,T,E,A,O)}const A=(e,t,n,r)=>{var i,o,a,s,l,c,d,p;const{buyPowerTip:f,batteryDischargeElectricityTip:m,PVPowerGenerationTip:g,ongridPowerTip:v,chargeElectricityTip:y,loadElectricityTip:b,totalLoadElectricityTip:S,chargeUseEnergyTip:x,generatorSetElectricityYieldTip:w}=C(e),T={name:f,type:\"bar\",stack:\"AD\",color:\"#2DA769\",itemStyle:{borderRadius:0},data:t.disGridPower,barMaxWidth:26,isShow:t.disGridPower&&(null===(i=t.disGridPower)||void 0===i?void 0:i.length)},A={name:m,type:\"bar\",stack:\"AD\",color:\"#6ACA94\",itemStyle:{borderRadius:0},data:t.dischargePower,barMaxWidth:26,isShow:t.dischargePower&&(null===(o=t.dischargePower)||void 0===o?void 0:o.length)},E={name:g,type:\"bar\",stack:\"AD\",color:\"#90DCAE\",itemStyle:{borderRadius:0},data:t.productPower,barMaxWidth:26,isShow:t.productPower&&(null===(a=t.productPower)||void 0===a?void 0:a.length)},O={name:w,type:\"bar\",stack:\"AD\",color:\"#EE8FD8\",itemStyle:{borderRadius:0},data:t.businessGeneratorPower,barMaxWidth:26,isShow:t.businessGeneratorPower&&(null===(s=t.businessGeneratorPower)||void 0===s?void 0:s.length)},M={name:v,type:\"bar\",stack:\"AD\",color:\"#EC6F1A\",itemStyle:{borderRadius:0},data:(0,u.Vo)(t.onGridPower),barMaxWidth:26,isShow:t.onGridPower&&(null===(l=t.onGridPower)||void 0===l?void 0:l.length)},P={name:y,type:\"bar\",stack:\"AD\",color:\"#F59869\",itemStyle:{borderRadius:0},data:(0,u.Vo)(t.chargePower),barMaxWidth:26,isShow:t.chargePower&&(null===(c=t.chargePower)||void 0===c?void 0:c.length)},D={name:r?S:b,type:\"bar\",stack:\"AD\",color:\"#F7BC92\",itemStyle:{borderRadius:0},data:(0,u.Vo)(t.usePower),barMaxWidth:26,isShow:t.usePower&&(null===(d=t.usePower)||void 0===d?void 0:d.length)},I={name:x,type:\"bar\",stack:\"AD\",color:\"#BD72F0\",itemStyle:{borderRadius:0},data:(0,u.Vo)(t.businessChargePower),barMaxWidth:26,isShow:t.businessChargePower&&(null===(p=t.businessChargePower)||void 0===p?void 0:p.length)},N={PURE_LIGHT_LEGEND:[T,E,M,D,I,O],PURE_STORAGE_LEGEND:[T,A,M,P,D,I,O],DEFAULT_LEGEND:[T,A,E,M,P,D,I,O]};return n===h.Z.PURE_STORAGE?N.PURE_STORAGE_LEGEND:n===h.Z.PURE_LIGHT?N.PURE_LIGHT_LEGEND:N.DEFAULT_LEGEND},E=e=>({type:\"category\",data:e,axisTick:{show:!1}}),O=(e,t,n,r)=>{const{xAxis:i=[],productPower:a=[],usePower:l=[],chargePower:u=[],dischargePower:d=[],onGridPower:f=[],disGridPower:m=[],selfUsePower:g=[],businessChargePower:v=[],existBusinessCharge:b,businessGeneratorPower:S=[]}=t,x=0===a.length&&0===l.length&&0===u.length&&0===f.length&&0===m.length&&0===d.length;if(i.length<=0||x)return{series:[{data:[]}]};const w={disGridPower:(0,c.sD)(m),dischargePower:(0,c.sD)(d),productPower:(0,c.sD)(a),onGridPower:(0,c.sD)(f),chargePower:(0,c.sD)(u),usePower:(0,c.sD)(l),businessChargePower:(0,c.sD)(v),businessGeneratorPower:(0,c.sD)(S)},O=s()(w),{multiple:M,unit:P}=(0,c.dN)(w,p.s1,e(\"neteco.pvms.systemSetting.planManage.planType.PGPlan.PGUnit\")),D=(0,c.Um)(w,M),I=((e,t,n,r)=>{const{buyPowerTip:i,batteryDischargeElectricityTip:o,PVPowerGenerationTip:a,ongridPowerTip:s,chargeElectricityTip:l,loadElectricityTip:c,totalLoadElectricityTip:u,chargeUseEnergyTip:d,generatorSetElectricityYieldTip:p}=C(e),{disGridPower:f,dischargePower:m,productPower:g,onGridPower:v,chargePower:y,usePower:b,businessChargePower:S,businessGeneratorPower:x}=n,w={name:i,icon:\"circle\",itemStyle:{color:\"#2DA769\"},isShow:f&&(null==f?void 0:f.length)>0},T={name:o,icon:\"circle\",itemStyle:{color:\"#6ACA94\"},isShow:m&&(null==m?void 0:m.length)>0},A={name:a,icon:\"circle\",itemStyle:{color:\"#90DCAE\"},isShow:g&&(null==g?void 0:g.length)>0},E={name:s,icon:\"circle\",itemStyle:{color:\"#EC6F1A\"},isShow:v&&(null==v?void 0:v.length)>0},O={name:l,icon:\"circle\",itemStyle:{color:\"#F59869\"},isShow:y&&(null==y?void 0:y.length)>0},M={name:r?u:c,icon:\"circle\",itemStyle:{color:\"#F7BC92\"},isShow:b&&(null==b?void 0:b.length)>0},P={name:d,icon:\"circle\",itemStyle:{color:\"#BD72F0\"},isShow:S&&(null==S?void 0:S.length)>0},D={name:p,icon:\"circle\",itemStyle:{color:\"#EE8FD8\"},isShow:x&&(null==x?void 0:x.length)>0},I={PURE_LIGHT_LEGEND:[w,A,E,M,P],PURE_STORAGE_LEGEND:[w,T,E,O,M,P,D],DEFAULT_LEGEND:[w,T,A,E,O,M,P,D]};return t===h.Z.PURE_STORAGE?I.PURE_STORAGE_LEGEND:t===h.Z.PURE_LIGHT?I.PURE_LIGHT_LEGEND:I.DEFAULT_LEGEND})(e,r,w,b).filter((e=>e.isShow)),N=[...A(e,D,r,b)].filter((e=>e.isShow));return{dataZoom:[{show:!1}],tooltip:{...o.W,formatter:t=>T(t,e,O,n)},legend:{...o.hv,data:I,type:\"scroll\"},grid:{...o.o3},xAxis:[E(i)],yAxis:y(),series:N,leftYaxis:P}};function M(e,t){let n=e(\"neteco.pvms.station.trend.proportion.of.self-sufficiency\");return h.Z.LIGHT_STORAGE===t&&(n=e(\"neteco.pvms.station.lightStorage.system.powerSupply.percentage\")),{powerProductTip:e(\"neteco.pvms.station.overview.chartLegend3\"),selfUseTip:e(\"neteco.pvms.station.trend.proportion.of.spontaneous.self.use\"),userPowerTip:e(\"neteco.pvms.load.use.electricity\"),selfSufficiencyTip:n}}const P=e=>{var t,n;let{intlMessage:r,fixData:i,selfUsePowerRatioByProduct:a,selfUsePowerRatioByUse:s,showEnergyProcess:l,sceneType:c}=e;const{powerProductTip:d,selfUseTip:p,userPowerTip:f,selfSufficiencyTip:h}=M(r,c),m={name:d,type:\"bar\",stack:\"AD\",color:\"#6ACA94\",itemStyle:{borderRadius:0},data:i.productPower,yAxisIndex:0,barMaxWidth:26,isShow:i.productPower&&(null===(t=i.productPower)||void 0===t?void 0:t.length)>0},g={DEFAULT:[m,{name:p,type:\"line\",color:\"#1AAC6E\",itemStyle:{borderRadius:0},data:(0,o.tg)((0,o.eq)(a)),yAxisIndex:1,isShow:a&&(null==a?void 0:a.length)},{name:f,type:\"bar\",stack:\"AD\",color:\"#F59869\",itemStyle:{borderRadius:0},data:(0,u.Vo)(i.usePower),yAxisIndex:0,barMaxWidth:26,isShow:i.usePower&&(null===(n=i.usePower)||void 0===n?void 0:n.length)>0},{name:h,type:\"line\",color:\"#FF8400\",itemStyle:{borderRadius:0},data:(0,u.Vo)((0,o.tg)(s)),yAxisIndex:1,isShow:s&&(null==s?void 0:s.length)>0}],ONLYPVPRODUCTION:[m]};return l?g.DEFAULT:g.ONLYPVPRODUCTION},D=(e,t,n,r,a)=>{const{productPower:s=[],usePower:l=[],selfUsePowerRatioByProduct:h=[],selfUsePowerRatioByUse:m=[],xAxis:g=[]}=t,v=0===s.length&&0===l.length&&0===h.length&&0===m.length;if(g.length<=0||v)return{series:[{data:[]}]};const y=e(\"neteco.pvms.systemSetting.planManage.planType.PGPlan.PGUnit\"),b={productPower:(0,c.sD)(s),selfUsePowerRatioByProduct:(0,o.tg)((0,c.sD)(h)),usePower:(0,c.sD)(l),selfUsePowerRatioByUse:(0,o.tg)((0,c.sD)(m))},S=r?e(\"neteco.pvms.unit.powerRate\"):null,{leftYProps:x,rightYProps:w}=(0,c.vg)({leftOriginData:[s,(0,u.Vo)(l)],rightOriginData:[100,-100],splitNumber:8,percentIsLeft:!1}),{min:C,max:T}=x,{multiple:A,unit:O}=(0,c.dN)([T,C],p.s1,y),D=((e,t,n,r)=>{const{powerProductTip:i,selfUseTip:o,userPowerTip:a,selfSufficiencyTip:s}=M(e,r),{productPower:l,selfUsePowerRatioByProduct:u,usePower:d,selfUsePowerRatioByUse:p}=n,f={name:i,icon:\"circle\",itemStyle:{color:\"#6ACA94\"},isShow:l&&(null==l?void 0:l.length)>0},h={DEFAULT:[f,{name:o,icon:c.qz,itemStyle:{color:\"#1AAC6E\"},isShow:u&&(null==u?void 0:u.length)>0},{name:a,icon:\"circle\",itemStyle:{color:\"#F59869\"},isShow:d&&(null==d?void 0:d.length)>0},{name:s,icon:c.qz,itemStyle:{color:\"#FF8400\"},isShow:p&&(null==p?void 0:p.length)}],ONLYPVPRODUCTION:[f]};return t?h.DEFAULT:h.ONLYPVPRODUCTION})(e,r,b,a).filter((e=>e.isShow)),I=[...P({intlMessage:e,fixData:{productPower:s,usePower:l},selfUsePowerRatioByProduct:h,selfUsePowerRatioByUse:m,showEnergyProcess:r,sceneType:a})].filter((e=>e.isShow));return{dataZoom:[{show:!1}],tooltip:{...o.W,formatter:t=>function(e,t,n,r,a){const{powerProductTip:s,selfUseTip:l,userPowerTip:u,selfSufficiencyTip:p}=M(t,a),h={[s]:n.productPower,[l]:n.selfUsePowerRatioByProduct,[u]:n.usePower,[p]:n.selfUsePowerRatioByUse},m=[],g=[],v=e.length-1;for(let n=0;n<=v;n++){const r=e[n].dataIndex,i=e[n].seriesName,a=[s,u].includes(i)?t(\"neteco.pvms.systemSetting.planManage.planType.PGPlan.PGUnit\"):t(\"neteco.pvms.unit.powerRate\"),f=[l,p].includes(i)?(0,c.hH)(e[n].color):e[n].marker;m.push(`${f} ${i}`),h[i][r]===d.lH?g.push(h[i][r]):g.push((0,o.yn)(Math.abs(h[i][r]),a))}let y=e[0].axisValueLabel;return r.period===f.vc.key&&(y=`${i()(r.startTime).format(\"YYYY-MM\")}-${e[0].axisValueLabel}`),r.period===f.oP.key&&(y=`${i()(r.startTime).format(\"YYYY\")}-${e[0].axisValueLabel}`),(0,c.OA)(y,m,g)}(t,e,b,n,a)},legend:{...o.hv,data:D,type:\"scroll\"},grid:{...o.o3},xAxis:[E(g)],yAxis:[{...(0,c.j2)(\"\",A,null,!0),...x},r&&{...(0,c.j2)(\"\",1,null,!0),...w}],series:I,leftYaxis:O,rightYaxis:S}}},18218:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>d});var r=n(49453),i=n(90338),o=n(37920),a=n.n(o),s=n(80770),l=n(96299),c=n(44184),u=n(4342);const d=new class{constructor(){this.USER_OPEN={YES:1,NO:0},this.OPINION_TYPE={EMMAweb:10,EMMAapp:11}}handleNoAuthException(e){let t=\"\";401===e.status&&\"UA.00010002\"===e.responseJSON.exceptionId&&(t=l.Z.intl.formatMessage({id:\"neteco.pvms.station.unauthorized.tip\"})),(0,s.A)(t,t?\"noEMMAAuth\":\"commonErr\")}queryGodRevenue(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,r.U2)(\"/rest/dp/pvms/dpaiplugin/v2/aifc/web/query-god-revenue\",{plantDn:e,preCheck:t})}async queryAiRevenue(e){const[t,n]=await(0,c.AM)((0,r.v_)(\"/rest/neteco/web/dpaiplugin/aifc/queryAiRevenue/v1\",{plantDn:e,showNegativeRevenue:!0}));return t?(this.handleNoAuthException(t),{}):n}async setAiFCStatus(e,t){const n={plantDn:e,status:t,isSignDisclaimer:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1},[i,o]=await(0,c.AM)((0,r.v_)(\"/rest/dp/pvms/dpaiplugin/v2/aifc/web/switch\",n));return i?(this.handleNoAuthException(i),new Promise.reject(i)):o}saveOpinion(e){const t={closeReason:e.disableReason,closeSuggestion:e.disableSuggest},n={opinionType:this.OPINION_TYPE.EMMAweb,opinionContent:JSON.stringify(t),starRating:5,userName:(0,u.vW)(),submissionTime:(new Date).getTime()};(0,r.v_)(\"/rest/pvms/web/feedback/v1/feedback/save-opinion\",n)}async getDisableReason(){return(0,c.AM)((0,r.U2)(\"/rest/dp/pvms/dpaiplugin/v2/aifc/close-info\"))}async getAiRevenueReport(e,t,n){const o=a()(String(n)).valueOf(),s=Intl.DateTimeFormat().resolvedOptions().timeZone,[l,u]=await(0,c.AM)((0,r.v_)(\"/rest/neteco/web/dpaiplugin/aifc/revenueReport/v1\",{plantDn:e,queryType:t,queryTime:o,timeZone:(0,i.Z)(o),timeZoneStr:s,showNegativeRevenue:!0}));return l?(this.handleNoAuthException(l),{}):u}async getAiEnergyAnalysis(e){const t=a()().startOf(\"day\").valueOf(),n=Intl.DateTimeFormat().resolvedOptions().timeZone,[o,s]=await(0,c.AM)((0,r.U2)(\"/rest/dp/pvms/dpaiplugin/v2/aifc/web/energy-analysis\",{plantDn:e,timeZone:(0,i.Z)(t),timeZoneStr:n}));return o?(this.handleNoAuthException(o),{}):s}async getEnergySavingAnalysis(e){const t=a()().startOf(\"day\").valueOf(),n=Intl.DateTimeFormat().resolvedOptions().timeZone,[o,s]=await(0,c.AM)((0,r.U2)(\"/rest/dp/pvms/dpaiplugin/v1/energy/web/energy-saving-analysis\",{plantDn:e,timeZone:(0,i.Z)(t),timeZoneStr:n,isShowDst:!0}));return o?(this.handleNoAuthException(o),{}):s}async getStorageLockStatus(e){const[t,n]=await(0,c.AM)((0,r.U2)(\"/rest/dp/pvms/dpaiplugin/v1/aifc/storage-lock/web/query-status\",{plantDn:e}));return t?(this.handleNoAuthException(t),{}):n||{}}async saveStorageLockStatus(e){const[t,n]=await(0,c.AM)((0,r.v_)(\"/rest/dp/pvms/dpaiplugin/v1/aifc/storage-lock/web/config-lock\",e));return t?(this.handleNoAuthException(t),{}):n}}},98863:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>c});var r=n(49453),i=n(44184),o=n(80770),a=n(96299),s=n(37920),l=n.n(s);const c=new class{constructor(){this.exportRevenueInfo=async(e,t,n,i,s)=>{const c=l()(String(n)).valueOf(),u=Intl.DateTimeFormat().resolvedOptions().timeZone,{taskId:d}=await(0,r.v_)(\"/rest/dp/pvms/pvmswebsite/report/v1/payoffs/export\",{stationDn:e,statDim:t,statTime:c,timeZoneStr:u,reportType:s});d?i(!0):(0,o.lU)(a.Z.intl.formatMessage({id:\"neteco.pvms.exportFailed\"}))},this.loadTotalBenefits=async e=>{const t=Intl.DateTimeFormat().resolvedOptions().timeZone,[,n]=await(0,i.AM)((0,r.U2)(\"/rest/dp/pvms/pvmswebsite/report/v1/payoffs/total-benefits\",{...e,timeZoneStr:t}));return n||{}},this.loadPvBenefits=async e=>{const t=Intl.DateTimeFormat().resolvedOptions().timeZone,[,n]=await(0,i.AM)((0,r.U2)(\"/rest/dp/pvms/pvmswebsite/report/v1/payoffs/pv-benefits\",{...e,timeZoneStr:t}));return n||{}},this.getPriceCondition=e=>(0,r.U2)(\"/rest/pvms/web/electricityprice/station-price\",{stationDn:e})}getBatteryContent(e,t,n){const i=l()(String(n)).valueOf(),o=Intl.DateTimeFormat().resolvedOptions().timeZone;return(0,r.U2)(\"/rest/dp/pvms/pvmswebsite/report/v1/payoffs/storage-benefits\",{stationDn:e,statDim:t,statTime:i,timeZoneStr:o})}getBatteryDemandRevenue(e,t,n){const i=l()(String(n)).valueOf(),o=Intl.DateTimeFormat().resolvedOptions().timeZone;return(0,r.U2)(\"/rest/dp/pvms/pvmswebsite/report/v1/payoffs/demand\",{stationDn:e,statDim:t,statTime:i,timeZoneStr:o})}getBatteryArbitrageRevenue(e,t,n){const i=l()(String(n)).valueOf(),o=Intl.DateTimeFormat().resolvedOptions().timeZone;return(0,r.U2)(\"/rest/dp/pvms/pvmswebsite/report/v1/payoffs/arbitrage\",{stationDn:e,statDim:t,statTime:i,timeZoneStr:o})}getSelfUserRevenue(e,t,n){const i=l()(String(n)).valueOf(),o=Intl.DateTimeFormat().resolvedOptions().timeZone;return(0,r.U2)(\"/rest/dp/pvms/report/v1/payoffs/selfuse\",{stationDn:e,statDim:t,statTime:i,timeZoneStr:o})}getEMMARevenueContent(e,t,n){const i=l()(String(n)).valueOf(),o=Intl.DateTimeFormat().resolvedOptions().timeZone;return(0,r.U2)(\"/rest/dp/pvms/pvmswebsite/v1/aifc/revenue/total\",{stationDn:e,queryType:t,queryTime:i,timeZoneStr:o})}getEMMADemandRevenue(e,t,n){const i=l()(String(n)).valueOf(),o=Intl.DateTimeFormat().resolvedOptions().timeZone;return(0,r.U2)(\"/rest/dp/pvms/pvmswebsite/v1/aifc/revenue/demand\",{stationDn:e,queryType:t,queryTime:i,timeZoneStr:o})}getEMMAArbitrageRevenue(e,t,n){const i=l()(String(n)).valueOf(),o=Intl.DateTimeFormat().resolvedOptions().timeZone;return(0,r.U2)(\"/rest/dp/pvms/pvmswebsite/v1/aifc/revenue/power\",{stationDn:e,queryType:t,queryTime:i,timeZoneStr:o})}}},1544:(e,t,n)=>{\"use strict\";n.d(t,{BO:()=>u,Nl:()=>d,hJ:()=>p});var r=n(44184),i=n(37920),o=n.n(i),a=n(33266),s=n(15910),l=n(34176),c=n(99073);const u=function(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:\"HH:mm\";return(null===(t=e)||void 0===t?void 0:t.length)>16&&(e=e.substring(0,16)),o()(e).format(n)},d=(e,t,n,r)=>{const i=((e,t)=>{const{period:n,dateTime:r}=t;let i=e;return n===l.a.MONTH&&(i=o()(r).date(e).format(\"YYYY-MM-DD\")),n===l.a.YEAR&&(i=o()(r).month(e-1).format(\"YYYY-MM\")),i})(e[0].axisValueLabel,r),u=[],d=[];return e.forEach((e=>{var r;const{name:i,unit:o,fullName:a,fullUnit:l}=n[e.seriesIndex];let p=e.marker;\"bar\"===e.seriesType&&(p=`<span style=\"display:inline-block;background-color:${e.color};height:8px;width:8px;\\n   margin-right:8px;border-radius:2px;vertical-align:middle;\"></span>`),\"line\"===e.seriesType&&(p=`<span style=\"display:inline-block;background-color:${e.color};height:3px;width:8px;\\n   margin-right:8px;vertical-align:middle;\"></span>`);const f=l||t.formatMessage({id:o});u.push(`${p} ${a||t.formatMessage({id:i})}`);const h=(0,s.yn)(null!==(r=e.value)&&void 0!==r?r:c.lH,f,2,!0);d.push(h===c.lH?`${h} ${f}`:h)})),(0,a.OA)(i,u,d)},p=e=>((0,r.kJ)(e.yAxis)?e.yAxis.forEach((e=>{e.splitLine={...e.splitLine,lineStyle:{color:\"#ffffff0d\"}}})):e.yAxis.splitLine={...e.yAxis.splitLine,lineStyle:{color:\"#ffffff0d\"}},e)},34176:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>x,a:()=>b});var r=n(8411),i=n(56730),o=n(66915),a=n(24301),s=n(13450),l=n(21715),c=n(33371),u=n(91987),d=n(33331),p=n(15812),f=n(37920),h=n.n(f),m=n(88391),g=n(46992),v=n(13528),y=n(23712);const b={DAY:\"day\",MONTH:\"month\",YEAR:\"year\",LIFETIME:\"lifetime\"};class S extends m.Component{constructor(e){super(e),this.periodClick=e=>{this.setState({period:e}),this.handleOnchange(e,h()()),e!==this.state.period&&this.setState({defaultDate:(0,i.Z)(e)})},this.btnTipShow=(e,t)=>{if(!this.props.enableCarousel)return!1;if(e!==t)return!1;if(this.buttonRef[e]){const{offsetWidth:t,scrollWidth:n}=this.buttonRef[e].lastChild;return t<n}return!1},this.state={period:this.props.hasDaily?b.DAY:b.MONTH,defaultDate:h()(),btnTipItem:\"\"},this.buttonRef={}}componentDidUpdate(e){e.dimension!==this.props.dimension&&this.setState({period:this.props.dimension})}renderPeriodSwitch(e){const{intl:t,hasDaily:n,isBigScreen:r}=this.props,{btnTipItem:i}=this.state,l=t.formatMessage({id:\"neteco.pvms.systemSetting.amendment.day\"}),c=t.formatMessage({id:\"neteco.pvms.systemSetting.amendment.month\"}),u=t.formatMessage({id:\"neteco.pvms.systemSetting.amendment.year\"}),d=t.formatMessage({id:\"neteco.pvms.KPI.kpiView.lifelimit\"}),p=(t.formatMessage({id:\"neteco.pvms.station.energy.self.tabName\"}),[{label:c,value:b.MONTH},{label:u,value:b.YEAR},{label:d,value:b.LIFETIME}]);n&&p.unshift({label:l,value:b.DAY});const f=r?\"check-btn-dark\":\"\",h=r?\"unchecked-btn-dark\":\"unchecked-btn\";return(0,y.jsx)(\"div\",{className:\"btn-group\",style:{backgroundColor:r?\"#303030FF\":\"#f1f3f5ff\"},children:window.screen.width<=1440?(0,y.jsx)(o.Z,{className:\"period-select\",defaultValue:e,options:p,onChange:this.periodClick,getPopupContainer:e=>e.parentElement}):p.map((t=>(0,y.jsx)(a.Z,{title:t.label,visible:i===t.value||this.btnTipShow(e,t.value),getPopupContainer:e=>e.parentElement,placement:\"bottom\",children:(0,y.jsx)(\"span\",{onMouseEnter:()=>this.setState({btnTipItem:t.value}),onMouseLeave:()=>this.setState({btnTipItem:\"\"}),children:(0,y.jsx)(s.Z,{ref:e=>this.buttonRef[t.value]=e,className:`btn ${e===t.value?f:h}`,type:e===t.value?\"primary\":\"text\",ghost:!0,onClick:()=>this.periodClick(t.value),children:t.label},t.value)})},t.value)))})}handleOnchange(e,t){const{periodOnChange:n}=this.props;let i=e;e===b.LIFETIME&&(i=b.YEAR),this.setState({defaultDate:h()(t)}),null==n||n((0,r.Z)(e),h()(t).startOf(i).format(\"YYYY-MM-DD HH:mm:ss\"),e)}handlePanelRender(e){return(0,y.jsx)(\"div\",{className:\"nco-date-picker-panel\",children:e})}render(){const{period:e,defaultDate:t}=this.state,{chartTitle:n,chartComponent:r,indicators:i,hasPeriodSelect:o,onlyDatepicker:s,isBigScreen:f}=this.props,h=f?l.i.DARK:l.i.LIGHT;return(0,y.jsxs)(c.Z,{className:\"nco-sub-sys-chart-container dp-design-theme-wrapper\",\"dp-design-theme\":h,style:{backgroundColor:f&&\"#545F6E26\"},children:[(0,y.jsxs)(\"div\",{className:\"nco-container-head\",children:[(0,y.jsx)(\"div\",{className:`leftTitle ${f&&\"leftTitle-dark\"}`,children:n}),o&&(0,y.jsxs)(\"div\",{className:\"rightPeriod\",children:[!s&&this.renderPeriodSwitch(e),(0,y.jsx)(\"div\",{className:`custom-date-picker  ${f&&\"dark-date-picker\"} `,children:(0,y.jsx)(u.Z,{allowClear:!1,value:t,getPopupContainer:e=>e.parentElement,placement:\"bottomRight\",picker:e===b.LIFETIME?b.YEAR:e,suffixIcon:(0,y.jsx)(d.Z,{className:\"calender-icon\"}),panelRender:this.handlePanelRender,onChange:(t,n)=>this.handleOnchange(e,t)})})]})]}),(null==i?void 0:i.length)>0&&(0,y.jsx)(\"div\",{className:\"nco-container-indicators\",children:i.map((e=>{var t,n;return(0,y.jsx)(a.Z,{title:`${null!==(t=e.originValue)&&void 0!==t?t:\"\"} ${null!==(n=e.originUnit)&&void 0!==n?n:\"\"}`,children:(0,y.jsxs)(\"div\",{className:\"indicator-block\",children:[(0,y.jsx)(\"div\",{className:\"indicator-title \"+(f?\"indicator-title-color-dark\":\"indicator-title-color\"),children:e.label}),(0,y.jsxs)(\"div\",{className:\"indicator-value \"+(f?\"indicator-value-color-dark\":\"indicator-value-color\"),children:[(0,y.jsx)(\"span\",{children:(0,v.af)(e.value)}),e.unit]})]})})}))}),(0,y.jsx)(p.Z,{spinning:Boolean(this.props.loading),children:(0,y.jsx)(\"div\",{className:\"nco-container-chart\",children:r})})]})}}const x=(w=S,function(e){const{isBigScreen:t,enableCarousel:n}=(0,g.c)();return(0,y.jsx)(w,{...e,isBigScreen:t,enableCarousel:n})});var w},46992:(e,t,n)=>{\"use strict\";n.d(t,{a:()=>a,c:()=>s});var r=n(88391),i=n(23712);const o=(0,r.createContext)(),a=e=>{let{value:t,children:n}=e;return(0,i.jsx)(o.Provider,{value:t,children:n})},s=()=>(0,r.useContext)(o)||{}},15836:(e,t,n)=>{\"use strict\";n.d(t,{Eu:()=>o,Mb:()=>r,T_:()=>i,am:()=>a});const r=\"NCOPOVERTYCONTAINER/START_LOADING\",i=\"NCOPOVERTYCONTAINER/FINISH_LOADING\",o=\"NCOPOVERTYCONTAINER/FINISH_LOADING_SITE_TREE\",a=\"NCO_NORTH_CONTAINER/SET_MODIFY_CALLBACK\"},48067:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>l});var r=n(37920),i=n.n(r),o=n(15836);const a={loading:!1,sortCondition:{},searchCondition:{name:\"\"},tableData:{list:[],total:0,page:1,pageSize:10},siteTreeDatas:[],operation:\"create\",pageCondition:{page:1,pageSize:10},modifyCallback:void 0},s=e=>{let{list:t,pageNo:n,...r}=e;return{...r,page:n,list:t.map((e=>{let{deadline:t,...n}=e;return{...n,deadline:t?i()(Number.parseInt(t,10)):null}}))}},l=(e,t)=>{const n=null!=e?e:a;switch(t.type){case o.Mb:return{...n,loading:!0};case o.T_:return{...n,loading:!1,tableData:s(t.payload.tableData),searchCondition:t.payload.searchCondition,pageCondition:t.payload.pageCondition,sortCondition:t.payload.sortCondition};case o.Eu:return{...n,loading:!1,siteTreeDatas:t.payload};case o.am:return{...n,modifyCallback:t.payload};default:return n}}},30686:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>g});var r=n(41779),i=n(88391),o=n(98185),a=n(92252),s=n(93706),l=n(23712);const{Option:c}=a.Z;class u extends i.Component{constructor(e){super(e),this.state={fileList:[]}}render(){const{customToolbarButtons:e}=this.props;return(0,l.jsx)(\"div\",{className:\"nco-table-with-search-bar-toolbar\",children:e.map(((e,t)=>e.formItems))})}}const d=(0,s.ZP)(u);var p=n(91502),f=n(10749);const{updatExpandedRowKeys:h}=f.Z;class m extends i.Component{constructor(e){var t;super(e),t=this,this.updateSearchCondition=function(e){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],{searchCondition:r}=t.state;const{tableData:i,loadTableData:o,update:a,timerStop:s}=t.props.tableConfigs,{__isReset__:l}=e;delete e.__isReset__,l&&(t.updateFilterCondition({}),r=t.props.searchCondition);const{pageSize:c}=i;let u={...r,...e};s&&s(),t.setState({searchCondition:u}),n&&o({page:1,pageSize:c,...u}),a&&a(),h.next()},this.onSelectRows=e=>{this.setState({selectedRows:e});const{onSelectRows:t}=this.props;t&&t(e)},this.updateFilterCondition=e=>{const{updateFilterCondition:t}=this.props;t?t(e):this.updateSearchCondition(e)},this.state={searchCondition:e.searchConfigs.searchCondition||{},selectedRows:[]}}componentDidUpdate(e,t,n){var r;const{filteredInfo:i}=this.props.searchConfigs,{dn:o}=this.props.searchConfigs.searchCondition||{};!(null===(r=this.state.searchCondition)||void 0===r?void 0:r.dn)&&o&&Object.prototype.hasOwnProperty.call(this.props.searchConfigs.searchCondition,\"dn\")&&this.setState({searchCondition:this.props.searchConfigs.searchCondition||{}}),e.searchConfigs.filteredInfo!==i&&this.updateSearchCondition(i)}render(){const{tableConfigs:e,searchConfigs:t,modifyConfigs:n,deleteConfigs:i,CustomToolBarRender:a=()=>(0,l.jsx)(l.Fragment,{}),customToolbarButtons:s,clearCheckedTableData:c}=this.props,{searchCondition:u}=this.state;return(0,l.jsxs)(\"div\",{className:\"nco-table-with-search-bar\",id:\"nco\",children:[(0,l.jsx)(o.Z,{searchConfigs:t,clearChecked:c,updateSearchCondition:this.updateSearchCondition}),(0,l.jsx)(r.Z,{}),(0,l.jsx)(a,{}),(0,l.jsx)(d,{customToolbarButtons:s}),(u.dn||!(\"dn\"in u))&&(0,l.jsx)(p.Z,{...e,updateFilterCondition:this.updateFilterCondition,searchCondition:u,modifyConfigs:n,deleteConfigs:i,onSelectRows:this.onSelectRows})]})}}m.defaultProps={operationRights:{},customToolbarButtons:[]};const g=m},98185:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>u});var r=n(41541),i=n(29266),o=n(88391),a=n(78939),s=n(93706),l=n(23712);class c extends o.Component{constructor(e){super(e),this.formRef=o.createRef(),this.submitSearchForm=()=>{const{updateSearchCondition:e,clearChecked:t}=this.props;this.formRef.current.validateFields().then((t=>{Object.keys(t).forEach((e=>{t[e]=\"string\"==typeof t[e]?t[e].trim():t[e]})),e({...t,...this.state,_timestamp:(new Date).getTime()})})),t&&t()},this.resetSearchForm=e=>{const{clearChecked:t}=this.props;e.preventDefault(),this.formRef.current.resetFields(),this.submitSearchForm(),t&&t()},this.getFormItemClass=(e,t)=>e?\"zh-CN\"===t.locale?\"floatLine_Z\":\"floatLine\":\"nco-table-with-search-bar-search-buttons\",this.state={}}componentDidMount(){const{updateSearchCondition:e,updateModalTableSubject:t,updateSearchConditionSub:n}=this.props;t&&(this.subscribtion2=t.subscribe((t=>{this.setState(t),e(t)}))),n&&(this.subscribtion3=n.subscribe((t=>{this.setState(t),e(t)})))}componentWillUnmount(){this.subscribtion2&&this.subscribtion2.unsubscribe(),this.subscribtion3&&this.subscribtion3.unsubscribe()}render(){const{searchConfigs:e,intl:t}=this.props,{formItems:n,formItemLayout:o}=e;return(0,l.jsx)(\"div\",{className:\"nco-table-with-search-bar-search\",children:(0,l.jsxs)(i.Z,{ref:this.formRef,layout:o?null:\"inline\",onFinish:this.submitSearchForm,autoComplete:\"off\",onValuesChange:e=>{this.props.updateSearchCondition(e,!1)},children:[n.map((e=>{let{key:t,label:n,options:r,component:a}=e;return(0,l.jsx)(i.Z.Item,{name:t,label:n,...o,...r,children:a},t)})),n.length>0?(0,l.jsxs)(i.Z.Item,{className:this.getFormItemClass(o,t),children:[(0,l.jsx)(r.Z,{type:\"primary\",htmlType:\"submit\",children:(0,l.jsx)(a.Z,{id:\"common.button.search\"})}),(0,l.jsx)(r.Z,{onClick:this.resetSearchForm,children:(0,l.jsx)(a.Z,{id:\"common.button.reset\"})})]}):\"\"]})})}}const u=(0,s.ZP)(c)},91502:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>p});var r=n(57350),i=n(15694),o=n(88391),a=n(93706),s=n(10749),l=n(23712);const{updateTableSubject:c,updatExpandedRowKeys:u}=s.Z;class d extends o.Component{constructor(e){super(e),this.updateTableData=e=>{let{page:t,pageSize:n}=e;const{loadTableData:r,searchCondition:i}=this.props;r({page:t,pageSize:n,...i})},this.handleTableChange=(e,t,n,r)=>{let{field:i,order:o}=n,{action:a}=r;const{searchCondition:s,tableData:l,loadTableData:c,updateFilterCondition:u}=this.props,{sortCondition:d}=this.state,{page:p,pageSize:f}=l;\"filter\"!==a?(this.setState({sortCondition:{sortBy:i||d.sortBy,sortOrder:o||\"ascend\"}}),c({page:p,pageSize:f,...s},{page:p,pageSize:f},{sortBy:i||d.sortBy,sortOrder:o||\"ascend\"})):u(t)},this.onChangePage=(e,t)=>{const{clearCheckedTableData:n}=this.props;this.updateTableData({page:e,pageSize:t}),n&&n()},this.onShowSizeChange=(e,t)=>{const{clearCheckedTableData:n}=this.props;this.updateTableData({page:1,pageSize:t}),n&&n()},this.hideModifyModal=()=>{this.setState({showModifyModal:!1,currentModifyRecord:null})},this.onSubmit=(e,t)=>{const{modifyConfigs:n,intl:r}=this.props,{modifyData:i}=n;this.hideModifyModal(),i(e,t,r,(()=>{c.next()}))},this.showTotal=()=>{const{intl:e,tableData:t}=this.props,{total:n}=t;return e.formatMessage({id:\"neteco.pvms.station.subarray.pagination.total\"},{total:n})},this.isInSmallScreen=()=>window.screen.width<1441,this.state={expandedRowKeys:[],sortCondition:e.defaultSortCondition||{},showModifyModal:!1,currentModifyRecord:null}}componentWillUnmount(){this.subscribtion&&(this.subscribtion.unsubscribe(),this.subscribtionMap.unsubscribe())}componentDidMount(){const{loadTableData:e,tableData:t,searchCondition:n}=this.props,{page:r,pageSize:i}=t;e({page:r,pageSize:i,...n}),this.subscribtion=c.subscribe((e=>{let t=e&&e.page?e.page:this.props.tableData.page,n=e&&e.pageSize?e.pageSize:this.props.tableData.pageSize;this.updateTableData({page:t,pageSize:n}),e&&e.callback&&e.callback()})),this.subscribtionMap=u.subscribe((e=>{this.setState({expandedRowKeys:e?[e.id]:[]})}))}render(){const{tableComponentProps:e,columns:t,tableData:n,loading:o,intl:a,rowSelection:s,createExpand:c,onExpand:u,setNoExpandConds:d,scroll:p,pagination:f}=this.props,{sortCondition:h}=this.state,{list:m,total:g,page:v,pageSize:y}=n,{sortBy:b,sortOrder:S}=h,x=t.map((e=>{let{key:t,...n}=e;return{...n,sortOrder:b===t&&S}})),w=\"object\"==typeof p?p:{y:this.isInSmallScreen()?300:p};return(0,l.jsxs)(\"div\",{className:\"nco-table-with-search-bar-table\",children:[(0,l.jsx)(i.Z,{...e,loading:o,size:\"small\",dataSource:m,columns:x,pagination:!1,onChange:this.handleTableChange,rowSelection:s||null,rowKey:e=>e.id,bordered:!1,showSorterTooltip:!1,scroll:w,expandable:c||u?{expandedRowKeys:this.state.expandedRowKeys,expandedRowRender:e=>c&&c(e),rowExpandable:e=>!d||d(e),onExpand:(e,t)=>{e?(u&&u(e,t),this.setState({expandedRowKeys:[t.id]})):this.setState({expandedRowKeys:[]})}}:null}),\"none\"===f?\"\":(0,l.jsx)(r.Z,{size:\"small\",total:g,current:v,pageSize:y,showSizeChanger:!0,showTotal:this.showTotal,pageSizeOptions:[\"10\",\"20\",\"30\",\"50\",\"100\"],onChange:this.onChangePage})]})}}d.defaultProps={tableComponentProps:{}};const p=(0,a.ZP)(d)},83784:(e,t,n)=>{\"use strict\";n.d(t,{f:()=>r,u:()=>i});const r=\"NCOCOMLIBMANAGEMENT/START_LOADING\",i=\"NCOCOMLIBMANAGEMENT/FINISH_LOADING\"},78677:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>o});var r=n(83784);const i={loading:!1,tableData:(0,n(44184).W_)()},o=(e,t)=>{const n=null!=e?e:i;switch(t.type){case r.f:return{...n,loading:!0};case r.u:return{...n,loading:!1,tableData:t.data};default:return n}}},16236:(e,t,n)=>{\"use strict\";n.d(t,{n:()=>r,z:()=>i});const r=\"NCODEFECTELIMINATION/START_LOADING\",i=\"NCODEFECTELIMINATION/FINISH_LOADING\"},89509:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>o});var r=n(16236);const i={loading:!1,countDefectInfo:{today_finished:0,total_defectConfirm:0,defectConfirm:0,total_defectHandle:0,defectHandle:0,total_finished:0,finished:0,total_today_finished:0}},o=(e,t)=>{const n=null!=e?e:i;switch(t.type){case r.z:return{...n,loading:!1,countDefectInfo:t.payload};case r.n:return{...n,loading:!0};default:return n}}},18906:(e,t,n)=>{\"use strict\";n.d(t,{Mk:()=>r,gT:()=>o,qL:()=>i});const r=\"NCODEFECTFORMTEMPLATE/START_LOADING\",i=\"NCODEFECTFORMTEMPLATE/FINISH_LOADING\",o=\"NCODEFECTFORMTEMPLATE/FINISH_LOADFILE\"},52190:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>o});var r=n(18906);const i={loading:!1,fileData:\"\",amount:0},o=(e,t)=>{const n=null!=e?e:i;switch(t.type){case r.Mk:return{...n,loading:!0};case r.qL:return{...n,loading:!1,amount:t.payload};case r.gT:return{...n,fileData:t.payload};default:return n}}},84908:(e,t,n)=>{\"use strict\";n.d(t,{A:()=>r,Z:()=>i});const r=\"NCODEFECTLIST/START_LOADING\",i=\"NCODEFECTLIST/FINISH_LOADING\"},7910:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>a});var r=n(44184),i=n(84908);const o={loading:!1,sortCondition:{},tableData:(0,r.W_)()},a=(e,t)=>{const n=null!=e?e:o;switch(t.type){case i.A:return{...n,loading:!0};case i.Z:return{...n,loading:!1,tableData:t.payload};default:return n}}},64397:(e,t,n)=>{\"use strict\";n.d(t,{I9:()=>o,QJ:()=>r,w4:()=>i});const r=\"NCODEFECTSELECTDVICE/START_LOADING\",i=\"NCODEFECTSELECTDVICE/FINISH_LOADING\",o=\"NCODEFECTSELECTDVICE/DEVICETYPEDATA_LOADING\"},33262:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>a});var r=n(44184),i=n(64397);const o={loading:!1,sortCondition:{},modalTableData:(0,r.W_)(),deviceTypeData:[]},a=(e,t)=>{const n=null!=e?e:o;switch(t.type){case i.QJ:return{...n,loading:!0};case i.w4:return{...n,loading:!1,modalTableData:t.payload};case i.I9:return{...n,loading:!1,deviceTypeData:t.payload};default:return n}}},30428:(e,t,n)=>{\"use strict\";n.d(t,{T:()=>r,j:()=>i});const r=\"NCODEFECTSELECTUSER/START_LOADING\",i=\"NCODEFECTSELECTUSER/FINISH_LOADING\"},25187:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>a});var r=n(44184),i=n(30428);const o={loading:!1,sortCondition:{},modalTableData:(0,r.W_)()},a=(e,t)=>{const n=null!=e?e:o;switch(t.type){case i.T:return{...n,loading:!0};case i.j:return{...n,loading:!1,modalTableData:t.payload};default:return n}}},7188:(e,t,n)=>{\"use strict\";n.d(t,{A5:()=>i,kI:()=>o,pm:()=>r});const r=\"ncoDefectStatus/START_LOADING\",i=\"ncoDefectStatus/FINISH_LOADING\",o=\"ncoDefectStatus/DEFECT_STATUSING\"},95979:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>a});var r=n(44184),i=n(7188);const o={loading:!1,sortCondition:{},tableData:(0,r.W_)(),countDefectInfo:{today_finished:0,total_defectConfirm:0,defectConfirm:0,total_defectHandle:0,defectHandle:0,total_finished:0,finished:0,total_today_finished:0}},a=(e,t)=>{const n=null!=e?e:o;switch(t.type){case i.pm:return{...n,loading:!0};case i.A5:return{...n,loading:!1,tableData:t.payload};case i.kI:return{...n,countDefectInfo:t.payload};default:return n}}},14652:(e,t,n)=>{\"use strict\";n.d(t,{Gf:()=>i,Pr:()=>c,RV:()=>s,V_:()=>o,YQ:()=>a,jZ:()=>l,lT:()=>r,w8:()=>u});const r=\"NCODIAGNOSISTABLE/START_LOADING\",i=\"NCODIAGNOSISTABLE/FINISH_LOADING\",o=\"NCODIAGNOSISTABLE/TASK_SCAN\",a=\"NCODIAGNOSISTABLE/START_LOADING_DETAILS\",s=\"NCODIAGNOSISTABLE/FINISH_LOAD_DETAILS\",l=\"NCODIAGNOSISTABLE/TASK_STATIONS\",c=\"NCODIAGNOSISTABLE/FAULT_REASON\",u=\"NCOPVTABLE/SUPPORT_TRADING_AREA_LOAD\"},79417:(e,t,n)=>{\"use strict\";n.d(t,{gy:()=>s,hy:()=>o,q6:()=>r,xd:()=>i,xr:()=>a});const r=\"DETAIL/START_LOADING\",i=\"DETAIL/FINISH_LOADING\",o=\"DETAIL/IVCHART_COMPARE_DATA\",a=\"DETAIL/IVCHART_DATA\",s=\"DETAIL/BASIC_INFO\"},80851:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>o});var r=n(79417);const i={loading:!1,errorDetailList:{list:[],total:0,page:1,pageSize:10},ivChartCompareData:[],basicInfo:{},ivChartData:{}},o=(e,t)=>{const n=null!=e?e:i;switch(t.type){case r.q6:return{...n,loading:!0};case r.xd:return{...n,loading:!1,errorDetailList:t.data};case r.hy:return{...n,ivChartCompareData:t.data};case r.gy:return{...n,basicInfo:t.data};case r.xr:return{...n,ivChartData:t.data};default:return n}}},15680:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>a});var r=n(14652),i=n(44184);const o={loading:!1,detailLoading:!1,scanLoading:!1,sortCondition:{},scanTaskIds:null,taskStations:[],tableData:(0,i.W_)(),detailTableData:(0,i.W_)(),failReason:{reson:\"\",advise:\"\"},supportTradingAreaInfo:{}},a=(e,t)=>{const n=null!=e?e:o;switch(t.type){case r.lT:return{...n,loading:!0};case r.Gf:return{...n,loading:!1,tableData:t.payload};case r.V_:return{...n,scanTaskIds:t.ids};case r.YQ:return{...n,detailLoading:!0};case r.RV:return{...n,detailLoading:!1,detailTableData:t.payload};case r.jZ:return{...n,taskStations:t.data};case r.Pr:return{...n,failReason:t.data};case r.w8:return{...n,supportTradingAreaInfo:t.payload};default:return n}}},67394:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>q});var r=n(23774),i=n(93706),o=n(45258),a=n(62073),s=n(41541),l=n(10623),c=n(5776),u=n(83862),d=n(59516),p=n(30686),f=n(83806),h=n(56155),m=n(51523),g=n.n(m),v=n(88391),y=n(78939),b=n(49453),S=n(80770),x=n(85397),w=n(55751),C=n(34428),T=n(41006),A=n(29266),E=n(92252),O=n(37920),M=n.n(O),P=n(27051),D=n(82508),I=n(5682),N=n(54076),_=(n(13528),n(10749)),j=n(23712);const{updateTableSubject:k}=_.Z,{Option:L}=E.Z,{TextArea:R}=a.Z,{RangePicker:Z}=u.Z,{neteco:B}=window,F=(0,v.memo)((e=>{let{intl:t,setReloadTable:n,tableDataReserved:r,taskId:i,hideModel:o,editDataModal:c}=e;const{list:u}=r,d=u.find((e=>e.id===i)),{cleanStatus:p,envType:f,emailActive:h,taskName:m,periodMonth:g,emailLan:y,emailSubject:b,email:x,id:w,inverterDns:O,stationDn:_,taskType:L,beginTime:F,endTime:z,unit:V,detector:H}=d,[U,G]=(0,v.useState)(f),[Y,W]=(0,v.useState)(\"2\"),[K,q]=(0,v.useState)(!0),[Q,X]=(0,v.useState)([]),[J,$]=(0,v.useState)(!1),[ee,te]=(0,v.useState)(!1),[ne,re]=(0,v.useState)(!0),{status:ie}=(0,N.Z)(),[oe]=A.Z.useForm(),ae=((0,v.useMemo)((()=>ie?450:600),[ie]),(e,t)=>{switch(e){case\"isPredicted\":G(t.target.value);break;case\"actionWay\":W(t.target.value);break;case\"sendWay\":q(t.target.checked);break;case\"emailCheck\":$(t.target.checked),oe.setFieldsValue({emailSubject:\"\",emailLan:\"\",email:\"\"});break;case\"parameters\":re(t.target.checked)}}),se={required:!0,whitespace:!0,message:t.formatMessage({id:\"common.message.notEmpty\"})},le=e=>{let n;return\"taskName\"===e&&(n=128),\"detector\"===e&&(n=32),\"unit\"===e&&(n=80),{max:n,message:t.formatMessage({id:\"neteco.pvms.validator.maxlength\"},{0:128})}},ce={validator(e,n,r){n.length===n.replace(/['|<|>|/|,|&|\\\"|{|}|\\\\||\\\\\\\\]/g,\"\").length&&\"null\"!==n?r():r(t.formatMessage({id:\"neteco.pvms.validator.specialChars\"}))}},ue={validator(e,n,r){!n||n.length>0&&n.length===n.replace(/['|<|>|/|,|&|\\\"|{|}|\\\\||\\\\\\\\]/g,\"\").length&&\"null\"!==n?r():r(t.formatMessage({id:\"neteco.pvms.validator.specialChars\"}))}};return(0,v.useEffect)((()=>{P.Z.init().then((e=>X(e)))}),[]),(0,v.useEffect)((()=>{$(h)}),[h]),(0,v.useEffect)((()=>{!0===f&&G(!0)}),[c]),(0,j.jsx)(\"div\",{className:\"reserved-task-edit\",children:(0,j.jsx)(\"div\",{className:\"task-edit-content\",children:(0,j.jsxs)(A.Z,{form:oe,onFinish:()=>{te(!0),oe.validateFields().then((e=>{const{cleanStatus:r,envType:i}=e,a=i?{}:{radiation:1e3,temperature:25};(0,D.gH)({...e,...a,stationDn:_,inverterDns:O,cleanStatus:Boolean(r),envType:Boolean(i),emailActive:J,id:w}).then((e=>{const{success:r,params:i,failCode:a,data:s}=e;te(!1),r?((0,S.Sb)(t.formatMessage({id:\"neteco.pvms.alarmModel.modifySucced\"}),null,t),o(\"editData\"),k.next()):(i&&\"1\"===i[0]&&n(!0),(0,I.l)(t,i,a,s,I.UA.MODIFY))}))}))},children:[(0,j.jsxs)(\"div\",{className:\"form-title\",style:{paddingBottom:\"0.5rem\"},children:[(0,j.jsx)(\"span\",{className:\"form-icon\",children:\"*\"}),t.formatMessage({id:\"neteco.pvms.systemSetting.amendment.taskName\"})]}),(0,j.jsx)(A.Z.Item,{name:\"taskName\",initialValue:B.util.iUnescape(B.util.iUnescape(m)),rules:[se,le(\"taskName\"),ce],children:(0,j.jsx)(a.Z,{maxLength:100})}),(0,j.jsx)(A.Z.Item,{name:\"cleanStatus\",hidden:!0,initialValue:p,children:(0,j.jsxs)(T.ZP.Group,{defaultValue:p,children:[(0,j.jsx)(T.ZP,{value:!0,children:t.formatMessage({id:\"neteco.pvms.ivcurve.cleanStyle.1\"})}),(0,j.jsx)(T.ZP,{value:!1,children:t.formatMessage({id:\"neteco.pvms.ivcurve.cleanStyle.2\"})})]})}),(0,j.jsxs)(\"div\",{className:\"form-title\",children:[(0,j.jsx)(\"span\",{className:\"form-icon\",children:\"*\"}),t.formatMessage({id:\"neteco.pvms.ivcurve.environmentPars\"})]}),(0,j.jsx)(\"div\",{className:\"envParam-content\",children:(0,j.jsx)(A.Z.Item,{name:\"envType\",initialValue:f,children:(0,j.jsxs)(T.ZP.Group,{onChange:e=>ae(\"isPredicted\",e),defaultValue:f,value:U,children:[(0,j.jsx)(T.ZP,{value:!0,children:t.formatMessage({id:\"neteco.pvms.ivcurve.environMentParams.1\"})}),(0,j.jsx)(T.ZP,{value:!1,children:t.formatMessage({id:\"neteco.pvms.ivcurve.environMentParams.2\"})})]})})}),(0,j.jsx)(\"div\",{className:\"form-title\",children:t.formatMessage({id:\"neteco.pvms.ivcurve.exeMode\"})}),(0,j.jsxs)(\"div\",{className:\"actionWay-content\",children:[(0,j.jsx)(A.Z.Item,{name:\"taskType\",children:(0,j.jsxs)(T.ZP.Group,{value:Y,defaultValue:L,disabled:!0,children:[(0,j.jsx)(T.ZP,{value:\"1\",children:t.formatMessage({id:\"neteco.pvms.ivcurve.exeMode.2\"})}),(0,j.jsx)(T.ZP,{value:\"0\",children:t.formatMessage({id:\"neteco.pvms.ivcurve.exeMode.3\"})}),(0,j.jsx)(T.ZP,{value:\"2\",children:t.formatMessage({id:\"neteco.pvms.ivcurve.exeMode.1\"})})]})}),\"1\"===L&&(0,j.jsx)(\"div\",{className:\"time-content\",children:(0,j.jsx)(A.Z.Item,{name:\"exeTime\",children:(0,j.jsx)(Z,{format:\"YYYY-MM-DD HH:mm\",style:{width:\"100%\"},disabled:!0,defaultValue:F&&z?[M()(F),M()(z)]:[]})})}),\"0\"===L&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(\"div\",{className:\"form-title\",children:t.formatMessage({id:\"neteco.pvms.ivcurve.executionInterval\"})}),(0,j.jsx)(\"div\",{className:\"time-content\",children:(0,j.jsx)(A.Z.Item,{name:\"periodMonth\",children:(0,j.jsx)(E.Z,{placeholder:t.formatMessage({id:\"neteco.pvms.ivcurve.datepicker.2\"}),style:{width:\"8rem\"},disabled:!0,defaultValue:g})})})]})]}),(0,j.jsx)(\"div\",{className:\"form-title\",children:(0,j.jsxs)(l.Z,{className:\"email-title-con\",children:[(0,j.jsx)(A.Z.Item,{name:\"emailActive\",children:(0,j.jsx)(C.Z,{defaultChecked:h,onChange:e=>ae(\"emailCheck\",e)})}),(0,j.jsxs)(\"div\",{children:[t.formatMessage({id:\"neteco.pvms.ivcurve.autoEmail\"}),(0,j.jsx)(\"span\",{className:\"form-title-ext\",children:t.formatMessage({id:\"neteco.pvms.ivcurve.autoEmail.tips\"})})]})]})}),(0,j.jsx)(A.Z.Item,{name:\"emailSubject\",initialValue:B.util.iUnescape(B.util.iUnescape(b)),rules:[{required:!!J,message:\"\"},J?le(\"taskName\"):\"\",J?ce:\"\"],children:(0,j.jsx)(a.Z,{placeholder:t.formatMessage({id:\"neteco.pvms.partials.main.rm.dayCapPrpfit.subject\"}),disabled:!J})}),(0,j.jsx)(A.Z.Item,{name:\"emailLan\",initialValue:y,rules:[{required:!!J,message:\"\"}],children:(0,j.jsx)(E.Z,{placeholder:t.formatMessage({id:\"neteco.pvms.alarmPush.mailLang\"}),disabled:!J,options:Q})}),(0,j.jsx)(A.Z.Item,{name:\"email\",initialValue:x,rules:[{validator:(e,n,r)=>{const i=/^[A-Za-z\\d]+([-_.][A-Za-z\\d]+)*@([A-Za-z\\d]+[-.])+[A-Za-z\\d]{2,14}$/;if(J){if(n){const e=n.split(\";\");let o=\"\";e.forEach((e=>{i.test(e)||\"\"===e||(o=`${o+e}, `)})),o&&r(t.formatMessage({id:\"neteco.pvms.systemSetting.notEmail\"}))}else r(\"\");r()}else r()}}],children:(0,j.jsx)(R,{maxLength:500,placeholder:t.formatMessage({id:\"neteco.pvms.partials.main.rm.dayCapPrpfit.mailTip\"}),style:{resize:\"none\"},rows:4,disabled:!J})}),(0,j.jsxs)(\"div\",{className:\"other-parameters\",children:[(0,j.jsx)(\"div\",{className:\"other-parameters-checkbox\",children:(0,j.jsx)(A.Z.Item,{name:\"otherParameters\",children:(0,j.jsx)(\"div\",{className:\"form-title\",children:t.formatMessage({id:\"neteco.pvms.ivcurve.newTask.otherParams\"})})})}),(0,j.jsx)(A.Z.Item,{labelCol:{span:6},name:\"detector\",initialValue:B.util.iUnescape(B.util.iUnescape(H)),label:t.formatMessage({id:\"neteco.pvms.ivcurve.newTask.detector\"}),rules:[le(\"detector\"),ue],children:(0,j.jsx)(a.Z,{disabled:!ne})}),(0,j.jsx)(A.Z.Item,{labelCol:{span:6},name:\"unit\",label:t.formatMessage({id:\"neteco.pvms.ivcurve.newTask.unit\"}),initialValue:B.util.iUnescape(B.util.iUnescape(V)),rules:[le(\"unit\"),ue],children:(0,j.jsx)(a.Z,{disabled:!ne})})]}),(0,j.jsx)(\"div\",{className:\"button-bottom\",children:(0,j.jsx)(A.Z.Item,{children:(0,j.jsx)(s.Z,{type:\"primary\",htmlType:\"submit\",loading:ee,children:t.formatMessage({id:\"common.button.set\"})})})})]})})})})),z=(0,i.ZP)(F),{updateTableSubject:V}=_.Z,{RangePicker:H}=u.Z,{neteco:U}=window;class G extends v.Component{constructor(e){super(e),this.openTaskCreateModal=()=>{const{history:e}=this.props;e.push(\"/operation/intelligentDiagnosis/createDiagnosisTask\")},this.hideModel=(e,t)=>{switch(e){case\"createTask\":this.setState({showTaskCreateModal:!1});break;case\"editData\":this.setState({editDataModal:!1})}},this.switchStatus=e=>{const{intl:t}=this.props;this.setState({statusLoading:!0}),(0,b.v_)(`/rest/pvms/web/ivcurve/v1/task/onoff?id=${e.id}&status=${!e.taskStatus}`).then((e=>{V.next(),e.success?(0,S.Sb)(t.formatMessage({id:\"common.message.success\"}),null,t):(0,S.jT)(t.formatMessage({id:\"common.message.failure\"}),t),e.success,this.setState({statusLoading:!1})})).catch((e=>{(0,S.jT)(t.formatMessage({id:\"common.message.failure\"}),null,t),this.setState({statusLoading:!1})}))},this.editData=e=>{this.setState({editDataModal:!0,taskId:e})},this.delete=e=>{const{intl:t}=this.props;(0,S.ST)(t.formatMessage({id:\"neteco.pvms.systemSetting.amendment.delConfirm\"}),(()=>{(0,b.IV)(`/rest/pvms/web/ivcurve/v1/task/appointments?id=${e}`).then((e=>{V.next(),e.success?(0,S.Sb)(t.formatMessage({id:\"neteco.pvms.alarmTemp.deleteSuccess\"}),null,t):(0,S.jT)(t.formatMessage({id:\"neteco.pvms.alarmTemp.deleteError\"}),t)}))}),null,t)},this.replaceEmails=e=>{let t=e.email?e.email:\"\";return(t&&t.split(\";\")||[]).map((e=>{let t=e;if(!e)return t;t=e=e.trim();const n=e.split(\"@\");return n.length>1&&(n[0].length>3?t=n[0].substr(0,3)+\"***\"+n[0].substr(n[0].length):n[0].length>0&&(t=n[0].substr(0,1)+\"***\"),t+=\"@\"+n[1]),t})).join(\";\")},this.setTableHeight=()=>{g()((()=>{const e=(0,w.h)(\"#taskContainer\",300)||532;this.setState({tableHeight:e})}),300)()},this.getColumns=()=>{const{intl:e}=this.props,{statusLoading:t}=this.state;return[{title:e.formatMessage({id:\"neteco.pvms.inspect.task.taskName\"}),dataIndex:\"taskName\",key:\"taskName\",width:\"15%\",ellipsis:!0,render:e=>U.util.iUnescape(U.util.iUnescape(e))},{title:e.formatMessage({id:\"ncoEnergyStorageTable.column.site\"}),dataIndex:\"stationName\",key:\"stationName\",width:\"15%\",ellipsis:!0,render:e=>U.util.iUnescape(U.util.iUnescape(e))},{title:e.formatMessage({id:\"ncoHomeSiteList.columns.siteStatus\"}),dataIndex:\"taskStatus\",key:\"taskStatus\",width:\"10%\",render:t=>(0,j.jsx)(\"div\",{className:\"reserved-table-status\",children:t?(0,j.jsxs)(\"p\",{children:[(0,j.jsx)(\"span\",{style:{backgroundColor:\"#41ba41\"}}),e.formatMessage({id:\"neteco.pvms.communicatPoint.enable\"})]}):(0,j.jsxs)(\"p\",{children:[(0,j.jsx)(\"span\",{style:{backgroundColor:\"#2997ff\"}}),e.formatMessage({id:\"neteco.pvms.communicatPoint.forbidden\"})]})})},{title:e.formatMessage({id:\"neteco.pvms.ivcurve.nextExecutionTime\"}),dataIndex:\"beginTime\",key:\"beginTime\",width:\"15%\",ellipsis:!0,render:e=>e?(0,x.TD)(e).substring(0,10):\"--\"},{title:e.formatMessage({id:\"neteco.pvms.ivcurve.singleOrPeriod\"}),dataIndex:\"taskType\",key:\"taskType\",width:\"10%\",render:t=>(0,j.jsx)(\"div\",{children:\"1\"===t?e.formatMessage({id:\"neteco.pvms.ivcurve.singleTime\"}):e.formatMessage({id:\"neteco.pvms.ivcurve.period\"})})},{title:e.formatMessage({id:\"neteco.pvms.systemSetting.tmail\"}),dataIndex:\"email\",key:\"email\",width:\"15%\",ellipsis:!0,render:(e,t)=>e?this.replaceEmails(t):\"\"},{title:e.formatMessage({id:\"neteco.pvms.devUpgrade.devOperate\"}),dataIndex:\"taskStatus\",key:\"operator\",width:\"200px\",render:(n,r)=>(0,j.jsxs)(l.Z,{align:\"center\",children:[(0,d.emJ)(d.uP)&&(0,j.jsx)(c.Z,{defaultChecked:n,size:\"small\",onChange:()=>this.switchStatus(r),checked:n,loading:t,style:{marginTop:-3},title:n?e.formatMessage({id:\"neteco.pvms.communicatPoint.forbidden\"}):e.formatMessage({id:\"neteco.pvms.communicatPoint.enable\"})}),(0,d.emJ)(d.uP)&&(0,j.jsx)(f.Z,{onClick:()=>this.editData(r.id),title:e.formatMessage({id:\"common.button.modify\"})}),(0,d.emJ)(d.cCe)&&(0,j.jsx)(h.Z,{onClick:()=>this.delete(r.id),title:e.formatMessage({id:\"common.button.delete\"})})]})}]},this.state={showTaskCreateModal:!1,editDataModal:!1,statusLoading:!1,taskId:{},tableHeight:532}}componentDidMount(){this.setTableHeight(),window.addEventListener(\"resize\",this.setTableHeight)}componentWillUnmount(){window.removeEventListener(\"resize\",this.setTableHeight)}render(){const{intl:e,loading:t,tableDataReserved:n,loadReservedTable:r,history:i}=this.props,{editDataModal:l,taskId:c}=this.state,u=[{formItems:(0,d.emJ)(d.ePr)&&(0,j.jsx)(s.Z,{type:\"primary\",onClick:this.openTaskCreateModal,children:(0,j.jsx)(y.Z,{id:\"neteco.pvms.ivcurve.add_new_task\"})},\"createTask\")}],f=this.getColumns();return(0,j.jsxs)(\"div\",{className:\"iv-reserved-table\",children:[(0,j.jsx)(\"div\",{className:\"iv-reserved-list\",children:(0,j.jsx)(p.Z,{searchConfigs:{searchCondition:{taskName:\"\",startTime:\"\",endTime:\"\"},initialValues:{},formItems:[{key:\"taskName\",label:(0,j.jsx)(y.Z,{id:\"neteco.pvms.systemSetting.amendment.taskName\"}),options:{},component:(0,j.jsx)(a.Z,{style:{width:\"8rem\"}})},{key:\"selectTime\",label:(0,j.jsx)(y.Z,{id:\"neteco.pvms.ivcurve.label.4\"}),options:{},component:(0,j.jsx)(H,{style:{width:\"18rem\"}})}]},customToolbarButtons:u,tableConfigs:{loading:t,columns:f,scroll:this.state.tableHeight,tableData:n,loadTableData:r}})}),(0,j.jsx)(o.Z,{title:e.formatMessage({id:\"neteco.pvms.ivcurve.taskEdit\"}),visible:l,centered:!0,onCancel:e=>this.hideModel(\"editData\",e),destroyOnClose:!0,footer:null,width:\"40rem\",children:(0,j.jsx)(z,{tableDataReserved:n,taskId:c,history:i,hideModel:this.hideModel,editDataModal:l})})]})}}const Y=(0,i.ZP)(G);var W=n(75339);const K=e=>({type:W.u,payload:e}),q=(0,r.$j)((e=>({loading:e.ncoReservedTable.loading,tableDataReserved:e.ncoReservedTable.tableDataReserved})),(e=>({loadReservedTable:t=>{(async(e,t)=>{e({type:W.w});const n=t.selectTime?t.selectTime.map(((e,t)=>0===t?M()(e).startOf(\"day\").valueOf():M()(e).endOf(\"day\").valueOf())):[];t.startTime=n[0]||0,t.endTime=n[1]||0,delete t.selectTime,await(0,b.U2)(\"/rest/pvms/web/ivcurve/v1/task/appointments\",{...t}).then((n=>{if(n&&n.success&&n.data){const{tasks:r,total:i}=n.data;e(K({list:r,total:i,page:t.page,pageSize:t.pageSize}))}else e(K({list:[],total:0,page:1,pageSize:10}))}))})(e,t)}})))((0,i.ZP)(Y))},75339:(e,t,n)=>{\"use strict\";n.d(t,{u:()=>i,w:()=>r});const r=\"NCORESERVEDTABLE/START_LOADING\",i=\"NCORESERVEDTABLE/FINISH_LOADING\"},5682:(e,t,n)=>{\"use strict\";n.d(t,{Nn:()=>l,UA:()=>o,l:()=>s});var r=n(45258),i=n(31251);const o={NEW:1,RESTART:2,MODIFY:3},a=(e,t)=>{switch(t){case o.NEW:r.Z.error({title:e.formatMessage({id:\"neteco.pvms.info\"}),content:e.formatMessage({id:\"neteco.pvms.devSupplement.createFailed\"}),centered:!0});break;case o.MODIFY:r.Z.error({title:e.formatMessage({id:\"neteco.pvms.info\"}),content:e.formatMessage({id:\"neteco.pvms.login.modifyFailed\"}),centered:!0});break;default:r.Z.error({title:e.formatMessage({id:\"neteco.pvms.info\"}),content:e.formatMessage({id:\"common.message.failure\"}),centered:!0})}},s=(e,t,n,o,s)=>{t?\"1\"===t[0]?r.Z.info({title:e.formatMessage({id:\"neteco.pvms.info\"}),content:e.formatMessage({id:\"neteco.pvms.ivcurve.checkDevInfoFail\"}),centered:!0}):\"2\"===t[0]?r.Z.info({title:e.formatMessage({id:\"neteco.pvms.info\"}),content:e.formatMessage({id:\"neteco.pvms.ivcurve.checkDevInfo.new\"}),centered:!0}):\"3\"===t[0]?r.Z.info({title:e.formatMessage({id:\"neteco.pvms.info\"}),content:e.formatMessage({id:\"neteco.pvms.ivcurve.isScaning\"}),centered:!0}):\"4\"===t[0]?r.Z.error({title:e.formatMessage({id:\"neteco.pvms.info\"}),content:e.formatMessage({id:\"neteco.pvms.ivcurve.userDnFailed\"}),centered:!0}):\"9\"===t[0]?r.Z.error({title:e.formatMessage({id:\"neteco.pvms.info\"}),content:e.formatMessage({id:\"neteco.pvms.ivcurve.getDataFailed\"}),centered:!0}):-1===n?r.Z.error({title:e.formatMessage({id:\"neteco.pvms.info\"}),content:i.MJ?e.formatMessage({id:\"ncoAddSubjectReportForm.form.companyMailInvalid\"}):e.formatMessage({id:\"ncoAddSubjectReportForm.form.remoteMailInvalid\"}),centered:!0}):-4===n&&\"5\"===o?r.Z.info({title:e.formatMessage({id:\"neteco.pvms.info\"}),content:e.formatMessage({id:\"neteco.pvms.ivcurve.maxTaskNum\"}),centered:!0}):-6===n?r.Z.info({title:e.formatMessage({id:\"neteco.pvms.info\"}),content:e.formatMessage({id:\"neteco.pvms.ivcurve.maxStationTaskNum\"}),centered:!0}):a(e,s):a(e,s)},l=e=>{let t=\"pvmsext.exception.ivcurve.report.innerError\";switch(e){case-1:t=i.MJ?\"ncoAddSubjectReportForm.form.companyMailInvalid\":\"ncoAddSubjectReportForm.form.remoteMailInvalid\";break;case 1:t=\"neteco.pvms.ivcurve.checkDevInfoFail\";break;case 2:t=\"neteco.pvms.ivcurve.checkDevInfo\";break;case 3:t=\"neteco.pvms.ivcurve.isScaning\";break;case 4:t=\"neteco.pvms.ivcurve.userDnFailed\";break;case 9:t=\"neteco.pvms.ivcurve.getDataFailed\"}return t}},16440:(e,t,n)=>{\"use strict\";n.d(t,{Nd:()=>i,V_:()=>o,jO:()=>r});const r=\"NCOEXPORTMANAGEMENT/START_LOADING\",i=\"NCOEXPORTMANAGEMENT/FINISH_LOADING\",o=\"NCOEXPORTMANAGEMENT/TASK_SCAN\"},22540:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>o});var r=n(16440);const i={loading:!1,scanTaskIds:null,tableData:(0,n(44184).W_)()},o=(e,t)=>{let n=e||i;switch(t.type){case r.jO:return{...n,loading:!0};case r.Nd:return{...n,loading:!1,tableData:t.payload};case r.V_:return{...n,scanTaskIds:t.ids};default:return n}}},54418:(e,t,n)=>{\"use strict\";n.d(t,{G:()=>i,X:()=>r});const r=\"NCOTASKMANAGEMENT/START_LOADING\",i=\"NCOTASKMANAGEMENT/FINISH_LOADING\"},19505:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>o});var r=n(54418);const i={loading:!1,amount:0},o=(e,t)=>{const n=null!=e?e:i;switch(t.type){case r.X:return{...n,loading:!0};case r.G:return{...n,loading:!1,amount:t.payload};default:return n}}},36546:(e,t,n)=>{\"use strict\";n.d(t,{I3:()=>l,KV:()=>d,Lv:()=>o,eN:()=>u,o1:()=>a,uG:()=>s}),n(88391);var r=n(23712);const{neteco:i}=window,o=3e3,a=\"1\",s=\"450\",l=\"600\",c=(e,t)=>({0:t.formatMessage({id:\"neteco.pvms.systemSetting.devLicense.licenseState.1\"}),1:t.formatMessage({id:\"neteco.pvms.systemSetting.devLicense.licenseState.2\"}),2:t.formatMessage({id:\"neteco.pvms.systemSetting.devLicense.licenseState.3\"}),3:t.formatMessage({id:\"neteco.pvms.systemSetting.devLicense.licenseState.4\"}),4:t.formatMessage({id:\"neteco.pvms.systemSetting.devLicense.licenseState.5\"}),5:t.formatMessage({id:\"neteco.pvms.systemSetting.devLicense.licenseState.6\"}),\"-1\":\"/\",\"-2\":t.formatMessage({id:\"neteco.pvms.systemSetting.devLicense.licenseState.7\"})}[e]),u=e=>[{label:e.formatMessage({id:\"neteco.pvms.systemSetting.devLicense.licenseState.1\"}),value:0},{label:e.formatMessage({id:\"neteco.pvms.systemSetting.devLicense.licenseState.2\"}),value:1},{label:e.formatMessage({id:\"neteco.pvms.systemSetting.devLicense.licenseState.3\"}),value:2},{label:e.formatMessage({id:\"neteco.pvms.systemSetting.devLicense.licenseState.4\"}),value:3},{label:e.formatMessage({id:\"neteco.pvms.systemSetting.devLicense.licenseState.5\"}),value:4},{label:e.formatMessage({id:\"neteco.pvms.systemSetting.devLicense.licenseState.6\"}),value:5},{label:e.formatMessage({id:\"neteco.pvms.systemSetting.devLicense.licenseState.7\"}),value:6}],d=(e,t)=>[{title:t.formatMessage({id:\"ncoEnergyStorageTable.column.device\"}),dataIndex:\"inverterName\",key:\"inverterName\",align:\"center\",width:\"20%\",ellipsis:!0,render:e=>i.util.iUnescape(i.util.iUnescape(e))},{title:t.formatMessage({id:\"ncoPvTable.column.deviceType\"}),dataIndex:\"inverterType\",key:\"inverterType\",align:\"center\",ellipsis:!0,render:e=>e?t.formatMessage({id:\"neteco.pvms.ivcurve.MPPT\"}):t.formatMessage({id:\"neteco.pvms.devTypeLangKey.inverter\"})},{title:t.formatMessage({id:\"neteco.pvms.partials.main.column.deviceVersion\"}),dataIndex:\"typeName\",key:\"typeName\",align:\"center\",width:\"20%\",ellipsis:!0},{title:t.formatMessage({id:\"neteco.pvms.systemSetting.devLicense.colums.devSN\"}),dataIndex:\"sn\",key:\"sn\",align:\"center\",width:\"20%\",ellipsis:!0},{title:t.formatMessage({id:\"neteco.pvms.partials.main.dm.communicateDevName\"}),dataIndex:\"communicatorName\",key:\"communicatorName\",align:\"center\",ellipsis:!0,render:e=>i.util.iUnescape(i.util.iUnescape(e))},{title:t.formatMessage({id:\"ncoEnergyStorageTable.column.site\"}),dataIndex:\"stationName\",key:\"stationName\",align:\"center\",ellipsis:!0,render:e=>i.util.iUnescape(i.util.iUnescape(e))},{title:t.formatMessage({id:\"neteco.pvms.systemSetting.devLicense.colums.licenseState\"}),dataIndex:\"licenseStatus\",key:\"licenseStatus\",align:\"center\",width:\"10%\",ellipsis:!0,render:e=>1!==e&&2!==e&&-2!==e?(0,r.jsx)(\"span\",{title:t.formatMessage({id:\"neteco.pvms.systemSetting.devLicense.licenseState.abnormalHint.1\"}),style:{color:\"red\"},children:c(e,t)}):(0,r.jsx)(\"span\",{title:c(e,t),style:{color:\"black\"},children:c(e,t)})},{title:t.formatMessage({id:\"neteco.pvms.partials.main.dm.devStringDetail.manufacturer\"}),dataIndex:\"manufacturer\",key:\"manufacturer\",align:\"center\",ellipsis:!0,render:e=>e.join(\";\")},{title:t.formatMessage({id:\"neteco.pvms.partials.main.dm.devStringDetail.moduleVersion\"}),dataIndex:\"moduleVersion\",key:\"moduleVersion\",align:\"center\",ellipsis:!0,render:e=>i.util.iUnescape(i.util.iUnescape(e[0]))},{title:t.formatMessage({id:\"neteco.pvms.partials.main.dm.devStringDetail.moduleType\"}),dataIndex:\"moduleType\",key:\"moduleType\",align:\"center\",ellipsis:!0,render:e=>((e,t)=>{const n={1:t.formatMessage({id:\"neteco.pvms.partials.main.dm.devStringDetail.moduleTyps.1\"}),2:t.formatMessage({id:\"neteco.pvms.partials.main.dm.devStringDetail.moduleTyps.2\"}),3:t.formatMessage({id:\"neteco.pvms.partials.main.dm.devStringDetail.moduleTyps.3\"}),4:t.formatMessage({id:\"neteco.pvms.partials.main.dm.devStringDetail.moduleTyps.4\"}),5:t.formatMessage({id:\"neteco.pvms.partials.main.dm.devStringDetail.moduleTyps.5\"})};return e.map((e=>n[e]))})(e,t).join(\";\")},{title:t.formatMessage({id:\"neteco.pvms.ivcurve.InverterTableProperties.5\"}),dataIndex:\"isConfig\",key:\"isConfig\",align:\"center\",ellipsis:!0,render:e=>e?t.formatMessage({id:\"neteco.pvms.ivcurve.configureStatus.2\"}):t.formatMessage({id:\"neteco.pvms.ivcurve.configureStatus.1\"})}].filter((t=>e.includes(t.key)))},54076:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>a});var r=n(88391),i=n(82508),o=n(36546);function a(){const[e,t]=(0,r.useState)(!1);(0,r.useEffect)((()=>{n()}),[]);const n=async()=>{var e,n;const r=await(0,i.h2)(),a=null!==(e=null==r||null===(n=r.find((e=>\"iv_algorithm_enhancement_enable\"===e.paramName)))||void 0===n?void 0:n.paramValue)&&void 0!==e?e:\"\";t(a===o.o1)};return{status:e,queryAlgrithmEnable:n}}},82508:(e,t,n)=>{\"use strict\";n.d(t,{gH:()=>s,h2:()=>u,me:()=>c,oP:()=>l,tP:()=>a,xO:()=>o});var r=n(49453),i=n(44184);const o=async(e,t)=>{const[n,o]=await(0,i.AM)((0,r.v_)(\"/rest/pvms/web/ivcurve/v1/device/query\",{dnList:[e],deviceType:\"inveter\",isCreatingTask:!0,searchKey:t}));return n||null==o||!o.success?[]:(null==o?void 0:o.data)||[]},a=e=>(0,i.AM)((0,r.v_)(\"/rest/pvms/web/ivcurve/v1/task/appointments\",e)),s=e=>(0,r.gz)(\"/rest/pvms/web/ivcurve/v1/task/appointments\",e),l=()=>(0,r.Sg)(\"/rest/pvms/web/company/v1/checkemail\"),c=async e=>{var t;const[n,o]=await(0,i.AM)((0,r.v_)(\"/rest/pvms/web/ivcurve/v1/flow/choose-device\",e));if(n||null==o||!o.success)return[];const{neteco:a}=window;return(null===(t=o.data.inverterData)||void 0===t?void 0:t.map((e=>{let t=[];return(0,i.xb)(e.manufacturer)||(t=[a.util.iUnescape(a.util.iUnescape(e.manufacturer[0]))]),{...e,id:e.dn,manufacturer:t}})))||[]},u=async()=>{var e;const[,t]=await(0,i.AM)((0,r.U2)(\"/rest/pvms/web/management/v1/config/get_management_item\",{}));return null!==(e=null==t?void 0:t.data)&&void 0!==e?e:[]}},1875:(e,t,n)=>{\"use strict\";n.d(t,{s:()=>r,t:()=>i});const r=\"NEWTASKDEVICESELECTOR/START_LOADING\",i=\"NEWTASKDEVICESELECTOR/FINISH_LOADING\"},36069:(e,t,n)=>{\"use strict\";n.d(t,{Zv:()=>i,uJ:()=>o,z9:()=>r});const r=\"NCOPATRORIGHTACTION/START_LOADING\",i=\"NCOPATRORIGHTACTION/FINISH_LOADING\",o=\"NCOPATRORIGHTACTION/IMG_NODEING\"},55271:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>o}),n(37920);var r=n(36069);const i={loading:!1,sortCondition:{},nodeImage:\"\"},o=(e,t)=>{const n=null!=e?e:i;switch(t.type){case r.z9:return{...n,loading:!0};case r.Zv:return{...n,loading:!1};case r.uJ:return{...n,nodeImage:t.payload};default:return n}}},74827:(e,t,n)=>{\"use strict\";n.d(t,{N:()=>r,t:()=>i});const r=\"NCOPATROLCREATTASK/START_LOADING\",i=\"NCOPATROLCREATTASK/FINISH_LOADING\"},9881:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>a});var r=n(44184),i=n(74827);const o={loading:!1,sortCondition:{},modalTableData:(0,r.W_)()},a=(e,t)=>{const n=null!=e?e:o;switch(t.type){case i.N:return{...n,loading:!0};case i.t:return{...n,loading:!1,modalTableData:t.payload};default:return n}}},8090:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>i});const r={loading:!1,sortCondition:{},tableData:(0,n(44184).W_)()},i=(e,t)=>{const n=null!=e?e:r;return\"NCOPATROLDETAILREPORT/START_LOADING\"===t.type?{...n,loading:!0}:n}},56469:(e,t,n)=>{\"use strict\";n.d(t,{x:()=>i,y:()=>r});const r=\"NCOPATROLGIS/START_LOADING\",i=\"NCOPATROLGIS/FINISH_LOADING\"},36094:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>a});var r=n(44184),i=n(56469);const o={loading:!1,commonConfig:null,mapConfigs:null,hasConfigRight:!1,selectedMap:null,tableData:(0,r.W_)()},a=(e,t)=>{const n=null!=e?e:o;switch(t.type){case i.y:return{...n,loading:!0};case i.x:return{...n,loading:!1,...t.payload};default:return n}}},32241:(e,t,n)=>{\"use strict\";n.d(t,{J:()=>r,O:()=>i});const r=\"NCOPATROLITEMSETTING/START_LOADING\",i=\"NCOPATROLITEMSETTING/FINISH_LOADING\"},85267:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>a});var r=n(44184),i=n(32241);const o={loading:!1,sortCondition:{},modalTableData:(0,r.W_)()},a=(e,t)=>{const n=null!=e?e:o;switch(t.type){case i.J:return{...n,loading:!0};case i.O:return{...n,loading:!1,modalTableData:t.payload};default:return n}}},31530:(e,t,n)=>{\"use strict\";n.d(t,{K:()=>i,T:()=>r});const r=\"NCOPATROLMISSIONDETAILS/START_LOADING\",i=\"NCOPATROLMISSIONDETAILS/FINISH_LOADING\"},35934:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>a});var r=n(44184),i=n(31530);const o={loading:!1,modalTableData:(0,r.W_)()},a=(e,t)=>{const n=null!=e?e:o;switch(t.type){case i.T:return{...n,loading:!0};case i.K:return{...n,loading:!1,modalTableData:t.payload};default:return n}}},94534:(e,t,n)=>{\"use strict\";n.d(t,{lf:()=>r,uJ:()=>o,vU:()=>a,vZ:()=>i});const r=\"NCOPATROLNODESTAFFING/START_LOADING\",i=\"NCOPATROLNODESTAFFING/FINISH_LOADING\",o=\"NCOPATROLNODESTAFFING/IMG_NODEING\",a=\"NCOPATROLNODESTAFFING/TAS_KKEYING\"},69564:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>a});var r=n(44184),i=n(94534);const o={loading:!1,nodeImage:\"\",inspectionButton:[],modalTableData:(0,r.W_)(),taskKey:\"\"},a=(e,t)=>{const n=null!=e?e:o;switch(t.type){case i.lf:return{...n,loading:!0};case i.vZ:return{...n,loading:!0,modalTableData:t.payload};case i.uJ:case i.vU:return{...n,nodeImage:t.payload};default:return n}}},79623:(e,t,n)=>{\"use strict\";n.d(t,{B8:()=>a,Ob:()=>o,ck:()=>i,fu:()=>r,ql:()=>s});const r=\"NCOPATROLPLANTSLIST/START_LOADING\",i=\"NCOPATROLPLANTSLIST/FINISH_LOADING\",o=\"NCOPATROLPLANTSLIST/PLANT_DETAILING\",a=\"NCOPATROLPLANTSLIST/START_LOADING_INSPECT_STATION\",s=\"NCOPATROLPLANTSLIST/FINISH_LOADING_INSPECT_STATION\"},70558:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>a});var r=n(44184),i=n(79623);const o={loading:!1,sortCondition:{},tableData:(0,r.W_)(),modalTableData:(0,r.W_)(),PlantDetail:[]},a=(e,t)=>{const n=null!=e?e:o;switch(t.type){case i.fu:return{...n,loading:!0};case i.ck:return{...n,loading:!1,tableData:t.payload};case i.B8:return{...n,loading:!0};case i.ql:return{...n,loading:!1,modalTableData:t.payload};case i.Ob:return{...n,PlantDetail:t.payload};default:return n}}},43526:(e,t,n)=>{\"use strict\";n.d(t,{B8:()=>o,KK:()=>l,TQ:()=>s,Ue:()=>c,Xc:()=>r,m:()=>d,nZ:()=>i,ql:()=>a,sE:()=>u});const r=\"NCOPATROLTASKLIST/START_LOADING\",i=\"NCOPATROLTASKLIST/FINISH_LOADING\",o=\"NCOPATROLTASKLIST/START_LOADING_INSPECT_STATION\",a=\"NCOPATROLTASKLIST/FINISH_LOADING_INSPECT_STATION\",s=\"NCOPATROLTASKLIST/TASKDETAILING\",l=\"NCOPATROLTASKLIST/START_TASKDETAIL\",c=\"NCOPATROLTASKLIST/TASKDETAILACTIONING\",u=\"NCOPATROLTASKLIST/FINISH_LOADING_SITES\",d=\"NCOPATROLTASKLIST/REPORT_DETAIL\"},57297:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>a});var r=n(44184),i=n(43526);const o={loading:!1,sortCondition:{},tableData:(0,r.W_)(),modalTableData:(0,r.W_)(),detailLoading:!1,TaskDetail:{},TaskActionDetail:{},site:{chilren:[],parentList:[]},reportDetail:null},a=(e,t)=>{const n=null!=e?e:o;switch(t.type){case i.Xc:return{...n,loading:!0};case i.nZ:return{...n,loading:!1,tableData:t.payload};case i.B8:return{...n,loading:!0};case i.ql:return{...n,loading:!1,modalTableData:t.payload};case i.KK:return{...n,detailLoading:!0};case i.TQ:return{...n,detailLoading:!1,TaskDetail:t.payload};case i.Ue:return{...n,TaskActionDetail:t.payload};case i.sE:return{...n,site:t.payload};case i.m:return{...n,reportDetail:t.payload};default:return n}}},45795:(e,t,n)=>{\"use strict\";n.d(t,{D:()=>r,g:()=>i});const r=\"NCOPATROLTYPELAYOUT/START_LOADING\",i=\"NCOPATROLTYPELAYOUT/FINISH_LOADING\"},11703:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>o});var r=n(45795);const i={loading:!1,countDefectInfo:{today_finished:0,total_defectConfirm:0,defectConfirm:0,total_defectHandle:0,defectHandle:0,total_finished:0,finished:0,total_today_finished:0}},o=(e,t)=>{const n=null!=e?e:i;switch(t.type){case r.D:return{...n,loading:!0};case r.g:return{...n,loading:!1,countDefectInfo:t.payload};default:return n}}},90386:(e,t,n)=>{\"use strict\";n.d(t,{AA:()=>r,Bl:()=>a,c0:()=>s,le:()=>i,u0:()=>o,wT:()=>l});const r=\"NCOREALTIMESTATE/START_LOADING\",i=\"NCOREALTIMESTATE/FINISH_ALARM_TABLE_LOAD\",o=\"NCOREALTIMESTATE/ALARM_TABLE_START_LOAD\",a=\"NCOREALTIMESTATE/FINISH_STATION_TABLE_LOAD\",s=\"NCOREALTIMESTATE/FINISH_HEAD_DATA_LOAD\",l=\"NCOREALTIMESTATE/FINISH_ENERGY_ANDPOWER_LOAD\"},62595:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>o});var r=n(90386);const i={loading:!1,alarmLoading:!1,alarmTableData:{alarmList:[],total:0},alarmCardData:{},modalTableData:{stationList:[],total:0,page:1,pageSize:10},realTimeHeaddata:{},energyAndPower:{currentPower:0,todayPower:0}},o=(e,t)=>{const n=null!=e?e:i;switch(t.type){case r.AA:return{...n,loading:!0};case r.le:return{...n,alarmTableData:t.data,alarmLoading:!1};case r.u0:return{...n,alarmLoading:!0};case r.Bl:return{...n,loading:!1,modalTableData:t.data};case r.c0:return{...n,onLineUsers:t.data};case r.wT:return{...n,energyAndPower:t.data};default:return n}}},29034:(e,t,n)=>{\"use strict\";n.d(t,{Dv:()=>a,SY:()=>r,TX:()=>u,fw:()=>s,gm:()=>i,nZ:()=>c,p_:()=>o,yN:()=>l});const r=\"NCOTRACKTABLE/START_LOADING\",i=\"NCOTRACKTABLE/FINISH_LOADING\",o=\"NCOTRACKTABLE/DEVICELIST\",a=\"NCOREMOTEONOFF/DEVNUMDATA\",s=\"NCOREMOTEONOFF/GROUPINFOLIST\",l=\"NCOREMOTEONOFF/DEVINFOLIST\",c=\"NCOREMOTEONOFF/ONOFFLIST\",u=\"NCOREMOTEONOFF/EXECRES\"},93419:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>o});var r=n(29034);const i={loading:!1,BtnLoading:!1,devNumData:{totalDevNum:0,startDevNum:0,connectNormal:0,connectAbnormal:0,stopDevNum:0,startTotalCap:0,stopTotalCap:0},devInfoData:{list:[],total:0,page:1,pageSize:10,stationGroup:[],devName:\"\",nmi:\"\"},groupInfoData:{groupInfoData:[]},onOffData:{stationGroup:[\"all\"],onOff:\"\",batchTaskId:\"\"},execRes:{result:{}}},o=(e,t)=>{const n=null!=e?e:i;switch(t.type){case r.SY:return{...n,loading:!0,BtnLoading:!0};case r.Dv:return{...n,devNumData:t.data};case r.p_:return{...n,deviceData:t.data};case r.fw:return{...n,groupInfoData:t.data};case r.yN:return{...n,devInfoData:t.payload};case r.nZ:return{...n,onOffData:t.payload};case r.TX:return{...n,execRes:t.data};case r.gm:return{...n,loading:!1,BtnLoading:!1};default:return n}}},47419:(e,t,n)=>{\"use strict\";n.d(t,{CE:()=>l,Id:()=>a,Jy:()=>i,h5:()=>s,wX:()=>o,xZ:()=>r});const r=\"NCOEXTSETSTATIONSHAREPOP/START_LOADING\",i=\"NCOEXTSETSTATIONSHAREPOP/FINISH_LOADING\",o=\"NCOEXTSETSTATIONSHAREPOP/QUERY_SET_STATION_KIOSK\",a=\"NCOEXTSETSTATIONSHAREPOP/QUERY_STATION_KIOSK_RANDOM_NUMBER\",s=\"NCOEXTSETSTATIONSHAREPOP/CHANGE_FORM\",l=\"NCOEXTSETSTATIONSHAREPOP/SET_CONFIG_STATUS\"},45363:(e,t,n)=>{\"use strict\";n.d(t,{Q:()=>i,z:()=>r});const r=\"NCOSTRINGSETTING/START_LOADING\",i=\"NCOSTRINGSETTING/FINISH_LOADING\"},29978:(e,t,n)=>{\"use strict\";n.d(t,{i:()=>r,n:()=>i});const r=\"SETTINGCOMFIRM/SET_CONFIRM_LOADINGING\",i=\"SETTINGCOMFIRM/SET_CONFIRM_LOADEDING\"},48457:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>o});var r=n(29978);const i={loading:!1,sortCondition:{},tableData:(0,n(44184).W_)()},o=(e,t)=>{const n=null!=e?e:i;switch(t.type){case r.i:return{...n,loading:!0};case r.n:return{...n,loading:!1,tableData:t.payload};default:return n}}},82584:(e,t,n)=>{\"use strict\";n.d(t,{I:()=>r,T:()=>i});const r=\"NCOSTRINGSELECTOR/START_LOADING\",i=\"NCOSTRINGSELECTOR/FINISH_LOADING\"},42069:(e,t,n)=>{\"use strict\";n.d(t,{Mb:()=>r,T_:()=>i,lK:()=>o});const r=\"NCOOPINIONCONTAINER/START_LOADING\",i=\"NCOOPINIONCONTAINER/FINISH_LOADING\",o=\"NCOOPINIONCONTAINER/CHANGE_EXPORT_LOADING\"},37333:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>a}),n(37920);var r=n(42069);const i={loading:!1,exportLoading:!1,sortCondition:{},searchCondition:{},pageCondition:{},tableData:{list:[],total:0,page:1,pageSize:10}},o=e=>{let{list:t=[],pageNo:n,...r}=e;return{...r,page:n,list:t}},a=(e,t)=>{const n=null!=e?e:i;switch(t.type){case r.Mb:return{...n,loading:!0};case r.T_:return{...n,loading:!1,...t.payload,tableData:o(t.payload.tableData)};case r.lK:return{...n,exportLoading:t.payload};default:return n}}},99055:(e,t,n)=>{\"use strict\";n.d(t,{Mb:()=>r,T_:()=>i,dJ:()=>o,fp:()=>a});const r=\"NCOPOVERTYCONTAINER/START_LOADING\",i=\"NCOPOVERTYCONTAINER/FINISH_LOADING\",o=\"NCOPOVERTYCONTAINER/SAVE_LICENSE_STATUSING\",a=\"NCOPOVERTYCONTAINER/CHANGE_IMPORT_LOADING\"},68322:(e,t,n)=>{\"use strict\";n.d(t,{Z:()=>l});var r=n(37920),i=n.n(r),o=n(99055);const a={loading:!1,importLoading:!1,sortCondition:{},searchCondition:{},pageCondition:{},licenseStatus:!1,tableData:{list:[],total:0,page:1,pageSize:10}},s=e=>{let{list:t,pageNo:n,...r}=e;return{...r,page:n,list:t.map((e=>{let{completeDate:t,...n}=e;return{...n,completeDate:t?i()(Number.parseInt(t,10)):null}}))}},l=(e,t)=>{const n=null!=e?e:a;switch(t.type){case o.Mb:return{...n,loading:!0};case o.T_:return{...n,loading:!1,...t.payload,tableData:s(t.payload.tableData)};case o.dJ:return{...n,licenseStatus:t.payload};case o.fp:return{...n,importLoading:t.payload};default:return n}}},56017:(e,t,n)=>{\"use strict\";n.d(t,{n:()=>pp,D:()=>dp});var r=n(21172),i=n(26887),o=n(93706),a=n(37920),s=n.n(a),l=n(88391),c=n(11854),u=n(79790),d=n(24301),p=n(33822),f=n(15075),h=n(13450),m=n(44851),g=n(33734),v=n(59516),y=n(60503),b=n(21499),S=n(33266),x=n(53148),w=n(26438),C=n(15910);const T=e=>e.map((e=>({name:e.name,icon:\"circle\"}))),A=e=>{const t=Math.max(...e.map((e=>e.yIndex)));if(0===t){const t=e.filter((e=>0===e.yIndex)).map((e=>e.data));return[{...(0,S.j2)(),max:Math.ceil((0,C.kg)(t)),min:Math.floor((0,C.KE)(t))}]}const n=e.filter((e=>1!==e.yIndex)).map((e=>e.data)),r=e.filter((e=>1===e.yIndex)).map((e=>e.data)),i=(0,C.kg)(n),o=(0,C.kg)(r),a=(0,C.KE)(n),s=(0,C.KE)(r),{minYlAxis:l,minYrAxis:c,intervalL:u,intervalR:d,maxYlAxis:p,maxYrAxis:f}=(0,S.TO)(i,o,a,s,5),h=[{...(0,S.j2)(\"\",1,u),max:p,min:l,interval:u},{...(0,S.j2)(\"\",1,d),max:f,min:c,interval:d}];if(t>1)for(let e=2;e<=t;e++)h.push({...(0,S.j2)(),show:!1});return h},E=(e,t)=>{var n,r,i;const{period:o,signalData:a}=e,s=null===(n=a.find((e=>1===e.yIndex)))||void 0===n?void 0:n.unit,l=null===(r=a.find((e=>0===e.yIndex)))||void 0===r?void 0:r.unit,c=(e=>e.map((e=>({name:`${e.deviceName}/${e.signalName}`,color:e.color,type:\"line\",yIndex:e.yIndex,yAxisIndex:1===e.yIndex?1:0,areaStyle:{},data:e.detailData}))))(a);return{tooltip:{...C.W,formatter:e=>((e,t)=>{const n=e[0].dataIndex,r=t.filter((t=>e.find((e=>e.color===t.color)))).map((e=>({unit:e.unit,value:e.detailData[n]}))),i=[],o=[];for(let t=0;t<e.length;t++){const n=(0,C.yn)(r[t].value,r[t].unit);i.push(`${e[t].marker} ${e[t].seriesName}`),o.push((0,S.hC)(n,n))}return(0,S.OA)(e[0].axisValueLabel,i,o)})(e,a)},grid:{...C.o3,left:\"3%\",right:\"3%\"},legend:{...C.hv,top:\"88%\",type:\"scroll\",data:T(c)},xAxis:[{type:\"category\",axisLine:C.re,data:null===(i=a[0])||void 0===i?void 0:i.xAxis,axisLabel:{formatter:e=>((e,t)=>e===w.x4.key?t:t.split(\" \").join(\"\\n\"))(o,e)},axisPointer:{type:\"line\",lineStyle:{type:\"solid\",width:1,color:\"#111A2CE5\"}},splitLine:{show:!1},axisTick:{show:!1}}],yAxis:A(c),series:c,backgroundColor:\"transparent\",dataZoom:[{show:!1}],leftYaxis:l,rightYaxis:s}};var O=n(49453);const M=e=>(0,O.v_)(\"/rest/dp/pvms/plant/v1/energy-analyzer/device-history-data\",e);var P=n(47603),D=n(23712);const I=e=>{let{templateName:t,templateId:n,intl:r,setDateParams:i}=e;const o={series:[{data:[]}]},a=s()().format(\"YYYY-MM-DD\"),[c,u]=(0,l.useState)(!1),[d,p]=(0,l.useState)(o),[f,h]=(0,l.useState)(w.x4.key),[m,g]=(0,l.useState)([]);(0,l.useEffect)((()=>{v(a,a,w.x4.key),i({period:w.x4.key,startTime:a,endTime:a})}),[]),(0,l.useEffect)((()=>{m.length>0?p(E({period:f,signalData:m})):p(o)}),[m]);const v=(e,t,r)=>{var i;u(!0),(i={templateId:n,startTime:e,endTime:t},(0,O.v_)(\"/rest/dp/pvms/plant/v1/energy-analyzer/template-history-data\",i)).then((e=>{const{data:t}=e;if((null==t?void 0:t.length)>0){const e=t.map((e=>({stationName:e.stationName,deviceName:e.deviceName,signalName:e.signalName,color:e.signalColor,yIndex:e.unitNum,unit:e.unit,detailData:e.pmDataList.map((e=>(0,S.sp)(e.counterValue))),xAxis:e.pmDataList.map((t=>s()(new Date(1e3*t.startTime).toLocaleString(\"en-US\",{timeZone:e.timeZone})).format(r===w.x4.key?\"HH:mm\":\"YYYY-MM-DD HH:mm\")))})));g(e)}})).finally((()=>{u(!1)}))};return(0,D.jsxs)(\"div\",{className:\"charts-container\",children:[(0,D.jsxs)(\"div\",{className:\"nco-title-date\",children:[(0,D.jsx)(\"span\",{className:\"nco-template-title\",children:t}),(0,D.jsx)(P.Z,{dimStyle:[w.x4,w.vc,w.rx],onChangeTime:e=>{const{startTime:t,endTime:n,period:r}=e;h(r),v(s()(t).format(\"YYYY-MM-DD\"),s()(n).format(\"YYYY-MM-DD\"),r),i({startTime:s()(t).format(\"YYYY-MM-DD\"),endTime:s()(n).format(\"YYYY-MM-DD\"),period:r})},timeFrame:30})]}),c?(0,D.jsx)(b.Z,{className:\"report-loading\",size:\"large\"}):(0,D.jsx)(\"div\",{className:\"custom-charts-container\",children:(0,D.jsx)(x.Z,{style:{height:500},options:d,leftYaxis:null==d?void 0:d.leftYaxis,rightYaxis:null==d?void 0:d.rightYaxis})})]})};var N=n(56729),_=n(46350),j=n(64218),k=n(53268),L=n(80770),R=n(53137);const Z=[\"#1AAC6E\",\"#6DB922\",\"#0FC6C2\",\"#317AF7\",\"#BD72F0\",\"#7853EF\",\"#FF8400\",\"#FDC000\",\"#DD40C3\",\"#F43146\",\"#1D905B\",\"#3F9000\",\"#0AA5A8\",\"#0A59F7\",\"#8E1BCC\",\"#3A1FC3\",\"#C45210\",\"#D19900\",\"#B212A2\",\"#CA1E35\",\"#6ACA94\",\"#8ECA4A\",\"#5BDEDE\",\"#5990FD\",\"#C950F9\",\"#9877F3\",\"#F07B41\",\"#FEE35C\",\"#E566CC\",\"#F46465\",\"#107A4C\",\"#317A00\",\"#058389\",\"#032EA2\",\"#B62BF7\",\"#690EA2\",\"#9C3A09\",\"#A57300\",\"#900A87\",\"#A01028\",\"#90DCAE\",\"#B1DC78\",\"#B5EFF5\",\"#8EBDFC\",\"#E79BFC\",\"#99ABED\",\"#F59869\",\"#FFD685\",\"#EE8FD8\",\"#FB9D9D\"];let B=[],F=!0;const z=e=>{let{intl:t,setDateParams:n,setCustomSignals:r,saveAndOpenTemplate:o,selectedTreeNode:a}=e;const c={series:[{data:[]}]},p=s()().format(\"YYYY-MM-DD\"),[y]=_.Z.useForm(),[C,T]=(0,l.useState)(!1),[A,I]=(0,l.useState)(w.x4.key),[z,V]=(0,l.useState)(p),[H,U]=(0,l.useState)(p),[G,Y]=(0,l.useState)(!1),[W,K]=(0,l.useState)(!1),[q,Q]=(0,l.useState)(c),[X,J]=(0,l.useState)([]),[$,ee]=(0,l.useState)([]);(0,l.useEffect)((()=>se),[]);const{nodeName:te,elementDn:ne,elementId:re}=a,ie=[{title:t.formatMessage({id:\"neteco.pvms.station.trend.template.signColor\"}),dataIndex:\"color\",key:\"color\",width:\"15%\",ellipsis:!0,render:e=>(0,D.jsx)(N.Z,{color:e,className:\"nco-signalColor\"})},{title:t.formatMessage({id:\"ncoFixKpi.searchBar.station\"}),dataIndex:\"stationName\",key:\"stationName\",width:\"25%\",ellipsis:!0,render:e=>window.neteco.util.iUnescape(e)},{title:t.formatMessage({id:\"ncoEnergyStorageSearchForm.label.device\"}),dataIndex:\"deviceName\",key:\"deviceName\",width:\"25%\",ellipsis:!0,render:e=>window.neteco.util.iUnescape(e)},{title:t.formatMessage({id:\"neteco.pvms.station.trend.template.signal\"}),dataIndex:\"signalName\",key:\"signalName\",width:\"25%\",ellipsis:!0,render:e=>window.neteco.util.iUnescape(e)},{title:t.formatMessage({id:\"common.label.action\"}),dataIndex:\"action\",key:\"action\",render:(e,t)=>oe(t)}],oe=e=>(0,D.jsx)(d.Z,{placement:\"top\",color:\"#fff\",title:t.formatMessage({id:\"common.button.delete\"}),overlayInnerStyle:{color:\"#191919\"},children:(0,D.jsx)(\"div\",{className:\"icon-background\",children:(0,D.jsx)(f.Z,{onClick:()=>ae(e)})})}),ae=e=>{(0,j.Nu)(`${ce}-uncheck-nodes`,{e:null,node:e.node})},se=()=>{F=!0,(0,j.Nu)(`reload_${ce}_left_tree`,{}),Q(c),J([]),I(w.x4.key),V(p),U(p)},le=()=>{T(!1)},ce=\"nco-signal-tree\",ue={domain:ce,queryConfig:{level:\"SIGNAL\",showSearch:!0,searchPlaceholder:t.formatMessage({id:\"neteco.pvms.inputTheKey\"}),useExternalRootElementDn:!1,rootElementDn:a.elementDn,customSelectMode:e=>e.isSign},commonConfig:{forbidEvent:!1,canCollapse:!0,loadingText:t.formatMessage({id:\"neteco.pvms.loading\"}),checkingText:t.formatMessage({id:\"neteco.pvms.systemSetting.amendment.amendStatus.1\"}),width:\"15rem\",incrementalLoadOptions:{incrStep:50,initialSize:100,clickToSeeMoreText:t.formatMessage({id:\"neteco.pvms.inspect.history.viewMore\"})},customizedGetTreeData:async e=>{let t=\"device\";var n;F||(t=null!==(n=e.node)&&void 0!==n&&n.isSignalParent?\"signal\":\"all\");const r={parentDn:e.node?e.parentDn:a.elementDn,treeDepth:t,deviceName:\"search\"===e.queryType?JSON.parse(e.cond).MO_NAME:void 0},i=await(e=>(0,O.U2)(\"/rest/dp/pvms/plant/v1/energy-analyzer/device-tree\",e))(r);return F=!1,{success:!0,data:i}}},checkConfig:{singleSelectMode:!1,shouldTraceBack:!1,checkCallbacks:[e=>{let{node:n,checked:r,checkedMap:i}=e;if(r&&i.size>20)return ae({node:n}),void(0,L.CD)(t.formatMessage({id:\"neteco.pvms.station.trend.customChart.check.signal.maxCount.error\"},{0:20}));(e=>{let{node:t,checked:n,checkedMap:r}=e;const i=[...X],o=t.elementId.split(\"_\")[0];if(n){var a,l;const e=[...$];e.indexOf(t.unit)<0&&e.push(t.unit);const n=e.findIndex((e=>t.unit===e)),r={color:Z[i.length],stationName:te,deviceName:null===(a=t.parentNode)||void 0===a||null===(l=a.parentNode)||void 0===l?void 0:l.nodeName,signalName:t.nodeName,unit:t.unit,yIndex:n,node:t,deviceDnId:o,stationDn:ne,signalId:t.mocId,deviceDn:t.parentDn,xAxis:[],detailData:[]};i.push(r),J(i),B=i,ee(e),(e=>{const t={signalFilters:[{signalId:e.mocId,deviceDnId:e.elementId.split(\"_\")[0]}],startTime:z,endTime:H,stationDn:ne};M(t).then((t=>{const{timeZone:n}=t,r=t.data[0].signalData[0].pmDataList.map((e=>(0,S.sp)(e.counterValue))),i=t.data[0].signalData[0].pmDataList.map((e=>s()(new Date(1e3*e.startTime).toLocaleString(\"en-US\",{timeZone:n})).format(A===w.x4.key?\"HH:mm\":\"YYYY-MM-DD HH:mm\")));B.forEach((t=>{t.node.parentDn===e.parentDn&&t.node.mocId===e.mocId&&(t.detailData=[...r],t.xAxis=[...i])})),J([...B])}))})(t)}else{const e=i.filter((e=>!(e.deviceDnId===o&&e.signalId===t.mocId)));if(!e.some((e=>e.unit===t.unit))){const n=$.filter((e=>e!==t.unit));ee(n),e.forEach((e=>{e.yIndex=n.indexOf(e.unit)}))}J(e),B=e}})({node:n,checked:r,checkedMap:i}),r||Q(c)}]},searchTypeProps:{searchTypeInclude:[R.aG.device]}};return(0,l.useEffect)((()=>{X.length>0?Q(E({period:A,signalData:X})):Q(c),r(X)}),[X]),(0,l.useEffect)((()=>{n({period:A,startTime:z,endTime:H})}),[A,z,H]),(0,D.jsxs)(\"div\",{className:\"custom-chart-container\",children:[(0,D.jsx)(\"div\",{className:\"left-tree-content\",children:(0,D.jsx)(k.Z,{...ue})}),(0,D.jsxs)(\"div\",{className:\"right-chart-content\",children:[(0,D.jsx)(\"div\",{className:\"date-selector\",children:(0,D.jsx)(P.Z,{dimStyle:[w.x4,w.vc,w.rx],onChangeTime:e=>{const{period:t}=e,n=s()(e.startTime).format(\"YYYY-MM-DD\"),r=s()(e.endTime).format(\"YYYY-MM-DD\");if(I(t),V(n),U(r),X.length>0){const e={startTime:n,stationDn:ne,endTime:r,signalFilters:X.map((e=>({signalId:e.signalId,deviceDnId:e.deviceDnId,stationDn:e.stationDn})))};K(!0),M(e).then((e=>{J(X.map((n=>{const{timeZone:r}=e,i=e.data.find((e=>String(e.deviceDnId)===n.deviceDnId)).signalData.find((e=>e.signalId===n.signalId)).pmDataList;return n.detailData=i.map((e=>(0,S.sp)(e.counterValue))),n.xAxis=i.map((e=>s()(new Date(1e3*e.startTime).toLocaleString(\"en-US\",{timeZone:r})).format(t===w.x4.key?\"HH:mm\":\"YYYY-MM-DD HH:mm\"))),n})))})).finally((()=>{K(!1)}))}},timeFrame:30})}),(0,D.jsxs)(\"div\",{className:\"custom-content\",children:[(0,D.jsx)(\"div\",{className:\"custom-chart\",children:W?(0,D.jsx)(b.Z,{className:\"report-loading\",size:\"large\"}):(0,D.jsx)(x.Z,{options:q,leftYaxis:null==q?void 0:q.leftYaxis,rightYaxis:null==q?void 0:q.rightYaxis})}),(0,D.jsx)(\"div\",{className:\"custom-table\",children:(0,D.jsx)(g.Z,{columns:ie,dataSource:X,pagination:!1,scroll:{y:\"13rem\"}})})]}),(0,D.jsxs)(\"div\",{className:\"custom-button\",children:[(0,D.jsx)(h.Z,{type:\"solid\",className:\"cancel-button\",onClick:se,children:t.formatMessage({id:\"common.button.cancel\"})}),(0,v.lVp)(v.tSF)&&(0,D.jsx)(h.Z,{type:\"primary\",onClick:()=>{T(!0)},disabled:0===X.length,children:t.formatMessage({id:\"neteco.pvms.station.trend.template.save.title\"})})]})]}),(0,D.jsx)(m.Z,{title:t.formatMessage({id:\"neteco.pvms.station.trend.template.save.title\"}),width:452,className:\"nco-saveTemplate-modal\",centered:!0,destroyOnClose:!0,visible:C,maskClosable:!1,footer:null,onCancel:le,children:(0,D.jsx)(\"div\",{children:(0,D.jsxs)(_.Z,{labelCol:{span:5},wrapperCol:{span:19},labelAlign:\"left\",form:y,name:\"saveModal\",autoComplete:\"off\",onFinish:()=>{const e=y.getFieldValue(\"templateName\"),n={templateName:e,signalDetails:X.map((e=>({signalColor:e.color,deviceDn:e.deviceDn,deviceDnId:e.deviceDnId,stationDn:e.stationDn,signalId:e.signalId,unit:e.unit,unitNum:e.yIndex,stationDnId:re})))};Y(!0),(e=>(0,O.v_)(\"/rest/dp/pvms/plant/v1/energy-analyzer/template\",e))(n).then((n=>{i.ZP.success({className:\"center-message\",content:t.formatMessage({id:\"neteco.pvms.saveSucceed\"})}),T(!1),o(n.templateId,e)})).catch((e=>{const{responseJSON:n={}}=e,{exceptionId:r}=n;let o=t.formatMessage({id:\"neteco.pvms.saveFailed\"});\"PVMS.00091205\"===r&&(o=t.formatMessage({id:\"neteco.pvms.max.template.num\"},{num:10})),\"PVMS.template.name.duplicate\"===r&&(o=t.formatMessage({id:\"neteco.pvms.stationInfo.addStation.nameRepeat\"})),i.ZP.error({className:\"center-message\",content:o})})).finally((()=>{Y(!1)}))},preserve:!1,children:[(0,D.jsx)(_.Z.Item,{name:\"templateName\",label:t.formatMessage({id:\"neteco.pvms.station.trend.template.name\"}),rules:[{required:!0,message:\"\"}],children:(0,D.jsx)(u.Z,{showCount:!0,maxLength:96,placeholder:t.formatMessage({id:\"neteco.pvms.partials.main.inputContent.tip\"})})}),(0,D.jsxs)(_.Z.Item,{label:\" \",className:\"nco-modal-button\",children:[(0,D.jsx)(h.Z,{htmlType:\"button\",onClick:le,className:\"nco-cancel-btn\",children:t.formatMessage({id:\"common.button.cancel\"})}),(0,D.jsx)(h.Z,{type:\"primary\",htmlType:\"submit\",loading:G,children:t.formatMessage({id:\"common.button.ok\"})})]})]})})})]})};var V=n(99073),H=n(22800),U=n(80864),G=n(44910),Y=n(61832);const W=[w.x4,w.vc,w.oP,w.NT],K=[Y.Z.SOLUTION_SIX,Y.Z.PURE_LIGHT,Y.Z.SOL8_PV_AC,Y.Z.LIGHT_STORAGE,Y.Z.SOL8_PV_ES_AC,Y.Z.MIX];class q extends l.Component{constructor(e){super(e),this.intlMessage=(e,t)=>this.props.intl.formatMessage({id:e},t),this.getParams=()=>{const{stationDn:e,time:t}=this.state,{period:n,startTime:r}=t;let i=\"\";W.forEach((e=>{e.key===n&&(i=e.dim)}));const o=s()(r).startOf(w.x4.key).valueOf();return{stationDn:e,queryType:i,queryTime:o,timeZone:(0,U.ZP)(r),timeZoneStr:(0,U.u)(),dateTime:s()(o).format(\"YYYY-MM-DD HH:mm:ss\")}},this.getEnergyTrendAnalysisData=()=>{this.setState({loading:!0,energyData:{}});const{stationDn:e,queryType:t,dateTime:n}=this.getParams();var r;(r={stationDn:e,queryType:t,dateTime:n},(0,O.U2)(\"/rest/pvms/web/station/v1/energy-analyzer/energy-balance\",r)).then((e=>{this.setState({energyData:null==e?void 0:e.data})})).finally((()=>{this.setState({loading:!1})}))},this.getPriceAndSOCData=()=>{this.setState({priceAndSOCLoading:!0,priceAndSOCData:{}});const{stationDn:e,dateTime:t}=this.getParams();var n;(n={stationDn:e,dateTime:t},(0,O.U2)(\"/rest/pvms/web/station/v1/energy-analyzer/soc-history-electricity-price\",n)).then((e=>{var t,n;const r=null==e||null===(t=e.data)||void 0===t||null===(n=t.socData)||void 0===n?void 0:n.map((e=>isNaN(e)?V.lH:Number(e)));this.setState({priceAndSOCData:{...null==e?void 0:e.data,socData:r}})})).finally((()=>{this.setState({priceAndSOCLoading:!1})}))},this.onChangeTime=e=>{const{period:t}=e;this.setState({time:{period:e.period,startTime:s()(e.startTime),endTime:s()(e.endTime)}},(()=>{(0,v.lVp)(v.DFz)&&this.getEnergyTrendAnalysisData(),(0,v.lVp)(v.yb)&&t===w.x4.key&&this.getPriceAndSOCData();const e=this.getParams();this.props.getDateParams(e)}))},this.renderCharts=(e,t,n)=>{const{time:r}=this.state;return(0,D.jsxs)(\"div\",{className:\"income-content-echarts\",children:[(0,D.jsx)(\"div\",{className:\"chart-title\",children:e}),(0,D.jsx)(\"div\",{className:\"report-echarts\",children:t?(0,D.jsx)(b.Z,{className:\"report-loading\",size:\"large\"}):(0,D.jsx)(\"div\",{className:\"charts-container\",children:r.period===w.x4.key?(0,D.jsx)(x.Z,{options:n,leftYaxis:null==n?void 0:n.leftYaxis,rightYaxis:null==n?void 0:n.rightYaxis}):(0,D.jsx)(H.Z,{options:n,leftYaxis:null==n?void 0:n.leftYaxis,rightYaxis:null==n?void 0:n.rightYaxis})})})]})},this.state={time:{period:w.x4.key,startTime:s()(),endTime:s()()},energyData:{},stationDn:e.stationDn,showExportListModal:!1,loading:!1,priceAndSOCData:{},priceAndSOCLoading:!1}}componentDidMount(){(0,v.lVp)(v.DFz)&&this.getEnergyTrendAnalysisData(),(0,v.lVp)(v.yb)&&this.state.time.period===w.x4.key&&this.getPriceAndSOCData();const e=this.getParams();this.props.getDateParams(e)}render(){const{time:e,energyData:t,loading:n,priceAndSOCLoading:r,priceAndSOCData:i}=this.state,{sceneType:o}=this.props,{existMeter:a=!1}=t,s=a&&K.includes(o),l=o!==Y.Z.PURE_STORAGE&&o!==Y.Z.SOL8_ES_AC&&o!==Y.Z.POWER_M,c=s||l?this.renderCharts(this.intlMessage(\"neteco.pvms.station.trend.consumption.generated.power.title\"),n,(0,G.CP)(this.intlMessage,t,e,s,o)):null;return(0,D.jsxs)(\"div\",{className:\"nco-monitor-station-trend-energy-analysis tab-content\",children:[(0,D.jsx)(\"div\",{className:\"trend-energy-analysis-date-switch\",children:(0,D.jsx)(P.Z,{dimStyle:W,time:e,onChangeTime:this.onChangeTime})}),(0,D.jsxs)(\"div\",{className:\"all-trend-energy-echarts\",children:[e.period===w.x4.key?this.renderCharts(this.intlMessage(\"neteco.pvms.station.trend.energy.echart.title\"),n,(0,G.Zc)(this.intlMessage,t,o)):this.renderCharts(this.intlMessage(\"neteco.pvms.station.trend.energy.echart.title\"),n,(0,G.kR)(this.intlMessage,t,e,o)),e.period===w.x4.key?o!==Y.Z.PURE_LIGHT&&this.renderCharts(this.intlMessage(\"neteco.pvms.aifc.priceAndSOC.tit\"),r,(0,G.pv)(this.intlMessage,i,o)):c]})]})}}const Q=(0,o.ZP)(q),{TabPane:X}=c.Z,{Search:J}=u.Z,{BUSINESS_STATION:$}=V.x1;class ee extends l.Component{constructor(e){var t;super(e),t=this,this.loadTemplates=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;const{stationDn:i}=t.props,o={stationDn:i,curPage:e,pageSize:n,templateName:(null==r?void 0:r.length)>0?r:void 0};t.setState({tableLoading:!0}),(e=>(0,O.U2)(\"/rest/dp/pvms/plant/v1/energy-analyzer/template\",e))(o).then((e=>{const{pageCount:n,...r}=e;t.setState({templateList:r,tableLoading:!1})}))},this.columns=[{title:this.props.intl.formatMessage({id:\"neteco.pvms.station.trend.template.name\"}),dataIndex:[\"id\",\"templateName\"],key:\"id\",width:\"30%\",ellipsis:!0,render:(e,t)=>t.templateName},{title:this.props.intl.formatMessage({id:\"nco.ui.upgrade.policy.creator\"}),dataIndex:\"createUser\",key:\"createUser\",ellipsis:!0,width:\"30%\"},{title:this.props.intl.formatMessage({id:\"neteco.pvms.createTime\"}),dataIndex:\"createTime\",key:\"createTime\",ellipsis:!0,width:\"30%\",render:e=>isNaN(e)?V.Nw:s()(Number(e)).format(\"YYYY-MM-DD HH:mm\")},{title:this.props.intl.formatMessage({id:\"common.label.action\"}),dataIndex:\"action\",key:\"action\",width:\"10%\",render:(e,t)=>this.buildActionContent(t)}],this.pagination=()=>{const{templateList:e}=this.state;return{total:e.total,showTotal:e=>this.props.intl.formatMessage({id:\"neteco.pvms.station.subarray.pagination.total\"},{total:e}),pageSizeOptions:[10,30,50,100],showSizeChanger:!0,showQuickJumper:!0,totalFixedLeft:!0,current:e.curPage,pageSize:e.pageSize,onChange:this.onChangePage}},this.onChangePage=(e,t)=>{this.loadTemplates(e,t)},this.buildActionContent=e=>{const{intl:t}=this.props;return(0,D.jsxs)(\"div\",{className:\"table-action\",children:[(0,D.jsx)(d.Z,{placement:\"top\",title:t.formatMessage({id:\"neteco.pvms.view\"}),color:\"#fff\",overlayInnerStyle:{color:\"#191919\"},children:(0,D.jsx)(\"div\",{className:\"icon-background\",children:(0,D.jsx)(p.Z,{className:\"play-icon\",onClick:()=>this.openTemplate(e)})})}),(0,v.lVp)(v.Qrv)&&(0,D.jsx)(d.Z,{placement:\"top\",title:t.formatMessage({id:\"common.button.delete\"}),color:\"#fff\",overlayInnerStyle:{color:\"#191919\"},children:(0,D.jsx)(\"div\",{className:\"icon-background\",children:(0,D.jsx)(f.Z,{onClick:()=>this.delTemplate(e)})})})]})},this.openTemplate=e=>{if(this.state.customTabsList.map((e=>e.tabKey)).includes(e.id))this.setState({showTemplateModal:!1,activeTab:e.id});else{const t=[{tabName:e.templateName,tabKey:e.id,tabComponent:(0,D.jsx)(I,{templateId:e.id,templateName:e.templateName,intl:this.props.intl,setDateParams:this.setDateParams})},...this.state.customTabsList];this.setState({showTemplateModal:!1,customTabsList:t,activeTab:e.id})}},this.delTemplate=e=>{const{intl:t}=this.props;(0,L.ST)(t.formatMessage({id:\"neteco.pvms.ncoStationSetting.table.delTemplate\"}),(()=>this.executeDelete(e)),null,t,null,!0)},this.executeDelete=e=>{var t;(t=[e.id],(0,O.IV)(\"/rest/dp/pvms/plant/v1/energy-analyzer/template\",t)).then((()=>{i.ZP.success({className:\"center-message\",content:this.props.intl.formatMessage({id:\"neteco.pvms.station.availability.deleteECO.success\"})}),this.loadTemplates();const t=this.props.stationType===V.x1.BUSINESS_STATION?\"energyTrend\":\"customChart\",n=this.state.customTabsList.filter((t=>t.tabKey!==e.id)),r=this.state.activeTab===e.id?t:this.state.activeTab;this.setState({customTabsList:n,activeTab:r})})).catch((()=>{i.ZP.error({className:\"center-message\",content:this.props.intl.formatMessage({id:\"neteco.pvms.station.availability.deleteECO.failed\"})})}))},this.changeTabHandler=e=>{this.setState({activeTab:e})},this.showTemplate=()=>{this.loadTemplates(),this.setState({showTemplateModal:!0})},this.closeTemplate=()=>{this.setState({showTemplateModal:!1})},this.exportHandler=()=>{const{dateParams:e,activeTab:t,customSignals:n}=this.state;if(\"energyTrend\"===t&&(0,v.lVp)(v.O9c))this.setState({exportLoading:!0}),(r={...e},(0,O.Sv)(\"/rest/pvms/web/station/v1/energy-analyzer/export-data\",null,r)).catch((e=>{(0,L.jT)(this.props.intl.formatMessage({id:\"neteco.pvms.system.busy.try.again\"}))})).finally((()=>{this.setState({exportLoading:!1})}));else if(\"customChart\"===t&&(0,v.lVp)(v.Pzw)){this.setState({exportLoading:!0});const t=this.props.selectedTreeNode.elementId,r=n.map((e=>{const{deviceDn:n,deviceDnId:r,deviceName:i,signalId:o,signalName:a,stationDn:s,stationName:l,unit:c}=e;return{deviceDn:n,deviceDnId:r,deviceName:i,signalId:o,signalName:a,stationDn:s,stationName:l,stationDnId:t,unit:c}}));(e=>(0,O.Sv)(\"/rest/dp/pvms/plant/v1/energy-analyzer/export\",null,e))({startTime:e.startTime,endTime:e.endTime,signalInfos:r}).catch((e=>{(0,L.jT)(this.props.intl.formatMessage({id:\"neteco.pvms.system.busy.try.again\"}))})).finally((()=>{this.setState({exportLoading:!1})}))}else(0,v.lVp)(v.KPU)&&(this.setState({exportLoading:!0}),(e=>(0,O.Sv)(\"/rest/dp/pvms/plant/v1/energy-analyzer/template-history-data-export\",null,e))({startTime:e.startTime,endTime:e.endTime,templateId:t}).catch((e=>{(0,L.jT)(this.props.intl.formatMessage({id:\"neteco.pvms.system.busy.try.again\"}))})).finally((()=>{this.setState({exportLoading:!1})})));var r},this.setDateParams=e=>{this.setState({dateParams:e})},this.setCustomSignals=e=>{this.setState({customSignals:e})},this.closeTab=(e,t)=>{const n=this.props.stationType===V.x1.BUSINESS_STATION?\"energyTrend\":\"customChart\";if(\"remove\"===t){const t=this.state.customTabsList.filter((t=>t.tabKey!==e)),r=this.state.activeTab===e?n:this.state.activeTab;this.setState({customTabsList:t,activeTab:r})}},this.saveAndOpenTemplate=(e,t)=>{const n=[{tabName:t,tabKey:e,tabComponent:(0,D.jsx)(I,{templateId:e,templateName:t,intl:this.props.intl,setDateParams:this.setDateParams})},...this.state.customTabsList];this.setState({customTabsList:n,activeTab:e})},this.showExport=()=>{const{activeTab:e}=this.state,t=\"energyTrend\"===e&&(0,v.lVp)(v.O9c),n=\"customChart\"===e&&(0,v.lVp)(v.Pzw),r=![\"energyTrend\",\"customChart\"].includes(e)&&(0,v.lVp)(v.KPU);return t||n||r},this.exportDisabled=()=>\"customChart\"===this.state.activeTab&&0===this.state.customSignals.length,this.state={activeTab:this.props.stationType===$?\"energyTrend\":\"customChart\",customTabsList:[],templateList:{templates:[],curPage:1,pageSize:10,total:0},dateParams:{},customSignals:[],showTemplateModal:!1,exportLoading:!1,tableLoading:!1}}componentWillUnmount(){this.setState({activeTab:\"energyTrend\",customTabsList:[],templateList:{templates:[],curPage:1,pageSize:10,total:0},showTemplateModal:!1})}render(){const{intl:e,selectedTreeNode:t}=this.props;return(0,v.lVp)(v.fHL)?(0,D.jsxs)(\"div\",{className:\"nco-station-trend-container tab-content\",children:[(0,D.jsxs)(\"div\",{className:\"trend-analysis-buttons\",children:[(0,v.lVp)(v.aKR)&&(0,D.jsx)(h.Z,{onClick:this.showTemplate,children:e.formatMessage({id:\"neteco.pvms.station.trend.template.button\"})}),this.showExport()&&(0,D.jsx)(h.Z,{className:\"nco-export-btn\",onClick:this.exportHandler,disabled:this.exportDisabled(),loading:this.state.exportLoading,children:e.formatMessage({id:\"common.button.export\"})})]}),(0,D.jsx)(\"div\",{className:\"trend-analysis-tabs\",children:(0,D.jsxs)(c.Z,{onChange:this.changeTabHandler,onEdit:this.closeTab,destroyInactiveTabPane:!0,type:\"editable-card\",activeKey:this.state.activeTab,size:\"middle\",hideAdd:!0,children:[(0,v.lVp)(v.DFz)&&this.props.stationType===$&&(0,D.jsx)(X,{tab:e.formatMessage({id:\"neteco.pvms.station.energy.trend.tabName\"}),closable:!1,children:(0,D.jsx)(Q,{stationDn:this.props.stationDn,getDateParams:this.setDateParams,sceneType:this.props.sceneType})},\"energyTrend\"),this.state.customTabsList.map((e=>(0,D.jsx)(X,{tab:e.tabName,children:(0,D.jsx)(\"div\",{className:\"nco-report-tab-container\",children:e.tabComponent})},e.tabKey))),(0,v.p4n)([v.tSF,v.fr])&&(0,D.jsx)(X,{tab:e.formatMessage({id:\"neteco.pvms.station.energy.self.tabName\"}),closable:!1,children:(0,D.jsx)(z,{intl:this.props.intl,setDateParams:this.setDateParams,setCustomSignals:this.setCustomSignals,saveAndOpenTemplate:this.saveAndOpenTemplate,selectedTreeNode:t})},\"customChart\")]})}),(0,D.jsxs)(m.Z,{title:e.formatMessage({id:\"neteco.pvms.station.trend.template.button\"}),width:\"75rem\",className:\"nco-template-modal\",centered:!0,destroyOnClose:!0,visible:this.state.showTemplateModal,maskClosable:!1,onCancel:this.closeTemplate,footer:null,getContainer:!1,children:[(0,D.jsx)(J,{placeholder:e.formatMessage({id:\"neteco.pvms.station.trend.importTemplateName\"}),className:\"nco-searchTemplate-input\",onSearch:e=>this.loadTemplates(1,10,e),onPressEnter:e=>this.loadTemplates(1,10,e.target.value)}),(0,D.jsx)(g.Z,{columns:this.columns,pagination:this.pagination(),dataSource:this.state.templateList.templates,loading:this.state.tableLoading})]})]}):(0,D.jsx)(y.Z,{})}}const te=(0,o.ZP)(ee);var ne=n(57350),re=n(15694),ie=n(33670),oe=n(41541),ae=n(44894),se=n(78275),le=n(39121),ce=n(18206),ue=n(41006),de=n(70535),pe=n(17489),fe=n(29266),he=n(62073),me=n(90701),ge=n(40472);const ve=(0,o.ZP)((function(e){let{intl:t,title:n}=e;const r=(e,n)=>t.formatMessage({id:e},n);return(0,D.jsxs)(\"div\",{className:\"nco-station-archive-tips\",children:[(0,D.jsx)(\"span\",{className:\"nco-station-archive-tips-text\",children:r(n)}),(0,D.jsx)(me.Z,{title:(0,D.jsxs)(\"div\",{children:[(0,D.jsxs)(\"div\",{className:\"img-alert-tip\",children:[(0,D.jsx)(\"span\",{children:\"1. \"}),(0,D.jsx)(\"span\",{children:r(\"neteco.pvms.stationInfo.addStation.imageLimitations_1\")})]}),(0,D.jsxs)(\"div\",{className:\"img-alert-tip\",children:[(0,D.jsx)(\"span\",{children:\"2. \"}),(0,D.jsx)(\"span\",{children:r(\"neteco.pvms.stationInfo.addStation.imageLimitations_2\",{maxNum:124})})]}),(0,D.jsxs)(\"div\",{className:\"img-alert-tip\",children:[(0,D.jsx)(\"span\",{children:\"3. \"}),(0,D.jsx)(\"span\",{children:r(\"neteco.pvms.stationInfo.addStation.imageLimitations_3\")})]})]}),children:(0,D.jsx)(ge.Z,{})})]})}));var ye=n(77989);const{TextArea:be}=he.Z,Se=(0,o.ZP)((function(e){let{intl:t,show:n,onCancel:r,info:i={}}=e;const o=(e,n)=>t.formatMessage({id:e},n),[,a]=(0,l.useState)({}),[s]=fe.Z.useForm();return(0,l.useEffect)((()=>{s.setFieldsValue({...i,reviewStatus:1===i.reviewStatus?2:i.reviewStatus,reviewComment:1!==i.reviewStatus&&i.reviewComment?i.reviewComment:\"\"}),a(i)}),[i.objectId]),(0,D.jsx)(ie.Z,{title:o(\"neteco.pvms.systemSetting.logManage.details\"),centered:!0,maskClosable:!1,className:\"nco-archive-review-modal\",destroyOnClose:!0,visible:n,onCancel:r,width:\"57.5rem\",okText:o(\"neteco.pvms.partials.main.io.wf.options.submit\"),onOk:()=>{var e;(e={storageSn:i.objectId,reviewStatus:s.getFieldValue(\"reviewStatus\"),reviewComment:s.getFieldValue(\"reviewComment\")},(0,O.v_)(\"/rest/pvms/web/station/v1/archives/update-review-record\",e)).then((e=>{e.success&&r()}))},children:(0,D.jsx)(\"div\",{className:\"nco-station-review-form\",children:(0,D.jsxs)(fe.Z,{labelCol:{span:3},labelAlign:\"left\",colon:!1,form:s,name:\"base\",children:[(0,D.jsxs)(de.Z,{span:24,children:[(0,D.jsx)(pe.Z,{span:12,children:(0,D.jsx)(fe.Z.Item,{labelCol:{span:6},name:\"inverterName\",label:o(\"neteco.pvms.cascadedInverter.busiName\"),children:(0,D.jsx)(\"div\",{className:\"review-form-value\",children:s.getFieldValue(\"inverterName\")})})}),(0,D.jsx)(pe.Z,{span:12,children:(0,D.jsx)(fe.Z.Item,{labelCol:{span:8},name:\"inverterName\",label:o(\"ncoStation.archive.snType\"),children:(0,D.jsx)(\"div\",{className:\"review-form-value\",children:s.getFieldValue(\"objectType\")})})})]}),(0,D.jsxs)(de.Z,{span:24,children:[(0,D.jsx)(pe.Z,{span:12,children:(0,D.jsx)(fe.Z.Item,{labelCol:{span:6},name:\"inverterName\",label:o(\"neteco.pvms.ivcurve.totalHeads.4\"),children:(0,D.jsx)(\"div\",{className:\"review-form-value\",children:s.getFieldValue(\"inverterSn\")})})}),(0,D.jsx)(pe.Z,{span:12,children:(0,D.jsx)(fe.Z.Item,{labelCol:{span:8},name:\"objectId\",label:o(\"ncoStation.archive.esuAndDcdcSn\"),children:(0,D.jsx)(\"div\",{className:\"review-form-value\",children:s.getFieldValue(\"objectId\")})})})]}),(0,D.jsx)(fe.Z.Item,{name:\"reviewList\",label:o(\"ncoStation.archive.energyPics\"),children:(0,D.jsxs)(\"div\",{className:\"review-form-pics\",children:[(0,D.jsx)(ye.Z,{showInfo:!0,list:i.imageList,sn:i.objectId}),(0,D.jsx)(\"div\",{style:{marginTop:\"0.75rem\"},children:(0,D.jsx)(ve,{title:\"neteco.pvms.stationInfo.addStation.archive.imageLimit20\"})})]})}),(0,D.jsx)(fe.Z.Item,{name:\"reviewStatus\",label:o(\"ncoStation.archive.reviewRes\"),children:(0,D.jsxs)(ue.ZP.Group,{children:[(0,D.jsx)(ue.ZP,{value:2,children:o(\"ncoStation.archive.reviewPass\")}),(0,D.jsx)(ue.ZP,{value:3,children:o(\"ncoStation.archive.reviewPrevent\")})]})}),(0,D.jsx)(fe.Z.Item,{name:\"reviewComment\",children:(0,D.jsx)(de.Z,{span:24,children:(0,D.jsx)(pe.Z,{offset:3,span:21,children:(0,D.jsx)(be,{showCount:!0,rows:4,defaultValue:s.getFieldValue(\"reviewComment\"),placeholder:o(\"ncoStation.archive.reviewPlaceholder\"),maxLength:200})})})})]})})})})),xe={1:\"ncoStation.archive.select.will\",2:\"ncoStation.archive.select.passed\",3:\"ncoStation.archive.select.unpass\"},{neteco:we}=window,Ce=(0,o.ZP)((function(e){let{dn:t,intl:n}=e;const[r,i]=(0,l.useState)(0),[o,a]=(0,l.useState)(1),[s,c]=(0,l.useState)(10),[u,d]=(0,l.useState)([]),[p,f]=(0,l.useState)({}),[h,m]=(0,l.useState)(\"0\"),[g,y]=(0,l.useState)(!1),[b,S]=(0,l.useState)([]),[x,w]=(0,l.useState)({}),[C,T]=(0,l.useState)({}),[A,E]=(0,l.useState)(!1),[M,P]=(0,l.useState)(!1),I=(e,t)=>n.formatMessage({id:e},t);(0,l.useEffect)((()=>{let e=[{title:I(\"neteco.pvms.cascadedInverter.busiName\"),dataIndex:\"inverterName\",key:\"inverterName\"},{title:I(\"neteco.pvms.ivcurve.totalHeads.4\"),dataIndex:\"inverterSn\",key:\"inverterSn\"},{title:I(\"ncoStation.archive.snType\"),dataIndex:\"objectType\",key:\"objectType\"},{title:I(\"ncoStation.archive.esuAndDcdcSn\"),dataIndex:\"objectId\",key:\"objectId\"},{title:I(\"ncoStation.archive.snPics\"),dataIndex:\"imageList\",key:\"imageList\",render:(e,t)=>j(e,t)}];(0,v.lVp)(v.C1W)&&e.push({title:I(\"ncoStation.archive.reviewStatus\"),dataIndex:\"reviewStatus\",key:\"reviewStatus\",render:e=>I(xe[e])},{title:I(\"ncoStation.archive.updateTime\"),dataIndex:\"dataUpdateTime\",key:\"dataUpdateTime\",render:e=>e||\"-\"},{title:I(\"ncoPovertyTable.column.operation\"),dataIndex:\"operation\",key:\"operation\",render:(e,t)=>(0,D.jsx)(ae.Z,{onClick:()=>L(t)})}),S(e)}),[]),(0,l.useEffect)((()=>{N(t)}),[t,h,o,s]);const N=async e=>{let t={stationDn:e,sheetNO:o,sheetSize:s,filterItem:h};y(!0);let n=await(r=t,(0,O.U2)(\"/rest/pvms/web/station/v1/archives/query-storage-image-byDn\",r));var r;if(n){var a;const e=n.data||{reviewStatus:{0:0,1:0,2:0,3:0},storageInfos:[]};if((null===(a=e.storageInfos)||void 0===a?void 0:a.length)>0){const t=e.storageInfos.map((e=>(e.inverterName=we.util.iUnescape(we.util.iUnescape(e.inverterName)),e)));e.storageInfos=t}i(e.reviewStatus[0]),d(e.storageInfos||[]),f(e.reviewStatus)}y(!1)},_=e=>{m(h===e?\"0\":e)},j=(e,t)=>(0,D.jsx)(D.Fragment,{children:e.map((e=>(0,D.jsx)(\"img\",{onClick:()=>R(t),className:\"archive-table-record-img\",src:`/rest/pvms/web/station/v1/archives/archives-image-preview?fileId=${e.thumFileId}`},e.thumFileId)))}),k=()=>{T({}),P(!1),N(t)},L=e=>{E(!0),w(e)},R=e=>{P(!0),T(e)};return r?(0,D.jsxs)(\"div\",{className:\"station-archive-table\",children:[(0,D.jsx)(\"div\",{className:\"archive-table-title common-title\",children:I(\"ncoStation.archive.tableDetail\")}),(0,D.jsxs)(\"div\",{className:\"archive-table-operation\",children:[(0,v.lVp)(v.C1W)?(0,D.jsxs)(\"div\",{className:\"archive-table-tag\",children:[(0,D.jsxs)(\"div\",{className:(0,le.Z)(\"table-filter-tag\",{\"table-filter-tag--active\":\"2\"===h}),onClick:()=>_(\"2\"),children:[(0,D.jsx)(\"span\",{className:\"icon-success-filled\"}),(0,D.jsx)(\"span\",{className:\"table-filter-tag-label\",children:I(\"ncoStation.archive.select.passed\")}),(0,D.jsx)(\"span\",{className:\"table-filter-tag-num\",children:p[2]})]}),(0,D.jsxs)(\"div\",{className:(0,le.Z)(\"table-filter-tag\",{\"table-filter-tag--active\":\"1\"===h}),onClick:()=>_(\"1\"),children:[(0,D.jsx)(\"span\",{className:\"icon-alarm-minor-filled\"}),(0,D.jsx)(\"span\",{className:\"table-filter-tag-label\",children:I(\"ncoStation.archive.select.will\")}),(0,D.jsx)(\"span\",{className:\"table-filter-tag-num\",children:p[1]})]}),(0,D.jsxs)(\"div\",{className:(0,le.Z)(\"table-filter-tag\",{\"table-filter-tag--active\":\"3\"===h}),onClick:()=>_(\"3\"),children:[(0,D.jsx)(\"span\",{className:\"icon-closed-filled\"}),(0,D.jsx)(\"span\",{className:\"table-filter-tag-label\",children:I(\"ncoStation.archive.select.unpass\")}),(0,D.jsx)(\"span\",{className:\"table-filter-tag-num\",children:p[3]})]})]}):(0,D.jsx)(\"div\",{}),(0,D.jsx)(\"div\",{className:\"archive-table-refresh\",children:(0,D.jsx)(oe.Z,{icon:(0,D.jsx)(se.Z,{}),onClick:()=>{a(1),c(10),m(\"0\")},children:I(\"neteco.pvms.partials.main.dm.devParamMenu.refreshBtn\")})})]}),(0,D.jsx)(ie.Z,{title:I(\"neteco.pvms.systemSetting.logManage.details\"),centered:!0,maskClosable:!1,className:\"nco-img-list-modal\",destroyOnClose:!0,visible:M,onCancel:k,okText:I(\"common.button.ok\"),onOk:k,width:{width:\"50rem\"},children:(0,D.jsxs)(\"div\",{className:\"nco-station-active-record\",children:[(0,D.jsx)(ye.Z,{sn:C.objectId,showInfo:!0}),(0,D.jsx)(\"div\",{style:{marginTop:\"0.75rem\"},children:(0,D.jsx)(ve,{title:\"neteco.pvms.stationInfo.addStation.archive.imageLimit20\"})})]})}),(0,D.jsx)(re.Z,{size:\"small\",dataSource:u,showSorterTooltip:!1,columns:b,rowKey:e=>e.objectId,pagination:!1,loading:g}),(0,D.jsx)(ne.Z,{size:\"small\",total:r,showSizeChanger:!0,showTotal:(0,ce.Z)(n),current:o,pageSize:s,pageSizeOptions:[\"10\",\"20\",\"30\",\"50\",\"100\"],onChange:(e,t)=>c(t),style:{marginTop:\"1rem\"}}),(0,D.jsx)(Se,{show:A,onCancel:()=>{T({}),E(!1),N(t)},info:x})]}):null}));var Te=n(87848);const Ae=(0,o.ZP)((function(e){let{intl:t,deviceDn:n}=e;return(0,D.jsx)(\"div\",{className:\"nco-monitor-station-archive-container\",children:(0,D.jsx)(\"div\",{className:\"station-archive-content\",children:(0,D.jsxs)(\"div\",{className:\"station-archive-content-body\",children:[(0,D.jsxs)(\"div\",{className:\"station-archive-album\",children:[(0,D.jsx)(\"div\",{className:\"archive-album-title common-title\",children:t.formatMessage({id:\"ncoNewDeviceManagement.form.item.label.image\"},undefined)}),(0,D.jsxs)(\"div\",{className:\"archive-album-list\",children:[(0,D.jsx)(Te.Z,{dn:n}),(0,D.jsx)(\"div\",{style:{marginTop:\"0.75rem\"},children:(0,D.jsx)(ve,{title:\"neteco.pvms.stationInfo.addStation.archive.more6Limit20\"})})]})]}),(0,D.jsx)(Ce,{dn:n})]})})})}));var Ee=n(23774),Oe=n(46933);class Me extends l.Component{render(){const{deviceDn:e,isFromSubmatrix:t,companyDn:n,parentDn:r,onChildTabChange:i,props:o={},isOneStation:a,selectedTreeNode:s}=this.props,{match:l}=o;return(0,D.jsx)(\"div\",{className:\"nco-monitor-station-overview tab-content\",children:(0,D.jsx)(\"div\",{className:\"content\",children:(0,D.jsx)(\"div\",{className:\"left-content\",children:(0,D.jsx)(Oe.Z,{stationDn:e,isFromSubmatrix:t,companyDn:n,parentDn:r,onChildTabChange:i,urlParams:l,isOneStation:a,selectedTreeNode:s})})})})}}const Pe=Me,De=(0,Ee.$j)((e=>({})),(e=>({})))(Pe);var Ie=n(74794),Ne=n(46771),_e=n(37825),je=n(26180),ke=n(22339),Le=n(63042),Re=n(94852),Ze=n(57566),Be=n(16426);const Fe={ncoPvTable:ke.Z,ncoPvToolbar:Le.Z,ncoMonitorPvSearchBar:Re.Z,ncoMonitorPvTable:ke.Z,ncoDevicePropConfigModal:Ze.Z,ncoMonitorExportDeviceData:Be.Z};class ze extends l.Component{constructor(e){super(e);const t=(0,je.UY)(Fe);this.store=(0,je.MT)(t)}render(){const{deviceDn:e,selectedTreeNode:t}=this.props;return(0,D.jsx)(\"div\",{className:\"nco-monitor-station-overview tab-content\",children:(0,D.jsx)(\"div\",{className:\"content\",children:(0,D.jsx)(\"div\",{className:\"left-content\",children:(0,D.jsx)(Ee.zt,{store:this.store,children:(0,D.jsx)(Ie.Bo,{children:n=>{let{type:r}=n;const i=r===_e.M5.smartpvms;return(0,D.jsx)(Ne.l,{isSingleStation:!0,parentDn:e,isHostMode:i,selectedTreeNode:t})}})})})})})}}const Ve=ze,He=(0,Ee.$j)((e=>({})),(e=>({})))(Ve);var Ue=n(66915),Ge=n(74621);const Ye={stationDn:\"\",roleName:\"\",currentPage:1,pageSize:10},We=e=>{let{tableCondition:t,updateTableCondition:n,roleName:r,setRoleName:i,intl:o}=e;const[a]=fe.Z.useForm(),s=(e=>{const t=[{value:\"\",label:o.formatMessage({id:\"neteco.pvms.all\"})}];return e.forEach((e=>{const{roleKey:n,msgKey:r}=e;t.push({value:n,label:o.formatMessage({id:r})})})),t})([Ge.L.companyManager,Ge.L.installer,Ge.L.owner,Ge.L.guest]);return(0,D.jsx)(\"div\",{className:\"nco-stationUser-toolbar-container\",children:(0,D.jsxs)(fe.Z,{className:\"nco-stationUser-search-form\",layout:\"inline\",autoComplete:\"off\",form:a,children:[(0,D.jsx)(fe.Z.Item,{name:\"roleName\",label:o.formatMessage({id:\"neteco.pvms.systemSetting.roleName.label\"}),initialValue:r,children:(0,D.jsx)(Ue.Z,{style:{width:\"15rem\"},options:s,onSelect:e=>{i(e)}})}),(0,D.jsx)(fe.Z.Item,{children:(0,D.jsx)(h.Z,{type:\"primary\",onClick:()=>{n({currentPage:Ye.currentPage,pageSize:Ye.pageSize,roleName:r.trim()})},children:o.formatMessage({id:\"common.button.search\"})})}),(0,D.jsx)(fe.Z.Item,{children:(0,D.jsx)(h.Z,{onClick:()=>{i(\"\"),a.setFieldsValue({roleName:\"\"});const e={...Ye};e.stationDn=t.stationDn,n(e)},children:o.formatMessage({id:\"common.button.reset\"})})})]})})},Ke=l.memo(We);var qe=n(80928),Qe=n.n(qe),Xe=(n(22864),[\"className\",\"rotate\",\"spin\",\"style\",\"color\"]);function Je(e){return Je=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e},Je(e)}function $e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function et(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$e(Object(n),!0).forEach((function(t){tt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$e(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function tt(e,t,n){return t=function(e){var t=function(e){if(\"object\"!==Je(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,\"string\");if(\"object\"!==Je(n))return n;throw new TypeError(\"@@toPrimitive must return a primitive value.\")}return String(e)}(e);return\"symbol\"===Je(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var nt=function(e){return(0,D.jsx)(\"svg\",et(et({fill:\"currentColor\",viewBox:\"0 0 24 24\",width:\"1em\",height:\"1em\"},e),{},{children:(0,D.jsx)(\"path\",{d:\"M11.4232812890625,12.36578369140625C14.3228212890625,12.36578369140625,16.6733212890625,10.01528369140625,16.6733212890625,7.11578369140625C16.6733212890625,4.21628369140625,14.3228212890625,1.86578369140625,11.4232812890625,1.86578369140625C8.5237812890625,1.86578369140625,6.1732812890625,4.21628369140625,6.1732812890625,7.11578369140625C6.1732812890625,10.01528369140625,8.5237812890625,12.36578369140625,11.4232812890625,12.36578369140625ZM14.0749212890625,4.46413369140625Q15.1733212890625,5.56248369140625,15.1733212890625,7.11578369140625Q15.1733212890625,8.66908369140625,14.0749212890625,9.76743369140625Q12.9766212890625,10.86578369140625,11.4232812890625,10.86578369140625Q9.869981289062501,10.86578369140625,8.771631289062501,9.76743369140625Q7.6732812890625,8.66908369140625,7.6732812890625,7.11578369140625Q7.6732812890625,5.56248369140625,8.771631289062501,4.46413369140625Q9.869981289062501,3.36578369140625,11.4232812890625,3.36578369140625Q12.9766212890625,3.36578369140625,14.0749212890625,4.46413369140625ZM17.3118212890625,22.25248369140625C17.6588212890625,22.45248369140625,18.047821289062497,22.55348369140625,18.4368212890625,22.55348369140625Q19.2148212890625,22.45248369140625,19.5618212890625,22.25248369140625L22.0588212890625,20.81048369140625C22.7518212890625,20.40948369140625,23.1828212890625,19.66248369140625,23.1828212890625,18.86248369140625L23.1828212890625,15.97948369140625C23.1828212890625,15.18048369140625,22.7518212890625,14.43348369140625,22.0578212890625,14.03148369140625L19.5618212890625,12.59048369140625C18.8688212890625,12.18948369140625,18.0068212890625,12.18948369140625,17.3118212890625,12.59048369140625L14.8148212890625,14.03148369140625C14.1218212890625,14.43348369140625,13.6908212890625,15.18048369140625,13.6908212890625,15.97948369140625L13.6908212890625,18.86248369140625C13.6908212890625,19.66248369140625,14.1218212890625,20.40948369140625,14.8158212890625,20.81048369140625L17.3118212890625,22.25248369140625ZM12.4764212890625,14.92578369140625Q12.4764212890625,14.92648369140625,12.1373212890625,14.91788369140625Q11.8818212890625,14.91138369140625,11.7511012890625,14.90708369140625Q8.2686612890625,14.79278369140625,5.7239312890625005,16.42668369140625Q3.6168212890625,17.77948369140625,3.6168212890625,19.09638369140625Q3.6168212890625,19.82048369140625,5.3226812890624995,20.11468369140625Q6.7012912890625,20.35248369140625,10.8633712890625,20.34418369140625Q11.4676712890625,20.34298369140625,11.7756912890625,20.34298369140625C12.1899212890625,20.34298369140625,12.5257212890625,20.67878369140625,12.5257212890625,21.09298369140625C12.5257212890625,21.50718369140625,12.1899212890625,21.84298369140625,11.7756912890625,21.84298369140625Q11.4692312890625,21.84298369140625,10.8663712890625,21.84418369140625Q6.5743512890625,21.85278369140625,5.067711289062499,21.59288369140625Q2.1168212890625,21.08388369140625,2.1168212890625,19.09638369140625Q2.1168212890625,16.95998369140625,4.9135212890624995,15.16438369140625Q7.8511712890625,13.27828369140625,11.8002912890625,13.40788369140625Q11.9254512890625,13.41198369140625,12.1754212890625,13.41828369140625Q12.1267212890625,13.41138369140625,12.1269212890625,13.40928369140625Q12.1274212890625,13.40478369140625,12.3529212890625,13.42238369140625C12.7432212890625,13.45298369140625,13.0443212890625,13.77898369140625,13.0443212890625,14.17048369140625C13.0443212890625,14.57908369140625,12.7175212890625,14.91138369140625,12.3110212890625,14.92028369140625Q12.2770212890625,14.91928369140625,12.2357212890625,14.91798369140625C12.2552212890625,14.91958369140625,12.2747212890625,14.92048369140625,12.2943212890625,14.92048369140625C12.2999212890625,14.92048369140625,12.3054212890625,14.92038369140625,12.3110212890625,14.92028369140625Q12.4764212890625,14.92528369140625,12.4764212890625,14.92578369140625ZM18.0618212890625,13.88948369140625C18.1778212890625,13.82248369140625,18.3068212890625,13.78948369140625,18.4368212890625,13.78948369140625Q18.6958212890625,13.82248369140625,18.8118212890625,13.88948369140625L21.3068212890625,15.33048369140625C21.5388212890625,15.46448369140625,21.6828212890625,15.71348369140625,21.6828212890625,15.97948369140625L21.6828212890625,18.86248369140625C21.6828212890625,19.12948369140625,21.5388212890625,19.37848369140625,21.3078212890625,19.51248369140625L18.8118212890625,20.95348369140625C18.5798212890625,21.08648369140625,18.2928212890625,21.08648369140625,18.0618212890625,20.95348369140625L15.5668212890625,19.51248369140625C15.3348212890625,19.37848369140625,15.1908212890625,19.12948369140625,15.1908212890625,18.86248369140625L15.1908212890625,15.97948369140625C15.1908212890625,15.71348369140625,15.3348212890625,15.46448369140625,15.5658212890625,15.33048369140625L18.0618212890625,13.88948369140625ZM16.1869212890625,17.42338369140625C16.1869212890625,18.66338369140625,17.1959212890625,19.67338369140625,18.4369212890625,19.67338369140625C19.6779212890625,19.67338369140625,20.6869212890625,18.66338369140625,20.6869212890625,17.42338369140625C20.6869212890625,16.18338369140625,19.6779212890625,15.17338369140625,18.4369212890625,15.17338369140625C17.1959212890625,15.17338369140625,16.1869212890625,16.18338369140625,16.1869212890625,17.42338369140625ZM17.6869212890625,17.42338369140625C17.6869212890625,17.01038369140625,18.022921289062502,16.67338369140625,18.4369212890625,16.67338369140625C18.8509212890625,16.67338369140625,19.1869212890625,17.01038369140625,19.1869212890625,17.42338369140625C19.1869212890625,17.836383691406247,18.8509212890625,18.17338369140625,18.4369212890625,18.17338369140625C18.022921289062502,18.17338369140625,17.6869212890625,17.836383691406247,17.6869212890625,17.42338369140625Z\",fillRule:\"evenodd\",fill:\"currentColor\"})}))};const rt=function(e){var t=e.className,n=e.rotate,r=e.spin,i=e.style,o=e.color,a=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,Xe),s=\"dpicon\",l={msTransform:\"rotate(\".concat(n,\"deg)\"),transform:\"rotate(\".concat(n,\"deg)\")},c=Boolean(n)?l:void 0,u=Qe()(s,t,tt({},\"\".concat(s,\"-spin\"),Boolean(r)));return(0,D.jsx)(\"span\",et(et({style:et({color:o},i),role:\"img\",className:u},a),{},{children:(0,D.jsx)(nt,{style:et({},c)})}))};var it=n(92998),ot=n(51665),at=n(9381),st=n(44184);const lt=e=>{const t=[];return e.forEach((e=>{var n;t.push({userName:e.userName,roleName:(null===(n=e.roles[0])||void 0===n?void 0:n.roleName)||\"--\",tenantAdmin:e.tenantAdmin,userType:e.userType,phoneNumber:e.extendParam.cellphone||\"--\",email:e.extendParam.email||\"--\",userId:e.userId,roleKey:e.roleKey,useStatus:(()=>{const t=e.stopUse,{locked:n}=e;return t?-1:n?-2:0})()})})),t},ct=async e=>new Promise((t=>{(0,O.v_)(\"/rest/neteco/web/organization/v2/users/check-contact-to-invite\",e).then((e=>{t(e)})).catch((()=>{t({success:!0,data:!1})}))}));var ut=n(4342),dt=n(72673),pt=n(2611),ft=n(11946),ht=n(68718),mt=n(20884);const gt=(0,o.ZP)((e=>{const{intl:t,showAddUserModal:n,setShowAddUserModal:r,companyDn:i,stationDn:o,mode:a}=e,[s,c]=(0,l.useState)(!1),[d,p]=(0,l.useState)(!1),[f]=_.Z.useForm(),g={labelCol:{sm:{span:6}},wrapperCol:{sm:{span:14}}},v=[],y={label:t.formatMessage({id:\"neteco.pvms.register.phoneNumber\"}),validateFirst:!0,rules:[{required:(0,ut.jA)(),message:t.formatMessage({id:\"neteco.pvms.systemSetting.notPhone\"})},{validator:(e,n)=>(0,st.q6)(\"phone\",null==n?void 0:n.number,t)}],validateTrigger:\"onBlur\",initialValue:{number:void 0,nationCode:\"0086\"},key:\"phone\",type:\"phone\"},b={label:t.formatMessage({id:\"neteco.pvms.systemSetting.tmail\"}),disabled:!1,rules:[{required:!(0,ut.jA)(),message:t.formatMessage({id:\"ncoCompanyManagement.userBasicInfo.message.inputValidEmail\"})},{validator:async(e,n)=>{if((0,ut.jA)()&&!n)return Promise.resolve();const r=(0,dt.L)(n,t);return r?Promise.reject(r):(\"create\"===a&&await ct({contactType:\"email\",content:n,companyDn:i}).then((e=>{const{success:n,failCode:r}=e;return n?Promise.resolve():Promise.reject(t.formatMessage({id:\"neteco.pvms.register.email.exsit\"}))})),Promise.resolve())}},{validator:(e,n)=>(0,st.q6)(\"email\",n,t)}],validateTrigger:\"onBlur\",initialValue:\"\",key:\"email\",type:\"input\",placeholder:t.formatMessage({id:\"neteco.pvms.input.email.address\"})},S={label:t.formatMessage({id:\"neteco.pvms.systemSetting.role\"}),validateFirst:!0,disabled:!0,rules:[{required:!0,message:\"\"}],validateTrigger:\"onBlur\",initialValue:t.formatMessage({id:\"neteco.pvms.userManagement.roles.owner\"}),key:\"role\",type:\"input\",placeholder:t.formatMessage({id:\"neteco.pvms.select.role\"})},x=(0,D.jsx)(_.Z.Item,{name:\"userAgreedDetail\",className:\"tail-form-item\",...g,label:\" \",rules:[{required:!0,message:t.formatMessage({id:\"neteco.pvms.userAgreedDetail\"})},{validator:async(e,n)=>n?Promise.resolve():Promise.reject(t.formatMessage({id:\"neteco.pvms.userAgreedDetail\"}))}],validateStatus:\"error\",help:t.formatMessage({id:\"neteco.pvms.userAgreedDetail\"}),children:(0,D.jsx)(\"div\",{children:(0,D.jsx)(ft.Z,{checked:s,onChange:e=>{c(e.target.checked)},children:t.formatMessage({id:\"neteco.pvms.userAgreed\"})})})});(0,ut.jA)()?v.push(y):v.push(b),v.push(S);const w={form:f,intl:t,mode:a,useDP:!0,placeholder:t.formatMessage({id:\"neteco.pvms.input.phone.number\"}),checkPhoneExists:e=>{let{type:t,value:n}=e;return ct({contactType:t,content:n,companyDn:i})}},C=e=>{const{type:t,disabled:n,placeholder:r}=e,i=e.maxLen?e.maxLen:void 0;switch(t){case\"input\":default:return(0,D.jsx)(u.Z,{maxLength:i,disabled:n,placeholder:r});case\"phone\":return(0,D.jsx)(pt.Z,{...w})}},T=()=>{r(!1),c(!1),f.resetFields()},A=async e=>{var n;const r=[o];p(!0);const i={...(0,ut.jA)()?{phone:null==e||null===(n=e.phone)||void 0===n?void 0:n.number}:{email:e.email},boundStationList:r},[a,s]=await(e=>{const t={email:e.email,phone:e.phone,boundStationList:e.boundStationList};return(0,st.AM)((0,O.v_)(\"/rest/dp/pvms/netecoorganizationservice/v2/users/owner/invite\",t))})(i);var l,c;if(p(!1),a)\"PVMS.00001400\"===(null==a||null===(l=a.responseJSON)||void 0===l?void 0:l.exceptionId)&&(T(),(0,L.lU)(t.formatMessage({id:null==a||null===(c=a.responseJSON)||void 0===c?void 0:c.reasonArgs[0]}),null,null,!0));else if(s){T();const e=(0,ut.jA)()?\"neteco.pvms.user.add.success.info.China\":\"neteco.pvms.user.add.success.info.noChina\";(0,L.Sb)(t.formatMessage({id:e}),null,t,null,!0)}else T(),(0,L.lU)(t.formatMessage({id:\"neteco.pvms.add.user.failed\"}),null,null,!0)},E=()=>new Promise((async e=>{const n=f.getFieldValue(\"phone\")||{},{number:r}=n;if(!(0,ut.jA)()||r)if(((0,ut.jA)()?mt.OA:mt.LS).test(r)){if((0,ut.jA)()){const n=await ct({contactType:\"phone\",content:r,companyDn:i}),{success:o,failCode:a}=n;if(o)return void e({hasError:!1});if(a===mt.PY.EXISTS)return void e({hasError:!0,message:t.formatMessage({id:\"neteco.pvms.register.phone.exsit\"})});if(a===mt.PY.FORMAT_ERROR||a===mt.PY.ERROR)return void e({hasError:!0,message:t.formatMessage({id:\"neteco.pvms.systemSetting.notPhone\"})})}e({hasError:!1})}else e({hasError:!0,message:t.formatMessage({id:\"neteco.pvms.systemSetting.notPhone\"})});else e({hasError:!0,message:t.formatMessage({id:\"neteco.pvms.systemSetting.notPhone\"})})}));return(0,D.jsx)(m.Z,{title:t.formatMessage({id:\"neteco.pvms.add.user\"}),visible:n,onCancel:T,maskClosable:!1,width:\"43rem\",footer:(0,D.jsxs)(\"div\",{className:\"nco-user-management-creat-btn-group\",children:[(0,D.jsx)(h.Z,{onClick:T,children:t.formatMessage({id:\"common.button.cancel\"})}),(0,D.jsx)(h.Z,{type:\"primary\",onClick:e=>(async e=>{e.preventDefault(),(0,ht.Ki)();const{hasError:n,message:r}=await E();if((0,ut.jA)()&&n)(e=>{f.setFields([{name:\"phone\",value:f.getFieldValue(\"phone\"),errors:[e||t.formatMessage({id:\"neteco.pvms.systemSetting.notPhone\"})]}])})(r);else{const e=await f.validateFields();A(e)}})(e),disabled:!s,loading:d,children:t.formatMessage({id:\"neteco.pvms.confirm\"})})]}),children:(0,D.jsxs)(\"div\",{className:\"add-user-info\",children:[(0,D.jsx)(_.Z,{name:\"nco-add-user-form\",form:f,children:v.map((e=>(0,D.jsx)(_.Z.Item,{name:e.key,validateTrigger:\"onBlur\",validateFirst:!0,initialValue:e.initialValue,rules:[...e.rules],label:e.label,...g,children:C(e)},e.key)))}),x]})})}));var vt=n(8394);const yt=e=>{let{loading:t,startLoading:n,stopLoading:r,tableCondition:o,updateTableCondition:a,intl:s,stationManageSwitch:c,stationDn:u,stationDnId:p,companyDn:f,tableHeight:v}=e;const[y,b]=(0,l.useState)([]),[S,x]=(0,l.useState)(0),[w,C]=(0,l.useState)(void 0),[T,A]=(0,l.useState)(!1),[E,M]=(0,l.useState)(0),[P,I]=(0,l.useState)(0),[N,_]=(0,l.useState)(!1),[k,L]=m.Z.useModal();(0,l.useEffect)((()=>{R(o);const e=window.getComputedStyle(document.documentElement).fontSize;M(1400),I(\"16px\"===e?600:1e3)}),[o]);const R=e=>{if(0===Object.keys(e).length)return;const t=(e=>({stationDn:e.stationDn,roleName:e.roleName,currentPage:e.currentPage,pageSize:e.pageSize}))(e);b([]),n(),async function(e){var t;const n={stationDn:e.stationDn,currentPage:e.currentPage,pageSize:e.pageSize};\"\"!==e.roleName&&(n.roleName=e.roleName);const[r,i]=await(0,st.AM)((0,O.v_)(\"/rest/dp/pvms/dporganizationwebsite/v2/users/query\",n));return r||{list:lt(i.data.list),total:i.data.total,plantAdmUserId:null===(t=i.data)||void 0===t?void 0:t.plantAdmUserId}}(t).then((e=>{r(),b(e.list),x(e.total),C(null==e?void 0:e.plantAdmUserId),A((0,ut.bG)().id===(null==e?void 0:e.plantAdmUserId))})).catch((e=>{r(),k.error({title:s.formatMessage({id:\"common.message.failure\"}),content:s.formatMessage({id:\"neteco.pvms.ncoSystemParameter.common.searchFailed\"}),okText:s.formatMessage({id:\"common.button.ok\"})})}))},Z=[{title:s.formatMessage({id:\"neteco.pvms.userDialog.userName\"}),dataIndex:\"userName\",width:160,ellipsis:!0},{title:s.formatMessage({id:\"neteco.pvms.systemSetting.roleName\"}),dataIndex:\"roleName\",width:150,render:(e,t)=>{let n=e;const r=t.userType,i=t.tenantAdmin,o=t.userId===w;return Object.keys(Ge.L).forEach((t=>{const{roleKey:r,msgKey:i}=Ge.L[t];r===e&&(n=s.formatMessage({id:i}))})),0===r?(0,D.jsxs)(\"div\",{className:\"role-container\",children:[(0,j.QM)(n,180),i&&(0,D.jsx)(d.Z,{title:s.formatMessage({id:\"neteco.pvms.componentManage.companyManager\"}),placement:\"right\",getPopupContainer:()=>document.querySelector(\".nco-station-user-table\")||document.body,children:(0,D.jsx)(rt,{className:\"admin-icon\"})}),o&&(0,D.jsx)(d.Z,{title:s.formatMessage({id:\"neteco.pvms.super.owner.have.permission\"}),placement:\"right\",getPopupContainer:()=>document.querySelector(\".nco-station-user-table\")||document.body,children:(0,D.jsx)(rt,{className:\"admin-icon\"})})]}):(0,j.QM)(n,200)}},{title:s.formatMessage({id:\"neteco.pvms.register.column.phoneNumber\"}),dataIndex:\"phoneNumber\",width:80,ellipsis:!0},{title:s.formatMessage({id:\"neteco.pvms.systemSetting.tmail\"}),dataIndex:\"email\",width:200,render:e=>(0,j.QM)(e,200)},{title:s.formatMessage({id:\"neteco.pvms.user.account.useStatus\"}),dataIndex:\"useStatus\",width:150,render:e=>-1===e?(0,D.jsx)(\"span\",{className:\"color-red\",children:s.formatMessage({id:\"ncoCompanyManagement.userTable.column.userDeactivated\"})}):-2===e?(0,D.jsx)(\"span\",{className:\"color-grey\",children:s.formatMessage({id:\"ncoCompanyManagement.userTable.column.userLocked\"})}):(0,D.jsx)(\"span\",{className:\"color-green\",children:s.formatMessage({id:\"common.message.status.normal\"})})}],B={title:s.formatMessage({id:\"common.label.action\"}),dataIndex:\"action\",width:200,render:(e,t)=>{const n=t.userId===w,r=t.roleKey===ut.xZ.owner;return!n&&r&&(0,D.jsxs)(\"div\",{children:[(0,D.jsx)(d.Z,{title:s.formatMessage({id:\"neteco.pvms.unbind.btn.tips\"}),getPopupContainer:e=>e.parentNode||document.body,placement:\"left\",children:(0,D.jsx)(h.Z,{shape:\"circle\",type:\"text\",onClick:()=>{(e=>{vt.Z.confirm({message:s.formatMessage({id:\"neteco.pvms.super.owner.confirm.unbind\"}),onOk:async()=>{(0,ht.xU)();const t={userId:e.userId,stationDnId:p},n=await(async e=>{const t={userId:e.userId,stationDnId:Number(e.stationDnId)},[n,r]=await(0,st.AM)((0,O.v_)(\"/rest/dp/pvms/netecoorganizationservice/v2/users/owner/unbind\",t));return!(n||null==r||!r.result)&&(null==r?void 0:r.result)})(t);n?(i.ZP.success(s.formatMessage({id:\"common.message.success\"})),R(o)):i.ZP.error(s.formatMessage({id:\"common.message.failure\"}))},isNewStyle:!0})})(t)},icon:(0,D.jsx)(it.Z,{className:\"icon-color\"})})}),(0,D.jsx)(d.Z,{title:s.formatMessage({id:\"neteco.pvms.transfer.btn.tips\"}),getPopupContainer:e=>e.parentNode||document.body,placement:\"right\",children:(0,D.jsx)(h.Z,{shape:\"circle\",type:\"text\",onClick:()=>{(e=>{vt.Z.confirm({message:s.formatMessage({id:\"netco.pvms.super.owner.confirm.transfer.permission\"}),onOk:async()=>{(0,ht.gs)();const t={userId:e.userId,stationDnId:p},n=await(async e=>{const t={stationDnId:Number(e.stationDnId),userId:e.userId},[n,r]=await(0,st.AM)((0,O.v_)(\"/rest/dp/pvms/netecoorganizationservice/v2/users/owner/transfer/right\",t));return!(n||null==r||!r.result)&&(null==r?void 0:r.result)})(t);n?(i.ZP.success(s.formatMessage({id:\"common.message.success\"})),R(o)):i.ZP.error(s.formatMessage({id:\"common.message.failure\"}))},isNewStyle:!0})})(t)},icon:(0,D.jsx)(ot.Z,{className:\"icon-color\"})})})]})}},F=c&&T?Z.concat(B):Z,{currentPage:z=1,pageSize:V=10}=o||{};return(0,D.jsxs)(\"div\",{children:[c&&T&&(0,D.jsx)(\"div\",{className:\"nco-add-user \"+((0,ut.jq)()?\"\":\"no-user-owner\"),children:(0,D.jsx)(h.Z,{type:\"primary\",loading:t,onClick:()=>_(!0),children:s.formatMessage({id:\"neteco.pvms.add.user\"})})}),(0,D.jsxs)(\"div\",{className:\"nco-station-user-table-wrapper\",children:[(0,D.jsx)(g.Z,{className:\"nco-station-user-table\",rowKey:\"name\",loading:t,columns:F,showSorterTooltip:!1,dataSource:y,pagination:!1,scroll:{y:v}}),(0,D.jsx)(at.Z,{className:\"nco-station-user-pagination\",total:S,totalFixedLeft:!0,showSizeChanger:!0,showTotal:()=>s.formatMessage({id:\"neteco.pvms.station.subarray.pagination.total\"},{total:S}),current:z,pageSize:V,pageSizeOptions:[\"10\",\"20\",\"50\",\"100\"],onChange:(e,n)=>{t||a({currentPage:e,pageSize:n})},onShowSizeChange:(e,n)=>{t||a({currentPage:1,pageSize:n})}})]}),(0,D.jsx)(gt,{intl:s,mode:\"create\",showAddUserModal:N,setShowAddUserModal:_,companyDn:f,stationDn:u}),L]})};var bt=n(5807),St=n(45995),xt=n(51523),wt=n.n(xt),Ct=n(55751);const Tt=(0,o.ZP)((e=>{let{intl:t,stationDn:n,stationDnId:r}=e;const[i,o]=(0,l.useState)(!1),[a,c]=(0,l.useState)({}),[u,d]=(0,l.useState)(\"\"),[p,f]=(0,l.useState)(10),[h,m]=(0,l.useState)(!1),[g,b]=(0,l.useState)(null),[S,x]=(0,l.useState)(395);(0,l.useEffect)((()=>{const e={...Ye};return e.stationDn=n,C(e),bt.Z.getCurrentCompany().then((e=>{(0,st.xb)(e)||b(null==e?void 0:e.moDn)})),St.Z.getConfigSwitch(St.j.ENABLE_STATION_OWNER_ADMIN).then((e=>{m(e)})),window.addEventListener(\"resize\",w),()=>{window.removeEventListener(\"resize\",w)}}),[]);const w=wt()((()=>{var e,t;const n=(0,ut.jq)()?103:(null===(e=document.querySelector(\".nco-user-station-container .nco-stationUser-toolbar-container\"))||void 0===e||null===(t=e.getBoundingClientRect())||void 0===t?void 0:t.height)+103,r=(0,Ct.h)(\".nco-user-station-container\",n);x(r)}),300),C=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};f(e.pageSize),c((t=>({...t,...e,timestamp:s()().format(\"x\")})))},T={tableCondition:a,updateTableCondition:C,setRoleName:d,roleName:u,intl:t},A={loading:i,startLoading:()=>{o(!0)},stopLoading:()=>{o(!1)},tableCondition:a,updateTableCondition:C,intl:t,stationManageSwitch:h,stationDn:n,stationDnId:r,companyDn:g,tableHeight:S},E=(0,D.jsx)(\"div\",{className:\"nco-station-user tab-content\",children:(0,D.jsx)(\"div\",{className:\"content\",children:(0,D.jsx)(\"div\",{className:\"left-content\",children:(0,D.jsxs)(\"div\",{className:\"nco-user-station-container\",children:[!(0,ut.jq)()&&(0,D.jsx)(Ke,{...T}),(0,D.jsx)(yt,{...A})]})})})});return(0,v.lVp)(v.yDu)?E:(0,D.jsx)(y.Z,{})}));var At=n(33792),Et=n(53309),Ot=n(12048),Mt=n(97435),Pt=n(4905),Dt=n(346),It=n(18218),Nt=n(70250),_t=n.n(Nt),jt=n(35564),kt=n(13528),Lt=n(61859);const Rt=(e,t,n,r)=>{const i=_t()(e),o=_t()(t);return n&&(i.unshift(n),o.unshift(r)),i.map(((e,t)=>({value:[e,o[t]]})))};function Zt(e){const t=[];let n=[];return e.forEach((e=>{e===V.lH?(n.length>0&&(t.push(n),n=[]),t.push([V.lH])):n.push(e)})),n.length>0&&t.push(n),t}function Bt(e,t){const n=[];let r=0;return t.map(((t,i)=>{const o=e.slice(r,r+t.length);r+=t.length,n.push(o)})),n}const Ft={top:\"8%\",left:\"0%\",right:\"0%\",containLabel:!0},zt={itemWidth:8,itemHeight:8,bottom:0},Vt=(e,t)=>({color:{type:\"linear\",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:e},{offset:1,color:\"rgba(0, 0, 0, 0)\"}],globalCoord:!0},opacity:t?.3:.8}),Ht={type:\"line\",smooth:!0,color:\"rgba(25, 25, 25, 1)\",yAxisIndex:0,markLine:{label:{show:!1},lineStyle:{width:1,type:\"solid\"},symbol:\"none\",emphasis:{disabled:!0},data:[{yAxis:\"0\"}]}},Ut=function(e,t,n,r,i,o,a){let s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2;return{name:e,type:\"line\",smooth:!0,color:t,yAxisIndex:r,data:Rt(n,(0,S.sD)(i,s),o,a)}},Gt=function(e,t,n,r,i,o,a){let s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2;return{name:e,type:\"line\",smooth:!0,color:t,yAxisIndex:r,data:Rt(n,(0,S.Oy)(i,s),o,a)}},Yt=[{type:\"slider\",realtime:!0,fillerColor:\"rgba(233,239,255,0.7)\",labelFormatter:(e,t)=>t.substring(11,16),handleSize:\"100%\",handleStyle:{borderDashOffset:1,borderType:\"solid\",borderWidth:4},start:0,handleColor:\"#648CFA\",end:100,height:\"5%\",bottom:\"10%\",filterMode:\"empty\"}],Wt=(e,t)=>({PVInverterPower:e(\"neteco.pvms.power.pv.inverterPower\"),userCapPower:e(\"neteco.pvms.power.userCapPower\"),aiDisAndChargePower:e(\"neteco.pvms.ncoMonitor.station.batteryChargeDischargePower\"),storeInPower:e(\"neteco.pvms.power.storeInPower\"),storeOutPower:e(\"neteco.pvms.power.storeOutPower\"),limitPower:e(\"neteco.pvms.aifc.powerLimitCableAtGridTiedPoint.fie\"),PVForecastPower:e(\"neteco.pvms.aifc.PVForecastPower\"),loadForecastPower:e(\"neteco.pvms.aifc.loadForecastPower.fie\"),powerPrice:e(\"neteco.pvms.aifc.price.fie\"),socDefault:e(\"neteco.pvms.aifc.SOC.default\"),socEMMA:e(\"neteco.pvms.aifc.SOC.Ai\",{0:e((0,st.Z4)(\"\",t))}),buyPowerDefault:e(\"neteco.pvms.aifc.buyPower.default\"),buyPowerEMMA:e(\"neteco.pvms.aifc.buyPower.Ai\",{0:e((0,st.Z4)(\"\",t))})}),Kt=e=>({PVInverterPower:e(\"neteco.pvms.power.pv.inverterPower\"),userCapPower:e(\"neteco.pvms.power.userCapPower\"),buyCapPower:e(\"neteco.pvms.aifc.buyCapPower\"),aiDisAndChargePower:e(\"neteco.pvms.ncoMonitor.station.batteryChargeDischargePower\"),buyCapPrice:e(\"neteco.pvms.aifc.buyCapPrice\"),onGridPrice:e(\"neteco.pvms.aifc.onGridPrice\"),socDefault:e(\"neteco.pvms.aifc.SOC.default\"),socEMMA:e(\"neteco.pvms.aifc.SOC.Ai\",{0:e((0,st.Z4)(\"\",!1))}),chargePowerAi:e(\"neteco.pvms.power.storeInPower\"),dischargePowerAi:e(\"neteco.pvms.power.storeOutPower\")}),qt=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return{PVInverterPower:e(\"neteco.pvms.power.pv.inverterPower\"),loadPower:e(\"neteco.pvms.load.power\"),gridPower:e(\"neteco.pvms.grid.power\"),storePowerDefault:e(\"neteco.pvms.power.storePower.default\"),storePowerAi:e(\"neteco.pvms.power.storePower.SmartEmo\",{0:e((0,st.Z4)(\"\",t))}),chargePowerDefault:e(\"neteco.pvms.power.storeInPower.default\"),dischargePowerDefault:e(\"neteco.pvms.power.storeOutPower.default\"),chargePowerAi:e(\"neteco.pvms.power.storeInPower.SmartEmo\",{0:e((0,st.Z4)(\"\",t))}),dischargePowerAi:e(\"neteco.pvms.power.storeOutPower.SmartEmo\",{0:e((0,st.Z4)(\"\",t))}),disGridPower:e(\"neteco.pvms.grid.power.buyPower\"),onGridPower:e(\"neteco.pvms.grid.power.sellPower\"),powerPrice:e(\"neteco.pvms.aifc.price.fie\"),socDefault:e(\"neteco.pvms.aifc.SOC.default\"),socEMMA:e(\"neteco.pvms.aifc.SOC.Ai\",{0:e((0,st.Z4)(\"\",t))})}},Qt=(e,t)=>{let{fcProductPowerXAxis:n,fcProductPowerArray:r,intlMessage:i,now:o,nowPVData:a}=e;const{PVForecastPower:s}=Wt(i),l=t?Lt.nZ.PVForecastPower:Lt.J3.PVForecastPower,c=t?{type:\"line\",width:0}:{type:\"dashed\"},u=t?{}:null,d=[];return r.map(((e,t)=>{0===t?d.push({...Gt(s,l,n[t],1,e,o,a,3),lineStyle:c,areaStyle:u,connectNulls:!(1===e.length&&(0,kt.s)(e[0]))}):d.push({...Gt(s,l,n[t],1,e,null,null,3),lineStyle:c,areaStyle:u,connectNulls:!(1===e.length&&(0,kt.s)(e[0]))})})),d},Xt=(e,t)=>{let{fcUsePowerXAxis:n,fcUsePowerArray:r,intlMessage:i,now:o,nowLoadData:a}=e;const{loadForecastPower:s}=Wt(i),l=t?Lt.nZ.loadForecastPower:Lt.J3.loadForecastPower,c=t?{type:\"line\",width:0}:{type:\"dashed\"},u=t?{}:null,d=[];return r.map(((e,t)=>{0===t?d.push({...Gt(s,l,n[t],1,e,o,a,3),lineStyle:c,areaStyle:u,connectNulls:!(1===e.length&&(0,kt.s)(e[0]))}):d.push({...Gt(s,l,n[t],1,e,null,null,3),lineStyle:c,areaStyle:u,connectNulls:!(1===e.length&&(0,kt.s)(e[0]))})})),d};function Jt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:\"HH:mm\";return 20===e.length&&(e=e.substring(0,16)),s()(e).format(t)}const $t=(e,t,n)=>{const{PVInverterPower:r,userCapPower:i,buyCapPower:o,aiDisAndChargePower:a,buyCapPrice:s,onGridPrice:l,socEMMA:c}=Kt(e),{productPower:u,usePower:d,aiChargeAndDischargePower:p,aiDisGridPower:f,priceData:h,onGridPriceData:m,aiSocData:g}=t,v=n?[o,a,i,r]:[c],y=n?{aiDisGridPower:f,aiChargeAndDischargePower:p,usePower:d,productPower:u}:{aiSocData:g},b=[l,s],S={onGridPriceData:m,priceData:h};return{legendAndDataMap:{[r]:{productPower:u},[i]:{usePower:d},[a]:{aiChargeAndDischargePower:p},[o]:{aiDisGridPower:f},[s]:{priceData:h},[l]:{onGridPriceData:m},[c]:{aiSocData:g}},leftOriginData:y,leftOriginLegend:v,rightOriginData:S,rightOriginLegend:b}},en=(e,t,n)=>{const{PVInverterPower:r,loadPower:i,gridPower:o,storePowerDefault:a,storePowerAi:s,socDefault:l,socEMMA:c,powerPrice:u}=qt(e),{productPower:d,usePower:p,meterActivePower:f,stdChargeAndDischargePower:h,aiChargeAndDischargePower:m,stdSocData:g,aiSocData:v,priceData:y}=t,b=n?[s,a,o,i,r]:[l,c],S=n?{aiChargeAndDischargePower:m,stdChargeAndDischargePower:h,meterActivePower:f,usePower:p,productPower:d}:{stdSocData:g,aiSocData:v},x=n?[]:[u],w=n?{}:{priceData:y};return{legendAndDataMap:{[r]:{productPower:d},[i]:{usePower:p},[o]:{meterActivePower:f},[a]:{stdChargeAndDischargePower:h},[s]:{aiChargeAndDischargePower:m},[l]:{stdSocData:g},[c]:{aiSocData:v},[u]:{priceData:y}},leftOriginData:S,leftOriginLegend:b,rightOriginData:w,rightOriginLegend:x}};var tn=n(31483),nn=n(98863),rn=n(98455),on=n(31519);class an extends l.Component{constructor(){var e;super(...arguments),e=this,this.intlMessage=(e,t)=>this.props.intl.formatMessage({id:e},t),this.state={openDays:null,realCurrency:null,revenueRatio:null,showRevenuePercent:!1,period:\"year\",currentYear:s()().startOf(\"year\"),currentMonth:s()().startOf(\"month\"),revenueLoading:!1,priceLoading:!0,aiEnergyLoading:!0,currencyUnit:V.lH,revenueData:{xaxis:[],stdRevenue:[],aiRevenue:[],measureUnit:V.lH},aiEnergyData:{xlAxis:[]},hasPrice:!1,hasOnGridTariff:!1,hasPurchaseTariff:!1,energySavingAlyLoading:!1,energySavingAlyData:{xAxis:[]},operateEnergyLegend:null,energyDataZoom:null,operateSocAlyLegend:null,operateNotSocAlyLegend:null,notSocAlyDataZoom:null,socAlyDataZoom:null,plantStatusTip:\"\",hasAiRevenue:void 0,startScheduleDate:void 0,gridConnectDayLimit:30},this.getAiFCRevenue=()=>{It.Z.queryAiRevenue(this.props.stationDn).then((e=>{const{success:t,data:n}=e;if(t){const{openDays:e=V.lH,realRevenue:t=V.lH,revenueRatio:r=V.lH,showRevenuePercent:i,measureUnit:o,errorTips:a=[],hasAiRevenue:s=!0,emmaStartSchedulingTime:l,emmaGridConnectedDayLimit:c}=n,u=(0,Pt.JI)(t,o),d=this.props.intl.formatMessage({id:\"neteco.pvms.batchmove.end\"}),p=this.props.intl.formatMessage({id:\"neteco.pvms.batchmove.semicolon\"});let f=\"\";const h=a.filter((e=>!(0,st.xb)(null==e?void 0:e.webMsg)));h.forEach(((e,t)=>{null!=e&&e.webMsg&&(f+=e.webMsg,t===h.length-1?f+=d:f+=p)})),this.setState({openDays:e,realCurrency:u,revenueRatio:r,currencyUnit:o,showRevenuePercent:i,plantStatusTip:f,hasAiRevenue:s,startScheduleDate:l,gridConnectDayLimit:c})}else this.setState({hasAiRevenue:!0})}))},this.getAiRevenueReport=()=>{if(this.state.hasPrice){const e={year:0,lifetime:1,month:2},{period:t,currentYear:n,currentMonth:r}=this.state,i=\"month\"===t?s()(r):s()(n).year();this.setState({revenueLoading:!0,revenueData:{xaxis:[],stdRevenue:[],aiRevenue:[],measureUnit:V.lH}}),It.Z.getAiRevenueReport(this.props.stationDn,e[t],i).then((e=>{const{success:t,data:n}=e;t&&this.setState({revenueData:n})})).finally((()=>{this.setState({revenueLoading:!1})}))}},this.getEnergyAnayReport=()=>{this.setState({aiEnergyLoading:!0,aiEnergyData:{xlAxis:[]}}),It.Z.getAiEnergyAnalysis(this.props.stationDn).then((e=>{const{code:t,data:n}=e;0===t&&this.setState({aiEnergyData:n,operateEnergyLegend:null,energyDataZoom:null})})).finally((()=>{this.setState({aiEnergyLoading:!1})}))},this.getEnergySavingAnalysis=()=>{this.setState({energySavingAlyLoading:!0,energySavingAlyData:{...this.state.energySavingAlyData,xlAxis:[]}}),It.Z.getEnergySavingAnalysis(this.props.stationDn).then((e=>{if(e.data){const{stdSocData:t,aiSocData:n,priceData:r,onGridPriceData:i,...o}=e.data,a=null==t?void 0:t.map((e=>isNaN(e)?V.lH:100*Number(e))),s=null==n?void 0:n.map((e=>isNaN(e)?V.lH:100*Number(e))),l=null==r?void 0:r.map((e=>isNaN(e)?V.lH:e)),c=null==i?void 0:i.map((e=>isNaN(e)?V.lH:e));this.setState({energySavingAlyData:{...o,priceData:l,onGridPriceData:c,stdSocData:a,aiSocData:s},operateSocAlyLegend:null,operateNotSocAlyLegend:null,socAlyDataZoom:null,notSocAlyDataZoom:null})}})).finally((()=>{this.setState({energySavingAlyLoading:!1})}))},this.selectPeriodHandler=e=>{e!==this.state.prevPeriod&&this.setState({period:e,currentYear:s()().startOf(\"year\"),currentMonth:s()().startOf(\"month\")},this.getAiRevenueReport)},this.forwardOrNextDate=e=>{this.setState((t=>\"month\"===t.period?{currentMonth:s()(t.currentMonth).add(e,\"month\")}:{currentYear:s()(t.currentYear).add(e,\"year\")}),this.getAiRevenueReport)},this.handTimeChange=e=>{\"month\"===this.state.period?this.setState({currentMonth:e},this.getAiRevenueReport):this.setState({currentYear:e},this.getAiRevenueReport)},this.chartLegendChange=e=>{this.setState({lengedState:e.selected})},this.getAIOrEMMAInfo=function(){var t,n;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"0\";const{isIndustryStation:i}=e.props;return i&&(0,ut.jA)()&&\"zh-cn\"===(null===(t=window.neteco)||void 0===t||null===(n=t.i18n)||void 0===n?void 0:n.getLocale())?{[r]:\"AI\"}:{[r]:e.intlMessage((0,st.Z4)(\"\",i))}},this.showHundredPlus=e=>{const{isIndustryStation:t}=this.props;return t||isNaN(Number(e))||e<=100?(0,kt.af)((0,S.sp)(e)):\">100\"},this.startScheduleTip=e=>{const{startScheduleDate:t,gridConnectDayLimit:n}=this.state;return t?(0,D.jsxs)(\"span\",{className:\"serviceDays-label\",children:[this.intlMessage(\"neteco.pvms.aifc.revenueInfo.serviceDays.expectDate\",{service:e,date:t}),(0,D.jsx)(me.Z,{placement:\"right\",title:this.intlMessage(\"neteco.pvms.aifc.revenueInfo.serviceDays.expectDate.tip\",{0:n}),children:(0,D.jsx)(\"i\",{className:\"icon-questionmark-circle-lined emma-expectDate-tip\"})})]}):this.intlMessage(\"neteco.pvms.aifc.revenueInfo.serviceDays\",{AIName:e})},this.titleCard=()=>{const{isIndustryStation:e}=this.props,{openDays:t,realCurrency:n,revenueRatio:r,showRevenuePercent:i}=this.state,o=this.intlMessage((0,st.Z4)(\"\",e)),a=e?this.intlMessage(\"neteco.pvms.aifc.revenueInfo.serviceDays\",{AIName:o}):this.startScheduleTip(o),s=e?this.intlMessage(\"neteco.pvms.smsrc.stationRevenue.revenueRatio.tip\",{AIName:o}):this.intlMessage(\"neteco.pvms.aifc.report.revenue.low.tip\"),l=[{svgUrl:\"/pvmswebsite/assets/build/images/station/ic_time.svg\",value:t?(0,kt.af)(t):V.lH,unit:t?this.intlMessage((0,tn.G)(t)?\"neteco.pvms.aifc.revenueInfo.day.plural\":\"neteco.pvms.aifc.revenueInfo.day.singular\"):\"\",label:a},{svgUrl:\"/pvmswebsite/assets/build/images/station/ic_revenue.svg\",value:n?(0,Pt.J_)((0,S.sp)(n.value)):V.lH,unit:n?n.unit:\"\",label:this.intlMessage(\"neteco.pvms.aifc.revenueInfo.realCurrency\")}];i&&l.push({svgUrl:\"/pvmswebsite/assets/build/images/station/ic_revenue_ratio.svg\",value:r?this.showHundredPlus(r):V.lH,unit:r?\"%\":\"\",label:(0,D.jsxs)(\"span\",{className:\"revenueRatio-label\",children:[this.intlMessage(\"neteco.pvms.aifc.revenueInfo.revenueRatio\"),(e||!isNaN(r)&&Number(r)<1)&&(0,D.jsx)(me.Z,{placement:\"right\",title:s,children:(0,D.jsx)(\"i\",{className:\"icon-questionmark-circle-lined\"})})]})});const c=l.map((e=>(0,D.jsxs)(\"div\",{className:\"title-card-body\",children:[(0,D.jsx)(\"img\",{src:e.svgUrl,className:\"img\"}),(0,D.jsxs)(\"div\",{className:\"title-card-message\",children:[(0,D.jsxs)(\"div\",{className:\"title-card-data\",children:[(0,D.jsx)(\"span\",{className:\"title-card-value\",children:e.value}),(0,D.jsx)(\"span\",{className:\"title-card-unit\",children:e.unit})]}),(0,D.jsx)(\"div\",{className:\"title-card-label\",children:e.label})]})]})));return e&&(0,v.lVp)(v.mxS)&&c.push((0,D.jsxs)(\"div\",{className:\"nco-to-EMMARevenue\",onClick:()=>this.props.history.push(`/view/station/${this.props.stationDn}/station-revenue/${V.Ft.EMMA}`),children:[(0,D.jsx)(\"span\",{children:this.intlMessage(\"neteco.pvms.smsrc.stationRevenue.tab.emma\",{AIName:o})}),(0,D.jsx)(\"i\",{className:\"icon-right-arrow-lined\"})]})),c},this.getSelectedEnergyLegend=e=>{this.setState({operateEnergyLegend:e})},this.getEnergyDataZoom=e=>{this.setState({energyDataZoom:e})},this.getSelectedSocAlyLegend=e=>{this.setState({operateSocAlyLegend:e})},this.getSelectedNotSocAlyLegend=e=>{this.setState({operateNotSocAlyLegend:e})},this.getSocAlyDataZoom=e=>{this.setState({socAlyDataZoom:e})},this.getNotSocAlyDataZoom=e=>{this.setState({notSocAlyDataZoom:e})}}componentDidMount(){this.getAiFCRevenue(),this.getEnergyAnayReport(),this.getEnergySavingAnalysis(),nn.Z.getPriceCondition(this.props.stationDn).then((e=>{const t=(null==e?void 0:e.onGridTariff)&&\"NONE\"!==(null==e?void 0:e.onGridTariff),n=(null==e?void 0:e.purchaseTariff)&&\"NONE\"!==(null==e?void 0:e.purchaseTariff),r=t&&n;this.setState({hasPrice:r,hasOnGridTariff:t,hasPurchaseTariff:n},(()=>r&&this.getAiRevenueReport()))})).finally((()=>{this.setState({priceLoading:!1})}))}renderNoData(e,t,n){const{stationDn:r,isIndustryStation:i}=this.props,{hasOnGridTariff:o,startScheduleDate:a,gridConnectDayLimit:s}=this.state;return e?(0,D.jsx)(b.Z,{className:\"report-loading\",size:\"large\"}):t?i||(0,st.xb)(a)?n?(0,D.jsx)(Et.Z,{image:\"/pvmswebsite/assets/build/images/station/noData.png\",description:this.intlMessage(\"neteco.pvms.noData\")}):void 0:(0,D.jsx)(Et.Z,{image:\"/pvmswebsite/assets/build/images/station/noData.png\",description:this.intlMessage(\"neteco.pvms.aifc.noSchedule\",{0:s})}):(0,D.jsx)(Et.Z,{image:\"/pvmswebsite/assets/build/images/station/noData.png\",description:this.intlMessage(\"neteco.pvms.power.noPrice.businessSattion.detail.new\",{0:(0,D.jsx)(\"a\",{onClick:()=>(0,st.er)(r,on.e.elecPriceEntry.entryType.BY_ENERGY_MANAGEMENT_ASSISTANT,o),children:this.intlMessage(\"neteco.pvms.power.noPrice.businessSattion.detail.new.jump\")})})})}buildEnergyAnalysisChart(){const{xlAxis:e,xrAxis:t}=this.state.aiEnergyData,n=!e||0===e.length||!t||0===t.length;if(this.state.aiEnergyLoading||n)return this.renderNoData(this.state.aiEnergyLoading,!0,n);const r=((e,t,n)=>{var r,i;let{intlMessage:o,aiEnergyData:a,sceneType:s,isIndustryStation:l}=e;const c=s===jt.Fg.PURE_STORAGE,{onGridKw:u,xlAxis:d,productPower:p,usePower:f,chargePower:h,dischargePower:m,fcProductPower:g,fcUsePower:v,aiChargeAndDischargePower:y}=a,b=((e,t)=>{const{onGridKw:n,productPower:r,usePower:i,chargePower:o,dischargePower:a,fcProductPower:s,fcUsePower:l,aiChargeAndDischargePower:c}=t,{PVInverterPower:u,userCapPower:d,storeInPower:p,storeOutPower:f,limitPower:h,PVForecastPower:m,loadForecastPower:g,aiDisAndChargePower:v}=Wt(e);return{[u]:{productPower:r},[d]:{usePower:i},[p]:{chargePower:o},[f]:{dischargePower:a},[h]:{onGridKw:n},[m]:{fcProductPower:s},[g]:{fcUsePower:l},[v]:{aiChargeAndDischargePower:c}}})(o,a);let x={};if(t){const e=(0,C.rG)(t);for(let t=0;t<e.length;t++)x={...x,...b[e[t]]}}const w=t?x:{onGridKw:u,productPower:p,usePower:f,chargePower:h,dischargePower:m,fcProductPower:g,fcUsePower:v,aiChargeAndDischargePower:y},T=Object.values(w),{leftYProps:A}=(0,S.vg)({leftOriginData:T,rightOriginData:[]}),{min:E,max:O,interval:M}=A,{multiple:P,unit:D}=(0,S.dN)([E,O],Pt.js),I=(0,S.dw)(T)<0,{legendData:N,serData:_}=l?(e=>{let{intlMessage:t,aiEnergyData:n,isPureStorage:r,isDisplayZeroTickMark:i}=e;const{PVInverterPower:o,userCapPower:a,storeInPower:s,storeOutPower:l,limitPower:c,PVForecastPower:u,loadForecastPower:d}=Wt(t),{onGridKw:p,xlAxis:f,productPower:h,usePower:m,chargePower:g,dischargePower:v,xrAxis:y,fcProductPower:b,fcUsePower:x}=n,w=Zt(b),T=Bt(y,w),A=Zt(x),E=Bt(y,A),O=f[f.length-1],M=h[h.length-1],P=m[m.length-1],D=r?[]:Qt({fcProductPowerXAxis:T,fcProductPowerArray:w,intlMessage:t,now:O,nowPVData:M}),I=Xt({fcUsePowerXAxis:E,fcUsePowerArray:A,intlMessage:t,now:O,nowLoadData:P});return{legendData:[!r&&{name:o,icon:S.qz},{name:a,icon:S.qz},{name:s,icon:S.qz},{name:l,icon:S.qz},{name:c,icon:S.Pb},!r&&{name:u,icon:S.Pb},{name:d,icon:S.Pb}],serData:[!r&&{...Ut(o,Lt.J3.PVInverterPower,f,0,h,null,null,3),areaStyle:Vt(Lt.J3.PVInverterPowerArea)},{...Ut(a,Lt.J3.userCapPower,f,0,m,null,null,3),areaStyle:Vt(Lt.J3.userCapPowerArea)},{...Ut(s,Lt.J3.storeInPower,f,0,g,null,null,3),areaStyle:Vt(Lt.J3.storeInPowerArea)},{...Ut(l,Lt.J3.storeOutPower,f,0,v,null,null,3),areaStyle:Vt(Lt.J3.storeOutPowerArea)},{...Ut(c,Lt.J3.limitPower,[],0,[]),markLine:{symbol:\"none\",label:{show:!0,position:\"insideEndTop\",formatter:e=>(0,C.yn)(e.value,t(\"neteco.pvms.unit.KW\"))},data:[{yAxis:(0,S.sp)(p,3)}],lineStyle:{color:Lt.J3.limitPower,width:2}}},...D,...I,{...Ut(\"\",Lt.J3.currentTime,[],0,[]),markLine:{symbol:\"none\",label:{show:!0,formatter:()=>t(\"neteco.pvms.common.unit.now.fie\")},data:[{xAxis:O}],lineStyle:{color:Lt.J3.currentTime,type:\"solid\",width:2}}},i&&Ht]}})({intlMessage:o,aiEnergyData:a,isPureStorage:c,isDisplayZeroTickMark:!1}):(e=>{let{intlMessage:t,aiEnergyData:n,isPureStorage:r,isDisplayZeroTickMark:i}=e;const{PVInverterPower:o,userCapPower:a,limitPower:s,PVForecastPower:l,loadForecastPower:c,aiDisAndChargePower:u}=Wt(t),{onGridKw:d,xlAxis:p,productPower:f,usePower:h,xrAxis:m,fcProductPower:g,fcUsePower:v,aiChargeAndDischargePower:y}=n,b=Zt(g),x=Bt(m,b),w=Zt(v),T=Bt(m,w),A=p[p.length-1],E=f[f.length-1],O=h[h.length-1],M=r?[]:Qt({fcProductPowerXAxis:x,fcProductPowerArray:b,intlMessage:t,now:A,nowPVData:E},!0),P=Xt({fcUsePowerXAxis:T,fcUsePowerArray:w,intlMessage:t,now:A,nowLoadData:O},!0);return{legendData:[!r&&{name:o,icon:\"circle\"},{name:u,icon:\"circle\"},{name:a,icon:\"circle\"},!r&&{name:l,icon:\"circle\"},{name:c,icon:\"circle\"},{name:s,icon:S.Pb}],serData:[{...Ut(a,Lt.nZ.userCapPower,p,0,h,null,null,3),areaStyle:{},lineStyle:{width:0}},{...Ut(u,Lt.nZ.aiDisAndChargePower,p,0,y,null,null,3),areaStyle:{},lineStyle:{width:0}},!r&&{...Ut(o,Lt.nZ.PVInverterPower,p,0,f,null,null,3),areaStyle:{},lineStyle:{width:0}},{...Ut(s,Lt.nZ.limitPower,[],0,[]),markLine:{symbol:\"none\",label:{show:!0,position:\"insideEndTop\",formatter:e=>(0,C.yn)(e.value,t(\"neteco.pvms.unit.KW\"))},data:[{yAxis:(0,S.sp)(d,3)}],lineStyle:{color:Lt.nZ.limitPower,width:2}}},...P,...M,{...Ut(\"\",Lt.nZ.currentTime,[],0,[]),markLine:{symbol:\"none\",label:{show:!0,formatter:()=>t(\"neteco.pvms.common.unit.now.fie\")},data:[{xAxis:A}],lineStyle:{color:Lt.nZ.currentTime,type:\"solid\",width:2}}},i&&Ht]}})({intlMessage:o,aiEnergyData:a,isPureStorage:c,isDisplayZeroTickMark:I}),j=d[d.length-1];let k=l?0:33;return{tooltip:{...C.W,formatter:e=>function(e,t,n,r,i){const{PVForecastPower:o,loadForecastPower:a,storeInPower:s,storeOutPower:l,aiDisAndChargePower:c}=Wt(t),u=[],d=[];for(let t=e.length-1;t>=0;t--){if(!e[t].value[1])return null;if(e[t].value[0]!==n||![o,a].includes(e[t].seriesName))if(i){const n=[o,a].includes(e[t].seriesName)?(0,S.Ko)(e[t].color):(0,S.hH)(e[t].color);u.push(`${n} ${e[t].seriesName}`),d.push((0,C.yn)(e[t].value[1],r))}else if(e[t].seriesName===c){const n=e[t].value[1]>=0?e[t].value[1]:V.lH,i=e[t].value[1]<0?Math.abs(e[t].value[1]).toFixed(3):V.lH;u.push(`${(0,S.yD)(e[t].color)} ${s}`),u.push(`${(0,S.yD)(e[t].color)} ${l}`),d.push((0,C.yn)(i,r)),d.push((0,C.yn)(n,r))}else u.push(`${(0,S.yD)(e[t].color)} ${e[t].seriesName}`),d.push((0,C.yn)(e[t].value[1],r))}return(0,S.OA)(e[0].axisValueLabel,u,d)}(e,o,j,o(\"neteco.pvms.unit.KW\"),l)},grid:{...Ft,bottom:\"17%\",right:\"1%\",left:\"1%\"},legend:{...zt,data:N,type:\"scroll\"},xAxis:[{type:\"category\",axisLine:C.re,axisLabel:{formatter:e=>Jt(e)},axisPointer:{type:\"line\",lineStyle:{type:\"solid\",width:1,color:\"#111A2CE5\"}},splitLine:{show:!1},axisTick:{show:!0}}],yAxis:[{...(0,S.j2)(\"\",P),max:O,min:E,interval:M},{...(0,S.j2)(\"\",P),max:O,min:E,interval:M}],series:_,dataZoom:[{...Yt[0],start:null!==(r=null==n?void 0:n.start)&&void 0!==r?r:k,end:null!==(i=null==n?void 0:n.end)&&void 0!==i?i:100}],backgroundColor:\"transparent\",unit:D}})({intlMessage:this.intlMessage,aiEnergyData:this.state.aiEnergyData,sceneType:this.props.sceneType,isIndustryStation:this.props.isIndustryStation},this.state.operateEnergyLegend,this.state.energyDataZoom);return(0,D.jsx)(\"div\",{className:\"report-echarts\",children:(0,D.jsxs)(\"div\",{className:\"charts-container\",children:[(0,D.jsxs)(\"div\",{className:\"yAxis-name-area\",children:[(0,D.jsx)(\"span\",{className:\"yAxis-name-left\",children:this.intlMessage(\"neteco.pvms.aifc.actualPower\",{unit:r.unit})}),(0,D.jsx)(\"span\",{className:\"yAxis-name-right\",children:this.intlMessage(\"neteco.pvms.aifc.predictedPower\",{unit:r.unit})})]}),(0,D.jsx)(At.Z,{style:{width:\"100%\",height:\"100%\"},option:r,afterCreated:e=>{(0,C.KR)(e,this.getSelectedEnergyLegend),(0,C.hz)(e,this.getEnergyDataZoom)}})]})})}buildRevenueCompareChart(){const{period:e,revenueLoading:t,priceLoading:n,revenueData:r,hasPrice:i}=this.state,{isIndustryStation:o}=this.props;if(t||n||!i||(0,st.xb)(r.xaxis))return this.renderNoData(t||n,i,(0,st.xb)(r.xaxis));const a=((e,t,n,r,i)=>{const{xaxis:o,stdRevenue:a,aiRevenue:s}=t,l=e((0,st.Z4)(\"\",r)),c=e(\"neteco.pvms.aifc.report.Legend.AIRevenue.fie\",{service:l}),u=e(\"neteco.pvms.aifc.report.Legend.traditionRevenue.fie\"),{multiple:d,unit:p}=(0,S.dN)({stdRevenue:a,aiRevenue:s},Pt.qG,i);return{tooltip:{...C.W,formatter:e=>function(e,t){let n=[],r=[];const i=(0,st.VF)(t)?2:1,o=(0,st.VF)(t);for(let a=0;a<e.length;a++)n.push(`${e[a].marker} ${e[a].seriesName}`),r.push((0,C.yn)(e[a].value,t,i,o));return(0,S.OA)(e[0].axisValueLabel,n,r,[],[],[])}(e,i)},grid:{...Ft,bottom:\"10%\"},legend:{...zt,data:[{name:u,icon:\"circle\"},{name:c,icon:\"circle\"}]},xAxis:[{type:\"category\",...C.IS,axisLabel:{formatter:e=>r?(0,C.Lm)(n,e):e},axisTick:{show:!1},axisLine:C.re,scale:!0,data:o,axisPointer:{type:\"shadow\"},boundaryGap:!0}],yAxis:(0,S.j2)((0,st.lF)(i)?\"\":p,d),series:[{name:u,type:\"bar\",color:\"#007DFF\",barGap:\"50%\",data:(0,S.sD)(a),barMaxWidth:20,zlevel:100,emphasis:{itemStyle:{color:\"inherit\"}}},{name:c,type:\"bar\",color:\"#00BFC9\",barGap:\"50%\",data:(0,S.sD)(s),barMaxWidth:20,zlevel:100,emphasis:{itemStyle:{color:\"inherit\"}}}],backgroundColor:\"transparent\",unit:(0,st.lF)(i)?p:i}})(this.intlMessage,r,e,o,r.measureUnit);return(0,D.jsxs)(\"div\",{className:\"charts-container\",children:[(0,D.jsx)(\"div\",{className:\"yAxis-name-area\",children:(0,D.jsx)(\"span\",{className:\"yAxis-name-left\",children:a.unit})}),(0,D.jsx)(At.Z,{style:{width:\"100%\",height:\"100%\"},option:a})]})}buildStatisticTime(e,t){return(0,D.jsx)(\"span\",{className:\"statistic-time\",children:e&&t?this.intlMessage(\"neteco.pvms.aifc.statisticTime.tip\",{startTime:e,endTime:t}):`${this.intlMessage(\"neteco.pvms.aifc.statisticTime.fie\")}: ${V.lH}`})}buildTimeSelected(){const{period:e,currentYear:t,revenueLoading:n,currentMonth:r}=this.state;let i=[{label:this.intlMessage(\"neteco.pvms.systemSetting.amendment.year\"),key:\"year\"},{label:this.intlMessage(\"neteco.pvms.KPI.kpiView.lifelimit\"),key:\"lifetime\"}];return this.props.isIndustryStation&&i.unshift({label:this.intlMessage(\"neteco.pvms.systemSetting.amendment.month\"),key:\"month\"}),(0,D.jsxs)(\"div\",{className:\"report-operation\",children:[(0,D.jsx)(c.Z,{type:\"capsule\",onTabClick:e=>{this.selectPeriodHandler(e)},items:i,defaultActiveKey:e}),(0,D.jsxs)(\"div\",{className:\"report-datetime\",children:[(0,D.jsx)(Ot.Z,{title:this.intlMessage(\"neteco.pvms.power.lastYear\"),className:n?\"datetime-arrow-disabled\":\"datetime-arrow\",onClick:()=>this.forwardOrNextDate(-1)}),(0,D.jsx)(Dt.Z,{timeDimension:e,value:\"month\"===e?r:t,onChange:this.handTimeChange,autoFocus:!1}),(0,D.jsx)(Mt.Z,{title:this.intlMessage(\"neteco.pvms.power.nextYear\"),className:n?\"datetime-arrow-disabled\":\"datetime-arrow\",onClick:()=>this.forwardOrNextDate(1)})]})]})}buildScheduleAlyEchart(e){const{energySavingAlyData:t,energySavingAlyLoading:n,hasPrice:r,operateSocAlyLegend:i,operateNotSocAlyLegend:o,notSocAlyDataZoom:a,socAlyDataZoom:s}=this.state,{xAxis:l,emmaEnabled:c}=t,u=!c||!l||0===l.length;if(n||!r||u)return this.renderNoData(n,r,u);const d=((e,t,n,r,i)=>{var o,a;const s=(0,st.p$)(t),{onGridPrice:l}=Kt(e);null===r&&(s.onGridPriceData=[]);const{measureUnit:c,currentTime:u}=s,{lastLeftBigintMap:d,lastLeftDataArray:p,lastRightBigintMap:f,lastRightDataArray:h}=(0,C.m1)({...$t(e,s,n),selectedLegend:r}),{leftYProps:{min:m,max:g,interval:v},rightYProps:{min:y,max:b,interval:x}}=(0,S.vg)({leftOriginData:p,rightOriginData:h,percentIsLeft:!n||void 0}),w=0!==m,{legendData:T,serData:A}=((e,t,n,r)=>{const{PVInverterPower:i,userCapPower:o,buyCapPower:a,aiDisAndChargePower:s,buyCapPrice:l,onGridPrice:c,socEMMA:u,socDefault:d}=Kt(e),{productPower:p,usePower:f,aiChargeAndDischargePower:h,aiDisGridPower:m,onGridPriceData:g,priceData:v,aiSocData:y,stdSocData:b,xAxis:x,currentTime:w}=t;return n?{legendData:[{name:i,icon:\"circle\"},{name:s,icon:\"circle\"},{name:a,icon:\"circle\"},{name:o,icon:\"circle\"},{name:l,icon:S.qz},{name:c,icon:S.qz}],serData:[{...Ut(o,Lt.nZ.userCapPower,x,0,f,null,null,3),areaStyle:{},lineStyle:{width:0}},{...Ut(a,Lt.nZ.buyCapPower,x,0,m,null,null,3),areaStyle:{},lineStyle:{width:0}},{...Ut(s,Lt.nZ.aiDisAndChargePower,x,0,h,null,null,3),areaStyle:{},lineStyle:{width:0}},{...Ut(i,Lt.nZ.PVInverterPower,x,0,p,null,null,3),areaStyle:{},lineStyle:{width:0}},{...Ut(l,Lt.nZ.buyCapPrice,[],1,[]),smooth:!1,data:Rt(x,v)},{...Ut(c,Lt.nZ.onGridPrice,[],1,[]),smooth:!1,data:Rt(x,g)},{...Ut(\"\",Lt.nZ.currentTime,[],0,[]),markLine:{symbol:\"none\",label:{show:!0,formatter:()=>e(\"neteco.pvms.common.unit.now.fie\")},data:[{xAxis:w}],lineStyle:{color:Lt.nZ.currentTime,type:\"solid\",width:2}}},r&&Ht]}:{legendData:[{name:u,icon:\"circle\"},{name:d,icon:S.Pb},{name:l,icon:S.qz},{name:c,icon:S.qz}],serData:[{...Ut(u,Lt.nZ.socEMMA,x,0,y),areaStyle:{},lineStyle:{width:0}},{...Ut(d,Lt.nZ.socDefault,x,0,b),smooth:!1,lineStyle:{type:\"dashed\"}},{...Ut(l,Lt.nZ.buyCapPrice,[],1,[]),data:Rt(x,v)},{...Ut(c,Lt.nZ.onGridPrice,[],1,[]),data:Rt(x,g)},{...Ut(\"\",Lt.nZ.currentTime,[],0,[]),markLine:{symbol:\"none\",label:{show:!0,formatter:()=>e(\"neteco.pvms.common.unit.now.fie\")},data:[{xAxis:w}],lineStyle:{color:Lt.nZ.currentTime,type:\"solid\",width:2}}},r&&Ht]}})(e,s,n,w),{xAxis:E=[]}=s,{multiple:O,unit:M}=(0,S.dN)(d,Pt.js),{multiple:P,unit:D}=(0,S.dN)(f,Pt.qG,c),I=E.indexOf(u);return{tooltip:{...C.W,formatter:t=>function(e,t,n,r,i){const{buyCapPrice:o,onGridPrice:a,chargePowerAi:s,dischargePowerAi:l,aiDisAndChargePower:c,socDefault:u}=Kt(t),d=[o,a],p=[],f=[];for(let o=e.length-1;o>=0;o--)if(e[o].dataIndex<=n||d.includes(e[o].seriesName)){if(c===e[o].seriesName)p.push(`${(0,S.yD)(e[o].color)} ${s}`),p.push(`${(0,S.yD)(e[o].color)} ${l}`);else{let t=(0,S.yD)(e[o].color);d.includes(e[o].seriesName)?t=(0,S.hH)(e[o].color):e[o].seriesName===u&&(t=(0,S.Ko)(e[o].color)),p.push(`${t} ${e[o].seriesName}`)}if(d.includes(e[o].seriesName)){const t=(0,st.VF)(r)?2:1,n=(0,st.VF)(r);f.push((0,C.yn)(e[o].value[1],r,t,n))}else if(c===e[o].seriesName){const n=e[o].value[1]>=0?e[o].value[1]:V.lH,r=e[o].value[1]<0?Math.abs(e[o].value[1]).toFixed(3):V.lH;f.push((0,C.yn)(r,t(\"neteco.pvms.unit.KW\"),2,!1)),f.push((0,C.yn)(n,t(\"neteco.pvms.unit.KW\"),2,!1))}else f.push((0,C.yn)(e[o].value[1],i?t(\"neteco.pvms.unit.KW\"):\"%\",2,!1))}return(0,S.OA)(e[0].axisValueLabel,p,f)}(t,e,I,c,n)},grid:{...Ft,bottom:\"17%\",left:\"1%\",right:\"1%\"},legend:{...zt,data:T,selected:{[l]:null!==r&&r[l]},type:\"scroll\"},xAxis:[{type:\"category\",axisLine:C.re,axisLabel:{formatter:e=>Jt(e)},axisPointer:{type:\"line\",lineStyle:{type:\"solid\",width:1,color:\"#111A2CE5\"}},splitLine:{show:!1},axisTick:{show:!0}}],yAxis:[{...(0,S.j2)(\"\",n?O:1,v),max:g,min:m,interval:v},{...(0,S.j2)((0,st.lF)(c)?\"\":D,P,x),max:b,min:y,interval:x}],series:A,dataZoom:[{...Yt[0],start:null!==(o=null==i?void 0:i.start)&&void 0!==o?o:0,end:null!==(a=null==i?void 0:i.end)&&void 0!==a?a:100}],backgroundColor:\"transparent\",moneyUnit:(0,st.lF)(c)?D:c,leftUnit:n?M:\"%\"}})(this.intlMessage,t,e,e?o:i,e?a:s);return(0,D.jsx)(\"div\",{className:\"report-echarts\",children:(0,D.jsxs)(\"div\",{className:\"charts-container\",children:[(0,D.jsxs)(\"div\",{className:\"yAxis-name-area\",children:[(0,D.jsx)(\"span\",{className:\"yAxis-name-left\",children:d.leftUnit}),(0,D.jsx)(\"span\",{className:\"yAxis-name-right\",children:null==d?void 0:d.moneyUnit})]}),(0,D.jsx)(At.Z,{style:{width:\"100%\",height:\"100%\"},option:d,afterCreated:t=>{(0,C.KR)(t,e?this.getSelectedNotSocAlyLegend:this.getSelectedSocAlyLegend),(0,C.hz)(t,e?this.getNotSocAlyDataZoom:this.getSocAlyDataZoom)}})]})})}buildHighLadderAlyEchart(e){const{sceneType:t}=this.props,{energySavingAlyData:n,energySavingAlyLoading:r,hasPrice:i,operateSocAlyLegend:o,operateNotSocAlyLegend:a,notSocAlyDataZoom:s,socAlyDataZoom:l}=this.state,{xAxis:c,emmaEnabled:u}=n,d=!u||!c||0===c.length;if(r||!i||d)return this.renderNoData(r,i,d);const p=((e,t,n)=>{var r,i;let{intlMessage:o,energySavingAlyData:a,isHighLadder:s,sceneType:l}=e;const{xAxis:c,currentTime:u,measureUnit:d,usePower:p=[]}=a,f={...a,usePower:(0,kt.Vo)(p)},{lastLeftBigintMap:h,lastLeftDataArray:m,lastRightBigintMap:g,lastRightDataArray:v}=(0,C.m1)({...en(o,f,s),selectedLegend:t}),{multiple:y,unit:b}=(0,S.dN)(h,Pt.js),{multiple:x,unit:w}=(0,S.dN)(g,Pt.qG,d),{leftYProps:{min:T,max:A,interval:E},rightYProps:{min:O,max:M,interval:P}}=(0,S.vg)({leftOriginData:m,rightOriginData:v,percentIsLeft:!s||void 0}),{legendData:D,serData:I}=((e,t,n)=>{const{PVInverterPower:r,loadPower:i,gridPower:o,storePowerDefault:a,storePowerAi:s,socDefault:l,socEMMA:c,powerPrice:u}=qt(e),{productPower:d,usePower:p,meterActivePower:f,stdChargeAndDischargePower:h,aiChargeAndDischargePower:m,stdSocData:g,aiSocData:v,priceData:y,xAxis:b,currentTime:x}=t;return n?{legendData:[{name:r,icon:S.qz},{name:i,icon:S.qz},{name:o,icon:S.qz},{name:a,icon:S.qz},{name:s,icon:S.qz}],serData:[{...Ut(r,Lt.J3.PVInverterPower,b,0,d,null,null,3),areaStyle:Vt(Lt.J3.PVInverterPowerArea)},{...Ut(i,Lt.J3.loadPower,b,0,p,null,null,3),areaStyle:Vt(Lt.J3.loadPowerArea)},{...Ut(o,Lt.J3.gridPower,b,0,f,null,null,3),areaStyle:Vt(Lt.J3.gridPowerArea)},{...Ut(a,Lt.J3.storePowerDefault,b,0,h,null,null,3),areaStyle:Vt(Lt.J3.storePowerDefaultArea)},{...Ut(s,Lt.J3.storePowerAi,b,0,m,null,null,3),areaStyle:Vt(Lt.J3.storePowerAiArea)},{...Ut(\"\",Lt.J3.currentTime,[],0,[]),markLine:{symbol:\"none\",label:{show:!0,formatter:()=>e(\"neteco.pvms.common.unit.now.fie\")},data:[{xAxis:x}],lineStyle:{color:Lt.J3.currentTime,type:\"solid\",width:2}}}]}:{legendData:[{name:u,icon:S.qz},{name:l,icon:S.Pb},{name:c,icon:S.qz}],serData:[{...Ut(c,Lt.J3.socEMMA,b,0,v),areaStyle:Vt(Lt.J3.socEMMAArea)},{...Ut(l,Lt.J3.socDefault,b,0,g),smooth:!1,lineStyle:{type:\"dashed\"}},{...Ut(u,Lt.J3.powerPrice,[],1,[]),data:Rt(b,y)},{...Ut(\"\",Lt.J3.currentTime,[],0,[]),markLine:{symbol:\"none\",label:{show:!0,formatter:()=>e(\"neteco.pvms.common.unit.now.fie\")},data:[{xAxis:x}],lineStyle:{color:Lt.J3.currentTime,type:\"solid\",width:2}}}]}})(o,f,s),N=c.indexOf(u);return s&&l===jt.Fg.PURE_STORAGE&&(D.shift(),I.shift()),{tooltip:{...C.W,formatter:e=>s?function(e,t,n){const{PVInverterPower:r,loadPower:i,gridPower:o,storePowerDefault:a,storePowerAi:s,disGridPower:l,onGridPower:c,chargePowerDefault:u,dischargePowerDefault:d,chargePowerAi:p,dischargePowerAi:f}=qt(t),h={[r]:n.productPower,[i]:n.usePower,[o]:n.meterActivePower,[a]:n.stdChargeAndDischargePower,[s]:n.aiChargeAndDischargePower},m=[o,a,s],g=[],v=[],y=[],b=[],x=e.length-1,w=t(\"neteco.pvms.unit.KW\"),T=e[0].axisValueLabel?e[0].axisValueLabel:V.lH,A=`<div style=\"display: flex;justify-content: space-between;\"}>\\n    <span style=\"width: 50%; margin-right: 24px;\">${t(\"neteco.pvms.production\")}</span>\\n    <span style=\"width: 50%;\">${t(\"neteco.pvms.spending\")}</span>\\n  </div>`;for(let t=0;t<=x;t++){const n=(0,S.hH)(e[t].color),x=e[t].seriesName,T=e[t].dataIndex;if(m.includes(x))if(h[x][T]>=0){const e=Math.abs(h[x][T]).toFixed(3);isNaN(e)?v.push(V.lH):v.push((0,C.yn)(e,w)),b.push(V.lH)}else{const e=Math.abs(h[x][T]).toFixed(3);isNaN(e)?b.push(V.lH):b.push((0,C.yn)(e,w)),v.push(V.lH)}let A,E;if(x===r){A=r;const e=Math.abs(h[x][T]).toFixed(3);isNaN(e)?v.push(V.lH):v.push((0,C.yn)(e,w))}else if(x===i){E=i;const e=Math.abs(h[x][T]).toFixed(3);isNaN(e)?b.push(V.lH):b.push((0,C.yn)(e,w))}else x===o?(A=l,E=c):x===a?(A=d,E=u):x===s&&(A=f,E=p);A&&g.push(`${n} ${A}`),E&&y.push(`${n} ${E}`)}return(0,S.OA)(T+A,g,v,y,b)}(e,o,a):function(e,t,n,r){const{powerPrice:i}=qt(t),o=[],a=[];for(let t=e.length-1;t>=0;t--)if(e[t].dataIndex<=n||i===e[t].seriesName)if(o.push(`${(0,S.hH)(e[t].color)} ${e[t].seriesName}`),i===e[t].seriesName){const n=(0,st.VF)(r)?2:1,i=(0,st.VF)(r);a.push((0,C.yn)(e[t].value[1],r,n,i))}else a.push((0,C.yn)(e[t].value[1],\"%\",2,!1));return(0,S.OA)(e[0].axisValueLabel,o,a)}(e,o,N,d)},grid:{...Ft,left:\"1%\",right:\"2%\"},legend:{...zt,data:D,type:\"scroll\"},xAxis:[{type:\"category\",axisLine:C.re,axisLabel:{formatter:e=>Jt(e)},axisPointer:{type:\"line\",lineStyle:{type:\"solid\",width:1,color:\"#111A2CE5\"}},splitLine:{show:!1},axisTick:{show:!0}}],yAxis:[{...(0,S.j2)(\"\",s?y:1,E),max:A,min:T,interval:E,axisLabel:{formatter:e=>`${(0,kt.af)(Math.abs(e))}`}},!s&&{...(0,S.j2)((0,st.lF)(d)?\"\":w,x,P),max:M,min:O,interval:P}],series:I,backgroundColor:\"transparent\",dataZoom:[{...Yt[0],start:null!==(r=null==n?void 0:n.start)&&void 0!==r?r:0,end:null!==(i=null==n?void 0:n.end)&&void 0!==i?i:100}],moneyUnit:!s&&((0,st.lF)(d)?w:d),leftUnit:s?b:\"%\"}})({intlMessage:this.intlMessage,energySavingAlyData:n,isHighLadder:e,sceneType:t},e?a:o,e?s:l);return(0,D.jsx)(\"div\",{className:\"report-echarts\",children:(0,D.jsxs)(\"div\",{className:\"charts-container\",children:[(0,D.jsxs)(\"div\",{className:\"yAxis-name-area\",children:[(0,D.jsx)(\"span\",{className:\"yAxis-name-left\",children:p.leftUnit}),(0,D.jsx)(\"span\",{className:\"yAxis-name-right\",children:null==p?void 0:p.moneyUnit})]}),(0,D.jsx)(At.Z,{style:{width:\"100%\",height:\"100%\"},option:p,afterCreated:t=>{(0,C.KR)(t,e?this.getSelectedNotSocAlyLegend:this.getSelectedSocAlyLegend),(0,C.hz)(t,e?this.getNotSocAlyDataZoom:this.getSocAlyDataZoom)}})]})})}buildAIRevenueCompare(){return(0,D.jsxs)(\"div\",{className:\"report-revenue-compare-chart report-common-chart\",children:[(0,D.jsxs)(\"div\",{className:\"report-title-area\",children:[(0,D.jsxs)(\"span\",{className:\"chart-title\",children:[this.intlMessage(\"neteco.pvms.aifc.report.revenueCompareChart.tit\"),(0,D.jsx)(me.Z,{overlayClassName:\"nco-aifc-revenue-compare-tip\",placement:\"right\",title:(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(\"p\",{children:this.intlMessage(\"neteco.pvms.aifc.revenueInfo.alert.new\")+this.intlMessage(\"neteco.pvms.aifc.report.revenueCompare.new.tip\")}),(0,D.jsx)(\"p\",{children:this.intlMessage(\"neteco.pvms.station.defaultRevenue.moreThan.emmaRevenue1\",this.getAIOrEMMAInfo(\"service\"))})]}),children:(0,D.jsx)(\"i\",{className:\"icon-questionmark-circle-lined\"})})]}),this.buildTimeSelected()]}),(0,D.jsx)(\"div\",{className:\"report-echarts\",children:this.buildRevenueCompareChart()})]})}buildEnergyAnalysis(){const{aiEnergyData:e}=this.state,{xlAxis:t,xrAxis:n,startTime:r,endTime:i}=e,o=!t||0===t.length||!n||0===n.length;return(0,D.jsxs)(\"div\",{className:\"report-energy-analysis-chart report-common-chart\",children:[(0,D.jsx)(\"div\",{className:\"report-title-area\",children:(0,D.jsxs)(\"span\",{className:\"chart-title\",children:[this.intlMessage(\"neteco.pvms.aifc.energyAnay.tit\"),(0,D.jsx)(me.Z,{placement:\"right\",title:this.intlMessage(\"neteco.pvms.aifc.report.energyAnay.new.tip\",this.getAIOrEMMAInfo()),children:(0,D.jsx)(\"i\",{className:\"icon-questionmark-circle-lined\"})})]})}),(0,D.jsxs)(\"div\",{className:\"chart-operation\",children:[!o&&this.buildStatisticTime(r,i),(0,D.jsx)(me.Z,{title:this.intlMessage(\"neteco.pvms.common.operation.reload\"),children:(0,D.jsx)(\"span\",{className:\"icon-refresh-clockwise-lined\",onClick:this.getEnergyAnayReport})})]}),this.buildEnergyAnalysisChart()]})}buildScheduleAly(){const{energySavingAlyData:e}=this.state,{xAxis:t,currentTime:n}=e,r=!t||0===t.length;return(0,D.jsx)(D.Fragment,{children:(0,D.jsxs)(\"div\",{className:\"report-energy-save-aly-chart report-common-chart\",children:[(0,D.jsx)(\"div\",{className:\"report-title-area\",children:(0,D.jsxs)(\"span\",{className:\"chart-title\",children:[this.intlMessage(\"neteco.pvms.aifc.report.energySavingAly.scheduling.tit\"),(0,D.jsx)(me.Z,{placement:\"right\",title:this.intlMessage(\"neteco.pvms.aifc.report.energySavingAnay.new.tip\",this.getAIOrEMMAInfo()),children:(0,D.jsx)(\"i\",{className:\"icon-questionmark-circle-lined\"})})]})}),(0,D.jsxs)(\"div\",{className:\"chart-operation\",children:[!r&&this.buildStatisticTime(t[0],n),(0,D.jsx)(me.Z,{title:this.intlMessage(\"neteco.pvms.common.operation.reload\"),children:(0,D.jsx)(\"span\",{className:\"icon-refresh-clockwise-lined\",onClick:this.getEnergySavingAnalysis})})]}),this.buildScheduleAlyEchart(!0),(0,D.jsx)(\"div\",{className:\"report-title-area\",children:(0,D.jsx)(\"span\",{className:\"chart-title\",children:this.intlMessage(\"neteco.pvms.aifc.report.energySavingAly.BatterySOC.tit\")})}),this.buildScheduleAlyEchart(!1)]})})}buildSOCAndHighLadder(){const{energySavingAlyData:e}=this.state,{xAxis:t,currentTime:n}=e,r=!t||0===t.length;return(0,D.jsx)(D.Fragment,{children:(0,D.jsxs)(\"div\",{className:\"report-energy-save-aly-chart report-common-chart\",children:[(0,D.jsx)(\"div\",{className:\"report-title-area\",children:(0,D.jsxs)(\"span\",{className:\"chart-title\",children:[this.intlMessage(\"neteco.pvms.aifc.report.energySavingAly.type.SOC\"),(0,D.jsx)(me.Z,{placement:\"right\",title:this.intlMessage(\"neteco.pvms.aifc.report.energySavingAnay.new.tip\",this.getAIOrEMMAInfo()),children:(0,D.jsx)(\"i\",{className:\"icon-questionmark-circle-lined\"})})]})}),(0,D.jsxs)(\"div\",{className:\"chart-operation\",children:[!r&&this.buildStatisticTime(t[0],n),(0,D.jsx)(me.Z,{title:this.intlMessage(\"neteco.pvms.common.operation.reload\"),children:(0,D.jsx)(\"span\",{className:\"icon-refresh-clockwise-lined\",onClick:this.getEnergySavingAnalysis})})]}),this.buildHighLadderAlyEchart(!1),(0,D.jsx)(\"div\",{className:\"report-title-area\",children:(0,D.jsx)(\"span\",{className:\"chart-title\",children:this.intlMessage(\"neteco.pvms.aifc.report.energySavingAly.industry.tit\")})}),this.buildHighLadderAlyEchart(!0)]})})}render(){const{plantStatusTip:e,hasAiRevenue:t}=this.state,{isIndustryStation:n}=this.props;if(void 0!==t)return(0,D.jsx)(\"div\",{className:\"nco-monitor-station-overview tab-content\",children:(0,D.jsxs)(\"div\",{className:\"nco-aifc-report\",children:[e&&(0,D.jsx)(rn.Z,{className:\"nco-aifc-report-tip\",message:e,type:\"warning\",showIcon:!0,closable:!0}),(0,D.jsx)(\"div\",{className:\"report-title-card\",children:this.titleCard()}),t&&this.buildAIRevenueCompare(),!t&&this.buildEnergyAnalysis(),n?this.buildSOCAndHighLadder():this.buildScheduleAly(),!t&&this.buildAIRevenueCompare(),t&&this.buildEnergyAnalysis()]})})}}const sn=an;var ln=n(32449),cn=[\"className\",\"rotate\",\"spin\",\"style\",\"color\"];function un(e){return un=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e},un(e)}function dn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dn(Object(n),!0).forEach((function(t){fn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function fn(e,t,n){return t=function(e){var t=function(e){if(\"object\"!==un(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,\"string\");if(\"object\"!==un(n))return n;throw new TypeError(\"@@toPrimitive must return a primitive value.\")}return String(e)}(e);return\"symbol\"===un(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var hn=function(e){return(0,D.jsx)(\"svg\",pn(pn({fill:\"currentColor\",viewBox:\"0 0 24 24\",width:\"1em\",height:\"1em\"},e),{},{children:(0,D.jsx)(\"path\",{d:\"M20.067999983787537,6.76C20.640999983787538,6.457,21.312999983787538,6.476,21.869999983787537,6.8100000000000005C22.426999983787535,7.144,22.757999983787535,7.731,22.757999983787535,8.381L22.757999983787535,15.619C22.757999983787535,16.269,22.425999983787538,16.855,21.869999983787537,17.189999999999998C21.312999983787538,17.525,20.640999983787538,17.543,20.067999983787537,17.240000000000002L17.635999983787535,15.975L17.635999983787535,16.75C17.635999983787535,18.404,16.28999998378754,19.75,14.635999983787537,19.75L4.241999983787537,19.75C2.5879999837875367,19.75,1.2419999837875366,18.404,1.2419999837875366,16.75L1.2419999837875366,7.25C1.2419999837875366,5.596,2.5879999837875367,4.25,4.241999983787537,4.25L14.635999983787537,4.25C16.28999998378754,4.25,17.635999983787535,5.596,17.635999983787535,7.25L17.635999983787535,8.046L20.067999983787537,6.76ZM9.384209983787537,15C7.727009983787537,15,6.384209983787537,13.6572,6.384209983787537,12C6.384209983787537,10.3428,7.727009983787537,9,9.384209983787537,9C11.041409983787537,9,12.384199983787537,10.3428,12.384199983787537,12C12.384199983787537,13.6572,11.041409983787537,15,9.384209983787537,15Z\",fillRule:\"evenodd\",fill:\"currentColor\"})}))};const mn=function(e){var t=e.className,n=e.rotate,r=e.spin,i=e.style,o=e.color,a=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,cn),s=\"dpicon\",l={msTransform:\"rotate(\".concat(n,\"deg)\"),transform:\"rotate(\".concat(n,\"deg)\")},c=Boolean(n)?l:void 0,u=Qe()(s,t,fn({},\"\".concat(s,\"-spin\"),Boolean(r)));return(0,D.jsx)(\"span\",pn(pn({style:pn({color:o},i),role:\"img\",className:u},a),{},{children:(0,D.jsx)(hn,{style:pn({},c)})}))};var gn=n(78939),vn=n(37592);const yn={type:\"category\",axisTick:{show:!1},scale:!0,axisPointer:{type:\"shadow\"},boundaryGap:!0},bn={stack:\"one\",...C.MX},Sn=\"uk-ua\"===window.neteco.i18n.getLocale(),xn=oe.Z.Group,wn={year:0,lifetime:1,month:2};class Cn extends l.Component{constructor(e){var t;super(e),t=this,this.intlMessage=(e,t)=>this.props.intl.formatMessage({id:e},t),this.getAllRevenue=()=>{this.setState({loading:!0,data:{}});const{stationDn:e,period:t,currentYear:n,currentMonth:r}=this.state,i=wn[t],o={stationDn:e,statDim:i,statTime:(2===i?r:n).valueOf()};nn.Z.loadTotalBenefits(o).then((e=>{this.setState({data:e})})).finally((()=>{this.setState({loading:!1})}))},this.selectPeriodHandler=e=>{const{period:t}=this.state;e!==t&&this.setState({period:e,currentYear:s()().startOf(\"year\"),currentMonth:s()().startOf(\"month\")},(()=>this.props.hasNewPrice&&this.getAllRevenue()))},this.forwardOrNextDate=e=>{this.setState((t=>\"month\"===t.period?{currentMonth:s()(t.currentMonth).add(e,\"month\")}:{currentYear:s()(t.currentYear).add(e,\"year\")}),(()=>this.props.hasNewPrice&&this.getAllRevenue()))},this.handTimeChange=e=>{\"month\"===this.state.period?this.setState({currentMonth:e},(()=>this.props.hasNewPrice&&this.getAllRevenue())):this.setState({currentYear:e},(()=>this.props.hasNewPrice&&this.getAllRevenue()))},this.chartLegendChange=e=>{this.setState({lengedState:e.selected})},this.buildBenefitsOption=()=>{const{period:e,data:t,sceneType:n}=this.state,{xAxis:r=[],pvBenefits:i=[],storageBenefits:o=[],totalBenefits:a=[],measureUnit:s}=t;return((e,t,n,r,i,o)=>{const a=e(\"neteco.pvms.smsrc.stationRevenue.tip.batteryRevenue\"),s=e(\"neteco.pvms.smsrc.stationRevenue.tip.pvRevenue\"),l=e(\"neteco.pvms.station.revenue.tip.allRevenue\"),{pvBenefits:c,storageBenefits:u,totalBenefits:d}=r;let p=[{...bn,name:s,color:\"#FDD42E\",data:c,icon:\"circle\"},{...bn,name:a,color:\"#D19900\",data:u,icon:\"circle\"},{...bn,name:l,type:\"line\",color:\"#A57300\",data:d,icon:S.qz,stack:\"none\"}],f=r;i===jt.Fg.PURE_LIGHT?(p.splice(1,1),f={pvBenefits:c,totalBenefits:d}):i===jt.Fg.PURE_STORAGE&&(p.splice(0,1),f={storageBenefits:u,totalBenefits:d});const{multiple:h,unit:m}=(0,S.dN)(f,Pt.qG,o),g=(0,st.VF)(o)?C.z:C.i0,v=(0,st.VF)(o),y=[...p.slice(0,-1).reverse(),...p.slice(-1)];return{tooltip:{...C.W,confine:!0,formatter:function(t){const n=t[0].dataIndex;let r=y.map((e=>e.data[n])).map((e=>({value:(0,C.yn)((0,S.sp)(e),o,g,v)})));return t.forEach((e=>{const t=e.seriesIndex;t!==p.length-1?r[t]={...r[t],marker:e.marker,title:e.seriesName,order:e.seriesName===s?1:2}:r[t]={...r[t],marker:(0,S.hH)(\"#A57300\"),title:e.seriesName,order:3}})),r=r.filter((e=>e.marker)).sort(((e,t)=>e.order-t.order)),((e,t,n,r)=>{const i=e=>`<span style=\"margin: 4px 0;\">${e}</span>`,o=`\\n    <div style=\"color: #111A2C99;font-size: 14px;\">${e}</div>\\n    <div style=\"display: flex;\">\\n      <div style=\"display: flex;flex-direction:column;\">\\n        ${t.reduce(((e,t)=>e+`<div style=\"flex: 1;display: flex;align-items: center;\">${t.marker}</div>`),\"\")}\\n      </div>\\n      <div style=\"display: flex;flex-direction:column;margin-right:22px;margin-left:4px\">\\n        ${t.reduce(((e,t)=>e+i(t.title)),\"\")}\\n      </div>\\n      <div style=\"display: flex;flex-direction:column;\">\\n        ${t.reduce(((e,t)=>e+i(t.value)),\"\")}\\n      </div>\\n    </div>\\n  `;return r?`<div> ${o} </div>`:`\\n      <div>\\n        ${o}\\n        <div style=\"color: #111A2C99;display:flex;\">\\n          <i class=\"icon-about-lined\" style=\"margin-right:8px;font-size:16px;position: relative;top: 3px;\"></i>\\n          <span style=\"white-space: break-spaces;font-size: 12px;max-width: ${Sn?450:250}px\">${n}</span>\\n        </div>\\n      </div>\\n    `})(t[0].axisValue,r,e(\"neteco.pvms.station.revenue.key2\"),i===jt.Fg.PURE_LIGHT)}},grid:C.o3,legend:{...C.hv,data:p.map((e=>({name:e.name,icon:e.icon})))},xAxis:[{axisLabel:{formatter:e=>(0,C.Lm)(t,e)},axisLine:C.re,data:n,...yn}],yAxis:(0,S.j2)((0,st.lF)(o)?\"\":m,h),series:y,backgroundColor:\"transparent\",unit:(0,st.lF)(o)?m:o}})(this.intlMessage,e,r,{pvBenefits:i,storageBenefits:o,totalBenefits:a},n,s)},this.buildStructureOption=()=>{const{period:e,data:t}=this.state,{xAxis:n=[],originElectricityFee:r=[],originDemandFee:i=[],originExtraFee:o=[],currentElectricityFee:a=[],currentDemandFee:s=[],currentExtraFee:l=[],saveElectricityFee:c=[],measureUnit:u}=t;return((e,t,n,r,i)=>{const o=e(\"neteco.pvms.station.revenue.key5\"),a=e(\"neteco.pvms.station.revenue.key9\"),s=e(\"neteco.pvms.station.revenue.key6\"),l=e(\"neteco.pvms.station.revenue.key7\"),c=e(\"neteco.pvms.station.revenue.serviceMoney\"),u=e(\"neteco.pvms.station.revenue.key8\"),d=`${s}-${o}`,p=`${l}-${o}`,f=`${c}-${o}`,h=`${s}-${a}`,m=`${l}-${a}`,g=`${c}-${a}`,{originElectricityFee:v,originDemandFee:y,originExtraFee:b,currentElectricityFee:x,currentDemandFee:w,currentExtraFee:T,saveElectricityFee:A}=r,E=(0,C.JM)([v,y,b]),O=(0,C.JM)([x,w,T]),M=A,{multiple:P,unit:D}=(0,S.dN)({originList:E,currentList:O,saveList:M},Pt.qG,i),I=(0,st.VF)(i)?C.z:C.i0,N=(0,st.VF)(i);return{tooltip:{...C.W,formatter:function(t){const n=t[0].dataIndex,r=[b[n],y[n],v[n],T[n],w[n],x[n]],o=(0,C.yn)((0,C.jU)(r.slice(0,3)),i,I,N),a=(0,C.yn)((0,C.jU)(r.slice(3)),i,I,N),s=[...(0,st.Dc)(r.slice(0,3)),...(0,st.Dc)(r.slice(3))];let l,c=r.map(((e,t)=>({value:(0,C.yn)((0,S.sp)(e),i,I,N),ratio:(0,C.LN)(e,s[t])})));t.forEach((e=>{const t=e.seriesIndex;6!==t?c[t]={...c[t],marker:e.marker,title:e.seriesName.split(V.lH)[0]}:l={marker:(0,S.hH)(\"#ECB613\"),title:e.seriesName,value:(0,C.yn)((0,S.sp)(e.data),i,I,N)}})),c=c.filter((e=>e.marker));const u=t.some((e=>6===e.seriesIndex))?1:0,d=(t.length-u)/2;return((e,t,n,r,i,o,a)=>{let s=e=>{return`\\n    <div style=\"color: #111A2CE5;font-size: 14px;display:flex;align-items:center;margin:4px 0;\">\\n      ${e.marker}\\n      <div style=\"display:flex;margin-left:4px;justify-content:space-between;flex: 1;\">\\n        <span style=\"margin-right: 35px;\">${e.title}</span>\\n        <span>${e.value}${e.ratio?\" (\"+(t=e.ratio,(isNaN(t)?V.lH:t+\"%\")+\")\"):\"\"}</span>\\n      </div>\\n    </div>\\n  `;var t},l=n.reverse().reduce(((e,t)=>e+s(t)),\"\"),c=i.reverse().reduce(((e,t)=>e+s(t)),\"\"),u=o?s(o):\"\";return`\\n    <div>\\n      <div style=\"color: #111A2C99;font-size: 14px;\">${e}</div>\\n      <div style=\"color: #111A2CE5;font-size: 14px;display:flex;\">\\n        <div style=\"flex:1;margin-right:40px;\">\\n          <div style=\"display:flex;justify-content:space-between;flex: 1;\">\\n            <span style=\"margin-right:62px;\">\\n              ${a(\"neteco.pvms.station.revenue.key4\")}-${a(\"neteco.pvms.station.revenue.key5\")}\\n            </span>\\n            <span>${t}</span>\\n          </div>\\n          ${l}\\n          ${u}\\n        </div>\\n        <div style=\"flex:1\">\\n          <div style=\"display:flex;justify-content:space-between;flex: 1;\">\\n            <span style=\"margin-right:62px;\">\\n              ${a(\"neteco.pvms.station.revenue.key4\")}-${a(\"neteco.pvms.station.revenue.key9\")}\\n            </span>\\n            <span>${r}</span>\\n          </div>\\n          ${c}\\n        </div>\\n      </div>\\n    </div>\\n  `})(t[0].axisValue,o,c.slice(0,d),a,c.slice(d),l,e)}},grid:C.o3,legend:{...C.hv,formatter:function(e){return e},data:[{name:d,icon:\"circle\"},{name:p,icon:\"circle\"},{name:f,icon:\"circle\"},{name:h,icon:\"circle\"},{name:m,icon:\"circle\"},{name:g,icon:\"circle\"},{name:u,icon:S.qz}]},xAxis:[{axisLabel:{formatter:e=>(0,C.Lm)(t,e)},axisLine:C.re,data:n,...yn}],yAxis:(0,S.j2)((0,st.lF)(i)?\"\":D,P),series:[{...bn,name:f,color:\"#0A59F7\",data:b},{...bn,name:p,color:\"#5990FD\",data:y},{...bn,name:d,color:\"#BBDAFD\",data:v},{...bn,stack:\"two\",name:g,color:\"#2DA769\",data:T},{...bn,stack:\"two\",name:m,color:\"#6ACA94\",data:w},{...bn,stack:\"two\",name:h,color:\"#BAEDCD\",data:x},{name:u,type:\"line\",color:\"#ECB613\",data:A}],backgroundColor:\"transparent\",unit:(0,st.lF)(i)?D:i}})(this.intlMessage,e,n,{originElectricityFee:r,originDemandFee:i,originExtraFee:o,currentElectricityFee:a,currentDemandFee:s,currentExtraFee:l,saveElectricityFee:c},u)},this.exportRevenue=()=>{const{period:e,currentYear:t,currentMonth:n}=this.state,r=\"month\"===e?s()(n):s()(t).year();nn.Z.exportRevenueInfo(this.props.stationDn,{year:0,lifetime:1,month:2}[e],r,this.setExportListModal,V.ji.ALL_REVENUE)},this.setExportListModal=e=>{this.setState({showExportListModal:e})},this.renderChart=function(e){var n;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_e.mz;if(!t.props.hasNewPrice)return(0,D.jsx)(Et.Z,{image:\"/pvmswebsite/assets/build/images/station/noData.png\",description:t.intlMessage(\"neteco.pvms.power.noPrice.businessSattion.detail.new\",{0:(0,D.jsx)(\"a\",{onClick:()=>(0,st.er)(t.state.stationDn,on.e.elecPriceEntry.entryType.BY_PLANT_BENEFIT_ANALYSIS),children:t.intlMessage(\"neteco.pvms.power.noPrice.businessSattion.detail.new.jump\")})})});const{loading:i,data:o}=t.state;return i?(0,D.jsx)(b.Z,{className:\"report-loading\",size:\"large\"}):null!=o&&null!==(n=o.xAxis)&&void 0!==n&&n.length?(0,D.jsxs)(\"div\",{className:\"charts-container\",children:[(0,D.jsx)(\"div\",{className:\"yAxis-name-area\",children:(0,D.jsx)(\"div\",{className:\"chart-title-unit\",children:e.unit})}),(0,D.jsx)(At.Z,{option:e,afterCreated:r,style:{width:\"100%\",height:\"100%\"}})]}):(0,D.jsx)(Et.Z,{image:\"/pvmswebsite/assets/build/images/station/noData.png\",description:t.intlMessage(\"neteco.pvms.noData\")})},this.state={period:\"year\",currentYear:s()().startOf(\"year\"),currentMonth:s()().startOf(\"month\"),data:{},stationDn:e.stationDn,sceneType:e.sceneType,showExportListModal:!1,loading:!1}}componentDidMount(){(0,v.lVp)(v.ozc)&&this.props.hasNewPrice&&this.getAllRevenue()}render(){const{period:e,currentMonth:t,currentYear:n,data:r}=this.state,i=(0,ut.jA)()?this.intlMessage(\"neteco.pvms.aifc.revenueReport.CI.tit\"):this.intlMessage(\"neteco.pvms.aifc.revenueReport.no.china.CI.tit\");return(0,D.jsxs)(\"div\",{className:\"nco-monitor-station-all-revenue tab-content\",children:[(0,D.jsxs)(\"div\",{className:\"report-operation\",children:[(0,D.jsxs)(xn,{children:[(0,D.jsx)(oe.Z,{type:\"month\"===e?\"primary\":\"default\",onClick:()=>{this.selectPeriodHandler(\"month\")},title:this.intlMessage(\"neteco.pvms.systemSetting.amendment.month\"),children:this.intlMessage(\"neteco.pvms.systemSetting.amendment.month\")}),(0,D.jsx)(oe.Z,{type:\"year\"===e?\"primary\":\"default\",onClick:()=>{this.selectPeriodHandler(\"year\")},title:this.intlMessage(\"neteco.pvms.systemSetting.amendment.year\"),children:this.intlMessage(\"neteco.pvms.systemSetting.amendment.year\")}),(0,D.jsx)(oe.Z,{type:\"lifetime\"===e?\"primary\":\"default\",onClick:()=>{this.selectPeriodHandler(\"lifetime\")},title:this.intlMessage(\"neteco.pvms.KPI.kpiView.lifelimit\"),children:this.intlMessage(\"neteco.pvms.KPI.kpiView.lifelimit\")})]}),(0,D.jsxs)(\"div\",{className:\"report-datetime\",children:[(0,D.jsx)(Ot.Z,{title:this.intlMessage(\"neteco.pvms.power.lastYear\"),className:\"datetime-arrow\",onClick:()=>this.forwardOrNextDate(-1)}),(0,D.jsx)(Dt.Z,{timeDimension:e,value:\"month\"===e?t:n,onChange:this.handTimeChange}),(0,D.jsx)(Mt.Z,{title:this.intlMessage(\"neteco.pvms.power.nextYear\"),className:\"datetime-arrow\",onClick:()=>this.forwardOrNextDate(1)})]}),(0,v.lVp)(v.ql_)&&(0,D.jsx)(oe.Z,{onClick:this.exportRevenue,children:(0,D.jsx)(gn.Z,{id:\"neteco.pvms.componentSetting.export\"})})]}),(0,D.jsxs)(\"div\",{className:\"echarts-list\",children:[(0,D.jsxs)(\"div\",{className:\"echarts all-income-echarts\",children:[(0,D.jsx)(\"div\",{className:\"chart-title\",children:this.intlMessage(\"neteco.pvms.station.revenue.allRevenue\")}),this.renderChart(this.buildBenefitsOption())]}),(0,D.jsxs)(\"div\",{className:\"echarts bill-composition-echarts\",children:[(0,D.jsxs)(\"div\",{className:\"chart-title\",children:[this.intlMessage(\"neteco.pvms.station.revenue.key13\"),(0,D.jsx)(d.Z,{placement:\"right\",title:this.intlMessage(\"neteco.pvms.smsrc.stationRevenue.allRevenue.tip\",{AIName:i}),children:(0,D.jsx)(\"i\",{className:\"icon-questionmark-circle-lined\"})})]}),this.renderChart(this.buildStructureOption(),C.KR)]})]}),(0,D.jsx)(vn.Z,{showExportListModal:this.state.showExportListModal,setExportListModal:this.setExportListModal,reportId:V.xL,exportOperation:v.ql_})]})}}const Tn=(0,o.ZP)(Cn);function An(e,t,n){return{name:t,color:n,stack:\"battery\",data:(0,S.sD)(e),...C.MX}}function En(e,t,n,r,i){return{name:t,color:n,stack:[\"default\",\"emma\"][r],data:(0,S.sD)(e),yAxisIndex:i,...C.MX}}const On=e=>({batteryRevenueTip:e(\"neteco.pvms.smsrc.stationRevenue.tip.batteryRevenue\"),demandRevenueTip:e(\"neteco.pvms.smsrc.stationRevenue.tip.demandRevenue\"),arbitrageRevenueTip:e(\"neteco.pvms.smsrc.stationRevenue.tip.arbitrageRevenue\")});function Mn(e,t,n){const{batteryRevenueTip:r,demandRevenueTip:i,arbitrageRevenueTip:o}=On(n),{demandBenefits:a}=e;return[{...An(e.arbitrageBenefits,o,\"#D19900\")},\"month\"!==t&&a&&a.length>0&&{...An(e.demandBenefits,i,\"#FDD42E\")},{name:r,type:\"line\",color:\"#A57300\",data:(0,S.sD)(e.storageBenefits)}]}const Pn=e=>({selfUseWithoutStorage:e(\"neteco.pvms.station.energy.management.self.kpiWithoutEnergyStorage\"),selfUseWithStorage:e(\"neteco.pvms.station.energy.management.self.kpiWithEnergyStorage\"),selfUseBoosting:e(\"neteco.pvms.station.energy.management.self.kpiBoosting\")});function Dn(e,t,n){const{selfUseWithoutStorage:r,selfUseWithStorage:i,selfUseBoosting:o}=Pn(n),{selfUseImprove:a,originSelfUse:s,currentSelfUse:l}=e;return[{name:r,color:\"#1AAC6E\",data:(0,S.sD)(s),...C.MX},{name:i,color:\"#6ACA94\",data:(0,S.sD)(l),...C.MX},{name:o,type:\"line\",color:\"#FDC101\",data:(0,S.sD)(a)}]}const In=e=>({originDemandTip:e(\"neteco.pvms.smsrc.stationRevenue.originDemand\"),currentDemandTip:e(\"neteco.pvms.smsrc.stationRevenue.currentDemand\"),demandRevenueTip:e(\"neteco.pvms.smsrc.stationRevenue.tip.demandRevenue\"),transCapacityTip:e(\"neteco.pvms.smsrc.stationRevenue.transCapacityTip\"),contractTip:e(\"neteco.pvms.smsrc.stationRevenue.contractDemand\")});function Nn(e,t,n,r,i){const o=[],a=[],s=[],l=[],c=(0,st.VF)(n)?C.z:C.i0,u=(0,st.VF)(n),{originDemandTip:d,currentDemandTip:p,demandRevenueTip:f,contractTip:h,transCapacityTip:m}=In(t);for(let t=0;t<e.length;t++)switch(e[t].seriesName){case d:o.push(`${e[t].marker} ${e[t].seriesName}`),a.push((0,C.yn)(e[t].value,r));break;case p:s.push(`${e[t].marker} ${e[t].seriesName}`),l.push((0,C.yn)(e[t].value,r));break;case f:o.push(`${(0,S.hH)(e[t].color)} ${e[t].seriesName}`),a.push((0,C.yn)(e[t].value,n,c,u));break;case h:o.push(`${(0,S.hH)(e[t].color)} ${e[t].seriesName}`),a.push((0,C.yn)(e[t].value,r));break;case m:o.push(`${(0,S.hH)(e[t].color)} ${e[t].seriesName}`),a.push((0,C.yn)(e[t].value,i))}return(0,S.OA)(e[0].axisValueLabel,o,a,s,l)}function _n(e){const{demandRevenueData:t,intlMessage:n,showDemandRevenue:r,isSingle:i,hasContractsConfig:o,hasTransformersConfig:a}=e,{originDemandBenefits:s,currentDemandBenefits:l,demandBenefits:c,contractDemand:u,transCapacity:d,contract:p}=t,{originDemandTip:f,currentDemandTip:h,demandRevenueTip:m,transCapacityTip:g,contractTip:v}=In(n),y=o&&p&&p.length>0,b=a&&d&&d.length>0;return[s.length>0&&{name:f,color:\"#5990FD\",yAxisIndex:i?0:1,data:(0,S.sD)(s),...C.MX},l.length>0&&{name:h,color:\"#6ACA94\",yAxisIndex:i?0:1,data:(0,S.sD)(l),...C.MX},r&&c.length>0&&{name:m,type:\"line\",color:\"#FDC000\",yAxisIndex:0,data:(0,S.sD)(c)},y&&{name:v,type:\"line\",color:\"#5531EB\",yAxisIndex:i?0:1,data:(0,S.sD)(p)},b&&{name:g,type:\"line\",color:\"#191919\",yAxisIndex:0,data:(0,S.sD)(d)}]}function jn(e,t){const{originElectricityData:n,currentElectricityData:r}=t,i=[];for(let t=0;t<n.length;t++)i.push({name:1===n.length&&\"\"===n[t].groupName?e(\"neteco.pvms.smsrc.stationRevenue.plain.noStorageTip\"):e(\"neteco.pvms.smsrc.stationRevenue.noStorageTip\",{timePeriod:n[t].groupName}),icon:\"circle\"});for(let t=0;t<r.length;t++)i.push({name:1===r.length&&\"\"===r[t].groupName?e(\"neteco.pvms.smsrc.stationRevenue.plain.storageTip\"):e(\"neteco.pvms.smsrc.stationRevenue.storageTip\",{timePeriod:r[t].groupName}),icon:\"circle\"});return i.push({name:e(\"neteco.pvms.smsrc.stationRevenue.tip.arbitrageRevenue\"),icon:S.qz}),i}function kn(e,t){const{originElectricityData:n,currentElectricityData:r,arbitrageBenefits:i}=e,o=[];for(let e=n.length-1;e>=0;e--)o.push({...En(n[e].groupData,1===n.length&&\"\"===n[e].groupName?t(\"neteco.pvms.smsrc.stationRevenue.plain.noStorageTip\"):t(\"neteco.pvms.smsrc.stationRevenue.noStorageTip\",{timePeriod:n[e].groupName}),Lt.Xe[n.length-1][e],0,1)});for(let e=r.length-1;e>=0;e--)o.push({...En(r[e].groupData,1===r.length&&\"\"===r[e].groupName?t(\"neteco.pvms.smsrc.stationRevenue.plain.storageTip\"):t(\"neteco.pvms.smsrc.stationRevenue.storageTip\",{timePeriod:r[e].groupName}),Lt.X[r.length-1][e],1,1)});return o.push({name:t(\"neteco.pvms.smsrc.stationRevenue.tip.arbitrageRevenue\"),type:\"line\",color:\"#D19900\",yAxisIndex:0,data:(0,S.sD)(i)}),o}function Ln(e){let{dataList:t,intlMessage:n,keyName:r}=e;if(t.length>1){const e=n(\"neteco.pvms.systemSetting.other\");return t.map((t=>{const n=(0,st.p$)(t);return\"\"===n[r]&&(n[r]=e),n}))}return t}const Rn=oe.Z.Group;class Zn extends l.Component{constructor(e){super(e),this.intlMessage=(e,t)=>this.props.intl.formatMessage({id:e},t),this.getRevenueContentData=()=>{this.setState({batteryRevenueLoading:!0});const{period:e,currentYear:t,currentMonth:n}=this.state,r=\"month\"===e?s()(n):s()(t).year();nn.Z.getBatteryContent(this.props.stationDn,{year:0,lifetime:1,month:2}[e],r).then((e=>{this.setState({batteryRevenueData:e})})).finally((()=>{this.setState({batteryRevenueLoading:!1})}))},this.getDemandRevenueData=()=>{if(\"month\"===this.state.period)return;this.setState({demandRevenueLoading:!0});const{period:e,currentYear:t}=this.state;nn.Z.getBatteryDemandRevenue(this.props.stationDn,{year:0,lifetime:1,month:2}[e],s()(t).year()).then((e=>{this.setState({demandRevenueData:e,operateLegendOfDemand:new Array(null==e?void 0:e.timeShareDemandBenefitsList.length).fill(null)})})).finally((()=>{this.setState({demandRevenueLoading:!1})}))},this.getArbitrageRevenueData=()=>{this.setState({arbitrageRevenueLoading:!0});const{period:e,currentYear:t,currentMonth:n}=this.state,r=\"month\"===e?s()(n):s()(t).year();nn.Z.getBatteryArbitrageRevenue(this.props.stationDn,{year:0,lifetime:1,month:2}[e],r).then((e=>{this.setState({arbitrageRevenueData:e,arbitrageRevenueLoading:!1})})).finally((()=>{this.setState({arbitrageRevenueLoading:!1})}))},this.getSelfUseRevenueData=()=>{this.setState({selfUseRevenueLoading:!0});const{period:e,currentYear:t,currentMonth:n}=this.state,r=\"month\"===e?s()(n):s()(t).year();nn.Z.getSelfUserRevenue(this.props.stationDn,{year:0,lifetime:1,month:2}[e],r).then((e=>{e&&this.setState({selfUseRevenueData:e,selfUseRevenueLoading:!1})})).finally((()=>{this.setState({selfUseRevenueLoading:!1})}))},this.getBatteryRevenueReport=()=>{const{isLightStorage:e}=this.props;this.setState({batteryRevenueData:{xAxis:[],measureUnit:\"\"},demandRevenueData:{xAxis:[],basicTariffType:V.wF.NONE,measureUnit:\"\",hasContractsConfig:!1,hasTransformersConfig:!1},arbitrageRevenueData:{xAxis:[],measureUnit:\"\"},selfUseRevenueData:{xAxis:[],measureUnit:\"\"},operateLegendOfDemand:null,operateLegendOfArbitrage:null,operateLegendOfSelfUse:null}),(0,v.lVp)(v.J6v)&&this.getRevenueContentData(),(0,v.lVp)(v.Kwq)&&this.getDemandRevenueData(),(0,v.lVp)(v.mrj)&&this.getArbitrageRevenueData(),e&&(0,v.lVp)(v.ozc)&&this.getSelfUseRevenueData()},this.getSelectedLegendOfDemand=(e,t)=>{const{operateLegendOfDemand:n}=this.state;e&&(n[t]=e),this.setState({operateLegendOfDemand:n})},this.getSelectedLegendOfArbitrage=e=>{this.setState({operateLegendOfArbitrage:e})},this.getSelectedLegendOfSelfUse=e=>{this.setState({operateLegendOfSelfUse:e})},this.selectPeriodHandler=e=>{const{period:t}=this.state;e!==t&&this.setState({period:e,currentYear:s()().startOf(\"year\"),currentMonth:s()().startOf(\"month\")},(()=>this.props.hasNewPrice&&this.getBatteryRevenueReport()))},this.forwardOrNextDate=e=>{this.setState((t=>\"month\"===t.period?{currentMonth:s()(t.currentMonth).add(e,\"month\")}:{currentYear:s()(t.currentYear).add(e,\"year\")}),(()=>this.props.hasNewPrice&&this.getBatteryRevenueReport()))},this.handTimeChange=e=>{\"month\"===this.state.period?this.setState({currentMonth:e},(()=>this.props.hasNewPrice&&this.getBatteryRevenueReport())):this.setState({currentYear:e},(()=>this.props.hasNewPrice&&this.getBatteryRevenueReport()))},this.setExportListModal=e=>{this.setState({showExportListModal:e})},this.exportBatteryRevenue=()=>{const{period:e,currentYear:t,currentMonth:n}=this.state,r=\"month\"===e?s()(n):s()(t).year();nn.Z.exportRevenueInfo(this.props.stationDn,{year:0,lifetime:1,month:2}[e],r,this.setExportListModal,V.ji.BATTERY_REVENUE)},this.state={period:\"year\",currentYear:s()().startOf(\"year\"),currentMonth:s()().startOf(\"month\"),batteryRevenueLoading:!1,batteryRevenueData:{xAxis:[],measureUnit:\"\"},demandRevenueLoading:!1,demandRevenueData:{xAxis:[],basicTariffType:V.wF.NONE,measureUnit:\"\",hasContractsConfig:!1,hasTransformersConfig:!1},arbitrageRevenueLoading:!1,arbitrageRevenueData:{xAxis:[],measureUnit:\"\"},selfUseRevenueLoading:!1,selfUseRevenueData:{xAxis:[],measureUnit:\"\"},showExportListModal:!1,operateLegendOfDemand:null,operateLegendOfArbitrage:null,operateLegendOfSelfUse:null}}componentDidMount(){this.props.hasNewPrice&&this.getBatteryRevenueReport()}buildArbitrageRevenueChart(e,t){const n=e?{}:((e,t,n,r)=>{const{measureUnit:i,arbitrageBenefits:o,originElectricityData:a,currentElectricityData:s}=t;let l=a,c=s,u=l.map((e=>e.groupData)),d=c.map((e=>e.groupData));const p=(0,C.JM)(u),f=(0,C.JM)(d);a.length>Lt.Xe.length&&(u=[...p],d=[...f],l=[{groupName:\"\",groupData:[...u]}],c=[{groupName:\"\",groupData:[...d]}]);const h=\"groupName\";l=Ln({dataList:l,intlMessage:e,keyName:h}),c=Ln({dataList:c,intlMessage:e,keyName:h});const{arbitrageLegendAndDataMap:m,leftOriginLegend:g,rightOriginLegend:v,noStoragePowerLegend:y,storagePowerLegend:b}=function(e,t){const{originElectricityData:n,currentElectricityData:r,arbitrageBenefits:i}=t,o={},a=[],s=[],l=[],c=[];for(let t=0;t<n.length;t++)o[e(\"neteco.pvms.smsrc.stationRevenue.noStorageTip\",{timePeriod:n[t].groupName})]=n[t].groupData,s.push(e(\"neteco.pvms.smsrc.stationRevenue.noStorageTip\",{timePeriod:n[t].groupName})),l.push(e(\"neteco.pvms.smsrc.stationRevenue.noStorageTip\",{timePeriod:n[t].groupName}));for(let t=0;t<r.length;t++)o[e(\"neteco.pvms.smsrc.stationRevenue.storageTip\",{timePeriod:r[t].groupName})]=r[t].groupData,s.push(e(\"neteco.pvms.smsrc.stationRevenue.storageTip\",{timePeriod:r[t].groupName})),c.push(e(\"neteco.pvms.smsrc.stationRevenue.storageTip\",{timePeriod:r[t].groupName}));return o[e(\"neteco.pvms.smsrc.stationRevenue.tip.arbitrageRevenue\")]=i,a.push(e(\"neteco.pvms.smsrc.stationRevenue.tip.arbitrageRevenue\")),{arbitrageLegendAndDataMap:o,leftOriginLegend:a,rightOriginLegend:s,noStoragePowerLegend:l,storagePowerLegend:c}}(e,{...t,originElectricityData:l,currentElectricityData:c}),x=[],w=[];let T={};if(r){const t=(0,C.rG)(r),n={[e(\"neteco.pvms.smsrc.stationRevenue.plain.noStorageTip\")]:e(\"neteco.pvms.smsrc.stationRevenue.noStorageTip\",{timePeriod:\"\"}),[e(\"neteco.pvms.smsrc.stationRevenue.plain.storageTip\")]:e(\"neteco.pvms.smsrc.stationRevenue.storageTip\",{timePeriod:\"\"})};for(let r=0;r<t.length;r++){let i=t[r];1===l.length&&\"\"===l[0].groupName&&i!==e(\"neteco.pvms.smsrc.stationRevenue.tip.arbitrageRevenue\")&&(i=n[i]);const o=m[i];y.includes(i)&&x.push(o),b.includes(i)&&w.push(o),g.includes(i)&&(T[i]=o)}}const A=(0,C.JM)(x),E=(0,C.JM)(w),O=r?Object.values(T):o,M=r?[A,E,...x,...w]:[p,f,...u,...d],{leftYProps:P,rightYProps:D}=(0,S.vg)({leftOriginData:O,rightOriginData:M,splitNumber:5}),{min:I,max:N}=P,{min:_,max:j}=D,{multiple:k,unit:L}=(0,S.dN)([I,N],Pt.qG,i),{multiple:R,unit:Z}=(0,S.dN)([_,j],Pt.s1);return{tooltip:{...C.W,formatter:t=>function(e,t,n,r,i){const{originElectricityData:o,currentElectricityData:a,allOriginNoStoragePower:s,allOriginStoragePower:l}=t,c=e[0].dataIndex,u=s[c],d=l[c],p=e.length-1,f=[...(0,st.Dc)(o.map((e=>e.groupData[c])).reverse()),...(0,st.Dc)(a.map((e=>e.groupData[c])).reverse())].filter(((t,n)=>e.map((e=>e.seriesIndex)).includes(n))),h=e[p].seriesName===n(\"neteco.pvms.smsrc.stationRevenue.tip.arbitrageRevenue\"),m=[],g=[],v=[],y=[];(e.length>1||!h)&&(v.push(n(\"neteco.pvms.smsrc.stationRevenue.allNoStoragePowerTip\")),y.push((0,C.yn)(u,i)),m.push(n(\"neteco.pvms.smsrc.stationRevenue.allStoragePowerTip\")),g.push((0,C.yn)(d,i)));for(let t=h?p-1:p;t>=0;t--){const n=e[t].seriesName.lastIndexOf(\"-\"),r=e[t].seriesName.substring(0,n);if(\"\"===r)continue;const o=e[t].color,a=(0,C.yn)(e[t].value,i),s=Number(f[t])>0?`${f[t]}%`:V.lH,l=`${e[t].marker} ${r}`,c=(0,S.hC)(a,`${a} (${s})`);Lt.Xe.flat().includes(o)?(v.push(l),y.push(c)):Lt.X.flat().includes(o)&&(m.push(l),g.push(c))}if(h){const t=(0,st.VF)(r)?C.z:C.i0,n=(0,st.VF)(r);v.push(`${(0,S.hH)(e[p].color)}${e[p].seriesName}`),y.push((0,C.yn)(e[p].value,r,t,n))}return(0,S.OA)(e[0].axisValueLabel,v,y,m,g)}(t,{originElectricityData:l,currentElectricityData:c,allOriginNoStoragePower:p,allOriginStoragePower:f},e,i,e(\"neteco.pvms.unit.kWhUnit\"))},grid:{...C.o3},legend:{...C.hv,data:jn(e,{originElectricityData:l,currentElectricityData:c}),type:\"scroll\"},xAxis:[{type:\"category\",axisTick:{show:!1},axisLine:C.re,axisLabel:{formatter:e=>(0,C.Lm)(n,e)},scale:!0,data:t.xAxis,axisPointer:{type:\"shadow\"},boundaryGap:!0}],yAxis:[{...(0,S.j2)((0,st.lF)(i)?\"\":L,k),...P},{...(0,S.j2)(\"\",R),...D}],series:kn({originElectricityData:l,currentElectricityData:c,arbitrageBenefits:o},e),backgroundColor:\"transparent\",energyUnit:Z,moneyUnit:(0,st.lF)(i)?L:i}})(this.intlMessage,this.state.arbitrageRevenueData,t,this.state.operateLegendOfArbitrage);return(0,D.jsxs)(\"div\",{className:\"echarts arbitrage-income-echarts\",children:[(0,D.jsx)(\"div\",{className:\"chart-title\",children:this.intlMessage(\"neteco.pvms.smsrc.stationRevenue.emma.arbitrageTitle\")}),(0,D.jsx)(\"div\",{className:\"report-echarts\",children:this.buildArbitrageRevenueContent(e,n)})]})}buildArbitrageRevenueContent(e,t){return this.props.hasNewPrice?this.state.arbitrageRevenueLoading?(0,D.jsx)(\"div\",{className:\"empty-wrap\",children:(0,D.jsx)(b.Z,{className:\"report-loading\",size:\"large\"})}):e?(0,D.jsx)(\"div\",{className:\"empty-wrap\",children:(0,D.jsx)(Et.Z,{image:\"/pvmswebsite/assets/build/images/station/noData.png\",description:this.intlMessage(\"neteco.pvms.noData\")})}):(0,D.jsxs)(\"div\",{className:\"charts-container\",children:[(0,D.jsxs)(\"div\",{className:\"yAxis-name-area\",children:[(0,D.jsx)(\"span\",{className:\"yAxis-name-left\",children:t.moneyUnit}),(0,D.jsx)(\"span\",{className:\"yAxis-name-right\",children:t.energyUnit})]}),(0,D.jsx)(At.Z,{style:{width:\"100%\",height:\"90%\"},afterCreated:e=>(0,C.KR)(e,this.getSelectedLegendOfArbitrage),option:t})]}):(0,D.jsx)(\"div\",{className:\"empty-wrap\",children:(0,D.jsx)(Et.Z,{image:\"/pvmswebsite/assets/build/images/station/noData.png\",description:this.intlMessage(\"neteco.pvms.power.noPrice.businessSattion.detail.new\",{0:(0,D.jsx)(\"a\",{onClick:()=>(0,st.er)(this.props.stationDn,on.e.elecPriceEntry.entryType.BY_PLANT_BENEFIT_ANALYSIS),children:this.intlMessage(\"neteco.pvms.power.noPrice.businessSattion.detail.new.jump\")})})})})}buildSelfUseChart(e,t){const{selfUseRevenueData:n,operateLegendOfSelfUse:r}=this.state,i=e?{}:(e=>{let{intlMessage:t,selfUseRevenueData:n,period:r,operateLegendOfSelfUse:i}=e;const{selfUseWithoutStorage:o,selfUseWithStorage:a,selfUseBoosting:s}=Pn(t),{xAxis:l,...c}=n;let u={...c};if(i){const e={[t(\"neteco.pvms.station.energy.management.self.kpiWithoutEnergyStorage\")]:\"originSelfUse\",[t(\"neteco.pvms.station.energy.management.self.kpiBoosting\")]:\"selfUseImprove\",[t(\"neteco.pvms.station.energy.management.self.kpiWithEnergyStorage\")]:\"currentSelfUse\"},n=(0,C.rG)(i);u={},n.forEach((t=>{const n=e[t];u[n]=c[n]}))}const d=t(\"neteco.pvms.unit.kWhUnit\"),{min:p,max:f,interval:h}=(0,S.GO)(Object.values(u).flat()),{multiple:m,unit:g}=(0,S.dN)([p,f],Pt.s1,!0);return{tooltip:{...C.W,formatter:e=>function(e,t,n){const r=[],i=[],o=(0,st.VF)(t)?C.z:C.i0,a=(0,st.VF)(t),s=e.length-1;for(let s=0;s<e.length;s++)e[s].seriesName!==Pn(n).selfUseBoosting&&(r.push(`${e[s].marker} ${e[s].seriesName}`),i.push((0,C.yn)(e[s].value,t,o,a)));return e[s].seriesName===Pn(n).selfUseBoosting&&(r.push(`${(0,S.hH)(e[s].color)}${e[s].seriesName}`),i.push((0,C.yn)(e[s].value,t,o,a))),(0,S.OA)(e[0].axisValueLabel,r,i)}(e,d,t)},grid:{...C.o3},legend:{...C.hv,data:[{name:o,icon:\"circle\"},{name:a,icon:\"circle\"},{name:s,icon:S.qz}]},xAxis:[{type:\"category\",axisTick:{show:!1},axisLabel:{formatter:e=>(0,C.Lm)(r,e)},axisLine:C.re,scale:!0,data:l,axisPointer:{type:\"shadow\"},boundaryGap:!0}],yAxis:[{...(0,S.j2)(\"\",m),max:f,min:p,interval:h}],series:Dn(u,0,t),backgroundColor:\"transparent\",unit:g}})({intlMessage:this.intlMessage,selfUseRevenueData:n,period:t,operateLegendOfSelfUse:r});return(0,D.jsxs)(\"div\",{className:\"echarts self-use-echarts\",children:[(0,D.jsx)(\"div\",{className:\"chart-title\",children:this.intlMessage(\"neteco.pvms.station.energy.management.self.kpi\")}),(0,D.jsx)(\"div\",{className:\"report-echarts\",children:this.buildSelfUseContent(e,i)})]})}buildSelfUseContent(e,t){return this.state.selfUseRevenueLoading?(0,D.jsx)(\"div\",{className:\"empty-wrap\",children:(0,D.jsx)(b.Z,{className:\"report-loading\",size:\"large\"})}):e?(0,D.jsx)(\"div\",{className:\"empty-wrap\",children:(0,D.jsx)(Et.Z,{image:\"/pvmswebsite/assets/build/images/station/noData.png\",description:this.intlMessage(\"neteco.pvms.noData\")})}):(0,D.jsxs)(\"div\",{className:\"charts-container\",children:[(0,D.jsx)(\"div\",{className:\"yAxis-name-area\",children:(0,D.jsx)(\"span\",{className:\"yAxis-name-left\",children:t.unit})}),(0,D.jsx)(At.Z,{style:{width:\"100%\",height:\"90%\"},option:t,afterCreated:e=>(0,C.KR)(e,this.getSelectedLegendOfSelfUse)})]})}buildDemandRevenueChart(e,t){const n=(0,ut.jA)()?this.intlMessage(\"neteco.pvms.aifc.revenueReport.CI.tit\"):this.intlMessage(\"neteco.pvms.aifc.revenueReport.no.china.CI.tit\");return(0,D.jsxs)(\"div\",{className:\"echarts demand-income-echarts\",children:[(0,D.jsxs)(\"div\",{className:\"chart-title\",children:[this.intlMessage(\"neteco.pvms.smsrc.stationRevenue.emma.demandTitle\"),(0,D.jsx)(d.Z,{placement:\"right\",title:this.intlMessage(\"neteco.pvms.smsrc.stationRevenue.allRevenue.tip\",{AIName:n}),children:(0,D.jsx)(\"i\",{className:\"icon-questionmark-circle-lined\"})})]}),(0,D.jsx)(\"div\",{className:\"report-echarts\",children:this.buildDemandChartContent(e,t)})]})}buildDemandChartContent(e,t){if(!this.props.hasNewPrice)return(0,D.jsx)(\"div\",{className:\"empty-wrap\",children:(0,D.jsx)(Et.Z,{image:\"/pvmswebsite/assets/build/images/station/noData.png\",description:this.intlMessage(\"neteco.pvms.power.noPrice.businessSattion.detail.new\",{0:(0,D.jsx)(\"a\",{onClick:()=>(0,st.er)(this.props.stationDn,on.e.elecPriceEntry.entryType.BY_PLANT_BENEFIT_ANALYSIS),children:this.intlMessage(\"neteco.pvms.power.noPrice.businessSattion.detail.new.jump\")})})})});if(this.state.demandRevenueLoading)return(0,D.jsx)(\"div\",{className:\"empty-wrap\",children:(0,D.jsx)(b.Z,{className:\"report-loading\",size:\"large\"})});if(\"month\"===t)return(0,D.jsx)(\"div\",{className:\"empty-wrap\",children:(0,D.jsx)(Et.Z,{image:\"/pvmswebsite/assets/build/images/station/noData.png\",description:this.intlMessage(\"neteco.pvms.smsrc.stationRevenue.month.tip\")})});if(e)return(0,D.jsx)(\"div\",{className:\"empty-wrap\",children:(0,D.jsx)(Et.Z,{image:\"/pvmswebsite/assets/build/images/station/noData.png\",description:this.intlMessage(\"neteco.pvms.noData\")})});const{timeShareDemandBenefitsList:n,measureUnit:r,xAxis:i,hasContractsConfig:o,hasTransformersConfig:a}=this.state.demandRevenueData;return null==n?void 0:n.map(((n,s)=>{const l={intlMessage:this.intlMessage,demandRevenueData:n,period:t,xAxis:i,measureUnit:r,selectedLegend:this.state.operateLegendOfDemand[s],hasContractsConfig:o,hasTransformersConfig:a},c=e?{}:(e=>{const{intlMessage:t,demandRevenueData:n,period:r,xAxis:i,measureUnit:o,selectedLegend:a,hasContractsConfig:s,hasTransformersConfig:l}=e,{originDemandBenefits:c,currentDemandBenefits:u,demandBenefits:d,contractDemand:p,transCapacity:f,contract:h}=n,{originDemandTip:m,currentDemandTip:g,demandRevenueTip:v,transCapacityTip:y,contractTip:b}=In(t);let x={[m]:{originDemandBenefits:c},[g]:{currentDemandBenefits:u}};const w=!(l||s);l&&(x={...x,[y]:{transCapacity:f}}),s&&(x={...x,[b]:{contract:h}}),w&&(x={...x,[v]:{demandBenefits:d}});let T=[],A={},E=[m,g],O={originDemandBenefits:c,currentDemandBenefits:u,contractDemand:p};return w&&(T=[v],A={demandBenefits:d}),l&&(T=[y],A={transCapacity:f}),s&&(E.push(b),O={...O,contract:h}),!l&&s?function(e){const{intlMessage:t,showDemandRevenue:n,demandRevenueData:r,period:i,xAxis:o,measureUnit:a,hasContractsConfig:s,hasTransformersConfig:l}=e,{originDemandTip:c,currentDemandTip:u,demandRevenueTip:d,contractTip:p,transCapacityTip:f}=In(t),{originDemandBenefits:h,currentDemandBenefits:m,contractDemand:g,transCapacity:v=[],contract:y=[]}=r,{multiple:b,unit:x}=(0,S.dN)({originDemandBenefits:h,currentDemandBenefits:m,contractDemand:g,contract:y},Pt.js);return{tooltip:{...C.W,formatter:e=>Nn(e,t,a,t(\"neteco.pvms.unit.KW\"),t(\"neteco.pvms.smsrc.stationRevenue.transCapacityTip.unit\"))},grid:{...C.o3},legend:{...C.hv,data:[h.length>0&&{name:c,icon:\"circle\"},m.length>0&&{name:u,icon:\"circle\"},n&&{name:d,icon:S.qz},l&&v.length>0&&{name:f,icon:S.qz},s&&y.length>0&&{name:p,icon:S.qz}]},xAxis:[{type:\"category\",axisLabel:{formatter:e=>(0,C.Lm)(i,e)},axisTick:{show:!1},axisLine:C.re,scale:!0,data:o,axisPointer:{type:\"shadow\"},boundaryGap:!0}],yAxis:[{...(0,S.j2)(\"\",b)}],series:_n({demandRevenueData:r,intlMessage:t,showDemandRevenue:n,isSingle:!0,hasContractsConfig:s,hasTransformersConfig:l}),backgroundColor:\"transparent\",leftUint:x,rightUint:\"\"}}({intlMessage:t,showDemandRevenue:w,demandRevenueData:n,period:r,xAxis:i,measureUnit:o,hasContractsConfig:s,hasTransformersConfig:l}):function(e){const{intlMessage:t,showDemandRevenue:n,leftOriginLegend:r,rightOriginLegend:i,leftOriginData:o,rightOriginData:a,legendAndDataMap:s,selectedLegend:l,demandRevenueData:c,period:u,xAxis:d,measureUnit:p,hasContractsConfig:f,hasTransformersConfig:h}=e,{originDemandTip:m,currentDemandTip:g,demandRevenueTip:v,contractTip:y,transCapacityTip:b}=In(t),{originDemandBenefits:x,currentDemandBenefits:w,demandBenefits:T,contractDemand:A,transCapacity:E=[],contract:O=[]}=c,{lastLeftBigintMap:M,lastLeftDataArray:P,lastRightBigintMap:D,lastRightDataArray:I}=(0,C.m1)({legendAndDataMap:s,leftOriginLegend:r,rightOriginLegend:i,leftOriginData:o,rightOriginData:a,selectedLegend:l}),{leftYProps:N,rightYProps:_}=(0,S.vg)({leftOriginData:P,rightOriginData:I,splitNumber:5}),{min:j,max:k}=N,{min:L,max:R}=_,{multiple:Z,unit:B}=(0,S.dN)([j,k],Pt.qG,p),{multiple:F,unit:z}=(0,S.dN)([L,R],Pt.js);let V=\"\";return V=n?(0,st.lF)(p)?B:p:t(\"neteco.pvms.smsrc.stationRevenue.transCapacityTip.unit\"),{tooltip:{...C.W,formatter:e=>Nn(e,t,p,t(\"neteco.pvms.unit.KW\"),t(\"neteco.pvms.smsrc.stationRevenue.transCapacityTip.unit\"))},grid:{...C.o3},legend:{...C.hv,data:[x.length>0&&{name:m,icon:\"circle\"},w.length>0&&{name:g,icon:\"circle\"},n&&{name:v,icon:S.qz},h&&E.length>0&&{name:b,icon:S.qz},f&&O.length>0&&{name:y,icon:S.qz}]},xAxis:[{type:\"category\",axisLabel:{formatter:e=>(0,C.Lm)(u,e)},axisTick:{show:!1},axisLine:C.re,scale:!0,data:d,axisPointer:{type:\"shadow\"},boundaryGap:!0}],yAxis:[{...(0,S.j2)((0,st.lF)(p)?\"\":B,Z),...N},x.length>0&&{...(0,S.j2)(\"\",F),..._}],series:_n({demandRevenueData:c,intlMessage:t,showDemandRevenue:n,isSingle:!1,hasContractsConfig:f,hasTransformersConfig:h}),backgroundColor:\"transparent\",rightUnit:x.length>0?z:\"\",leftUint:V}}({intlMessage:t,showDemandRevenue:w,leftOriginLegend:T,rightOriginLegend:E,leftOriginData:A,rightOriginData:O,legendAndDataMap:x,selectedLegend:a,demandRevenueData:n,period:r,xAxis:i,measureUnit:o,hasContractsConfig:s,hasTransformersConfig:l})})(l);return(0,D.jsxs)(\"div\",{className:\"charts-container\",children:[(0,D.jsx)(\"div\",{className:\"child-chart-name\",children:n.timeName}),(0,D.jsxs)(\"div\",{className:\"yAxis-name-area\",children:[(0,D.jsx)(\"span\",{className:\"yAxis-name-left\",children:c.leftUint}),(0,D.jsx)(\"span\",{className:\"yAxis-name-right\",children:c.rightUnit})]}),(0,D.jsx)(At.Z,{style:{width:\"100%\",height:\"80%\"},afterCreated:e=>(0,C.KR)(e,this.getSelectedLegendOfDemand,s),option:c})]})}))}buildIncomeContentChart(e,t){const n=e?{}:((e,t,n)=>{const{batteryRevenueTip:r,demandRevenueTip:i,arbitrageRevenueTip:o}=On(e),{xAxis:a,measureUnit:s,...l}=t,{demandBenefits:c}=l,{multiple:u,unit:d}=(0,S.dN)(l,Pt.qG,s);return{tooltip:{...C.W,formatter:t=>function(e,t,n){const r=[],i=[],o=e.length-1,a=(0,st.VF)(t)?C.z:C.i0,s=(0,st.VF)(t);for(let l=o;l>=0;l--)e[l].seriesName!==On(n).batteryRevenueTip&&(r.push(`${e[l].marker} ${e[l].seriesName}`),i.push((0,C.yn)(e[l].value,t,a,s)));return e[o].seriesName===On(n).batteryRevenueTip&&(r.push(`${(0,S.hH)(e[o].color)}${e[o].seriesName}`),i.push((0,C.yn)(e[o].value,t,a,s))),(0,S.OA)(e[0].axisValueLabel,r,i)}(t,s,e)},grid:{...C.o3},legend:{...C.hv,data:[c&&c.length>0&&{name:i,icon:\"circle\"},{name:o,icon:\"circle\"},{name:r,icon:S.qz}]},xAxis:[{type:\"category\",axisTick:{show:!1},axisLabel:{formatter:e=>(0,C.Lm)(n,e)},axisLine:C.re,scale:!0,data:a,axisPointer:{type:\"shadow\"},boundaryGap:!0}],yAxis:[{...(0,S.j2)((0,st.lF)(s)?\"\":d,u)}],series:Mn(l,n,e),backgroundColor:\"transparent\",unit:(0,st.lF)(s)?d:s}})(this.intlMessage,this.state.batteryRevenueData,t);return(0,D.jsxs)(\"div\",{className:\"echarts income-content-echarts\",children:[(0,D.jsx)(\"div\",{className:\"chart-title\",children:this.intlMessage(\"neteco.pvms.smsrc.stationRevenue.battery.contentTitle\")}),(0,D.jsx)(\"div\",{className:\"report-echarts\",children:this.buildIncomeContentContent(e,n)})]})}buildIncomeContentContent(e,t){return this.props.hasNewPrice?this.state.batteryRevenueLoading?(0,D.jsx)(\"div\",{className:\"empty-wrap\",children:(0,D.jsx)(b.Z,{className:\"report-loading\",size:\"large\"})}):e?(0,D.jsx)(\"div\",{className:\"empty-wrap\",children:(0,D.jsx)(Et.Z,{image:\"/pvmswebsite/assets/build/images/station/noData.png\",description:this.intlMessage(\"neteco.pvms.noData\")})}):(0,D.jsxs)(\"div\",{className:\"charts-container\",children:[(0,D.jsx)(\"div\",{className:\"yAxis-name-area\",children:(0,D.jsx)(\"span\",{className:\"yAxis-name-left\",children:t.unit})}),(0,D.jsx)(At.Z,{style:{width:\"100%\",height:\"90%\"},option:t})]}):(0,D.jsx)(\"div\",{className:\"empty-wrap\",children:(0,D.jsx)(Et.Z,{image:\"/pvmswebsite/assets/build/images/station/noData.png\",description:this.intlMessage(\"neteco.pvms.power.noPrice.businessSattion.detail.new\",{0:(0,D.jsx)(\"a\",{onClick:()=>(0,st.er)(this.props.stationDn,on.e.elecPriceEntry.entryType.BY_PLANT_BENEFIT_ANALYSIS),children:this.intlMessage(\"neteco.pvms.power.noPrice.businessSattion.detail.new.jump\")})})})})}buildTimeSelection(e,t,n){return(0,D.jsxs)(\"div\",{className:\"report-operation\",children:[(0,D.jsxs)(Rn,{children:[(0,D.jsx)(oe.Z,{type:\"month\"===e?\"primary\":\"default\",onClick:()=>{this.selectPeriodHandler(\"month\")},title:this.intlMessage(\"neteco.pvms.systemSetting.amendment.month\"),children:this.intlMessage(\"neteco.pvms.systemSetting.amendment.month\")}),(0,D.jsx)(oe.Z,{type:\"year\"===e?\"primary\":\"default\",onClick:()=>{this.selectPeriodHandler(\"year\")},title:this.intlMessage(\"neteco.pvms.systemSetting.amendment.year\"),children:this.intlMessage(\"neteco.pvms.systemSetting.amendment.year\")}),(0,D.jsx)(oe.Z,{type:\"lifetime\"===e?\"primary\":\"default\",onClick:()=>{this.selectPeriodHandler(\"lifetime\")},title:this.intlMessage(\"neteco.pvms.KPI.kpiView.lifelimit\"),children:this.intlMessage(\"neteco.pvms.KPI.kpiView.lifelimit\")})]}),(0,D.jsxs)(\"div\",{className:\"report-datetime\",children:[(0,D.jsx)(Ot.Z,{title:this.intlMessage(\"neteco.pvms.power.lastYear\"),className:\"datetime-arrow\",onClick:()=>this.forwardOrNextDate(-1)}),(0,D.jsx)(Dt.Z,{timeDimension:e,value:\"month\"===e?t:n,onChange:this.handTimeChange}),(0,D.jsx)(Mt.Z,{title:this.intlMessage(\"neteco.pvms.power.nextYear\"),className:\"datetime-arrow\",onClick:()=>this.forwardOrNextDate(1)})]}),(0,v.lVp)(v.ql_)&&(0,D.jsx)(oe.Z,{onClick:this.exportBatteryRevenue,children:(0,D.jsx)(gn.Z,{id:\"neteco.pvms.componentSetting.export\"})})]})}render(){const{period:e,currentMonth:t,currentYear:n,batteryRevenueData:r,demandRevenueData:i,arbitrageRevenueData:o,selfUseRevenueData:a}=this.state,{isLightStorage:s}=this.props,l=!r.xAxis||0===r.xAxis.length,c=!i.xAxis||0===i.xAxis.length,u=!o.xAxis||0===o.xAxis.length,d=!a.xAxis||0===a.xAxis.length,p=\"month\"!==e&&(!c||i.basicTariffType!==V.wF.NONE);return(0,D.jsxs)(\"div\",{className:\"nco-battery-revenue-report tab-content\",children:[this.buildTimeSelection(e,t,n),(0,D.jsxs)(\"div\",{className:\"echarts-list\",children:[this.buildIncomeContentChart(l,e),p&&this.buildDemandRevenueChart(c,e),this.buildArbitrageRevenueChart(u,e),s&&this.buildSelfUseChart(d,e),(0,D.jsx)(vn.Z,{showExportListModal:this.state.showExportListModal,setExportListModal:this.setExportListModal,reportId:V.xL,exportOperation:v.ql_})]})]})}}const Bn=(0,o.ZP)(Zn),Fn=oe.Z.Group,zn={year:0,lifetime:1,month:2};class Vn extends l.Component{constructor(e){super(e),this.intlMessage=(e,t)=>this.props.intl.formatMessage({id:e},t),this.getPvRevenue=()=>{this.setState({loading:!0,data:{}});const{stationDn:e,period:t,currentYear:n,currentMonth:r}=this.state,i=zn[t],o={stationDn:e,statDim:i,statTime:(2===i?r:n).valueOf()};nn.Z.loadPvBenefits(o).then((e=>{this.setState({data:e})})).finally((()=>{this.setState({loading:!1})}))},this.selectPeriodHandler=e=>{const{period:t}=this.state;e!==t&&this.setState({period:e,currentYear:s()().startOf(\"year\"),currentMonth:s()().startOf(\"month\")},(()=>this.props.hasNewPrice&&this.getPvRevenue()))},this.forwardOrNextDate=e=>{this.setState((t=>\"month\"===t.period?{currentMonth:s()(t.currentMonth).add(e,\"month\")}:{currentYear:s()(t.currentYear).add(e,\"year\")}),(()=>this.props.hasNewPrice&&this.getPvRevenue()))},this.handTimeChange=e=>{\"month\"===this.state.period?this.setState({currentMonth:e},this.props.hasNewPrice&&this.getPvRevenue()):this.setState({currentYear:e},this.props.hasNewPrice&&this.getPvRevenue())},this.chartLegendChange=e=>{this.setState({lengedState:e.selected})},this.buildBenefitsOption=e=>{const{period:t,data:n}=this.state,{xAxis:r=[],onlineBenefits:i=[],selfConsumptionBenefits:o=[],pvBenefits:a=[],hasMeter:s=!1}=n;return(e=>{let{intlMessage:t,period:n,xAxis:r,datas:i,originUnit:o,hasMeter:a}=e;const s=t(\"neteco.pvms.station.revenue.key11\"),l=t(\"neteco.pvms.station.revenue.key12\"),c=t(\"neteco.pvms.smsrc.stationRevenue.tip.pvRevenueTitle\"),u=(0,C.JM)(Object.values(i)),{multiple:d,unit:p}=(0,S.dN)({lists:u},Pt.qG,o),f=(0,st.lF)(o)?\"\":p,h=(0,st.VF)(o)?C.z:C.i0,m=(0,st.VF)(o),{onlineBenefits:g,selfConsumptionBenefits:v,pvBenefits:y}=i,b=[a&&{name:s,color:\"#D19900\",data:g,icon:\"circle\"},a&&{name:l,color:\"#FDD42E\",data:v,icon:\"circle\"},!a&&{name:c,color:\"#FDD42E\",data:y,icon:\"circle\"}].filter((e=>e));return{tooltip:{...C.W,formatter:e=>{const{axisValue:t,dataIndex:n}=e[0];let r=b.map((e=>({value:(0,C.yn)((0,S.sp)(e.data[n]),o,h,m)})));return e.forEach((e=>{const t=e.seriesIndex;r[t]={...r[t],marker:e.marker,title:e.seriesName}})),r=r.filter((e=>e.marker)).reverse(),((e,t)=>{const n=e=>`<span style=\"margin: 4px 0;\">${e}</span>`;return`<div style=\"min-width:226px\">\\n    <div style=\"color: #111A2C99;font-size: 14px;\">${e}</div>\\n    <div style=\"display: flex;\">\\n      <div style=\"display: flex;flex-direction:column;justify-content: space-around;position:relative;\">\\n        ${t.reduce(((e,t)=>e+t.marker),\"\")}\\n      </div>\\n      <div style=\"display: flex;flex-direction:column;margin-right:22px;margin-left:4px;\">\\n        ${t.reduce(((e,t)=>e+n(t.title)),\"\")}\\n      </div>\\n      <div style=\"display: flex;flex-direction:column;\">\\n        ${t.reduce(((e,t)=>e+n(t.value)),\"\")}\\n      </div>\\n    </div>\\n  </div>`})(t,r)}},grid:C.o3,legend:{...C.hv,data:b.toReversed()},xAxis:[{type:\"category\",...C.IS,axisTick:{show:!1},axisLine:C.re,axisLabel:{formatter:e=>(0,C.Lm)(n,e)},scale:!0,data:r,axisPointer:{type:\"shadow\"},boundaryGap:!0}],yAxis:(0,S.j2)(f,d),series:b.map((e=>({...e,stack:\"one\",...C.MX}))),backgroundColor:\"transparent\",unit:(0,st.lF)(o)?p:o}})({intlMessage:this.intlMessage,period:t,xAxis:r,datas:{onlineBenefits:i,selfConsumptionBenefits:o,pvBenefits:a},originUnit:e,hasMeter:s})},this.buildCapicityOption=e=>{const{period:t,data:n}=this.state,{xAxis:r=[],electricityYield:i=[]}=n;return((e,t,n,r)=>{const i=e(\"neteco.pvms.partials.plants.index.stationProductProfit.powerProduct\"),{multiple:o,unit:a}=(0,S.dN)({electricityYield:r},Pt.s1,!0);return{tooltip:{...C.W,formatter:t=>{let{axisValue:n,data:r,seriesName:i,marker:o}=t[0];return((e,t,n,r)=>`<div style=\"width:226px\">\\n    <div style=\"color: #111A2C99;font-size: 14px;\">${e}</div>\\n    <div style=\"display: flex;\">\\n      <div style=\"display: flex;flex-direction:column;justify-content: space-around;position:relative;\">${r}</div>\\n      <div style=\"display: flex;flex-direction:column;margin-right:22px;margin-left:4px;\"><span style=\"margin: 4px 0;\">${t}</span></div>\\n      <div style=\"display: flex;flex-direction:column;\"><span style=\"margin: 4px 0;\">${n}</span></div>\\n    </div>\\n  </div>`)(n,i,(0,C.yn)((0,S.sp)(r),e(\"neteco.pvms.unit.KWh\"),2,!0),o)}},legend:{...C.hv,selectedMode:!1,data:[{name:i,icon:\"circle\"}]},grid:C.o3,xAxis:[{type:\"category\",...C.IS,